const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/xml-sdJ4AIDG.js","assets/java-CylS5w8V.js","assets/html-GMplVEZG.js","assets/javascript-wDzz0qaB.js","assets/css-DPfMkruS.js","assets/scss-OYdSNvt2.js","assets/graphql-ChdNCCLP.js","assets/typescript-BPQ3VLAy.js","assets/jsx-g9-lgVsj.js","assets/tsx-COt5Ahok.js","assets/php-CDn_0X-4.js","assets/sql-BLtJtn59.js","assets/json-Cp-IABpG.js"])))=>i.map(i=>d[i]);
function g8(e,t){for(var n=0;n<t.length;n++){const i=t[n];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in e)){const r=Object.getOwnPropertyDescriptor(i,s);r&&Object.defineProperty(e,s,r.get?r:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function Ql(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var G_={exports:{}},Wd={};var DM;function v8(){if(DM)return Wd;DM=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(i,s,r){var o=null;if(r!==void 0&&(o=""+r),s.key!==void 0&&(o=""+s.key),"key"in s){r={};for(var a in s)a!=="key"&&(r[a]=s[a])}else r=s;return s=r.ref,{$$typeof:e,type:i,key:o,ref:s!==void 0?s:null,props:r}}return Wd.Fragment=t,Wd.jsx=n,Wd.jsxs=n,Wd}var OM;function y8(){return OM||(OM=1,G_.exports=v8()),G_.exports}var g=y8(),K_={exports:{}},Ye={};var jM;function b8(){if(jM)return Ye;jM=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.for("react.activity"),m=Symbol.iterator;function y(G){return G===null||typeof G!="object"?null:(G=m&&G[m]||G["@@iterator"],typeof G=="function"?G:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,_={};function w(G,J,U){this.props=G,this.context=J,this.refs=_,this.updater=U||b}w.prototype.isReactComponent={},w.prototype.setState=function(G,J){if(typeof G!="object"&&typeof G!="function"&&G!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,G,J,"setState")},w.prototype.forceUpdate=function(G){this.updater.enqueueForceUpdate(this,G,"forceUpdate")};function M(){}M.prototype=w.prototype;function R(G,J,U){this.props=G,this.context=J,this.refs=_,this.updater=U||b}var E=R.prototype=new M;E.constructor=R,S(E,w.prototype),E.isPureReactComponent=!0;var A=Array.isArray;function T(){}var L={H:null,A:null,T:null,S:null},P=Object.prototype.hasOwnProperty;function I(G,J,U){var re=U.ref;return{$$typeof:e,type:G,key:J,ref:re!==void 0?re:null,props:U}}function N(G,J){return I(G.type,J,G.props)}function O(G){return typeof G=="object"&&G!==null&&G.$$typeof===e}function j(G){var J={"=":"=0",":":"=2"};return"$"+G.replace(/[=:]/g,function(U){return J[U]})}var $=/\/+/g;function V(G,J){return typeof G=="object"&&G!==null&&G.key!=null?j(""+G.key):J.toString(36)}function H(G){switch(G.status){case"fulfilled":return G.value;case"rejected":throw G.reason;default:switch(typeof G.status=="string"?G.then(T,T):(G.status="pending",G.then(function(J){G.status==="pending"&&(G.status="fulfilled",G.value=J)},function(J){G.status==="pending"&&(G.status="rejected",G.reason=J)})),G.status){case"fulfilled":return G.value;case"rejected":throw G.reason}}throw G}function B(G,J,U,re,de){var ce=typeof G;(ce==="undefined"||ce==="boolean")&&(G=null);var ae=!1;if(G===null)ae=!0;else switch(ce){case"bigint":case"string":case"number":ae=!0;break;case"object":switch(G.$$typeof){case e:case t:ae=!0;break;case h:return ae=G._init,B(ae(G._payload),J,U,re,de)}}if(ae)return de=de(G),ae=re===""?"."+V(G,0):re,A(de)?(U="",ae!=null&&(U=ae.replace($,"$&/")+"/"),B(de,J,U,"",function(qe){return qe})):de!=null&&(O(de)&&(de=N(de,U+(de.key==null||G&&G.key===de.key?"":(""+de.key).replace($,"$&/")+"/")+ae)),J.push(de)),1;ae=0;var be=re===""?".":re+":";if(A(G))for(var Ce=0;Ce<G.length;Ce++)re=G[Ce],ce=be+V(re,Ce),ae+=B(re,J,U,ce,de);else if(Ce=y(G),typeof Ce=="function")for(G=Ce.call(G),Ce=0;!(re=G.next()).done;)re=re.value,ce=be+V(re,Ce++),ae+=B(re,J,U,ce,de);else if(ce==="object"){if(typeof G.then=="function")return B(H(G),J,U,re,de);throw J=String(G),Error("Objects are not valid as a React child (found: "+(J==="[object Object]"?"object with keys {"+Object.keys(G).join(", ")+"}":J)+"). If you meant to render a collection of children, use an array instead.")}return ae}function W(G,J,U){if(G==null)return G;var re=[],de=0;return B(G,re,"","",function(ce){return J.call(U,ce,de++)}),re}function q(G){if(G._status===-1){var J=G._result;J=J(),J.then(function(U){(G._status===0||G._status===-1)&&(G._status=1,G._result=U)},function(U){(G._status===0||G._status===-1)&&(G._status=2,G._result=U)}),G._status===-1&&(G._status=0,G._result=J)}if(G._status===1)return G._result.default;throw G._result}var ne=typeof reportError=="function"?reportError:function(G){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var J=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof G=="object"&&G!==null&&typeof G.message=="string"?String(G.message):String(G),error:G});if(!window.dispatchEvent(J))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",G);return}console.error(G)},z={map:W,forEach:function(G,J,U){W(G,function(){J.apply(this,arguments)},U)},count:function(G){var J=0;return W(G,function(){J++}),J},toArray:function(G){return W(G,function(J){return J})||[]},only:function(G){if(!O(G))throw Error("React.Children.only expected to receive a single React element child.");return G}};return Ye.Activity=f,Ye.Children=z,Ye.Component=w,Ye.Fragment=n,Ye.Profiler=s,Ye.PureComponent=R,Ye.StrictMode=i,Ye.Suspense=c,Ye.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,Ye.__COMPILER_RUNTIME={__proto__:null,c:function(G){return L.H.useMemoCache(G)}},Ye.cache=function(G){return function(){return G.apply(null,arguments)}},Ye.cacheSignal=function(){return null},Ye.cloneElement=function(G,J,U){if(G==null)throw Error("The argument must be a React element, but you passed "+G+".");var re=S({},G.props),de=G.key;if(J!=null)for(ce in J.key!==void 0&&(de=""+J.key),J)!P.call(J,ce)||ce==="key"||ce==="__self"||ce==="__source"||ce==="ref"&&J.ref===void 0||(re[ce]=J[ce]);var ce=arguments.length-2;if(ce===1)re.children=U;else if(1<ce){for(var ae=Array(ce),be=0;be<ce;be++)ae[be]=arguments[be+2];re.children=ae}return I(G.type,de,re)},Ye.createContext=function(G){return G={$$typeof:o,_currentValue:G,_currentValue2:G,_threadCount:0,Provider:null,Consumer:null},G.Provider=G,G.Consumer={$$typeof:r,_context:G},G},Ye.createElement=function(G,J,U){var re,de={},ce=null;if(J!=null)for(re in J.key!==void 0&&(ce=""+J.key),J)P.call(J,re)&&re!=="key"&&re!=="__self"&&re!=="__source"&&(de[re]=J[re]);var ae=arguments.length-2;if(ae===1)de.children=U;else if(1<ae){for(var be=Array(ae),Ce=0;Ce<ae;Ce++)be[Ce]=arguments[Ce+2];de.children=be}if(G&&G.defaultProps)for(re in ae=G.defaultProps,ae)de[re]===void 0&&(de[re]=ae[re]);return I(G,ce,de)},Ye.createRef=function(){return{current:null}},Ye.forwardRef=function(G){return{$$typeof:a,render:G}},Ye.isValidElement=O,Ye.lazy=function(G){return{$$typeof:h,_payload:{_status:-1,_result:G},_init:q}},Ye.memo=function(G,J){return{$$typeof:u,type:G,compare:J===void 0?null:J}},Ye.startTransition=function(G){var J=L.T,U={};L.T=U;try{var re=G(),de=L.S;de!==null&&de(U,re),typeof re=="object"&&re!==null&&typeof re.then=="function"&&re.then(T,ne)}catch(ce){ne(ce)}finally{J!==null&&U.types!==null&&(J.types=U.types),L.T=J}},Ye.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},Ye.use=function(G){return L.H.use(G)},Ye.useActionState=function(G,J,U){return L.H.useActionState(G,J,U)},Ye.useCallback=function(G,J){return L.H.useCallback(G,J)},Ye.useContext=function(G){return L.H.useContext(G)},Ye.useDebugValue=function(){},Ye.useDeferredValue=function(G,J){return L.H.useDeferredValue(G,J)},Ye.useEffect=function(G,J){return L.H.useEffect(G,J)},Ye.useEffectEvent=function(G){return L.H.useEffectEvent(G)},Ye.useId=function(){return L.H.useId()},Ye.useImperativeHandle=function(G,J,U){return L.H.useImperativeHandle(G,J,U)},Ye.useInsertionEffect=function(G,J){return L.H.useInsertionEffect(G,J)},Ye.useLayoutEffect=function(G,J){return L.H.useLayoutEffect(G,J)},Ye.useMemo=function(G,J){return L.H.useMemo(G,J)},Ye.useOptimistic=function(G,J){return L.H.useOptimistic(G,J)},Ye.useReducer=function(G,J,U){return L.H.useReducer(G,J,U)},Ye.useRef=function(G){return L.H.useRef(G)},Ye.useState=function(G){return L.H.useState(G)},Ye.useSyncExternalStore=function(G,J,U){return L.H.useSyncExternalStore(G,J,U)},Ye.useTransition=function(){return L.H.useTransition()},Ye.version="19.2.3",Ye}var BM;function Lf(){return BM||(BM=1,K_.exports=b8()),K_.exports}var k=Lf();const pi=Ql(k),yC=g8({__proto__:null,default:pi},[k]);var Y_={exports:{}},Gd={},X_={exports:{}},Q_={};var FM;function _8(){return FM||(FM=1,(function(e){function t(B,W){var q=B.length;B.push(W);e:for(;0<q;){var ne=q-1>>>1,z=B[ne];if(0<s(z,W))B[ne]=W,B[q]=z,q=ne;else break e}}function n(B){return B.length===0?null:B[0]}function i(B){if(B.length===0)return null;var W=B[0],q=B.pop();if(q!==W){B[0]=q;e:for(var ne=0,z=B.length,G=z>>>1;ne<G;){var J=2*(ne+1)-1,U=B[J],re=J+1,de=B[re];if(0>s(U,q))re<z&&0>s(de,U)?(B[ne]=de,B[re]=q,ne=re):(B[ne]=U,B[J]=q,ne=J);else if(re<z&&0>s(de,q))B[ne]=de,B[re]=q,ne=re;else break e}}return W}function s(B,W){var q=B.sortIndex-W.sortIndex;return q!==0?q:B.id-W.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;e.unstable_now=function(){return r.now()}}else{var o=Date,a=o.now();e.unstable_now=function(){return o.now()-a}}var c=[],u=[],h=1,f=null,m=3,y=!1,b=!1,S=!1,_=!1,w=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function E(B){for(var W=n(u);W!==null;){if(W.callback===null)i(u);else if(W.startTime<=B)i(u),W.sortIndex=W.expirationTime,t(c,W);else break;W=n(u)}}function A(B){if(S=!1,E(B),!b)if(n(c)!==null)b=!0,T||(T=!0,j());else{var W=n(u);W!==null&&H(A,W.startTime-B)}}var T=!1,L=-1,P=5,I=-1;function N(){return _?!0:!(e.unstable_now()-I<P)}function O(){if(_=!1,T){var B=e.unstable_now();I=B;var W=!0;try{e:{b=!1,S&&(S=!1,M(L),L=-1),y=!0;var q=m;try{t:{for(E(B),f=n(c);f!==null&&!(f.expirationTime>B&&N());){var ne=f.callback;if(typeof ne=="function"){f.callback=null,m=f.priorityLevel;var z=ne(f.expirationTime<=B);if(B=e.unstable_now(),typeof z=="function"){f.callback=z,E(B),W=!0;break t}f===n(c)&&i(c),E(B)}else i(c);f=n(c)}if(f!==null)W=!0;else{var G=n(u);G!==null&&H(A,G.startTime-B),W=!1}}break e}finally{f=null,m=q,y=!1}W=void 0}}finally{W?j():T=!1}}}var j;if(typeof R=="function")j=function(){R(O)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,V=$.port2;$.port1.onmessage=O,j=function(){V.postMessage(null)}}else j=function(){w(O,0)};function H(B,W){L=w(function(){B(e.unstable_now())},W)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(B){B.callback=null},e.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<B?Math.floor(1e3/B):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_next=function(B){switch(m){case 1:case 2:case 3:var W=3;break;default:W=m}var q=m;m=W;try{return B()}finally{m=q}},e.unstable_requestPaint=function(){_=!0},e.unstable_runWithPriority=function(B,W){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var q=m;m=B;try{return W()}finally{m=q}},e.unstable_scheduleCallback=function(B,W,q){var ne=e.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?ne+q:ne):q=ne,B){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=q+z,B={id:h++,callback:W,priorityLevel:B,startTime:q,expirationTime:z,sortIndex:-1},q>ne?(B.sortIndex=q,t(u,B),n(c)===null&&B===n(u)&&(S?(M(L),L=-1):S=!0,H(A,q-ne))):(B.sortIndex=z,t(c,B),b||y||(b=!0,T||(T=!0,j()))),B},e.unstable_shouldYield=N,e.unstable_wrapCallback=function(B){var W=m;return function(){var q=m;m=W;try{return B.apply(this,arguments)}finally{m=q}}}})(Q_)),Q_}var UM;function S8(){return UM||(UM=1,X_.exports=_8()),X_.exports}var J_={exports:{}},ci={};var zM;function x8(){if(zM)return ci;zM=1;var e=Lf();function t(c){var u="https://react.dev/errors/"+c;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)u+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+c+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var i={d:{f:n,r:function(){throw Error(t(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},s=Symbol.for("react.portal");function r(c,u,h){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:f==null?null:""+f,children:c,containerInfo:u,implementation:h}}var o=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(c,u){if(c==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return ci.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,ci.createPortal=function(c,u){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(t(299));return r(c,u,null,h)},ci.flushSync=function(c){var u=o.T,h=i.p;try{if(o.T=null,i.p=2,c)return c()}finally{o.T=u,i.p=h,i.d.f()}},ci.preconnect=function(c,u){typeof c=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,i.d.C(c,u))},ci.prefetchDNS=function(c){typeof c=="string"&&i.d.D(c)},ci.preinit=function(c,u){if(typeof c=="string"&&u&&typeof u.as=="string"){var h=u.as,f=a(h,u.crossOrigin),m=typeof u.integrity=="string"?u.integrity:void 0,y=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;h==="style"?i.d.S(c,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:f,integrity:m,fetchPriority:y}):h==="script"&&i.d.X(c,{crossOrigin:f,integrity:m,fetchPriority:y,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},ci.preinitModule=function(c,u){if(typeof c=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var h=a(u.as,u.crossOrigin);i.d.M(c,{crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&i.d.M(c)},ci.preload=function(c,u){if(typeof c=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var h=u.as,f=a(h,u.crossOrigin);i.d.L(c,h,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},ci.preloadModule=function(c,u){if(typeof c=="string")if(u){var h=a(u.as,u.crossOrigin);i.d.m(c,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else i.d.m(c)},ci.requestFormReset=function(c){i.d.r(c)},ci.unstable_batchedUpdates=function(c,u){return c(u)},ci.useFormState=function(c,u,h){return o.H.useFormState(c,u,h)},ci.useFormStatus=function(){return o.H.useHostTransitionStatus()},ci.version="19.2.3",ci}var $M;function Q2(){if($M)return J_.exports;$M=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),J_.exports=x8(),J_.exports}var qM;function w8(){if(qM)return Gd;qM=1;var e=S8(),t=Lf(),n=Q2();function i(l){var d="https://react.dev/errors/"+l;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+l+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function r(l){var d=l,p=l;if(l.alternate)for(;d.return;)d=d.return;else{l=d;do d=l,(d.flags&4098)!==0&&(p=d.return),l=d.return;while(l)}return d.tag===3?p:null}function o(l){if(l.tag===13){var d=l.memoizedState;if(d===null&&(l=l.alternate,l!==null&&(d=l.memoizedState)),d!==null)return d.dehydrated}return null}function a(l){if(l.tag===31){var d=l.memoizedState;if(d===null&&(l=l.alternate,l!==null&&(d=l.memoizedState)),d!==null)return d.dehydrated}return null}function c(l){if(r(l)!==l)throw Error(i(188))}function u(l){var d=l.alternate;if(!d){if(d=r(l),d===null)throw Error(i(188));return d!==l?null:l}for(var p=l,v=d;;){var x=p.return;if(x===null)break;var C=x.alternate;if(C===null){if(v=x.return,v!==null){p=v;continue}break}if(x.child===C.child){for(C=x.child;C;){if(C===p)return c(x),l;if(C===v)return c(x),d;C=C.sibling}throw Error(i(188))}if(p.return!==v.return)p=x,v=C;else{for(var D=!1,F=x.child;F;){if(F===p){D=!0,p=x,v=C;break}if(F===v){D=!0,v=x,p=C;break}F=F.sibling}if(!D){for(F=C.child;F;){if(F===p){D=!0,p=C,v=x;break}if(F===v){D=!0,v=C,p=x;break}F=F.sibling}if(!D)throw Error(i(189))}}if(p.alternate!==v)throw Error(i(190))}if(p.tag!==3)throw Error(i(188));return p.stateNode.current===p?l:d}function h(l){var d=l.tag;if(d===5||d===26||d===27||d===6)return l;for(l=l.child;l!==null;){if(d=h(l),d!==null)return d;l=l.sibling}return null}var f=Object.assign,m=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),R=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),N=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function j(l){return l===null||typeof l!="object"?null:(l=O&&l[O]||l["@@iterator"],typeof l=="function"?l:null)}var $=Symbol.for("react.client.reference");function V(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===$?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case S:return"Fragment";case w:return"Profiler";case _:return"StrictMode";case A:return"Suspense";case T:return"SuspenseList";case I:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case b:return"Portal";case R:return l.displayName||"Context";case M:return(l._context.displayName||"Context")+".Consumer";case E:var d=l.render;return l=l.displayName,l||(l=d.displayName||d.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case L:return d=l.displayName||null,d!==null?d:V(l.type)||"Memo";case P:d=l._payload,l=l._init;try{return V(l(d))}catch{}}return null}var H=Array.isArray,B=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q={pending:!1,data:null,method:null,action:null},ne=[],z=-1;function G(l){return{current:l}}function J(l){0>z||(l.current=ne[z],ne[z]=null,z--)}function U(l,d){z++,ne[z]=l.current,l.current=d}var re=G(null),de=G(null),ce=G(null),ae=G(null);function be(l,d){switch(U(ce,d),U(de,l),U(re,null),d.nodeType){case 9:case 11:l=(l=d.documentElement)&&(l=l.namespaceURI)?sM(l):0;break;default:if(l=d.tagName,d=d.namespaceURI)d=sM(d),l=rM(d,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}J(re),U(re,l)}function Ce(){J(re),J(de),J(ce)}function qe(l){l.memoizedState!==null&&U(ae,l);var d=re.current,p=rM(d,l.type);d!==p&&(U(de,l),U(re,p))}function dt(l){de.current===l&&(J(re),J(de)),ae.current===l&&(J(ae),$d._currentValue=q)}var yt,He;function We(l){if(yt===void 0)try{throw Error()}catch(p){var d=p.stack.trim().match(/\n( *(at )?)/);yt=d&&d[1]||"",He=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+yt+l+He}var Jn=!1;function Fn(l,d){if(!l||Jn)return"";Jn=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var v={DetermineComponentFrameRoot:function(){try{if(d){var he=function(){throw Error()};if(Object.defineProperty(he.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(he,[])}catch(oe){var ie=oe}Reflect.construct(l,[],he)}else{try{he.call()}catch(oe){ie=oe}l.call(he.prototype)}}else{try{throw Error()}catch(oe){ie=oe}(he=l())&&typeof he.catch=="function"&&he.catch(function(){})}}catch(oe){if(oe&&ie&&typeof oe.stack=="string")return[oe.stack,ie.stack]}return[null,null]}};v.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(v.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(v.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var C=v.DetermineComponentFrameRoot(),D=C[0],F=C[1];if(D&&F){var Y=D.split(`
`),ee=F.split(`
`);for(x=v=0;v<Y.length&&!Y[v].includes("DetermineComponentFrameRoot");)v++;for(;x<ee.length&&!ee[x].includes("DetermineComponentFrameRoot");)x++;if(v===Y.length||x===ee.length)for(v=Y.length-1,x=ee.length-1;1<=v&&0<=x&&Y[v]!==ee[x];)x--;for(;1<=v&&0<=x;v--,x--)if(Y[v]!==ee[x]){if(v!==1||x!==1)do if(v--,x--,0>x||Y[v]!==ee[x]){var le=`
`+Y[v].replace(" at new "," at ");return l.displayName&&le.includes("<anonymous>")&&(le=le.replace("<anonymous>",l.displayName)),le}while(1<=v&&0<=x);break}}}finally{Jn=!1,Error.prepareStackTrace=p}return(p=l?l.displayName||l.name:"")?We(p):""}function li(l,d){switch(l.tag){case 26:case 27:case 5:return We(l.type);case 16:return We("Lazy");case 13:return l.child!==d&&d!==null?We("Suspense Fallback"):We("Suspense");case 19:return We("SuspenseList");case 0:case 15:return Fn(l.type,!1);case 11:return Fn(l.type.render,!1);case 1:return Fn(l.type,!0);case 31:return We("Activity");default:return""}}function Be(l){try{var d="",p=null;do d+=li(l,p),p=l,l=l.return;while(l);return d}catch(v){return`
Error generating stack: `+v.message+`
`+v.stack}}var ot=Object.prototype.hasOwnProperty,De=e.unstable_scheduleCallback,Ge=e.unstable_cancelCallback,Ze=e.unstable_shouldYield,ve=e.unstable_requestPaint,Me=e.unstable_now,At=e.unstable_getCurrentPriorityLevel,se=e.unstable_ImmediatePriority,Se=e.unstable_UserBlockingPriority,Oe=e.unstable_NormalPriority,$e=e.unstable_LowPriority,Ke=e.unstable_IdlePriority,it=e.log,Nt=e.unstable_setDisableYieldValue,hn=null,Vt=null;function fn(l){if(typeof it=="function"&&Nt(l),Vt&&typeof Vt.setStrictMode=="function")try{Vt.setStrictMode(hn,l)}catch{}}var Tt=Math.clz32?Math.clz32:ac,yi=Math.log,bi=Math.LN2;function ac(l){return l>>>=0,l===0?32:31-(yi(l)/bi|0)|0}var $s=256,Gi=262144,Ki=4194304;function qs(l){var d=l&42;if(d!==0)return d;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return l&261888;case 262144:case 524288:case 1048576:case 2097152:return l&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function lc(l,d,p){var v=l.pendingLanes;if(v===0)return 0;var x=0,C=l.suspendedLanes,D=l.pingedLanes;l=l.warmLanes;var F=v&134217727;return F!==0?(v=F&~C,v!==0?x=qs(v):(D&=F,D!==0?x=qs(D):p||(p=F&~l,p!==0&&(x=qs(p))))):(F=v&~C,F!==0?x=qs(F):D!==0?x=qs(D):p||(p=v&~l,p!==0&&(x=qs(p)))),x===0?0:d!==0&&d!==x&&(d&C)===0&&(C=x&-x,p=d&-d,C>=p||C===32&&(p&4194048)!==0)?d:x}function Ka(l,d){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&d)===0}function Dy(l,d){switch(l){case 1:case 2:case 4:case 8:case 64:return d+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jf(){var l=Ki;return Ki<<=1,(Ki&62914560)===0&&(Ki=4194304),l}function Ee(l){for(var d=[],p=0;31>p;p++)d.push(l);return d}function Xe(l,d){l.pendingLanes|=d,d!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function Yi(l,d,p,v,x,C){var D=l.pendingLanes;l.pendingLanes=p,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=p,l.entangledLanes&=p,l.errorRecoveryDisabledLanes&=p,l.shellSuspendCounter=0;var F=l.entanglements,Y=l.expirationTimes,ee=l.hiddenUpdates;for(p=D&~p;0<p;){var le=31-Tt(p),he=1<<le;F[le]=0,Y[le]=-1;var ie=ee[le];if(ie!==null)for(ee[le]=null,le=0;le<ie.length;le++){var oe=ie[le];oe!==null&&(oe.lane&=-536870913)}p&=~he}v!==0&&_i(l,v,0),C!==0&&x===0&&l.tag!==0&&(l.suspendedLanes|=C&~(D&~d))}function _i(l,d,p){l.pendingLanes|=d,l.suspendedLanes&=~d;var v=31-Tt(d);l.entangledLanes|=d,l.entanglements[v]=l.entanglements[v]|1073741824|p&261930}function Hs(l,d){var p=l.entangledLanes|=d;for(l=l.entanglements;p;){var v=31-Tt(p),x=1<<v;x&d|l[v]&d&&(l[v]|=d),p&=~x}}function Ya(l,d){var p=d&-d;return p=(p&42)!==0?1:Oy(p),(p&(l.suspendedLanes|d))!==0?0:p}function Oy(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function jy(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function q1(){var l=W.p;return l!==0?l:(l=window.event,l===void 0?32:RM(l.type))}function H1(l,d){var p=W.p;try{return W.p=l,d()}finally{W.p=p}}var $o=Math.random().toString(36).slice(2),Zn="__reactFiber$"+$o,Li="__reactProps$"+$o,cc="__reactContainer$"+$o,By="__reactEvents$"+$o,rU="__reactListeners$"+$o,oU="__reactHandles$"+$o,V1="__reactResources$"+$o,id="__reactMarker$"+$o;function Fy(l){delete l[Zn],delete l[Li],delete l[By],delete l[rU],delete l[oU]}function uc(l){var d=l[Zn];if(d)return d;for(var p=l.parentNode;p;){if(d=p[cc]||p[Zn]){if(p=d.alternate,d.child!==null||p!==null&&p.child!==null)for(l=hM(l);l!==null;){if(p=l[Zn])return p;l=hM(l)}return d}l=p,p=l.parentNode}return null}function dc(l){if(l=l[Zn]||l[cc]){var d=l.tag;if(d===5||d===6||d===13||d===31||d===26||d===27||d===3)return l}return null}function sd(l){var d=l.tag;if(d===5||d===26||d===27||d===6)return l.stateNode;throw Error(i(33))}function hc(l){var d=l[V1];return d||(d=l[V1]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function Un(l){l[id]=!0}var W1=new Set,G1={};function Xa(l,d){fc(l,d),fc(l+"Capture",d)}function fc(l,d){for(G1[l]=d,l=0;l<d.length;l++)W1.add(d[l])}var aU=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),K1={},Y1={};function lU(l){return ot.call(Y1,l)?!0:ot.call(K1,l)?!1:aU.test(l)?Y1[l]=!0:(K1[l]=!0,!1)}function Zf(l,d,p){if(lU(d))if(p===null)l.removeAttribute(d);else{switch(typeof p){case"undefined":case"function":case"symbol":l.removeAttribute(d);return;case"boolean":var v=d.toLowerCase().slice(0,5);if(v!=="data-"&&v!=="aria-"){l.removeAttribute(d);return}}l.setAttribute(d,""+p)}}function ep(l,d,p){if(p===null)l.removeAttribute(d);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(d);return}l.setAttribute(d,""+p)}}function Jr(l,d,p,v){if(v===null)l.removeAttribute(p);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(p);return}l.setAttributeNS(d,p,""+v)}}function ms(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function X1(l){var d=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function cU(l,d,p){var v=Object.getOwnPropertyDescriptor(l.constructor.prototype,d);if(!l.hasOwnProperty(d)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var x=v.get,C=v.set;return Object.defineProperty(l,d,{configurable:!0,get:function(){return x.call(this)},set:function(D){p=""+D,C.call(this,D)}}),Object.defineProperty(l,d,{enumerable:v.enumerable}),{getValue:function(){return p},setValue:function(D){p=""+D},stopTracking:function(){l._valueTracker=null,delete l[d]}}}}function Uy(l){if(!l._valueTracker){var d=X1(l)?"checked":"value";l._valueTracker=cU(l,d,""+l[d])}}function Q1(l){if(!l)return!1;var d=l._valueTracker;if(!d)return!0;var p=d.getValue(),v="";return l&&(v=X1(l)?l.checked?"true":"false":l.value),l=v,l!==p?(d.setValue(l),!0):!1}function tp(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var uU=/[\n"\\]/g;function gs(l){return l.replace(uU,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function zy(l,d,p,v,x,C,D,F){l.name="",D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?l.type=D:l.removeAttribute("type"),d!=null?D==="number"?(d===0&&l.value===""||l.value!=d)&&(l.value=""+ms(d)):l.value!==""+ms(d)&&(l.value=""+ms(d)):D!=="submit"&&D!=="reset"||l.removeAttribute("value"),d!=null?$y(l,D,ms(d)):p!=null?$y(l,D,ms(p)):v!=null&&l.removeAttribute("value"),x==null&&C!=null&&(l.defaultChecked=!!C),x!=null&&(l.checked=x&&typeof x!="function"&&typeof x!="symbol"),F!=null&&typeof F!="function"&&typeof F!="symbol"&&typeof F!="boolean"?l.name=""+ms(F):l.removeAttribute("name")}function J1(l,d,p,v,x,C,D,F){if(C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"&&(l.type=C),d!=null||p!=null){if(!(C!=="submit"&&C!=="reset"||d!=null)){Uy(l);return}p=p!=null?""+ms(p):"",d=d!=null?""+ms(d):p,F||d===l.value||(l.value=d),l.defaultValue=d}v=v??x,v=typeof v!="function"&&typeof v!="symbol"&&!!v,l.checked=F?l.checked:!!v,l.defaultChecked=!!v,D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(l.name=D),Uy(l)}function $y(l,d,p){d==="number"&&tp(l.ownerDocument)===l||l.defaultValue===""+p||(l.defaultValue=""+p)}function pc(l,d,p,v){if(l=l.options,d){d={};for(var x=0;x<p.length;x++)d["$"+p[x]]=!0;for(p=0;p<l.length;p++)x=d.hasOwnProperty("$"+l[p].value),l[p].selected!==x&&(l[p].selected=x),x&&v&&(l[p].defaultSelected=!0)}else{for(p=""+ms(p),d=null,x=0;x<l.length;x++){if(l[x].value===p){l[x].selected=!0,v&&(l[x].defaultSelected=!0);return}d!==null||l[x].disabled||(d=l[x])}d!==null&&(d.selected=!0)}}function Z1(l,d,p){if(d!=null&&(d=""+ms(d),d!==l.value&&(l.value=d),p==null)){l.defaultValue!==d&&(l.defaultValue=d);return}l.defaultValue=p!=null?""+ms(p):""}function eT(l,d,p,v){if(d==null){if(v!=null){if(p!=null)throw Error(i(92));if(H(v)){if(1<v.length)throw Error(i(93));v=v[0]}p=v}p==null&&(p=""),d=p}p=ms(d),l.defaultValue=p,v=l.textContent,v===p&&v!==""&&v!==null&&(l.value=v),Uy(l)}function mc(l,d){if(d){var p=l.firstChild;if(p&&p===l.lastChild&&p.nodeType===3){p.nodeValue=d;return}}l.textContent=d}var dU=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function tT(l,d,p){var v=d.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?v?l.setProperty(d,""):d==="float"?l.cssFloat="":l[d]="":v?l.setProperty(d,p):typeof p!="number"||p===0||dU.has(d)?d==="float"?l.cssFloat=p:l[d]=(""+p).trim():l[d]=p+"px"}function nT(l,d,p){if(d!=null&&typeof d!="object")throw Error(i(62));if(l=l.style,p!=null){for(var v in p)!p.hasOwnProperty(v)||d!=null&&d.hasOwnProperty(v)||(v.indexOf("--")===0?l.setProperty(v,""):v==="float"?l.cssFloat="":l[v]="");for(var x in d)v=d[x],d.hasOwnProperty(x)&&p[x]!==v&&tT(l,x,v)}else for(var C in d)d.hasOwnProperty(C)&&tT(l,C,d[C])}function qy(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hU=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),fU=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function np(l){return fU.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}function Zr(){}var Hy=null;function Vy(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var gc=null,vc=null;function iT(l){var d=dc(l);if(d&&(l=d.stateNode)){var p=l[Li]||null;e:switch(l=d.stateNode,d.type){case"input":if(zy(l,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),d=p.name,p.type==="radio"&&d!=null){for(p=l;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+gs(""+d)+'"][type="radio"]'),d=0;d<p.length;d++){var v=p[d];if(v!==l&&v.form===l.form){var x=v[Li]||null;if(!x)throw Error(i(90));zy(v,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(d=0;d<p.length;d++)v=p[d],v.form===l.form&&Q1(v)}break e;case"textarea":Z1(l,p.value,p.defaultValue);break e;case"select":d=p.value,d!=null&&pc(l,!!p.multiple,d,!1)}}}var Wy=!1;function sT(l,d,p){if(Wy)return l(d,p);Wy=!0;try{var v=l(d);return v}finally{if(Wy=!1,(gc!==null||vc!==null)&&(qp(),gc&&(d=gc,l=vc,vc=gc=null,iT(d),l)))for(d=0;d<l.length;d++)iT(l[d])}}function rd(l,d){var p=l.stateNode;if(p===null)return null;var v=p[Li]||null;if(v===null)return null;p=v[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(l=l.type,v=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!v;break e;default:l=!1}if(l)return null;if(p&&typeof p!="function")throw Error(i(231,d,typeof p));return p}var eo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Gy=!1;if(eo)try{var od={};Object.defineProperty(od,"passive",{get:function(){Gy=!0}}),window.addEventListener("test",od,od),window.removeEventListener("test",od,od)}catch{Gy=!1}var qo=null,Ky=null,ip=null;function rT(){if(ip)return ip;var l,d=Ky,p=d.length,v,x="value"in qo?qo.value:qo.textContent,C=x.length;for(l=0;l<p&&d[l]===x[l];l++);var D=p-l;for(v=1;v<=D&&d[p-v]===x[C-v];v++);return ip=x.slice(l,1<v?1-v:void 0)}function sp(l){var d=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&d===13&&(l=13)):l=d,l===10&&(l=13),32<=l||l===13?l:0}function rp(){return!0}function oT(){return!1}function Ni(l){function d(p,v,x,C,D){this._reactName=p,this._targetInst=x,this.type=v,this.nativeEvent=C,this.target=D,this.currentTarget=null;for(var F in l)l.hasOwnProperty(F)&&(p=l[F],this[F]=p?p(C):C[F]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?rp:oT,this.isPropagationStopped=oT,this}return f(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=rp)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=rp)},persist:function(){},isPersistent:rp}),d}var Qa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},op=Ni(Qa),ad=f({},Qa,{view:0,detail:0}),pU=Ni(ad),Yy,Xy,ld,ap=f({},ad,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jy,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==ld&&(ld&&l.type==="mousemove"?(Yy=l.screenX-ld.screenX,Xy=l.screenY-ld.screenY):Xy=Yy=0,ld=l),Yy)},movementY:function(l){return"movementY"in l?l.movementY:Xy}}),aT=Ni(ap),mU=f({},ap,{dataTransfer:0}),gU=Ni(mU),vU=f({},ad,{relatedTarget:0}),Qy=Ni(vU),yU=f({},Qa,{animationName:0,elapsedTime:0,pseudoElement:0}),bU=Ni(yU),_U=f({},Qa,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),SU=Ni(_U),xU=f({},Qa,{data:0}),lT=Ni(xU),wU={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},CU={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kU={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function TU(l){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(l):(l=kU[l])?!!d[l]:!1}function Jy(){return TU}var EU=f({},ad,{key:function(l){if(l.key){var d=wU[l.key]||l.key;if(d!=="Unidentified")return d}return l.type==="keypress"?(l=sp(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?CU[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jy,charCode:function(l){return l.type==="keypress"?sp(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?sp(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),RU=Ni(EU),MU=f({},ap,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cT=Ni(MU),AU=f({},ad,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jy}),PU=Ni(AU),LU=f({},Qa,{propertyName:0,elapsedTime:0,pseudoElement:0}),NU=Ni(LU),IU=f({},ap,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),DU=Ni(IU),OU=f({},Qa,{newState:0,oldState:0}),jU=Ni(OU),BU=[9,13,27,32],Zy=eo&&"CompositionEvent"in window,cd=null;eo&&"documentMode"in document&&(cd=document.documentMode);var FU=eo&&"TextEvent"in window&&!cd,uT=eo&&(!Zy||cd&&8<cd&&11>=cd),dT=" ",hT=!1;function fT(l,d){switch(l){case"keyup":return BU.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pT(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var yc=!1;function UU(l,d){switch(l){case"compositionend":return pT(d);case"keypress":return d.which!==32?null:(hT=!0,dT);case"textInput":return l=d.data,l===dT&&hT?null:l;default:return null}}function zU(l,d){if(yc)return l==="compositionend"||!Zy&&fT(l,d)?(l=rT(),ip=Ky=qo=null,yc=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return uT&&d.locale!=="ko"?null:d.data;default:return null}}var $U={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mT(l){var d=l&&l.nodeName&&l.nodeName.toLowerCase();return d==="input"?!!$U[l.type]:d==="textarea"}function gT(l,d,p,v){gc?vc?vc.push(v):vc=[v]:gc=v,d=Xp(d,"onChange"),0<d.length&&(p=new op("onChange","change",null,p,v),l.push({event:p,listeners:d}))}var ud=null,dd=null;function qU(l){JR(l,0)}function lp(l){var d=sd(l);if(Q1(d))return l}function vT(l,d){if(l==="change")return d}var yT=!1;if(eo){var eb;if(eo){var tb="oninput"in document;if(!tb){var bT=document.createElement("div");bT.setAttribute("oninput","return;"),tb=typeof bT.oninput=="function"}eb=tb}else eb=!1;yT=eb&&(!document.documentMode||9<document.documentMode)}function _T(){ud&&(ud.detachEvent("onpropertychange",ST),dd=ud=null)}function ST(l){if(l.propertyName==="value"&&lp(dd)){var d=[];gT(d,dd,l,Vy(l)),sT(qU,d)}}function HU(l,d,p){l==="focusin"?(_T(),ud=d,dd=p,ud.attachEvent("onpropertychange",ST)):l==="focusout"&&_T()}function VU(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return lp(dd)}function WU(l,d){if(l==="click")return lp(d)}function GU(l,d){if(l==="input"||l==="change")return lp(d)}function KU(l,d){return l===d&&(l!==0||1/l===1/d)||l!==l&&d!==d}var Xi=typeof Object.is=="function"?Object.is:KU;function hd(l,d){if(Xi(l,d))return!0;if(typeof l!="object"||l===null||typeof d!="object"||d===null)return!1;var p=Object.keys(l),v=Object.keys(d);if(p.length!==v.length)return!1;for(v=0;v<p.length;v++){var x=p[v];if(!ot.call(d,x)||!Xi(l[x],d[x]))return!1}return!0}function xT(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function wT(l,d){var p=xT(l);l=0;for(var v;p;){if(p.nodeType===3){if(v=l+p.textContent.length,l<=d&&v>=d)return{node:p,offset:d-l};l=v}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=xT(p)}}function CT(l,d){return l&&d?l===d?!0:l&&l.nodeType===3?!1:d&&d.nodeType===3?CT(l,d.parentNode):"contains"in l?l.contains(d):l.compareDocumentPosition?!!(l.compareDocumentPosition(d)&16):!1:!1}function kT(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var d=tp(l.document);d instanceof l.HTMLIFrameElement;){try{var p=typeof d.contentWindow.location.href=="string"}catch{p=!1}if(p)l=d.contentWindow;else break;d=tp(l.document)}return d}function nb(l){var d=l&&l.nodeName&&l.nodeName.toLowerCase();return d&&(d==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||d==="textarea"||l.contentEditable==="true")}var YU=eo&&"documentMode"in document&&11>=document.documentMode,bc=null,ib=null,fd=null,sb=!1;function TT(l,d,p){var v=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;sb||bc==null||bc!==tp(v)||(v=bc,"selectionStart"in v&&nb(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),fd&&hd(fd,v)||(fd=v,v=Xp(ib,"onSelect"),0<v.length&&(d=new op("onSelect","select",null,d,p),l.push({event:d,listeners:v}),d.target=bc)))}function Ja(l,d){var p={};return p[l.toLowerCase()]=d.toLowerCase(),p["Webkit"+l]="webkit"+d,p["Moz"+l]="moz"+d,p}var _c={animationend:Ja("Animation","AnimationEnd"),animationiteration:Ja("Animation","AnimationIteration"),animationstart:Ja("Animation","AnimationStart"),transitionrun:Ja("Transition","TransitionRun"),transitionstart:Ja("Transition","TransitionStart"),transitioncancel:Ja("Transition","TransitionCancel"),transitionend:Ja("Transition","TransitionEnd")},rb={},ET={};eo&&(ET=document.createElement("div").style,"AnimationEvent"in window||(delete _c.animationend.animation,delete _c.animationiteration.animation,delete _c.animationstart.animation),"TransitionEvent"in window||delete _c.transitionend.transition);function Za(l){if(rb[l])return rb[l];if(!_c[l])return l;var d=_c[l],p;for(p in d)if(d.hasOwnProperty(p)&&p in ET)return rb[l]=d[p];return l}var RT=Za("animationend"),MT=Za("animationiteration"),AT=Za("animationstart"),XU=Za("transitionrun"),QU=Za("transitionstart"),JU=Za("transitioncancel"),PT=Za("transitionend"),LT=new Map,ob="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ob.push("scrollEnd");function Vs(l,d){LT.set(l,d),Xa(d,[l])}var cp=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)},vs=[],Sc=0,ab=0;function up(){for(var l=Sc,d=ab=Sc=0;d<l;){var p=vs[d];vs[d++]=null;var v=vs[d];vs[d++]=null;var x=vs[d];vs[d++]=null;var C=vs[d];if(vs[d++]=null,v!==null&&x!==null){var D=v.pending;D===null?x.next=x:(x.next=D.next,D.next=x),v.pending=x}C!==0&&NT(p,x,C)}}function dp(l,d,p,v){vs[Sc++]=l,vs[Sc++]=d,vs[Sc++]=p,vs[Sc++]=v,ab|=v,l.lanes|=v,l=l.alternate,l!==null&&(l.lanes|=v)}function lb(l,d,p,v){return dp(l,d,p,v),hp(l)}function el(l,d){return dp(l,null,null,d),hp(l)}function NT(l,d,p){l.lanes|=p;var v=l.alternate;v!==null&&(v.lanes|=p);for(var x=!1,C=l.return;C!==null;)C.childLanes|=p,v=C.alternate,v!==null&&(v.childLanes|=p),C.tag===22&&(l=C.stateNode,l===null||l._visibility&1||(x=!0)),l=C,C=C.return;return l.tag===3?(C=l.stateNode,x&&d!==null&&(x=31-Tt(p),l=C.hiddenUpdates,v=l[x],v===null?l[x]=[d]:v.push(d),d.lane=p|536870912),C):null}function hp(l){if(50<Dd)throw Dd=0,v_=null,Error(i(185));for(var d=l.return;d!==null;)l=d,d=l.return;return l.tag===3?l.stateNode:null}var xc={};function ZU(l,d,p,v){this.tag=l,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qi(l,d,p,v){return new ZU(l,d,p,v)}function cb(l){return l=l.prototype,!(!l||!l.isReactComponent)}function to(l,d){var p=l.alternate;return p===null?(p=Qi(l.tag,d,l.key,l.mode),p.elementType=l.elementType,p.type=l.type,p.stateNode=l.stateNode,p.alternate=l,l.alternate=p):(p.pendingProps=d,p.type=l.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=l.flags&65011712,p.childLanes=l.childLanes,p.lanes=l.lanes,p.child=l.child,p.memoizedProps=l.memoizedProps,p.memoizedState=l.memoizedState,p.updateQueue=l.updateQueue,d=l.dependencies,p.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},p.sibling=l.sibling,p.index=l.index,p.ref=l.ref,p.refCleanup=l.refCleanup,p}function IT(l,d){l.flags&=65011714;var p=l.alternate;return p===null?(l.childLanes=0,l.lanes=d,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=p.childLanes,l.lanes=p.lanes,l.child=p.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=p.memoizedProps,l.memoizedState=p.memoizedState,l.updateQueue=p.updateQueue,l.type=p.type,d=p.dependencies,l.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),l}function fp(l,d,p,v,x,C){var D=0;if(v=l,typeof l=="function")cb(l)&&(D=1);else if(typeof l=="string")D=s8(l,p,re.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case I:return l=Qi(31,p,d,x),l.elementType=I,l.lanes=C,l;case S:return tl(p.children,x,C,d);case _:D=8,x|=24;break;case w:return l=Qi(12,p,d,x|2),l.elementType=w,l.lanes=C,l;case A:return l=Qi(13,p,d,x),l.elementType=A,l.lanes=C,l;case T:return l=Qi(19,p,d,x),l.elementType=T,l.lanes=C,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case R:D=10;break e;case M:D=9;break e;case E:D=11;break e;case L:D=14;break e;case P:D=16,v=null;break e}D=29,p=Error(i(130,l===null?"null":typeof l,"")),v=null}return d=Qi(D,p,d,x),d.elementType=l,d.type=v,d.lanes=C,d}function tl(l,d,p,v){return l=Qi(7,l,v,d),l.lanes=p,l}function ub(l,d,p){return l=Qi(6,l,null,d),l.lanes=p,l}function DT(l){var d=Qi(18,null,null,0);return d.stateNode=l,d}function db(l,d,p){return d=Qi(4,l.children!==null?l.children:[],l.key,d),d.lanes=p,d.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},d}var OT=new WeakMap;function ys(l,d){if(typeof l=="object"&&l!==null){var p=OT.get(l);return p!==void 0?p:(d={value:l,source:d,stack:Be(d)},OT.set(l,d),d)}return{value:l,source:d,stack:Be(d)}}var wc=[],Cc=0,pp=null,pd=0,bs=[],_s=0,Ho=null,yr=1,br="";function no(l,d){wc[Cc++]=pd,wc[Cc++]=pp,pp=l,pd=d}function jT(l,d,p){bs[_s++]=yr,bs[_s++]=br,bs[_s++]=Ho,Ho=l;var v=yr;l=br;var x=32-Tt(v)-1;v&=~(1<<x),p+=1;var C=32-Tt(d)+x;if(30<C){var D=x-x%5;C=(v&(1<<D)-1).toString(32),v>>=D,x-=D,yr=1<<32-Tt(d)+x|p<<x|v,br=C+l}else yr=1<<C|p<<x|v,br=l}function hb(l){l.return!==null&&(no(l,1),jT(l,1,0))}function fb(l){for(;l===pp;)pp=wc[--Cc],wc[Cc]=null,pd=wc[--Cc],wc[Cc]=null;for(;l===Ho;)Ho=bs[--_s],bs[_s]=null,br=bs[--_s],bs[_s]=null,yr=bs[--_s],bs[_s]=null}function BT(l,d){bs[_s++]=yr,bs[_s++]=br,bs[_s++]=Ho,yr=d.id,br=d.overflow,Ho=l}var ei=null,Gt=null,St=!1,Vo=null,Ss=!1,pb=Error(i(519));function Wo(l){var d=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw md(ys(d,l)),pb}function FT(l){var d=l.stateNode,p=l.type,v=l.memoizedProps;switch(d[Zn]=l,d[Li]=v,p){case"dialog":ft("cancel",d),ft("close",d);break;case"iframe":case"object":case"embed":ft("load",d);break;case"video":case"audio":for(p=0;p<jd.length;p++)ft(jd[p],d);break;case"source":ft("error",d);break;case"img":case"image":case"link":ft("error",d),ft("load",d);break;case"details":ft("toggle",d);break;case"input":ft("invalid",d),J1(d,v.value,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name,!0);break;case"select":ft("invalid",d);break;case"textarea":ft("invalid",d),eT(d,v.value,v.defaultValue,v.children)}p=v.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||d.textContent===""+p||v.suppressHydrationWarning===!0||nM(d.textContent,p)?(v.popover!=null&&(ft("beforetoggle",d),ft("toggle",d)),v.onScroll!=null&&ft("scroll",d),v.onScrollEnd!=null&&ft("scrollend",d),v.onClick!=null&&(d.onclick=Zr),d=!0):d=!1,d||Wo(l,!0)}function UT(l){for(ei=l.return;ei;)switch(ei.tag){case 5:case 31:case 13:Ss=!1;return;case 27:case 3:Ss=!0;return;default:ei=ei.return}}function kc(l){if(l!==ei)return!1;if(!St)return UT(l),St=!0,!1;var d=l.tag,p;if((p=d!==3&&d!==27)&&((p=d===5)&&(p=l.type,p=!(p!=="form"&&p!=="button")||L_(l.type,l.memoizedProps)),p=!p),p&&Gt&&Wo(l),UT(l),d===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(i(317));Gt=dM(l)}else if(d===31){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(i(317));Gt=dM(l)}else d===27?(d=Gt,oa(l.type)?(l=j_,j_=null,Gt=l):Gt=d):Gt=ei?ws(l.stateNode.nextSibling):null;return!0}function nl(){Gt=ei=null,St=!1}function mb(){var l=Vo;return l!==null&&(ji===null?ji=l:ji.push.apply(ji,l),Vo=null),l}function md(l){Vo===null?Vo=[l]:Vo.push(l)}var gb=G(null),il=null,io=null;function Go(l,d,p){U(gb,d._currentValue),d._currentValue=p}function so(l){l._currentValue=gb.current,J(gb)}function vb(l,d,p){for(;l!==null;){var v=l.alternate;if((l.childLanes&d)!==d?(l.childLanes|=d,v!==null&&(v.childLanes|=d)):v!==null&&(v.childLanes&d)!==d&&(v.childLanes|=d),l===p)break;l=l.return}}function yb(l,d,p,v){var x=l.child;for(x!==null&&(x.return=l);x!==null;){var C=x.dependencies;if(C!==null){var D=x.child;C=C.firstContext;e:for(;C!==null;){var F=C;C=x;for(var Y=0;Y<d.length;Y++)if(F.context===d[Y]){C.lanes|=p,F=C.alternate,F!==null&&(F.lanes|=p),vb(C.return,p,l),v||(D=null);break e}C=F.next}}else if(x.tag===18){if(D=x.return,D===null)throw Error(i(341));D.lanes|=p,C=D.alternate,C!==null&&(C.lanes|=p),vb(D,p,l),D=null}else D=x.child;if(D!==null)D.return=x;else for(D=x;D!==null;){if(D===l){D=null;break}if(x=D.sibling,x!==null){x.return=D.return,D=x;break}D=D.return}x=D}}function Tc(l,d,p,v){l=null;for(var x=d,C=!1;x!==null;){if(!C){if((x.flags&524288)!==0)C=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var D=x.alternate;if(D===null)throw Error(i(387));if(D=D.memoizedProps,D!==null){var F=x.type;Xi(x.pendingProps.value,D.value)||(l!==null?l.push(F):l=[F])}}else if(x===ae.current){if(D=x.alternate,D===null)throw Error(i(387));D.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(l!==null?l.push($d):l=[$d])}x=x.return}l!==null&&yb(d,l,p,v),d.flags|=262144}function mp(l){for(l=l.firstContext;l!==null;){if(!Xi(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function sl(l){il=l,io=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function ti(l){return zT(il,l)}function gp(l,d){return il===null&&sl(l),zT(l,d)}function zT(l,d){var p=d._currentValue;if(d={context:d,memoizedValue:p,next:null},io===null){if(l===null)throw Error(i(308));io=d,l.dependencies={lanes:0,firstContext:d},l.flags|=524288}else io=io.next=d;return p}var ez=typeof AbortController<"u"?AbortController:function(){var l=[],d=this.signal={aborted:!1,addEventListener:function(p,v){l.push(v)}};this.abort=function(){d.aborted=!0,l.forEach(function(p){return p()})}},tz=e.unstable_scheduleCallback,nz=e.unstable_NormalPriority,Sn={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function bb(){return{controller:new ez,data:new Map,refCount:0}}function gd(l){l.refCount--,l.refCount===0&&tz(nz,function(){l.controller.abort()})}var vd=null,_b=0,Ec=0,Rc=null;function iz(l,d){if(vd===null){var p=vd=[];_b=0,Ec=w_(),Rc={status:"pending",value:void 0,then:function(v){p.push(v)}}}return _b++,d.then($T,$T),d}function $T(){if(--_b===0&&vd!==null){Rc!==null&&(Rc.status="fulfilled");var l=vd;vd=null,Ec=0,Rc=null;for(var d=0;d<l.length;d++)(0,l[d])()}}function sz(l,d){var p=[],v={status:"pending",value:null,reason:null,then:function(x){p.push(x)}};return l.then(function(){v.status="fulfilled",v.value=d;for(var x=0;x<p.length;x++)(0,p[x])(d)},function(x){for(v.status="rejected",v.reason=x,x=0;x<p.length;x++)(0,p[x])(void 0)}),v}var qT=B.S;B.S=function(l,d){TR=Me(),typeof d=="object"&&d!==null&&typeof d.then=="function"&&iz(l,d),qT!==null&&qT(l,d)};var rl=G(null);function Sb(){var l=rl.current;return l!==null?l:$t.pooledCache}function vp(l,d){d===null?U(rl,rl.current):U(rl,d.pool)}function HT(){var l=Sb();return l===null?null:{parent:Sn._currentValue,pool:l}}var Mc=Error(i(460)),xb=Error(i(474)),yp=Error(i(542)),bp={then:function(){}};function VT(l){return l=l.status,l==="fulfilled"||l==="rejected"}function WT(l,d,p){switch(p=l[p],p===void 0?l.push(d):p!==d&&(d.then(Zr,Zr),d=p),d.status){case"fulfilled":return d.value;case"rejected":throw l=d.reason,KT(l),l;default:if(typeof d.status=="string")d.then(Zr,Zr);else{if(l=$t,l!==null&&100<l.shellSuspendCounter)throw Error(i(482));l=d,l.status="pending",l.then(function(v){if(d.status==="pending"){var x=d;x.status="fulfilled",x.value=v}},function(v){if(d.status==="pending"){var x=d;x.status="rejected",x.reason=v}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw l=d.reason,KT(l),l}throw al=d,Mc}}function ol(l){try{var d=l._init;return d(l._payload)}catch(p){throw p!==null&&typeof p=="object"&&typeof p.then=="function"?(al=p,Mc):p}}var al=null;function GT(){if(al===null)throw Error(i(459));var l=al;return al=null,l}function KT(l){if(l===Mc||l===yp)throw Error(i(483))}var Ac=null,yd=0;function _p(l){var d=yd;return yd+=1,Ac===null&&(Ac=[]),WT(Ac,l,d)}function bd(l,d){d=d.props.ref,l.ref=d!==void 0?d:null}function Sp(l,d){throw d.$$typeof===m?Error(i(525)):(l=Object.prototype.toString.call(d),Error(i(31,l==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":l)))}function YT(l){function d(Q,X){if(l){var Z=Q.deletions;Z===null?(Q.deletions=[X],Q.flags|=16):Z.push(X)}}function p(Q,X){if(!l)return null;for(;X!==null;)d(Q,X),X=X.sibling;return null}function v(Q){for(var X=new Map;Q!==null;)Q.key!==null?X.set(Q.key,Q):X.set(Q.index,Q),Q=Q.sibling;return X}function x(Q,X){return Q=to(Q,X),Q.index=0,Q.sibling=null,Q}function C(Q,X,Z){return Q.index=Z,l?(Z=Q.alternate,Z!==null?(Z=Z.index,Z<X?(Q.flags|=67108866,X):Z):(Q.flags|=67108866,X)):(Q.flags|=1048576,X)}function D(Q){return l&&Q.alternate===null&&(Q.flags|=67108866),Q}function F(Q,X,Z,ue){return X===null||X.tag!==6?(X=ub(Z,Q.mode,ue),X.return=Q,X):(X=x(X,Z),X.return=Q,X)}function Y(Q,X,Z,ue){var je=Z.type;return je===S?le(Q,X,Z.props.children,ue,Z.key):X!==null&&(X.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===P&&ol(je)===X.type)?(X=x(X,Z.props),bd(X,Z),X.return=Q,X):(X=fp(Z.type,Z.key,Z.props,null,Q.mode,ue),bd(X,Z),X.return=Q,X)}function ee(Q,X,Z,ue){return X===null||X.tag!==4||X.stateNode.containerInfo!==Z.containerInfo||X.stateNode.implementation!==Z.implementation?(X=db(Z,Q.mode,ue),X.return=Q,X):(X=x(X,Z.children||[]),X.return=Q,X)}function le(Q,X,Z,ue,je){return X===null||X.tag!==7?(X=tl(Z,Q.mode,ue,je),X.return=Q,X):(X=x(X,Z),X.return=Q,X)}function he(Q,X,Z){if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return X=ub(""+X,Q.mode,Z),X.return=Q,X;if(typeof X=="object"&&X!==null){switch(X.$$typeof){case y:return Z=fp(X.type,X.key,X.props,null,Q.mode,Z),bd(Z,X),Z.return=Q,Z;case b:return X=db(X,Q.mode,Z),X.return=Q,X;case P:return X=ol(X),he(Q,X,Z)}if(H(X)||j(X))return X=tl(X,Q.mode,Z,null),X.return=Q,X;if(typeof X.then=="function")return he(Q,_p(X),Z);if(X.$$typeof===R)return he(Q,gp(Q,X),Z);Sp(Q,X)}return null}function ie(Q,X,Z,ue){var je=X!==null?X.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return je!==null?null:F(Q,X,""+Z,ue);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case y:return Z.key===je?Y(Q,X,Z,ue):null;case b:return Z.key===je?ee(Q,X,Z,ue):null;case P:return Z=ol(Z),ie(Q,X,Z,ue)}if(H(Z)||j(Z))return je!==null?null:le(Q,X,Z,ue,null);if(typeof Z.then=="function")return ie(Q,X,_p(Z),ue);if(Z.$$typeof===R)return ie(Q,X,gp(Q,Z),ue);Sp(Q,Z)}return null}function oe(Q,X,Z,ue,je){if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return Q=Q.get(Z)||null,F(X,Q,""+ue,je);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case y:return Q=Q.get(ue.key===null?Z:ue.key)||null,Y(X,Q,ue,je);case b:return Q=Q.get(ue.key===null?Z:ue.key)||null,ee(X,Q,ue,je);case P:return ue=ol(ue),oe(Q,X,Z,ue,je)}if(H(ue)||j(ue))return Q=Q.get(Z)||null,le(X,Q,ue,je,null);if(typeof ue.then=="function")return oe(Q,X,Z,_p(ue),je);if(ue.$$typeof===R)return oe(Q,X,Z,gp(X,ue),je);Sp(X,ue)}return null}function Ae(Q,X,Z,ue){for(var je=null,Et=null,Ne=X,et=X=0,_t=null;Ne!==null&&et<Z.length;et++){Ne.index>et?(_t=Ne,Ne=null):_t=Ne.sibling;var Rt=ie(Q,Ne,Z[et],ue);if(Rt===null){Ne===null&&(Ne=_t);break}l&&Ne&&Rt.alternate===null&&d(Q,Ne),X=C(Rt,X,et),Et===null?je=Rt:Et.sibling=Rt,Et=Rt,Ne=_t}if(et===Z.length)return p(Q,Ne),St&&no(Q,et),je;if(Ne===null){for(;et<Z.length;et++)Ne=he(Q,Z[et],ue),Ne!==null&&(X=C(Ne,X,et),Et===null?je=Ne:Et.sibling=Ne,Et=Ne);return St&&no(Q,et),je}for(Ne=v(Ne);et<Z.length;et++)_t=oe(Ne,Q,et,Z[et],ue),_t!==null&&(l&&_t.alternate!==null&&Ne.delete(_t.key===null?et:_t.key),X=C(_t,X,et),Et===null?je=_t:Et.sibling=_t,Et=_t);return l&&Ne.forEach(function(da){return d(Q,da)}),St&&no(Q,et),je}function Ue(Q,X,Z,ue){if(Z==null)throw Error(i(151));for(var je=null,Et=null,Ne=X,et=X=0,_t=null,Rt=Z.next();Ne!==null&&!Rt.done;et++,Rt=Z.next()){Ne.index>et?(_t=Ne,Ne=null):_t=Ne.sibling;var da=ie(Q,Ne,Rt.value,ue);if(da===null){Ne===null&&(Ne=_t);break}l&&Ne&&da.alternate===null&&d(Q,Ne),X=C(da,X,et),Et===null?je=da:Et.sibling=da,Et=da,Ne=_t}if(Rt.done)return p(Q,Ne),St&&no(Q,et),je;if(Ne===null){for(;!Rt.done;et++,Rt=Z.next())Rt=he(Q,Rt.value,ue),Rt!==null&&(X=C(Rt,X,et),Et===null?je=Rt:Et.sibling=Rt,Et=Rt);return St&&no(Q,et),je}for(Ne=v(Ne);!Rt.done;et++,Rt=Z.next())Rt=oe(Ne,Q,et,Rt.value,ue),Rt!==null&&(l&&Rt.alternate!==null&&Ne.delete(Rt.key===null?et:Rt.key),X=C(Rt,X,et),Et===null?je=Rt:Et.sibling=Rt,Et=Rt);return l&&Ne.forEach(function(m8){return d(Q,m8)}),St&&no(Q,et),je}function Ft(Q,X,Z,ue){if(typeof Z=="object"&&Z!==null&&Z.type===S&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case y:e:{for(var je=Z.key;X!==null;){if(X.key===je){if(je=Z.type,je===S){if(X.tag===7){p(Q,X.sibling),ue=x(X,Z.props.children),ue.return=Q,Q=ue;break e}}else if(X.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===P&&ol(je)===X.type){p(Q,X.sibling),ue=x(X,Z.props),bd(ue,Z),ue.return=Q,Q=ue;break e}p(Q,X);break}else d(Q,X);X=X.sibling}Z.type===S?(ue=tl(Z.props.children,Q.mode,ue,Z.key),ue.return=Q,Q=ue):(ue=fp(Z.type,Z.key,Z.props,null,Q.mode,ue),bd(ue,Z),ue.return=Q,Q=ue)}return D(Q);case b:e:{for(je=Z.key;X!==null;){if(X.key===je)if(X.tag===4&&X.stateNode.containerInfo===Z.containerInfo&&X.stateNode.implementation===Z.implementation){p(Q,X.sibling),ue=x(X,Z.children||[]),ue.return=Q,Q=ue;break e}else{p(Q,X);break}else d(Q,X);X=X.sibling}ue=db(Z,Q.mode,ue),ue.return=Q,Q=ue}return D(Q);case P:return Z=ol(Z),Ft(Q,X,Z,ue)}if(H(Z))return Ae(Q,X,Z,ue);if(j(Z)){if(je=j(Z),typeof je!="function")throw Error(i(150));return Z=je.call(Z),Ue(Q,X,Z,ue)}if(typeof Z.then=="function")return Ft(Q,X,_p(Z),ue);if(Z.$$typeof===R)return Ft(Q,X,gp(Q,Z),ue);Sp(Q,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint"?(Z=""+Z,X!==null&&X.tag===6?(p(Q,X.sibling),ue=x(X,Z),ue.return=Q,Q=ue):(p(Q,X),ue=ub(Z,Q.mode,ue),ue.return=Q,Q=ue),D(Q)):p(Q,X)}return function(Q,X,Z,ue){try{yd=0;var je=Ft(Q,X,Z,ue);return Ac=null,je}catch(Ne){if(Ne===Mc||Ne===yp)throw Ne;var Et=Qi(29,Ne,null,Q.mode);return Et.lanes=ue,Et.return=Q,Et}}}var ll=YT(!0),XT=YT(!1),Ko=!1;function wb(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Cb(l,d){l=l.updateQueue,d.updateQueue===l&&(d.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function Yo(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function Xo(l,d,p){var v=l.updateQueue;if(v===null)return null;if(v=v.shared,(Pt&2)!==0){var x=v.pending;return x===null?d.next=d:(d.next=x.next,x.next=d),v.pending=d,d=hp(l),NT(l,null,p),d}return dp(l,v,d,p),hp(l)}function _d(l,d,p){if(d=d.updateQueue,d!==null&&(d=d.shared,(p&4194048)!==0)){var v=d.lanes;v&=l.pendingLanes,p|=v,d.lanes=p,Hs(l,p)}}function kb(l,d){var p=l.updateQueue,v=l.alternate;if(v!==null&&(v=v.updateQueue,p===v)){var x=null,C=null;if(p=p.firstBaseUpdate,p!==null){do{var D={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};C===null?x=C=D:C=C.next=D,p=p.next}while(p!==null);C===null?x=C=d:C=C.next=d}else x=C=d;p={baseState:v.baseState,firstBaseUpdate:x,lastBaseUpdate:C,shared:v.shared,callbacks:v.callbacks},l.updateQueue=p;return}l=p.lastBaseUpdate,l===null?p.firstBaseUpdate=d:l.next=d,p.lastBaseUpdate=d}var Tb=!1;function Sd(){if(Tb){var l=Rc;if(l!==null)throw l}}function xd(l,d,p,v){Tb=!1;var x=l.updateQueue;Ko=!1;var C=x.firstBaseUpdate,D=x.lastBaseUpdate,F=x.shared.pending;if(F!==null){x.shared.pending=null;var Y=F,ee=Y.next;Y.next=null,D===null?C=ee:D.next=ee,D=Y;var le=l.alternate;le!==null&&(le=le.updateQueue,F=le.lastBaseUpdate,F!==D&&(F===null?le.firstBaseUpdate=ee:F.next=ee,le.lastBaseUpdate=Y))}if(C!==null){var he=x.baseState;D=0,le=ee=Y=null,F=C;do{var ie=F.lane&-536870913,oe=ie!==F.lane;if(oe?(bt&ie)===ie:(v&ie)===ie){ie!==0&&ie===Ec&&(Tb=!0),le!==null&&(le=le.next={lane:0,tag:F.tag,payload:F.payload,callback:null,next:null});e:{var Ae=l,Ue=F;ie=d;var Ft=p;switch(Ue.tag){case 1:if(Ae=Ue.payload,typeof Ae=="function"){he=Ae.call(Ft,he,ie);break e}he=Ae;break e;case 3:Ae.flags=Ae.flags&-65537|128;case 0:if(Ae=Ue.payload,ie=typeof Ae=="function"?Ae.call(Ft,he,ie):Ae,ie==null)break e;he=f({},he,ie);break e;case 2:Ko=!0}}ie=F.callback,ie!==null&&(l.flags|=64,oe&&(l.flags|=8192),oe=x.callbacks,oe===null?x.callbacks=[ie]:oe.push(ie))}else oe={lane:ie,tag:F.tag,payload:F.payload,callback:F.callback,next:null},le===null?(ee=le=oe,Y=he):le=le.next=oe,D|=ie;if(F=F.next,F===null){if(F=x.shared.pending,F===null)break;oe=F,F=oe.next,oe.next=null,x.lastBaseUpdate=oe,x.shared.pending=null}}while(!0);le===null&&(Y=he),x.baseState=Y,x.firstBaseUpdate=ee,x.lastBaseUpdate=le,C===null&&(x.shared.lanes=0),ta|=D,l.lanes=D,l.memoizedState=he}}function QT(l,d){if(typeof l!="function")throw Error(i(191,l));l.call(d)}function JT(l,d){var p=l.callbacks;if(p!==null)for(l.callbacks=null,l=0;l<p.length;l++)QT(p[l],d)}var Pc=G(null),xp=G(0);function ZT(l,d){l=po,U(xp,l),U(Pc,d),po=l|d.baseLanes}function Eb(){U(xp,po),U(Pc,Pc.current)}function Rb(){po=xp.current,J(Pc),J(xp)}var Ji=G(null),xs=null;function Qo(l){var d=l.alternate;U(pn,pn.current&1),U(Ji,l),xs===null&&(d===null||Pc.current!==null||d.memoizedState!==null)&&(xs=l)}function Mb(l){U(pn,pn.current),U(Ji,l),xs===null&&(xs=l)}function eE(l){l.tag===22?(U(pn,pn.current),U(Ji,l),xs===null&&(xs=l)):Jo()}function Jo(){U(pn,pn.current),U(Ji,Ji.current)}function Zi(l){J(Ji),xs===l&&(xs=null),J(pn)}var pn=G(0);function wp(l){for(var d=l;d!==null;){if(d.tag===13){var p=d.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||D_(p)||O_(p)))return d}else if(d.tag===19&&(d.memoizedProps.revealOrder==="forwards"||d.memoizedProps.revealOrder==="backwards"||d.memoizedProps.revealOrder==="unstable_legacy-backwards"||d.memoizedProps.revealOrder==="together")){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===l)break;for(;d.sibling===null;){if(d.return===null||d.return===l)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var ro=0,Je=null,jt=null,xn=null,Cp=!1,Lc=!1,cl=!1,kp=0,wd=0,Nc=null,rz=0;function rn(){throw Error(i(321))}function Ab(l,d){if(d===null)return!1;for(var p=0;p<d.length&&p<l.length;p++)if(!Xi(l[p],d[p]))return!1;return!0}function Pb(l,d,p,v,x,C){return ro=C,Je=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,B.H=l===null||l.memoizedState===null?jE:Wb,cl=!1,C=p(v,x),cl=!1,Lc&&(C=nE(d,p,v,x)),tE(l),C}function tE(l){B.H=Td;var d=jt!==null&&jt.next!==null;if(ro=0,xn=jt=Je=null,Cp=!1,wd=0,Nc=null,d)throw Error(i(300));l===null||wn||(l=l.dependencies,l!==null&&mp(l)&&(wn=!0))}function nE(l,d,p,v){Je=l;var x=0;do{if(Lc&&(Nc=null),wd=0,Lc=!1,25<=x)throw Error(i(301));if(x+=1,xn=jt=null,l.updateQueue!=null){var C=l.updateQueue;C.lastEffect=null,C.events=null,C.stores=null,C.memoCache!=null&&(C.memoCache.index=0)}B.H=BE,C=d(p,v)}while(Lc);return C}function oz(){var l=B.H,d=l.useState()[0];return d=typeof d.then=="function"?Cd(d):d,l=l.useState()[0],(jt!==null?jt.memoizedState:null)!==l&&(Je.flags|=1024),d}function Lb(){var l=kp!==0;return kp=0,l}function Nb(l,d,p){d.updateQueue=l.updateQueue,d.flags&=-2053,l.lanes&=~p}function Ib(l){if(Cp){for(l=l.memoizedState;l!==null;){var d=l.queue;d!==null&&(d.pending=null),l=l.next}Cp=!1}ro=0,xn=jt=Je=null,Lc=!1,wd=kp=0,Nc=null}function Si(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xn===null?Je.memoizedState=xn=l:xn=xn.next=l,xn}function mn(){if(jt===null){var l=Je.alternate;l=l!==null?l.memoizedState:null}else l=jt.next;var d=xn===null?Je.memoizedState:xn.next;if(d!==null)xn=d,jt=l;else{if(l===null)throw Je.alternate===null?Error(i(467)):Error(i(310));jt=l,l={memoizedState:jt.memoizedState,baseState:jt.baseState,baseQueue:jt.baseQueue,queue:jt.queue,next:null},xn===null?Je.memoizedState=xn=l:xn=xn.next=l}return xn}function Tp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Cd(l){var d=wd;return wd+=1,Nc===null&&(Nc=[]),l=WT(Nc,l,d),d=Je,(xn===null?d.memoizedState:xn.next)===null&&(d=d.alternate,B.H=d===null||d.memoizedState===null?jE:Wb),l}function Ep(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return Cd(l);if(l.$$typeof===R)return ti(l)}throw Error(i(438,String(l)))}function Db(l){var d=null,p=Je.updateQueue;if(p!==null&&(d=p.memoCache),d==null){var v=Je.alternate;v!==null&&(v=v.updateQueue,v!==null&&(v=v.memoCache,v!=null&&(d={data:v.data.map(function(x){return x.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),p===null&&(p=Tp(),Je.updateQueue=p),p.memoCache=d,p=d.data[d.index],p===void 0)for(p=d.data[d.index]=Array(l),v=0;v<l;v++)p[v]=N;return d.index++,p}function oo(l,d){return typeof d=="function"?d(l):d}function Rp(l){var d=mn();return Ob(d,jt,l)}function Ob(l,d,p){var v=l.queue;if(v===null)throw Error(i(311));v.lastRenderedReducer=p;var x=l.baseQueue,C=v.pending;if(C!==null){if(x!==null){var D=x.next;x.next=C.next,C.next=D}d.baseQueue=x=C,v.pending=null}if(C=l.baseState,x===null)l.memoizedState=C;else{d=x.next;var F=D=null,Y=null,ee=d,le=!1;do{var he=ee.lane&-536870913;if(he!==ee.lane?(bt&he)===he:(ro&he)===he){var ie=ee.revertLane;if(ie===0)Y!==null&&(Y=Y.next={lane:0,revertLane:0,gesture:null,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null}),he===Ec&&(le=!0);else if((ro&ie)===ie){ee=ee.next,ie===Ec&&(le=!0);continue}else he={lane:0,revertLane:ee.revertLane,gesture:null,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null},Y===null?(F=Y=he,D=C):Y=Y.next=he,Je.lanes|=ie,ta|=ie;he=ee.action,cl&&p(C,he),C=ee.hasEagerState?ee.eagerState:p(C,he)}else ie={lane:he,revertLane:ee.revertLane,gesture:ee.gesture,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null},Y===null?(F=Y=ie,D=C):Y=Y.next=ie,Je.lanes|=he,ta|=he;ee=ee.next}while(ee!==null&&ee!==d);if(Y===null?D=C:Y.next=F,!Xi(C,l.memoizedState)&&(wn=!0,le&&(p=Rc,p!==null)))throw p;l.memoizedState=C,l.baseState=D,l.baseQueue=Y,v.lastRenderedState=C}return x===null&&(v.lanes=0),[l.memoizedState,v.dispatch]}function jb(l){var d=mn(),p=d.queue;if(p===null)throw Error(i(311));p.lastRenderedReducer=l;var v=p.dispatch,x=p.pending,C=d.memoizedState;if(x!==null){p.pending=null;var D=x=x.next;do C=l(C,D.action),D=D.next;while(D!==x);Xi(C,d.memoizedState)||(wn=!0),d.memoizedState=C,d.baseQueue===null&&(d.baseState=C),p.lastRenderedState=C}return[C,v]}function iE(l,d,p){var v=Je,x=mn(),C=St;if(C){if(p===void 0)throw Error(i(407));p=p()}else p=d();var D=!Xi((jt||x).memoizedState,p);if(D&&(x.memoizedState=p,wn=!0),x=x.queue,Ub(oE.bind(null,v,x,l),[l]),x.getSnapshot!==d||D||xn!==null&&xn.memoizedState.tag&1){if(v.flags|=2048,Ic(9,{destroy:void 0},rE.bind(null,v,x,p,d),null),$t===null)throw Error(i(349));C||(ro&127)!==0||sE(v,d,p)}return p}function sE(l,d,p){l.flags|=16384,l={getSnapshot:d,value:p},d=Je.updateQueue,d===null?(d=Tp(),Je.updateQueue=d,d.stores=[l]):(p=d.stores,p===null?d.stores=[l]:p.push(l))}function rE(l,d,p,v){d.value=p,d.getSnapshot=v,aE(d)&&lE(l)}function oE(l,d,p){return p(function(){aE(d)&&lE(l)})}function aE(l){var d=l.getSnapshot;l=l.value;try{var p=d();return!Xi(l,p)}catch{return!0}}function lE(l){var d=el(l,2);d!==null&&Bi(d,l,2)}function Bb(l){var d=Si();if(typeof l=="function"){var p=l;if(l=p(),cl){fn(!0);try{p()}finally{fn(!1)}}}return d.memoizedState=d.baseState=l,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:oo,lastRenderedState:l},d}function cE(l,d,p,v){return l.baseState=p,Ob(l,jt,typeof v=="function"?v:oo)}function az(l,d,p,v,x){if(Pp(l))throw Error(i(485));if(l=d.action,l!==null){var C={payload:x,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(D){C.listeners.push(D)}};B.T!==null?p(!0):C.isTransition=!1,v(C),p=d.pending,p===null?(C.next=d.pending=C,uE(d,C)):(C.next=p.next,d.pending=p.next=C)}}function uE(l,d){var p=d.action,v=d.payload,x=l.state;if(d.isTransition){var C=B.T,D={};B.T=D;try{var F=p(x,v),Y=B.S;Y!==null&&Y(D,F),dE(l,d,F)}catch(ee){Fb(l,d,ee)}finally{C!==null&&D.types!==null&&(C.types=D.types),B.T=C}}else try{C=p(x,v),dE(l,d,C)}catch(ee){Fb(l,d,ee)}}function dE(l,d,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(v){hE(l,d,v)},function(v){return Fb(l,d,v)}):hE(l,d,p)}function hE(l,d,p){d.status="fulfilled",d.value=p,fE(d),l.state=p,d=l.pending,d!==null&&(p=d.next,p===d?l.pending=null:(p=p.next,d.next=p,uE(l,p)))}function Fb(l,d,p){var v=l.pending;if(l.pending=null,v!==null){v=v.next;do d.status="rejected",d.reason=p,fE(d),d=d.next;while(d!==v)}l.action=null}function fE(l){l=l.listeners;for(var d=0;d<l.length;d++)(0,l[d])()}function pE(l,d){return d}function mE(l,d){if(St){var p=$t.formState;if(p!==null){e:{var v=Je;if(St){if(Gt){t:{for(var x=Gt,C=Ss;x.nodeType!==8;){if(!C){x=null;break t}if(x=ws(x.nextSibling),x===null){x=null;break t}}C=x.data,x=C==="F!"||C==="F"?x:null}if(x){Gt=ws(x.nextSibling),v=x.data==="F!";break e}}Wo(v)}v=!1}v&&(d=p[0])}}return p=Si(),p.memoizedState=p.baseState=d,v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pE,lastRenderedState:d},p.queue=v,p=IE.bind(null,Je,v),v.dispatch=p,v=Bb(!1),C=Vb.bind(null,Je,!1,v.queue),v=Si(),x={state:d,dispatch:null,action:l,pending:null},v.queue=x,p=az.bind(null,Je,x,C,p),x.dispatch=p,v.memoizedState=l,[d,p,!1]}function gE(l){var d=mn();return vE(d,jt,l)}function vE(l,d,p){if(d=Ob(l,d,pE)[0],l=Rp(oo)[0],typeof d=="object"&&d!==null&&typeof d.then=="function")try{var v=Cd(d)}catch(D){throw D===Mc?yp:D}else v=d;d=mn();var x=d.queue,C=x.dispatch;return p!==d.memoizedState&&(Je.flags|=2048,Ic(9,{destroy:void 0},lz.bind(null,x,p),null)),[v,C,l]}function lz(l,d){l.action=d}function yE(l){var d=mn(),p=jt;if(p!==null)return vE(d,p,l);mn(),d=d.memoizedState,p=mn();var v=p.queue.dispatch;return p.memoizedState=l,[d,v,!1]}function Ic(l,d,p,v){return l={tag:l,create:p,deps:v,inst:d,next:null},d=Je.updateQueue,d===null&&(d=Tp(),Je.updateQueue=d),p=d.lastEffect,p===null?d.lastEffect=l.next=l:(v=p.next,p.next=l,l.next=v,d.lastEffect=l),l}function bE(){return mn().memoizedState}function Mp(l,d,p,v){var x=Si();Je.flags|=l,x.memoizedState=Ic(1|d,{destroy:void 0},p,v===void 0?null:v)}function Ap(l,d,p,v){var x=mn();v=v===void 0?null:v;var C=x.memoizedState.inst;jt!==null&&v!==null&&Ab(v,jt.memoizedState.deps)?x.memoizedState=Ic(d,C,p,v):(Je.flags|=l,x.memoizedState=Ic(1|d,C,p,v))}function _E(l,d){Mp(8390656,8,l,d)}function Ub(l,d){Ap(2048,8,l,d)}function cz(l){Je.flags|=4;var d=Je.updateQueue;if(d===null)d=Tp(),Je.updateQueue=d,d.events=[l];else{var p=d.events;p===null?d.events=[l]:p.push(l)}}function SE(l){var d=mn().memoizedState;return cz({ref:d,nextImpl:l}),function(){if((Pt&2)!==0)throw Error(i(440));return d.impl.apply(void 0,arguments)}}function xE(l,d){return Ap(4,2,l,d)}function wE(l,d){return Ap(4,4,l,d)}function CE(l,d){if(typeof d=="function"){l=l();var p=d(l);return function(){typeof p=="function"?p():d(null)}}if(d!=null)return l=l(),d.current=l,function(){d.current=null}}function kE(l,d,p){p=p!=null?p.concat([l]):null,Ap(4,4,CE.bind(null,d,l),p)}function zb(){}function TE(l,d){var p=mn();d=d===void 0?null:d;var v=p.memoizedState;return d!==null&&Ab(d,v[1])?v[0]:(p.memoizedState=[l,d],l)}function EE(l,d){var p=mn();d=d===void 0?null:d;var v=p.memoizedState;if(d!==null&&Ab(d,v[1]))return v[0];if(v=l(),cl){fn(!0);try{l()}finally{fn(!1)}}return p.memoizedState=[v,d],v}function $b(l,d,p){return p===void 0||(ro&1073741824)!==0&&(bt&261930)===0?l.memoizedState=d:(l.memoizedState=p,l=RR(),Je.lanes|=l,ta|=l,p)}function RE(l,d,p,v){return Xi(p,d)?p:Pc.current!==null?(l=$b(l,p,v),Xi(l,d)||(wn=!0),l):(ro&42)===0||(ro&1073741824)!==0&&(bt&261930)===0?(wn=!0,l.memoizedState=p):(l=RR(),Je.lanes|=l,ta|=l,d)}function ME(l,d,p,v,x){var C=W.p;W.p=C!==0&&8>C?C:8;var D=B.T,F={};B.T=F,Vb(l,!1,d,p);try{var Y=x(),ee=B.S;if(ee!==null&&ee(F,Y),Y!==null&&typeof Y=="object"&&typeof Y.then=="function"){var le=sz(Y,v);kd(l,d,le,ns(l))}else kd(l,d,v,ns(l))}catch(he){kd(l,d,{then:function(){},status:"rejected",reason:he},ns())}finally{W.p=C,D!==null&&F.types!==null&&(D.types=F.types),B.T=D}}function uz(){}function qb(l,d,p,v){if(l.tag!==5)throw Error(i(476));var x=AE(l).queue;ME(l,x,d,q,p===null?uz:function(){return PE(l),p(v)})}function AE(l){var d=l.memoizedState;if(d!==null)return d;d={memoizedState:q,baseState:q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:oo,lastRenderedState:q},next:null};var p={};return d.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:oo,lastRenderedState:p},next:null},l.memoizedState=d,l=l.alternate,l!==null&&(l.memoizedState=d),d}function PE(l){var d=AE(l);d.next===null&&(d=l.alternate.memoizedState),kd(l,d.next.queue,{},ns())}function Hb(){return ti($d)}function LE(){return mn().memoizedState}function NE(){return mn().memoizedState}function dz(l){for(var d=l.return;d!==null;){switch(d.tag){case 24:case 3:var p=ns();l=Yo(p);var v=Xo(d,l,p);v!==null&&(Bi(v,d,p),_d(v,d,p)),d={cache:bb()},l.payload=d;return}d=d.return}}function hz(l,d,p){var v=ns();p={lane:v,revertLane:0,gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},Pp(l)?DE(d,p):(p=lb(l,d,p,v),p!==null&&(Bi(p,l,v),OE(p,d,v)))}function IE(l,d,p){var v=ns();kd(l,d,p,v)}function kd(l,d,p,v){var x={lane:v,revertLane:0,gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null};if(Pp(l))DE(d,x);else{var C=l.alternate;if(l.lanes===0&&(C===null||C.lanes===0)&&(C=d.lastRenderedReducer,C!==null))try{var D=d.lastRenderedState,F=C(D,p);if(x.hasEagerState=!0,x.eagerState=F,Xi(F,D))return dp(l,d,x,0),$t===null&&up(),!1}catch{}if(p=lb(l,d,x,v),p!==null)return Bi(p,l,v),OE(p,d,v),!0}return!1}function Vb(l,d,p,v){if(v={lane:2,revertLane:w_(),gesture:null,action:v,hasEagerState:!1,eagerState:null,next:null},Pp(l)){if(d)throw Error(i(479))}else d=lb(l,p,v,2),d!==null&&Bi(d,l,2)}function Pp(l){var d=l.alternate;return l===Je||d!==null&&d===Je}function DE(l,d){Lc=Cp=!0;var p=l.pending;p===null?d.next=d:(d.next=p.next,p.next=d),l.pending=d}function OE(l,d,p){if((p&4194048)!==0){var v=d.lanes;v&=l.pendingLanes,p|=v,d.lanes=p,Hs(l,p)}}var Td={readContext:ti,use:Ep,useCallback:rn,useContext:rn,useEffect:rn,useImperativeHandle:rn,useLayoutEffect:rn,useInsertionEffect:rn,useMemo:rn,useReducer:rn,useRef:rn,useState:rn,useDebugValue:rn,useDeferredValue:rn,useTransition:rn,useSyncExternalStore:rn,useId:rn,useHostTransitionStatus:rn,useFormState:rn,useActionState:rn,useOptimistic:rn,useMemoCache:rn,useCacheRefresh:rn};Td.useEffectEvent=rn;var jE={readContext:ti,use:Ep,useCallback:function(l,d){return Si().memoizedState=[l,d===void 0?null:d],l},useContext:ti,useEffect:_E,useImperativeHandle:function(l,d,p){p=p!=null?p.concat([l]):null,Mp(4194308,4,CE.bind(null,d,l),p)},useLayoutEffect:function(l,d){return Mp(4194308,4,l,d)},useInsertionEffect:function(l,d){Mp(4,2,l,d)},useMemo:function(l,d){var p=Si();d=d===void 0?null:d;var v=l();if(cl){fn(!0);try{l()}finally{fn(!1)}}return p.memoizedState=[v,d],v},useReducer:function(l,d,p){var v=Si();if(p!==void 0){var x=p(d);if(cl){fn(!0);try{p(d)}finally{fn(!1)}}}else x=d;return v.memoizedState=v.baseState=x,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:x},v.queue=l,l=l.dispatch=hz.bind(null,Je,l),[v.memoizedState,l]},useRef:function(l){var d=Si();return l={current:l},d.memoizedState=l},useState:function(l){l=Bb(l);var d=l.queue,p=IE.bind(null,Je,d);return d.dispatch=p,[l.memoizedState,p]},useDebugValue:zb,useDeferredValue:function(l,d){var p=Si();return $b(p,l,d)},useTransition:function(){var l=Bb(!1);return l=ME.bind(null,Je,l.queue,!0,!1),Si().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,d,p){var v=Je,x=Si();if(St){if(p===void 0)throw Error(i(407));p=p()}else{if(p=d(),$t===null)throw Error(i(349));(bt&127)!==0||sE(v,d,p)}x.memoizedState=p;var C={value:p,getSnapshot:d};return x.queue=C,_E(oE.bind(null,v,C,l),[l]),v.flags|=2048,Ic(9,{destroy:void 0},rE.bind(null,v,C,p,d),null),p},useId:function(){var l=Si(),d=$t.identifierPrefix;if(St){var p=br,v=yr;p=(v&~(1<<32-Tt(v)-1)).toString(32)+p,d="_"+d+"R_"+p,p=kp++,0<p&&(d+="H"+p.toString(32)),d+="_"}else p=rz++,d="_"+d+"r_"+p.toString(32)+"_";return l.memoizedState=d},useHostTransitionStatus:Hb,useFormState:mE,useActionState:mE,useOptimistic:function(l){var d=Si();d.memoizedState=d.baseState=l;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=p,d=Vb.bind(null,Je,!0,p),p.dispatch=d,[l,d]},useMemoCache:Db,useCacheRefresh:function(){return Si().memoizedState=dz.bind(null,Je)},useEffectEvent:function(l){var d=Si(),p={impl:l};return d.memoizedState=p,function(){if((Pt&2)!==0)throw Error(i(440));return p.impl.apply(void 0,arguments)}}},Wb={readContext:ti,use:Ep,useCallback:TE,useContext:ti,useEffect:Ub,useImperativeHandle:kE,useInsertionEffect:xE,useLayoutEffect:wE,useMemo:EE,useReducer:Rp,useRef:bE,useState:function(){return Rp(oo)},useDebugValue:zb,useDeferredValue:function(l,d){var p=mn();return RE(p,jt.memoizedState,l,d)},useTransition:function(){var l=Rp(oo)[0],d=mn().memoizedState;return[typeof l=="boolean"?l:Cd(l),d]},useSyncExternalStore:iE,useId:LE,useHostTransitionStatus:Hb,useFormState:gE,useActionState:gE,useOptimistic:function(l,d){var p=mn();return cE(p,jt,l,d)},useMemoCache:Db,useCacheRefresh:NE};Wb.useEffectEvent=SE;var BE={readContext:ti,use:Ep,useCallback:TE,useContext:ti,useEffect:Ub,useImperativeHandle:kE,useInsertionEffect:xE,useLayoutEffect:wE,useMemo:EE,useReducer:jb,useRef:bE,useState:function(){return jb(oo)},useDebugValue:zb,useDeferredValue:function(l,d){var p=mn();return jt===null?$b(p,l,d):RE(p,jt.memoizedState,l,d)},useTransition:function(){var l=jb(oo)[0],d=mn().memoizedState;return[typeof l=="boolean"?l:Cd(l),d]},useSyncExternalStore:iE,useId:LE,useHostTransitionStatus:Hb,useFormState:yE,useActionState:yE,useOptimistic:function(l,d){var p=mn();return jt!==null?cE(p,jt,l,d):(p.baseState=l,[l,p.queue.dispatch])},useMemoCache:Db,useCacheRefresh:NE};BE.useEffectEvent=SE;function Gb(l,d,p,v){d=l.memoizedState,p=p(v,d),p=p==null?d:f({},d,p),l.memoizedState=p,l.lanes===0&&(l.updateQueue.baseState=p)}var Kb={enqueueSetState:function(l,d,p){l=l._reactInternals;var v=ns(),x=Yo(v);x.payload=d,p!=null&&(x.callback=p),d=Xo(l,x,v),d!==null&&(Bi(d,l,v),_d(d,l,v))},enqueueReplaceState:function(l,d,p){l=l._reactInternals;var v=ns(),x=Yo(v);x.tag=1,x.payload=d,p!=null&&(x.callback=p),d=Xo(l,x,v),d!==null&&(Bi(d,l,v),_d(d,l,v))},enqueueForceUpdate:function(l,d){l=l._reactInternals;var p=ns(),v=Yo(p);v.tag=2,d!=null&&(v.callback=d),d=Xo(l,v,p),d!==null&&(Bi(d,l,p),_d(d,l,p))}};function FE(l,d,p,v,x,C,D){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(v,C,D):d.prototype&&d.prototype.isPureReactComponent?!hd(p,v)||!hd(x,C):!0}function UE(l,d,p,v){l=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(p,v),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(p,v),d.state!==l&&Kb.enqueueReplaceState(d,d.state,null)}function ul(l,d){var p=d;if("ref"in d){p={};for(var v in d)v!=="ref"&&(p[v]=d[v])}if(l=l.defaultProps){p===d&&(p=f({},p));for(var x in l)p[x]===void 0&&(p[x]=l[x])}return p}function zE(l){cp(l)}function $E(l){console.error(l)}function qE(l){cp(l)}function Lp(l,d){try{var p=l.onUncaughtError;p(d.value,{componentStack:d.stack})}catch(v){setTimeout(function(){throw v})}}function HE(l,d,p){try{var v=l.onCaughtError;v(p.value,{componentStack:p.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function Yb(l,d,p){return p=Yo(p),p.tag=3,p.payload={element:null},p.callback=function(){Lp(l,d)},p}function VE(l){return l=Yo(l),l.tag=3,l}function WE(l,d,p,v){var x=p.type.getDerivedStateFromError;if(typeof x=="function"){var C=v.value;l.payload=function(){return x(C)},l.callback=function(){HE(d,p,v)}}var D=p.stateNode;D!==null&&typeof D.componentDidCatch=="function"&&(l.callback=function(){HE(d,p,v),typeof x!="function"&&(na===null?na=new Set([this]):na.add(this));var F=v.stack;this.componentDidCatch(v.value,{componentStack:F!==null?F:""})})}function fz(l,d,p,v,x){if(p.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){if(d=p.alternate,d!==null&&Tc(d,p,x,!0),p=Ji.current,p!==null){switch(p.tag){case 31:case 13:return xs===null?Hp():p.alternate===null&&on===0&&(on=3),p.flags&=-257,p.flags|=65536,p.lanes=x,v===bp?p.flags|=16384:(d=p.updateQueue,d===null?p.updateQueue=new Set([v]):d.add(v),__(l,v,x)),!1;case 22:return p.flags|=65536,v===bp?p.flags|=16384:(d=p.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([v])},p.updateQueue=d):(p=d.retryQueue,p===null?d.retryQueue=new Set([v]):p.add(v)),__(l,v,x)),!1}throw Error(i(435,p.tag))}return __(l,v,x),Hp(),!1}if(St)return d=Ji.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=x,v!==pb&&(l=Error(i(422),{cause:v}),md(ys(l,p)))):(v!==pb&&(d=Error(i(423),{cause:v}),md(ys(d,p))),l=l.current.alternate,l.flags|=65536,x&=-x,l.lanes|=x,v=ys(v,p),x=Yb(l.stateNode,v,x),kb(l,x),on!==4&&(on=2)),!1;var C=Error(i(520),{cause:v});if(C=ys(C,p),Id===null?Id=[C]:Id.push(C),on!==4&&(on=2),d===null)return!0;v=ys(v,p),p=d;do{switch(p.tag){case 3:return p.flags|=65536,l=x&-x,p.lanes|=l,l=Yb(p.stateNode,v,l),kb(p,l),!1;case 1:if(d=p.type,C=p.stateNode,(p.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(na===null||!na.has(C))))return p.flags|=65536,x&=-x,p.lanes|=x,x=VE(x),WE(x,l,p,v),kb(p,x),!1}p=p.return}while(p!==null);return!1}var Xb=Error(i(461)),wn=!1;function ni(l,d,p,v){d.child=l===null?XT(d,null,p,v):ll(d,l.child,p,v)}function GE(l,d,p,v,x){p=p.render;var C=d.ref;if("ref"in v){var D={};for(var F in v)F!=="ref"&&(D[F]=v[F])}else D=v;return sl(d),v=Pb(l,d,p,D,C,x),F=Lb(),l!==null&&!wn?(Nb(l,d,x),ao(l,d,x)):(St&&F&&hb(d),d.flags|=1,ni(l,d,v,x),d.child)}function KE(l,d,p,v,x){if(l===null){var C=p.type;return typeof C=="function"&&!cb(C)&&C.defaultProps===void 0&&p.compare===null?(d.tag=15,d.type=C,YE(l,d,C,v,x)):(l=fp(p.type,null,v,d,d.mode,x),l.ref=d.ref,l.return=d,d.child=l)}if(C=l.child,!s_(l,x)){var D=C.memoizedProps;if(p=p.compare,p=p!==null?p:hd,p(D,v)&&l.ref===d.ref)return ao(l,d,x)}return d.flags|=1,l=to(C,v),l.ref=d.ref,l.return=d,d.child=l}function YE(l,d,p,v,x){if(l!==null){var C=l.memoizedProps;if(hd(C,v)&&l.ref===d.ref)if(wn=!1,d.pendingProps=v=C,s_(l,x))(l.flags&131072)!==0&&(wn=!0);else return d.lanes=l.lanes,ao(l,d,x)}return Qb(l,d,p,v,x)}function XE(l,d,p,v){var x=v.children,C=l!==null?l.memoizedState:null;if(l===null&&d.stateNode===null&&(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),v.mode==="hidden"){if((d.flags&128)!==0){if(C=C!==null?C.baseLanes|p:p,l!==null){for(v=d.child=l.child,x=0;v!==null;)x=x|v.lanes|v.childLanes,v=v.sibling;v=x&~C}else v=0,d.child=null;return QE(l,d,C,p,v)}if((p&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},l!==null&&vp(d,C!==null?C.cachePool:null),C!==null?ZT(d,C):Eb(),eE(d);else return v=d.lanes=536870912,QE(l,d,C!==null?C.baseLanes|p:p,p,v)}else C!==null?(vp(d,C.cachePool),ZT(d,C),Jo(),d.memoizedState=null):(l!==null&&vp(d,null),Eb(),Jo());return ni(l,d,x,p),d.child}function Ed(l,d){return l!==null&&l.tag===22||d.stateNode!==null||(d.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.sibling}function QE(l,d,p,v,x){var C=Sb();return C=C===null?null:{parent:Sn._currentValue,pool:C},d.memoizedState={baseLanes:p,cachePool:C},l!==null&&vp(d,null),Eb(),eE(d),l!==null&&Tc(l,d,v,!0),d.childLanes=x,null}function Np(l,d){return d=Dp({mode:d.mode,children:d.children},l.mode),d.ref=l.ref,l.child=d,d.return=l,d}function JE(l,d,p){return ll(d,l.child,null,p),l=Np(d,d.pendingProps),l.flags|=2,Zi(d),d.memoizedState=null,l}function pz(l,d,p){var v=d.pendingProps,x=(d.flags&128)!==0;if(d.flags&=-129,l===null){if(St){if(v.mode==="hidden")return l=Np(d,v),d.lanes=536870912,Ed(null,l);if(Mb(d),(l=Gt)?(l=uM(l,Ss),l=l!==null&&l.data==="&"?l:null,l!==null&&(d.memoizedState={dehydrated:l,treeContext:Ho!==null?{id:yr,overflow:br}:null,retryLane:536870912,hydrationErrors:null},p=DT(l),p.return=d,d.child=p,ei=d,Gt=null)):l=null,l===null)throw Wo(d);return d.lanes=536870912,null}return Np(d,v)}var C=l.memoizedState;if(C!==null){var D=C.dehydrated;if(Mb(d),x)if(d.flags&256)d.flags&=-257,d=JE(l,d,p);else if(d.memoizedState!==null)d.child=l.child,d.flags|=128,d=null;else throw Error(i(558));else if(wn||Tc(l,d,p,!1),x=(p&l.childLanes)!==0,wn||x){if(v=$t,v!==null&&(D=Ya(v,p),D!==0&&D!==C.retryLane))throw C.retryLane=D,el(l,D),Bi(v,l,D),Xb;Hp(),d=JE(l,d,p)}else l=C.treeContext,Gt=ws(D.nextSibling),ei=d,St=!0,Vo=null,Ss=!1,l!==null&&BT(d,l),d=Np(d,v),d.flags|=4096;return d}return l=to(l.child,{mode:v.mode,children:v.children}),l.ref=d.ref,d.child=l,l.return=d,l}function Ip(l,d){var p=d.ref;if(p===null)l!==null&&l.ref!==null&&(d.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error(i(284));(l===null||l.ref!==p)&&(d.flags|=4194816)}}function Qb(l,d,p,v,x){return sl(d),p=Pb(l,d,p,v,void 0,x),v=Lb(),l!==null&&!wn?(Nb(l,d,x),ao(l,d,x)):(St&&v&&hb(d),d.flags|=1,ni(l,d,p,x),d.child)}function ZE(l,d,p,v,x,C){return sl(d),d.updateQueue=null,p=nE(d,v,p,x),tE(l),v=Lb(),l!==null&&!wn?(Nb(l,d,C),ao(l,d,C)):(St&&v&&hb(d),d.flags|=1,ni(l,d,p,C),d.child)}function eR(l,d,p,v,x){if(sl(d),d.stateNode===null){var C=xc,D=p.contextType;typeof D=="object"&&D!==null&&(C=ti(D)),C=new p(v,C),d.memoizedState=C.state!==null&&C.state!==void 0?C.state:null,C.updater=Kb,d.stateNode=C,C._reactInternals=d,C=d.stateNode,C.props=v,C.state=d.memoizedState,C.refs={},wb(d),D=p.contextType,C.context=typeof D=="object"&&D!==null?ti(D):xc,C.state=d.memoizedState,D=p.getDerivedStateFromProps,typeof D=="function"&&(Gb(d,p,D,v),C.state=d.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof C.getSnapshotBeforeUpdate=="function"||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(D=C.state,typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount(),D!==C.state&&Kb.enqueueReplaceState(C,C.state,null),xd(d,v,C,x),Sd(),C.state=d.memoizedState),typeof C.componentDidMount=="function"&&(d.flags|=4194308),v=!0}else if(l===null){C=d.stateNode;var F=d.memoizedProps,Y=ul(p,F);C.props=Y;var ee=C.context,le=p.contextType;D=xc,typeof le=="object"&&le!==null&&(D=ti(le));var he=p.getDerivedStateFromProps;le=typeof he=="function"||typeof C.getSnapshotBeforeUpdate=="function",F=d.pendingProps!==F,le||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(F||ee!==D)&&UE(d,C,v,D),Ko=!1;var ie=d.memoizedState;C.state=ie,xd(d,v,C,x),Sd(),ee=d.memoizedState,F||ie!==ee||Ko?(typeof he=="function"&&(Gb(d,p,he,v),ee=d.memoizedState),(Y=Ko||FE(d,p,Y,v,ie,ee,D))?(le||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(d.flags|=4194308)):(typeof C.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=v,d.memoizedState=ee),C.props=v,C.state=ee,C.context=D,v=Y):(typeof C.componentDidMount=="function"&&(d.flags|=4194308),v=!1)}else{C=d.stateNode,Cb(l,d),D=d.memoizedProps,le=ul(p,D),C.props=le,he=d.pendingProps,ie=C.context,ee=p.contextType,Y=xc,typeof ee=="object"&&ee!==null&&(Y=ti(ee)),F=p.getDerivedStateFromProps,(ee=typeof F=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(D!==he||ie!==Y)&&UE(d,C,v,Y),Ko=!1,ie=d.memoizedState,C.state=ie,xd(d,v,C,x),Sd();var oe=d.memoizedState;D!==he||ie!==oe||Ko||l!==null&&l.dependencies!==null&&mp(l.dependencies)?(typeof F=="function"&&(Gb(d,p,F,v),oe=d.memoizedState),(le=Ko||FE(d,p,le,v,ie,oe,Y)||l!==null&&l.dependencies!==null&&mp(l.dependencies))?(ee||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(v,oe,Y),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(v,oe,Y)),typeof C.componentDidUpdate=="function"&&(d.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof C.componentDidUpdate!="function"||D===l.memoizedProps&&ie===l.memoizedState||(d.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||D===l.memoizedProps&&ie===l.memoizedState||(d.flags|=1024),d.memoizedProps=v,d.memoizedState=oe),C.props=v,C.state=oe,C.context=Y,v=le):(typeof C.componentDidUpdate!="function"||D===l.memoizedProps&&ie===l.memoizedState||(d.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||D===l.memoizedProps&&ie===l.memoizedState||(d.flags|=1024),v=!1)}return C=v,Ip(l,d),v=(d.flags&128)!==0,C||v?(C=d.stateNode,p=v&&typeof p.getDerivedStateFromError!="function"?null:C.render(),d.flags|=1,l!==null&&v?(d.child=ll(d,l.child,null,x),d.child=ll(d,null,p,x)):ni(l,d,p,x),d.memoizedState=C.state,l=d.child):l=ao(l,d,x),l}function tR(l,d,p,v){return nl(),d.flags|=256,ni(l,d,p,v),d.child}var Jb={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Zb(l){return{baseLanes:l,cachePool:HT()}}function e_(l,d,p){return l=l!==null?l.childLanes&~p:0,d&&(l|=ts),l}function nR(l,d,p){var v=d.pendingProps,x=!1,C=(d.flags&128)!==0,D;if((D=C)||(D=l!==null&&l.memoizedState===null?!1:(pn.current&2)!==0),D&&(x=!0,d.flags&=-129),D=(d.flags&32)!==0,d.flags&=-33,l===null){if(St){if(x?Qo(d):Jo(),(l=Gt)?(l=uM(l,Ss),l=l!==null&&l.data!=="&"?l:null,l!==null&&(d.memoizedState={dehydrated:l,treeContext:Ho!==null?{id:yr,overflow:br}:null,retryLane:536870912,hydrationErrors:null},p=DT(l),p.return=d,d.child=p,ei=d,Gt=null)):l=null,l===null)throw Wo(d);return O_(l)?d.lanes=32:d.lanes=536870912,null}var F=v.children;return v=v.fallback,x?(Jo(),x=d.mode,F=Dp({mode:"hidden",children:F},x),v=tl(v,x,p,null),F.return=d,v.return=d,F.sibling=v,d.child=F,v=d.child,v.memoizedState=Zb(p),v.childLanes=e_(l,D,p),d.memoizedState=Jb,Ed(null,v)):(Qo(d),t_(d,F))}var Y=l.memoizedState;if(Y!==null&&(F=Y.dehydrated,F!==null)){if(C)d.flags&256?(Qo(d),d.flags&=-257,d=n_(l,d,p)):d.memoizedState!==null?(Jo(),d.child=l.child,d.flags|=128,d=null):(Jo(),F=v.fallback,x=d.mode,v=Dp({mode:"visible",children:v.children},x),F=tl(F,x,p,null),F.flags|=2,v.return=d,F.return=d,v.sibling=F,d.child=v,ll(d,l.child,null,p),v=d.child,v.memoizedState=Zb(p),v.childLanes=e_(l,D,p),d.memoizedState=Jb,d=Ed(null,v));else if(Qo(d),O_(F)){if(D=F.nextSibling&&F.nextSibling.dataset,D)var ee=D.dgst;D=ee,v=Error(i(419)),v.stack="",v.digest=D,md({value:v,source:null,stack:null}),d=n_(l,d,p)}else if(wn||Tc(l,d,p,!1),D=(p&l.childLanes)!==0,wn||D){if(D=$t,D!==null&&(v=Ya(D,p),v!==0&&v!==Y.retryLane))throw Y.retryLane=v,el(l,v),Bi(D,l,v),Xb;D_(F)||Hp(),d=n_(l,d,p)}else D_(F)?(d.flags|=192,d.child=l.child,d=null):(l=Y.treeContext,Gt=ws(F.nextSibling),ei=d,St=!0,Vo=null,Ss=!1,l!==null&&BT(d,l),d=t_(d,v.children),d.flags|=4096);return d}return x?(Jo(),F=v.fallback,x=d.mode,Y=l.child,ee=Y.sibling,v=to(Y,{mode:"hidden",children:v.children}),v.subtreeFlags=Y.subtreeFlags&65011712,ee!==null?F=to(ee,F):(F=tl(F,x,p,null),F.flags|=2),F.return=d,v.return=d,v.sibling=F,d.child=v,Ed(null,v),v=d.child,F=l.child.memoizedState,F===null?F=Zb(p):(x=F.cachePool,x!==null?(Y=Sn._currentValue,x=x.parent!==Y?{parent:Y,pool:Y}:x):x=HT(),F={baseLanes:F.baseLanes|p,cachePool:x}),v.memoizedState=F,v.childLanes=e_(l,D,p),d.memoizedState=Jb,Ed(l.child,v)):(Qo(d),p=l.child,l=p.sibling,p=to(p,{mode:"visible",children:v.children}),p.return=d,p.sibling=null,l!==null&&(D=d.deletions,D===null?(d.deletions=[l],d.flags|=16):D.push(l)),d.child=p,d.memoizedState=null,p)}function t_(l,d){return d=Dp({mode:"visible",children:d},l.mode),d.return=l,l.child=d}function Dp(l,d){return l=Qi(22,l,null,d),l.lanes=0,l}function n_(l,d,p){return ll(d,l.child,null,p),l=t_(d,d.pendingProps.children),l.flags|=2,d.memoizedState=null,l}function iR(l,d,p){l.lanes|=d;var v=l.alternate;v!==null&&(v.lanes|=d),vb(l.return,d,p)}function i_(l,d,p,v,x,C){var D=l.memoizedState;D===null?l.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:v,tail:p,tailMode:x,treeForkCount:C}:(D.isBackwards=d,D.rendering=null,D.renderingStartTime=0,D.last=v,D.tail=p,D.tailMode=x,D.treeForkCount=C)}function sR(l,d,p){var v=d.pendingProps,x=v.revealOrder,C=v.tail;v=v.children;var D=pn.current,F=(D&2)!==0;if(F?(D=D&1|2,d.flags|=128):D&=1,U(pn,D),ni(l,d,v,p),v=St?pd:0,!F&&l!==null&&(l.flags&128)!==0)e:for(l=d.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&iR(l,p,d);else if(l.tag===19)iR(l,p,d);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===d)break e;for(;l.sibling===null;){if(l.return===null||l.return===d)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}switch(x){case"forwards":for(p=d.child,x=null;p!==null;)l=p.alternate,l!==null&&wp(l)===null&&(x=p),p=p.sibling;p=x,p===null?(x=d.child,d.child=null):(x=p.sibling,p.sibling=null),i_(d,!1,x,p,C,v);break;case"backwards":case"unstable_legacy-backwards":for(p=null,x=d.child,d.child=null;x!==null;){if(l=x.alternate,l!==null&&wp(l)===null){d.child=x;break}l=x.sibling,x.sibling=p,p=x,x=l}i_(d,!0,p,null,C,v);break;case"together":i_(d,!1,null,null,void 0,v);break;default:d.memoizedState=null}return d.child}function ao(l,d,p){if(l!==null&&(d.dependencies=l.dependencies),ta|=d.lanes,(p&d.childLanes)===0)if(l!==null){if(Tc(l,d,p,!1),(p&d.childLanes)===0)return null}else return null;if(l!==null&&d.child!==l.child)throw Error(i(153));if(d.child!==null){for(l=d.child,p=to(l,l.pendingProps),d.child=p,p.return=d;l.sibling!==null;)l=l.sibling,p=p.sibling=to(l,l.pendingProps),p.return=d;p.sibling=null}return d.child}function s_(l,d){return(l.lanes&d)!==0?!0:(l=l.dependencies,!!(l!==null&&mp(l)))}function mz(l,d,p){switch(d.tag){case 3:be(d,d.stateNode.containerInfo),Go(d,Sn,l.memoizedState.cache),nl();break;case 27:case 5:qe(d);break;case 4:be(d,d.stateNode.containerInfo);break;case 10:Go(d,d.type,d.memoizedProps.value);break;case 31:if(d.memoizedState!==null)return d.flags|=128,Mb(d),null;break;case 13:var v=d.memoizedState;if(v!==null)return v.dehydrated!==null?(Qo(d),d.flags|=128,null):(p&d.child.childLanes)!==0?nR(l,d,p):(Qo(d),l=ao(l,d,p),l!==null?l.sibling:null);Qo(d);break;case 19:var x=(l.flags&128)!==0;if(v=(p&d.childLanes)!==0,v||(Tc(l,d,p,!1),v=(p&d.childLanes)!==0),x){if(v)return sR(l,d,p);d.flags|=128}if(x=d.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),U(pn,pn.current),v)break;return null;case 22:return d.lanes=0,XE(l,d,p,d.pendingProps);case 24:Go(d,Sn,l.memoizedState.cache)}return ao(l,d,p)}function rR(l,d,p){if(l!==null)if(l.memoizedProps!==d.pendingProps)wn=!0;else{if(!s_(l,p)&&(d.flags&128)===0)return wn=!1,mz(l,d,p);wn=(l.flags&131072)!==0}else wn=!1,St&&(d.flags&1048576)!==0&&jT(d,pd,d.index);switch(d.lanes=0,d.tag){case 16:e:{var v=d.pendingProps;if(l=ol(d.elementType),d.type=l,typeof l=="function")cb(l)?(v=ul(l,v),d.tag=1,d=eR(null,d,l,v,p)):(d.tag=0,d=Qb(null,d,l,v,p));else{if(l!=null){var x=l.$$typeof;if(x===E){d.tag=11,d=GE(null,d,l,v,p);break e}else if(x===L){d.tag=14,d=KE(null,d,l,v,p);break e}}throw d=V(l)||l,Error(i(306,d,""))}}return d;case 0:return Qb(l,d,d.type,d.pendingProps,p);case 1:return v=d.type,x=ul(v,d.pendingProps),eR(l,d,v,x,p);case 3:e:{if(be(d,d.stateNode.containerInfo),l===null)throw Error(i(387));v=d.pendingProps;var C=d.memoizedState;x=C.element,Cb(l,d),xd(d,v,null,p);var D=d.memoizedState;if(v=D.cache,Go(d,Sn,v),v!==C.cache&&yb(d,[Sn],p,!0),Sd(),v=D.element,C.isDehydrated)if(C={element:v,isDehydrated:!1,cache:D.cache},d.updateQueue.baseState=C,d.memoizedState=C,d.flags&256){d=tR(l,d,v,p);break e}else if(v!==x){x=ys(Error(i(424)),d),md(x),d=tR(l,d,v,p);break e}else{switch(l=d.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(Gt=ws(l.firstChild),ei=d,St=!0,Vo=null,Ss=!0,p=XT(d,null,v,p),d.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling}else{if(nl(),v===x){d=ao(l,d,p);break e}ni(l,d,v,p)}d=d.child}return d;case 26:return Ip(l,d),l===null?(p=gM(d.type,null,d.pendingProps,null))?d.memoizedState=p:St||(p=d.type,l=d.pendingProps,v=Qp(ce.current).createElement(p),v[Zn]=d,v[Li]=l,ii(v,p,l),Un(v),d.stateNode=v):d.memoizedState=gM(d.type,l.memoizedProps,d.pendingProps,l.memoizedState),null;case 27:return qe(d),l===null&&St&&(v=d.stateNode=fM(d.type,d.pendingProps,ce.current),ei=d,Ss=!0,x=Gt,oa(d.type)?(j_=x,Gt=ws(v.firstChild)):Gt=x),ni(l,d,d.pendingProps.children,p),Ip(l,d),l===null&&(d.flags|=4194304),d.child;case 5:return l===null&&St&&((x=v=Gt)&&(v=Vz(v,d.type,d.pendingProps,Ss),v!==null?(d.stateNode=v,ei=d,Gt=ws(v.firstChild),Ss=!1,x=!0):x=!1),x||Wo(d)),qe(d),x=d.type,C=d.pendingProps,D=l!==null?l.memoizedProps:null,v=C.children,L_(x,C)?v=null:D!==null&&L_(x,D)&&(d.flags|=32),d.memoizedState!==null&&(x=Pb(l,d,oz,null,null,p),$d._currentValue=x),Ip(l,d),ni(l,d,v,p),d.child;case 6:return l===null&&St&&((l=p=Gt)&&(p=Wz(p,d.pendingProps,Ss),p!==null?(d.stateNode=p,ei=d,Gt=null,l=!0):l=!1),l||Wo(d)),null;case 13:return nR(l,d,p);case 4:return be(d,d.stateNode.containerInfo),v=d.pendingProps,l===null?d.child=ll(d,null,v,p):ni(l,d,v,p),d.child;case 11:return GE(l,d,d.type,d.pendingProps,p);case 7:return ni(l,d,d.pendingProps,p),d.child;case 8:return ni(l,d,d.pendingProps.children,p),d.child;case 12:return ni(l,d,d.pendingProps.children,p),d.child;case 10:return v=d.pendingProps,Go(d,d.type,v.value),ni(l,d,v.children,p),d.child;case 9:return x=d.type._context,v=d.pendingProps.children,sl(d),x=ti(x),v=v(x),d.flags|=1,ni(l,d,v,p),d.child;case 14:return KE(l,d,d.type,d.pendingProps,p);case 15:return YE(l,d,d.type,d.pendingProps,p);case 19:return sR(l,d,p);case 31:return pz(l,d,p);case 22:return XE(l,d,p,d.pendingProps);case 24:return sl(d),v=ti(Sn),l===null?(x=Sb(),x===null&&(x=$t,C=bb(),x.pooledCache=C,C.refCount++,C!==null&&(x.pooledCacheLanes|=p),x=C),d.memoizedState={parent:v,cache:x},wb(d),Go(d,Sn,x)):((l.lanes&p)!==0&&(Cb(l,d),xd(d,null,null,p),Sd()),x=l.memoizedState,C=d.memoizedState,x.parent!==v?(x={parent:v,cache:v},d.memoizedState=x,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=x),Go(d,Sn,v)):(v=C.cache,Go(d,Sn,v),v!==x.cache&&yb(d,[Sn],p,!0))),ni(l,d,d.pendingProps.children,p),d.child;case 29:throw d.pendingProps}throw Error(i(156,d.tag))}function lo(l){l.flags|=4}function r_(l,d,p,v,x){if((d=(l.mode&32)!==0)&&(d=!1),d){if(l.flags|=16777216,(x&335544128)===x)if(l.stateNode.complete)l.flags|=8192;else if(LR())l.flags|=8192;else throw al=bp,xb}else l.flags&=-16777217}function oR(l,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!SM(d))if(LR())l.flags|=8192;else throw al=bp,xb}function Op(l,d){d!==null&&(l.flags|=4),l.flags&16384&&(d=l.tag!==22?Jf():536870912,l.lanes|=d,Bc|=d)}function Rd(l,d){if(!St)switch(l.tailMode){case"hidden":d=l.tail;for(var p=null;d!==null;)d.alternate!==null&&(p=d),d=d.sibling;p===null?l.tail=null:p.sibling=null;break;case"collapsed":p=l.tail;for(var v=null;p!==null;)p.alternate!==null&&(v=p),p=p.sibling;v===null?d||l.tail===null?l.tail=null:l.tail.sibling=null:v.sibling=null}}function Kt(l){var d=l.alternate!==null&&l.alternate.child===l.child,p=0,v=0;if(d)for(var x=l.child;x!==null;)p|=x.lanes|x.childLanes,v|=x.subtreeFlags&65011712,v|=x.flags&65011712,x.return=l,x=x.sibling;else for(x=l.child;x!==null;)p|=x.lanes|x.childLanes,v|=x.subtreeFlags,v|=x.flags,x.return=l,x=x.sibling;return l.subtreeFlags|=v,l.childLanes=p,d}function gz(l,d,p){var v=d.pendingProps;switch(fb(d),d.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Kt(d),null;case 1:return Kt(d),null;case 3:return p=d.stateNode,v=null,l!==null&&(v=l.memoizedState.cache),d.memoizedState.cache!==v&&(d.flags|=2048),so(Sn),Ce(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(l===null||l.child===null)&&(kc(d)?lo(d):l===null||l.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,mb())),Kt(d),null;case 26:var x=d.type,C=d.memoizedState;return l===null?(lo(d),C!==null?(Kt(d),oR(d,C)):(Kt(d),r_(d,x,null,v,p))):C?C!==l.memoizedState?(lo(d),Kt(d),oR(d,C)):(Kt(d),d.flags&=-16777217):(l=l.memoizedProps,l!==v&&lo(d),Kt(d),r_(d,x,l,v,p)),null;case 27:if(dt(d),p=ce.current,x=d.type,l!==null&&d.stateNode!=null)l.memoizedProps!==v&&lo(d);else{if(!v){if(d.stateNode===null)throw Error(i(166));return Kt(d),null}l=re.current,kc(d)?FT(d):(l=fM(x,v,p),d.stateNode=l,lo(d))}return Kt(d),null;case 5:if(dt(d),x=d.type,l!==null&&d.stateNode!=null)l.memoizedProps!==v&&lo(d);else{if(!v){if(d.stateNode===null)throw Error(i(166));return Kt(d),null}if(C=re.current,kc(d))FT(d);else{var D=Qp(ce.current);switch(C){case 1:C=D.createElementNS("http://www.w3.org/2000/svg",x);break;case 2:C=D.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;default:switch(x){case"svg":C=D.createElementNS("http://www.w3.org/2000/svg",x);break;case"math":C=D.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;case"script":C=D.createElement("div"),C.innerHTML="<script><\/script>",C=C.removeChild(C.firstChild);break;case"select":C=typeof v.is=="string"?D.createElement("select",{is:v.is}):D.createElement("select"),v.multiple?C.multiple=!0:v.size&&(C.size=v.size);break;default:C=typeof v.is=="string"?D.createElement(x,{is:v.is}):D.createElement(x)}}C[Zn]=d,C[Li]=v;e:for(D=d.child;D!==null;){if(D.tag===5||D.tag===6)C.appendChild(D.stateNode);else if(D.tag!==4&&D.tag!==27&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===d)break e;for(;D.sibling===null;){if(D.return===null||D.return===d)break e;D=D.return}D.sibling.return=D.return,D=D.sibling}d.stateNode=C;e:switch(ii(C,x,v),x){case"button":case"input":case"select":case"textarea":v=!!v.autoFocus;break e;case"img":v=!0;break e;default:v=!1}v&&lo(d)}}return Kt(d),r_(d,d.type,l===null?null:l.memoizedProps,d.pendingProps,p),null;case 6:if(l&&d.stateNode!=null)l.memoizedProps!==v&&lo(d);else{if(typeof v!="string"&&d.stateNode===null)throw Error(i(166));if(l=ce.current,kc(d)){if(l=d.stateNode,p=d.memoizedProps,v=null,x=ei,x!==null)switch(x.tag){case 27:case 5:v=x.memoizedProps}l[Zn]=d,l=!!(l.nodeValue===p||v!==null&&v.suppressHydrationWarning===!0||nM(l.nodeValue,p)),l||Wo(d,!0)}else l=Qp(l).createTextNode(v),l[Zn]=d,d.stateNode=l}return Kt(d),null;case 31:if(p=d.memoizedState,l===null||l.memoizedState!==null){if(v=kc(d),p!==null){if(l===null){if(!v)throw Error(i(318));if(l=d.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(i(557));l[Zn]=d}else nl(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;Kt(d),l=!1}else p=mb(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=p),l=!0;if(!l)return d.flags&256?(Zi(d),d):(Zi(d),null);if((d.flags&128)!==0)throw Error(i(558))}return Kt(d),null;case 13:if(v=d.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(x=kc(d),v!==null&&v.dehydrated!==null){if(l===null){if(!x)throw Error(i(318));if(x=d.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(i(317));x[Zn]=d}else nl(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;Kt(d),x=!1}else x=mb(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=x),x=!0;if(!x)return d.flags&256?(Zi(d),d):(Zi(d),null)}return Zi(d),(d.flags&128)!==0?(d.lanes=p,d):(p=v!==null,l=l!==null&&l.memoizedState!==null,p&&(v=d.child,x=null,v.alternate!==null&&v.alternate.memoizedState!==null&&v.alternate.memoizedState.cachePool!==null&&(x=v.alternate.memoizedState.cachePool.pool),C=null,v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(C=v.memoizedState.cachePool.pool),C!==x&&(v.flags|=2048)),p!==l&&p&&(d.child.flags|=8192),Op(d,d.updateQueue),Kt(d),null);case 4:return Ce(),l===null&&E_(d.stateNode.containerInfo),Kt(d),null;case 10:return so(d.type),Kt(d),null;case 19:if(J(pn),v=d.memoizedState,v===null)return Kt(d),null;if(x=(d.flags&128)!==0,C=v.rendering,C===null)if(x)Rd(v,!1);else{if(on!==0||l!==null&&(l.flags&128)!==0)for(l=d.child;l!==null;){if(C=wp(l),C!==null){for(d.flags|=128,Rd(v,!1),l=C.updateQueue,d.updateQueue=l,Op(d,l),d.subtreeFlags=0,l=p,p=d.child;p!==null;)IT(p,l),p=p.sibling;return U(pn,pn.current&1|2),St&&no(d,v.treeForkCount),d.child}l=l.sibling}v.tail!==null&&Me()>zp&&(d.flags|=128,x=!0,Rd(v,!1),d.lanes=4194304)}else{if(!x)if(l=wp(C),l!==null){if(d.flags|=128,x=!0,l=l.updateQueue,d.updateQueue=l,Op(d,l),Rd(v,!0),v.tail===null&&v.tailMode==="hidden"&&!C.alternate&&!St)return Kt(d),null}else 2*Me()-v.renderingStartTime>zp&&p!==536870912&&(d.flags|=128,x=!0,Rd(v,!1),d.lanes=4194304);v.isBackwards?(C.sibling=d.child,d.child=C):(l=v.last,l!==null?l.sibling=C:d.child=C,v.last=C)}return v.tail!==null?(l=v.tail,v.rendering=l,v.tail=l.sibling,v.renderingStartTime=Me(),l.sibling=null,p=pn.current,U(pn,x?p&1|2:p&1),St&&no(d,v.treeForkCount),l):(Kt(d),null);case 22:case 23:return Zi(d),Rb(),v=d.memoizedState!==null,l!==null?l.memoizedState!==null!==v&&(d.flags|=8192):v&&(d.flags|=8192),v?(p&536870912)!==0&&(d.flags&128)===0&&(Kt(d),d.subtreeFlags&6&&(d.flags|=8192)):Kt(d),p=d.updateQueue,p!==null&&Op(d,p.retryQueue),p=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),v=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(v=d.memoizedState.cachePool.pool),v!==p&&(d.flags|=2048),l!==null&&J(rl),null;case 24:return p=null,l!==null&&(p=l.memoizedState.cache),d.memoizedState.cache!==p&&(d.flags|=2048),so(Sn),Kt(d),null;case 25:return null;case 30:return null}throw Error(i(156,d.tag))}function vz(l,d){switch(fb(d),d.tag){case 1:return l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 3:return so(Sn),Ce(),l=d.flags,(l&65536)!==0&&(l&128)===0?(d.flags=l&-65537|128,d):null;case 26:case 27:case 5:return dt(d),null;case 31:if(d.memoizedState!==null){if(Zi(d),d.alternate===null)throw Error(i(340));nl()}return l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 13:if(Zi(d),l=d.memoizedState,l!==null&&l.dehydrated!==null){if(d.alternate===null)throw Error(i(340));nl()}return l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 19:return J(pn),null;case 4:return Ce(),null;case 10:return so(d.type),null;case 22:case 23:return Zi(d),Rb(),l!==null&&J(rl),l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 24:return so(Sn),null;case 25:return null;default:return null}}function aR(l,d){switch(fb(d),d.tag){case 3:so(Sn),Ce();break;case 26:case 27:case 5:dt(d);break;case 4:Ce();break;case 31:d.memoizedState!==null&&Zi(d);break;case 13:Zi(d);break;case 19:J(pn);break;case 10:so(d.type);break;case 22:case 23:Zi(d),Rb(),l!==null&&J(rl);break;case 24:so(Sn)}}function Md(l,d){try{var p=d.updateQueue,v=p!==null?p.lastEffect:null;if(v!==null){var x=v.next;p=x;do{if((p.tag&l)===l){v=void 0;var C=p.create,D=p.inst;v=C(),D.destroy=v}p=p.next}while(p!==x)}}catch(F){Dt(d,d.return,F)}}function Zo(l,d,p){try{var v=d.updateQueue,x=v!==null?v.lastEffect:null;if(x!==null){var C=x.next;v=C;do{if((v.tag&l)===l){var D=v.inst,F=D.destroy;if(F!==void 0){D.destroy=void 0,x=d;var Y=p,ee=F;try{ee()}catch(le){Dt(x,Y,le)}}}v=v.next}while(v!==C)}}catch(le){Dt(d,d.return,le)}}function lR(l){var d=l.updateQueue;if(d!==null){var p=l.stateNode;try{JT(d,p)}catch(v){Dt(l,l.return,v)}}}function cR(l,d,p){p.props=ul(l.type,l.memoizedProps),p.state=l.memoizedState;try{p.componentWillUnmount()}catch(v){Dt(l,d,v)}}function Ad(l,d){try{var p=l.ref;if(p!==null){switch(l.tag){case 26:case 27:case 5:var v=l.stateNode;break;case 30:v=l.stateNode;break;default:v=l.stateNode}typeof p=="function"?l.refCleanup=p(v):p.current=v}}catch(x){Dt(l,d,x)}}function _r(l,d){var p=l.ref,v=l.refCleanup;if(p!==null)if(typeof v=="function")try{v()}catch(x){Dt(l,d,x)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(x){Dt(l,d,x)}else p.current=null}function uR(l){var d=l.type,p=l.memoizedProps,v=l.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":p.autoFocus&&v.focus();break e;case"img":p.src?v.src=p.src:p.srcSet&&(v.srcset=p.srcSet)}}catch(x){Dt(l,l.return,x)}}function o_(l,d,p){try{var v=l.stateNode;Fz(v,l.type,p,d),v[Li]=d}catch(x){Dt(l,l.return,x)}}function dR(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&oa(l.type)||l.tag===4}function a_(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||dR(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&oa(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function l_(l,d,p){var v=l.tag;if(v===5||v===6)l=l.stateNode,d?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(l,d):(d=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,d.appendChild(l),p=p._reactRootContainer,p!=null||d.onclick!==null||(d.onclick=Zr));else if(v!==4&&(v===27&&oa(l.type)&&(p=l.stateNode,d=null),l=l.child,l!==null))for(l_(l,d,p),l=l.sibling;l!==null;)l_(l,d,p),l=l.sibling}function jp(l,d,p){var v=l.tag;if(v===5||v===6)l=l.stateNode,d?p.insertBefore(l,d):p.appendChild(l);else if(v!==4&&(v===27&&oa(l.type)&&(p=l.stateNode),l=l.child,l!==null))for(jp(l,d,p),l=l.sibling;l!==null;)jp(l,d,p),l=l.sibling}function hR(l){var d=l.stateNode,p=l.memoizedProps;try{for(var v=l.type,x=d.attributes;x.length;)d.removeAttributeNode(x[0]);ii(d,v,p),d[Zn]=l,d[Li]=p}catch(C){Dt(l,l.return,C)}}var co=!1,Cn=!1,c_=!1,fR=typeof WeakSet=="function"?WeakSet:Set,zn=null;function yz(l,d){if(l=l.containerInfo,A_=sm,l=kT(l),nb(l)){if("selectionStart"in l)var p={start:l.selectionStart,end:l.selectionEnd};else e:{p=(p=l.ownerDocument)&&p.defaultView||window;var v=p.getSelection&&p.getSelection();if(v&&v.rangeCount!==0){p=v.anchorNode;var x=v.anchorOffset,C=v.focusNode;v=v.focusOffset;try{p.nodeType,C.nodeType}catch{p=null;break e}var D=0,F=-1,Y=-1,ee=0,le=0,he=l,ie=null;t:for(;;){for(var oe;he!==p||x!==0&&he.nodeType!==3||(F=D+x),he!==C||v!==0&&he.nodeType!==3||(Y=D+v),he.nodeType===3&&(D+=he.nodeValue.length),(oe=he.firstChild)!==null;)ie=he,he=oe;for(;;){if(he===l)break t;if(ie===p&&++ee===x&&(F=D),ie===C&&++le===v&&(Y=D),(oe=he.nextSibling)!==null)break;he=ie,ie=he.parentNode}he=oe}p=F===-1||Y===-1?null:{start:F,end:Y}}else p=null}p=p||{start:0,end:0}}else p=null;for(P_={focusedElem:l,selectionRange:p},sm=!1,zn=d;zn!==null;)if(d=zn,l=d.child,(d.subtreeFlags&1028)!==0&&l!==null)l.return=d,zn=l;else for(;zn!==null;){switch(d=zn,C=d.alternate,l=d.flags,d.tag){case 0:if((l&4)!==0&&(l=d.updateQueue,l=l!==null?l.events:null,l!==null))for(p=0;p<l.length;p++)x=l[p],x.ref.impl=x.nextImpl;break;case 11:case 15:break;case 1:if((l&1024)!==0&&C!==null){l=void 0,p=d,x=C.memoizedProps,C=C.memoizedState,v=p.stateNode;try{var Ae=ul(p.type,x);l=v.getSnapshotBeforeUpdate(Ae,C),v.__reactInternalSnapshotBeforeUpdate=l}catch(Ue){Dt(p,p.return,Ue)}}break;case 3:if((l&1024)!==0){if(l=d.stateNode.containerInfo,p=l.nodeType,p===9)I_(l);else if(p===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":I_(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(i(163))}if(l=d.sibling,l!==null){l.return=d.return,zn=l;break}zn=d.return}}function pR(l,d,p){var v=p.flags;switch(p.tag){case 0:case 11:case 15:ho(l,p),v&4&&Md(5,p);break;case 1:if(ho(l,p),v&4)if(l=p.stateNode,d===null)try{l.componentDidMount()}catch(D){Dt(p,p.return,D)}else{var x=ul(p.type,d.memoizedProps);d=d.memoizedState;try{l.componentDidUpdate(x,d,l.__reactInternalSnapshotBeforeUpdate)}catch(D){Dt(p,p.return,D)}}v&64&&lR(p),v&512&&Ad(p,p.return);break;case 3:if(ho(l,p),v&64&&(l=p.updateQueue,l!==null)){if(d=null,p.child!==null)switch(p.child.tag){case 27:case 5:d=p.child.stateNode;break;case 1:d=p.child.stateNode}try{JT(l,d)}catch(D){Dt(p,p.return,D)}}break;case 27:d===null&&v&4&&hR(p);case 26:case 5:ho(l,p),d===null&&v&4&&uR(p),v&512&&Ad(p,p.return);break;case 12:ho(l,p);break;case 31:ho(l,p),v&4&&vR(l,p);break;case 13:ho(l,p),v&4&&yR(l,p),v&64&&(l=p.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(p=Ez.bind(null,p),Gz(l,p))));break;case 22:if(v=p.memoizedState!==null||co,!v){d=d!==null&&d.memoizedState!==null||Cn,x=co;var C=Cn;co=v,(Cn=d)&&!C?fo(l,p,(p.subtreeFlags&8772)!==0):ho(l,p),co=x,Cn=C}break;case 30:break;default:ho(l,p)}}function mR(l){var d=l.alternate;d!==null&&(l.alternate=null,mR(d)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(d=l.stateNode,d!==null&&Fy(d)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var Qt=null,Ii=!1;function uo(l,d,p){for(p=p.child;p!==null;)gR(l,d,p),p=p.sibling}function gR(l,d,p){if(Vt&&typeof Vt.onCommitFiberUnmount=="function")try{Vt.onCommitFiberUnmount(hn,p)}catch{}switch(p.tag){case 26:Cn||_r(p,d),uo(l,d,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:Cn||_r(p,d);var v=Qt,x=Ii;oa(p.type)&&(Qt=p.stateNode,Ii=!1),uo(l,d,p),Fd(p.stateNode),Qt=v,Ii=x;break;case 5:Cn||_r(p,d);case 6:if(v=Qt,x=Ii,Qt=null,uo(l,d,p),Qt=v,Ii=x,Qt!==null)if(Ii)try{(Qt.nodeType===9?Qt.body:Qt.nodeName==="HTML"?Qt.ownerDocument.body:Qt).removeChild(p.stateNode)}catch(C){Dt(p,d,C)}else try{Qt.removeChild(p.stateNode)}catch(C){Dt(p,d,C)}break;case 18:Qt!==null&&(Ii?(l=Qt,lM(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,p.stateNode),Wc(l)):lM(Qt,p.stateNode));break;case 4:v=Qt,x=Ii,Qt=p.stateNode.containerInfo,Ii=!0,uo(l,d,p),Qt=v,Ii=x;break;case 0:case 11:case 14:case 15:Zo(2,p,d),Cn||Zo(4,p,d),uo(l,d,p);break;case 1:Cn||(_r(p,d),v=p.stateNode,typeof v.componentWillUnmount=="function"&&cR(p,d,v)),uo(l,d,p);break;case 21:uo(l,d,p);break;case 22:Cn=(v=Cn)||p.memoizedState!==null,uo(l,d,p),Cn=v;break;default:uo(l,d,p)}}function vR(l,d){if(d.memoizedState===null&&(l=d.alternate,l!==null&&(l=l.memoizedState,l!==null))){l=l.dehydrated;try{Wc(l)}catch(p){Dt(d,d.return,p)}}}function yR(l,d){if(d.memoizedState===null&&(l=d.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{Wc(l)}catch(p){Dt(d,d.return,p)}}function bz(l){switch(l.tag){case 31:case 13:case 19:var d=l.stateNode;return d===null&&(d=l.stateNode=new fR),d;case 22:return l=l.stateNode,d=l._retryCache,d===null&&(d=l._retryCache=new fR),d;default:throw Error(i(435,l.tag))}}function Bp(l,d){var p=bz(l);d.forEach(function(v){if(!p.has(v)){p.add(v);var x=Rz.bind(null,l,v);v.then(x,x)}})}function Di(l,d){var p=d.deletions;if(p!==null)for(var v=0;v<p.length;v++){var x=p[v],C=l,D=d,F=D;e:for(;F!==null;){switch(F.tag){case 27:if(oa(F.type)){Qt=F.stateNode,Ii=!1;break e}break;case 5:Qt=F.stateNode,Ii=!1;break e;case 3:case 4:Qt=F.stateNode.containerInfo,Ii=!0;break e}F=F.return}if(Qt===null)throw Error(i(160));gR(C,D,x),Qt=null,Ii=!1,C=x.alternate,C!==null&&(C.return=null),x.return=null}if(d.subtreeFlags&13886)for(d=d.child;d!==null;)bR(d,l),d=d.sibling}var Ws=null;function bR(l,d){var p=l.alternate,v=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:Di(d,l),Oi(l),v&4&&(Zo(3,l,l.return),Md(3,l),Zo(5,l,l.return));break;case 1:Di(d,l),Oi(l),v&512&&(Cn||p===null||_r(p,p.return)),v&64&&co&&(l=l.updateQueue,l!==null&&(v=l.callbacks,v!==null&&(p=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=p===null?v:p.concat(v))));break;case 26:var x=Ws;if(Di(d,l),Oi(l),v&512&&(Cn||p===null||_r(p,p.return)),v&4){var C=p!==null?p.memoizedState:null;if(v=l.memoizedState,p===null)if(v===null)if(l.stateNode===null){e:{v=l.type,p=l.memoizedProps,x=x.ownerDocument||x;t:switch(v){case"title":C=x.getElementsByTagName("title")[0],(!C||C[id]||C[Zn]||C.namespaceURI==="http://www.w3.org/2000/svg"||C.hasAttribute("itemprop"))&&(C=x.createElement(v),x.head.insertBefore(C,x.querySelector("head > title"))),ii(C,v,p),C[Zn]=l,Un(C),v=C;break e;case"link":var D=bM("link","href",x).get(v+(p.href||""));if(D){for(var F=0;F<D.length;F++)if(C=D[F],C.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&C.getAttribute("rel")===(p.rel==null?null:p.rel)&&C.getAttribute("title")===(p.title==null?null:p.title)&&C.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){D.splice(F,1);break t}}C=x.createElement(v),ii(C,v,p),x.head.appendChild(C);break;case"meta":if(D=bM("meta","content",x).get(v+(p.content||""))){for(F=0;F<D.length;F++)if(C=D[F],C.getAttribute("content")===(p.content==null?null:""+p.content)&&C.getAttribute("name")===(p.name==null?null:p.name)&&C.getAttribute("property")===(p.property==null?null:p.property)&&C.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&C.getAttribute("charset")===(p.charSet==null?null:p.charSet)){D.splice(F,1);break t}}C=x.createElement(v),ii(C,v,p),x.head.appendChild(C);break;default:throw Error(i(468,v))}C[Zn]=l,Un(C),v=C}l.stateNode=v}else _M(x,l.type,l.stateNode);else l.stateNode=yM(x,v,l.memoizedProps);else C!==v?(C===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):C.count--,v===null?_M(x,l.type,l.stateNode):yM(x,v,l.memoizedProps)):v===null&&l.stateNode!==null&&o_(l,l.memoizedProps,p.memoizedProps)}break;case 27:Di(d,l),Oi(l),v&512&&(Cn||p===null||_r(p,p.return)),p!==null&&v&4&&o_(l,l.memoizedProps,p.memoizedProps);break;case 5:if(Di(d,l),Oi(l),v&512&&(Cn||p===null||_r(p,p.return)),l.flags&32){x=l.stateNode;try{mc(x,"")}catch(Ae){Dt(l,l.return,Ae)}}v&4&&l.stateNode!=null&&(x=l.memoizedProps,o_(l,x,p!==null?p.memoizedProps:x)),v&1024&&(c_=!0);break;case 6:if(Di(d,l),Oi(l),v&4){if(l.stateNode===null)throw Error(i(162));v=l.memoizedProps,p=l.stateNode;try{p.nodeValue=v}catch(Ae){Dt(l,l.return,Ae)}}break;case 3:if(em=null,x=Ws,Ws=Jp(d.containerInfo),Di(d,l),Ws=x,Oi(l),v&4&&p!==null&&p.memoizedState.isDehydrated)try{Wc(d.containerInfo)}catch(Ae){Dt(l,l.return,Ae)}c_&&(c_=!1,_R(l));break;case 4:v=Ws,Ws=Jp(l.stateNode.containerInfo),Di(d,l),Oi(l),Ws=v;break;case 12:Di(d,l),Oi(l);break;case 31:Di(d,l),Oi(l),v&4&&(v=l.updateQueue,v!==null&&(l.updateQueue=null,Bp(l,v)));break;case 13:Di(d,l),Oi(l),l.child.flags&8192&&l.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(Up=Me()),v&4&&(v=l.updateQueue,v!==null&&(l.updateQueue=null,Bp(l,v)));break;case 22:x=l.memoizedState!==null;var Y=p!==null&&p.memoizedState!==null,ee=co,le=Cn;if(co=ee||x,Cn=le||Y,Di(d,l),Cn=le,co=ee,Oi(l),v&8192)e:for(d=l.stateNode,d._visibility=x?d._visibility&-2:d._visibility|1,x&&(p===null||Y||co||Cn||dl(l)),p=null,d=l;;){if(d.tag===5||d.tag===26){if(p===null){Y=p=d;try{if(C=Y.stateNode,x)D=C.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none";else{F=Y.stateNode;var he=Y.memoizedProps.style,ie=he!=null&&he.hasOwnProperty("display")?he.display:null;F.style.display=ie==null||typeof ie=="boolean"?"":(""+ie).trim()}}catch(Ae){Dt(Y,Y.return,Ae)}}}else if(d.tag===6){if(p===null){Y=d;try{Y.stateNode.nodeValue=x?"":Y.memoizedProps}catch(Ae){Dt(Y,Y.return,Ae)}}}else if(d.tag===18){if(p===null){Y=d;try{var oe=Y.stateNode;x?cM(oe,!0):cM(Y.stateNode,!1)}catch(Ae){Dt(Y,Y.return,Ae)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===l)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===l)break e;for(;d.sibling===null;){if(d.return===null||d.return===l)break e;p===d&&(p=null),d=d.return}p===d&&(p=null),d.sibling.return=d.return,d=d.sibling}v&4&&(v=l.updateQueue,v!==null&&(p=v.retryQueue,p!==null&&(v.retryQueue=null,Bp(l,p))));break;case 19:Di(d,l),Oi(l),v&4&&(v=l.updateQueue,v!==null&&(l.updateQueue=null,Bp(l,v)));break;case 30:break;case 21:break;default:Di(d,l),Oi(l)}}function Oi(l){var d=l.flags;if(d&2){try{for(var p,v=l.return;v!==null;){if(dR(v)){p=v;break}v=v.return}if(p==null)throw Error(i(160));switch(p.tag){case 27:var x=p.stateNode,C=a_(l);jp(l,C,x);break;case 5:var D=p.stateNode;p.flags&32&&(mc(D,""),p.flags&=-33);var F=a_(l);jp(l,F,D);break;case 3:case 4:var Y=p.stateNode.containerInfo,ee=a_(l);l_(l,ee,Y);break;default:throw Error(i(161))}}catch(le){Dt(l,l.return,le)}l.flags&=-3}d&4096&&(l.flags&=-4097)}function _R(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var d=l;_R(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),l=l.sibling}}function ho(l,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)pR(l,d.alternate,d),d=d.sibling}function dl(l){for(l=l.child;l!==null;){var d=l;switch(d.tag){case 0:case 11:case 14:case 15:Zo(4,d,d.return),dl(d);break;case 1:_r(d,d.return);var p=d.stateNode;typeof p.componentWillUnmount=="function"&&cR(d,d.return,p),dl(d);break;case 27:Fd(d.stateNode);case 26:case 5:_r(d,d.return),dl(d);break;case 22:d.memoizedState===null&&dl(d);break;case 30:dl(d);break;default:dl(d)}l=l.sibling}}function fo(l,d,p){for(p=p&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var v=d.alternate,x=l,C=d,D=C.flags;switch(C.tag){case 0:case 11:case 15:fo(x,C,p),Md(4,C);break;case 1:if(fo(x,C,p),v=C,x=v.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(ee){Dt(v,v.return,ee)}if(v=C,x=v.updateQueue,x!==null){var F=v.stateNode;try{var Y=x.shared.hiddenCallbacks;if(Y!==null)for(x.shared.hiddenCallbacks=null,x=0;x<Y.length;x++)QT(Y[x],F)}catch(ee){Dt(v,v.return,ee)}}p&&D&64&&lR(C),Ad(C,C.return);break;case 27:hR(C);case 26:case 5:fo(x,C,p),p&&v===null&&D&4&&uR(C),Ad(C,C.return);break;case 12:fo(x,C,p);break;case 31:fo(x,C,p),p&&D&4&&vR(x,C);break;case 13:fo(x,C,p),p&&D&4&&yR(x,C);break;case 22:C.memoizedState===null&&fo(x,C,p),Ad(C,C.return);break;case 30:break;default:fo(x,C,p)}d=d.sibling}}function u_(l,d){var p=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),l=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(l=d.memoizedState.cachePool.pool),l!==p&&(l!=null&&l.refCount++,p!=null&&gd(p))}function d_(l,d){l=null,d.alternate!==null&&(l=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==l&&(d.refCount++,l!=null&&gd(l))}function Gs(l,d,p,v){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)SR(l,d,p,v),d=d.sibling}function SR(l,d,p,v){var x=d.flags;switch(d.tag){case 0:case 11:case 15:Gs(l,d,p,v),x&2048&&Md(9,d);break;case 1:Gs(l,d,p,v);break;case 3:Gs(l,d,p,v),x&2048&&(l=null,d.alternate!==null&&(l=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==l&&(d.refCount++,l!=null&&gd(l)));break;case 12:if(x&2048){Gs(l,d,p,v),l=d.stateNode;try{var C=d.memoizedProps,D=C.id,F=C.onPostCommit;typeof F=="function"&&F(D,d.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(Y){Dt(d,d.return,Y)}}else Gs(l,d,p,v);break;case 31:Gs(l,d,p,v);break;case 13:Gs(l,d,p,v);break;case 23:break;case 22:C=d.stateNode,D=d.alternate,d.memoizedState!==null?C._visibility&2?Gs(l,d,p,v):Pd(l,d):C._visibility&2?Gs(l,d,p,v):(C._visibility|=2,Dc(l,d,p,v,(d.subtreeFlags&10256)!==0||!1)),x&2048&&u_(D,d);break;case 24:Gs(l,d,p,v),x&2048&&d_(d.alternate,d);break;default:Gs(l,d,p,v)}}function Dc(l,d,p,v,x){for(x=x&&((d.subtreeFlags&10256)!==0||!1),d=d.child;d!==null;){var C=l,D=d,F=p,Y=v,ee=D.flags;switch(D.tag){case 0:case 11:case 15:Dc(C,D,F,Y,x),Md(8,D);break;case 23:break;case 22:var le=D.stateNode;D.memoizedState!==null?le._visibility&2?Dc(C,D,F,Y,x):Pd(C,D):(le._visibility|=2,Dc(C,D,F,Y,x)),x&&ee&2048&&u_(D.alternate,D);break;case 24:Dc(C,D,F,Y,x),x&&ee&2048&&d_(D.alternate,D);break;default:Dc(C,D,F,Y,x)}d=d.sibling}}function Pd(l,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var p=l,v=d,x=v.flags;switch(v.tag){case 22:Pd(p,v),x&2048&&u_(v.alternate,v);break;case 24:Pd(p,v),x&2048&&d_(v.alternate,v);break;default:Pd(p,v)}d=d.sibling}}var Ld=8192;function Oc(l,d,p){if(l.subtreeFlags&Ld)for(l=l.child;l!==null;)xR(l,d,p),l=l.sibling}function xR(l,d,p){switch(l.tag){case 26:Oc(l,d,p),l.flags&Ld&&l.memoizedState!==null&&r8(p,Ws,l.memoizedState,l.memoizedProps);break;case 5:Oc(l,d,p);break;case 3:case 4:var v=Ws;Ws=Jp(l.stateNode.containerInfo),Oc(l,d,p),Ws=v;break;case 22:l.memoizedState===null&&(v=l.alternate,v!==null&&v.memoizedState!==null?(v=Ld,Ld=16777216,Oc(l,d,p),Ld=v):Oc(l,d,p));break;default:Oc(l,d,p)}}function wR(l){var d=l.alternate;if(d!==null&&(l=d.child,l!==null)){d.child=null;do d=l.sibling,l.sibling=null,l=d;while(l!==null)}}function Nd(l){var d=l.deletions;if((l.flags&16)!==0){if(d!==null)for(var p=0;p<d.length;p++){var v=d[p];zn=v,kR(v,l)}wR(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)CR(l),l=l.sibling}function CR(l){switch(l.tag){case 0:case 11:case 15:Nd(l),l.flags&2048&&Zo(9,l,l.return);break;case 3:Nd(l);break;case 12:Nd(l);break;case 22:var d=l.stateNode;l.memoizedState!==null&&d._visibility&2&&(l.return===null||l.return.tag!==13)?(d._visibility&=-3,Fp(l)):Nd(l);break;default:Nd(l)}}function Fp(l){var d=l.deletions;if((l.flags&16)!==0){if(d!==null)for(var p=0;p<d.length;p++){var v=d[p];zn=v,kR(v,l)}wR(l)}for(l=l.child;l!==null;){switch(d=l,d.tag){case 0:case 11:case 15:Zo(8,d,d.return),Fp(d);break;case 22:p=d.stateNode,p._visibility&2&&(p._visibility&=-3,Fp(d));break;default:Fp(d)}l=l.sibling}}function kR(l,d){for(;zn!==null;){var p=zn;switch(p.tag){case 0:case 11:case 15:Zo(8,p,d);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var v=p.memoizedState.cachePool.pool;v!=null&&v.refCount++}break;case 24:gd(p.memoizedState.cache)}if(v=p.child,v!==null)v.return=p,zn=v;else e:for(p=l;zn!==null;){v=zn;var x=v.sibling,C=v.return;if(mR(v),v===p){zn=null;break e}if(x!==null){x.return=C,zn=x;break e}zn=C}}}var _z={getCacheForType:function(l){var d=ti(Sn),p=d.data.get(l);return p===void 0&&(p=l(),d.data.set(l,p)),p},cacheSignal:function(){return ti(Sn).controller.signal}},Sz=typeof WeakMap=="function"?WeakMap:Map,Pt=0,$t=null,ht=null,bt=0,It=0,es=null,ea=!1,jc=!1,h_=!1,po=0,on=0,ta=0,hl=0,f_=0,ts=0,Bc=0,Id=null,ji=null,p_=!1,Up=0,TR=0,zp=1/0,$p=null,na=null,An=0,ia=null,Fc=null,mo=0,m_=0,g_=null,ER=null,Dd=0,v_=null;function ns(){return(Pt&2)!==0&&bt!==0?bt&-bt:B.T!==null?w_():q1()}function RR(){if(ts===0)if((bt&536870912)===0||St){var l=Gi;Gi<<=1,(Gi&3932160)===0&&(Gi=262144),ts=l}else ts=536870912;return l=Ji.current,l!==null&&(l.flags|=32),ts}function Bi(l,d,p){(l===$t&&(It===2||It===9)||l.cancelPendingCommit!==null)&&(Uc(l,0),sa(l,bt,ts,!1)),Xe(l,p),((Pt&2)===0||l!==$t)&&(l===$t&&((Pt&2)===0&&(hl|=p),on===4&&sa(l,bt,ts,!1)),Sr(l))}function MR(l,d,p){if((Pt&6)!==0)throw Error(i(327));var v=!p&&(d&127)===0&&(d&l.expiredLanes)===0||Ka(l,d),x=v?Cz(l,d):b_(l,d,!0),C=v;do{if(x===0){jc&&!v&&sa(l,d,0,!1);break}else{if(p=l.current.alternate,C&&!xz(p)){x=b_(l,d,!1),C=!1;continue}if(x===2){if(C=d,l.errorRecoveryDisabledLanes&C)var D=0;else D=l.pendingLanes&-536870913,D=D!==0?D:D&536870912?536870912:0;if(D!==0){d=D;e:{var F=l;x=Id;var Y=F.current.memoizedState.isDehydrated;if(Y&&(Uc(F,D).flags|=256),D=b_(F,D,!1),D!==2){if(h_&&!Y){F.errorRecoveryDisabledLanes|=C,hl|=C,x=4;break e}C=ji,ji=x,C!==null&&(ji===null?ji=C:ji.push.apply(ji,C))}x=D}if(C=!1,x!==2)continue}}if(x===1){Uc(l,0),sa(l,d,0,!0);break}e:{switch(v=l,C=x,C){case 0:case 1:throw Error(i(345));case 4:if((d&4194048)!==d)break;case 6:sa(v,d,ts,!ea);break e;case 2:ji=null;break;case 3:case 5:break;default:throw Error(i(329))}if((d&62914560)===d&&(x=Up+300-Me(),10<x)){if(sa(v,d,ts,!ea),lc(v,0,!0)!==0)break e;mo=d,v.timeoutHandle=oM(AR.bind(null,v,p,ji,$p,p_,d,ts,hl,Bc,ea,C,"Throttled",-0,0),x);break e}AR(v,p,ji,$p,p_,d,ts,hl,Bc,ea,C,null,-0,0)}}break}while(!0);Sr(l)}function AR(l,d,p,v,x,C,D,F,Y,ee,le,he,ie,oe){if(l.timeoutHandle=-1,he=d.subtreeFlags,he&8192||(he&16785408)===16785408){he={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Zr},xR(d,C,he);var Ae=(C&62914560)===C?Up-Me():(C&4194048)===C?TR-Me():0;if(Ae=o8(he,Ae),Ae!==null){mo=C,l.cancelPendingCommit=Ae(BR.bind(null,l,d,C,p,v,x,D,F,Y,le,he,null,ie,oe)),sa(l,C,D,!ee);return}}BR(l,d,C,p,v,x,D,F,Y)}function xz(l){for(var d=l;;){var p=d.tag;if((p===0||p===11||p===15)&&d.flags&16384&&(p=d.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var v=0;v<p.length;v++){var x=p[v],C=x.getSnapshot;x=x.value;try{if(!Xi(C(),x))return!1}catch{return!1}}if(p=d.child,d.subtreeFlags&16384&&p!==null)p.return=d,d=p;else{if(d===l)break;for(;d.sibling===null;){if(d.return===null||d.return===l)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function sa(l,d,p,v){d&=~f_,d&=~hl,l.suspendedLanes|=d,l.pingedLanes&=~d,v&&(l.warmLanes|=d),v=l.expirationTimes;for(var x=d;0<x;){var C=31-Tt(x),D=1<<C;v[C]=-1,x&=~D}p!==0&&_i(l,p,d)}function qp(){return(Pt&6)===0?(Od(0),!1):!0}function y_(){if(ht!==null){if(It===0)var l=ht.return;else l=ht,io=il=null,Ib(l),Ac=null,yd=0,l=ht;for(;l!==null;)aR(l.alternate,l),l=l.return;ht=null}}function Uc(l,d){var p=l.timeoutHandle;p!==-1&&(l.timeoutHandle=-1,$z(p)),p=l.cancelPendingCommit,p!==null&&(l.cancelPendingCommit=null,p()),mo=0,y_(),$t=l,ht=p=to(l.current,null),bt=d,It=0,es=null,ea=!1,jc=Ka(l,d),h_=!1,Bc=ts=f_=hl=ta=on=0,ji=Id=null,p_=!1,(d&8)!==0&&(d|=d&32);var v=l.entangledLanes;if(v!==0)for(l=l.entanglements,v&=d;0<v;){var x=31-Tt(v),C=1<<x;d|=l[x],v&=~C}return po=d,up(),p}function PR(l,d){Je=null,B.H=Td,d===Mc||d===yp?(d=GT(),It=3):d===xb?(d=GT(),It=4):It=d===Xb?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,es=d,ht===null&&(on=1,Lp(l,ys(d,l.current)))}function LR(){var l=Ji.current;return l===null?!0:(bt&4194048)===bt?xs===null:(bt&62914560)===bt||(bt&536870912)!==0?l===xs:!1}function NR(){var l=B.H;return B.H=Td,l===null?Td:l}function IR(){var l=B.A;return B.A=_z,l}function Hp(){on=4,ea||(bt&4194048)!==bt&&Ji.current!==null||(jc=!0),(ta&134217727)===0&&(hl&134217727)===0||$t===null||sa($t,bt,ts,!1)}function b_(l,d,p){var v=Pt;Pt|=2;var x=NR(),C=IR();($t!==l||bt!==d)&&($p=null,Uc(l,d)),d=!1;var D=on;e:do try{if(It!==0&&ht!==null){var F=ht,Y=es;switch(It){case 8:y_(),D=6;break e;case 3:case 2:case 9:case 6:Ji.current===null&&(d=!0);var ee=It;if(It=0,es=null,zc(l,F,Y,ee),p&&jc){D=0;break e}break;default:ee=It,It=0,es=null,zc(l,F,Y,ee)}}wz(),D=on;break}catch(le){PR(l,le)}while(!0);return d&&l.shellSuspendCounter++,io=il=null,Pt=v,B.H=x,B.A=C,ht===null&&($t=null,bt=0,up()),D}function wz(){for(;ht!==null;)DR(ht)}function Cz(l,d){var p=Pt;Pt|=2;var v=NR(),x=IR();$t!==l||bt!==d?($p=null,zp=Me()+500,Uc(l,d)):jc=Ka(l,d);e:do try{if(It!==0&&ht!==null){d=ht;var C=es;t:switch(It){case 1:It=0,es=null,zc(l,d,C,1);break;case 2:case 9:if(VT(C)){It=0,es=null,OR(d);break}d=function(){It!==2&&It!==9||$t!==l||(It=7),Sr(l)},C.then(d,d);break e;case 3:It=7;break e;case 4:It=5;break e;case 7:VT(C)?(It=0,es=null,OR(d)):(It=0,es=null,zc(l,d,C,7));break;case 5:var D=null;switch(ht.tag){case 26:D=ht.memoizedState;case 5:case 27:var F=ht;if(D?SM(D):F.stateNode.complete){It=0,es=null;var Y=F.sibling;if(Y!==null)ht=Y;else{var ee=F.return;ee!==null?(ht=ee,Vp(ee)):ht=null}break t}}It=0,es=null,zc(l,d,C,5);break;case 6:It=0,es=null,zc(l,d,C,6);break;case 8:y_(),on=6;break e;default:throw Error(i(462))}}kz();break}catch(le){PR(l,le)}while(!0);return io=il=null,B.H=v,B.A=x,Pt=p,ht!==null?0:($t=null,bt=0,up(),on)}function kz(){for(;ht!==null&&!Ze();)DR(ht)}function DR(l){var d=rR(l.alternate,l,po);l.memoizedProps=l.pendingProps,d===null?Vp(l):ht=d}function OR(l){var d=l,p=d.alternate;switch(d.tag){case 15:case 0:d=ZE(p,d,d.pendingProps,d.type,void 0,bt);break;case 11:d=ZE(p,d,d.pendingProps,d.type.render,d.ref,bt);break;case 5:Ib(d);default:aR(p,d),d=ht=IT(d,po),d=rR(p,d,po)}l.memoizedProps=l.pendingProps,d===null?Vp(l):ht=d}function zc(l,d,p,v){io=il=null,Ib(d),Ac=null,yd=0;var x=d.return;try{if(fz(l,x,d,p,bt)){on=1,Lp(l,ys(p,l.current)),ht=null;return}}catch(C){if(x!==null)throw ht=x,C;on=1,Lp(l,ys(p,l.current)),ht=null;return}d.flags&32768?(St||v===1?l=!0:jc||(bt&536870912)!==0?l=!1:(ea=l=!0,(v===2||v===9||v===3||v===6)&&(v=Ji.current,v!==null&&v.tag===13&&(v.flags|=16384))),jR(d,l)):Vp(d)}function Vp(l){var d=l;do{if((d.flags&32768)!==0){jR(d,ea);return}l=d.return;var p=gz(d.alternate,d,po);if(p!==null){ht=p;return}if(d=d.sibling,d!==null){ht=d;return}ht=d=l}while(d!==null);on===0&&(on=5)}function jR(l,d){do{var p=vz(l.alternate,l);if(p!==null){p.flags&=32767,ht=p;return}if(p=l.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!d&&(l=l.sibling,l!==null)){ht=l;return}ht=l=p}while(l!==null);on=6,ht=null}function BR(l,d,p,v,x,C,D,F,Y){l.cancelPendingCommit=null;do Wp();while(An!==0);if((Pt&6)!==0)throw Error(i(327));if(d!==null){if(d===l.current)throw Error(i(177));if(C=d.lanes|d.childLanes,C|=ab,Yi(l,p,C,D,F,Y),l===$t&&(ht=$t=null,bt=0),Fc=d,ia=l,mo=p,m_=C,g_=x,ER=v,(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,Mz(Oe,function(){return qR(),null})):(l.callbackNode=null,l.callbackPriority=0),v=(d.flags&13878)!==0,(d.subtreeFlags&13878)!==0||v){v=B.T,B.T=null,x=W.p,W.p=2,D=Pt,Pt|=4;try{yz(l,d,p)}finally{Pt=D,W.p=x,B.T=v}}An=1,FR(),UR(),zR()}}function FR(){if(An===1){An=0;var l=ia,d=Fc,p=(d.flags&13878)!==0;if((d.subtreeFlags&13878)!==0||p){p=B.T,B.T=null;var v=W.p;W.p=2;var x=Pt;Pt|=4;try{bR(d,l);var C=P_,D=kT(l.containerInfo),F=C.focusedElem,Y=C.selectionRange;if(D!==F&&F&&F.ownerDocument&&CT(F.ownerDocument.documentElement,F)){if(Y!==null&&nb(F)){var ee=Y.start,le=Y.end;if(le===void 0&&(le=ee),"selectionStart"in F)F.selectionStart=ee,F.selectionEnd=Math.min(le,F.value.length);else{var he=F.ownerDocument||document,ie=he&&he.defaultView||window;if(ie.getSelection){var oe=ie.getSelection(),Ae=F.textContent.length,Ue=Math.min(Y.start,Ae),Ft=Y.end===void 0?Ue:Math.min(Y.end,Ae);!oe.extend&&Ue>Ft&&(D=Ft,Ft=Ue,Ue=D);var Q=wT(F,Ue),X=wT(F,Ft);if(Q&&X&&(oe.rangeCount!==1||oe.anchorNode!==Q.node||oe.anchorOffset!==Q.offset||oe.focusNode!==X.node||oe.focusOffset!==X.offset)){var Z=he.createRange();Z.setStart(Q.node,Q.offset),oe.removeAllRanges(),Ue>Ft?(oe.addRange(Z),oe.extend(X.node,X.offset)):(Z.setEnd(X.node,X.offset),oe.addRange(Z))}}}}for(he=[],oe=F;oe=oe.parentNode;)oe.nodeType===1&&he.push({element:oe,left:oe.scrollLeft,top:oe.scrollTop});for(typeof F.focus=="function"&&F.focus(),F=0;F<he.length;F++){var ue=he[F];ue.element.scrollLeft=ue.left,ue.element.scrollTop=ue.top}}sm=!!A_,P_=A_=null}finally{Pt=x,W.p=v,B.T=p}}l.current=d,An=2}}function UR(){if(An===2){An=0;var l=ia,d=Fc,p=(d.flags&8772)!==0;if((d.subtreeFlags&8772)!==0||p){p=B.T,B.T=null;var v=W.p;W.p=2;var x=Pt;Pt|=4;try{pR(l,d.alternate,d)}finally{Pt=x,W.p=v,B.T=p}}An=3}}function zR(){if(An===4||An===3){An=0,ve();var l=ia,d=Fc,p=mo,v=ER;(d.subtreeFlags&10256)!==0||(d.flags&10256)!==0?An=5:(An=0,Fc=ia=null,$R(l,l.pendingLanes));var x=l.pendingLanes;if(x===0&&(na=null),jy(p),d=d.stateNode,Vt&&typeof Vt.onCommitFiberRoot=="function")try{Vt.onCommitFiberRoot(hn,d,void 0,(d.current.flags&128)===128)}catch{}if(v!==null){d=B.T,x=W.p,W.p=2,B.T=null;try{for(var C=l.onRecoverableError,D=0;D<v.length;D++){var F=v[D];C(F.value,{componentStack:F.stack})}}finally{B.T=d,W.p=x}}(mo&3)!==0&&Wp(),Sr(l),x=l.pendingLanes,(p&261930)!==0&&(x&42)!==0?l===v_?Dd++:(Dd=0,v_=l):Dd=0,Od(0)}}function $R(l,d){(l.pooledCacheLanes&=d)===0&&(d=l.pooledCache,d!=null&&(l.pooledCache=null,gd(d)))}function Wp(){return FR(),UR(),zR(),qR()}function qR(){if(An!==5)return!1;var l=ia,d=m_;m_=0;var p=jy(mo),v=B.T,x=W.p;try{W.p=32>p?32:p,B.T=null,p=g_,g_=null;var C=ia,D=mo;if(An=0,Fc=ia=null,mo=0,(Pt&6)!==0)throw Error(i(331));var F=Pt;if(Pt|=4,CR(C.current),SR(C,C.current,D,p),Pt=F,Od(0,!1),Vt&&typeof Vt.onPostCommitFiberRoot=="function")try{Vt.onPostCommitFiberRoot(hn,C)}catch{}return!0}finally{W.p=x,B.T=v,$R(l,d)}}function HR(l,d,p){d=ys(p,d),d=Yb(l.stateNode,d,2),l=Xo(l,d,2),l!==null&&(Xe(l,2),Sr(l))}function Dt(l,d,p){if(l.tag===3)HR(l,l,p);else for(;d!==null;){if(d.tag===3){HR(d,l,p);break}else if(d.tag===1){var v=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(na===null||!na.has(v))){l=ys(p,l),p=VE(2),v=Xo(d,p,2),v!==null&&(WE(p,v,d,l),Xe(v,2),Sr(v));break}}d=d.return}}function __(l,d,p){var v=l.pingCache;if(v===null){v=l.pingCache=new Sz;var x=new Set;v.set(d,x)}else x=v.get(d),x===void 0&&(x=new Set,v.set(d,x));x.has(p)||(h_=!0,x.add(p),l=Tz.bind(null,l,d,p),d.then(l,l))}function Tz(l,d,p){var v=l.pingCache;v!==null&&v.delete(d),l.pingedLanes|=l.suspendedLanes&p,l.warmLanes&=~p,$t===l&&(bt&p)===p&&(on===4||on===3&&(bt&62914560)===bt&&300>Me()-Up?(Pt&2)===0&&Uc(l,0):f_|=p,Bc===bt&&(Bc=0)),Sr(l)}function VR(l,d){d===0&&(d=Jf()),l=el(l,d),l!==null&&(Xe(l,d),Sr(l))}function Ez(l){var d=l.memoizedState,p=0;d!==null&&(p=d.retryLane),VR(l,p)}function Rz(l,d){var p=0;switch(l.tag){case 31:case 13:var v=l.stateNode,x=l.memoizedState;x!==null&&(p=x.retryLane);break;case 19:v=l.stateNode;break;case 22:v=l.stateNode._retryCache;break;default:throw Error(i(314))}v!==null&&v.delete(d),VR(l,p)}function Mz(l,d){return De(l,d)}var Gp=null,$c=null,S_=!1,Kp=!1,x_=!1,ra=0;function Sr(l){l!==$c&&l.next===null&&($c===null?Gp=$c=l:$c=$c.next=l),Kp=!0,S_||(S_=!0,Pz())}function Od(l,d){if(!x_&&Kp){x_=!0;do for(var p=!1,v=Gp;v!==null;){if(l!==0){var x=v.pendingLanes;if(x===0)var C=0;else{var D=v.suspendedLanes,F=v.pingedLanes;C=(1<<31-Tt(42|l)+1)-1,C&=x&~(D&~F),C=C&201326741?C&201326741|1:C?C|2:0}C!==0&&(p=!0,YR(v,C))}else C=bt,C=lc(v,v===$t?C:0,v.cancelPendingCommit!==null||v.timeoutHandle!==-1),(C&3)===0||Ka(v,C)||(p=!0,YR(v,C));v=v.next}while(p);x_=!1}}function Az(){WR()}function WR(){Kp=S_=!1;var l=0;ra!==0&&zz()&&(l=ra);for(var d=Me(),p=null,v=Gp;v!==null;){var x=v.next,C=GR(v,d);C===0?(v.next=null,p===null?Gp=x:p.next=x,x===null&&($c=p)):(p=v,(l!==0||(C&3)!==0)&&(Kp=!0)),v=x}An!==0&&An!==5||Od(l),ra!==0&&(ra=0)}function GR(l,d){for(var p=l.suspendedLanes,v=l.pingedLanes,x=l.expirationTimes,C=l.pendingLanes&-62914561;0<C;){var D=31-Tt(C),F=1<<D,Y=x[D];Y===-1?((F&p)===0||(F&v)!==0)&&(x[D]=Dy(F,d)):Y<=d&&(l.expiredLanes|=F),C&=~F}if(d=$t,p=bt,p=lc(l,l===d?p:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),v=l.callbackNode,p===0||l===d&&(It===2||It===9)||l.cancelPendingCommit!==null)return v!==null&&v!==null&&Ge(v),l.callbackNode=null,l.callbackPriority=0;if((p&3)===0||Ka(l,p)){if(d=p&-p,d===l.callbackPriority)return d;switch(v!==null&&Ge(v),jy(p)){case 2:case 8:p=Se;break;case 32:p=Oe;break;case 268435456:p=Ke;break;default:p=Oe}return v=KR.bind(null,l),p=De(p,v),l.callbackPriority=d,l.callbackNode=p,d}return v!==null&&v!==null&&Ge(v),l.callbackPriority=2,l.callbackNode=null,2}function KR(l,d){if(An!==0&&An!==5)return l.callbackNode=null,l.callbackPriority=0,null;var p=l.callbackNode;if(Wp()&&l.callbackNode!==p)return null;var v=bt;return v=lc(l,l===$t?v:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),v===0?null:(MR(l,v,d),GR(l,Me()),l.callbackNode!=null&&l.callbackNode===p?KR.bind(null,l):null)}function YR(l,d){if(Wp())return null;MR(l,d,!0)}function Pz(){qz(function(){(Pt&6)!==0?De(se,Az):WR()})}function w_(){if(ra===0){var l=Ec;l===0&&(l=$s,$s<<=1,($s&261888)===0&&($s=256)),ra=l}return ra}function XR(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:np(""+l)}function QR(l,d){var p=d.ownerDocument.createElement("input");return p.name=d.name,p.value=d.value,l.id&&p.setAttribute("form",l.id),d.parentNode.insertBefore(p,d),l=new FormData(l),p.parentNode.removeChild(p),l}function Lz(l,d,p,v,x){if(d==="submit"&&p&&p.stateNode===x){var C=XR((x[Li]||null).action),D=v.submitter;D&&(d=(d=D[Li]||null)?XR(d.formAction):D.getAttribute("formAction"),d!==null&&(C=d,D=null));var F=new op("action","action",null,v,x);l.push({event:F,listeners:[{instance:null,listener:function(){if(v.defaultPrevented){if(ra!==0){var Y=D?QR(x,D):new FormData(x);qb(p,{pending:!0,data:Y,method:x.method,action:C},null,Y)}}else typeof C=="function"&&(F.preventDefault(),Y=D?QR(x,D):new FormData(x),qb(p,{pending:!0,data:Y,method:x.method,action:C},C,Y))},currentTarget:x}]})}}for(var C_=0;C_<ob.length;C_++){var k_=ob[C_],Nz=k_.toLowerCase(),Iz=k_[0].toUpperCase()+k_.slice(1);Vs(Nz,"on"+Iz)}Vs(RT,"onAnimationEnd"),Vs(MT,"onAnimationIteration"),Vs(AT,"onAnimationStart"),Vs("dblclick","onDoubleClick"),Vs("focusin","onFocus"),Vs("focusout","onBlur"),Vs(XU,"onTransitionRun"),Vs(QU,"onTransitionStart"),Vs(JU,"onTransitionCancel"),Vs(PT,"onTransitionEnd"),fc("onMouseEnter",["mouseout","mouseover"]),fc("onMouseLeave",["mouseout","mouseover"]),fc("onPointerEnter",["pointerout","pointerover"]),fc("onPointerLeave",["pointerout","pointerover"]),Xa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xa("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dz=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(jd));function JR(l,d){d=(d&4)!==0;for(var p=0;p<l.length;p++){var v=l[p],x=v.event;v=v.listeners;e:{var C=void 0;if(d)for(var D=v.length-1;0<=D;D--){var F=v[D],Y=F.instance,ee=F.currentTarget;if(F=F.listener,Y!==C&&x.isPropagationStopped())break e;C=F,x.currentTarget=ee;try{C(x)}catch(le){cp(le)}x.currentTarget=null,C=Y}else for(D=0;D<v.length;D++){if(F=v[D],Y=F.instance,ee=F.currentTarget,F=F.listener,Y!==C&&x.isPropagationStopped())break e;C=F,x.currentTarget=ee;try{C(x)}catch(le){cp(le)}x.currentTarget=null,C=Y}}}}function ft(l,d){var p=d[By];p===void 0&&(p=d[By]=new Set);var v=l+"__bubble";p.has(v)||(ZR(d,l,2,!1),p.add(v))}function T_(l,d,p){var v=0;d&&(v|=4),ZR(p,l,v,d)}var Yp="_reactListening"+Math.random().toString(36).slice(2);function E_(l){if(!l[Yp]){l[Yp]=!0,W1.forEach(function(p){p!=="selectionchange"&&(Dz.has(p)||T_(p,!1,l),T_(p,!0,l))});var d=l.nodeType===9?l:l.ownerDocument;d===null||d[Yp]||(d[Yp]=!0,T_("selectionchange",!1,d))}}function ZR(l,d,p,v){switch(RM(d)){case 2:var x=c8;break;case 8:x=u8;break;default:x=$_}p=x.bind(null,d,p,l),x=void 0,!Gy||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(x=!0),v?x!==void 0?l.addEventListener(d,p,{capture:!0,passive:x}):l.addEventListener(d,p,!0):x!==void 0?l.addEventListener(d,p,{passive:x}):l.addEventListener(d,p,!1)}function R_(l,d,p,v,x){var C=v;if((d&1)===0&&(d&2)===0&&v!==null)e:for(;;){if(v===null)return;var D=v.tag;if(D===3||D===4){var F=v.stateNode.containerInfo;if(F===x)break;if(D===4)for(D=v.return;D!==null;){var Y=D.tag;if((Y===3||Y===4)&&D.stateNode.containerInfo===x)return;D=D.return}for(;F!==null;){if(D=uc(F),D===null)return;if(Y=D.tag,Y===5||Y===6||Y===26||Y===27){v=C=D;continue e}F=F.parentNode}}v=v.return}sT(function(){var ee=C,le=Vy(p),he=[];e:{var ie=LT.get(l);if(ie!==void 0){var oe=op,Ae=l;switch(l){case"keypress":if(sp(p)===0)break e;case"keydown":case"keyup":oe=RU;break;case"focusin":Ae="focus",oe=Qy;break;case"focusout":Ae="blur",oe=Qy;break;case"beforeblur":case"afterblur":oe=Qy;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":oe=aT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":oe=gU;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":oe=PU;break;case RT:case MT:case AT:oe=bU;break;case PT:oe=NU;break;case"scroll":case"scrollend":oe=pU;break;case"wheel":oe=DU;break;case"copy":case"cut":case"paste":oe=SU;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":oe=cT;break;case"toggle":case"beforetoggle":oe=jU}var Ue=(d&4)!==0,Ft=!Ue&&(l==="scroll"||l==="scrollend"),Q=Ue?ie!==null?ie+"Capture":null:ie;Ue=[];for(var X=ee,Z;X!==null;){var ue=X;if(Z=ue.stateNode,ue=ue.tag,ue!==5&&ue!==26&&ue!==27||Z===null||Q===null||(ue=rd(X,Q),ue!=null&&Ue.push(Bd(X,ue,Z))),Ft)break;X=X.return}0<Ue.length&&(ie=new oe(ie,Ae,null,p,le),he.push({event:ie,listeners:Ue}))}}if((d&7)===0){e:{if(ie=l==="mouseover"||l==="pointerover",oe=l==="mouseout"||l==="pointerout",ie&&p!==Hy&&(Ae=p.relatedTarget||p.fromElement)&&(uc(Ae)||Ae[cc]))break e;if((oe||ie)&&(ie=le.window===le?le:(ie=le.ownerDocument)?ie.defaultView||ie.parentWindow:window,oe?(Ae=p.relatedTarget||p.toElement,oe=ee,Ae=Ae?uc(Ae):null,Ae!==null&&(Ft=r(Ae),Ue=Ae.tag,Ae!==Ft||Ue!==5&&Ue!==27&&Ue!==6)&&(Ae=null)):(oe=null,Ae=ee),oe!==Ae)){if(Ue=aT,ue="onMouseLeave",Q="onMouseEnter",X="mouse",(l==="pointerout"||l==="pointerover")&&(Ue=cT,ue="onPointerLeave",Q="onPointerEnter",X="pointer"),Ft=oe==null?ie:sd(oe),Z=Ae==null?ie:sd(Ae),ie=new Ue(ue,X+"leave",oe,p,le),ie.target=Ft,ie.relatedTarget=Z,ue=null,uc(le)===ee&&(Ue=new Ue(Q,X+"enter",Ae,p,le),Ue.target=Z,Ue.relatedTarget=Ft,ue=Ue),Ft=ue,oe&&Ae)t:{for(Ue=Oz,Q=oe,X=Ae,Z=0,ue=Q;ue;ue=Ue(ue))Z++;ue=0;for(var je=X;je;je=Ue(je))ue++;for(;0<Z-ue;)Q=Ue(Q),Z--;for(;0<ue-Z;)X=Ue(X),ue--;for(;Z--;){if(Q===X||X!==null&&Q===X.alternate){Ue=Q;break t}Q=Ue(Q),X=Ue(X)}Ue=null}else Ue=null;oe!==null&&eM(he,ie,oe,Ue,!1),Ae!==null&&Ft!==null&&eM(he,Ft,Ae,Ue,!0)}}e:{if(ie=ee?sd(ee):window,oe=ie.nodeName&&ie.nodeName.toLowerCase(),oe==="select"||oe==="input"&&ie.type==="file")var Et=vT;else if(mT(ie))if(yT)Et=GU;else{Et=VU;var Ne=HU}else oe=ie.nodeName,!oe||oe.toLowerCase()!=="input"||ie.type!=="checkbox"&&ie.type!=="radio"?ee&&qy(ee.elementType)&&(Et=vT):Et=WU;if(Et&&(Et=Et(l,ee))){gT(he,Et,p,le);break e}Ne&&Ne(l,ie,ee),l==="focusout"&&ee&&ie.type==="number"&&ee.memoizedProps.value!=null&&$y(ie,"number",ie.value)}switch(Ne=ee?sd(ee):window,l){case"focusin":(mT(Ne)||Ne.contentEditable==="true")&&(bc=Ne,ib=ee,fd=null);break;case"focusout":fd=ib=bc=null;break;case"mousedown":sb=!0;break;case"contextmenu":case"mouseup":case"dragend":sb=!1,TT(he,p,le);break;case"selectionchange":if(YU)break;case"keydown":case"keyup":TT(he,p,le)}var et;if(Zy)e:{switch(l){case"compositionstart":var _t="onCompositionStart";break e;case"compositionend":_t="onCompositionEnd";break e;case"compositionupdate":_t="onCompositionUpdate";break e}_t=void 0}else yc?fT(l,p)&&(_t="onCompositionEnd"):l==="keydown"&&p.keyCode===229&&(_t="onCompositionStart");_t&&(uT&&p.locale!=="ko"&&(yc||_t!=="onCompositionStart"?_t==="onCompositionEnd"&&yc&&(et=rT()):(qo=le,Ky="value"in qo?qo.value:qo.textContent,yc=!0)),Ne=Xp(ee,_t),0<Ne.length&&(_t=new lT(_t,l,null,p,le),he.push({event:_t,listeners:Ne}),et?_t.data=et:(et=pT(p),et!==null&&(_t.data=et)))),(et=FU?UU(l,p):zU(l,p))&&(_t=Xp(ee,"onBeforeInput"),0<_t.length&&(Ne=new lT("onBeforeInput","beforeinput",null,p,le),he.push({event:Ne,listeners:_t}),Ne.data=et)),Lz(he,l,ee,p,le)}JR(he,d)})}function Bd(l,d,p){return{instance:l,listener:d,currentTarget:p}}function Xp(l,d){for(var p=d+"Capture",v=[];l!==null;){var x=l,C=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||C===null||(x=rd(l,p),x!=null&&v.unshift(Bd(l,x,C)),x=rd(l,d),x!=null&&v.push(Bd(l,x,C))),l.tag===3)return v;l=l.return}return[]}function Oz(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function eM(l,d,p,v,x){for(var C=d._reactName,D=[];p!==null&&p!==v;){var F=p,Y=F.alternate,ee=F.stateNode;if(F=F.tag,Y!==null&&Y===v)break;F!==5&&F!==26&&F!==27||ee===null||(Y=ee,x?(ee=rd(p,C),ee!=null&&D.unshift(Bd(p,ee,Y))):x||(ee=rd(p,C),ee!=null&&D.push(Bd(p,ee,Y)))),p=p.return}D.length!==0&&l.push({event:d,listeners:D})}var jz=/\r\n?/g,Bz=/\u0000|\uFFFD/g;function tM(l){return(typeof l=="string"?l:""+l).replace(jz,`
`).replace(Bz,"")}function nM(l,d){return d=tM(d),tM(l)===d}function Bt(l,d,p,v,x,C){switch(p){case"children":typeof v=="string"?d==="body"||d==="textarea"&&v===""||mc(l,v):(typeof v=="number"||typeof v=="bigint")&&d!=="body"&&mc(l,""+v);break;case"className":ep(l,"class",v);break;case"tabIndex":ep(l,"tabindex",v);break;case"dir":case"role":case"viewBox":case"width":case"height":ep(l,p,v);break;case"style":nT(l,v,C);break;case"data":if(d!=="object"){ep(l,"data",v);break}case"src":case"href":if(v===""&&(d!=="a"||p!=="href")){l.removeAttribute(p);break}if(v==null||typeof v=="function"||typeof v=="symbol"||typeof v=="boolean"){l.removeAttribute(p);break}v=np(""+v),l.setAttribute(p,v);break;case"action":case"formAction":if(typeof v=="function"){l.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof C=="function"&&(p==="formAction"?(d!=="input"&&Bt(l,d,"name",x.name,x,null),Bt(l,d,"formEncType",x.formEncType,x,null),Bt(l,d,"formMethod",x.formMethod,x,null),Bt(l,d,"formTarget",x.formTarget,x,null)):(Bt(l,d,"encType",x.encType,x,null),Bt(l,d,"method",x.method,x,null),Bt(l,d,"target",x.target,x,null)));if(v==null||typeof v=="symbol"||typeof v=="boolean"){l.removeAttribute(p);break}v=np(""+v),l.setAttribute(p,v);break;case"onClick":v!=null&&(l.onclick=Zr);break;case"onScroll":v!=null&&ft("scroll",l);break;case"onScrollEnd":v!=null&&ft("scrollend",l);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(i(61));if(p=v.__html,p!=null){if(x.children!=null)throw Error(i(60));l.innerHTML=p}}break;case"multiple":l.multiple=v&&typeof v!="function"&&typeof v!="symbol";break;case"muted":l.muted=v&&typeof v!="function"&&typeof v!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(v==null||typeof v=="function"||typeof v=="boolean"||typeof v=="symbol"){l.removeAttribute("xlink:href");break}p=np(""+v),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":v!=null&&typeof v!="function"&&typeof v!="symbol"?l.setAttribute(p,""+v):l.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":v&&typeof v!="function"&&typeof v!="symbol"?l.setAttribute(p,""):l.removeAttribute(p);break;case"capture":case"download":v===!0?l.setAttribute(p,""):v!==!1&&v!=null&&typeof v!="function"&&typeof v!="symbol"?l.setAttribute(p,v):l.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":v!=null&&typeof v!="function"&&typeof v!="symbol"&&!isNaN(v)&&1<=v?l.setAttribute(p,v):l.removeAttribute(p);break;case"rowSpan":case"start":v==null||typeof v=="function"||typeof v=="symbol"||isNaN(v)?l.removeAttribute(p):l.setAttribute(p,v);break;case"popover":ft("beforetoggle",l),ft("toggle",l),Zf(l,"popover",v);break;case"xlinkActuate":Jr(l,"http://www.w3.org/1999/xlink","xlink:actuate",v);break;case"xlinkArcrole":Jr(l,"http://www.w3.org/1999/xlink","xlink:arcrole",v);break;case"xlinkRole":Jr(l,"http://www.w3.org/1999/xlink","xlink:role",v);break;case"xlinkShow":Jr(l,"http://www.w3.org/1999/xlink","xlink:show",v);break;case"xlinkTitle":Jr(l,"http://www.w3.org/1999/xlink","xlink:title",v);break;case"xlinkType":Jr(l,"http://www.w3.org/1999/xlink","xlink:type",v);break;case"xmlBase":Jr(l,"http://www.w3.org/XML/1998/namespace","xml:base",v);break;case"xmlLang":Jr(l,"http://www.w3.org/XML/1998/namespace","xml:lang",v);break;case"xmlSpace":Jr(l,"http://www.w3.org/XML/1998/namespace","xml:space",v);break;case"is":Zf(l,"is",v);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=hU.get(p)||p,Zf(l,p,v))}}function M_(l,d,p,v,x,C){switch(p){case"style":nT(l,v,C);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(i(61));if(p=v.__html,p!=null){if(x.children!=null)throw Error(i(60));l.innerHTML=p}}break;case"children":typeof v=="string"?mc(l,v):(typeof v=="number"||typeof v=="bigint")&&mc(l,""+v);break;case"onScroll":v!=null&&ft("scroll",l);break;case"onScrollEnd":v!=null&&ft("scrollend",l);break;case"onClick":v!=null&&(l.onclick=Zr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!G1.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(x=p.endsWith("Capture"),d=p.slice(2,x?p.length-7:void 0),C=l[Li]||null,C=C!=null?C[p]:null,typeof C=="function"&&l.removeEventListener(d,C,x),typeof v=="function")){typeof C!="function"&&C!==null&&(p in l?l[p]=null:l.hasAttribute(p)&&l.removeAttribute(p)),l.addEventListener(d,v,x);break e}p in l?l[p]=v:v===!0?l.setAttribute(p,""):Zf(l,p,v)}}}function ii(l,d,p){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ft("error",l),ft("load",l);var v=!1,x=!1,C;for(C in p)if(p.hasOwnProperty(C)){var D=p[C];if(D!=null)switch(C){case"src":v=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,d));default:Bt(l,d,C,D,p,null)}}x&&Bt(l,d,"srcSet",p.srcSet,p,null),v&&Bt(l,d,"src",p.src,p,null);return;case"input":ft("invalid",l);var F=C=D=x=null,Y=null,ee=null;for(v in p)if(p.hasOwnProperty(v)){var le=p[v];if(le!=null)switch(v){case"name":x=le;break;case"type":D=le;break;case"checked":Y=le;break;case"defaultChecked":ee=le;break;case"value":C=le;break;case"defaultValue":F=le;break;case"children":case"dangerouslySetInnerHTML":if(le!=null)throw Error(i(137,d));break;default:Bt(l,d,v,le,p,null)}}J1(l,C,F,Y,ee,D,x,!1);return;case"select":ft("invalid",l),v=D=C=null;for(x in p)if(p.hasOwnProperty(x)&&(F=p[x],F!=null))switch(x){case"value":C=F;break;case"defaultValue":D=F;break;case"multiple":v=F;default:Bt(l,d,x,F,p,null)}d=C,p=D,l.multiple=!!v,d!=null?pc(l,!!v,d,!1):p!=null&&pc(l,!!v,p,!0);return;case"textarea":ft("invalid",l),C=x=v=null;for(D in p)if(p.hasOwnProperty(D)&&(F=p[D],F!=null))switch(D){case"value":v=F;break;case"defaultValue":x=F;break;case"children":C=F;break;case"dangerouslySetInnerHTML":if(F!=null)throw Error(i(91));break;default:Bt(l,d,D,F,p,null)}eT(l,v,x,C);return;case"option":for(Y in p)if(p.hasOwnProperty(Y)&&(v=p[Y],v!=null))switch(Y){case"selected":l.selected=v&&typeof v!="function"&&typeof v!="symbol";break;default:Bt(l,d,Y,v,p,null)}return;case"dialog":ft("beforetoggle",l),ft("toggle",l),ft("cancel",l),ft("close",l);break;case"iframe":case"object":ft("load",l);break;case"video":case"audio":for(v=0;v<jd.length;v++)ft(jd[v],l);break;case"image":ft("error",l),ft("load",l);break;case"details":ft("toggle",l);break;case"embed":case"source":case"link":ft("error",l),ft("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ee in p)if(p.hasOwnProperty(ee)&&(v=p[ee],v!=null))switch(ee){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,d));default:Bt(l,d,ee,v,p,null)}return;default:if(qy(d)){for(le in p)p.hasOwnProperty(le)&&(v=p[le],v!==void 0&&M_(l,d,le,v,p,void 0));return}}for(F in p)p.hasOwnProperty(F)&&(v=p[F],v!=null&&Bt(l,d,F,v,p,null))}function Fz(l,d,p,v){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,C=null,D=null,F=null,Y=null,ee=null,le=null;for(oe in p){var he=p[oe];if(p.hasOwnProperty(oe)&&he!=null)switch(oe){case"checked":break;case"value":break;case"defaultValue":Y=he;default:v.hasOwnProperty(oe)||Bt(l,d,oe,null,v,he)}}for(var ie in v){var oe=v[ie];if(he=p[ie],v.hasOwnProperty(ie)&&(oe!=null||he!=null))switch(ie){case"type":C=oe;break;case"name":x=oe;break;case"checked":ee=oe;break;case"defaultChecked":le=oe;break;case"value":D=oe;break;case"defaultValue":F=oe;break;case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(i(137,d));break;default:oe!==he&&Bt(l,d,ie,oe,v,he)}}zy(l,D,F,Y,ee,le,C,x);return;case"select":oe=D=F=ie=null;for(C in p)if(Y=p[C],p.hasOwnProperty(C)&&Y!=null)switch(C){case"value":break;case"multiple":oe=Y;default:v.hasOwnProperty(C)||Bt(l,d,C,null,v,Y)}for(x in v)if(C=v[x],Y=p[x],v.hasOwnProperty(x)&&(C!=null||Y!=null))switch(x){case"value":ie=C;break;case"defaultValue":F=C;break;case"multiple":D=C;default:C!==Y&&Bt(l,d,x,C,v,Y)}d=F,p=D,v=oe,ie!=null?pc(l,!!p,ie,!1):!!v!=!!p&&(d!=null?pc(l,!!p,d,!0):pc(l,!!p,p?[]:"",!1));return;case"textarea":oe=ie=null;for(F in p)if(x=p[F],p.hasOwnProperty(F)&&x!=null&&!v.hasOwnProperty(F))switch(F){case"value":break;case"children":break;default:Bt(l,d,F,null,v,x)}for(D in v)if(x=v[D],C=p[D],v.hasOwnProperty(D)&&(x!=null||C!=null))switch(D){case"value":ie=x;break;case"defaultValue":oe=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(i(91));break;default:x!==C&&Bt(l,d,D,x,v,C)}Z1(l,ie,oe);return;case"option":for(var Ae in p)if(ie=p[Ae],p.hasOwnProperty(Ae)&&ie!=null&&!v.hasOwnProperty(Ae))switch(Ae){case"selected":l.selected=!1;break;default:Bt(l,d,Ae,null,v,ie)}for(Y in v)if(ie=v[Y],oe=p[Y],v.hasOwnProperty(Y)&&ie!==oe&&(ie!=null||oe!=null))switch(Y){case"selected":l.selected=ie&&typeof ie!="function"&&typeof ie!="symbol";break;default:Bt(l,d,Y,ie,v,oe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ue in p)ie=p[Ue],p.hasOwnProperty(Ue)&&ie!=null&&!v.hasOwnProperty(Ue)&&Bt(l,d,Ue,null,v,ie);for(ee in v)if(ie=v[ee],oe=p[ee],v.hasOwnProperty(ee)&&ie!==oe&&(ie!=null||oe!=null))switch(ee){case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(i(137,d));break;default:Bt(l,d,ee,ie,v,oe)}return;default:if(qy(d)){for(var Ft in p)ie=p[Ft],p.hasOwnProperty(Ft)&&ie!==void 0&&!v.hasOwnProperty(Ft)&&M_(l,d,Ft,void 0,v,ie);for(le in v)ie=v[le],oe=p[le],!v.hasOwnProperty(le)||ie===oe||ie===void 0&&oe===void 0||M_(l,d,le,ie,v,oe);return}}for(var Q in p)ie=p[Q],p.hasOwnProperty(Q)&&ie!=null&&!v.hasOwnProperty(Q)&&Bt(l,d,Q,null,v,ie);for(he in v)ie=v[he],oe=p[he],!v.hasOwnProperty(he)||ie===oe||ie==null&&oe==null||Bt(l,d,he,ie,v,oe)}function iM(l){switch(l){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Uz(){if(typeof performance.getEntriesByType=="function"){for(var l=0,d=0,p=performance.getEntriesByType("resource"),v=0;v<p.length;v++){var x=p[v],C=x.transferSize,D=x.initiatorType,F=x.duration;if(C&&F&&iM(D)){for(D=0,F=x.responseEnd,v+=1;v<p.length;v++){var Y=p[v],ee=Y.startTime;if(ee>F)break;var le=Y.transferSize,he=Y.initiatorType;le&&iM(he)&&(Y=Y.responseEnd,D+=le*(Y<F?1:(F-ee)/(Y-ee)))}if(--v,d+=8*(C+D)/(x.duration/1e3),l++,10<l)break}}if(0<l)return d/l/1e6}return navigator.connection&&(l=navigator.connection.downlink,typeof l=="number")?l:5}var A_=null,P_=null;function Qp(l){return l.nodeType===9?l:l.ownerDocument}function sM(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function rM(l,d){if(l===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&d==="foreignObject"?0:l}function L_(l,d){return l==="textarea"||l==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var N_=null;function zz(){var l=window.event;return l&&l.type==="popstate"?l===N_?!1:(N_=l,!0):(N_=null,!1)}var oM=typeof setTimeout=="function"?setTimeout:void 0,$z=typeof clearTimeout=="function"?clearTimeout:void 0,aM=typeof Promise=="function"?Promise:void 0,qz=typeof queueMicrotask=="function"?queueMicrotask:typeof aM<"u"?function(l){return aM.resolve(null).then(l).catch(Hz)}:oM;function Hz(l){setTimeout(function(){throw l})}function oa(l){return l==="head"}function lM(l,d){var p=d,v=0;do{var x=p.nextSibling;if(l.removeChild(p),x&&x.nodeType===8)if(p=x.data,p==="/$"||p==="/&"){if(v===0){l.removeChild(x),Wc(d);return}v--}else if(p==="$"||p==="$?"||p==="$~"||p==="$!"||p==="&")v++;else if(p==="html")Fd(l.ownerDocument.documentElement);else if(p==="head"){p=l.ownerDocument.head,Fd(p);for(var C=p.firstChild;C;){var D=C.nextSibling,F=C.nodeName;C[id]||F==="SCRIPT"||F==="STYLE"||F==="LINK"&&C.rel.toLowerCase()==="stylesheet"||p.removeChild(C),C=D}}else p==="body"&&Fd(l.ownerDocument.body);p=x}while(p);Wc(d)}function cM(l,d){var p=l;l=0;do{var v=p.nextSibling;if(p.nodeType===1?d?(p._stashedDisplay=p.style.display,p.style.display="none"):(p.style.display=p._stashedDisplay||"",p.getAttribute("style")===""&&p.removeAttribute("style")):p.nodeType===3&&(d?(p._stashedText=p.nodeValue,p.nodeValue=""):p.nodeValue=p._stashedText||""),v&&v.nodeType===8)if(p=v.data,p==="/$"){if(l===0)break;l--}else p!=="$"&&p!=="$?"&&p!=="$~"&&p!=="$!"||l++;p=v}while(p)}function I_(l){var d=l.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var p=d;switch(d=d.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":I_(p),Fy(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}l.removeChild(p)}}function Vz(l,d,p,v){for(;l.nodeType===1;){var x=p;if(l.nodeName.toLowerCase()!==d.toLowerCase()){if(!v&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(v){if(!l[id])switch(d){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(C=l.getAttribute("rel"),C==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(C!==x.rel||l.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||l.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||l.getAttribute("title")!==(x.title==null?null:x.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(C=l.getAttribute("src"),(C!==(x.src==null?null:x.src)||l.getAttribute("type")!==(x.type==null?null:x.type)||l.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&C&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(d==="input"&&l.type==="hidden"){var C=x.name==null?null:""+x.name;if(x.type==="hidden"&&l.getAttribute("name")===C)return l}else return l;if(l=ws(l.nextSibling),l===null)break}return null}function Wz(l,d,p){if(d==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!p||(l=ws(l.nextSibling),l===null))return null;return l}function uM(l,d){for(;l.nodeType!==8;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!d||(l=ws(l.nextSibling),l===null))return null;return l}function D_(l){return l.data==="$?"||l.data==="$~"}function O_(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState!=="loading"}function Gz(l,d){var p=l.ownerDocument;if(l.data==="$~")l._reactRetry=d;else if(l.data!=="$?"||p.readyState!=="loading")d();else{var v=function(){d(),p.removeEventListener("DOMContentLoaded",v)};p.addEventListener("DOMContentLoaded",v),l._reactRetry=v}}function ws(l){for(;l!=null;l=l.nextSibling){var d=l.nodeType;if(d===1||d===3)break;if(d===8){if(d=l.data,d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"||d==="F!"||d==="F")break;if(d==="/$"||d==="/&")return null}}return l}var j_=null;function dM(l){l=l.nextSibling;for(var d=0;l;){if(l.nodeType===8){var p=l.data;if(p==="/$"||p==="/&"){if(d===0)return ws(l.nextSibling);d--}else p!=="$"&&p!=="$!"&&p!=="$?"&&p!=="$~"&&p!=="&"||d++}l=l.nextSibling}return null}function hM(l){l=l.previousSibling;for(var d=0;l;){if(l.nodeType===8){var p=l.data;if(p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"){if(d===0)return l;d--}else p!=="/$"&&p!=="/&"||d++}l=l.previousSibling}return null}function fM(l,d,p){switch(d=Qp(p),l){case"html":if(l=d.documentElement,!l)throw Error(i(452));return l;case"head":if(l=d.head,!l)throw Error(i(453));return l;case"body":if(l=d.body,!l)throw Error(i(454));return l;default:throw Error(i(451))}}function Fd(l){for(var d=l.attributes;d.length;)l.removeAttributeNode(d[0]);Fy(l)}var Cs=new Map,pM=new Set;function Jp(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var go=W.d;W.d={f:Kz,r:Yz,D:Xz,C:Qz,L:Jz,m:Zz,X:t8,S:e8,M:n8};function Kz(){var l=go.f(),d=qp();return l||d}function Yz(l){var d=dc(l);d!==null&&d.tag===5&&d.type==="form"?PE(d):go.r(l)}var qc=typeof document>"u"?null:document;function mM(l,d,p){var v=qc;if(v&&typeof d=="string"&&d){var x=gs(d);x='link[rel="'+l+'"][href="'+x+'"]',typeof p=="string"&&(x+='[crossorigin="'+p+'"]'),pM.has(x)||(pM.add(x),l={rel:l,crossOrigin:p,href:d},v.querySelector(x)===null&&(d=v.createElement("link"),ii(d,"link",l),Un(d),v.head.appendChild(d)))}}function Xz(l){go.D(l),mM("dns-prefetch",l,null)}function Qz(l,d){go.C(l,d),mM("preconnect",l,d)}function Jz(l,d,p){go.L(l,d,p);var v=qc;if(v&&l&&d){var x='link[rel="preload"][as="'+gs(d)+'"]';d==="image"&&p&&p.imageSrcSet?(x+='[imagesrcset="'+gs(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(x+='[imagesizes="'+gs(p.imageSizes)+'"]')):x+='[href="'+gs(l)+'"]';var C=x;switch(d){case"style":C=Hc(l);break;case"script":C=Vc(l)}Cs.has(C)||(l=f({rel:"preload",href:d==="image"&&p&&p.imageSrcSet?void 0:l,as:d},p),Cs.set(C,l),v.querySelector(x)!==null||d==="style"&&v.querySelector(Ud(C))||d==="script"&&v.querySelector(zd(C))||(d=v.createElement("link"),ii(d,"link",l),Un(d),v.head.appendChild(d)))}}function Zz(l,d){go.m(l,d);var p=qc;if(p&&l){var v=d&&typeof d.as=="string"?d.as:"script",x='link[rel="modulepreload"][as="'+gs(v)+'"][href="'+gs(l)+'"]',C=x;switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":C=Vc(l)}if(!Cs.has(C)&&(l=f({rel:"modulepreload",href:l},d),Cs.set(C,l),p.querySelector(x)===null)){switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(zd(C)))return}v=p.createElement("link"),ii(v,"link",l),Un(v),p.head.appendChild(v)}}}function e8(l,d,p){go.S(l,d,p);var v=qc;if(v&&l){var x=hc(v).hoistableStyles,C=Hc(l);d=d||"default";var D=x.get(C);if(!D){var F={loading:0,preload:null};if(D=v.querySelector(Ud(C)))F.loading=5;else{l=f({rel:"stylesheet",href:l,"data-precedence":d},p),(p=Cs.get(C))&&B_(l,p);var Y=D=v.createElement("link");Un(Y),ii(Y,"link",l),Y._p=new Promise(function(ee,le){Y.onload=ee,Y.onerror=le}),Y.addEventListener("load",function(){F.loading|=1}),Y.addEventListener("error",function(){F.loading|=2}),F.loading|=4,Zp(D,d,v)}D={type:"stylesheet",instance:D,count:1,state:F},x.set(C,D)}}}function t8(l,d){go.X(l,d);var p=qc;if(p&&l){var v=hc(p).hoistableScripts,x=Vc(l),C=v.get(x);C||(C=p.querySelector(zd(x)),C||(l=f({src:l,async:!0},d),(d=Cs.get(x))&&F_(l,d),C=p.createElement("script"),Un(C),ii(C,"link",l),p.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},v.set(x,C))}}function n8(l,d){go.M(l,d);var p=qc;if(p&&l){var v=hc(p).hoistableScripts,x=Vc(l),C=v.get(x);C||(C=p.querySelector(zd(x)),C||(l=f({src:l,async:!0,type:"module"},d),(d=Cs.get(x))&&F_(l,d),C=p.createElement("script"),Un(C),ii(C,"link",l),p.head.appendChild(C)),C={type:"script",instance:C,count:1,state:null},v.set(x,C))}}function gM(l,d,p,v){var x=(x=ce.current)?Jp(x):null;if(!x)throw Error(i(446));switch(l){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(d=Hc(p.href),p=hc(x).hoistableStyles,v=p.get(d),v||(v={type:"style",instance:null,count:0,state:null},p.set(d,v)),v):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){l=Hc(p.href);var C=hc(x).hoistableStyles,D=C.get(l);if(D||(x=x.ownerDocument||x,D={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},C.set(l,D),(C=x.querySelector(Ud(l)))&&!C._p&&(D.instance=C,D.state.loading=5),Cs.has(l)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},Cs.set(l,p),C||i8(x,l,p,D.state))),d&&v===null)throw Error(i(528,""));return D}if(d&&v!==null)throw Error(i(529,""));return null;case"script":return d=p.async,p=p.src,typeof p=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=Vc(p),p=hc(x).hoistableScripts,v=p.get(d),v||(v={type:"script",instance:null,count:0,state:null},p.set(d,v)),v):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,l))}}function Hc(l){return'href="'+gs(l)+'"'}function Ud(l){return'link[rel="stylesheet"]['+l+"]"}function vM(l){return f({},l,{"data-precedence":l.precedence,precedence:null})}function i8(l,d,p,v){l.querySelector('link[rel="preload"][as="style"]['+d+"]")?v.loading=1:(d=l.createElement("link"),v.preload=d,d.addEventListener("load",function(){return v.loading|=1}),d.addEventListener("error",function(){return v.loading|=2}),ii(d,"link",p),Un(d),l.head.appendChild(d))}function Vc(l){return'[src="'+gs(l)+'"]'}function zd(l){return"script[async]"+l}function yM(l,d,p){if(d.count++,d.instance===null)switch(d.type){case"style":var v=l.querySelector('style[data-href~="'+gs(p.href)+'"]');if(v)return d.instance=v,Un(v),v;var x=f({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return v=(l.ownerDocument||l).createElement("style"),Un(v),ii(v,"style",x),Zp(v,p.precedence,l),d.instance=v;case"stylesheet":x=Hc(p.href);var C=l.querySelector(Ud(x));if(C)return d.state.loading|=4,d.instance=C,Un(C),C;v=vM(p),(x=Cs.get(x))&&B_(v,x),C=(l.ownerDocument||l).createElement("link"),Un(C);var D=C;return D._p=new Promise(function(F,Y){D.onload=F,D.onerror=Y}),ii(C,"link",v),d.state.loading|=4,Zp(C,p.precedence,l),d.instance=C;case"script":return C=Vc(p.src),(x=l.querySelector(zd(C)))?(d.instance=x,Un(x),x):(v=p,(x=Cs.get(C))&&(v=f({},p),F_(v,x)),l=l.ownerDocument||l,x=l.createElement("script"),Un(x),ii(x,"link",v),l.head.appendChild(x),d.instance=x);case"void":return null;default:throw Error(i(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(v=d.instance,d.state.loading|=4,Zp(v,p.precedence,l));return d.instance}function Zp(l,d,p){for(var v=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=v.length?v[v.length-1]:null,C=x,D=0;D<v.length;D++){var F=v[D];if(F.dataset.precedence===d)C=F;else if(C!==x)break}C?C.parentNode.insertBefore(l,C.nextSibling):(d=p.nodeType===9?p.head:p,d.insertBefore(l,d.firstChild))}function B_(l,d){l.crossOrigin==null&&(l.crossOrigin=d.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=d.referrerPolicy),l.title==null&&(l.title=d.title)}function F_(l,d){l.crossOrigin==null&&(l.crossOrigin=d.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=d.referrerPolicy),l.integrity==null&&(l.integrity=d.integrity)}var em=null;function bM(l,d,p){if(em===null){var v=new Map,x=em=new Map;x.set(p,v)}else x=em,v=x.get(p),v||(v=new Map,x.set(p,v));if(v.has(l))return v;for(v.set(l,null),p=p.getElementsByTagName(l),x=0;x<p.length;x++){var C=p[x];if(!(C[id]||C[Zn]||l==="link"&&C.getAttribute("rel")==="stylesheet")&&C.namespaceURI!=="http://www.w3.org/2000/svg"){var D=C.getAttribute(d)||"";D=l+D;var F=v.get(D);F?F.push(C):v.set(D,[C])}}return v}function _M(l,d,p){l=l.ownerDocument||l,l.head.insertBefore(p,d==="title"?l.querySelector("head > title"):null)}function s8(l,d,p){if(p===1||d.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return l=d.disabled,typeof d.precedence=="string"&&l==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function SM(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}function r8(l,d,p,v){if(p.type==="stylesheet"&&(typeof v.media!="string"||matchMedia(v.media).matches!==!1)&&(p.state.loading&4)===0){if(p.instance===null){var x=Hc(v.href),C=d.querySelector(Ud(x));if(C){d=C._p,d!==null&&typeof d=="object"&&typeof d.then=="function"&&(l.count++,l=tm.bind(l),d.then(l,l)),p.state.loading|=4,p.instance=C,Un(C);return}C=d.ownerDocument||d,v=vM(v),(x=Cs.get(x))&&B_(v,x),C=C.createElement("link"),Un(C);var D=C;D._p=new Promise(function(F,Y){D.onload=F,D.onerror=Y}),ii(C,"link",v),p.instance=C}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(p,d),(d=p.state.preload)&&(p.state.loading&3)===0&&(l.count++,p=tm.bind(l),d.addEventListener("load",p),d.addEventListener("error",p))}}var U_=0;function o8(l,d){return l.stylesheets&&l.count===0&&im(l,l.stylesheets),0<l.count||0<l.imgCount?function(p){var v=setTimeout(function(){if(l.stylesheets&&im(l,l.stylesheets),l.unsuspend){var C=l.unsuspend;l.unsuspend=null,C()}},6e4+d);0<l.imgBytes&&U_===0&&(U_=62500*Uz());var x=setTimeout(function(){if(l.waitingForImages=!1,l.count===0&&(l.stylesheets&&im(l,l.stylesheets),l.unsuspend)){var C=l.unsuspend;l.unsuspend=null,C()}},(l.imgBytes>U_?50:800)+d);return l.unsuspend=p,function(){l.unsuspend=null,clearTimeout(v),clearTimeout(x)}}:null}function tm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)im(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var nm=null;function im(l,d){l.stylesheets=null,l.unsuspend!==null&&(l.count++,nm=new Map,d.forEach(a8,l),nm=null,tm.call(l))}function a8(l,d){if(!(d.state.loading&4)){var p=nm.get(l);if(p)var v=p.get(null);else{p=new Map,nm.set(l,p);for(var x=l.querySelectorAll("link[data-precedence],style[data-precedence]"),C=0;C<x.length;C++){var D=x[C];(D.nodeName==="LINK"||D.getAttribute("media")!=="not all")&&(p.set(D.dataset.precedence,D),v=D)}v&&p.set(null,v)}x=d.instance,D=x.getAttribute("data-precedence"),C=p.get(D)||v,C===v&&p.set(null,x),p.set(D,x),this.count++,v=tm.bind(this),x.addEventListener("load",v),x.addEventListener("error",v),C?C.parentNode.insertBefore(x,C.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(x,l.firstChild)),d.state.loading|=4}}var $d={$$typeof:R,Provider:null,Consumer:null,_currentValue:q,_currentValue2:q,_threadCount:0};function l8(l,d,p,v,x,C,D,F,Y){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ee(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ee(0),this.hiddenUpdates=Ee(null),this.identifierPrefix=v,this.onUncaughtError=x,this.onCaughtError=C,this.onRecoverableError=D,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Y,this.incompleteTransitions=new Map}function xM(l,d,p,v,x,C,D,F,Y,ee,le,he){return l=new l8(l,d,p,D,Y,ee,le,he,F),d=1,C===!0&&(d|=24),C=Qi(3,null,null,d),l.current=C,C.stateNode=l,d=bb(),d.refCount++,l.pooledCache=d,d.refCount++,C.memoizedState={element:v,isDehydrated:p,cache:d},wb(C),l}function wM(l){return l?(l=xc,l):xc}function CM(l,d,p,v,x,C){x=wM(x),v.context===null?v.context=x:v.pendingContext=x,v=Yo(d),v.payload={element:p},C=C===void 0?null:C,C!==null&&(v.callback=C),p=Xo(l,v,d),p!==null&&(Bi(p,l,d),_d(p,l,d))}function kM(l,d){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var p=l.retryLane;l.retryLane=p!==0&&p<d?p:d}}function z_(l,d){kM(l,d),(l=l.alternate)&&kM(l,d)}function TM(l){if(l.tag===13||l.tag===31){var d=el(l,67108864);d!==null&&Bi(d,l,67108864),z_(l,67108864)}}function EM(l){if(l.tag===13||l.tag===31){var d=ns();d=Oy(d);var p=el(l,d);p!==null&&Bi(p,l,d),z_(l,d)}}var sm=!0;function c8(l,d,p,v){var x=B.T;B.T=null;var C=W.p;try{W.p=2,$_(l,d,p,v)}finally{W.p=C,B.T=x}}function u8(l,d,p,v){var x=B.T;B.T=null;var C=W.p;try{W.p=8,$_(l,d,p,v)}finally{W.p=C,B.T=x}}function $_(l,d,p,v){if(sm){var x=q_(v);if(x===null)R_(l,d,v,rm,p),MM(l,v);else if(h8(x,l,d,p,v))v.stopPropagation();else if(MM(l,v),d&4&&-1<d8.indexOf(l)){for(;x!==null;){var C=dc(x);if(C!==null)switch(C.tag){case 3:if(C=C.stateNode,C.current.memoizedState.isDehydrated){var D=qs(C.pendingLanes);if(D!==0){var F=C;for(F.pendingLanes|=2,F.entangledLanes|=2;D;){var Y=1<<31-Tt(D);F.entanglements[1]|=Y,D&=~Y}Sr(C),(Pt&6)===0&&(zp=Me()+500,Od(0))}}break;case 31:case 13:F=el(C,2),F!==null&&Bi(F,C,2),qp(),z_(C,2)}if(C=q_(v),C===null&&R_(l,d,v,rm,p),C===x)break;x=C}x!==null&&v.stopPropagation()}else R_(l,d,v,null,p)}}function q_(l){return l=Vy(l),H_(l)}var rm=null;function H_(l){if(rm=null,l=uc(l),l!==null){var d=r(l);if(d===null)l=null;else{var p=d.tag;if(p===13){if(l=o(d),l!==null)return l;l=null}else if(p===31){if(l=a(d),l!==null)return l;l=null}else if(p===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;l=null}else d!==l&&(l=null)}}return rm=l,null}function RM(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(At()){case se:return 2;case Se:return 8;case Oe:case $e:return 32;case Ke:return 268435456;default:return 32}default:return 32}}var V_=!1,aa=null,la=null,ca=null,qd=new Map,Hd=new Map,ua=[],d8="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function MM(l,d){switch(l){case"focusin":case"focusout":aa=null;break;case"dragenter":case"dragleave":la=null;break;case"mouseover":case"mouseout":ca=null;break;case"pointerover":case"pointerout":qd.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hd.delete(d.pointerId)}}function Vd(l,d,p,v,x,C){return l===null||l.nativeEvent!==C?(l={blockedOn:d,domEventName:p,eventSystemFlags:v,nativeEvent:C,targetContainers:[x]},d!==null&&(d=dc(d),d!==null&&TM(d)),l):(l.eventSystemFlags|=v,d=l.targetContainers,x!==null&&d.indexOf(x)===-1&&d.push(x),l)}function h8(l,d,p,v,x){switch(d){case"focusin":return aa=Vd(aa,l,d,p,v,x),!0;case"dragenter":return la=Vd(la,l,d,p,v,x),!0;case"mouseover":return ca=Vd(ca,l,d,p,v,x),!0;case"pointerover":var C=x.pointerId;return qd.set(C,Vd(qd.get(C)||null,l,d,p,v,x)),!0;case"gotpointercapture":return C=x.pointerId,Hd.set(C,Vd(Hd.get(C)||null,l,d,p,v,x)),!0}return!1}function AM(l){var d=uc(l.target);if(d!==null){var p=r(d);if(p!==null){if(d=p.tag,d===13){if(d=o(p),d!==null){l.blockedOn=d,H1(l.priority,function(){EM(p)});return}}else if(d===31){if(d=a(p),d!==null){l.blockedOn=d,H1(l.priority,function(){EM(p)});return}}else if(d===3&&p.stateNode.current.memoizedState.isDehydrated){l.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}l.blockedOn=null}function om(l){if(l.blockedOn!==null)return!1;for(var d=l.targetContainers;0<d.length;){var p=q_(l.nativeEvent);if(p===null){p=l.nativeEvent;var v=new p.constructor(p.type,p);Hy=v,p.target.dispatchEvent(v),Hy=null}else return d=dc(p),d!==null&&TM(d),l.blockedOn=p,!1;d.shift()}return!0}function PM(l,d,p){om(l)&&p.delete(d)}function f8(){V_=!1,aa!==null&&om(aa)&&(aa=null),la!==null&&om(la)&&(la=null),ca!==null&&om(ca)&&(ca=null),qd.forEach(PM),Hd.forEach(PM)}function am(l,d){l.blockedOn===d&&(l.blockedOn=null,V_||(V_=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,f8)))}var lm=null;function LM(l){lm!==l&&(lm=l,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){lm===l&&(lm=null);for(var d=0;d<l.length;d+=3){var p=l[d],v=l[d+1],x=l[d+2];if(typeof v!="function"){if(H_(v||p)===null)continue;break}var C=dc(p);C!==null&&(l.splice(d,3),d-=3,qb(C,{pending:!0,data:x,method:p.method,action:v},v,x))}}))}function Wc(l){function d(Y){return am(Y,l)}aa!==null&&am(aa,l),la!==null&&am(la,l),ca!==null&&am(ca,l),qd.forEach(d),Hd.forEach(d);for(var p=0;p<ua.length;p++){var v=ua[p];v.blockedOn===l&&(v.blockedOn=null)}for(;0<ua.length&&(p=ua[0],p.blockedOn===null);)AM(p),p.blockedOn===null&&ua.shift();if(p=(l.ownerDocument||l).$$reactFormReplay,p!=null)for(v=0;v<p.length;v+=3){var x=p[v],C=p[v+1],D=x[Li]||null;if(typeof C=="function")D||LM(p);else if(D){var F=null;if(C&&C.hasAttribute("formAction")){if(x=C,D=C[Li]||null)F=D.formAction;else if(H_(x)!==null)continue}else F=D.action;typeof F=="function"?p[v+1]=F:(p.splice(v,3),v-=3),LM(p)}}}function NM(){function l(C){C.canIntercept&&C.info==="react-transition"&&C.intercept({handler:function(){return new Promise(function(D){return x=D})},focusReset:"manual",scroll:"manual"})}function d(){x!==null&&(x(),x=null),v||setTimeout(p,20)}function p(){if(!v&&!navigation.transition){var C=navigation.currentEntry;C&&C.url!=null&&navigation.navigate(C.url,{state:C.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var v=!1,x=null;return navigation.addEventListener("navigate",l),navigation.addEventListener("navigatesuccess",d),navigation.addEventListener("navigateerror",d),setTimeout(p,100),function(){v=!0,navigation.removeEventListener("navigate",l),navigation.removeEventListener("navigatesuccess",d),navigation.removeEventListener("navigateerror",d),x!==null&&(x(),x=null)}}}function W_(l){this._internalRoot=l}cm.prototype.render=W_.prototype.render=function(l){var d=this._internalRoot;if(d===null)throw Error(i(409));var p=d.current,v=ns();CM(p,v,l,d,null,null)},cm.prototype.unmount=W_.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var d=l.containerInfo;CM(l.current,2,null,l,null,null),qp(),d[cc]=null}};function cm(l){this._internalRoot=l}cm.prototype.unstable_scheduleHydration=function(l){if(l){var d=q1();l={blockedOn:null,target:l,priority:d};for(var p=0;p<ua.length&&d!==0&&d<ua[p].priority;p++);ua.splice(p,0,l),p===0&&AM(l)}};var IM=t.version;if(IM!=="19.2.3")throw Error(i(527,IM,"19.2.3"));W.findDOMNode=function(l){var d=l._reactInternals;if(d===void 0)throw typeof l.render=="function"?Error(i(188)):(l=Object.keys(l).join(","),Error(i(268,l)));return l=u(d),l=l!==null?h(l):null,l=l===null?null:l.stateNode,l};var p8={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:B,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var um=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!um.isDisabled&&um.supportsFiber)try{hn=um.inject(p8),Vt=um}catch{}}return Gd.createRoot=function(l,d){if(!s(l))throw Error(i(299));var p=!1,v="",x=zE,C=$E,D=qE;return d!=null&&(d.unstable_strictMode===!0&&(p=!0),d.identifierPrefix!==void 0&&(v=d.identifierPrefix),d.onUncaughtError!==void 0&&(x=d.onUncaughtError),d.onCaughtError!==void 0&&(C=d.onCaughtError),d.onRecoverableError!==void 0&&(D=d.onRecoverableError)),d=xM(l,1,!1,null,null,p,v,null,x,C,D,NM),l[cc]=d.current,E_(l),new W_(d)},Gd.hydrateRoot=function(l,d,p){if(!s(l))throw Error(i(299));var v=!1,x="",C=zE,D=$E,F=qE,Y=null;return p!=null&&(p.unstable_strictMode===!0&&(v=!0),p.identifierPrefix!==void 0&&(x=p.identifierPrefix),p.onUncaughtError!==void 0&&(C=p.onUncaughtError),p.onCaughtError!==void 0&&(D=p.onCaughtError),p.onRecoverableError!==void 0&&(F=p.onRecoverableError),p.formState!==void 0&&(Y=p.formState)),d=xM(l,1,!0,d,p??null,v,x,Y,C,D,F,NM),d.context=wM(null),p=d.current,v=ns(),v=Oy(v),x=Yo(v),x.callback=null,Xo(p,x,v),p=v,d.current.lanes=p,Xe(d,p),Sr(d),l[cc]=d.current,E_(l),new cm(d)},Gd.version="19.2.3",Gd}var HM;function C8(){if(HM)return Y_.exports;HM=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Y_.exports=w8(),Y_.exports}var k8=C8();const T8=Ql(k8);var zu=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},E8={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},R8=class{#e=E8;#t=!1;setTimeoutProvider(e){this.#e=e}setTimeout(e,t){return this.#e.setTimeout(e,t)}clearTimeout(e){this.#e.clearTimeout(e)}setInterval(e,t){return this.#e.setInterval(e,t)}clearInterval(e){this.#e.clearInterval(e)}},Al=new R8;function M8(e){setTimeout(e,0)}var Fl=typeof window>"u"||"Deno"in globalThis;function ki(){}function A8(e,t){return typeof e=="function"?e(t):e}function sx(e){return typeof e=="number"&&e>=0&&e!==1/0}function J2(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Aa(e,t){return typeof e=="function"?e(t):e}function Ps(e,t){return typeof e=="function"?e(t):e}function VM(e,t){const{type:n="all",exact:i,fetchStatus:s,predicate:r,queryKey:o,stale:a}=e;if(o){if(i){if(t.queryHash!==bC(o,t.options))return!1}else if(!Qh(t.queryKey,o))return!1}if(n!=="all"){const c=t.isActive();if(n==="active"&&!c||n==="inactive"&&c)return!1}return!(typeof a=="boolean"&&t.isStale()!==a||s&&s!==t.state.fetchStatus||r&&!r(t))}function WM(e,t){const{exact:n,status:i,predicate:s,mutationKey:r}=e;if(r){if(!t.options.mutationKey)return!1;if(n){if(Ul(t.options.mutationKey)!==Ul(r))return!1}else if(!Qh(t.options.mutationKey,r))return!1}return!(i&&t.state.status!==i||s&&!s(t))}function bC(e,t){return(t?.queryKeyHashFn||Ul)(e)}function Ul(e){return JSON.stringify(e,(t,n)=>rx(n)?Object.keys(n).sort().reduce((i,s)=>(i[s]=n[s],i),{}):n)}function Qh(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>Qh(e[n],t[n])):!1}var P8=Object.prototype.hasOwnProperty;function Z2(e,t){if(e===t)return e;const n=GM(e)&&GM(t);if(!n&&!(rx(e)&&rx(t)))return t;const s=(n?e:Object.keys(e)).length,r=n?t:Object.keys(t),o=r.length,a=n?new Array(o):{};let c=0;for(let u=0;u<o;u++){const h=n?u:r[u],f=e[h],m=t[h];if(f===m){a[h]=f,(n?u<s:P8.call(e,h))&&c++;continue}if(f===null||m===null||typeof f!="object"||typeof m!="object"){a[h]=m;continue}const y=Z2(f,m);a[h]=y,y===f&&c++}return s===o&&c===s?e:a}function Ug(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function GM(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function rx(e){if(!KM(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!KM(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function KM(e){return Object.prototype.toString.call(e)==="[object Object]"}function L8(e){return new Promise(t=>{Al.setTimeout(t,e)})}function ox(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?Z2(e,t):t}function N8(e,t,n=0){const i=[...e,t];return n&&i.length>n?i.slice(1):i}function I8(e,t,n=0){const i=[t,...e];return n&&i.length>n?i.slice(0,-1):i}var _C=Symbol();function eD(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===_C?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function tD(e,t){return typeof e=="function"?e(...t):!!e}var D8=class extends zu{#e;#t;#n;constructor(){super(),this.#n=e=>{if(!Fl&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#n=e,this.#t?.(),this.#t=e(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(e){this.#e!==e&&(this.#e=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},SC=new D8;function ax(){let e,t;const n=new Promise((s,r)=>{e=s,t=r});n.status="pending",n.catch(()=>{});function i(s){Object.assign(n,s),delete n.resolve,delete n.reject}return n.resolve=s=>{i({status:"fulfilled",value:s}),e(s)},n.reject=s=>{i({status:"rejected",reason:s}),t(s)},n}var O8=M8;function j8(){let e=[],t=0,n=a=>{a()},i=a=>{a()},s=O8;const r=a=>{t?e.push(a):s(()=>{n(a)})},o=()=>{const a=e;e=[],a.length&&s(()=>{i(()=>{a.forEach(c=>{n(c)})})})};return{batch:a=>{let c;t++;try{c=a()}finally{t--,t||o()}return c},batchCalls:a=>(...c)=>{r(()=>{a(...c)})},schedule:r,setNotifyFunction:a=>{n=a},setBatchNotifyFunction:a=>{i=a},setScheduler:a=>{s=a}}}var Dn=j8(),B8=class extends zu{#e=!0;#t;#n;constructor(){super(),this.#n=e=>{if(!Fl&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#n=e,this.#t?.(),this.#t=e(this.setOnline.bind(this))}setOnline(e){this.#e!==e&&(this.#e=e,this.listeners.forEach(n=>{n(e)}))}isOnline(){return this.#e}},zg=new B8;function F8(e){return Math.min(1e3*2**e,3e4)}function nD(e){return(e??"online")==="online"?zg.isOnline():!0}var lx=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function iD(e){let t=!1,n=0,i;const s=ax(),r=()=>s.status!=="pending",o=S=>{if(!r()){const _=new lx(S);m(_),e.onCancel?.(_)}},a=()=>{t=!0},c=()=>{t=!1},u=()=>SC.isFocused()&&(e.networkMode==="always"||zg.isOnline())&&e.canRun(),h=()=>nD(e.networkMode)&&e.canRun(),f=S=>{r()||(i?.(),s.resolve(S))},m=S=>{r()||(i?.(),s.reject(S))},y=()=>new Promise(S=>{i=_=>{(r()||u())&&S(_)},e.onPause?.()}).then(()=>{i=void 0,r()||e.onContinue?.()}),b=()=>{if(r())return;let S;const _=n===0?e.initialPromise:void 0;try{S=_??e.fn()}catch(w){S=Promise.reject(w)}Promise.resolve(S).then(f).catch(w=>{if(r())return;const M=e.retry??(Fl?0:3),R=e.retryDelay??F8,E=typeof R=="function"?R(n,w):R,A=M===!0||typeof M=="number"&&n<M||typeof M=="function"&&M(n,w);if(t||!A){m(w);return}n++,e.onFail?.(n,w),L8(E).then(()=>u()?void 0:y()).then(()=>{t?m(w):b()})})};return{promise:s,status:()=>s.status,cancel:o,continue:()=>(i?.(),s),cancelRetry:a,continueRetry:c,canStart:h,start:()=>(h()?b():y().then(b),s)}}var sD=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),sx(this.gcTime)&&(this.#e=Al.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Fl?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Al.clearTimeout(this.#e),this.#e=void 0)}},U8=class extends sD{#e;#t;#n;#s;#i;#r;#a;constructor(e){super(),this.#a=!1,this.#r=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#s=e.client,this.#n=this.#s.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=XM(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(e){if(this.options={...this.#r,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=XM(this.options);t.data!==void 0&&(this.setState(YM(t.data,t.dataUpdatedAt)),this.#e=t)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,t){const n=ox(this.state.data,e,this.options);return this.#o({data:n,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),n}setState(e,t){this.#o({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#i?.promise;return this.#i?.cancel(e),t?t.then(ki).catch(ki):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Ps(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===_C||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Aa(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!J2(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#i&&(this.#a?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#o({type:"invalidate"})}async fetch(e,t){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(e&&this.setOptions(e),!this.options.queryFn){const a=this.observers.find(c=>c.options.queryFn);a&&this.setOptions(a.options)}const n=new AbortController,i=a=>{Object.defineProperty(a,"signal",{enumerable:!0,get:()=>(this.#a=!0,n.signal)})},s=()=>{const a=eD(this.options,t),u=(()=>{const h={client:this.#s,queryKey:this.queryKey,meta:this.meta};return i(h),h})();return this.#a=!1,this.options.persister?this.options.persister(a,u,this):a(u)},o=(()=>{const a={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:s};return i(a),a})();this.options.behavior?.onFetch(o,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==o.fetchOptions?.meta)&&this.#o({type:"fetch",meta:o.fetchOptions?.meta}),this.#i=iD({initialPromise:t?.initialPromise,fn:o.fetchFn,onCancel:a=>{a instanceof lx&&a.revert&&this.setState({...this.#t,fetchStatus:"idle"}),n.abort()},onFail:(a,c)=>{this.#o({type:"failed",failureCount:a,error:c})},onPause:()=>{this.#o({type:"pause"})},onContinue:()=>{this.#o({type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0});try{const a=await this.#i.start();if(a===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(a),this.#n.config.onSuccess?.(a,this),this.#n.config.onSettled?.(a,this.state.error,this),a}catch(a){if(a instanceof lx){if(a.silent)return this.#i.promise;if(a.revert){if(this.state.data===void 0)throw a;return this.state.data}}throw this.#o({type:"error",error:a}),this.#n.config.onError?.(a,this),this.#n.config.onSettled?.(this.state.data,a,this),a}finally{this.scheduleGc()}}#o(e){const t=n=>{switch(e.type){case"failed":return{...n,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...rD(n.data,this.options),fetchMeta:e.meta??null};case"success":const i={...n,...YM(e.data,e.dataUpdatedAt),dataUpdateCount:n.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?i:void 0,i;case"error":const s=e.error;return{...n,error:s,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...e.state}}};this.state=t(this.state),Dn.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function rD(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:nD(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function YM(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function XM(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,i=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var z8=class extends zu{constructor(e,t){super(),this.options=t,this.#e=e,this.#o=null,this.#a=ax(),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#n=void 0;#s=void 0;#i;#r;#a;#o;#m;#h;#f;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),QM(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return cx(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return cx(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#_(),this.#S(),this.#t.removeObserver(this)}setOptions(e){const t=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Ps(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#x(),this.#t.setOptions(this.options),t._defaulted&&!Ug(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const i=this.hasListeners();i&&JM(this.#t,n,this.options,t)&&this.#d(),this.updateResult(),i&&(this.#t!==n||Ps(this.options.enabled,this.#t)!==Ps(t.enabled,this.#t)||Aa(this.options.staleTime,this.#t)!==Aa(t.staleTime,this.#t))&&this.#g();const s=this.#v();i&&(this.#t!==n||Ps(this.options.enabled,this.#t)!==Ps(t.enabled,this.#t)||s!==this.#l)&&this.#y(s)}getOptimisticResult(e){const t=this.#e.getQueryCache().build(this.#e,e),n=this.createResult(t,e);return q8(this,n)&&(this.#s=n,this.#r=this.options,this.#i=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(e,t){return new Proxy(e,{get:(n,i)=>(this.trackProp(i),t?.(i),i==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,i))})}trackProp(e){this.#p.add(e)}getCurrentQuery(){return this.#t}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#e.defaultQueryOptions(e),n=this.#e.getQueryCache().build(this.#e,t);return n.fetch().then(()=>this.createResult(n,t))}fetch(e){return this.#d({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(e){this.#x();let t=this.#t.fetch(this.options,e);return e?.throwOnError||(t=t.catch(ki)),t}#g(){this.#_();const e=Aa(this.options.staleTime,this.#t);if(Fl||this.#s.isStale||!sx(e))return;const n=J2(this.#s.dataUpdatedAt,e)+1;this.#c=Al.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#v(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#y(e){this.#S(),this.#l=e,!(Fl||Ps(this.options.enabled,this.#t)===!1||!sx(this.#l)||this.#l===0)&&(this.#u=Al.setInterval(()=>{(this.options.refetchIntervalInBackground||SC.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#y(this.#v())}#_(){this.#c&&(Al.clearTimeout(this.#c),this.#c=void 0)}#S(){this.#u&&(Al.clearInterval(this.#u),this.#u=void 0)}createResult(e,t){const n=this.#t,i=this.options,s=this.#s,r=this.#i,o=this.#r,c=e!==n?e.state:this.#n,{state:u}=e;let h={...u},f=!1,m;if(t._optimisticResults){const P=this.hasListeners(),I=!P&&QM(e,t),N=P&&JM(e,n,t,i);(I||N)&&(h={...h,...rD(u.data,e.options)}),t._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:y,errorUpdatedAt:b,status:S}=h;m=h.data;let _=!1;if(t.placeholderData!==void 0&&m===void 0&&S==="pending"){let P;s?.isPlaceholderData&&t.placeholderData===o?.placeholderData?(P=s.data,_=!0):P=typeof t.placeholderData=="function"?t.placeholderData(this.#f?.state.data,this.#f):t.placeholderData,P!==void 0&&(S="success",m=ox(s?.data,P,t),f=!0)}if(t.select&&m!==void 0&&!_)if(s&&m===r?.data&&t.select===this.#m)m=this.#h;else try{this.#m=t.select,m=t.select(m),m=ox(s?.data,m,t),this.#h=m,this.#o=null}catch(P){this.#o=P}this.#o&&(y=this.#o,m=this.#h,b=Date.now(),S="error");const w=h.fetchStatus==="fetching",M=S==="pending",R=S==="error",E=M&&w,A=m!==void 0,L={status:S,fetchStatus:h.fetchStatus,isPending:M,isSuccess:S==="success",isError:R,isInitialLoading:E,isLoading:E,data:m,dataUpdatedAt:h.dataUpdatedAt,error:y,errorUpdatedAt:b,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>c.dataUpdateCount||h.errorUpdateCount>c.errorUpdateCount,isFetching:w,isRefetching:w&&!M,isLoadingError:R&&!A,isPaused:h.fetchStatus==="paused",isPlaceholderData:f,isRefetchError:R&&A,isStale:xC(e,t),refetch:this.refetch,promise:this.#a,isEnabled:Ps(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const P=O=>{L.status==="error"?O.reject(L.error):L.data!==void 0&&O.resolve(L.data)},I=()=>{const O=this.#a=L.promise=ax();P(O)},N=this.#a;switch(N.status){case"pending":e.queryHash===n.queryHash&&P(N);break;case"fulfilled":(L.status==="error"||L.data!==N.value)&&I();break;case"rejected":(L.status!=="error"||L.error!==N.reason)&&I();break}}return L}updateResult(){const e=this.#s,t=this.createResult(this.#t,this.options);if(this.#i=this.#t.state,this.#r=this.options,this.#i.data!==void 0&&(this.#f=this.#t),Ug(t,e))return;this.#s=t;const n=()=>{if(!e)return!0;const{notifyOnChangeProps:i}=this.options,s=typeof i=="function"?i():i;if(s==="all"||!s&&!this.#p.size)return!0;const r=new Set(s??this.#p);return this.options.throwOnError&&r.add("error"),Object.keys(this.#s).some(o=>{const a=o;return this.#s[a]!==e[a]&&r.has(a)})};this.#w({listeners:n()})}#x(){const e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#t)return;const t=this.#t;this.#t=e,this.#n=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#w(e){Dn.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function $8(e,t){return Ps(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function QM(e,t){return $8(e,t)||e.state.data!==void 0&&cx(e,t,t.refetchOnMount)}function cx(e,t,n){if(Ps(t.enabled,e)!==!1&&Aa(t.staleTime,e)!=="static"){const i=typeof n=="function"?n(e):n;return i==="always"||i!==!1&&xC(e,t)}return!1}function JM(e,t,n,i){return(e!==t||Ps(i.enabled,e)===!1)&&(!n.suspense||e.state.status!=="error")&&xC(e,n)}function xC(e,t){return Ps(t.enabled,e)!==!1&&e.isStaleByTime(Aa(t.staleTime,e))}function q8(e,t){return!Ug(e.getCurrentResult(),t)}function ZM(e){return{onFetch:(t,n)=>{const i=t.options,s=t.fetchOptions?.meta?.fetchMore?.direction,r=t.state.data?.pages||[],o=t.state.data?.pageParams||[];let a={pages:[],pageParams:[]},c=0;const u=async()=>{let h=!1;const f=b=>{Object.defineProperty(b,"signal",{enumerable:!0,get:()=>(t.signal.aborted?h=!0:t.signal.addEventListener("abort",()=>{h=!0}),t.signal)})},m=eD(t.options,t.fetchOptions),y=async(b,S,_)=>{if(h)return Promise.reject();if(S==null&&b.pages.length)return Promise.resolve(b);const M=(()=>{const T={client:t.client,queryKey:t.queryKey,pageParam:S,direction:_?"backward":"forward",meta:t.options.meta};return f(T),T})(),R=await m(M),{maxPages:E}=t.options,A=_?I8:N8;return{pages:A(b.pages,R,E),pageParams:A(b.pageParams,S,E)}};if(s&&r.length){const b=s==="backward",S=b?H8:eA,_={pages:r,pageParams:o},w=S(i,_);a=await y(_,w,b)}else{const b=e??r.length;do{const S=c===0?o[0]??i.initialPageParam:eA(i,a);if(c>0&&S==null)break;a=await y(a,S),c++}while(c<b)}return a};t.options.persister?t.fetchFn=()=>t.options.persister?.(u,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n):t.fetchFn=u}}}function eA(e,{pages:t,pageParams:n}){const i=t.length-1;return t.length>0?e.getNextPageParam(t[i],t,n[i],n):void 0}function H8(e,{pages:t,pageParams:n}){return t.length>0?e.getPreviousPageParam?.(t[0],t,n[0],n):void 0}var V8=class extends sD{#e;#t;#n;#s;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||oD(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(t=>t!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#i({type:"continue"})},n={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=iD({fn:()=>this.options.mutationFn?this.options.mutationFn(e,n):Promise.reject(new Error("No mutationFn found")),onFail:(r,o)=>{this.#i({type:"failed",failureCount:r,error:o})},onPause:()=>{this.#i({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const i=this.state.status==="pending",s=!this.#s.canStart();try{if(i)t();else{this.#i({type:"pending",variables:e,isPaused:s}),await this.#n.config.onMutate?.(e,this,n);const o=await this.options.onMutate?.(e,n);o!==this.state.context&&this.#i({type:"pending",context:o,variables:e,isPaused:s})}const r=await this.#s.start();return await this.#n.config.onSuccess?.(r,e,this.state.context,this,n),await this.options.onSuccess?.(r,e,this.state.context,n),await this.#n.config.onSettled?.(r,null,this.state.variables,this.state.context,this,n),await this.options.onSettled?.(r,null,e,this.state.context,n),this.#i({type:"success",data:r}),r}catch(r){try{throw await this.#n.config.onError?.(r,e,this.state.context,this,n),await this.options.onError?.(r,e,this.state.context,n),await this.#n.config.onSettled?.(void 0,r,this.state.variables,this.state.context,this,n),await this.options.onSettled?.(void 0,r,e,this.state.context,n),r}finally{this.#i({type:"error",error:r})}}finally{this.#n.runNext(this)}}#i(e){const t=n=>{switch(e.type){case"failed":return{...n,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...n,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:e.error,failureCount:n.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Dn.batch(()=>{this.#t.forEach(n=>{n.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function oD(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var W8=class extends zu{constructor(e={}){super(),this.config=e,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(e,t,n){const i=new V8({client:e,mutationCache:this,mutationId:++this.#n,options:e.defaultMutationOptions(t),state:n});return this.add(i),i}add(e){this.#e.add(e);const t=dm(e);if(typeof t=="string"){const n=this.#t.get(t);n?n.push(e):this.#t.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#e.delete(e)){const t=dm(e);if(typeof t=="string"){const n=this.#t.get(t);if(n)if(n.length>1){const i=n.indexOf(e);i!==-1&&n.splice(i,1)}else n[0]===e&&this.#t.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=dm(e);if(typeof t=="string"){const i=this.#t.get(t)?.find(s=>s.state.status==="pending");return!i||i===e}else return!0}runNext(e){const t=dm(e);return typeof t=="string"?this.#t.get(t)?.find(i=>i!==e&&i.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Dn.batch(()=>{this.#e.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(e){const t={exact:!0,...e};return this.getAll().find(n=>WM(t,n))}findAll(e={}){return this.getAll().filter(t=>WM(e,t))}notify(e){Dn.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return Dn.batch(()=>Promise.all(e.map(t=>t.continue().catch(ki))))}};function dm(e){return e.options.scope?.id}var G8=class extends zu{#e;#t=void 0;#n;#s;constructor(t,n){super(),this.#e=t,this.setOptions(n),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const n=this.options;this.options=this.#e.defaultMutationOptions(t),Ug(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&Ul(n.mutationKey)!==Ul(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#r(t)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#i(),this.#r()}mutate(t,n){return this.#s=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(t)}#i(){const t=this.#n?.state??oD();this.#t={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#r(t){Dn.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,i=this.#t.context,s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};t?.type==="success"?(this.#s.onSuccess?.(t.data,n,i,s),this.#s.onSettled?.(t.data,null,n,i,s)):t?.type==="error"&&(this.#s.onError?.(t.error,n,i,s),this.#s.onSettled?.(void 0,t.error,n,i,s))}this.listeners.forEach(n=>{n(this.#t)})})}},K8=class extends zu{constructor(e={}){super(),this.config=e,this.#e=new Map}#e;build(e,t,n){const i=t.queryKey,s=t.queryHash??bC(i,t);let r=this.get(s);return r||(r=new U8({client:e,queryKey:i,queryHash:s,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(i)}),this.add(r)),r}add(e){this.#e.has(e.queryHash)||(this.#e.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#e.get(e.queryHash);t&&(e.destroy(),t===e&&this.#e.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Dn.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#e.get(e)}getAll(){return[...this.#e.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(n=>VM(t,n))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(n=>VM(e,n)):t}notify(e){Dn.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Dn.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Dn.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Y8=class{#e;#t;#n;#s;#i;#r;#a;#o;constructor(e={}){this.#e=e.queryCache||new K8,this.#t=e.mutationCache||new W8,this.#n=e.defaultOptions||{},this.#s=new Map,this.#i=new Map,this.#r=0}mount(){this.#r++,this.#r===1&&(this.#a=SC.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#o=zg.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#r--,this.#r===0&&(this.#a?.(),this.#a=void 0,this.#o?.(),this.#o=void 0)}isFetching(e){return this.#e.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#t.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=this.#e.build(this,t),i=n.state.data;return i===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Aa(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(i))}getQueriesData(e){return this.#e.findAll(e).map(({queryKey:t,state:n})=>{const i=n.data;return[t,i]})}setQueryData(e,t,n){const i=this.defaultQueryOptions({queryKey:e}),r=this.#e.get(i.queryHash)?.state.data,o=A8(t,r);if(o!==void 0)return this.#e.build(this,i).setData(o,{...n,manual:!0})}setQueriesData(e,t,n){return Dn.batch(()=>this.#e.findAll(e).map(({queryKey:i})=>[i,this.setQueryData(i,t,n)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state}removeQueries(e){const t=this.#e;Dn.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=this.#e;return Dn.batch(()=>(n.findAll(e).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},i=Dn.batch(()=>this.#e.findAll(e).map(s=>s.cancel(n)));return Promise.all(i).then(ki).catch(ki)}invalidateQueries(e,t={}){return Dn.batch(()=>(this.#e.findAll(e).forEach(n=>{n.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},i=Dn.batch(()=>this.#e.findAll(e).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let r=s.fetch(void 0,n);return n.throwOnError||(r=r.catch(ki)),s.state.fetchStatus==="paused"?Promise.resolve():r}));return Promise.all(i).then(ki)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=this.#e.build(this,t);return n.isStaleByTime(Aa(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(ki).catch(ki)}fetchInfiniteQuery(e){return e.behavior=ZM(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(ki).catch(ki)}ensureInfiniteQueryData(e){return e.behavior=ZM(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return zg.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(e){this.#n=e}setQueryDefaults(e,t){this.#s.set(Ul(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#s.values()],n={};return t.forEach(i=>{Qh(e,i.queryKey)&&Object.assign(n,i.defaultOptions)}),n}setMutationDefaults(e,t){this.#i.set(Ul(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#i.values()],n={};return t.forEach(i=>{Qh(e,i.mutationKey)&&Object.assign(n,i.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#n.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=bC(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===_C&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#n.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},aD=k.createContext(void 0),jo=e=>{const t=k.useContext(aD);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},X8=({client:e,children:t})=>(k.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),g.jsx(aD.Provider,{value:e,children:t})),lD=k.createContext(!1),Q8=()=>k.useContext(lD);lD.Provider;function J8(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Z8=k.createContext(J8()),e$=()=>k.useContext(Z8),t$=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},n$=e=>{k.useEffect(()=>{e.clearReset()},[e])},i$=({result:e,errorResetBoundary:t,throwOnError:n,query:i,suspense:s})=>e.isError&&!t.isReset()&&!e.isFetching&&i&&(s&&e.data===void 0||tD(n,[e.error,i])),s$=e=>{if(e.suspense){const n=s=>s==="static"?s:Math.max(s??1e3,1e3),i=e.staleTime;e.staleTime=typeof i=="function"?(...s)=>n(i(...s)):n(i),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},r$=(e,t)=>e.isLoading&&e.isFetching&&!t,o$=(e,t)=>e?.suspense&&t.isPending,tA=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function a$(e,t,n){const i=Q8(),s=e$(),r=jo(),o=r.defaultQueryOptions(e);r.getDefaultOptions().queries?._experimental_beforeQuery?.(o),o._optimisticResults=i?"isRestoring":"optimistic",s$(o),t$(o,s),n$(s);const a=!r.getQueryCache().get(o.queryHash),[c]=k.useState(()=>new t(r,o)),u=c.getOptimisticResult(o),h=!i&&e.subscribed!==!1;if(k.useSyncExternalStore(k.useCallback(f=>{const m=h?c.subscribe(Dn.batchCalls(f)):ki;return c.updateResult(),m},[c,h]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),k.useEffect(()=>{c.setOptions(o)},[o,c]),o$(o,u))throw tA(o,c,s);if(i$({result:u,errorResetBoundary:s,throwOnError:o.throwOnError,query:r.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw u.error;return r.getDefaultOptions().queries?._experimental_afterQuery?.(o,u),o.experimental_prefetchInRender&&!Fl&&r$(u,i)&&(a?tA(o,c,s):r.getQueryCache().get(o.queryHash)?.promise)?.catch(ki).finally(()=>{c.updateResult()}),o.notifyOnChangeProps?u:c.trackResult(u)}function Fr(e,t){return a$(e,z8)}function wo(e,t){const n=jo(),[i]=k.useState(()=>new G8(n,e));k.useEffect(()=>{i.setOptions(e)},[i,e]);const s=k.useSyncExternalStore(k.useCallback(o=>i.subscribe(Dn.batchCalls(o)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),r=k.useCallback((o,a)=>{i.mutate(o,a).catch(ki)},[i]);if(s.error&&tD(i.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:r,mutateAsync:s.mutate}}const l$="modulepreload",c$=function(e){return"/"+e},nA={},xt=function(t,n,i){let s=Promise.resolve();if(n&&n.length>0){let c=function(u){return Promise.all(u.map(h=>Promise.resolve(h).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");s=c(n.map(u=>{if(u=c$(u),u in nA)return;nA[u]=!0;const h=u.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":l$,h||(m.as="script"),m.crossOrigin="",m.href=u,a&&m.setAttribute("nonce",a),document.head.appendChild(m),h)return new Promise((y,b)=>{m.addEventListener("load",y),m.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})},ux=new WeakMap,u$=new WeakMap,$g={current:[]};let Z_=!1,Ph=0;const vh=new Set,hm=new Map;function cD(e){for(const t of e){if($g.current.includes(t))continue;$g.current.push(t),t.recompute();const n=u$.get(t);if(n)for(const i of n){const s=ux.get(i);s?.length&&cD(s)}}}function d$(e){const t={prevVal:e.prevState,currentVal:e.state};for(const n of e.listeners)n(t)}function h$(e){const t={prevVal:e.prevState,currentVal:e.state};for(const n of e.listeners)n(t)}function uD(e){if(Ph>0&&!hm.has(e)&&hm.set(e,e.prevState),vh.add(e),!(Ph>0)&&!Z_)try{for(Z_=!0;vh.size>0;){const t=Array.from(vh);vh.clear();for(const n of t){const i=hm.get(n)??n.prevState;n.prevState=i,d$(n)}for(const n of t){const i=ux.get(n);i&&($g.current.push(n),cD(i))}for(const n of t){const i=ux.get(n);if(i)for(const s of i)h$(s)}}}finally{Z_=!1,$g.current=[],hm.clear()}}function Lh(e){Ph++;try{e()}finally{if(Ph--,Ph===0){const t=vh.values().next().value;t&&uD(t)}}}function f$(e){return typeof e=="function"}class p${constructor(t,n){this.listeners=new Set,this.subscribe=i=>{var s,r;this.listeners.add(i);const o=(r=(s=this.options)==null?void 0:s.onSubscribe)==null?void 0:r.call(s,i,this);return()=>{this.listeners.delete(i),o?.()}},this.prevState=t,this.state=t,this.options=n}setState(t){var n,i,s;this.prevState=this.state,(n=this.options)!=null&&n.updateFn?this.state=this.options.updateFn(this.prevState)(t):f$(t)?this.state=t(this.prevState):this.state=t,(s=(i=this.options)==null?void 0:i.onUpdate)==null||s.call(i),uD(this)}}const Pa="__TSR_index",iA="popstate",sA="beforeunload";function dD(e){let t=e.getLocation();const n=new Set,i=o=>{t=e.getLocation(),n.forEach(a=>a({location:t,action:o}))},s=o=>{e.notifyOnIndexChange??!0?i(o):t=e.getLocation()},r=async({task:o,navigateOpts:a,...c})=>{if(a?.ignoreBlocker??!1){o();return}const h=e.getBlockers?.()??[],f=c.type==="PUSH"||c.type==="REPLACE";if(typeof document<"u"&&h.length&&f)for(const m of h){const y=Jh(c.path,c.state);if(await m.blockerFn({currentLocation:t,nextLocation:y,action:c.type})){e.onBlocked?.();return}}o()};return{get location(){return t},get length(){return e.getLength()},subscribers:n,subscribe:o=>(n.add(o),()=>{n.delete(o)}),push:(o,a,c)=>{const u=t.state[Pa];a=dx(u+1,a),r({task:()=>{e.pushState(o,a),i({type:"PUSH"})},navigateOpts:c,type:"PUSH",path:o,state:a})},replace:(o,a,c)=>{const u=t.state[Pa];a=dx(u,a),r({task:()=>{e.replaceState(o,a),i({type:"REPLACE"})},navigateOpts:c,type:"REPLACE",path:o,state:a})},go:(o,a)=>{r({task:()=>{e.go(o),s({type:"GO",index:o})},navigateOpts:a,type:"GO"})},back:o=>{r({task:()=>{e.back(o?.ignoreBlocker??!1),s({type:"BACK"})},navigateOpts:o,type:"BACK"})},forward:o=>{r({task:()=>{e.forward(o?.ignoreBlocker??!1),s({type:"FORWARD"})},navigateOpts:o,type:"FORWARD"})},canGoBack:()=>t.state[Pa]!==0,createHref:o=>e.createHref(o),block:o=>{if(!e.setBlockers)return()=>{};const a=e.getBlockers?.()??[];return e.setBlockers([...a,o]),()=>{const c=e.getBlockers?.()??[];e.setBlockers?.(c.filter(u=>u!==o))}},flush:()=>e.flush?.(),destroy:()=>e.destroy?.(),notify:i}}function dx(e,t){t||(t={});const n=wC();return{...t,key:n,__TSR_key:n,[Pa]:e}}function m$(e){const t=typeof document<"u"?window:void 0,n=t.history.pushState,i=t.history.replaceState;let s=[];const r=()=>s,o=P=>s=P,a=(P=>P),c=(()=>Jh(`${t.location.pathname}${t.location.search}${t.location.hash}`,t.history.state));if(!t.history.state?.__TSR_key&&!t.history.state?.key){const P=wC();t.history.replaceState({[Pa]:0,key:P,__TSR_key:P},"")}let u=c(),h,f=!1,m=!1,y=!1,b=!1;const S=()=>u;let _,w;const M=()=>{_&&(L._ignoreSubscribers=!0,(_.isPush?t.history.pushState:t.history.replaceState)(_.state,"",_.href),L._ignoreSubscribers=!1,_=void 0,w=void 0,h=void 0)},R=(P,I,N)=>{const O=a(I);w||(h=u),u=Jh(I,N),_={href:O,state:N,isPush:_?.isPush||P==="push"},w||(w=Promise.resolve().then(()=>M()))},E=P=>{u=c(),L.notify({type:P})},A=async()=>{if(m){m=!1;return}const P=c(),I=P.state[Pa]-u.state[Pa],N=I===1,O=I===-1,j=!N&&!O||f;f=!1;const $=j?"GO":O?"BACK":"FORWARD",V=j?{type:"GO",index:I}:{type:O?"BACK":"FORWARD"};if(y)y=!1;else{const H=r();if(typeof document<"u"&&H.length){for(const B of H)if(await B.blockerFn({currentLocation:u,nextLocation:P,action:$})){m=!0,t.history.go(1),L.notify(V);return}}}u=c(),L.notify(V)},T=P=>{if(b){b=!1;return}let I=!1;const N=r();if(typeof document<"u"&&N.length)for(const O of N){const j=O.enableBeforeUnload??!0;if(j===!0){I=!0;break}if(typeof j=="function"&&j()===!0){I=!0;break}}if(I)return P.preventDefault(),P.returnValue=""},L=dD({getLocation:S,getLength:()=>t.history.length,pushState:(P,I)=>R("push",P,I),replaceState:(P,I)=>R("replace",P,I),back:P=>(P&&(y=!0),b=!0,t.history.back()),forward:P=>{P&&(y=!0),b=!0,t.history.forward()},go:P=>{f=!0,t.history.go(P)},createHref:P=>a(P),flush:M,destroy:()=>{t.history.pushState=n,t.history.replaceState=i,t.removeEventListener(sA,T,{capture:!0}),t.removeEventListener(iA,A)},onBlocked:()=>{h&&u!==h&&(u=h)},getBlockers:r,setBlockers:o,notifyOnIndexChange:!1});return t.addEventListener(sA,T,{capture:!0}),t.addEventListener(iA,A),t.history.pushState=function(...P){const I=n.apply(t.history,P);return L._ignoreSubscribers||E("PUSH"),I},t.history.replaceState=function(...P){const I=i.apply(t.history,P);return L._ignoreSubscribers||E("REPLACE"),I},L}function g$(e={initialEntries:["/"]}){const t=e.initialEntries;let n=e.initialIndex?Math.min(Math.max(e.initialIndex,0),t.length-1):t.length-1;const i=t.map((r,o)=>dx(o,void 0));return dD({getLocation:()=>Jh(t[n],i[n]),getLength:()=>t.length,pushState:(r,o)=>{n<t.length-1&&(t.splice(n+1),i.splice(n+1)),i.push(o),t.push(r),n=Math.max(t.length-1,0)},replaceState:(r,o)=>{i[n]=o,t[n]=r},back:()=>{n=Math.max(n-1,0)},forward:()=>{n=Math.min(n+1,t.length-1)},go:r=>{n=Math.min(Math.max(n+r,0),t.length-1)},createHref:r=>r})}function Jh(e,t){const n=e.indexOf("#"),i=e.indexOf("?"),s=wC();return{href:e,pathname:e.substring(0,n>0?i>0?Math.min(n,i):n:i>0?i:e.length),hash:n>-1?e.substring(n):"",search:i>-1?e.slice(i,n===-1?void 0:n):"",state:t||{[Pa]:0,key:s,__TSR_key:s}}}function wC(){return(Math.random()+1).toString(36).substring(7)}function qg(e){return e[e.length-1]}function v$(e){return typeof e=="function"}function ka(e,t){return v$(e)?e(t):e}const y$=Object.prototype.hasOwnProperty;function Rs(e,t){if(e===t)return e;const n=t,i=aA(e)&&aA(n);if(!i&&!(Hg(e)&&Hg(n)))return n;const s=i?e:rA(e);if(!s)return n;const r=i?n:rA(n);if(!r)return n;const o=s.length,a=r.length,c=i?new Array(a):{};let u=0;for(let h=0;h<a;h++){const f=i?h:r[h],m=e[f],y=n[f];if(m===y){c[f]=m,(i?h<o:y$.call(e,f))&&u++;continue}if(m===null||y===null||typeof m!="object"||typeof y!="object"){c[f]=y;continue}const b=Rs(m,y);c[f]=b,b===m&&u++}return o===a&&u===o?e:c}function rA(e){const t=[],n=Object.getOwnPropertyNames(e);for(const s of n){if(!Object.prototype.propertyIsEnumerable.call(e,s))return!1;t.push(s)}const i=Object.getOwnPropertySymbols(e);for(const s of i){if(!Object.prototype.propertyIsEnumerable.call(e,s))return!1;t.push(s)}return t}function Hg(e){if(!oA(e))return!1;const t=e.constructor;if(typeof t>"u")return!0;const n=t.prototype;return!(!oA(n)||!n.hasOwnProperty("isPrototypeOf"))}function oA(e){return Object.prototype.toString.call(e)==="[object Object]"}function aA(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function Dl(e,t,n){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let i=0,s=e.length;i<s;i++)if(!Dl(e[i],t[i],n))return!1;return!0}if(Hg(e)&&Hg(t)){const i=n?.ignoreUndefined??!0;if(n?.partial){for(const o in t)if((!i||t[o]!==void 0)&&!Dl(e[o],t[o],n))return!1;return!0}let s=0;if(!i)s=Object.keys(e).length;else for(const o in e)e[o]!==void 0&&s++;let r=0;for(const o in t)if((!i||t[o]!==void 0)&&(r++,r>s||!Dl(e[o],t[o],n)))return!1;return s===r}return!1}function Au(e){let t,n;const i=new Promise((s,r)=>{t=s,n=r});return i.status="pending",i.resolve=s=>{i.status="resolved",i.value=s,t(s),e?.(s)},i.reject=s=>{i.status="rejected",n(s)},i}function La(e){return!!(e&&typeof e=="object"&&typeof e.then=="function")}function lA(e){try{return decodeURI(e)}catch{return e.replaceAll(/%[0-9A-F]{2}/gi,t=>{try{return decodeURI(t)}catch{return t}})}}function cA(e,t){if(!e)return e;const n=/%25|%5C/gi;let i=0,s="",r;for(;(r=n.exec(e))!==null;)s+=lA(e.slice(i,r.index))+r[0],i=n.lastIndex;return s+lA(i?e.slice(i):e)}var b$="Invariant failed";function Do(e,t){if(!e)throw new Error(b$)}function Vg(e){const t=new Map;let n,i;const s=r=>{r.next&&(r.prev?(r.prev.next=r.next,r.next.prev=r.prev,r.next=void 0,i&&(i.next=r,r.prev=i)):(r.next.prev=void 0,n=r.next,r.next=void 0,i&&(r.prev=i,i.next=r)),i=r)};return{get(r){const o=t.get(r);if(o)return s(o),o.value},set(r,o){if(t.size>=e&&n){const c=n;t.delete(c.key),c.next&&(n=c.next,c.next.prev=void 0),c===i&&(i=void 0)}const a=t.get(r);if(a)a.value=o,s(a);else{const c={key:r,value:o,prev:i};i&&(i.next=c),i=c,n||(n=c),t.set(r,c)}},clear(){t.clear(),n=void 0,i=void 0}}}const Pu=0,zl=1,$l=2,Zh=3,du=4,_$=/^([^{]*)\{\$([a-zA-Z_$][a-zA-Z0-9_$]*)\}([^}]*)$/,S$=/^([^{]*)\{-\$([a-zA-Z_$][a-zA-Z0-9_$]*)\}([^}]*)$/,x$=/^([^{]*)\{\$\}([^}]*)$/;function CC(e,t,n=new Uint16Array(6)){const i=e.indexOf("/",t),s=i===-1?e.length:i,r=e.substring(t,s);if(!r||!r.includes("$"))return n[0]=Pu,n[1]=t,n[2]=t,n[3]=s,n[4]=s,n[5]=s,n;if(r==="$"){const u=e.length;return n[0]=$l,n[1]=t,n[2]=t,n[3]=u,n[4]=u,n[5]=u,n}if(r.charCodeAt(0)===36)return n[0]=zl,n[1]=t,n[2]=t+1,n[3]=s,n[4]=s,n[5]=s,n;const o=r.match(x$);if(o){const h=o[1].length;return n[0]=$l,n[1]=t+h,n[2]=t+h+1,n[3]=t+h+2,n[4]=t+h+3,n[5]=e.length,n}const a=r.match(S$);if(a){const u=a[1],h=a[2],f=a[3],m=u.length;return n[0]=Zh,n[1]=t+m,n[2]=t+m+3,n[3]=t+m+3+h.length,n[4]=s-f.length,n[5]=s,n}const c=r.match(_$);if(c){const u=c[1],h=c[2],f=c[3],m=u.length;return n[0]=zl,n[1]=t+m,n[2]=t+m+2,n[3]=t+m+2+h.length,n[4]=s-f.length,n[5]=s,n}return n[0]=Pu,n[1]=t,n[2]=t,n[3]=s,n[4]=s,n[5]=s,n}function Vv(e,t,n,i,s,r,o){o?.(n);let a=i;{const c=n.fullPath??n.from,u=c.length,h=n.options?.caseSensitive??e;for(;a<u;){const m=CC(c,a,t);let y;const b=a,S=m[5];switch(a=S+1,r++,m[0]){case Pu:{const w=c.substring(m[2],m[3]);if(h){const M=s.static?.get(w);if(M)y=M;else{s.static??=new Map;const R=vu(n.fullPath??n.from);R.parent=s,R.depth=r,y=R,s.static.set(w,R)}}else{const M=w.toLowerCase(),R=s.staticInsensitive?.get(M);if(R)y=R;else{s.staticInsensitive??=new Map;const E=vu(n.fullPath??n.from);E.parent=s,E.depth=r,y=E,s.staticInsensitive.set(M,E)}}break}case zl:{const w=c.substring(b,m[1]),M=c.substring(m[4],S),R=h&&!!(w||M),E=w?R?w:w.toLowerCase():void 0,A=M?R?M:M.toLowerCase():void 0,T=s.dynamic?.find(L=>L.caseSensitive===R&&L.prefix===E&&L.suffix===A);if(T)y=T;else{const L=t0(zl,n.fullPath??n.from,R,E,A);y=L,L.depth=r,L.parent=s,s.dynamic??=[],s.dynamic.push(L)}break}case Zh:{const w=c.substring(b,m[1]),M=c.substring(m[4],S),R=h&&!!(w||M),E=w?R?w:w.toLowerCase():void 0,A=M?R?M:M.toLowerCase():void 0,T=s.optional?.find(L=>L.caseSensitive===R&&L.prefix===E&&L.suffix===A);if(T)y=T;else{const L=t0(Zh,n.fullPath??n.from,R,E,A);y=L,L.parent=s,L.depth=r,s.optional??=[],s.optional.push(L)}break}case $l:{const w=c.substring(b,m[1]),M=c.substring(m[4],S),R=h&&!!(w||M),E=w?R?w:w.toLowerCase():void 0,A=M?R?M:M.toLowerCase():void 0,T=t0($l,n.fullPath??n.from,R,E,A);y=T,T.parent=s,T.depth=r,s.wildcard??=[],s.wildcard.push(T)}}s=y}const f=(n.path||!n.children)&&!n.isRoot;if(f&&c.endsWith("/")){const m=vu(n.fullPath??n.from);m.kind=du,m.parent=s,r++,m.depth=r,s.index=m,s=m}f&&!s.route&&(s.route=n,s.fullPath=n.fullPath??n.from)}if(n.children)for(const c of n.children)Vv(e,t,c,a,s,r,o)}function e0(e,t){if(e.prefix&&t.prefix&&e.prefix!==t.prefix){if(e.prefix.startsWith(t.prefix))return-1;if(t.prefix.startsWith(e.prefix))return 1}if(e.suffix&&t.suffix&&e.suffix!==t.suffix){if(e.suffix.endsWith(t.suffix))return-1;if(t.suffix.endsWith(e.suffix))return 1}return e.prefix&&!t.prefix?-1:!e.prefix&&t.prefix?1:e.suffix&&!t.suffix?-1:!e.suffix&&t.suffix?1:e.caseSensitive&&!t.caseSensitive?-1:!e.caseSensitive&&t.caseSensitive?1:0}function El(e){if(e.static)for(const t of e.static.values())El(t);if(e.staticInsensitive)for(const t of e.staticInsensitive.values())El(t);if(e.dynamic?.length){e.dynamic.sort(e0);for(const t of e.dynamic)El(t)}if(e.optional?.length){e.optional.sort(e0);for(const t of e.optional)El(t)}if(e.wildcard?.length){e.wildcard.sort(e0);for(const t of e.wildcard)El(t)}}function vu(e){return{kind:Pu,depth:0,index:null,static:null,staticInsensitive:null,dynamic:null,optional:null,wildcard:null,route:null,fullPath:e,parent:null}}function t0(e,t,n,i,s){return{kind:e,depth:0,index:null,static:null,staticInsensitive:null,dynamic:null,optional:null,wildcard:null,route:null,fullPath:t,parent:null,caseSensitive:n,prefix:i,suffix:s}}function w$(e,t){const n=vu("/"),i=new Uint16Array(6);for(const s of e)Vv(!1,i,s,1,n,0);El(n),t.masksTree=n,t.flatCache=Vg(1e3)}function C$(e,t){e||="/";const n=t.flatCache.get(e);if(n)return n;const i=kC(e,t.masksTree);return t.flatCache.set(e,i),i}function k$(e,t,n,i,s){e||="/",i||="/";const r=t?`case\0${e}`:e;let o=s.singleCache.get(r);if(!o){o=vu("/");const a=new Uint16Array(6);Vv(t,a,{from:e},1,o,0),s.singleCache.set(r,o)}return kC(i,o,n)}function T$(e,t,n=!1){const i=n?e:`nofuzz\0${e}`,s=t.matchCache.get(i);if(s!==void 0)return s;e||="/";const r=kC(e,t.segmentTree,n);return r&&(r.branch=A$(r.route)),t.matchCache.set(i,r),r}function E$(e){return e==="/"?e:e.replace(/\/{1,}$/,"")}function R$(e,t=!1,n){const i=vu(e.fullPath),s=new Uint16Array(6),r={},o={};let a=0;return Vv(t,s,e,1,i,0,u=>{if(n?.(u,a),Do(!(u.id in r),`Duplicate routes found with id: ${String(u.id)}`),r[u.id]=u,a!==0&&u.path){const h=E$(u.fullPath);(!o[h]||u.fullPath.endsWith("/"))&&(o[h]=u)}a++}),El(i),{processedTree:{segmentTree:i,singleCache:Vg(1e3),matchCache:Vg(1e3),flatCache:null,masksTree:null},routesById:r,routesByPath:o}}function kC(e,t,n=!1){const i=e.split("/"),s=L$(e,i,t,n);if(!s)return null;const r=M$(e,i,s);return"**"in s&&(r["**"]=s["**"]),{route:s.node.route,params:r}}function M$(e,t,n){const i=P$(n.node);let s=null;const r={};for(let o=0,a=0,c=0;a<i.length;o++,a++,c++){const u=i[a],h=t[o],f=c;if(h&&(c+=h.length),u.kind===zl){s??=n.node.fullPath.split("/");const m=s[a],y=u.prefix?.length??0;if(m.charCodeAt(y)===123){const S=u.suffix?.length??0,_=m.substring(y+2,m.length-S-1),w=h.substring(y,h.length-S);r[_]=decodeURIComponent(w)}else{const S=m.substring(1);r[S]=decodeURIComponent(h)}}else if(u.kind===Zh){if(n.skipped&1<<a){o--;continue}s??=n.node.fullPath.split("/");const m=s[a],y=u.prefix?.length??0,b=u.suffix?.length??0,S=m.substring(y+3,m.length-b-1),_=u.suffix||u.prefix?h.substring(y,h.length-b):h;_&&(r[S]=decodeURIComponent(_))}else if(u.kind===$l){const m=u,y=e.substring(f+(m.prefix?.length??0),e.length-(m.suffix?.length??0)),b=decodeURIComponent(y);r["*"]=b,r._splat=b;break}}return r}function A$(e){const t=[e];for(;e.parentRoute;)e=e.parentRoute,t.push(e);return t.reverse(),t}function P$(e){const t=Array(e.depth+1);do t[e.depth]=e,e=e.parent;while(e);return t}function L$(e,t,n,i){if(e==="/"&&n.index)return{node:n.index,skipped:0};const s=!qg(t),r=s&&e!=="/",o=t.length-(s?1:0),a=[{node:n,index:1,skipped:0,depth:1,statics:1,dynamics:0,optionals:0}];let c=null,u=null,h=null;for(;a.length;){const f=a.pop();let{node:m,index:y,skipped:b,depth:S,statics:_,dynamics:w,optionals:M}=f;i&&m.route&&m.kind!==du&&Kd(u,f)&&(u=f);const R=y===o;if(R&&(m.route&&!r&&Kd(h,f)&&(h=f),!m.optional&&!m.wildcard&&!m.index))continue;const E=R?void 0:t[y];let A;if(R&&m.index){const T={node:m.index,index:y,skipped:b,depth:S+1,statics:_,dynamics:w,optionals:M};if(_===o&&!w&&!M&&!b)return T;Kd(h,T)&&(h=T)}if(m.wildcard&&Kd(c,f))for(const T of m.wildcard){const{prefix:L,suffix:P}=T;if(!(L&&(R||!(T.caseSensitive?E:A??=E.toLowerCase()).startsWith(L)))){if(P){if(R)continue;const I=t.slice(y).join("/").slice(-P.length);if((T.caseSensitive?I:I.toLowerCase())!==P)continue}c={node:T,index:o,skipped:b,depth:S,statics:_,dynamics:w,optionals:M};break}}if(m.optional){const T=b|1<<S,L=S+1;for(let P=m.optional.length-1;P>=0;P--){const I=m.optional[P];a.push({node:I,index:y,skipped:T,depth:L,statics:_,dynamics:w,optionals:M})}if(!R)for(let P=m.optional.length-1;P>=0;P--){const I=m.optional[P],{prefix:N,suffix:O}=I;if(N||O){const j=I.caseSensitive?E:A??=E.toLowerCase();if(N&&!j.startsWith(N)||O&&!j.endsWith(O))continue}a.push({node:I,index:y+1,skipped:b,depth:L,statics:_,dynamics:w,optionals:M+1})}}if(!R&&m.dynamic&&E)for(let T=m.dynamic.length-1;T>=0;T--){const L=m.dynamic[T],{prefix:P,suffix:I}=L;if(P||I){const N=L.caseSensitive?E:A??=E.toLowerCase();if(P&&!N.startsWith(P)||I&&!N.endsWith(I))continue}a.push({node:L,index:y+1,skipped:b,depth:S+1,statics:_,dynamics:w+1,optionals:M})}if(!R&&m.staticInsensitive){const T=m.staticInsensitive.get(A??=E.toLowerCase());T&&a.push({node:T,index:y+1,skipped:b,depth:S+1,statics:_+1,dynamics:w,optionals:M})}if(!R&&m.static){const T=m.static.get(E);T&&a.push({node:T,index:y+1,skipped:b,depth:S+1,statics:_+1,dynamics:w,optionals:M})}}if(h&&c)return Kd(c,h)?h:c;if(h)return h;if(c)return c;if(i&&u){let f=u.index;for(let y=0;y<u.index;y++)f+=t[y].length;const m=f===e.length?"/":e.slice(f);return{node:u.node,skipped:u.skipped,"**":decodeURIComponent(m)}}return null}function Kd(e,t){return e?t.statics>e.statics||t.statics===e.statics&&(t.dynamics>e.dynamics||t.dynamics===e.dynamics&&(t.optionals>e.optionals||t.optionals===e.optionals&&((t.node.kind===du)>(e.node.kind===du)||t.node.kind===du==(e.node.kind===du)&&t.depth>e.depth))):!0}function ng(e){return TC(e.filter(t=>t!==void 0).join("/"))}function TC(e){return e.replace(/\/{2,}/g,"/")}function hD(e){return e==="/"?e:e.replace(/^\/{1,}/,"")}function Ol(e){const t=e.length;return t>1&&e[t-1]==="/"?e.replace(/\/{1,}$/,""):e}function fD(e){return Ol(hD(e))}function Wg(e,t){return e?.endsWith("/")&&e!=="/"&&e!==`${t}/`?e.slice(0,-1):e}function N$(e,t,n){return Wg(e,n)===Wg(t,n)}function I$({base:e,to:t,trailingSlash:n="never",cache:i}){const s=t.startsWith("/"),r=!s&&t===".";let o;if(i){o=s?t:r?e:e+"\0"+t;const f=i.get(o);if(f)return f}let a;if(r)a=e.split("/");else if(s)a=t.split("/");else{for(a=e.split("/");a.length>1&&qg(a)==="";)a.pop();const f=t.split("/");for(let m=0,y=f.length;m<y;m++){const b=f[m];b===""?m?m===y-1&&a.push(b):a=[b]:b===".."?a.pop():b==="."||a.push(b)}}a.length>1&&(qg(a)===""?n==="never"&&a.pop():n==="always"&&a.push(""));let c,u="";for(let f=0;f<a.length;f++){f>0&&(u+="/");const m=a[f];if(!m)continue;c=CC(m,0,c);const y=c[0];if(y===Pu){u+=m;continue}const b=c[5],S=m.substring(0,c[1]),_=m.substring(c[4],b),w=m.substring(c[2],c[3]);y===zl?u+=S||_?`${S}{$${w}}${_}`:`$${w}`:y===$l?u+=S||_?`${S}{$}${_}`:"$":u+=`${S}{-$${w}}${_}`}u=TC(u);const h=u||"/";return o&&i&&i.set(o,h),h}function n0(e,t,n){const i=t[e];return typeof i!="string"?i:e==="_splat"?encodeURI(i):D$(i,n)}function i0({path:e,params:t,decodeCharMap:n}){let i=!1;const s={};if(!e||e==="/")return{interpolatedPath:"/",usedParams:s,isMissingParams:i};if(!e.includes("$"))return{interpolatedPath:e,usedParams:s,isMissingParams:i};const r=e.length;let o=0,a,c="";for(;o<r;){const h=o;a=CC(e,h,a);const f=a[5];if(o=f+1,h===f)continue;const m=a[0];if(m===Pu){c+="/"+e.substring(h,f);continue}if(m===$l){const y=t._splat;s._splat=y,s["*"]=y;const b=e.substring(h,a[1]),S=e.substring(a[4],f);if(!y){i=!0,(b||S)&&(c+="/"+b+S);continue}const _=n0("_splat",t,n);c+="/"+b+_+S;continue}if(m===zl){const y=e.substring(a[2],a[3]);!i&&!(y in t)&&(i=!0),s[y]=t[y];const b=e.substring(h,a[1]),S=e.substring(a[4],f),_=n0(y,t,n)??"undefined";c+="/"+b+_+S;continue}if(m===Zh){const y=e.substring(a[2],a[3]),b=t[y];if(b==null)continue;s[y]=b;const S=e.substring(h,a[1]),_=e.substring(a[4],f),w=n0(y,t,n)??"";c+="/"+S+w+_;continue}}return e.endsWith("/")&&(c+="/"),{usedParams:s,interpolatedPath:c||"/",isMissingParams:i}}function D$(e,t){let n=encodeURIComponent(e);if(t)for(const[i,s]of t)n=n.replaceAll(i,s);return n}function hs(e){return!!e?.isNotFound}function O$(){try{if(typeof window<"u"&&typeof window.sessionStorage=="object")return window.sessionStorage}catch{}}const Gg="tsr-scroll-restoration-v1_3",j$=(e,t)=>{let n;return(...i)=>{n||(n=setTimeout(()=>{e(...i),n=null},t))}};function B$(){const e=O$();if(!e)return null;const t=e.getItem(Gg);let n=t?JSON.parse(t):{};return{state:n,set:i=>(n=ka(i,n)||n,e.setItem(Gg,JSON.stringify(n)))}}const fm=B$(),hx=e=>e.state.__TSR_key||e.href;function F$(e){const t=[];let n;for(;n=e.parentNode;)t.push(`${e.tagName}:nth-child(${Array.prototype.indexOf.call(n.children,e)+1})`),e=n;return`${t.reverse().join(" > ")}`.toLowerCase()}let Kg=!1;function pD({storageKey:e,key:t,behavior:n,shouldScrollRestoration:i,scrollToTopSelectors:s,location:r}){let o;try{o=JSON.parse(sessionStorage.getItem(e)||"{}")}catch(u){console.error(u);return}const a=t||window.history.state?.__TSR_key,c=o[a];Kg=!0;e:{if(i&&c&&Object.keys(c).length>0){for(const f in c){const m=c[f];if(f==="window")window.scrollTo({top:m.scrollY,left:m.scrollX,behavior:n});else if(f){const y=document.querySelector(f);y&&(y.scrollLeft=m.scrollX,y.scrollTop=m.scrollY)}}break e}const u=(r??window.location).hash.split("#",2)[1];if(u){const f=window.history.state?.__hashScrollIntoViewOptions??!0;if(f){const m=document.getElementById(u);m&&m.scrollIntoView(f)}break e}const h={top:0,left:0,behavior:n};if(window.scrollTo(h),s)for(const f of s){if(f==="window")continue;const m=typeof f=="function"?f():document.querySelector(f);m&&m.scrollTo(h)}}Kg=!1}function U$(e,t){if(!fm&&!e.isServer||((e.options.scrollRestoration??!1)&&(e.isScrollRestoring=!0),e.isServer||e.isScrollRestorationSetup||!fm))return;e.isScrollRestorationSetup=!0,Kg=!1;const i=e.options.getScrollRestorationKey||hx;window.history.scrollRestoration="manual";const s=r=>{if(Kg||!e.isScrollRestoring)return;let o="";if(r.target===document||r.target===window)o="window";else{const c=r.target.getAttribute("data-scroll-restoration-id");c?o=`[data-scroll-restoration-id="${c}"]`:o=F$(r.target)}const a=i(e.state.location);fm.set(c=>{const u=c[a]||={},h=u[o]||={};if(o==="window")h.scrollX=window.scrollX||0,h.scrollY=window.scrollY||0;else if(o){const f=document.querySelector(o);f&&(h.scrollX=f.scrollLeft||0,h.scrollY=f.scrollTop||0)}return c})};typeof document<"u"&&document.addEventListener("scroll",j$(s,100),!0),e.subscribe("onRendered",r=>{const o=i(r.toLocation);if(!e.resetNextScroll){e.resetNextScroll=!0;return}typeof e.options.scrollRestoration=="function"&&!e.options.scrollRestoration({location:e.latestLocation})||(pD({storageKey:Gg,key:o,behavior:e.options.scrollRestorationBehavior,shouldScrollRestoration:e.isScrollRestoring,scrollToTopSelectors:e.options.scrollToTopSelectors,location:e.history.location}),e.isScrollRestoring&&fm.set(a=>(a[o]||={},a)))})}function z$(e){if(typeof document<"u"&&document.querySelector){const t=e.state.location.state.__hashScrollIntoViewOptions??!0;if(t&&e.state.location.hash!==""){const n=document.getElementById(e.state.location.hash);n&&n.scrollIntoView(t)}}}function $$(e,t=String){const n=new URLSearchParams;for(const i in e){const s=e[i];s!==void 0&&n.set(i,t(s))}return n.toString()}function s0(e){return e?e==="false"?!1:e==="true"?!0:+e*0===0&&+e+""===e?+e:e:""}function q$(e){const t=new URLSearchParams(e),n={};for(const[i,s]of t.entries()){const r=n[i];r==null?n[i]=s0(s):Array.isArray(r)?r.push(s0(s)):n[i]=[r,s0(s)]}return n}const H$=W$(JSON.parse),V$=G$(JSON.stringify,JSON.parse);function W$(e){return t=>{t[0]==="?"&&(t=t.substring(1));const n=q$(t);for(const i in n){const s=n[i];if(typeof s=="string")try{n[i]=e(s)}catch{}}return n}}function G$(e,t){const n=typeof t=="function";function i(s){if(typeof s=="object"&&s!==null)try{return e(s)}catch{}else if(n&&typeof s=="string")try{return t(s),e(s)}catch{}return s}return s=>{const r=$$(s,i);return r?`?${r}`:""}}const ls="__root__";function K$(e){if(e.statusCode=e.statusCode||e.code||307,!e.reloadDocument&&typeof e.href=="string")try{new URL(e.href),e.reloadDocument=!0}catch{}const t=new Headers(e.headers);e.href&&t.get("Location")===null&&t.set("Location",e.href);const n=new Response(null,{status:e.statusCode,headers:t});if(n.options=e,e.throw)throw n;return n}function js(e){return e instanceof Response&&!!e.options}const ig=e=>{if(!e.rendered)return e.rendered=!0,e.onReady?.()},Wv=(e,t)=>!!(e.preload&&!e.router.state.matches.some(n=>n.id===t)),EC=(e,t,n=!0)=>{const i={...e.router.options.context??{}},s=n?t:t-1;for(let r=0;r<=s;r++){const o=e.matches[r];if(!o)continue;const a=e.router.getMatch(o.id);a&&Object.assign(i,a.__routeContext,a.__beforeLoadContext)}return i},mD=(e,t)=>{const n=e.router.routesById[t.routeId??""]??e.router.routeTree;!n.options.notFoundComponent&&e.router.options?.defaultNotFoundComponent&&(n.options.notFoundComponent=e.router.options.defaultNotFoundComponent),Do(n.options.notFoundComponent);const i=e.matches.find(s=>s.routeId===n.id);Do(i,"Could not find match for route: "+n.id),e.updateMatch(i.id,s=>({...s,status:"notFound",error:t,isFetching:!1})),t.routerCode==="BEFORE_LOAD"&&n.parentRoute&&(t.routeId=n.parentRoute.id,mD(e,t))},Ta=(e,t,n)=>{if(!(!js(n)&&!hs(n))){if(js(n)&&n.redirectHandled&&!n.options.reloadDocument)throw n;if(t){t._nonReactive.beforeLoadPromise?.resolve(),t._nonReactive.loaderPromise?.resolve(),t._nonReactive.beforeLoadPromise=void 0,t._nonReactive.loaderPromise=void 0;const i=js(n)?"redirected":"notFound";t._nonReactive.error=n,e.updateMatch(t.id,s=>({...s,status:i,isFetching:!1,error:n})),hs(n)&&!n.routeId&&(n.routeId=t.routeId),t._nonReactive.loadPromise?.resolve()}throw js(n)?(e.rendered=!0,n.options._fromLocation=e.location,n.redirectHandled=!0,n=e.router.resolveRedirect(n),n):(mD(e,n),n)}},gD=(e,t)=>{const n=e.router.getMatch(t);return!!(!e.router.isServer&&n._nonReactive.dehydrated||e.router.isServer&&n.ssr===!1)},Yd=(e,t,n,i)=>{const{id:s,routeId:r}=e.matches[t],o=e.router.looseRoutesById[r];if(n instanceof Promise)throw n;n.routerCode=i,e.firstBadMatchIndex??=t,Ta(e,e.router.getMatch(s),n);try{o.options.onError?.(n)}catch(a){n=a,Ta(e,e.router.getMatch(s),n)}e.updateMatch(s,a=>(a._nonReactive.beforeLoadPromise?.resolve(),a._nonReactive.beforeLoadPromise=void 0,a._nonReactive.loadPromise?.resolve(),{...a,error:n,status:"error",isFetching:!1,updatedAt:Date.now(),abortController:new AbortController}))},Y$=(e,t,n,i)=>{const s=e.router.getMatch(t),r=e.matches[n-1]?.id,o=r?e.router.getMatch(r):void 0;if(e.router.isShell()){s.ssr=i.id===ls;return}if(o?.ssr===!1){s.ssr=!1;return}const a=y=>y===!0&&o?.ssr==="data-only"?"data-only":y,c=e.router.options.defaultSsr??!0;if(i.options.ssr===void 0){s.ssr=a(c);return}if(typeof i.options.ssr!="function"){s.ssr=a(i.options.ssr);return}const{search:u,params:h}=s,f={search:pm(u,s.searchError),params:pm(h,s.paramsError),location:e.location,matches:e.matches.map(y=>({index:y.index,pathname:y.pathname,fullPath:y.fullPath,staticData:y.staticData,id:y.id,routeId:y.routeId,search:pm(y.search,y.searchError),params:pm(y.params,y.paramsError),ssr:y.ssr}))},m=i.options.ssr(f);if(La(m))return m.then(y=>{s.ssr=a(y??c)});s.ssr=a(m??c)},vD=(e,t,n,i)=>{if(i._nonReactive.pendingTimeout!==void 0)return;const s=n.options.pendingMs??e.router.options.defaultPendingMs;if(!!(e.onReady&&!e.router.isServer&&!Wv(e,t)&&(n.options.loader||n.options.beforeLoad||_D(n))&&typeof s=="number"&&s!==1/0&&(n.options.pendingComponent??e.router.options?.defaultPendingComponent))){const o=setTimeout(()=>{ig(e)},s);i._nonReactive.pendingTimeout=o}},X$=(e,t,n)=>{const i=e.router.getMatch(t);if(!i._nonReactive.beforeLoadPromise&&!i._nonReactive.loaderPromise)return;vD(e,t,n,i);const s=()=>{const r=e.router.getMatch(t);r.preload&&(r.status==="redirected"||r.status==="notFound")&&Ta(e,r,r.error)};return i._nonReactive.beforeLoadPromise?i._nonReactive.beforeLoadPromise.then(s):s()},Q$=(e,t,n,i)=>{const s=e.router.getMatch(t),r=s._nonReactive.loadPromise;s._nonReactive.loadPromise=Au(()=>{r?.resolve()});const{paramsError:o,searchError:a}=s;o&&Yd(e,n,o,"PARSE_PARAMS"),a&&Yd(e,n,a,"VALIDATE_SEARCH"),vD(e,t,i,s);const c=new AbortController,u=e.matches[n-1]?.id;(u?e.router.getMatch(u):void 0)?.context??e.router.options.context;let f=!1;const m=()=>{f||(f=!0,e.updateMatch(t,T=>({...T,isFetching:"beforeLoad",fetchCount:T.fetchCount+1,abortController:c})))},y=()=>{s._nonReactive.beforeLoadPromise?.resolve(),s._nonReactive.beforeLoadPromise=void 0,e.updateMatch(t,T=>({...T,isFetching:!1}))};if(!i.options.beforeLoad){Lh(()=>{m(),y()});return}s._nonReactive.beforeLoadPromise=Au();const b={...EC(e,n,!1),...s.__routeContext},{search:S,params:_,cause:w}=s,M=Wv(e,t),R={search:S,abortController:c,params:_,preload:M,context:b,location:e.location,navigate:T=>e.router.navigate({...T,_fromLocation:e.location}),buildLocation:e.router.buildLocation,cause:M?"preload":w,matches:e.matches,...e.router.options.additionalContext},E=T=>{if(T===void 0){Lh(()=>{m(),y()});return}(js(T)||hs(T))&&(m(),Yd(e,n,T,"BEFORE_LOAD")),Lh(()=>{m(),e.updateMatch(t,L=>({...L,__beforeLoadContext:T})),y()})};let A;try{if(A=i.options.beforeLoad(R),La(A))return m(),A.catch(T=>{Yd(e,n,T,"BEFORE_LOAD")}).then(E)}catch(T){m(),Yd(e,n,T,"BEFORE_LOAD")}E(A)},J$=(e,t)=>{const{id:n,routeId:i}=e.matches[t],s=e.router.looseRoutesById[i],r=()=>{if(e.router.isServer){const c=Y$(e,n,t,s);if(La(c))return c.then(a)}return a()},o=()=>Q$(e,n,t,s),a=()=>{if(gD(e,n))return;const c=X$(e,n,s);return La(c)?c.then(o):o()};return r()},Z$=(e,t,n)=>{const i=e.router.getMatch(t);if(!i||!n.options.head&&!n.options.scripts&&!n.options.headers)return;const s={matches:e.matches,match:i,params:i.params,loaderData:i.loaderData};return Promise.all([n.options.head?.(s),n.options.scripts?.(s),n.options.headers?.(s)]).then(([r,o,a])=>{const c=r?.meta,u=r?.links,h=r?.scripts,f=r?.styles;return{meta:c,links:u,headScripts:h,headers:a,scripts:o,styles:f}})},yD=(e,t,n,i)=>{const s=e.matchPromises[n-1],{params:r,loaderDeps:o,abortController:a,cause:c}=e.router.getMatch(t),u=EC(e,n),h=Wv(e,t);return{params:r,deps:o,preload:!!h,parentMatchPromise:s,abortController:a,context:u,location:e.location,navigate:f=>e.router.navigate({...f,_fromLocation:e.location}),cause:h?"preload":c,route:i,...e.router.options.additionalContext}},uA=async(e,t,n,i)=>{try{const s=e.router.getMatch(t);try{(!e.router.isServer||s.ssr===!0)&&bD(i);const r=i.options.loader?.(yD(e,t,n,i)),o=i.options.loader&&La(r);if((o||i._lazyPromise||i._componentsPromise||i.options.head||i.options.scripts||i.options.headers||s._nonReactive.minPendingPromise)&&e.updateMatch(t,u=>({...u,isFetching:"loader"})),i.options.loader){const u=o?await r:r;Ta(e,e.router.getMatch(t),u),u!==void 0&&e.updateMatch(t,h=>({...h,loaderData:u}))}i._lazyPromise&&await i._lazyPromise;const c=s._nonReactive.minPendingPromise;c&&await c,i._componentsPromise&&await i._componentsPromise,e.updateMatch(t,u=>({...u,error:void 0,status:"success",isFetching:!1,updatedAt:Date.now()}))}catch(r){let o=r;const a=s._nonReactive.minPendingPromise;a&&await a,hs(r)&&await i.options.notFoundComponent?.preload?.(),Ta(e,e.router.getMatch(t),r);try{i.options.onError?.(r)}catch(c){o=c,Ta(e,e.router.getMatch(t),c)}e.updateMatch(t,c=>({...c,error:o,status:"error",isFetching:!1}))}}catch(s){const r=e.router.getMatch(t);r&&(r._nonReactive.loaderPromise=void 0),Ta(e,r,s)}},eq=async(e,t)=>{const{id:n,routeId:i}=e.matches[t];let s=!1,r=!1;const o=e.router.looseRoutesById[i],a=()=>{e.updateMatch(n,h=>({...h,context:EC(e,t)}))};if(gD(e,n)){if(e.router.isServer)return e.router.getMatch(n)}else{const h=e.router.getMatch(n);if(h._nonReactive.loaderPromise){if(h.status==="success"&&!e.sync&&!h.preload)return h;await h._nonReactive.loaderPromise;const f=e.router.getMatch(n),m=f._nonReactive.error||f.error;m&&Ta(e,f,m)}else{const f=Date.now()-h.updatedAt,m=Wv(e,n),y=m?o.options.preloadStaleTime??e.router.options.defaultPreloadStaleTime??3e4:o.options.staleTime??e.router.options.defaultStaleTime??0,b=o.options.shouldReload,S=typeof b=="function"?b(yD(e,n,t,o)):b,_=!!m&&!e.router.state.matches.some(E=>E.id===n),w=e.router.getMatch(n);w._nonReactive.loaderPromise=Au(),_!==w.preload&&e.updateMatch(n,E=>({...E,preload:_}));const{status:M,invalid:R}=w;s=M==="success"&&(R||(S??f>y)),m&&o.options.preload===!1||(s&&!e.sync?(r=!0,(async()=>{try{await uA(e,n,t,o),a();const E=e.router.getMatch(n);E._nonReactive.loaderPromise?.resolve(),E._nonReactive.loadPromise?.resolve(),E._nonReactive.loaderPromise=void 0}catch(E){js(E)&&await e.router.navigate(E.options)}})()):(M!=="success"||s&&e.sync)&&await uA(e,n,t,o))}}const c=e.router.getMatch(n);r||(c._nonReactive.loaderPromise?.resolve(),c._nonReactive.loadPromise?.resolve()),clearTimeout(c._nonReactive.pendingTimeout),c._nonReactive.pendingTimeout=void 0,r||(c._nonReactive.loaderPromise=void 0),c._nonReactive.dehydrated=void 0,r||a();const u=r?c.isFetching:!1;return u!==c.isFetching||c.invalid!==!1?(e.updateMatch(n,h=>({...h,isFetching:u,invalid:!1})),e.router.getMatch(n)):c};async function dA(e){const t=Object.assign(e,{matchPromises:[]});!t.router.isServer&&t.router.state.matches.some(n=>n._forcePending)&&ig(t);try{for(let a=0;a<t.matches.length;a++){const c=J$(t,a);La(c)&&await c}const n=t.firstBadMatchIndex??t.matches.length;for(let a=0;a<n;a++)t.matchPromises.push(eq(t,a));const s=(await Promise.allSettled(t.matchPromises)).filter(a=>a.status==="rejected").map(a=>a.reason);let r;for(const a of s){if(js(a))throw a;!r&&hs(a)&&(r=a)}for(const a of t.matches){const{id:c,routeId:u}=a,h=t.router.looseRoutesById[u];try{const f=Z$(t,c,h);if(f){const m=await f;t.updateMatch(c,y=>({...y,...m}))}}catch(f){console.error(`Error executing head for route ${u}:`,f)}}if(r)throw r;const o=ig(t);La(o)&&await o}catch(n){if(hs(n)&&!t.preload){const i=ig(t);throw La(i)&&await i,n}if(js(n))throw n}return t.matches}async function bD(e){if(!e._lazyLoaded&&e._lazyPromise===void 0&&(e.lazyFn?e._lazyPromise=e.lazyFn().then(t=>{const{id:n,...i}=t.options;Object.assign(e.options,i),e._lazyLoaded=!0,e._lazyPromise=void 0}):e._lazyLoaded=!0),!e._componentsLoaded&&e._componentsPromise===void 0){const t=()=>{const n=[];for(const i of SD){const s=e.options[i]?.preload;s&&n.push(s())}if(n.length)return Promise.all(n).then(()=>{e._componentsLoaded=!0,e._componentsPromise=void 0});e._componentsLoaded=!0,e._componentsPromise=void 0};e._componentsPromise=e._lazyPromise?e._lazyPromise.then(t):t()}return e._componentsPromise}function pm(e,t){return t?{status:"error",error:t}:{status:"success",value:e}}function _D(e){for(const t of SD)if(e.options[t]?.preload)return!0;return!1}const SD=["component","errorComponent","pendingComponent","notFoundComponent"];function tq(e){return{input:({url:t})=>{for(const n of e)t=xD(n,t);return t},output:({url:t})=>{for(let n=e.length-1;n>=0;n--)t=wD(e[n],t);return t}}}function nq(e){const t=fD(e.basepath),n=`/${t}`,i=`${n}/`,s=e.caseSensitive?n:n.toLowerCase(),r=e.caseSensitive?i:i.toLowerCase();return{input:({url:o})=>{const a=e.caseSensitive?o.pathname:o.pathname.toLowerCase();return a===s?o.pathname="/":a.startsWith(r)&&(o.pathname=o.pathname.slice(n.length)),o},output:({url:o})=>(o.pathname=ng(["/",t,o.pathname]),o)}}function xD(e,t){const n=e?.input?.({url:t});if(n){if(typeof n=="string")return new URL(n);if(n instanceof URL)return n}return t}function wD(e,t){const n=e?.output?.({url:t});if(n){if(typeof n=="string")return new URL(n);if(n instanceof URL)return n}return t}function jl(e){const t=e.resolvedLocation,n=e.location,i=t?.pathname!==n.pathname,s=t?.href!==n.href,r=t?.hash!==n.hash;return{fromLocation:t,toLocation:n,pathChanged:i,hrefChanged:s,hashChanged:r}}class iq{constructor(t){this.tempLocationKey=`${Math.round(Math.random()*1e7)}`,this.resetNextScroll=!0,this.shouldViewTransition=void 0,this.isViewTransitionTypesSupported=void 0,this.subscribers=new Set,this.isScrollRestoring=!1,this.isScrollRestorationSetup=!1,this.startTransition=n=>n(),this.update=n=>{n.notFoundRoute&&console.warn("The notFoundRoute API is deprecated and will be removed in the next major version. See https://tanstack.com/router/v1/docs/framework/react/guide/not-found-errors#migrating-from-notfoundroute for more info.");const i=this.options,s=this.basepath??i?.basepath??"/",r=this.basepath===void 0,o=i?.rewrite;this.options={...i,...n},this.isServer=this.options.isServer??typeof document>"u",this.pathParamsDecodeCharMap=this.options.pathParamsAllowedCharacters?new Map(this.options.pathParamsAllowedCharacters.map(m=>[encodeURIComponent(m),m])):void 0,(!this.history||this.options.history&&this.options.history!==this.history)&&(this.options.history?this.history=this.options.history:this.isServer||(this.history=m$())),this.origin=this.options.origin,this.origin||(!this.isServer&&window?.origin&&window.origin!=="null"?this.origin=window.origin:this.origin="http://localhost"),this.history&&this.updateLatestLocation(),this.options.routeTree!==this.routeTree&&(this.routeTree=this.options.routeTree,this.buildRouteTree()),!this.__store&&this.latestLocation&&(this.__store=new p$(rq(this.latestLocation),{onUpdate:()=>{this.__store.state={...this.state,cachedMatches:this.state.cachedMatches.filter(m=>!["redirected"].includes(m.status))}}}),U$(this));let a=!1;const c=this.options.basepath??"/",u=this.options.rewrite;if(r||s!==c||o!==u){this.basepath=c;const m=[];fD(c)!==""&&m.push(nq({basepath:c})),u&&m.push(u),this.rewrite=m.length===0?void 0:m.length===1?m[0]:tq(m),this.history&&this.updateLatestLocation(),a=!0}a&&this.__store&&(this.__store.state={...this.state,location:this.latestLocation}),typeof window<"u"&&"CSS"in window&&typeof window.CSS?.supports=="function"&&(this.isViewTransitionTypesSupported=window.CSS.supports("selector(:active-view-transition-type(a)"))},this.updateLatestLocation=()=>{this.latestLocation=this.parseLocation(this.history.location,this.latestLocation)},this.buildRouteTree=()=>{const{routesById:n,routesByPath:i,processedTree:s}=R$(this.routeTree,this.options.caseSensitive,(o,a)=>{o.init({originalIndex:a})});this.options.routeMasks&&w$(this.options.routeMasks,s),this.routesById=n,this.routesByPath=i,this.processedTree=s;const r=this.options.notFoundRoute;r&&(r.init({originalIndex:99999999999}),this.routesById[r.id]=r)},this.subscribe=(n,i)=>{const s={eventType:n,fn:i};return this.subscribers.add(s),()=>{this.subscribers.delete(s)}},this.emit=n=>{this.subscribers.forEach(i=>{i.eventType===n.type&&i.fn(n)})},this.parseLocation=(n,i)=>{const s=({href:c,state:u})=>{const h=new URL(c,this.origin),f=xD(this.rewrite,h),m=this.options.parseSearch(f.search),y=this.options.stringifySearch(m);return f.search=y,{href:f.href.replace(f.origin,""),publicHref:c,url:f,pathname:cA(f.pathname),searchStr:y,search:Rs(i?.search,m),hash:f.hash.split("#").reverse()[0]??"",state:Rs(i?.state,u)}},r=s(n),{__tempLocation:o,__tempKey:a}=r.state;if(o&&(!a||a===this.tempLocationKey)){const c=s(o);return c.state.key=r.state.key,c.state.__TSR_key=r.state.__TSR_key,delete c.state.__tempLocation,{...c,maskedLocation:r}}return r},this.resolvePathCache=Vg(1e3),this.resolvePathWithBase=(n,i)=>I$({base:n,to:TC(i),trailingSlash:this.options.trailingSlash,cache:this.resolvePathCache}),this.matchRoutes=(n,i,s)=>typeof n=="string"?this.matchRoutesInternal({pathname:n,search:i},s):this.matchRoutesInternal(n,i),this.getMatchedRoutes=n=>oq({pathname:n,routesById:this.routesById,processedTree:this.processedTree}),this.cancelMatch=n=>{const i=this.getMatch(n);i&&(i.abortController.abort(),clearTimeout(i._nonReactive.pendingTimeout),i._nonReactive.pendingTimeout=void 0)},this.cancelMatches=()=>{const n=this.state.matches.filter(r=>r.status==="pending"),i=this.state.matches.filter(r=>r.isFetching==="loader");new Set([...this.state.pendingMatches??[],...n,...i]).forEach(r=>{this.cancelMatch(r.id)})},this.buildLocation=n=>{const i=(r={})=>{const o=r._fromLocation||this.pendingBuiltLocation||this.latestLocation,a=this.matchRoutes(o,{_buildLocation:!0}),c=qg(a);r.from;const u=r.unsafeRelative==="path"?o.pathname:r.from??c.fullPath,h=this.resolvePathWithBase(u,"."),f=c.search,m={...c.params},y=r.to?this.resolvePathWithBase(h,`${r.to}`):this.resolvePathWithBase(h,"."),b=r.params===!1||r.params===null?{}:(r.params??!0)===!0?m:Object.assign(m,ka(r.params,m)),S=i0({path:y,params:b}).interpolatedPath,_=this.matchRoutes(S,void 0,{_buildLocation:!0}).map(N=>this.looseRoutesById[N.routeId]);if(Object.keys(b).length>0)for(const N of _){const O=N.options.params?.stringify??N.options.stringifyParams;O&&Object.assign(b,O(b))}const w=n.leaveParams?y:cA(i0({path:y,params:b,decodeCharMap:this.pathParamsDecodeCharMap}).interpolatedPath);let M=f;if(n._includeValidateSearch&&this.options.search?.strict){const N={};_.forEach(O=>{if(O.options.validateSearch)try{Object.assign(N,fx(O.options.validateSearch,{...N,...M}))}catch{}}),M=N}M=aq({search:M,dest:r,destRoutes:_,_includeValidateSearch:n._includeValidateSearch}),M=Rs(f,M);const R=this.options.stringifySearch(M),E=r.hash===!0?o.hash:r.hash?ka(r.hash,o.hash):void 0,A=E?`#${E}`:"";let T=r.state===!0?o.state:r.state?ka(r.state,o.state):{};T=Rs(o.state,T);const L=`${w}${R}${A}`,P=new URL(L,this.origin),I=wD(this.rewrite,P);return{publicHref:I.pathname+I.search+I.hash,href:L,url:I,pathname:w,search:M,searchStr:R,state:T,hash:E??"",unmaskOnReload:r.unmaskOnReload}},s=(r={},o)=>{const a=i(r);let c=o?i(o):void 0;if(!c){const u={};if(this.options.routeMasks){const h=C$(a.pathname,this.processedTree);if(h){Object.assign(u,h.params);const{from:f,params:m,...y}=h.route,b=m===!1||m===null?{}:(m??!0)===!0?u:Object.assign(u,ka(m,u));o={from:n.from,...y,params:b},c=i(o)}}}return c&&(a.maskedLocation=c),a};return n.mask?s(n,{from:n.from,...n.mask}):s(n)},this.commitLocation=({viewTransition:n,ignoreBlocker:i,...s})=>{const r=()=>{const c=["key","__TSR_key","__TSR_index","__hashScrollIntoViewOptions"];c.forEach(h=>{s.state[h]=this.latestLocation.state[h]});const u=Dl(s.state,this.latestLocation.state);return c.forEach(h=>{delete s.state[h]}),u},o=Ol(this.latestLocation.href)===Ol(s.href),a=this.commitLocationPromise;if(this.commitLocationPromise=Au(()=>{a?.resolve()}),o&&r())this.load();else{let{maskedLocation:c,hashScrollIntoView:u,url:h,...f}=s;c&&(f={...c,state:{...c.state,__tempKey:void 0,__tempLocation:{...f,search:f.searchStr,state:{...f.state,__tempKey:void 0,__tempLocation:void 0,__TSR_key:void 0,key:void 0}}}},(f.unmaskOnReload??this.options.unmaskOnReload??!1)&&(f.state.__tempKey=this.tempLocationKey)),f.state.__hashScrollIntoViewOptions=u??this.options.defaultHashScrollIntoView??!0,this.shouldViewTransition=n,this.history[s.replace?"replace":"push"](f.publicHref,f.state,{ignoreBlocker:i})}return this.resetNextScroll=s.resetScroll??!0,this.history.subscribers.size||this.load(),this.commitLocationPromise},this.buildAndCommitLocation=({replace:n,resetScroll:i,hashScrollIntoView:s,viewTransition:r,ignoreBlocker:o,href:a,...c}={})=>{if(a){const f=this.history.location.state.__TSR_index,m=Jh(a,{__TSR_index:n?f:f+1});c.to=m.pathname,c.search=this.options.parseSearch(m.search),c.hash=m.hash.slice(1)}const u=this.buildLocation({...c,_includeValidateSearch:!0});this.pendingBuiltLocation=u;const h=this.commitLocation({...u,viewTransition:r,replace:n,resetScroll:i,hashScrollIntoView:s,ignoreBlocker:o});return Promise.resolve().then(()=>{this.pendingBuiltLocation===u&&(this.pendingBuiltLocation=void 0)}),h},this.navigate=async({to:n,reloadDocument:i,href:s,publicHref:r,...o})=>{let a=!1;if(s)try{new URL(`${s}`),a=!0}catch{}if(a&&!i&&(i=!0),i){if(!s||!r&&!a){const u=this.buildLocation({to:n,...o});s=s??u.url.href,r=r??u.url.href}const c=!a&&r?r:s;if(!o.ignoreBlocker){const h=this.history.getBlockers?.()??[];for(const f of h)if(f?.blockerFn&&await f.blockerFn({currentLocation:this.latestLocation,nextLocation:this.latestLocation,action:"PUSH"}))return Promise.resolve()}return o.replace?window.location.replace(c):window.location.href=c,Promise.resolve()}return this.buildAndCommitLocation({...o,href:s,to:n,_isNavigate:!0})},this.beforeLoad=()=>{if(this.cancelMatches(),this.updateLatestLocation(),this.isServer){const i=this.buildLocation({to:this.latestLocation.pathname,search:!0,params:!0,hash:!0,state:!0,_includeValidateSearch:!0});if(this.latestLocation.publicHref!==i.publicHref||i.url.origin!==this.origin){const s=this.getParsedLocationHref(i);throw K$({href:s})}}const n=this.matchRoutes(this.latestLocation);this.__store.setState(i=>({...i,status:"pending",statusCode:200,isLoading:!0,location:this.latestLocation,pendingMatches:n,cachedMatches:i.cachedMatches.filter(s=>!n.some(r=>r.id===s.id))}))},this.load=async n=>{let i,s,r;for(r=new Promise(a=>{this.startTransition(async()=>{try{this.beforeLoad();const c=this.latestLocation,u=this.state.resolvedLocation;this.state.redirect||this.emit({type:"onBeforeNavigate",...jl({resolvedLocation:u,location:c})}),this.emit({type:"onBeforeLoad",...jl({resolvedLocation:u,location:c})}),await dA({router:this,sync:n?.sync,matches:this.state.pendingMatches,location:c,updateMatch:this.updateMatch,onReady:async()=>{this.startTransition(()=>{this.startViewTransition(async()=>{let h=[],f=[],m=[];Lh(()=>{this.__store.setState(y=>{const b=y.matches,S=y.pendingMatches||y.matches;return h=b.filter(_=>!S.some(w=>w.id===_.id)),f=S.filter(_=>!b.some(w=>w.id===_.id)),m=S.filter(_=>b.some(w=>w.id===_.id)),{...y,isLoading:!1,loadedAt:Date.now(),matches:S,pendingMatches:void 0,cachedMatches:[...y.cachedMatches,...h.filter(_=>_.status!=="error"&&_.status!=="notFound")]}}),this.clearExpiredCache()}),[[h,"onLeave"],[f,"onEnter"],[m,"onStay"]].forEach(([y,b])=>{y.forEach(S=>{this.looseRoutesById[S.routeId].options[b]?.(S)})})})})}})}catch(c){js(c)?(i=c,this.isServer||this.navigate({...i.options,replace:!0,ignoreBlocker:!0})):hs(c)&&(s=c),this.__store.setState(u=>({...u,statusCode:i?i.status:s?404:u.matches.some(h=>h.status==="error")?500:200,redirect:i}))}this.latestLoadPromise===r&&(this.commitLocationPromise?.resolve(),this.latestLoadPromise=void 0,this.commitLocationPromise=void 0),a()})}),this.latestLoadPromise=r,await r;this.latestLoadPromise&&r!==this.latestLoadPromise;)await this.latestLoadPromise;let o;this.hasNotFoundMatch()?o=404:this.__store.state.matches.some(a=>a.status==="error")&&(o=500),o!==void 0&&this.__store.setState(a=>({...a,statusCode:o}))},this.startViewTransition=n=>{const i=this.shouldViewTransition??this.options.defaultViewTransition;if(delete this.shouldViewTransition,i&&typeof document<"u"&&"startViewTransition"in document&&typeof document.startViewTransition=="function"){let s;if(typeof i=="object"&&this.isViewTransitionTypesSupported){const r=this.latestLocation,o=this.state.resolvedLocation,a=typeof i.types=="function"?i.types(jl({resolvedLocation:o,location:r})):i.types;if(a===!1){n();return}s={update:n,types:a}}else s=n;document.startViewTransition(s)}else n()},this.updateMatch=(n,i)=>{this.startTransition(()=>{const s=this.state.pendingMatches?.some(r=>r.id===n)?"pendingMatches":this.state.matches.some(r=>r.id===n)?"matches":this.state.cachedMatches.some(r=>r.id===n)?"cachedMatches":"";s&&this.__store.setState(r=>({...r,[s]:r[s]?.map(o=>o.id===n?i(o):o)}))})},this.getMatch=n=>{const i=s=>s.id===n;return this.state.cachedMatches.find(i)??this.state.pendingMatches?.find(i)??this.state.matches.find(i)},this.invalidate=n=>{const i=s=>n?.filter?.(s)??!0?{...s,invalid:!0,...n?.forcePending||s.status==="error"||s.status==="notFound"?{status:"pending",error:void 0}:void 0}:s;return this.__store.setState(s=>({...s,matches:s.matches.map(i),cachedMatches:s.cachedMatches.map(i),pendingMatches:s.pendingMatches?.map(i)})),this.shouldViewTransition=!1,this.load({sync:n?.sync})},this.getParsedLocationHref=n=>{let i=n.url.href;return this.origin&&n.url.origin===this.origin&&(i=i.replace(this.origin,"")||"/"),i},this.resolveRedirect=n=>{if(!n.options.href){const i=this.buildLocation(n.options),s=this.getParsedLocationHref(i);n.options.href=i.href,n.headers.set("Location",s)}return n.headers.get("Location")||n.headers.set("Location",n.options.href),n},this.clearCache=n=>{const i=n?.filter;i!==void 0?this.__store.setState(s=>({...s,cachedMatches:s.cachedMatches.filter(r=>!i(r))})):this.__store.setState(s=>({...s,cachedMatches:[]}))},this.clearExpiredCache=()=>{const n=i=>{const s=this.looseRoutesById[i.routeId];if(!s.options.loader)return!0;const r=(i.preload?s.options.preloadGcTime??this.options.defaultPreloadGcTime:s.options.gcTime??this.options.defaultGcTime)??300*1e3;return i.status==="error"?!0:Date.now()-i.updatedAt>=r};this.clearCache({filter:n})},this.loadRouteChunk=bD,this.preloadRoute=async n=>{const i=this.buildLocation(n);let s=this.matchRoutes(i,{throwOnError:!0,preload:!0,dest:n});const r=new Set([...this.state.matches,...this.state.pendingMatches??[]].map(a=>a.id)),o=new Set([...r,...this.state.cachedMatches.map(a=>a.id)]);Lh(()=>{s.forEach(a=>{o.has(a.id)||this.__store.setState(c=>({...c,cachedMatches:[...c.cachedMatches,a]}))})});try{return s=await dA({router:this,matches:s,location:i,preload:!0,updateMatch:(a,c)=>{r.has(a)?s=s.map(u=>u.id===a?c(u):u):this.updateMatch(a,c)}}),s}catch(a){if(js(a))return a.options.reloadDocument?void 0:await this.preloadRoute({...a.options,_fromLocation:i});hs(a)||console.error(a);return}},this.matchRoute=(n,i)=>{const s={...n,to:n.to?this.resolvePathWithBase(n.from||"",n.to):void 0,params:n.params||{},leaveParams:!0},r=this.buildLocation(s);if(i?.pending&&this.state.status!=="pending")return!1;const a=(i?.pending===void 0?!this.state.isLoading:i.pending)?this.latestLocation:this.state.resolvedLocation||this.state.location,c=k$(r.pathname,i?.caseSensitive??!1,i?.fuzzy??!1,a.pathname,this.processedTree);return!c||n.params&&!Dl(c.params,n.params,{partial:!0})?!1:i?.includeSearch??!0?Dl(a.search,r.search,{partial:!0})?c.params:!1:c.params},this.hasNotFoundMatch=()=>this.__store.state.matches.some(n=>n.status==="notFound"||n.globalNotFound),this.update({defaultPreloadDelay:50,defaultPendingMs:1e3,defaultPendingMinMs:500,context:void 0,...t,caseSensitive:t.caseSensitive??!1,notFoundMode:t.notFoundMode??"fuzzy",stringifySearch:t.stringifySearch??V$,parseSearch:t.parseSearch??H$}),typeof document<"u"&&(self.__TSR_ROUTER__=this)}isShell(){return!!this.options.isShell}isPrerendering(){return!!this.options.isPrerendering}get state(){return this.__store.state}get looseRoutesById(){return this.routesById}matchRoutesInternal(t,n){const i=this.getMatchedRoutes(t.pathname),{foundRoute:s,routeParams:r}=i;let{matchedRoutes:o}=i,a=!1;(s?s.path!=="/"&&r["**"]:Ol(t.pathname))&&(this.options.notFoundRoute?o=[...o,this.options.notFoundRoute]:a=!0);const c=(()=>{if(a){if(this.options.notFoundMode!=="root")for(let f=o.length-1;f>=0;f--){const m=o[f];if(m.children)return m.id}return ls}})(),u=[],h=f=>f?.id?f.context??this.options.context??void 0:this.options.context??void 0;return o.forEach((f,m)=>{const y=u[m-1],[b,S,_]=(()=>{const $=y?.search??t.search,V=y?._strictSearch??void 0;try{const H=fx(f.options.validateSearch,{...$})??void 0;return[{...$,...H},{...V,...H},void 0]}catch(H){let B=H;if(H instanceof Yg||(B=new Yg(H.message,{cause:H})),n?.throwOnError)throw B;return[$,{},B]}})(),w=f.options.loaderDeps?.({search:b})??"",M=w?JSON.stringify(w):"",{interpolatedPath:R,usedParams:E}=i0({path:f.fullPath,params:r,decodeCharMap:this.pathParamsDecodeCharMap}),A=f.id+R+M,T=this.getMatch(A),L=this.state.matches.find($=>$.routeId===f.id),P=T?._strictParams??E;let I;if(!T){const $=f.options.params?.parse??f.options.parseParams;if($)try{Object.assign(P,$(P))}catch(V){if(hs(V)||js(V)?I=V:I=new sq(V.message,{cause:V}),n?.throwOnError)throw I}}Object.assign(r,P);const N=L?"stay":"enter";let O;if(T)O={...T,cause:N,params:L?Rs(L.params,r):r,_strictParams:P,search:Rs(L?L.search:T.search,b),_strictSearch:S};else{const $=f.options.loader||f.options.beforeLoad||f.lazyFn||_D(f)?"pending":"success";O={id:A,ssr:this.isServer?void 0:f.options.ssr,index:m,routeId:f.id,params:L?Rs(L.params,r):r,_strictParams:P,pathname:R,updatedAt:Date.now(),search:L?Rs(L.search,b):b,_strictSearch:S,searchError:void 0,status:$,isFetching:!1,error:void 0,paramsError:I,__routeContext:void 0,_nonReactive:{loadPromise:Au()},__beforeLoadContext:void 0,context:{},abortController:new AbortController,fetchCount:0,cause:N,loaderDeps:L?Rs(L.loaderDeps,w):w,invalid:!1,preload:!1,links:void 0,scripts:void 0,headScripts:void 0,meta:void 0,staticData:f.options.staticData||{},fullPath:f.fullPath}}n?.preload||(O.globalNotFound=c===f.id),O.searchError=_;const j=h(y);O.context={...j,...O.__routeContext,...O.__beforeLoadContext},u.push(O)}),u.forEach((f,m)=>{const y=this.looseRoutesById[f.routeId];if(!this.getMatch(f.id)&&n?._buildLocation!==!0){const S=u[m-1],_=h(S);if(y.options.context){const w={deps:f.loaderDeps,params:f.params,context:_??{},location:t,navigate:M=>this.navigate({...M,_fromLocation:t}),buildLocation:this.buildLocation,cause:f.cause,abortController:f.abortController,preload:!!f.preload,matches:u};f.__routeContext=y.options.context(w)??void 0}f.context={..._,...f.__routeContext,...f.__beforeLoadContext}}}),u}}class Yg extends Error{}class sq extends Error{}function rq(e){return{loadedAt:0,isLoading:!1,isTransitioning:!1,status:"idle",resolvedLocation:void 0,location:e,matches:[],pendingMatches:[],cachedMatches:[],statusCode:200}}function fx(e,t){if(e==null)return{};if("~standard"in e){const n=e["~standard"].validate(t);if(n instanceof Promise)throw new Yg("Async validation not supported");if(n.issues)throw new Yg(JSON.stringify(n.issues,void 0,2),{cause:n});return n.value}return"parse"in e?e.parse(t):typeof e=="function"?e(t):{}}function oq({pathname:e,routesById:t,processedTree:n}){const i={},s=Ol(e);let r;const o=T$(s,n,!0);return o&&(r=o.route,Object.assign(i,o.params)),{matchedRoutes:o?.branch||[t[ls]],routeParams:i,foundRoute:r}}function aq({search:e,dest:t,destRoutes:n,_includeValidateSearch:i}){const s=n.reduce((a,c)=>{const u=[];if("search"in c.options)c.options.search?.middlewares&&u.push(...c.options.search.middlewares);else if(c.options.preSearchFilters||c.options.postSearchFilters){const h=({search:f,next:m})=>{let y=f;"preSearchFilters"in c.options&&c.options.preSearchFilters&&(y=c.options.preSearchFilters.reduce((S,_)=>_(S),f));const b=m(y);return"postSearchFilters"in c.options&&c.options.postSearchFilters?c.options.postSearchFilters.reduce((S,_)=>_(S),b):b};u.push(h)}if(i&&c.options.validateSearch){const h=({search:f,next:m})=>{const y=m(f);try{return{...y,...fx(c.options.validateSearch,y)??void 0}}catch{return y}};u.push(h)}return a.concat(u)},[])??[],r=({search:a})=>t.search?t.search===!0?a:ka(t.search,a):{};s.push(r);const o=(a,c)=>{if(a>=s.length)return c;const u=s[a];return u({search:c,next:f=>o(a+1,f)})};return o(0,e)}const lq="Error preloading route! ";class CD{constructor(t){if(this.init=n=>{this.originalIndex=n.originalIndex;const i=this.options,s=!i?.path&&!i?.id;this.parentRoute=this.options.getParentRoute?.(),s?this._path=ls:this.parentRoute||Do(!1);let r=s?ls:i?.path;r&&r!=="/"&&(r=hD(r));const o=i?.id||r;let a=s?ls:ng([this.parentRoute.id===ls?"":this.parentRoute.id,o]);r===ls&&(r="/"),a!==ls&&(a=ng(["/",a]));const c=a===ls?"/":ng([this.parentRoute.fullPath,r]);this._path=r,this._id=a,this._fullPath=c,this._to=c},this.addChildren=n=>this._addFileChildren(n),this._addFileChildren=n=>(Array.isArray(n)&&(this.children=n),typeof n=="object"&&n!==null&&(this.children=Object.values(n)),this),this._addFileTypes=()=>this,this.updateLoader=n=>(Object.assign(this.options,n),this),this.update=n=>(Object.assign(this.options,n),this),this.lazy=n=>(this.lazyFn=n,this),this.options=t||{},this.isRoot=!t?.getParentRoute,t?.id&&t?.path)throw new Error("Route cannot have both an 'id' and a 'path' option.")}get to(){return this._to}get id(){return this._id}get path(){return this._path}get fullPath(){return this._fullPath}}class cq extends CD{constructor(t){super(t)}}function RC(e){const t=e.errorComponent??Gv;return g.jsx(uq,{getResetKey:e.getResetKey,onCatch:e.onCatch,children:({error:n,reset:i})=>n?k.createElement(t,{error:n,reset:i}):e.children})}class uq extends k.Component{constructor(){super(...arguments),this.state={error:null}}static getDerivedStateFromProps(t){return{resetKey:t.getResetKey()}}static getDerivedStateFromError(t){return{error:t}}reset(){this.setState({error:null})}componentDidUpdate(t,n){n.error&&n.resetKey!==this.state.resetKey&&this.reset()}componentDidCatch(t,n){this.props.onCatch&&this.props.onCatch(t,n)}render(){return this.props.children({error:this.state.resetKey!==this.props.getResetKey()?null:this.state.error,reset:()=>{this.reset()}})}}function Gv({error:e}){const[t,n]=k.useState(!1);return g.jsxs("div",{style:{padding:".5rem",maxWidth:"100%"},children:[g.jsxs("div",{style:{display:"flex",alignItems:"center",gap:".5rem"},children:[g.jsx("strong",{style:{fontSize:"1rem"},children:"Something went wrong!"}),g.jsx("button",{style:{appearance:"none",fontSize:".6em",border:"1px solid currentColor",padding:".1rem .2rem",fontWeight:"bold",borderRadius:".25rem"},onClick:()=>n(i=>!i),children:t?"Hide Error":"Show Error"})]}),g.jsx("div",{style:{height:".25rem"}}),t?g.jsx("div",{children:g.jsx("pre",{style:{fontSize:".7em",border:"1px solid red",borderRadius:".25rem",padding:".3rem",color:"red",overflow:"auto"},children:e.message?g.jsx("code",{children:e.message}):null})}):null]})}function dq({children:e,fallback:t=null}){return hq()?g.jsx(pi.Fragment,{children:e}):g.jsx(pi.Fragment,{children:t})}function hq(){return pi.useSyncExternalStore(fq,()=>!0,()=>!1)}function fq(){return()=>{}}var r0={exports:{}},o0={},a0={exports:{}},l0={};var hA;function pq(){if(hA)return l0;hA=1;var e=Lf();function t(f,m){return f===m&&(f!==0||1/f===1/m)||f!==f&&m!==m}var n=typeof Object.is=="function"?Object.is:t,i=e.useState,s=e.useEffect,r=e.useLayoutEffect,o=e.useDebugValue;function a(f,m){var y=m(),b=i({inst:{value:y,getSnapshot:m}}),S=b[0].inst,_=b[1];return r(function(){S.value=y,S.getSnapshot=m,c(S)&&_({inst:S})},[f,y,m]),s(function(){return c(S)&&_({inst:S}),f(function(){c(S)&&_({inst:S})})},[f]),o(y),y}function c(f){var m=f.getSnapshot;f=f.value;try{var y=m();return!n(f,y)}catch{return!0}}function u(f,m){return m()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:a;return l0.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:h,l0}var fA;function mq(){return fA||(fA=1,a0.exports=pq()),a0.exports}var pA;function gq(){if(pA)return o0;pA=1;var e=Lf(),t=mq();function n(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var i=typeof Object.is=="function"?Object.is:n,s=t.useSyncExternalStore,r=e.useRef,o=e.useEffect,a=e.useMemo,c=e.useDebugValue;return o0.useSyncExternalStoreWithSelector=function(u,h,f,m,y){var b=r(null);if(b.current===null){var S={hasValue:!1,value:null};b.current=S}else S=b.current;b=a(function(){function w(T){if(!M){if(M=!0,R=T,T=m(T),y!==void 0&&S.hasValue){var L=S.value;if(y(L,T))return E=L}return E=T}if(L=E,i(R,T))return L;var P=m(T);return y!==void 0&&y(L,P)?(R=T,L):(R=T,E=P)}var M=!1,R,E,A=f===void 0?null:f;return[function(){return w(h())},A===null?void 0:function(){return w(A())}]},[h,f,m,y]);var _=s(u,b[0],b[1]);return o(function(){S.hasValue=!0,S.value=_},[_]),c(_),_},o0}var mA;function vq(){return mA||(mA=1,r0.exports=gq()),r0.exports}var yq=vq();function bq(e,t=i=>i,n={}){const i=n.equal??_q;return yq.useSyncExternalStoreWithSelector(e.subscribe,()=>e.state,()=>e.state,t,i)}function _q(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[i,s]of e)if(!t.has(i)||!Object.is(s,t.get(i)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();const n=gA(e);if(n.length!==gA(t).length)return!1;for(let i=0;i<n.length;i++)if(!Object.prototype.hasOwnProperty.call(t,n[i])||!Object.is(e[n[i]],t[n[i]]))return!1;return!0}function gA(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}const c0=k.createContext(null);function kD(){return typeof document>"u"?c0:window.__TSR_ROUTER_CONTEXT__?window.__TSR_ROUTER_CONTEXT__:(window.__TSR_ROUTER_CONTEXT__=c0,c0)}function ai(e){const t=k.useContext(kD());return e?.warn,t}function mi(e){const t=ai({warn:e?.router===void 0}),n=e?.router||t,i=k.useRef(void 0);return bq(n.__store,s=>{if(e?.select){if(e.structuralSharing??n.options.defaultStructuralSharing){const r=Rs(i.current,e.select(s));return i.current=r,r}return e.select(s)}return s})}const Kv=k.createContext(void 0),Sq=k.createContext(void 0);function Ur(e){const t=k.useContext(e.from?Sq:Kv);return mi({select:i=>{const s=i.matches.find(r=>e.from?e.from===r.routeId:r.id===t);if(Do(!((e.shouldThrow??!0)&&!s),`Could not find ${e.from?`an active match from "${e.from}"`:"a nearest match!"}`),s!==void 0)return e.select?e.select(s):s},structuralSharing:e.structuralSharing})}function MC(e){return Ur({from:e.from,strict:e.strict,structuralSharing:e.structuralSharing,select:t=>e.select?e.select(t.loaderData):t.loaderData})}function AC(e){const{select:t,...n}=e;return Ur({...n,select:i=>t?t(i.loaderDeps):i.loaderDeps})}function $a(e){return Ur({from:e.from,shouldThrow:e.shouldThrow,structuralSharing:e.structuralSharing,strict:e.strict,select:t=>{const n=e.strict===!1?t.params:t._strictParams;return e.select?e.select(n):n}})}function Nf(e){return Ur({from:e.from,strict:e.strict,shouldThrow:e.shouldThrow,structuralSharing:e.structuralSharing,select:t=>e.select?e.select(t.search):t.search})}const yh=typeof window<"u"?k.useLayoutEffect:k.useEffect;function u0(e){const t=k.useRef({value:e,prev:null}),n=t.current.value;return e!==n&&(t.current={value:e,prev:n}),t.current.prev}function xq(e,t,n={},i={}){k.useEffect(()=>{if(!e.current||i.disabled||typeof IntersectionObserver!="function")return;const s=new IntersectionObserver(([r])=>{t(r)},n);return s.observe(e.current),()=>{s.disconnect()}},[t,n,i.disabled,e])}function wq(e){const t=k.useRef(null);return k.useImperativeHandle(e,()=>t.current,[]),t}function fr(e){const t=ai();return k.useCallback(n=>t.navigate({...n,from:n.from??e?.from}),[e?.from,t])}function Cq(e){const t=ai(),n=fr(),i=k.useRef(null);return yh(()=>{i.current!==e&&(n(e),i.current=e)},[t,e,n]),null}var PC=Q2();const kq=Ql(PC);function Tq(e,t){const n=ai(),[i,s]=k.useState(!1),r=k.useRef(!1),o=wq(t),{activeProps:a,inactiveProps:c,activeOptions:u,to:h,preload:f,preloadDelay:m,hashScrollIntoView:y,replace:b,startTransition:S,resetScroll:_,viewTransition:w,children:M,target:R,disabled:E,style:A,className:T,onClick:L,onFocus:P,onMouseEnter:I,onMouseLeave:N,onTouchStart:O,ignoreBlocker:j,params:$,search:V,hash:H,state:B,mask:W,reloadDocument:q,unsafeRelative:ne,from:z,_fromLocation:G,...J}=e,U=mi({select:ve=>ve.location.search,structuralSharing:!0}),re=e.from,de=k.useMemo(()=>({...e,from:re}),[n,U,re,e._fromLocation,e.hash,e.to,e.search,e.params,e.state,e.mask,e.unsafeRelative]),ce=k.useMemo(()=>n.buildLocation({...de}),[n,de]),ae=k.useMemo(()=>{if(E)return;let ve=ce.maskedLocation?ce.maskedLocation.url.href:ce.url.href,Me=!1;return n.origin&&(ve.startsWith(n.origin)?ve=n.history.createHref(ve.replace(n.origin,""))||"/":Me=!0),{href:ve,external:Me}},[E,ce.maskedLocation,ce.url,n.origin,n.history]),be=k.useMemo(()=>{if(ae?.external)return ae.href;try{return new URL(h),h}catch{}},[h,ae]),Ce=e.reloadDocument||be?!1:f??n.options.defaultPreload,qe=m??n.options.defaultPreloadDelay??0,dt=mi({select:ve=>{if(be)return!1;if(u?.exact){if(!N$(ve.location.pathname,ce.pathname,n.basepath))return!1}else{const Me=Wg(ve.location.pathname,n.basepath),At=Wg(ce.pathname,n.basepath);if(!(Me.startsWith(At)&&(Me.length===At.length||Me[At.length]==="/")))return!1}return(u?.includeSearch??!0)&&!Dl(ve.location.search,ce.search,{partial:!u?.exact,ignoreUndefined:!u?.explicitUndefined})?!1:u?.includeHash?ve.location.hash===ce.hash:!0}}),yt=k.useCallback(()=>{n.preloadRoute({...de}).catch(ve=>{console.warn(ve),console.warn(lq)})},[n,de]),He=k.useCallback(ve=>{ve?.isIntersecting&&yt()},[yt]);xq(o,He,Pq,{disabled:!!E||Ce!=="viewport"}),k.useEffect(()=>{r.current||!E&&Ce==="render"&&(yt(),r.current=!0)},[E,yt,Ce]);const We=ve=>{const Me=ve.currentTarget.getAttribute("target"),At=R!==void 0?R:Me;if(!E&&!Lq(ve)&&!ve.defaultPrevented&&(!At||At==="_self")&&ve.button===0){ve.preventDefault(),PC.flushSync(()=>{s(!0)});const se=n.subscribe("onResolved",()=>{se(),s(!1)});n.navigate({...de,replace:b,resetScroll:_,hashScrollIntoView:y,startTransition:S,viewTransition:w,ignoreBlocker:j})}};if(be)return{...J,ref:o,href:be,...M&&{children:M},...R&&{target:R},...E&&{disabled:E},...A&&{style:A},...T&&{className:T},...L&&{onClick:L},...P&&{onFocus:P},...I&&{onMouseEnter:I},...N&&{onMouseLeave:N},...O&&{onTouchStart:O}};const Jn=ve=>{E||Ce&&yt()},Fn=Jn,li=ve=>{if(!(E||!Ce))if(!qe)yt();else{const Me=ve.target;if(Xd.has(Me))return;const At=setTimeout(()=>{Xd.delete(Me),yt()},qe);Xd.set(Me,At)}},Be=ve=>{if(E||!Ce||!qe)return;const Me=ve.target,At=Xd.get(Me);At&&(clearTimeout(At),Xd.delete(Me))},ot=dt?ka(a,{})??Eq:d0,De=dt?d0:ka(c,{})??d0,Ge=[T,ot.className,De.className].filter(Boolean).join(" "),Ze=(A||ot.style||De.style)&&{...A,...ot.style,...De.style};return{...J,...ot,...De,href:ae?.href,ref:o,onClick:Qd([L,We]),onFocus:Qd([P,Jn]),onMouseEnter:Qd([I,li]),onMouseLeave:Qd([N,Be]),onTouchStart:Qd([O,Fn]),disabled:!!E,target:R,...Ze&&{style:Ze},...Ge&&{className:Ge},...E&&Rq,...dt&&Mq,...i&&Aq}}const d0={},Eq={className:"active"},Rq={role:"link","aria-disabled":!0},Mq={"data-status":"active","aria-current":"page"},Aq={"data-transitioning":"transitioning"},Xd=new WeakMap,Pq={rootMargin:"100px"},Qd=e=>t=>{for(const n of e)if(n){if(t.defaultPrevented)return;n(t)}},TD=k.forwardRef((e,t)=>{const{_asChild:n,...i}=e,{type:s,ref:r,...o}=Tq(i,t),a=typeof i.children=="function"?i.children({isActive:o["data-status"]==="active"}):i.children;return n===void 0&&delete o.disabled,k.createElement(n||"a",{...o,ref:r},a)});function Lq(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}class Nq extends CD{constructor(t){super(t),this.useMatch=n=>Ur({select:n?.select,from:this.id,structuralSharing:n?.structuralSharing}),this.useRouteContext=n=>Ur({...n,from:this.id,select:i=>n?.select?n.select(i.context):i.context}),this.useSearch=n=>Nf({select:n?.select,structuralSharing:n?.structuralSharing,from:this.id}),this.useParams=n=>$a({select:n?.select,structuralSharing:n?.structuralSharing,from:this.id}),this.useLoaderDeps=n=>AC({...n,from:this.id}),this.useLoaderData=n=>MC({...n,from:this.id}),this.useNavigate=()=>fr({from:this.fullPath}),this.Link=pi.forwardRef((n,i)=>g.jsx(TD,{ref:i,from:this.fullPath,...n})),this.$$typeof=Symbol.for("react.memo")}}function Wr(e){return new Nq(e)}class Iq extends cq{constructor(t){super(t),this.useMatch=n=>Ur({select:n?.select,from:this.id,structuralSharing:n?.structuralSharing}),this.useRouteContext=n=>Ur({...n,from:this.id,select:i=>n?.select?n.select(i.context):i.context}),this.useSearch=n=>Nf({select:n?.select,structuralSharing:n?.structuralSharing,from:this.id}),this.useParams=n=>$a({select:n?.select,structuralSharing:n?.structuralSharing,from:this.id}),this.useLoaderDeps=n=>AC({...n,from:this.id}),this.useLoaderData=n=>MC({...n,from:this.id}),this.useNavigate=()=>fr({from:this.fullPath}),this.Link=pi.forwardRef((n,i)=>g.jsx(TD,{ref:i,from:this.fullPath,...n})),this.$$typeof=Symbol.for("react.memo")}}function Dq(e){return new Iq(e)}function vA(e){return typeof e=="object"?new yA(e,{silent:!0}).createRoute(e):new yA(e,{silent:!0}).createRoute}class yA{constructor(t,n){this.path=t,this.createRoute=i=>{this.silent;const s=Wr(i);return s.isRoot=!1,s},this.silent=n?.silent}}class bA{constructor(t){this.useMatch=n=>Ur({select:n?.select,from:this.options.id,structuralSharing:n?.structuralSharing}),this.useRouteContext=n=>Ur({from:this.options.id,select:i=>n?.select?n.select(i.context):i.context}),this.useSearch=n=>Nf({select:n?.select,structuralSharing:n?.structuralSharing,from:this.options.id}),this.useParams=n=>$a({select:n?.select,structuralSharing:n?.structuralSharing,from:this.options.id}),this.useLoaderDeps=n=>AC({...n,from:this.options.id}),this.useLoaderData=n=>MC({...n,from:this.options.id}),this.useNavigate=()=>{const n=ai();return fr({from:n.routesById[this.options.id].fullPath})},this.options=t,this.$$typeof=Symbol.for("react.memo")}}function _A(e){return typeof e=="object"?new bA(e):t=>new bA({id:e,...t})}function Oq(){const e=ai(),t=k.useRef({router:e,mounted:!1}),[n,i]=k.useState(!1),{hasPendingMatches:s,isLoading:r}=mi({select:f=>({isLoading:f.isLoading,hasPendingMatches:f.matches.some(m=>m.status==="pending")}),structuralSharing:!0}),o=u0(r),a=r||n||s,c=u0(a),u=r||s,h=u0(u);return e.startTransition=f=>{i(!0),k.startTransition(()=>{f(),i(!1)})},k.useEffect(()=>{const f=e.history.subscribe(e.load),m=e.buildLocation({to:e.latestLocation.pathname,search:!0,params:!0,hash:!0,state:!0,_includeValidateSearch:!0});return Ol(e.latestLocation.publicHref)!==Ol(m.publicHref)&&e.commitLocation({...m,replace:!0}),()=>{f()}},[e,e.history]),yh(()=>{if(typeof window<"u"&&e.ssr||t.current.router===e&&t.current.mounted)return;t.current={router:e,mounted:!0},(async()=>{try{await e.load()}catch(m){console.error(m)}})()},[e]),yh(()=>{o&&!r&&e.emit({type:"onLoad",...jl(e.state)})},[o,e,r]),yh(()=>{h&&!u&&e.emit({type:"onBeforeRouteMount",...jl(e.state)})},[u,h,e]),yh(()=>{if(c&&!a){const f=jl(e.state);e.emit({type:"onResolved",...f}),e.__store.setState(m=>({...m,status:"idle",resolvedLocation:m.location})),f.hrefChanged&&z$(e)}},[a,c,e]),null}function jq(e){const t=mi({select:n=>`not-found-${n.location.pathname}-${n.status}`});return g.jsx(RC,{getResetKey:()=>t,onCatch:(n,i)=>{if(hs(n))e.onCatch?.(n,i);else throw n},errorComponent:({error:n})=>{if(hs(n))return e.fallback?.(n);throw n},children:e.children})}function Bq(){return g.jsx("p",{children:"Not Found"})}function ou(e){return g.jsx(g.Fragment,{children:e.children})}function ED(e,t,n){return t.options.notFoundComponent?g.jsx(t.options.notFoundComponent,{...n}):e.options.defaultNotFoundComponent?g.jsx(e.options.defaultNotFoundComponent,{...n}):g.jsx(Bq,{})}function Fq({children:e}){const t=ai();return t.isServer?g.jsx("script",{nonce:t.options.ssr?.nonce,dangerouslySetInnerHTML:{__html:e+";document.currentScript.remove()"}}):null}function Uq(){const e=ai();if(!e.isScrollRestoring||!e.isServer||typeof e.options.scrollRestoration=="function"&&!e.options.scrollRestoration({location:e.latestLocation}))return null;const n=(e.options.getScrollRestorationKey||hx)(e.latestLocation),i=n!==hx(e.latestLocation)?n:void 0,s={storageKey:Gg,shouldScrollRestoration:!0};return i&&(s.key=i),g.jsx(Fq,{children:`(${pD.toString()})(${JSON.stringify(s)})`})}const RD=k.memo(function({matchId:t}){const n=ai(),i=mi({select:w=>{const M=w.matches.find(R=>R.id===t);return Do(M),{routeId:M.routeId,ssr:M.ssr,_displayPending:M._displayPending}},structuralSharing:!0}),s=n.routesById[i.routeId],r=s.options.pendingComponent??n.options.defaultPendingComponent,o=r?g.jsx(r,{}):null,a=s.options.errorComponent??n.options.defaultErrorComponent,c=s.options.onCatch??n.options.defaultOnCatch,u=s.isRoot?s.options.notFoundComponent??n.options.notFoundRoute?.options.component:s.options.notFoundComponent,h=i.ssr===!1||i.ssr==="data-only",f=(!s.isRoot||s.options.wrapInSuspense||h)&&(s.options.wrapInSuspense??r??(s.options.errorComponent?.preload||h))?k.Suspense:ou,m=a?RC:ou,y=u?jq:ou,b=mi({select:w=>w.loadedAt}),S=mi({select:w=>{const M=w.matches.findIndex(R=>R.id===t);return w.matches[M-1]?.routeId}}),_=s.isRoot?s.options.shellComponent??ou:ou;return g.jsxs(_,{children:[g.jsx(Kv.Provider,{value:t,children:g.jsx(f,{fallback:o,children:g.jsx(m,{getResetKey:()=>b,errorComponent:a||Gv,onCatch:(w,M)=>{if(hs(w))throw w;c?.(w,M)},children:g.jsx(y,{fallback:w=>{if(!u||w.routeId&&w.routeId!==i.routeId||!w.routeId&&!s.isRoot)throw w;return k.createElement(u,w)},children:h||i._displayPending?g.jsx(dq,{fallback:o,children:g.jsx(SA,{matchId:t})}):g.jsx(SA,{matchId:t})})})})}),S===ls&&n.options.scrollRestoration?g.jsxs(g.Fragment,{children:[g.jsx(zq,{}),g.jsx(Uq,{})]}):null]})});function zq(){const e=ai(),t=k.useRef(void 0);return g.jsx("script",{suppressHydrationWarning:!0,ref:n=>{n&&(t.current===void 0||t.current.href!==e.latestLocation.href)&&(e.emit({type:"onRendered",...jl(e.state)}),t.current=e.latestLocation)}},e.latestLocation.state.__TSR_key)}const SA=k.memo(function({matchId:t}){const n=ai(),{match:i,key:s,routeId:r}=mi({select:c=>{const u=c.matches.find(b=>b.id===t),h=u.routeId,m=(n.routesById[h].options.remountDeps??n.options.defaultRemountDeps)?.({routeId:h,loaderDeps:u.loaderDeps,params:u._strictParams,search:u._strictSearch});return{key:m?JSON.stringify(m):void 0,routeId:h,match:{id:u.id,status:u.status,error:u.error,invalid:u.invalid,_forcePending:u._forcePending,_displayPending:u._displayPending}}},structuralSharing:!0}),o=n.routesById[r],a=k.useMemo(()=>{const c=o.options.component??n.options.defaultComponent;return c?g.jsx(c,{},s):g.jsx(Yv,{})},[s,o.options.component,n.options.defaultComponent]);if(i._displayPending)throw n.getMatch(i.id)?._nonReactive.displayPendingPromise;if(i._forcePending)throw n.getMatch(i.id)?._nonReactive.minPendingPromise;if(i.status==="pending"){const c=o.options.pendingMinMs??n.options.defaultPendingMinMs;if(c){const u=n.getMatch(i.id);if(u&&!u._nonReactive.minPendingPromise&&!n.isServer){const h=Au();u._nonReactive.minPendingPromise=h,setTimeout(()=>{h.resolve(),u._nonReactive.minPendingPromise=void 0},c)}}throw n.getMatch(i.id)?._nonReactive.loadPromise}if(i.status==="notFound")return Do(hs(i.error)),ED(n,o,i.error);if(i.status==="redirected")throw Do(js(i.error)),n.getMatch(i.id)?._nonReactive.loadPromise;if(i.status==="error"){if(n.isServer){const c=(o.options.errorComponent??n.options.defaultErrorComponent)||Gv;return g.jsx(c,{error:i.error,reset:void 0,info:{componentStack:""}})}throw i.error}return a}),Yv=k.memo(function(){const t=ai(),n=k.useContext(Kv),i=mi({select:u=>u.matches.find(h=>h.id===n)?.routeId}),s=t.routesById[i],r=mi({select:u=>{const f=u.matches.find(m=>m.id===n);return Do(f),f.globalNotFound}}),o=mi({select:u=>{const h=u.matches,f=h.findIndex(m=>m.id===n);return h[f+1]?.id}}),a=t.options.defaultPendingComponent?g.jsx(t.options.defaultPendingComponent,{}):null;if(r)return ED(t,s,void 0);if(!o)return null;const c=g.jsx(RD,{matchId:o});return i===ls?g.jsx(k.Suspense,{fallback:a,children:c}):c});function $q(){const e=ai(),n=e.routesById[ls].options.pendingComponent??e.options.defaultPendingComponent,i=n?g.jsx(n,{}):null,s=e.isServer||typeof document<"u"&&e.ssr?ou:k.Suspense,r=g.jsxs(s,{fallback:i,children:[!e.isServer&&g.jsx(Oq,{}),g.jsx(qq,{})]});return e.options.InnerWrap?g.jsx(e.options.InnerWrap,{children:r}):r}function qq(){const e=ai(),t=mi({select:s=>s.matches[0]?.id}),n=mi({select:s=>s.loadedAt}),i=t?g.jsx(RD,{matchId:t}):null;return g.jsx(Kv.Provider,{value:t,children:e.options.disableGlobalCatchBoundary?i:g.jsx(RC,{getResetKey:()=>n,errorComponent:Gv,onCatch:s=>{s.message||s.toString()},children:i})})}function MD(){const e=ai();return mi({select:t=>[t.location.href,t.resolvedLocation?.href,t.status],structuralSharing:!0}),k.useCallback(t=>{const{pending:n,caseSensitive:i,fuzzy:s,includeSearch:r,...o}=t;return e.matchRoute(o,{pending:n,caseSensitive:i,fuzzy:s,includeSearch:r})},[e])}const Hq=e=>new Vq(e);class Vq extends iq{constructor(t){super(t)}}typeof globalThis<"u"?(globalThis.createFileRoute=vA,globalThis.createLazyFileRoute=_A):typeof window<"u"&&(window.createFileRoute=vA,window.createLazyFileRoute=_A);function Wq({router:e,children:t,...n}){Object.keys(n).length>0&&e.update({...e.options,...n,context:{...e.options.context,...n.context}});const i=kD(),s=g.jsx(i.Provider,{value:e,children:t});return e.options.Wrap?g.jsx(e.options.Wrap,{children:s}):s}function Gq({router:e,...t}){return g.jsx(Wq,{router:e,...t,children:g.jsx($q,{})})}function ef(e){return mi({select:t=>e?.select?e.select(t.location):t.location})}function Kq(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:i,onRegistered:s,onRegisteredSW:r,onRegisterError:o}=e;let a,c;const u=async(f=!0)=>{await c};async function h(){if("serviceWorker"in navigator){if(a=await xt(async()=>{const{Workbox:f}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:f}},[]).then(({Workbox:f})=>new f("/sw.js",{scope:"/",type:"classic"})).catch(f=>{o?.(f)}),!a)return;a.addEventListener("activated",f=>{(f.isUpdate||f.isExternal)&&window.location.reload()}),a.addEventListener("installed",f=>{f.isUpdate||i?.()}),a.register({immediate:t}).then(f=>{r?r("/sw.js",f):s?.(f)}).catch(f=>{o?.(f)})}}return c=h(),u}function Yq(){return[{value:.8,label:"80%"},{value:.9,label:"90%"},{value:1,label:"100%"},{value:1.1,label:"110%"},{value:1.2,label:"120%"}]}function sg(){return"hapi-font-scale"}function $u(){return typeof window<"u"&&typeof document<"u"}const Xq=$u()?k.useLayoutEffect:k.useEffect;function Qq(e){if(!$u())return null;try{return localStorage.getItem(e)}catch{return null}}function Jq(e,t){if($u())try{localStorage.setItem(e,t)}catch{}}function Zq(e){if($u())try{localStorage.removeItem(e)}catch{}}function AD(e){const t=Number(e);return t===.8||t===.9||t===1||t===1.1||t===1.2?t:1}function PD(e){$u()&&document.documentElement.style.setProperty("--app-font-scale",String(e))}function LD(){return AD(Qq(sg()))}function eH(){PD(LD())}function tH(){const[e,t]=k.useState(LD);Xq(()=>{PD(e)},[e]),k.useEffect(()=>{if(!$u())return;const i=s=>{if(s.key!==sg())return;const r=AD(s.newValue);t(r)};return window.addEventListener("storage",i),()=>window.removeEventListener("storage",i)},[]);const n=k.useCallback(i=>{t(i),i===1?Zq(sg()):Jq(sg(),String(i))},[]);return{fontScale:e,setFontScale:n}}function ND(){if(typeof window>"u")return!1;const e=window.location.hash.slice(1),t=new URLSearchParams(e);if(t.has("tgWebAppVersion")||t.has("tgWebAppData"))return!0;const n=window.location.search;return!!(n.includes("tgWebApp")||n.includes("initData"))}function Ir(){return window.Telegram?.WebApp??null}function Xv(){const e=Ir();return e!==null&&!!e.initData}function nH(e=3e3){return new Promise(t=>{if(window.Telegram?.WebApp){t();return}let n=!1;const i=()=>{n||(n=!0,t())};setTimeout(i,e);const s=document.createElement("script");s.src="https://telegram.org/js/telegram-web-app.js",s.async=!0,s.onload=i,s.onerror=i,document.head.appendChild(s)})}const iH=new Y8({defaultOptions:{queries:{staleTime:5e3,refetchOnWindowFocus:!1,retry:1},mutations:{retry:0}}});function LC(){const e=Ir();return e?.colorScheme?e.colorScheme==="dark"?"dark":"light":typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function NC(e){document.documentElement.setAttribute("data-theme",e)}let tf=LC();const sH=new Set;NC(tf);function xA(){const e=LC();e!==tf&&(tf=e,NC(e),sH.forEach(t=>t()))}let wA=!1;function rH(){if(tf=LC(),NC(tf),!wA){wA=!0;const e=Ir();e?.onEvent?e.onEvent("themeChanged",xA):typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",xA)}}function CA(e){try{const t=JSON.parse(e);return typeof t.error=="string"?t.error:void 0}catch{return}}class px extends Error{constructor(t,n,i,s){super(t),this.name="ApiError",this.status=n,this.code=i,this.body=s}}class bh{constructor(t,n){this.token=t,this.baseUrl=n?.baseUrl??null,this.getToken=n?.getToken??null,this.onUnauthorized=n?.onUnauthorized??null}buildUrl(t){if(!this.baseUrl)return t;try{return new URL(t,this.baseUrl).toString()}catch{return t}}async request(t,n,i=0,s){const r=new Headers(n?.headers),o=this.getToken?this.getToken():null,a=s!==void 0?s??o??this.token:o??this.token;a&&r.set("authorization",`Bearer ${a}`),n?.body!==void 0&&!r.has("content-type")&&r.set("content-type","application/json");const c=await fetch(this.buildUrl(t),{...n,headers:r});if(c.status===401){if(i===0&&this.onUnauthorized){const u=await this.onUnauthorized();if(u)return this.token=u,await this.request(t,n,i+1,u)}throw new Error("Session expired. Please sign in again.")}if(!c.ok){const u=await c.text().catch(()=>"");throw new Error(`HTTP ${c.status} ${c.statusText}: ${u}`)}return await c.json()}async authenticate(t){const n=await fetch(this.buildUrl("/api/auth"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const i=await n.text().catch(()=>""),s=CA(i),r=i?`: ${i}`:"";throw new px(`Auth failed: HTTP ${n.status} ${n.statusText}${r}`,n.status,s,i||void 0)}return await n.json()}async bind(t){const n=await fetch(this.buildUrl("/api/bind"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const i=await n.text().catch(()=>""),s=CA(i),r=i?`: ${i}`:"";throw new px(`Bind failed: HTTP ${n.status} ${n.statusText}${r}`,n.status,s,i||void 0)}return await n.json()}async getSessions(){return await this.request("/api/sessions")}async getPushVapidPublicKey(){return await this.request("/api/push/vapid-public-key")}async subscribePushNotifications(t){await this.request("/api/push/subscribe",{method:"POST",body:JSON.stringify(t)})}async unsubscribePushNotifications(t){await this.request("/api/push/subscribe",{method:"DELETE",body:JSON.stringify(t)})}async setVisibility(t){await this.request("/api/visibility",{method:"POST",body:JSON.stringify(t)})}async getSession(t){return await this.request(`/api/sessions/${encodeURIComponent(t)}`)}async getMessages(t,n){const i=new URLSearchParams;n.beforeSeq!==void 0&&n.beforeSeq!==null&&i.set("beforeSeq",`${n.beforeSeq}`),n.limit!==void 0&&n.limit!==null&&i.set("limit",`${n.limit}`);const s=i.toString(),r=`/api/sessions/${encodeURIComponent(t)}/messages${s?`?${s}`:""}`;return await this.request(r)}async getGitStatus(t){return await this.request(`/api/sessions/${encodeURIComponent(t)}/git-status`)}async getGitDiffNumstat(t,n){const i=new URLSearchParams;return i.set("staged",n?"true":"false"),await this.request(`/api/sessions/${encodeURIComponent(t)}/git-diff-numstat?${i.toString()}`)}async getGitDiffFile(t,n,i){const s=new URLSearchParams;return s.set("path",n),i!==void 0&&s.set("staged",i?"true":"false"),await this.request(`/api/sessions/${encodeURIComponent(t)}/git-diff-file?${s.toString()}`)}async searchSessionFiles(t,n,i){const s=new URLSearchParams;n&&s.set("query",n),i!==void 0&&s.set("limit",`${i}`);const r=s.toString();return await this.request(`/api/sessions/${encodeURIComponent(t)}/files${r?`?${r}`:""}`)}async readSessionFile(t,n){const i=new URLSearchParams;return i.set("path",n),await this.request(`/api/sessions/${encodeURIComponent(t)}/file?${i.toString()}`)}async listSessionDirectory(t,n){const i=new URLSearchParams;n&&i.set("path",n);const s=i.toString();return await this.request(`/api/sessions/${encodeURIComponent(t)}/directory${s?`?${s}`:""}`)}async uploadFile(t,n,i,s){return await this.request(`/api/sessions/${encodeURIComponent(t)}/upload`,{method:"POST",body:JSON.stringify({filename:n,content:i,mimeType:s})})}async deleteUploadFile(t,n){return await this.request(`/api/sessions/${encodeURIComponent(t)}/upload/delete`,{method:"POST",body:JSON.stringify({path:n})})}async resumeSession(t){return(await this.request(`/api/sessions/${encodeURIComponent(t)}/resume`,{method:"POST"})).sessionId}async sendMessage(t,n,i,s){await this.request(`/api/sessions/${encodeURIComponent(t)}/messages`,{method:"POST",body:JSON.stringify({text:n,localId:i??void 0,attachments:s??void 0})})}async abortSession(t){await this.request(`/api/sessions/${encodeURIComponent(t)}/abort`,{method:"POST",body:JSON.stringify({})})}async archiveSession(t){await this.request(`/api/sessions/${encodeURIComponent(t)}/archive`,{method:"POST",body:JSON.stringify({})})}async switchSession(t){await this.request(`/api/sessions/${encodeURIComponent(t)}/switch`,{method:"POST",body:JSON.stringify({})})}async setPermissionMode(t,n){await this.request(`/api/sessions/${encodeURIComponent(t)}/permission-mode`,{method:"POST",body:JSON.stringify({mode:n})})}async setModelMode(t,n){await this.request(`/api/sessions/${encodeURIComponent(t)}/model`,{method:"POST",body:JSON.stringify({model:n})})}async approvePermission(t,n,i){const s=typeof i=="string"||i===void 0?{mode:i}:i;await this.request(`/api/sessions/${encodeURIComponent(t)}/permissions/${encodeURIComponent(n)}/approve`,{method:"POST",body:JSON.stringify(s)})}async denyPermission(t,n,i){await this.request(`/api/sessions/${encodeURIComponent(t)}/permissions/${encodeURIComponent(n)}/deny`,{method:"POST",body:JSON.stringify(i??{})})}async getMachines(){return await this.request("/api/machines")}async checkMachinePathsExists(t,n){return await this.request(`/api/machines/${encodeURIComponent(t)}/paths/exists`,{method:"POST",body:JSON.stringify({paths:n})})}async spawnSession(t,n,i,s,r,o,a){return await this.request(`/api/machines/${encodeURIComponent(t)}/spawn`,{method:"POST",body:JSON.stringify({directory:n,agent:i,model:s,yolo:r,sessionType:o,worktreeName:a})})}async getSlashCommands(t){return await this.request(`/api/sessions/${encodeURIComponent(t)}/slash-commands`)}async getSkills(t){return await this.request(`/api/sessions/${encodeURIComponent(t)}/skills`)}async renameSession(t,n){await this.request(`/api/sessions/${encodeURIComponent(t)}`,{method:"PATCH",body:JSON.stringify({name:n})})}async deleteSession(t){await this.request(`/api/sessions/${encodeURIComponent(t)}`,{method:"DELETE"})}async fetchVoiceToken(t){return await this.request("/api/voice/token",{method:"POST",body:JSON.stringify(t||{})})}}function kA(e){const t=e.split(".");if(t.length<2)return null;const n=t[1]??"",i=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(Math.ceil(n.length/4)*4,"=");try{const s=globalThis.atob(i),r=JSON.parse(s);return typeof r.exp!="number"?null:r.exp*1e3}catch{return null}}function TA(e){return e.type==="telegram"?{initData:e.initData}:{accessToken:e.token}}function EA(e){return e instanceof px&&e.status===401&&e.code==="not_bound"}function oH(e,t){const[n,i]=k.useState(null),[s,r]=k.useState(null),[o,a]=k.useState(!1),[c,u]=k.useState(null),[h,f]=k.useState(!1),m=k.useRef(null),y=k.useRef(null),b=k.useRef(0),S=k.useRef(e);S.current=e,y.current=n;const _=k.useCallback(async R=>{const E=S.current,A=y.current;if(!E)return null;const T=A?kA(A):null,L=R?.minTtlMs??0,P=Date.now(),I=T?T-P:null,N=I!==null&&I<=L;if(!R?.force&&I!==null&&I>L||!R?.force&&!N&&P-b.current<15e3)return A;if(m.current)return await m.current;const j=(async()=>{b.current=P;try{const V=await new bh("",{baseUrl:t}).authenticate(TA(E));return y.current=V.token,i(V.token),r(V.user),u(null),f(!1),V.token}catch($){if(E.type==="telegram"&&EA($))return y.current=null,i(null),r(null),u(null),f(!0),null;const V=T?Date.now()>=T:!1;if(R?.hardFail||V){y.current=null,i(null),r(null);const H=E.type==="telegram"?"Session expired. Reopen the Mini App from Telegram.":"Session expired. Please login again.";u(H)}return null}})();m.current=j;try{return await j}finally{m.current===j&&(m.current=null)}},[t]),w=k.useCallback(async R=>{const E=S.current;if(!E||E.type!=="telegram"){u("Binding is only supported in Telegram.");return}a(!0),u(null);try{const T=await new bh("",{baseUrl:t}).bind({initData:E.initData,accessToken:R});y.current=T.token,i(T.token),r(T.user),f(!1)}catch(A){throw u(A instanceof Error?A.message:"Binding failed"),A}finally{a(!1)}},[t]),M=k.useMemo(()=>n?new bh(n,{baseUrl:t,getToken:()=>y.current,onUnauthorized:()=>_({force:!0})}):null,[t,_,n]);return k.useEffect(()=>{let R=!1;async function E(){if(!e){f(!1);return}a(!0),u(null),f(!1);try{const T=await new bh("",{baseUrl:t}).authenticate(TA(e));if(R)return;i(T.token),r(T.user),f(!1)}catch(A){if(R)return;if(e.type==="telegram"&&EA(A)){i(null),r(null),u(null),f(!0);return}f(!1),u(A instanceof Error?A.message:"Auth failed")}finally{R||a(!1)}}return E(),()=>{R=!0}},[e,t]),k.useEffect(()=>{y.current=null,m.current=null,b.current=0,i(null),r(null),u(null),f(!1)},[t]),k.useEffect(()=>{if(!n||!e)return;const R=kA(n);if(!R)return;let E=!1,A=null;const T=P=>{A&&clearTimeout(A),A=setTimeout(()=>{L()},Math.max(0,P))},L=async()=>{if(E)return;const P=await _({force:!0});E||!P&&Date.now()<R&&T(15e3)};return T(R-6e4-Date.now()),()=>{E=!0,A&&clearTimeout(A)}},[e,_,n]),k.useEffect(()=>{if(!e)return;const R=()=>{_({minTtlMs:6e4})},E=()=>{document.visibilityState==="visible"&&R()};return window.addEventListener("focus",R),document.addEventListener("visibilitychange",E),()=>{window.removeEventListener("focus",R),document.removeEventListener("visibilitychange",E)}},[e,_]),{token:n,user:s,api:M,isLoading:o,error:c,needsBinding:h,bind:w}}const aH="hapi_access_token::";function RA(){const e=Ir();if(e?.initData)return e.initData;const t=new URLSearchParams(window.location.search),n=t.get("tgWebAppData");return n||t.get("initData")||null}function lH(){return typeof window>"u"?null:new URLSearchParams(window.location.search).get("token")}function cH(e){return`${aH}${e}`}function uH(e){try{return localStorage.getItem(e)}catch{return null}}function MA(e,t){try{localStorage.setItem(e,t)}catch{}}function dH(e){try{localStorage.removeItem(e)}catch{}}function hH(e){const[t,n]=k.useState(null),[i,s]=k.useState(!0),[r,o]=k.useState(!1),a=k.useRef(0),c=k.useMemo(()=>cH(e),[e]);k.useEffect(()=>{a.current=0,n(null),o(!1),s(!0);const f=RA();if(f){n({type:"telegram",initData:f}),o(!0),s(!1);return}const m=lH();if(m){MA(c,m),n({type:"accessToken",token:m}),s(!1);return}const y=uH(c);if(y){n({type:"accessToken",token:y}),s(!1);return}if(!ND()){s(!1);return}const b=20,_=setInterval(()=>{a.current+=1;const w=RA();w?(n({type:"telegram",initData:w}),o(!0),s(!1),clearInterval(_)):a.current>=b&&(s(!1),clearInterval(_))},250);return()=>{clearInterval(_)}},[c]);const u=k.useCallback(f=>{MA(c,f),n({type:"accessToken",token:f})},[c]),h=k.useCallback(()=>{dH(c),n(null)},[c]);return{authSource:t,isLoading:i,isTelegram:r,setAccessToken:u,clearAuth:h}}const Xg="hapi_hub_url";function IC(e){const t=e.trim();if(!t)return{ok:!1,error:"Enter a hub URL like https://example.com"};let n;try{n=new URL(t)}catch{return{ok:!1,error:"Enter a valid URL including http:// or https://"}}return n.protocol!=="http:"&&n.protocol!=="https:"?{ok:!1,error:"Hub URL must start with http:// or https://"}:{ok:!0,value:n.origin}}function fH(){if(typeof window>"u")return null;const t=new URLSearchParams(window.location.search).get("hub");if(t){const n=IC(t);return n.ok?n.value:null}return null}function pH(){try{const e=localStorage.getItem(Xg);if(!e)return null;const t=IC(e);return t.ok?t.value:(localStorage.removeItem(Xg),null)}catch{return null}}function AA(e){try{localStorage.setItem(Xg,e)}catch{}}function mH(){try{localStorage.removeItem(Xg)}catch{}}function gH(){const[e,t]=k.useState(()=>{const o=fH();return o?(AA(o),o):pH()}),n=typeof window<"u"?window.location.origin:"",i=k.useMemo(()=>e??n,[e,n]),s=k.useCallback(o=>{const a=IC(o);return a.ok&&(AA(a.value),t(a.value)),a},[]),r=k.useCallback(()=>{mH(),t(null)},[]);return{serverUrl:e,baseUrl:i,setServerUrl:s,clearServerUrl:r}}function ye(e){return!!e&&typeof e=="object"}function Ds(e){return typeof e=="string"?e:null}function Zs(e){return typeof e=="number"&&Number.isFinite(e)?e:null}function Ea(e){if(typeof e=="string")return e;try{const t=JSON.stringify(e,null,2);return typeof t=="string"?t:String(e)}catch{return String(e)}}function mm(e){return ye(e)?typeof e.role=="string"&&"content"in e:!1}function ID(e){if(mm(e))return e;if(!ye(e))return null;const t=e.message;if(mm(t))return t;const n=e.data;if(ye(n)&&mm(n.message))return n.message;const i=e.payload;return ye(i)&&mm(i.message)?i.message:null}const vH=["default","acceptEdits","bypassPermissions","plan"],yH=["default","read-only","safe-yolo","yolo"],bH=["default","read-only","safe-yolo","yolo"],_H=["default","yolo"],gm=["default","sonnet","opus"],SH={default:"Default",acceptEdits:"Accept Edits",plan:"Plan Mode",bypassPermissions:"Yolo","read-only":"Read Only","safe-yolo":"Safe Yolo",yolo:"Yolo"},xH={default:"neutral",acceptEdits:"warning",plan:"info",bypassPermissions:"danger","read-only":"warning","safe-yolo":"warning",yolo:"danger"},wH={default:"Default",sonnet:"Sonnet",opus:"Opus"};function DD(e){return SH[e]}function OD(e){return xH[e]}function jD(e){return e==="codex"?yH:e==="gemini"?bH:e==="opencode"?_H:vH}function CH(e){return jD(e).map(t=>({mode:t,label:DD(t),tone:OD(t)}))}function BD(e,t){return jD(t).includes(e)}const kH=1,Xt={sessions:["sessions"],session:e=>["session",e],messages:e=>["messages",e],machines:["machines"],gitStatus:e=>["git-status",e],sessionFiles:(e,t)=>["session-files",e,t],sessionDirectory:(e,t)=>["session-directory",e,t],sessionFile:(e,t)=>["session-file",e,t],gitFileDiff:(e,t,n)=>["git-file-diff",e,t,n?"staged":"unstaged"],slashCommands:e=>["slash-commands",e],skills:e=>["skills",e]};function TH(e){if(!ye(e))return;const t=Zs(e.date),n=e.result;if(t===null||n!=="approved"&&n!=="denied")return;const i=Ds(e.mode)??void 0,s=Array.isArray(e.allowedTools)?e.allowedTools.filter(a=>typeof a=="string"):void 0,r=e.decision;return{date:t,result:n,mode:i,allowedTools:s,decision:r==="approved"||r==="approved_for_session"||r==="denied"||r==="abort"?r:void 0}}function EH(e){return!ye(e)||typeof e.type!="string"?null:e}function RH(e,t,n,i,s){const r=Ds(i.uuid)??e,o=Ds(i.parentUuid)??null,a=!!i.isSidechain,c=ye(i.message)?i.message:null;if(!c)return null;const u=c.content,h=[];if(typeof u=="string")h.push({type:"text",text:u,uuid:r,parentUUID:o});else if(Array.isArray(u)){for(const b of u)if(!(!ye(b)||typeof b.type!="string")){if(b.type==="text"&&typeof b.text=="string"){h.push({type:"text",text:b.text,uuid:r,parentUUID:o});continue}if(b.type==="thinking"&&typeof b.thinking=="string"){h.push({type:"reasoning",text:b.thinking,uuid:r,parentUUID:o});continue}if(b.type==="tool_use"&&typeof b.id=="string"){const S=Ds(b.name)??"Tool",_="input"in b?b.input:void 0,w=ye(_)&&typeof _.description=="string"?_.description:null;h.push({type:"tool-call",id:b.id,name:S,input:_,description:w,uuid:r,parentUUID:o})}}}const f=ye(c.usage)?c.usage:null,m=f?Zs(f.input_tokens):null,y=f?Zs(f.output_tokens):null;return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:a,content:h,meta:s,usage:m!==null&&y!==null?{input_tokens:m,output_tokens:y,cache_creation_input_tokens:Zs(f?.cache_creation_input_tokens)??void 0,cache_read_input_tokens:Zs(f?.cache_read_input_tokens)??void 0,service_tier:Ds(f?.service_tier)??void 0}:void 0}}function MH(e,t,n,i,s){const r=Ds(i.uuid)??e,o=Ds(i.parentUuid)??null,a=!!i.isSidechain,c=ye(i.message)?i.message:null;if(!c)return null;const u=c.content;if(a&&typeof u=="string")return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!0,content:[{type:"sidechain",uuid:r,prompt:u}]};if(typeof u=="string")return{id:e,localId:t,createdAt:n,role:"user",isSidechain:!1,content:{type:"text",text:u},meta:s};const h=[];if(Array.isArray(u)){for(const f of u)if(!(!ye(f)||typeof f.type!="string")){if(f.type==="text"&&typeof f.text=="string"){h.push({type:"text",text:f.text,uuid:r,parentUUID:o});continue}if(f.type==="tool_result"&&typeof f.tool_use_id=="string"){const m=!!f.is_error,y="content"in f?f.content:void 0,b="toolUseResult"in i?i.toolUseResult:null,S=TH(f.permissions);h.push({type:"tool-result",tool_use_id:f.tool_use_id,content:b??y,is_error:m,uuid:r,parentUUID:o,permissions:S})}}}return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:a,content:h,meta:s}}function AH(e){if(!ye(e)||e.type!=="output")return!1;const t=ye(e.data)?e.data:null;return t?!!t.isMeta||!!t.isCompactSummary:!1}function PH(e){return ye(e)&&e.type==="codex"}function LH(e,t,n,i,s){if(!ye(i)||typeof i.type!="string")return null;if(i.type==="output"){const r=ye(i.data)?i.data:null;if(!r||typeof r.type!="string"||r.isMeta||r.isCompactSummary)return null;if(r.type==="assistant")return RH(e,t,n,r,s);if(r.type==="user")return MH(e,t,n,r,s);if(r.type==="summary"&&typeof r.summary=="string")return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!1,content:[{type:"summary",summary:r.summary}],meta:s};if(r.type==="system"&&r.subtype==="api_error")return{id:e,localId:t,createdAt:n,role:"event",content:{type:"api-error",retryAttempt:Zs(r.retryAttempt)??0,maxRetries:Zs(r.maxRetries)??0,error:r.error},isSidechain:!1,meta:s};if(r.type==="system"&&r.subtype==="turn_duration")return{id:e,localId:t,createdAt:n,role:"event",content:{type:"turn-duration",durationMs:Zs(r.durationMs)??0},isSidechain:!1,meta:s};if(r.type==="system"&&r.subtype==="microcompact_boundary"){const o=ye(r.microcompactMetadata)?r.microcompactMetadata:null;return{id:e,localId:t,createdAt:n,role:"event",content:{type:"microcompact",trigger:Ds(o?.trigger)??"auto",preTokens:Zs(o?.preTokens)??0,tokensSaved:Zs(o?.tokensSaved)??0},isSidechain:!1,meta:s}}if(r.type==="system"&&r.subtype==="compact_boundary"){const o=ye(r.compactMetadata)?r.compactMetadata:null;return{id:e,localId:t,createdAt:n,role:"event",content:{type:"compact",trigger:Ds(o?.trigger)??"auto",preTokens:Zs(o?.preTokens)??0},isSidechain:!1,meta:s}}return null}if(i.type==="event"){const r=EH(i.data);return r?{id:e,localId:t,createdAt:n,role:"event",content:r,isSidechain:!1,meta:s}:null}if(i.type==="codex"){const r=ye(i.data)?i.data:null;if(!r||typeof r.type!="string")return null;if(r.type==="message"&&typeof r.message=="string")return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!1,content:[{type:"text",text:r.message,uuid:e,parentUUID:null}],meta:s};if(r.type==="reasoning"&&typeof r.message=="string")return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!1,content:[{type:"reasoning",text:r.message,uuid:e,parentUUID:null}],meta:s};if(r.type==="tool-call"&&typeof r.callId=="string"){const o=Ds(r.id)??e;return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!1,content:[{type:"tool-call",id:r.callId,name:Ds(r.name)??"unknown",input:r.input,description:null,uuid:o,parentUUID:null}],meta:s}}if(r.type==="tool-call-result"&&typeof r.callId=="string"){const o=Ds(r.id)??e;return{id:e,localId:t,createdAt:n,role:"agent",isSidechain:!1,content:[{type:"tool-result",tool_use_id:r.callId,content:r.output,is_error:!1,uuid:o,parentUUID:null}],meta:s}}}return null}function NH(e){if(!Array.isArray(e))return;const t=[];for(const n of e)ye(n)&&typeof n.id=="string"&&typeof n.filename=="string"&&typeof n.mimeType=="string"&&typeof n.size=="number"&&typeof n.path=="string"&&t.push({id:n.id,filename:n.filename,mimeType:n.mimeType,size:n.size,path:n.path,previewUrl:typeof n.previewUrl=="string"?n.previewUrl:void 0});return t.length>0?t:void 0}function IH(e,t,n,i,s){if(typeof i=="string")return{id:e,localId:t,createdAt:n,role:"user",content:{type:"text",text:i},isSidechain:!1,meta:s};if(ye(i)&&i.type==="text"&&typeof i.text=="string"){const r=NH(i.attachments);return{id:e,localId:t,createdAt:n,role:"user",content:{type:"text",text:i.text,attachments:r},isSidechain:!1,meta:s}}return null}function FD(e){const t=ID(e.content);if(!t)return{id:e.id,localId:e.localId,createdAt:e.createdAt,role:"agent",isSidechain:!1,content:[{type:"text",text:Ea(e.content),uuid:e.id,parentUUID:null}],status:e.status,originalText:e.originalText};if(t.role==="user"){const n=IH(e.id,e.localId,e.createdAt,t.content,t.meta);return n?{...n,status:e.status,originalText:e.originalText}:{id:e.id,localId:e.localId,createdAt:e.createdAt,role:"user",isSidechain:!1,content:{type:"text",text:Ea(t.content)},meta:t.meta,status:e.status,originalText:e.originalText}}if(t.role==="agent"){if(AH(t.content))return null;const n=LH(e.id,e.localId,e.createdAt,t.content,t.meta);return!n&&PH(t.content)?null:n?{...n,status:e.status,originalText:e.originalText}:{id:e.id,localId:e.localId,createdAt:e.createdAt,role:"agent",isSidechain:!1,content:[{type:"text",text:Ea(t.content),uuid:e.id,parentUUID:null}],meta:t.meta,status:e.status,originalText:e.originalText}}return{id:e.id,localId:e.localId,createdAt:e.createdAt,role:"agent",isSidechain:!1,content:[{type:"text",text:Ea(t.content),uuid:e.id,parentUUID:null}],meta:t.meta,status:e.status,originalText:e.originalText}}function DH(e){return typeof crypto<"u"&&"randomUUID"in crypto?`${e}-${crypto.randomUUID()}`:`${e}-${Date.now()}-${Math.random()}`}function OH(e){const t=e.content;return t&&typeof t=="object"&&"role"in t?t.role==="user":!1}function vm(e){return!!(e.localId&&e.id===e.localId)}function h0(e,t){const n=typeof e.seq=="number"?e.seq:null,i=typeof t.seq=="number"?t.seq:null;return n!==null&&i!==null&&n!==i?n-i:e.createdAt!==t.createdAt?e.createdAt-t.createdAt:e.id.localeCompare(t.id)}function qu(e,t){if(e.length===0)return[...t].sort(h0);if(t.length===0)return[...e].sort(h0);const n=new Map;for(const c of e)n.set(c.id,c);for(const c of t)n.set(c.id,c);let i=Array.from(n.values());const s=new Set;for(const c of t)c.localId&&!vm(c)&&s.add(c.localId);s.size>0&&(i=i.filter(c=>!c.localId||!s.has(c.localId)?!0:!vm(c)));const r=i.filter(c=>vm(c)),o=i.filter(c=>!vm(c)),a=[...o];for(const c of r)c.status==="sent"&&o.some(h=>OH(h)&&Math.abs(h.createdAt-c.createdAt)<1e4)||a.push(c);return a.sort(h0),a}const f0=400,PA=200,UD=50,zD="New messages arrived while you were away. Scroll to bottom to refresh.",nf=new Map,_h=new Map,Qg=new Map;function jH(e){const t=Qg.get(e);if(t)return t;const n=new Map;return Qg.set(e,n),n}function $D(e){Qg.delete(e)}function BH(e,t){const n=jH(e),i=n.get(t.id);if(i&&i.source===t)return i.visible;const s=FD(t)!==null;return n.set(t.id,{source:t,visible:s}),s}function DC(e,t){let n=0;for(const i of t)BH(e,i)&&(n+=1);return n}function FH(e,t){const n=Qg.get(e);if(!n)return;const i=new Set(t.map(s=>s.id));for(const s of n.keys())i.has(s)||n.delete(s)}function OC(e){return{sessionId:e,messages:[],pending:[],pendingCount:0,pendingVisibleCount:0,pendingOverflowVisibleCount:0,hasMore:!1,oldestSeq:null,newestSeq:null,isLoading:!1,isLoadingMore:!1,warning:null,atBottom:!0,messagesVersion:0,pendingOverflowCount:0}}function Hu(e){const t=nf.get(e);if(t)return t;const n=OC(e);return nf.set(e,n),n}function UH(e){const t=_h.get(e);if(t)for(const n of t)n()}function jC(e,t){nf.set(e,t),UH(e)}function or(e,t){const n=Hu(e),i=t(n);i!==n&&jC(e,i)}function zH(e){let t=null,n=null;for(const i of e)typeof i.seq=="number"&&((t===null||i.seq<t)&&(t=i.seq),(n===null||i.seq>n)&&(n=i.seq));return{oldestSeq:t,newestSeq:n}}function $i(e,t){const n=t.messages??e.messages,i=t.pending??e.pending,s=t.pendingOverflowCount??e.pendingOverflowCount,r=t.pendingOverflowVisibleCount??e.pendingOverflowVisibleCount;let o=t.pendingVisibleCount??e.pendingVisibleCount;const a=i!==e.pending;a&&t.pendingVisibleCount===void 0&&(o=DC(e.sessionId,i)),a&&FH(e.sessionId,i);const c=o+r,{oldestSeq:u,newestSeq:h}=zH(n),f=n===e.messages?e.messagesVersion:e.messagesVersion+1;return{...e,messages:n,pending:i,pendingOverflowCount:s,pendingVisibleCount:o,pendingOverflowVisibleCount:r,pendingCount:c,oldestSeq:u,newestSeq:h,hasMore:t.hasMore!==void 0?t.hasMore:e.hasMore,isLoading:t.isLoading!==void 0?t.isLoading:e.isLoading,isLoadingMore:t.isLoadingMore!==void 0?t.isLoadingMore:e.isLoadingMore,warning:t.warning!==void 0?t.warning:e.warning,atBottom:t.atBottom!==void 0?t.atBottom:e.atBottom,messagesVersion:f}}function If(e,t){return e.length<=f0?e:t==="prepend"?e.slice(0,f0):e.slice(e.length-f0)}function $H(e,t){if(t.length<=PA)return{pending:t,dropped:0,droppedVisible:0};const n=t.length-PA,i=t.slice(0,n),s=t.slice(n),r=DC(e,i);return{pending:s,dropped:i.length,droppedVisible:r}}function BC(e,t){if(e.length===0||t.length===0)return e;const n=new Set(t.map(i=>i.id));return e.filter(i=>!n.has(i.id))}function qH(e){return!!(e.localId&&e.id===e.localId)}function qD(e,t){if(t.length===0)return{pending:e.pending,pendingVisibleCount:e.pendingVisibleCount,pendingOverflowCount:e.pendingOverflowCount,pendingOverflowVisibleCount:e.pendingOverflowVisibleCount,warning:e.warning};const n=qu(e.pending,t),i=BC(n,e.messages),{pending:s,dropped:r,droppedVisible:o}=$H(e.sessionId,i),a=DC(e.sessionId,s),c=e.pendingOverflowCount+r,u=e.pendingOverflowVisibleCount+o,h=o>0&&!e.warning?zD:e.warning;return{pending:s,pendingVisibleCount:a,pendingOverflowCount:c,pendingOverflowVisibleCount:u,warning:h}}function HD(e){return Hu(e)}function HH(e,t){const n=_h.get(e)??new Set;return n.add(t),_h.set(e,n),()=>{const i=_h.get(e);i&&(i.delete(t),i.size===0&&(_h.delete(e),nf.delete(e),$D(e)))}}function FC(e){$D(e),nf.has(e)&&jC(e,OC(e))}function VH(e,t){if(!e||!t||e===t)return;const n=Hu(e),i=OC(t),s=$i(i,{messages:[...n.messages],pending:[...n.pending],pendingOverflowCount:n.pendingOverflowCount,pendingOverflowVisibleCount:n.pendingOverflowVisibleCount,hasMore:n.hasMore,warning:n.warning,atBottom:n.atBottom,isLoading:!1,isLoadingMore:!1});jC(t,s)}async function Nh(e,t){if(!Hu(t).isLoading){or(t,i=>$i(i,{isLoading:!0,warning:null}));try{const i=await e.getMessages(t,{limit:UD,beforeSeq:null});or(t,s=>{if(s.atBottom){const o=qu(s.messages,[...s.pending,...i.messages]),a=If(o,"append");return $i(s,{messages:a,pending:[],pendingOverflowCount:0,pendingVisibleCount:0,pendingOverflowVisibleCount:0,hasMore:i.page.hasMore,isLoading:!1,warning:null})}const r=qD(s,i.messages);return $i(s,{pending:r.pending,pendingVisibleCount:r.pendingVisibleCount,pendingOverflowCount:r.pendingOverflowCount,pendingOverflowVisibleCount:r.pendingOverflowVisibleCount,isLoading:!1,warning:r.warning})})}catch(i){const s=i instanceof Error?i.message:"Failed to load messages";or(t,r=>$i(r,{isLoading:!1,warning:s}))}}}async function WH(e,t){const n=Hu(t);if(!(n.isLoadingMore||!n.hasMore)&&n.oldestSeq!==null){or(t,i=>$i(i,{isLoadingMore:!0}));try{const i=await e.getMessages(t,{limit:UD,beforeSeq:n.oldestSeq});or(t,s=>{const r=qu(i.messages,s.messages),o=If(r,"prepend");return $i(s,{messages:o,hasMore:i.page.hasMore,isLoadingMore:!1})})}catch(i){const s=i instanceof Error?i.message:"Failed to load messages";or(t,r=>$i(r,{isLoadingMore:!1,warning:s}))}}}function GH(e,t){t.length!==0&&or(e,n=>{if(n.atBottom){const s=qu(n.messages,t),r=If(s,"append"),o=BC(n.pending,r);return $i(n,{messages:r,pending:o})}const i=qD(n,t);return $i(n,{pending:i.pending,pendingVisibleCount:i.pendingVisibleCount,pendingOverflowCount:i.pendingOverflowCount,pendingOverflowVisibleCount:i.pendingOverflowVisibleCount,warning:i.warning})})}function KH(e){const t=Hu(e);if(t.pending.length===0&&t.pendingOverflowVisibleCount===0)return!1;const n=t.pendingOverflowVisibleCount>0;return or(e,i=>{const s=qu(i.messages,i.pending),r=If(s,"append");return $i(i,{messages:r,pending:[],pendingOverflowCount:0,pendingVisibleCount:0,pendingOverflowVisibleCount:0,warning:n?i.warning??zD:i.warning})}),n}function YH(e,t){or(e,n=>n.atBottom===t?n:$i(n,{atBottom:t}))}function XH(e,t){or(e,n=>{const i=qu(n.messages,[t]),s=If(i,"append"),r=BC(n.pending,s);return $i(n,{messages:s,pending:r,atBottom:!0})})}function p0(e,t,n){t&&or(e,i=>{let s=!1;const r=c=>c.map(u=>u.localId!==t||!qH(u)||u.status===n?u:(s=!0,{...u,status:n})),o=r(i.messages),a=r(i.pending);return s?$i(i,{messages:o,pending:a}):i})}function QH(){return typeof document>"u"?"hidden":document.visibilityState==="visible"?"visible":"hidden"}function JH(e,t,n,i){const s=new URLSearchParams;s.set("token",t),s.set("visibility",i),n.all&&s.set("all","true"),n.sessionId&&s.set("sessionId",n.sessionId),n.machineId&&s.set("machineId",n.machineId);const r=`/api/events?${s.toString()}`;try{return new URL(r,e).toString()}catch{return r}}function ZH(e){const t=jo(),n=k.useRef(e.onEvent),i=k.useRef(e.onConnect),s=k.useRef(e.onDisconnect),r=k.useRef(e.onError),o=k.useRef(e.onToast),a=k.useRef(null),[c,u]=k.useState(null);k.useEffect(()=>{n.current=e.onEvent},[e.onEvent]),k.useEffect(()=>{r.current=e.onError},[e.onError]),k.useEffect(()=>{i.current=e.onConnect},[e.onConnect]),k.useEffect(()=>{s.current=e.onDisconnect},[e.onDisconnect]),k.useEffect(()=>{o.current=e.onToast},[e.onToast]);const h=e.subscription??{},f=k.useMemo(()=>`${h.all?"1":"0"}|${h.sessionId??""}|${h.machineId??""}`,[h.all,h.sessionId,h.machineId]);return k.useEffect(()=>{if(!e.enabled){a.current?.close(),a.current=null,u(null);return}u(null);const m=JH(e.baseUrl,e.token,{...h,sessionId:h.sessionId??void 0},QH()),y=new EventSource(m);a.current=y;const b=_=>{if(_.type==="connection-changed"){const w=_.data;if(w&&typeof w=="object"&&"subscriptionId"in w){const M=w.subscriptionId;typeof M=="string"&&M.length>0&&u(M)}}if(_.type==="toast"){o.current?.(_);return}_.type==="message-received"&&GH(_.sessionId,[_.message]),(_.type==="session-added"||_.type==="session-updated"||_.type==="session-removed")&&(t.invalidateQueries({queryKey:Xt.sessions}),"sessionId"in _&&(_.type==="session-removed"?(t.removeQueries({queryKey:Xt.session(_.sessionId)}),FC(_.sessionId)):t.invalidateQueries({queryKey:Xt.session(_.sessionId)}))),_.type==="machine-updated"&&t.invalidateQueries({queryKey:Xt.machines}),n.current(_)},S=_=>{if(typeof _.data!="string")return;let w;try{w=JSON.parse(_.data)}catch{return}ye(w)&&typeof w.type=="string"&&b(w)};return y.onmessage=S,y.onopen=()=>{i.current?.()},y.onerror=_=>{r.current?.(_);const w=y.readyState===EventSource.CLOSED?"closed":"error";s.current?.(w)},()=>{y.close(),a.current===y&&(a.current=null),u(null)}},[e.baseUrl,e.enabled,e.token,f,t]),{subscriptionId:c}}let m0=null;const e7=1e4,t7=3e4,n7=300;function i7(){const[e,t]=k.useState(!1),n=k.useRef(null),i=k.useRef(null);k.useEffect(()=>{const c=()=>{document.visibilityState==="hidden"&&(m0=Date.now())};return document.addEventListener("visibilitychange",c),()=>document.removeEventListener("visibilitychange",c)},[]);const s=k.useCallback(()=>{n.current&&(clearTimeout(n.current),n.current=null),i.current&&(clearTimeout(i.current),i.current=null)},[]),r=k.useCallback(()=>{s(),n.current=setTimeout(()=>{t(!0),i.current=setTimeout(()=>{t(!1)},e7)},n7)},[s]),o=k.useCallback(c=>{if(c?.force){r();return}m0&&Date.now()-m0<t7&&r()},[r]),a=k.useCallback(()=>{s(),t(!1)},[s]);return k.useEffect(()=>()=>{s()},[s]),{isSyncing:e,startSync:o,endSync:a}}function ym(){return typeof window<"u"&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window}function s7(e){const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/-/g,"+").replace(/_/g,"/"),i=atob(n),s=new Uint8Array(i.length);for(let r=0;r<i.length;r+=1)s[r]=i.charCodeAt(r);return s}function r7(e){const[t,n]=k.useState(!1),[i,s]=k.useState("default"),[r,o]=k.useState(!1),a=k.useCallback(async()=>{if(!ym()){n(!1),o(!1);return}if(n(!0),s(Notification.permission),Notification.permission!=="granted"){o(!1);return}const m=await(await navigator.serviceWorker.ready).pushManager.getSubscription();o(!!m)},[]);k.useEffect(()=>{a()},[a]);const c=k.useCallback(async()=>{if(!ym())return!1;const f=await Notification.requestPermission();return s(f),f!=="granted"&&o(!1),f==="granted"},[]),u=k.useCallback(async()=>{if(!e||!ym())return!1;if(Notification.permission!=="granted")return s(Notification.permission),!1;try{const f=await navigator.serviceWorker.ready,m=await f.pushManager.getSubscription(),{publicKey:y}=await e.getPushVapidPublicKey(),b=s7(y).buffer,_=(m??await f.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:b})).toJSON(),w=_.keys;return!_.endpoint||!w?.p256dh||!w.auth?!1:(await e.subscribePushNotifications({endpoint:_.endpoint,keys:{p256dh:w.p256dh,auth:w.auth}}),o(!0),!0)}catch(f){return console.error("[PushNotifications] Failed to subscribe:",f),!1}},[e]),h=k.useCallback(async()=>{if(!e||!ym())return!1;try{const m=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(!m)return o(!1),!0;const y=m.endpoint,b=await m.unsubscribe();return await e.unsubscribePushNotifications({endpoint:y}),o(!1),b}catch(f){return console.error("[PushNotifications] Failed to unsubscribe:",f),!1}},[e]);return{isSupported:t,permission:i,isSubscribed:r,requestPermission:c,subscribe:u,unsubscribe:h}}function o7(){return typeof document>"u"?"hidden":document.visibilityState==="visible"?"visible":"hidden"}function a7(e){const t=k.useRef(null),n=k.useRef(null),i=k.useRef(null),s=k.useRef(!1),r=k.useRef(null),o=()=>{r.current&&(clearTimeout(r.current),r.current=null)};k.useEffect(()=>{if(e.enabled===!1){o();return}if(!e.api||!e.subscriptionId){t.current=null,n.current=e.subscriptionId??null,i.current=null,o();return}const a=e.api,c=e.subscriptionId;n.current!==c&&(n.current=c,t.current=null,i.current=null,o());const u=()=>{if(n.current!==c)return;const f=i.current;if(!f||s.current||r.current)return;if(t.current===f){i.current=null;return}s.current=!0;let m=!1;const y=c;a.setVisibility({subscriptionId:c,visibility:f}).then(()=>{n.current===y&&(t.current=f,i.current=null,o())}).catch(b=>{n.current===y&&(m=!0,console.error("Failed to update visibility:",b),r.current||(r.current=setTimeout(()=>{r.current=null,u()},2e3)))}).finally(()=>{s.current=!1,!(m||r.current)&&i.current&&i.current!==t.current&&u()})},h=()=>{const f=o7();i.current=f,u()};return h(),document.addEventListener("visibilitychange",h),()=>{document.removeEventListener("visibilitychange",h),o(),s.current=!1}},[e.api,e.enabled,e.subscriptionId])}const VD=k.createContext(null);function l7(e){return g.jsx(VD.Provider,{value:e.value,children:e.children})}function Vu(){const e=k.useContext(VD);if(!e)throw new Error("AppContext is not available");return e}function Jl(){const e=fr(),t=ai(),n=ef({select:s=>s.pathname}),i=ef({select:s=>s.search});return k.useCallback(()=>{if(n==="/sessions/new"){e({to:"/sessions"});return}if(n==="/settings"){e({to:"/sessions"});return}if(n.match(/^\/sessions\/[^/]+\/file$/)){const s=n.replace(/\/file$/,"/files"),o=(i&&typeof i=="object"&&"tab"in i?i.tab:void 0)==="directories"?{tab:"directories"}:{};e({to:s,search:o});return}if(n.startsWith("/sessions/")){const s=n.replace(/\/[^/]+$/,"")||"/sessions";e({to:s});return}t.history.back()},[e,n,t,i])}const c7={loading:"Loading",authorizing:"Authorizing","loading.session":"Loading session","loading.git":"Loading Git status","loading.files":"Loading files","loading.messages":"Loading messages","loading.machines":"Loading machines","login.title":"HAPI","login.subtitle":"Vibe Coding Anytime, Anywhere","login.bind.title":"Bind Telegram","login.submit":"Sign In","login.bind.submit":"Bind","login.submitting":"Signing in","login.bind.submitting":"Binding","login.placeholder":"Access token","login.error.enterToken":"Please enter an access token","login.error.bindingUnavailable":"Binding is unavailable.","login.error.loginUnavailable":"Login is unavailable.","login.error.bindFailed":"Binding failed","login.error.authFailed":"Authentication failed","login.help":"Needs help?","login.server.default":"(Default)","login.server.custom":"(Custom)","login.server.title":"Hub URL","login.server.description":"Set hapi hub origin for API and live updates.","login.server.current":"Current:","login.server.origin":"Hub origin","login.server.placeholder":"https://hapi.example.com","login.server.hint":"Use http(s) only. Any path is ignored.","login.server.required":"Hub URL required. Please set it before signing in.","login.server.useSameOrigin":"Use same origin","login.server.save":"Save hub","login.footer":"Designed with","login.footer.for":"for Vibe Coding","login.footer.copyright":"","sessions.count":"{n} sessions in {m} projects","sessions.new":"New Session","session.item.path":"path","session.item.agent":"agent","session.item.model":"model","session.item.modelMode":"mode","session.item.worktree":"worktree","session.item.pending":"pending","session.item.thinking":"thinking","session.time.justNow":"just now","session.time.minutesAgo":"{n}m ago","session.time.hoursAgo":"{n}h ago","session.time.daysAgo":"{n}d ago","session.title":"Files","session.more":"More actions","session.action.rename":"Rename","session.action.archive":"Archive","session.action.delete":"Delete","session.action.copy":"Copy","dialog.rename.title":"Rename Session","dialog.rename.placeholder":"Session name","dialog.rename.save":"Save","dialog.rename.saving":"Saving","dialog.rename.error":"Failed to rename. Please try again.","dialog.archive.title":"Archive Session","dialog.archive.description":'Are you sure you want to archive "{name}"? This will disconnect active session.',"dialog.archive.confirm":"Archive","dialog.archive.confirming":"Archiving","dialog.delete.title":"Delete Session","dialog.delete.description":'Are you sure you want to delete "{name}"? This action cannot be undone.',"dialog.delete.confirm":"Delete","dialog.delete.confirming":"Deleting","dialog.error.default":"Operation failed. Please try again.","button.cancel":"Cancel","button.save":"Save","button.confirm":"Confirm","button.close":"Close","button.dismiss":"Dismiss","button.copy":"Copy","button.paste":"Paste","newSession.machine":"Machine","newSession.directory":"Directory","newSession.placeholder":"/path/to/project","newSession.recent":"Recent paths","newSession.type":"Session type","newSession.type.simple":"Simple","newSession.type.simple.desc":"Use selected directory as-is","newSession.type.worktree":"Worktree","newSession.type.worktree.desc":"Create a new worktree next to repo","newSession.type.worktree.placeholder":"feature-x (default 1228-xxxx)","newSession.agent":"Agent","newSession.model":"Model","newSession.model.optional":"optional","newSession.yolo":"YOLO mode","newSession.yolo.title":"Bypass approvals and sandbox","newSession.yolo.desc":"Uses dangerous agent flags when spawning.","newSession.create":"Create","newSession.creating":"Creating","spawn.title":"Create Session","spawn.sessionType":"Session type","spawn.useAsIs":"Use selected directory as-is","spawn.createWorktree":"Create a new worktree next to repo","spawn.worktreePlaceholder":"feature-x (default 1228-xxxx)","spawn.cancel":"Cancel","spawn.create":"Create Session","spawn.creating":"Creating","machine.unknown":"Unknown platform","chat.placeholder":"Type a message","chat.send":"Send","chat.abort":"Abort","chat.settings":"Settings","chat.terminal":"Terminal","chat.switchRemote":"Switch to remote mode","terminal.commandName":"Command","terminal.commandMessage":"Command message","terminal.commandArgs":"Command args","terminal.stdout":"Stdout","terminal.stderr":"Stderr","terminal.paste.fallbackTitle":"Paste input","terminal.paste.fallbackDescription":"Clipboard read is unavailable. Paste your text below.","terminal.paste.placeholder":"Paste terminal input here","code.copy":"Copy","diff.title":"Diff","diff.view":"View","tool.askQuestion":"Other","tool.edit":"Edit","tool.multiedit":"Multi-edit","tool.write":"Write","tool.todo":"Todo","tool.confirm":"Confirm","tool.deny":"Deny","tool.abort":"Abort","tool.allow":"Allow","tool.allowAll":"Allow all edits","tool.denyAll":"Deny all edits","tool.approved":"Approved","tool.rejected":"Rejected","tool.cancel":"Cancel","tool.exitPlan":"Exit Plan Mode","tool.patch":"Patch","tool.input":"Input","tool.result":"Result","tool.questionsAnswers":"Questions & Answers","tool.submit":"Submit","tool.submitting":"Submitting","tool.prev":" Prev","tool.next":"Next ","tool.yes":"Yes","tool.yesForSession":"Yes for session","tool.allowForSession":"Allow for session","tool.abortLabel":"Abort","tool.other":"Other","tool.otherDescription":"Type your own answer","tool.question":"Question","tool.selectOption":"Please select at least one option or type an answer.","tool.waitingForApproval":"Waiting for approval","tool.canceled":"Canceled","tool.approvedForSession":"Approved for session","tool.aborted":"Aborted","tool.approvedAllowAllEdits":"Approved: Allow all edits","tool.requestFailed":"Request failed","tool.askUserQuestion.fallback":"AskUserQuestion payload is not in the expected format. Type your answer:","tool.askUserQuestion.placeholder":"Type your answer","tool.askUserQuestion.otherPlaceholder":"Or type your own answer","tool.requestUserInput.textPlaceholder":"Type your answer","tool.requestUserInput.noteLabel":"Additional note (optional)","tool.requestUserInput.notePlaceholder":"Add a note","composer.settings":"Settings","composer.terminal":"Terminal","composer.abort":"Abort","composer.switchRemote":"Switch to remote mode","composer.attach":"Attach file","composer.send":"Send","composer.stop":"Stop","composer.voice":"Voice assistant","voice.connecting":"Connecting...","voice.active":"Active","voice.muted":"Muted","voice.error":"Error","voice.mute":"Mute","voice.unmute":"Unmute","voice.end":"End","voice.error.micPermission":"Microphone permission denied","voice.error.network":"Network error","voice.error.notInitialized":"Voice session not initialized","voice.error.startFailed":"Failed to start voice session","voice.error.notAllowed":"Voice not allowed","voice.error.connection":"Connection error","voice.dismiss":"Dismiss","offline.title":"Offline","offline.message":"You are currently offline. Some features may be limited.","syncing.title":"Syncing","syncing.message":"Your data is being synchronized.","reconnecting.message":"Reconnecting...","send.blocked.title":"Cannot send message","send.blocked.noConnection":"Not connected to server","install.title":"Install HAPI","install.description":"Add HAPI to your home screen for quick access.","install.button":"Install","language.title":"Language","language.english":"English","language.chinese":"","settings.title":"Settings","settings.language.title":"Language","settings.language.label":"Language","settings.display.title":"Display","settings.display.fontSize":"Font Size","settings.voice.title":"Voice Assistant","settings.voice.language":"Voice Language","settings.voice.autoDetect":"Auto-detect","settings.about.title":"About","settings.about.website":"Website","settings.about.appVersion":"App Version","settings.about.protocolVersion":"Protocol Version","misc.noMachines":"No machines available","misc.machine":"Machine","misc.permissionMode":"Permission Mode","misc.model":"Model","misc.loading":"Loading","misc.loadOlder":"Load older","misc.newMessage":"{n} new message{s}","misc.loadingMessages":"Loading messages","misc.typeMessage":"Type 'continue' to resume...","misc.typeAMessage":"Type a message...","misc.offline":"offline","misc.permissionRequired":"permission required","misc.percentLeft":"{percent}% left","misc.online":"online"},u7={loading:"",authorizing:"","loading.session":"","loading.git":" Git ","loading.files":"","loading.messages":"","loading.machines":"","login.title":"HAPI","login.subtitle":"Vibe Coding","login.bind.title":" Telegram","login.submit":"","login.bind.submit":"","login.submitting":"","login.bind.submitting":"","login.placeholder":"","login.error.enterToken":"","login.error.bindingUnavailable":"","login.error.loginUnavailable":"","login.error.bindFailed":"","login.error.authFailed":"","login.help":"","login.server.default":"()","login.server.custom":"()","login.server.title":"","login.server.description":" HAPI  API ","login.server.current":"","login.server.origin":"","login.server.placeholder":"https://hapi.example.com","login.server.hint":" http(s) ","login.server.required":"","login.server.useSameOrigin":"","login.server.save":"","login.footer":"","login.footer.for":"Vibe Coding","login.footer.copyright":"","sessions.count":"{n} {m} ","sessions.new":"","session.item.path":"","session.item.agent":"","session.item.model":"","session.item.modelMode":"","session.item.worktree":"","session.item.pending":"","session.item.thinking":"","session.time.justNow":"","session.time.minutesAgo":"{n} ","session.time.hoursAgo":"{n} ","session.time.daysAgo":"{n} ","session.title":"","session.more":"","session.action.rename":"","session.action.archive":"","session.action.delete":"","session.action.copy":"","dialog.rename.title":"","dialog.rename.placeholder":"","dialog.rename.save":"","dialog.rename.saving":"","dialog.rename.error":"","dialog.archive.title":"","dialog.archive.description":' "{name}" ',"dialog.archive.confirm":"","dialog.archive.confirming":"","dialog.delete.title":"","dialog.delete.description":' "{name}" ',"dialog.delete.confirm":"","dialog.delete.confirming":"","dialog.error.default":"","button.cancel":"","button.save":"","button.confirm":"","button.close":"","button.dismiss":"","button.copy":"","button.paste":"","newSession.machine":"","newSession.directory":"","newSession.placeholder":"/path/to/project","newSession.recent":"","newSession.type":"","newSession.type.simple":"","newSession.type.simple.desc":"","newSession.type.worktree":"","newSession.type.worktree.desc":"","newSession.type.worktree.placeholder":"feature-x ( 1228-xxxx)","newSession.agent":"","newSession.model":"","newSession.model.optional":"","newSession.yolo":"YOLO ","newSession.yolo.title":"","newSession.yolo.desc":"","newSession.create":"","newSession.creating":"","spawn.title":"","spawn.sessionType":"","spawn.useAsIs":"","spawn.createWorktree":"","spawn.worktreePlaceholder":"feature-x ( 1228-xxxx)","spawn.cancel":"","spawn.create":"","spawn.creating":"","machine.unknown":"","chat.placeholder":"","chat.send":"","chat.abort":"","chat.settings":"","chat.terminal":"","chat.switchRemote":"","terminal.commandName":"","terminal.commandMessage":"","terminal.commandArgs":"","terminal.stdout":"","terminal.stderr":"","terminal.paste.fallbackTitle":"","terminal.paste.fallbackDescription":"","terminal.paste.placeholder":"","code.copy":"","diff.title":"","diff.view":"","tool.askQuestion":"","tool.edit":"","tool.multiedit":"","tool.write":"","tool.todo":"","tool.confirm":"","tool.deny":"","tool.abort":"","tool.allow":"","tool.allowAll":"","tool.denyAll":"","tool.approved":"","tool.rejected":"","tool.cancel":"","tool.exitPlan":"","tool.patch":"","tool.input":"","tool.result":"","tool.questionsAnswers":"","tool.submit":"","tool.submitting":"","tool.prev":" ","tool.next":" ","tool.yes":"","tool.yesForSession":"","tool.allowForSession":"","tool.abortLabel":"","tool.other":"","tool.otherDescription":"","tool.question":"","tool.selectOption":"","tool.waitingForApproval":"","tool.canceled":"","tool.approvedForSession":"","tool.aborted":"","tool.approvedAllowAllEdits":"","tool.requestFailed":"","tool.askUserQuestion.fallback":"AskUserQuestion ","tool.askUserQuestion.placeholder":"","tool.askUserQuestion.otherPlaceholder":"","tool.requestUserInput.textPlaceholder":"","tool.requestUserInput.noteLabel":"","tool.requestUserInput.notePlaceholder":"","composer.settings":"","composer.terminal":"","composer.abort":"","composer.switchRemote":"","composer.attach":"","composer.send":"","composer.stop":"","composer.voice":"","voice.connecting":"...","voice.active":"","voice.muted":"","voice.error":"","voice.mute":"","voice.unmute":"","voice.end":"","voice.error.micPermission":"","voice.error.network":"","voice.error.notInitialized":"","voice.error.startFailed":"","voice.error.notAllowed":"","voice.error.connection":"","voice.dismiss":"","offline.title":"","offline.message":"","syncing.title":"","syncing.message":"","reconnecting.message":"...","send.blocked.title":"","send.blocked.noConnection":"","install.title":" HAPI","install.description":" HAPI ","install.button":"","language.title":"","language.english":"English","language.chinese":"","settings.title":"","settings.language.title":"","settings.language.label":"","settings.display.title":"","settings.display.fontSize":"","settings.voice.title":"","settings.voice.language":"","settings.voice.autoDetect":"","settings.about.title":"","settings.about.website":"","settings.about.appVersion":"","settings.about.protocolVersion":"","misc.noMachines":"","misc.machine":"","misc.permissionMode":"","misc.model":"","misc.loading":"","misc.loadOlder":"","misc.newMessage":"{n} ","misc.loadingMessages":"","misc.typeMessage":" 'continue' ...","misc.typeAMessage":"...","misc.offline":"","misc.permissionRequired":"","misc.percentLeft":" {percent}%","misc.online":""},WD=k.createContext(null),g0={en:c7,"zh-CN":u7};function d7(e,t){return t?e.replace(/\{(\w+)\}/g,(n,i)=>{const s=t[i];return s!==void 0?String(s):n}):e}function h7({children:e}){const[t,n]=k.useState(()=>{const r=localStorage.getItem("hapi-lang");return r==="en"||r==="zh-CN"?r:"en"}),i=k.useCallback(r=>{n(r),localStorage.setItem("hapi-lang",r),document.documentElement.lang=r},[]),s=k.useCallback((r,o)=>{const c=(g0[t]??g0.en)[r],u=g0.en[r]??r;return d7(c??u,o)},[t]);return k.useEffect(()=>{document.documentElement.lang=t},[t]),g.jsx(WD.Provider,{value:{t:s,locale:t,setLocale:i},children:e})}function rt(){const e=k.useContext(WD);if(!e)throw new Error("useTranslation must be used within I18nProvider");return e}let ql=null,sf=!1,rf=null;async function f7(e,t,n){if(!ql){console.warn("[Voice] No voice session registered");return}try{rf=e,await ql.startSession({sessionId:e,initialContext:t,language:n}),sf=!0}catch(i){console.error("[Voice] Failed to start realtime session:",i),rf=null,sf=!1}}async function p7(){if(ql)try{await ql.endSession(),rf=null,sf=!1}catch(e){console.error("[Voice] Failed to stop realtime session:",e)}}function m7(){rf=null,sf=!1}function g7(e){ql&&console.warn("[Voice] Voice session already registered, replacing with new one"),ql=e}function GD(){return sf}function KD(){return ql}function LA(){return rf}let _l=null;function YD(e){_l=e}const v7={messageCodingAgent:async e=>{const t=e;if(!t.message||typeof t.message!="string"||t.message.trim()==="")return console.error("[Voice] Invalid message parameter:",e),"error (invalid message parameter)";const n=t.message.trim(),i=LA();return i?_l?(_l.sendMessage(i,n),"sent [DO NOT say anything else, simply say 'sent']"):(console.error("[Voice] Session store not registered"),"error (session store not available)"):(console.error("[Voice] No active session"),"error (no active session)")},processPermissionRequest:async e=>{const t=e;if(!t.decision||t.decision!=="allow"&&t.decision!=="deny")return console.error("[Voice] Invalid decision parameter:",e),"error (invalid decision parameter, expected 'allow' or 'deny')";const n=t.decision,i=LA();if(!i)return console.error("[Voice] No active session"),"error (no active session)";if(!_l)return console.error("[Voice] Session store not registered"),"error (session store not available)";const r=_l.getSession(i)?.agentState?.requests;if(!r||Object.keys(r).length===0)return console.error("[Voice] No active permission request"),"error (no active permission request)";const o=Object.keys(r)[0];try{return n==="allow"?await _l.approvePermission(i,o):await _l.denyPermission(i,o),"done [DO NOT say anything else, simply say 'done']"}catch(a){return console.error("[Voice] Failed to process permission:",a),`error (failed to ${n} permission)`}}};var NA={};function y7(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var b7=Object.defineProperty,_7=(e,t,n)=>t in e?b7(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,IA=(e,t,n)=>_7(e,typeof t!="symbol"?t+"":t,n);let Ei=class{constructor(){IA(this,"_locking"),IA(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let t;const n=new Promise(s=>t=()=>{this._locks-=1,s()}),i=this._locking.then(()=>t);return this._locking=this._locking.then(()=>n),i}};function cn(e,t){if(!e)throw new Error(t)}const S7=34028234663852886e22,x7=-34028234663852886e22,w7=4294967295,C7=2147483647,k7=-2147483648;function rg(e){if(typeof e!="number")throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>C7||e<k7)throw new Error("invalid int 32: "+e)}function mx(e){if(typeof e!="number")throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>w7||e<0)throw new Error("invalid uint 32: "+e)}function XD(e){if(typeof e!="number")throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>S7||e<x7))throw new Error("invalid float 32: "+e)}const QD=Symbol("@bufbuild/protobuf/enum-type");function T7(e){const t=e[QD];return cn(t,"missing enum type on enum object"),t}function JD(e,t,n,i){e[QD]=ZD(t,n.map(s=>({no:s.no,name:s.name,localName:e[s.no]})))}function ZD(e,t,n){const i=Object.create(null),s=Object.create(null),r=[];for(const o of t){const a=eO(o);r.push(a),i[o.name]=a,s[o.no]=a}return{typeName:e,values:r,findName(o){return i[o]},findNumber(o){return s[o]}}}function E7(e,t,n){const i={};for(const s of t){const r=eO(s);i[r.localName]=r.no,i[r.no]=r.localName}return JD(i,e,t),i}function eO(e){return"localName"in e?e:Object.assign(Object.assign({},e),{localName:e.name})}class UC{equals(t){return this.getType().runtime.util.equals(this.getType(),this,t)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(t,n){const i=this.getType(),s=i.runtime.bin,r=s.makeReadOptions(n);return s.readMessage(this,r.readerFactory(t),t.byteLength,r),this}fromJson(t,n){const i=this.getType(),s=i.runtime.json,r=s.makeReadOptions(n);return s.readMessage(i,t,r,this),this}fromJsonString(t,n){let i;try{i=JSON.parse(t)}catch(s){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(s instanceof Error?s.message:String(s)))}return this.fromJson(i,n)}toBinary(t){const n=this.getType(),i=n.runtime.bin,s=i.makeWriteOptions(t),r=s.writerFactory();return i.writeMessage(this,r,s),r.finish()}toJson(t){const n=this.getType(),i=n.runtime.json,s=i.makeWriteOptions(t);return i.writeMessage(this,s)}toJsonString(t){var n;const i=this.toJson(t);return JSON.stringify(i,null,(n=t?.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function R7(e,t,n,i){var s;const r=(s=i?.localName)!==null&&s!==void 0?s:t.substring(t.lastIndexOf(".")+1),o={[r]:function(a){e.util.initFields(this),e.util.initPartial(a,this)}}[r];return Object.setPrototypeOf(o.prototype,new UC),Object.assign(o,{runtime:e,typeName:t,fields:e.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return e.util.equals(o,a,c)}}),o}function M7(){let e=0,t=0;for(let i=0;i<28;i+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<i,(s&128)==0)return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(n&15)<<28,t=(n&112)>>4,(n&128)==0)return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let s=this.buf[this.pos++];if(t|=(s&127)<<i,(s&128)==0)return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function v0(e,t,n){for(let r=0;r<28;r=r+7){const o=e>>>r,a=!(!(o>>>7)&&t==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const i=e>>>28&15|(t&7)<<4,s=t>>3!=0;if(n.push((s?i|128:i)&255),!!s){for(let r=3;r<31;r=r+7){const o=t>>>r,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(t>>>31&1)}}const og=4294967296;function DA(e){const t=e[0]==="-";t&&(e=e.slice(1));const n=1e6;let i=0,s=0;function r(o,a){const c=Number(e.slice(o,a));s*=n,i=i*n+c,i>=og&&(s=s+(i/og|0),i=i%og)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),t?nO(i,s):zC(i,s)}function A7(e,t){let n=zC(e,t);const i=n.hi&2147483648;i&&(n=nO(n.lo,n.hi));const s=tO(n.lo,n.hi);return i?"-"+s:s}function tO(e,t){if({lo:e,hi:t}=P7(e,t),t<=2097151)return String(og*t+e);const n=e&16777215,i=(e>>>24|t<<8)&16777215,s=t>>16&65535;let r=n+i*6777216+s*6710656,o=i+s*8147497,a=s*2;const c=1e7;return r>=c&&(o+=Math.floor(r/c),r%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+OA(o)+OA(r)}function P7(e,t){return{lo:e>>>0,hi:t>>>0}}function zC(e,t){return{lo:e|0,hi:t|0}}function nO(e,t){return t=~t,e?e=~e+1:t+=1,zC(e,t)}const OA=e=>{const t=String(e);return"0000000".slice(t.length)+t};function jA(e,t){if(e>=0){for(;e>127;)t.push(e&127|128),e=e>>>7;t.push(e)}else{for(let n=0;n<9;n++)t.push(e&127|128),e=e>>7;t.push(1)}}function L7(){let e=this.buf[this.pos++],t=e&127;if((e&128)==0)return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<7,(e&128)==0)return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<14,(e&128)==0)return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(e&127)<<21,(e&128)==0)return this.assertBounds(),t;e=this.buf[this.pos++],t|=(e&15)<<28;for(let n=5;(e&128)!==0&&n<10;n++)e=this.buf[this.pos++];if((e&128)!=0)throw new Error("invalid varint");return this.assertBounds(),t>>>0}function N7(){const e=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof e.getBigInt64=="function"&&typeof e.getBigUint64=="function"&&typeof e.setBigInt64=="function"&&typeof e.setBigUint64=="function"&&(typeof process!="object"||typeof NA!="object"||NA.BUF_BIGINT_DISABLE!=="1")){const s=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const u=typeof c=="bigint"?c:BigInt(c);if(u>r||u<s)throw new Error("int64 invalid: ".concat(c));return u},uParse(c){const u=typeof c=="bigint"?c:BigInt(c);if(u>a||u<o)throw new Error("uint64 invalid: ".concat(c));return u},enc(c){return e.setBigInt64(0,this.parse(c),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(c){return e.setBigInt64(0,this.uParse(c),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec(c,u){return e.setInt32(0,c,!0),e.setInt32(4,u,!0),e.getBigInt64(0,!0)},uDec(c,u){return e.setInt32(0,c,!0),e.setInt32(4,u,!0),e.getBigUint64(0,!0)}}}const n=s=>cn(/^-?[0-9]+$/.test(s),"int64 invalid: ".concat(s)),i=s=>cn(/^[0-9]+$/.test(s),"uint64 invalid: ".concat(s));return{zero:"0",supported:!1,parse(s){return typeof s!="string"&&(s=s.toString()),n(s),s},uParse(s){return typeof s!="string"&&(s=s.toString()),i(s),s},enc(s){return typeof s!="string"&&(s=s.toString()),n(s),DA(s)},uEnc(s){return typeof s!="string"&&(s=s.toString()),i(s),DA(s)},dec(s,r){return A7(s,r)},uDec(s,r){return tO(s,r)}}}const Jt=N7();var me;(function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"})(me||(me={}));var Fa;(function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING"})(Fa||(Fa={}));function ha(e,t,n){if(t===n)return!0;if(e==me.BYTES){if(!(t instanceof Uint8Array)||!(n instanceof Uint8Array)||t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}switch(e){case me.UINT64:case me.FIXED64:case me.INT64:case me.SFIXED64:case me.SINT64:return t==n}return!1}function Lu(e,t){switch(e){case me.BOOL:return!1;case me.UINT64:case me.FIXED64:case me.INT64:case me.SFIXED64:case me.SINT64:return t==0?Jt.zero:"0";case me.DOUBLE:case me.FLOAT:return 0;case me.BYTES:return new Uint8Array(0);case me.STRING:return"";default:return 0}}function iO(e,t){switch(e){case me.BOOL:return t===!1;case me.STRING:return t==="";case me.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var bn;(function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"})(bn||(bn={}));class I7{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let s=0;s<this.chunks.length;s++)t+=this.chunks[s].length;let n=new Uint8Array(t),i=0;for(let s=0;s<this.chunks.length;s++)n.set(this.chunks[s],i),i+=this.chunks[s].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,n){return this.uint32((t<<3|n)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(mx(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return rg(t),jA(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let n=this.textEncoder.encode(t);return this.uint32(n.byteLength),this.raw(n)}float(t){XD(t);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,t,!0),this.raw(n)}double(t){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,t,!0),this.raw(n)}fixed32(t){mx(t);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t,!0),this.raw(n)}sfixed32(t){rg(t);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,t,!0),this.raw(n)}sint32(t){return rg(t),t=(t<<1^t>>31)>>>0,jA(t,this.buf),this}sfixed64(t){let n=new Uint8Array(8),i=new DataView(n.buffer),s=Jt.enc(t);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(n)}fixed64(t){let n=new Uint8Array(8),i=new DataView(n.buffer),s=Jt.uEnc(t);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(n)}int64(t){let n=Jt.enc(t);return v0(n.lo,n.hi,this.buf),this}sint64(t){let n=Jt.enc(t),i=n.hi>>31,s=n.lo<<1^i,r=(n.hi<<1|n.lo>>>31)^i;return v0(s,r,this.buf),this}uint64(t){let n=Jt.uEnc(t);return v0(n.lo,n.hi,this.buf),this}}class D7{constructor(t,n){this.varint64=M7,this.uint32=L7,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=n??new TextDecoder}tag(){let t=this.uint32(),n=t>>>3,i=t&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(t,n){let i=this.pos;switch(t){case bn.Varint:for(;this.buf[this.pos++]&128;);break;case bn.Bit64:this.pos+=4;case bn.Bit32:this.pos+=4;break;case bn.LengthDelimited:let s=this.uint32();this.pos+=s;break;case bn.StartGroup:for(;;){const[r,o]=this.tag();if(o===bn.EndGroup){if(n!==void 0&&r!==n)throw new Error("invalid end group tag");break}this.skip(o,r)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return Jt.dec(...this.varint64())}uint64(){return Jt.uDec(...this.varint64())}sint64(){let[t,n]=this.varint64(),i=-(t&1);return t=(t>>>1|(n&1)<<31)^i,n=n>>>1^i,Jt.dec(t,n)}bool(){let[t,n]=this.varint64();return t!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Jt.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Jt.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),n=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(n,n+t)}string(){return this.textDecoder.decode(this.bytes())}}function O7(e,t,n,i){let s;return{typeName:t,extendee:n,get field(){if(!s){const r=typeof i=="function"?i():i;r.name=t.split(".").pop(),r.jsonName="[".concat(t,"]"),s=e.util.newFieldList([r]).list()[0]}return s},runtime:e}}function sO(e){const t=e.field.localName,n=Object.create(null);return n[t]=j7(e),[n,()=>n[t]]}function j7(e){const t=e.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return Lu(t.T,t.L);case"message":const n=t.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function B7(e,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(let n=e.length-1;n>=0;--n)if(e[n].no==t.no)return[e[n]];return[]}return e.filter(n=>n.no===t.no)}let Eo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Qv=[];for(let e=0;e<Eo.length;e++)Qv[Eo[e].charCodeAt(0)]=e;Qv[45]=Eo.indexOf("+");Qv[95]=Eo.indexOf("/");const rO={dec(e){let t=e.length*3/4;e[e.length-2]=="="?t-=2:e[e.length-1]=="="&&(t-=1);let n=new Uint8Array(t),i=0,s=0,r,o=0;for(let a=0;a<e.length;a++){if(r=Qv[e.charCodeAt(a)],r===void 0)switch(e[a]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:o=r,s=1;break;case 1:n[i++]=o<<2|(r&48)>>4,o=r,s=2;break;case 2:n[i++]=(o&15)<<4|(r&60)>>2,o=r,s=3;break;case 3:n[i++]=(o&3)<<6|r,s=0;break}}if(s==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(e){let t="",n=0,i,s=0;for(let r=0;r<e.length;r++)switch(i=e[r],n){case 0:t+=Eo[i>>2],s=(i&3)<<4,n=1;break;case 1:t+=Eo[s|i>>4],s=(i&15)<<2,n=2;break;case 2:t+=Eo[s|i>>6],t+=Eo[i&63],n=0;break}return n&&(t+=Eo[s],t+="=",n==1&&(t+="=")),t}};function F7(e,t,n){aO(t,e);const i=t.runtime.bin.makeReadOptions(n),s=B7(e.getType().runtime.bin.listUnknownFields(e),t.field),[r,o]=sO(t);for(const a of s)t.runtime.bin.readField(r,i.readerFactory(a.data),t.field,a.wireType,i);return o()}function U7(e,t,n,i){aO(t,e);const s=t.runtime.bin.makeReadOptions(i),r=t.runtime.bin.makeWriteOptions(i);if(oO(e,t)){const u=e.getType().runtime.bin.listUnknownFields(e).filter(h=>h.no!=t.field.no);e.getType().runtime.bin.discardUnknownFields(e);for(const h of u)e.getType().runtime.bin.onUnknownField(e,h.no,h.wireType,h.data)}const o=r.writerFactory();let a=t.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(a,n,o,r);const c=s.readerFactory(o.finish());for(;c.pos<c.len;){const[u,h]=c.tag(),f=c.skip(h,u);e.getType().runtime.bin.onUnknownField(e,u,h,f)}}function oO(e,t){const n=e.getType();return t.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(e).find(i=>i.no==t.field.no)}function aO(e,t){cn(e.extendee.typeName==t.getType().typeName,"extension ".concat(e.typeName," can only be applied to message ").concat(e.extendee.typeName))}function lO(e,t){const n=e.localName;if(e.repeated)return t[n].length>0;if(e.oneof)return t[e.oneof.localName].case===n;switch(e.kind){case"enum":case"scalar":return e.opt||e.req?t[n]!==void 0:e.kind=="enum"?t[n]!==e.T.values[0].no:!iO(e.T,t[n]);case"message":return t[n]!==void 0;case"map":return Object.keys(t[n]).length>0}}function BA(e,t){const n=e.localName,i=!e.opt&&!e.req;if(e.repeated)t[n]=[];else if(e.oneof)t[e.oneof.localName]={case:void 0};else switch(e.kind){case"map":t[n]={};break;case"enum":t[n]=i?e.T.values[0].no:void 0;break;case"scalar":t[n]=i?Lu(e.T,e.L):void 0;break;case"message":t[n]=void 0;break}}function Ro(e,t){if(e===null||typeof e!="object"||!Object.getOwnPropertyNames(UC.prototype).every(i=>i in e&&typeof e[i]=="function"))return!1;const n=e.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:t===void 0?!0:n.typeName==t.typeName}function cO(e,t){return Ro(t)||!e.fieldWrapper?t:e.fieldWrapper.wrapField(t)}me.DOUBLE,me.FLOAT,me.INT64,me.UINT64,me.INT32,me.UINT32,me.BOOL,me.STRING,me.BYTES;const FA={ignoreUnknownFields:!1},UA={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function z7(e){return e?Object.assign(Object.assign({},FA),e):FA}function $7(e){return e?Object.assign(Object.assign({},UA),e):UA}const Jg=Symbol(),ag=Symbol();function q7(){return{makeReadOptions:z7,makeWriteOptions:$7,readMessage(e,t,n,i){if(t==null||Array.isArray(t)||typeof t!="object")throw new Error("cannot decode message ".concat(e.typeName," from JSON: ").concat(Mr(t)));i=i??new e;const s=new Map,r=n.typeRegistry;for(const[o,a]of Object.entries(t)){const c=e.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const u=s.get(c.oneof);if(u!==void 0)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(u,'", "').concat(o,'"'));s.set(c.oneof,o)}zA(i,a,c,n,e)}else{let u=!1;if(r?.findExtension&&o.startsWith("[")&&o.endsWith("]")){const h=r.findExtension(o.substring(1,o.length-1));if(h&&h.extendee.typeName==e.typeName){u=!0;const[f,m]=sO(h);zA(f,a,h.field,n,h),U7(i,h,m(),n)}}if(!u&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(e.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(e,t){const n=e.getType(),i={};let s;try{for(s of n.fields.byNumber()){if(!lO(s,e)){if(s.req)throw"required field not set";if(!t.emitDefaultValues||!V7(s))continue}const o=s.oneof?e[s.oneof.localName].value:e[s.localName],a=$A(s,o,t);a!==void 0&&(i[t.useProtoFieldName?s.name:s.jsonName]=a)}const r=t.typeRegistry;if(r?.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(e)){const a=r.findExtensionFor(n.typeName,o.no);if(a&&oO(e,a)){const c=F7(e,a,t),u=$A(a.field,c,t);u!==void 0&&(i[a.field.jsonName]=u)}}}catch(r){const o=s?"cannot encode field ".concat(n.typeName,".").concat(s.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=r instanceof Error?r.message:String(r);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(e,t,n){return Ih(e,t,n??Fa.BIGINT,!0)},writeScalar(e,t,n){if(t!==void 0&&(n||iO(e,t)))return lg(e,t)},debug:Mr}}function Mr(e){if(e===null)return"null";switch(typeof e){case"object":return Array.isArray(e)?"array":"object";case"string":return e.length>100?"string":'"'.concat(e.split('"').join('\\"'),'"');default:return String(e)}}function zA(e,t,n,i,s){let r=n.localName;if(n.repeated){if(cn(n.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error("cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Mr(t)));const o=e[r];for(const a of t){if(a===null)throw new Error("cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Mr(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const c=y0(n.T,a,i.ignoreUnknownFields,!0);c!==ag&&o.push(c);break;case"scalar":try{o.push(Ih(n.T,a,n.L,!0))}catch(u){let h="cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Mr(a));throw u instanceof Error&&u.message.length>0&&(h+=": ".concat(u.message)),new Error(h)}break}}}else if(n.kind=="map"){if(t===null)return;if(typeof t!="object"||Array.isArray(t))throw new Error("cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Mr(t)));const o=e[r];for(const[a,c]of Object.entries(t)){if(c===null)throw new Error("cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: map value null"));let u;try{u=H7(n.K,a)}catch(h){let f="cannot decode map key for field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Mr(t));throw h instanceof Error&&h.message.length>0&&(f+=": ".concat(h.message)),new Error(f)}switch(n.V.kind){case"message":o[u]=n.V.T.fromJson(c,i);break;case"enum":const h=y0(n.V.T,c,i.ignoreUnknownFields,!0);h!==ag&&(o[u]=h);break;case"scalar":try{o[u]=Ih(n.V.T,c,Fa.BIGINT,!0)}catch(f){let m="cannot decode map value for field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Mr(t));throw f instanceof Error&&f.message.length>0&&(m+=": ".concat(f.message)),new Error(m)}break}}}else switch(n.oneof&&(e=e[n.oneof.localName]={case:r},r="value"),n.kind){case"message":const o=n.T;if(t===null&&o.typeName!="google.protobuf.Value")return;let a=e[r];Ro(a)?a.fromJson(t,i):(e[r]=a=o.fromJson(t,i),o.fieldWrapper&&!n.oneof&&(e[r]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=y0(n.T,t,i.ignoreUnknownFields,!1);switch(c){case Jg:BA(n,e);break;case ag:break;default:e[r]=c;break}break;case"scalar":try{const u=Ih(n.T,t,n.L,!1);switch(u){case Jg:BA(n,e);break;default:e[r]=u;break}}catch(u){let h="cannot decode field ".concat(s.typeName,".").concat(n.name," from JSON: ").concat(Mr(t));throw u instanceof Error&&u.message.length>0&&(h+=": ".concat(u.message)),new Error(h)}break}}function H7(e,t){if(e===me.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return Ih(e,t,Fa.BIGINT,!0).toString()}function Ih(e,t,n,i){if(t===null)return i?Lu(e,n):Jg;switch(e){case me.DOUBLE:case me.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;const s=Number(t);if(Number.isNaN(s)||!Number.isFinite(s))break;return e==me.FLOAT&&XD(s),s;case me.INT32:case me.FIXED32:case me.SFIXED32:case me.SINT32:case me.UINT32:let r;if(typeof t=="number"?r=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(r=Number(t)),r===void 0)break;return e==me.UINT32||e==me.FIXED32?mx(r):rg(r),r;case me.INT64:case me.SFIXED64:case me.SINT64:if(typeof t!="number"&&typeof t!="string")break;const o=Jt.parse(t);return n?o.toString():o;case me.FIXED64:case me.UINT64:if(typeof t!="number"&&typeof t!="string")break;const a=Jt.uParse(t);return n?a.toString():a;case me.BOOL:if(typeof t!="boolean")break;return t;case me.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case me.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return rO.dec(t)}throw new Error}function y0(e,t,n,i){if(t===null)return e.typeName=="google.protobuf.NullValue"?0:i?e.values[0].no:Jg;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const s=e.findName(t);if(s!==void 0)return s.no;if(n)return ag;break}throw new Error("cannot decode enum ".concat(e.typeName," from JSON: ").concat(Mr(t)))}function V7(e){return e.repeated||e.kind=="map"?!0:!(e.oneof||e.kind=="message"||e.opt||e.req)}function $A(e,t,n){if(e.kind=="map"){cn(typeof t=="object"&&t!=null);const i={},s=Object.entries(t);switch(e.V.kind){case"scalar":for(const[o,a]of s)i[o.toString()]=lg(e.V.T,a);break;case"message":for(const[o,a]of s)i[o.toString()]=a.toJson(n);break;case"enum":const r=e.V.T;for(const[o,a]of s)i[o.toString()]=b0(r,a,n.enumAsInteger);break}return n.emitDefaultValues||s.length>0?i:void 0}if(e.repeated){cn(Array.isArray(t));const i=[];switch(e.kind){case"scalar":for(let s=0;s<t.length;s++)i.push(lg(e.T,t[s]));break;case"enum":for(let s=0;s<t.length;s++)i.push(b0(e.T,t[s],n.enumAsInteger));break;case"message":for(let s=0;s<t.length;s++)i.push(t[s].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(e.kind){case"scalar":return lg(e.T,t);case"enum":return b0(e.T,t,n.enumAsInteger);case"message":return cO(e.T,t).toJson(n)}}function b0(e,t,n){var i;if(cn(typeof t=="number"),e.typeName=="google.protobuf.NullValue")return null;if(n)return t;const s=e.findNumber(t);return(i=s?.name)!==null&&i!==void 0?i:t}function lg(e,t){switch(e){case me.INT32:case me.SFIXED32:case me.SINT32:case me.FIXED32:case me.UINT32:return cn(typeof t=="number"),t;case me.FLOAT:case me.DOUBLE:return cn(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case me.STRING:return cn(typeof t=="string"),t;case me.BOOL:return cn(typeof t=="boolean"),t;case me.UINT64:case me.FIXED64:case me.INT64:case me.SFIXED64:case me.SINT64:return cn(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case me.BYTES:return cn(t instanceof Uint8Array),rO.enc(t)}}const Gc=Symbol("@bufbuild/protobuf/unknown-fields"),qA={readUnknownFields:!0,readerFactory:e=>new D7(e)},HA={writeUnknownFields:!0,writerFactory:()=>new I7};function W7(e){return e?Object.assign(Object.assign({},qA),e):qA}function G7(e){return e?Object.assign(Object.assign({},HA),e):HA}function K7(){return{makeReadOptions:W7,makeWriteOptions:G7,listUnknownFields(e){var t;return(t=e[Gc])!==null&&t!==void 0?t:[]},discardUnknownFields(e){delete e[Gc]},writeUnknownFields(e,t){const i=e[Gc];if(i)for(const s of i)t.tag(s.no,s.wireType).raw(s.data)},onUnknownField(e,t,n,i){const s=e;Array.isArray(s[Gc])||(s[Gc]=[]),s[Gc].push({no:t,wireType:n,data:i})},readMessage(e,t,n,i,s){const r=e.getType(),o=s?t.len:t.pos+n;let a,c;for(;t.pos<o&&([a,c]=t.tag(),!(s===!0&&c==bn.EndGroup));){const u=r.fields.find(a);if(!u){const h=t.skip(c,a);i.readUnknownFields&&this.onUnknownField(e,a,c,h);continue}VA(e,t,u,c,i)}if(s&&(c!=bn.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:VA,writeMessage(e,t,n){const i=e.getType();for(const s of i.fields.byNumber()){if(!lO(s,e)){if(s.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(s.name," to binary: required field not set"));continue}const r=s.oneof?e[s.oneof.localName].value:e[s.localName];WA(s,r,t,n)}return n.writeUnknownFields&&this.writeUnknownFields(e,t),t},writeField(e,t,n,i){t!==void 0&&WA(e,t,n,i)}}}function VA(e,t,n,i,s){let{repeated:r,localName:o}=n;switch(n.oneof&&(e=e[n.oneof.localName],e.case!=o&&delete e.value,e.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?me.INT32:n.T;let c=Zg;if(n.kind=="scalar"&&n.L>0&&(c=X7),r){let m=e[o];if(i==bn.LengthDelimited&&a!=me.STRING&&a!=me.BYTES){let b=t.uint32()+t.pos;for(;t.pos<b;)m.push(c(t,a))}else m.push(c(t,a))}else e[o]=c(t,a);break;case"message":const u=n.T;r?e[o].push(cg(t,new u,s,n)):Ro(e[o])?cg(t,e[o],s,n):(e[o]=cg(t,new u,s,n),u.fieldWrapper&&!n.oneof&&!n.repeated&&(e[o]=u.fieldWrapper.unwrapField(e[o])));break;case"map":let[h,f]=Y7(n,t,s);e[o][h]=f;break}}function cg(e,t,n,i){const s=t.getType().runtime.bin,r=i?.delimited;return s.readMessage(t,e,r?i.no:e.uint32(),n,r),t}function Y7(e,t,n){const i=t.uint32(),s=t.pos+i;let r,o;for(;t.pos<s;){const[a]=t.tag();switch(a){case 1:r=Zg(t,e.K);break;case 2:switch(e.V.kind){case"scalar":o=Zg(t,e.V.T);break;case"enum":o=t.int32();break;case"message":o=cg(t,new e.V.T,n,void 0);break}break}}if(r===void 0&&(r=Lu(e.K,Fa.BIGINT)),typeof r!="string"&&typeof r!="number"&&(r=r.toString()),o===void 0)switch(e.V.kind){case"scalar":o=Lu(e.V.T,Fa.BIGINT);break;case"enum":o=e.V.T.values[0].no;break;case"message":o=new e.V.T;break}return[r,o]}function X7(e,t){const n=Zg(e,t);return typeof n=="bigint"?n.toString():n}function Zg(e,t){switch(t){case me.STRING:return e.string();case me.BOOL:return e.bool();case me.DOUBLE:return e.double();case me.FLOAT:return e.float();case me.INT32:return e.int32();case me.INT64:return e.int64();case me.UINT64:return e.uint64();case me.FIXED64:return e.fixed64();case me.BYTES:return e.bytes();case me.FIXED32:return e.fixed32();case me.SFIXED32:return e.sfixed32();case me.SFIXED64:return e.sfixed64();case me.SINT64:return e.sint64();case me.UINT32:return e.uint32();case me.SINT32:return e.sint32()}}function WA(e,t,n,i){cn(t!==void 0);const s=e.repeated;switch(e.kind){case"scalar":case"enum":let r=e.kind=="enum"?me.INT32:e.T;if(s)if(cn(Array.isArray(t)),e.packed)J7(n,r,e.no,t);else for(const o of t)Dh(n,r,e.no,o);else Dh(n,r,e.no,t);break;case"message":if(s){cn(Array.isArray(t));for(const o of t)GA(n,i,e,o)}else GA(n,i,e,t);break;case"map":cn(typeof t=="object"&&t!=null);for(const[o,a]of Object.entries(t))Q7(n,i,e,o,a);break}}function Q7(e,t,n,i,s){e.tag(n.no,bn.LengthDelimited),e.fork();let r=i;switch(n.K){case me.INT32:case me.FIXED32:case me.UINT32:case me.SFIXED32:case me.SINT32:r=Number.parseInt(i);break;case me.BOOL:cn(i=="true"||i=="false"),r=i=="true";break}switch(Dh(e,n.K,1,r),n.V.kind){case"scalar":Dh(e,n.V.T,2,s);break;case"enum":Dh(e,me.INT32,2,s);break;case"message":cn(s!==void 0),e.tag(2,bn.LengthDelimited).bytes(s.toBinary(t));break}e.join()}function GA(e,t,n,i){const s=cO(n.T,i);n.delimited?e.tag(n.no,bn.StartGroup).raw(s.toBinary(t)).tag(n.no,bn.EndGroup):e.tag(n.no,bn.LengthDelimited).bytes(s.toBinary(t))}function Dh(e,t,n,i){cn(i!==void 0);let[s,r]=uO(t);e.tag(n,s)[r](i)}function J7(e,t,n,i){if(!i.length)return;e.tag(n,bn.LengthDelimited).fork();let[,s]=uO(t);for(let r=0;r<i.length;r++)e[s](i[r]);e.join()}function uO(e){let t=bn.Varint;switch(e){case me.BYTES:case me.STRING:t=bn.LengthDelimited;break;case me.DOUBLE:case me.FIXED64:case me.SFIXED64:t=bn.Bit64;break;case me.FIXED32:case me.SFIXED32:case me.FLOAT:t=bn.Bit32;break}const n=me[e].toLowerCase();return[t,n]}function Z7(){return{setEnumType:JD,initPartial(e,t){if(e===void 0)return;const n=t.getType();for(const i of n.fields.byMember()){const s=i.localName,r=t,o=e;if(o[s]!=null)switch(i.kind){case"oneof":const a=o[s].case;if(a===void 0)continue;const c=i.findField(a);let u=o[s].value;c&&c.kind=="message"&&!Ro(u,c.T)?u=new c.T(u):c&&c.kind==="scalar"&&c.T===me.BYTES&&(u=Jd(u)),r[s]={case:a,value:u};break;case"scalar":case"enum":let h=o[s];i.T===me.BYTES&&(h=i.repeated?h.map(Jd):Jd(h)),r[s]=h;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===me.BYTES)for(const[y,b]of Object.entries(o[s]))r[s][y]=Jd(b);else Object.assign(r[s],o[s]);break;case"message":const m=i.V.T;for(const y of Object.keys(o[s])){let b=o[s][y];m.fieldWrapper||(b=new m(b)),r[s][y]=b}break}break;case"message":const f=i.T;if(i.repeated)r[s]=o[s].map(m=>Ro(m,f)?m:new f(m));else{const m=o[s];f.fieldWrapper?f.typeName==="google.protobuf.BytesValue"?r[s]=Jd(m):r[s]=m:r[s]=Ro(m,f)?m:new f(m)}break}}},equals(e,t,n){return t===n?!0:!t||!n?!1:e.fields.byMember().every(i=>{const s=t[i.localName],r=n[i.localName];if(i.repeated){if(s.length!==r.length)return!1;switch(i.kind){case"message":return s.every((o,a)=>i.T.equals(o,r[a]));case"scalar":return s.every((o,a)=>ha(i.T,o,r[a]));case"enum":return s.every((o,a)=>ha(me.INT32,o,r[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=s,a=r;return i.T.fieldWrapper&&(o!==void 0&&!Ro(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!Ro(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return ha(me.INT32,s,r);case"scalar":return ha(i.T,s,r);case"oneof":if(s.case!==r.case)return!1;const c=i.findField(s.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(s.value,r.value);case"enum":return ha(me.INT32,s.value,r.value);case"scalar":return ha(c.T,s.value,r.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const u=Object.keys(s).concat(Object.keys(r));switch(i.V.kind){case"message":const h=i.V.T;return u.every(m=>h.equals(s[m],r[m]));case"enum":return u.every(m=>ha(me.INT32,s[m],r[m]));case"scalar":const f=i.V.T;return u.every(m=>ha(f,s[m],r[m]))}break}})},clone(e){const t=e.getType(),n=new t,i=n;for(const s of t.fields.byMember()){const r=e[s.localName];let o;if(s.repeated)o=r.map(bm);else if(s.kind=="map"){o=i[s.localName];for(const[a,c]of Object.entries(r))o[a]=bm(c)}else s.kind=="oneof"?o=s.findField(r.case)?{case:r.case,value:bm(r.value)}:{case:void 0}:o=bm(r);i[s.localName]=o}for(const s of t.runtime.bin.listUnknownFields(e))t.runtime.bin.onUnknownField(i,s.no,s.wireType,s.data);return n}}}function bm(e){if(e===void 0)return e;if(Ro(e))return e.clone();if(e instanceof Uint8Array){const t=new Uint8Array(e.byteLength);return t.set(e),t}return e}function Jd(e){return e instanceof Uint8Array?e:new Uint8Array(e)}function e9(e,t,n){return{syntax:e,json:q7(),bin:K7(),util:Object.assign(Object.assign({},Z7()),{newFieldList:t,initFields:n}),makeMessageType(i,s,r){return R7(this,i,s,r)},makeEnum:E7,makeEnumType:ZD,getEnumType:T7,makeExtension(i,s,r){return O7(this,i,s,r)}}}class t9{constructor(t,n){this._fields=t,this._normalizer=n}findJsonName(t){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[t]}find(t){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[t]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((t,n)=>t.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const t=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,t.push(n)):t.push(i)}return this.members}}function dO(e,t){const n=hO(e);return t?n:a9(o9(n))}function n9(e){return dO(e,!1)}const i9=hO;function hO(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let s=e.charAt(i);switch(s){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(s),t=!1;break;default:t&&(t=!1,s=s.toUpperCase()),n.push(s);break}}return n.join("")}const s9=new Set(["constructor","toString","toJSON","valueOf"]),r9=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),fO=e=>"".concat(e,"$"),o9=e=>r9.has(e)?fO(e):e,a9=e=>s9.has(e)?fO(e):e;class l9{constructor(t){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=n9(t)}addField(t){cn(t.oneof===this,"field ".concat(t.name," not one of ").concat(this.name)),this.fields.push(t)}findField(t){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[t]}}function c9(e,t){var n,i,s,r,o,a;const c=[];let u;for(const h of typeof e=="function"?e():e){const f=h;if(f.localName=dO(h.name,h.oneof!==void 0),f.jsonName=(n=h.jsonName)!==null&&n!==void 0?n:i9(h.name),f.repeated=(i=h.repeated)!==null&&i!==void 0?i:!1,h.kind=="scalar"&&(f.L=(s=h.L)!==null&&s!==void 0?s:Fa.BIGINT),f.delimited=(r=h.delimited)!==null&&r!==void 0?r:!1,f.req=(o=h.req)!==null&&o!==void 0?o:!1,f.opt=(a=h.opt)!==null&&a!==void 0?a:!1,h.packed===void 0&&(f.packed=h.kind=="enum"||h.kind=="scalar"&&h.T!=me.BYTES&&h.T!=me.STRING),h.oneof!==void 0){const m=typeof h.oneof=="string"?h.oneof:h.oneof.name;(!u||u.name!=m)&&(u=new l9(m)),f.oneof=u,u.addField(f)}c.push(f)}return c}const te=e9("proto3",e=>new t9(e,t=>c9(t)),e=>{for(const t of e.getType().fields.byMember()){if(t.opt)continue;const n=t.localName,i=e;if(t.repeated){i[n]=[];continue}switch(t.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Lu(t.T,t.L);break}}});class zi extends UC{constructor(t){super(),this.seconds=Jt.zero,this.nanos=0,te.util.initPartial(t,this)}fromJson(t,n){if(typeof t!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(te.json.debug(t)));const i=t.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const s=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(s))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Jt.parse(s/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(t){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const s=(this.nanos+1e9).toString().substring(1);s.substring(3)==="000000"?i="."+s.substring(0,3)+"Z":s.substring(6)==="000"?i="."+s.substring(0,6)+"Z":i="."+s+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return zi.fromDate(new Date)}static fromDate(t){const n=t.getTime();return new zi({seconds:Jt.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(t,n){return new zi().fromBinary(t,n)}static fromJson(t,n){return new zi().fromJson(t,n)}static fromJsonString(t,n){return new zi().fromJsonString(t,n)}static equals(t,n){return te.util.equals(zi,t,n)}}zi.runtime=te;zi.typeName="google.protobuf.Timestamp";zi.fields=te.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const u9=te.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:zi},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:d9,repeated:!0},{no:5,name:"events",kind:"message",T:f9,repeated:!0}]),d9=te.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:h9,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),h9=te.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:zi},{no:3,name:"value",kind:"scalar",T:2}]),f9=te.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:zi},{no:7,name:"normalized_end_timestamp",kind:"message",T:zi,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),pO=te.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),er=te.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),En=te.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),$C=te.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Sh=te.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),of=te.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),sr=te.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Sl=te.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),p9=te.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Wn=te.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Jv=te.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:ev,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:EO}]),ev=te.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),m9=te.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:te.getEnumType(En),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Hl=te.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:te.getEnumType(yu)},{no:4,name:"tracks",kind:"message",T:hu,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:m9},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:te.getEnumType(af)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:te.getEnumType(sr)},{no:18,name:"kind_details",kind:"enum",T:te.getEnumType(g9),repeated:!0}]),yu=te.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),af=te.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),g9=te.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),On=te.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),v9=te.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Na,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:te.getEnumType(mO)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),hu=te.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:te.getEnumType(er)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:te.getEnumType(En)},{no:10,name:"layers",kind:"message",T:Na,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:v9,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:te.getEnumType(On)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:EO},{no:19,name:"audio_features",kind:"enum",T:te.getEnumType(Wn),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:te.getEnumType(pO)}]),Na=te.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:te.getEnumType($C)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),mO=te.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Ti=te.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:te.getEnumType(ut)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:qC,oneof:"value"},{no:3,name:"speaker",kind:"message",T:y9,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:bO,oneof:"value"},{no:7,name:"transcription",kind:"message",T:b9,oneof:"value"},{no:8,name:"metrics",kind:"message",T:u9,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:tv,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:HC,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:VC,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:WC,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:nv,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:iv,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:sv,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:gO,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),ut=te.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),gO=te.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:te.getEnumType(On)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),vO=te.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:qC,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:tv,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:HC,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:VC,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:WC,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:nv,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:iv,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:sv,oneof:"value"}]),y9=te.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:yO,repeated:!0}]),yO=te.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),qC=te.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),bO=te.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),b9=te.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:_9,repeated:!0}]),_9=te.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),tv=te.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),HC=te.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),VC=te.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),WC=te.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:_O,oneof:"value"}]),_O=te.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),SO=te.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),xO=te.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:te.getEnumType(wO)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),wO=te.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),CO=te.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:te.getEnumType(kO)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),kO=te.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),TO=te.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:KA},{no:2,name:"screen",kind:"message",T:KA},{no:3,name:"resume_connection",kind:"enum",T:te.getEnumType(of)},{no:4,name:"disabled_codecs",kind:"message",T:S9},{no:5,name:"force_relay",kind:"enum",T:te.getEnumType(of)}]),KA=te.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:te.getEnumType(of)}]),S9=te.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:ev,repeated:!0},{no:2,name:"publish",kind:"message",T:ev,repeated:!0}]),EO=te.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),gx=te.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),RO=te.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:te.getEnumType(gx)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),MO=te.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),nv=te.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:te.getEnumType(On)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:RO,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:MO,oneof:"content_header"}],{localName:"DataStream_Header"}),iv=te.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),sv=te.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),x9=te.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),tr=te.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),vx=te.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),w9=te.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),C9=te.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Ua,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ua,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Zv,oneof:"message"},{no:4,name:"add_track",kind:"message",T:lf,oneof:"message"},{no:5,name:"mute",kind:"message",T:ey,oneof:"message"},{no:6,name:"subscription",kind:"message",T:ty,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:AO,oneof:"message"},{no:8,name:"leave",kind:"message",T:ny,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:LO,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:DO,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:QC,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Cr,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:YC,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:BO,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:KC,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:PO,oneof:"message"}]),YA=te.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:k9,oneof:"message"},{no:2,name:"answer",kind:"message",T:Ua,oneof:"message"},{no:3,name:"offer",kind:"message",T:Ua,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Zv,oneof:"message"},{no:5,name:"update",kind:"message",T:R9,oneof:"message"},{no:6,name:"track_published",kind:"message",T:GC,oneof:"message"},{no:8,name:"leave",kind:"message",T:ny,oneof:"message"},{no:9,name:"mute",kind:"message",T:ey,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:M9,oneof:"message"},{no:11,name:"room_update",kind:"message",T:A9,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:L9,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:I9,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:O9,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:B9,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:E9,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:T9,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:U9,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:q9,oneof:"message"},{no:22,name:"request_response",kind:"message",T:H9,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:V9,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:F9,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:Y9,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:j9,oneof:"message"}]),yx=te.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Na,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:te.getEnumType(mO)}]),lf=te.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:te.getEnumType(er)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:te.getEnumType(En)},{no:9,name:"layers",kind:"message",T:Na,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:yx,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:te.getEnumType(On)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:te.getEnumType(pO)},{no:17,name:"audio_features",kind:"enum",T:te.getEnumType(Wn),repeated:!0}]),Zv=te.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:te.getEnumType(tr)},{no:3,name:"final",kind:"scalar",T:8}]),ey=te.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),k9=te.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Jv},{no:2,name:"participant",kind:"message",T:Hl},{no:3,name:"other_participants",kind:"message",T:Hl,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:NO,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:TO},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:xO},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:ev,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),T9=te.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:NO,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:TO},{no:3,name:"server_info",kind:"message",T:xO},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),GC=te.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:hu}]),E9=te.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Ua=te.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),R9=te.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Hl,repeated:!0}]),ty=te.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:SO,repeated:!0}]),AO=te.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:te.getEnumType($C)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),KC=te.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:te.getEnumType(Wn),repeated:!0}]),PO=te.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),ny=te.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:te.getEnumType(sr)},{no:3,name:"action",kind:"enum",T:te.getEnumType(bu)},{no:4,name:"regions",kind:"message",T:z9}]),bu=te.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),LO=te.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Na,repeated:!0}]),YC=te.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),NO=te.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),M9=te.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:yO,repeated:!0}]),A9=te.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Jv}]),P9=te.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:te.getEnumType(Sh)},{no:3,name:"score",kind:"scalar",T:2}]),L9=te.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:P9,repeated:!0}]),N9=te.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:te.getEnumType(vx)}]),I9=te.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:N9,repeated:!0}]),XC=te.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:te.getEnumType($C)},{no:2,name:"enabled",kind:"scalar",T:8}]),D9=te.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:XC,repeated:!0}]),O9=te.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:XC,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:D9,repeated:!0}]),j9=te.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:x9,repeated:!0}]),IO=te.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),DO=te.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:IO,repeated:!0}]),B9=te.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),F9=te.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Jv},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Hl},{no:4,name:"other_participants",kind:"message",T:Hl,repeated:!0}]),QC=te.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Ua},{no:2,name:"subscription",kind:"message",T:ty},{no:3,name:"publish_tracks",kind:"message",T:GC,repeated:!0},{no:4,name:"data_channels",kind:"message",T:jO,repeated:!0},{no:5,name:"offer",kind:"message",T:Ua},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:OO,repeated:!0}]),OO=te.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),jO=te.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:te.getEnumType(tr)}]),Cr=te.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:te.getEnumType(w9),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),BO=te.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),U9=te.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),z9=te.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:$9,repeated:!0}]),$9=te.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),q9=te.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:te.getEnumType(p9)}]),H9=te.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:te.getEnumType(JC)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Zv,oneof:"request"},{no:5,name:"add_track",kind:"message",T:lf,oneof:"request"},{no:6,name:"mute",kind:"message",T:ey,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:YC,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:KC,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:PO,oneof:"request"}]),JC=te.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),V9=te.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),FO=te.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),W9=te.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:CO},{no:2,name:"connection_settings",kind:"message",T:FO},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:lf,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Ua},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:te.getEnumType(Sl)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:QC}]),G9=te.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:te.getEnumType(K9)},{no:2,name:"join_request",kind:"scalar",T:12}]),K9=te.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),Y9=te.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function X9(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ug={exports:{}},Q9=ug.exports,XA;function J9(){return XA||(XA=1,(function(e){(function(t,n){e.exports?e.exports=n():t.log=n()})(Q9,function(){var t=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),s=["trace","debug","info","warn","error"],r={},o=null;function a(S,_){var w=S[_];if(typeof w.bind=="function")return w.bind(S);try{return Function.prototype.bind.call(w,S)}catch{return function(){return Function.prototype.apply.apply(w,[S,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function u(S){return S==="debug"&&(S="log"),typeof console===n?!1:S==="trace"&&i?c:console[S]!==void 0?a(console,S):console.log!==void 0?a(console,"log"):t}function h(){for(var S=this.getLevel(),_=0;_<s.length;_++){var w=s[_];this[w]=_<S?t:this.methodFactory(w,S,this.name)}if(this.log=this.debug,typeof console===n&&S<this.levels.SILENT)return"No console available for logging"}function f(S){return function(){typeof console!==n&&(h.call(this),this[S].apply(this,arguments))}}function m(S,_,w){return u(S)||f.apply(this,arguments)}function y(S,_){var w=this,M,R,E,A="loglevel";typeof S=="string"?A+=":"+S:typeof S=="symbol"&&(A=void 0);function T(O){var j=(s[O]||"silent").toUpperCase();if(!(typeof window===n||!A)){try{window.localStorage[A]=j;return}catch{}try{window.document.cookie=encodeURIComponent(A)+"="+j+";"}catch{}}}function L(){var O;if(!(typeof window===n||!A)){try{O=window.localStorage[A]}catch{}if(typeof O===n)try{var j=window.document.cookie,$=encodeURIComponent(A),V=j.indexOf($+"=");V!==-1&&(O=/^([^;]+)/.exec(j.slice(V+$.length+1))[1])}catch{}return w.levels[O]===void 0&&(O=void 0),O}}function P(){if(!(typeof window===n||!A)){try{window.localStorage.removeItem(A)}catch{}try{window.document.cookie=encodeURIComponent(A)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function I(O){var j=O;if(typeof j=="string"&&w.levels[j.toUpperCase()]!==void 0&&(j=w.levels[j.toUpperCase()]),typeof j=="number"&&j>=0&&j<=w.levels.SILENT)return j;throw new TypeError("log.setLevel() called with invalid level: "+O)}w.name=S,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=_||m,w.getLevel=function(){return E??R??M},w.setLevel=function(O,j){return E=I(O),j!==!1&&T(E),h.call(w)},w.setDefaultLevel=function(O){R=I(O),L()||w.setLevel(O,!1)},w.resetLevel=function(){E=null,P(),h.call(w)},w.enableAll=function(O){w.setLevel(w.levels.TRACE,O)},w.disableAll=function(O){w.setLevel(w.levels.SILENT,O)},w.rebuild=function(){if(o!==w&&(M=I(o.getLevel())),h.call(w),o===w)for(var O in r)r[O].rebuild()},M=I(o?o.getLevel():"WARN");var N=L();N!=null&&(E=I(N)),h.call(w)}o=new y,o.getLogger=function(_){if(typeof _!="symbol"&&typeof _!="string"||_==="")throw new TypeError("You must supply a name when creating a logger.");var w=r[_];return w||(w=r[_]=new y(_,o.methodFactory)),w};var b=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=b),o},o.getLoggers=function(){return r},o.default=o,o})})(ug)),ug.exports}var iy=J9(),bx;(function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"})(bx||(bx={}));var cr;(function(e){e.Default="livekit",e.Room="livekit-room",e.TokenSource="livekit-token-source",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"})(cr||(cr={}));let nt=iy.getLogger("livekit");Object.values(cr).map(e=>iy.getLogger(e));nt.setDefaultLevel(bx.info);function Oo(e){const t=iy.getLogger(e);return t.setDefaultLevel(nt.getLevel()),t}const Z9=iy.getLogger("lk-e2ee"),Zd=7e3,eV=[0,300,4*300,9*300,16*300,Zd,Zd,Zd,Zd,Zd];class tV{constructor(t){this._retryDelays=t!==void 0?[...t]:eV}nextRetryDelayInMs(t){if(t.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[t.retryCount];return t.retryCount<=1?n:n+Math.random()*1e3}}function nV(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]]);return n}function K(e,t,n,i){function s(r){return r instanceof n?r:new n(function(o){o(r)})}return new(n||(n=Promise))(function(r,o){function a(h){try{u(i.next(h))}catch(f){o(f)}}function c(h){try{u(i.throw(h))}catch(f){o(f)}}function u(h){h.done?r(h.value):s(h.value).then(a,c)}u((i=i.apply(e,t||[])).next())})}function QA(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Mo(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof QA=="function"?QA(e):e[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(r){n[r]=e[r]&&function(o){return new Promise(function(a,c){o=e[r](o),s(a,c,o.done,o.value)})}}function s(r,o,a,c){Promise.resolve(c).then(function(u){r({value:u,done:a})},o)}}var _m={exports:{}},JA;function iV(){if(JA)return _m.exports;JA=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(A,T,L){return Function.prototype.apply.call(A,T,L)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(A){return Object.getOwnPropertyNames(A).concat(Object.getOwnPropertySymbols(A))}:n=function(A){return Object.getOwnPropertyNames(A)};function i(E){console&&console.warn&&console.warn(E)}var s=Number.isNaN||function(A){return A!==A};function r(){r.init.call(this)}_m.exports=r,_m.exports.once=w,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(E){if(typeof E!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof E)}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(E){if(typeof E!="number"||E<0||s(E))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+E+".");o=E}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(A){if(typeof A!="number"||A<0||s(A))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+A+".");return this._maxListeners=A,this};function c(E){return E._maxListeners===void 0?r.defaultMaxListeners:E._maxListeners}r.prototype.getMaxListeners=function(){return c(this)},r.prototype.emit=function(A){for(var T=[],L=1;L<arguments.length;L++)T.push(arguments[L]);var P=A==="error",I=this._events;if(I!==void 0)P=P&&I.error===void 0;else if(!P)return!1;if(P){var N;if(T.length>0&&(N=T[0]),N instanceof Error)throw N;var O=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw O.context=N,O}var j=I[A];if(j===void 0)return!1;if(typeof j=="function")t(j,this,T);else for(var $=j.length,V=b(j,$),L=0;L<$;++L)t(V[L],this,T);return!0};function u(E,A,T,L){var P,I,N;if(a(T),I=E._events,I===void 0?(I=E._events=Object.create(null),E._eventsCount=0):(I.newListener!==void 0&&(E.emit("newListener",A,T.listener?T.listener:T),I=E._events),N=I[A]),N===void 0)N=I[A]=T,++E._eventsCount;else if(typeof N=="function"?N=I[A]=L?[T,N]:[N,T]:L?N.unshift(T):N.push(T),P=c(E),P>0&&N.length>P&&!N.warned){N.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(A)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=E,O.type=A,O.count=N.length,i(O)}return E}r.prototype.addListener=function(A,T){return u(this,A,T,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(A,T){return u(this,A,T,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(E,A,T){var L={fired:!1,wrapFn:void 0,target:E,type:A,listener:T},P=h.bind(L);return P.listener=T,L.wrapFn=P,P}r.prototype.once=function(A,T){return a(T),this.on(A,f(this,A,T)),this},r.prototype.prependOnceListener=function(A,T){return a(T),this.prependListener(A,f(this,A,T)),this},r.prototype.removeListener=function(A,T){var L,P,I,N,O;if(a(T),P=this._events,P===void 0)return this;if(L=P[A],L===void 0)return this;if(L===T||L.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete P[A],P.removeListener&&this.emit("removeListener",A,L.listener||T));else if(typeof L!="function"){for(I=-1,N=L.length-1;N>=0;N--)if(L[N]===T||L[N].listener===T){O=L[N].listener,I=N;break}if(I<0)return this;I===0?L.shift():S(L,I),L.length===1&&(P[A]=L[0]),P.removeListener!==void 0&&this.emit("removeListener",A,O||T)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(A){var T,L,P;if(L=this._events,L===void 0)return this;if(L.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):L[A]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete L[A]),this;if(arguments.length===0){var I=Object.keys(L),N;for(P=0;P<I.length;++P)N=I[P],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=L[A],typeof T=="function")this.removeListener(A,T);else if(T!==void 0)for(P=T.length-1;P>=0;P--)this.removeListener(A,T[P]);return this};function m(E,A,T){var L=E._events;if(L===void 0)return[];var P=L[A];return P===void 0?[]:typeof P=="function"?T?[P.listener||P]:[P]:T?_(P):b(P,P.length)}r.prototype.listeners=function(A){return m(this,A,!0)},r.prototype.rawListeners=function(A){return m(this,A,!1)},r.listenerCount=function(E,A){return typeof E.listenerCount=="function"?E.listenerCount(A):y.call(E,A)},r.prototype.listenerCount=y;function y(E){var A=this._events;if(A!==void 0){var T=A[E];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}r.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function b(E,A){for(var T=new Array(A),L=0;L<A;++L)T[L]=E[L];return T}function S(E,A){for(;A+1<E.length;A++)E[A]=E[A+1];E.pop()}function _(E){for(var A=new Array(E.length),T=0;T<A.length;++T)A[T]=E[T].listener||E[T];return A}function w(E,A){return new Promise(function(T,L){function P(N){E.removeListener(A,I),L(N)}function I(){typeof E.removeListener=="function"&&E.removeListener("error",P),T([].slice.call(arguments))}R(E,A,I,{once:!0}),A!=="error"&&M(E,P,{once:!0})})}function M(E,A,T){typeof E.on=="function"&&R(E,"error",A,T)}function R(E,A,T,L){if(typeof E.on=="function")L.once?E.once(A,T):E.on(A,T);else if(typeof E.addEventListener=="function")E.addEventListener(A,function P(I){L.once&&E.removeEventListener(A,P),T(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof E)}return _m.exports}var Gr=iV();let UO=!0,zO=!0;function xh(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseFloat(i[n],10)}function Zl(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(o,a){if(o!==t)return s.apply(this,arguments);const c=u=>{const h=n(u);h&&(a.handleEvent?a.handleEvent(h):a(h))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(a,c),s.apply(this,[o,c])};const r=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(a))return r.apply(this,arguments);const c=this._eventMap[t].get(a);return this._eventMap[t].delete(a),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[o,c])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function sV(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(UO=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function rV(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(zO=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function $O(){if(typeof window=="object"){if(UO)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ZC(e,t){zO&&console.warn(e+" is deprecated, please use "+t+" instead.")}function oV(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(s=>s.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)t.browser="firefox",t.version=parseInt(xh(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=parseInt(xh(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=parseInt(xh(n.userAgent,/AppleWebKit\/(\d+)\./,1)),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype,t._safariVersion=xh(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return t.browser="Not a supported browser.",t;return t}function ZA(e){return Object.prototype.toString.call(e)==="[object Object]"}function qO(e){return ZA(e)?Object.keys(e).reduce(function(t,n){const i=ZA(e[n]),s=i?qO(e[n]):e[n],r=i&&!Object.keys(s).length;return s===void 0||r?t:Object.assign(t,{[n]:s})},{}):e}function _x(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?_x(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(s=>{_x(e,e.get(s),n)})}))}function eP(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const r=[];return e.forEach(o=>{o.type==="track"&&o.trackIdentifier===t.id&&r.push(o)}),r.forEach(o=>{e.forEach(a=>{a.type===i&&a.trackId===o.id&&_x(e,a,s)})}),s}const tP=$O;function HO(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const h=typeof a[u]=="object"?a[u]:{ideal:a[u]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const f=function(m,y){return m?m+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(h.ideal!==void 0){c.optional=c.optional||[];let m={};typeof h.ideal=="number"?(m[f("min",u)]=h.ideal,c.optional.push(m),m={},m[f("max",u)]=h.ideal,c.optional.push(m)):(m[f("",u)]=h.ideal,c.optional.push(m))}h.exact!==void 0&&typeof h.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[f("",u)]=h.exact):["min","max"].forEach(m=>{h[m]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[f(m,u)]=h[m])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},s=function(a,c){if(t.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const u=function(h,f,m){f in h&&!(m in h)&&(h[m]=h[f],delete h[f])};a=JSON.parse(JSON.stringify(a)),u(a.audio,"autoGainControl","googAutoGainControl"),u(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let u=a.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const h=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete a.video.facingMode;let f;if(u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(m=>{m=m.filter(b=>b.kind==="videoinput");let y=m.find(b=>f.some(S=>b.label.toLowerCase().includes(S)));return!y&&m.length&&f.includes("back")&&(y=m[m.length-1]),y&&(a.video.deviceId=u.exact?{exact:y.deviceId}:{ideal:y.deviceId}),a.video=i(a.video),tP("chrome: "+JSON.stringify(a)),c(a)})}a.video=i(a.video)}return tP("chrome: "+JSON.stringify(a)),c(a)},r=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,u){s(a,h=>{n.webkitGetUserMedia(h,c,f=>{u&&u(r(f))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return s(c,u=>a(u).then(h=>{if(u.audio&&!h.getAudioTracks().length||u.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return h},h=>Promise.reject(r(h))))}}}function VO(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function WO(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let r;e.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):r={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(s=>{let r;e.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===s.id):r={track:s};const o=new Event("track");o.track=s,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Zl(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function GO(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(s,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=s.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,c){let u=s.apply(this,arguments);return u||(u=t(this,a),this._senders.push(u)),u};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(t(this,o))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function KO(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>eP(o,r.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const s=n.apply(this,[]);return s.forEach(r=>r._pc=this),s}),Zl(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>eP(r,s.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let s,r,o;return this.getSenders().forEach(a=>{a.track===i&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===i&&(r?o=!0:r=a),a.track===i)),o||s&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function YO(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(u=>a.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function XO(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return YO(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const h=n.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(f=>this._reverseStreams[f.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(f=>{if(this.getSenders().find(y=>y.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const f=new e.MediaStream(h.getTracks());this._streams[h.id]=f,this._reverseStreams[f.id]=h,h=f}i.apply(this,[h])};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},e.RTCPeerConnection.prototype.addTrack=function(h,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(S=>S===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[f.id];if(b)b.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new e.MediaStream([h]);this._streams[f.id]=S,this._reverseStreams[S.id]=f,this.addStream(S)}return this.getSenders().find(S=>S.track===h)};function r(u,h){let f=h.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const y=u._reverseStreams[m],b=u._streams[y.id];f=f.replace(new RegExp(b.id,"g"),y.id)}),new RTCSessionDescription({type:h.type,sdp:f})}function o(u,h){let f=h.sdp;return Object.keys(u._reverseStreams||[]).forEach(m=>{const y=u._reverseStreams[m],b=u._streams[y.id];f=f.replace(new RegExp(y.id,"g"),b.id)}),new RTCSessionDescription({type:h.type,sdp:f})}["createOffer","createAnswer"].forEach(function(u){const h=e.RTCPeerConnection.prototype[u],f={[u](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[b=>{const S=r(this,b);m[0].apply(null,[S])},b=>{m[1]&&m[1].apply(null,b)},arguments[2]]):h.apply(this,arguments).then(b=>r(this,b))}};e.RTCPeerConnection.prototype[u]=f[u]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=c.get.apply(this);return u.type===""?u:r(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(h._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let m;Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(S=>h.track===S)&&(m=this._streams[y])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Sx(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=s[n]})}function QO(e,t){Zl(e,"negotiationneeded",n=>{const i=n.target;if(!((t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var nP=Object.freeze({__proto__:null,fixNegotiationNeeded:QO,shimAddTrackRemoveTrack:XO,shimAddTrackRemoveTrackWithNative:YO,shimGetSendersWithDtmf:GO,shimGetUserMedia:HO,shimMediaStream:VO,shimOnTrack:WO,shimPeerConnection:Sx,shimSenderReceiverGetStats:KO});function JO(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(s,r,o){ZC("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(r,o)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},r=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),r(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function aV(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function ZO(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function xx(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=e.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=o[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return i.apply(this,[r||null]).then(c=>{if(t.version<53&&!o)try{c.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;c.forEach((h,f)=>{c.set(f,Object.assign({},h,{type:n[h.type]||h.type}))})}return c}).then(o,a)}}function e5(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(r=>r._pc=this),s});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function t5(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Zl(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function n5(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){ZC("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function i5(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function s5(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(s){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function r5(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function o5(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function a5(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var iP=Object.freeze({__proto__:null,shimAddTransceiver:s5,shimCreateAnswer:a5,shimCreateOffer:o5,shimGetDisplayMedia:aV,shimGetParameters:r5,shimGetUserMedia:JO,shimOnTrack:ZO,shimPeerConnection:xx,shimRTCDataChannel:i5,shimReceiverGetStats:t5,shimRemoveStream:n5,shimSenderGetStats:e5});function l5(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>t.call(this,s,i)),i.getVideoTracks().forEach(s=>t.call(this,s,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var s=arguments.length,r=new Array(s>1?s-1:0),o=1;o<s;o++)r[o-1]=arguments[o];return r&&r.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const s=n.getTracks();this.getSenders().forEach(r=>{s.includes(r.track)&&this.removeTrack(r)})})}}function c5(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,this.dispatchEvent(r)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,i.dispatchEvent(o)})}),t.apply(i,arguments)}}}function u5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,r=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(u,h){const f=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[f]);return h?(m.then(u,h),Promise.resolve()):m},t.createAnswer=function(u,h){const f=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[f]);return h?(m.then(u,h),Promise.resolve()):m};let a=function(c,u,h){const f=s.apply(this,[c]);return h?(f.then(u,h),Promise.resolve()):f};t.setLocalDescription=a,a=function(c,u,h){const f=r.apply(this,[c]);return h?(f.then(u,h),Promise.resolve()):f},t.setRemoteDescription=a,a=function(c,u,h){const f=o.apply(this,[c]);return h?(f.then(u,h),Promise.resolve()):f},t.addIceCandidate=a}function d5(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=s=>i(h5(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(i,s,r){t.mediaDevices.getUserMedia(i).then(s,r)}).bind(t))}function h5(e){return e&&e.video!==void 0?Object.assign({},e,{video:qO(e.video)}):e}function f5(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const r=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(ZC("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(i.iceServers[o])}i.iceServers=r}return new t(i,s)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function p5(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function m5(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function g5(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var sP=Object.freeze({__proto__:null,shimAudioContext:g5,shimCallbacksAPI:u5,shimConstraints:h5,shimCreateOfferLegacy:m5,shimGetUserMedia:d5,shimLocalStreamsAPI:l5,shimRTCIceServerUrls:f5,shimRemoteStreamsAPI:c5,shimTrackEventTransceiver:p5}),_0={exports:{}},rP;function lV(){return rP||(rP=1,(function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(n){return n.split(`
m=`).map((s,r)=>(r>0?"m="+s:s).trim()+`\r
`)},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(s=>s.indexOf(i)===0)},t.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const s={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let r=8;r<i.length;r+=2)switch(i[r]){case"raddr":s.relatedAddress=i[r+1];break;case"rport":s.relatedPort=parseInt(i[r+1],10);break;case"tcptype":s.tcpType=i[r+1];break;case"ufrag":s.ufrag=i[r+1],s.usernameFragment=i[r+1];break;default:s[i[r]]===void 0&&(s[i[r]]=i[r+1]);break}return s},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const s=n.component;s==="rtp"?i.push(1):s==="rtcp"?i.push(2):i.push(s),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const r=n.type;return i.push("typ"),i.push(r),r!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const i={};let s;const r=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<r.length;o++)s=r[o].trim().split("="),i[s[0].trim()]=s[1];return i},t.writeFmtp=function(n){let i="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const r=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?r.push(o+"="+n.parameters[o]):r.push(o)}),i+="a=fmtp:"+s+" "+r.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(r=>{i+="a=rtcp-fb:"+s+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,i),10)},r=n.indexOf(":",i);return r>-1?(s.attribute=n.substring(i+1,r),s.value=n.substring(r+1)):s.attribute=n.substring(i+1),s},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(s=>parseInt(s,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let s="a=setup:"+i+`\r
`;return n.fingerprints.forEach(r=>{s+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),s},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const s=t.matchPrefix(n+i,"a=ice-ufrag:")[0],r=t.matchPrefix(n+i,"a=ice-pwd:")[0];return s&&r?{usernameFragment:s.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(n)[0].split(" ");i.profile=r[2];for(let a=3;a<r.length;a++){const c=r[a],u=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(u){const h=t.parseRtpMap(u),f=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(h.parameters=f.length?t.parseFmtp(f[0]):{},h.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),i.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(h.name.toUpperCase());break}}}t.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(t.parseExtmap(a))});const o=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(h=>h.type===c.type&&h.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),i},t.writeRtpDescription=function(n,i){let s="";s+="m="+n+" ",s+=i.codecs.length>0?"9":"0",s+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{s+=t.writeRtpMap(o),s+=t.writeFmtp(o),s+=t.writeRtcpFb(o)});let r=0;return i.codecs.forEach(o=>{o.maxptime>r&&(r=o.maxptime)}),r>0&&(s+="a=maxptime:"+r+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{s+=t.writeExtmap(o)}),s},t.parseRtpEncodingParameters=function(n){const i=[],s=t.parseRtpParameters(n),r=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=t.matchPrefix(n,"a=ssrc:").map(m=>t.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),c=a.length>0&&a[0].ssrc;let u;const h=t.matchPrefix(n,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(b=>parseInt(b,10)));h.length>0&&h[0].length>1&&h[0][0]===c&&(u=h[0][1]),s.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let y={ssrc:c,codecPayloadType:parseInt(m.parameters.apt,10)};c&&u&&(y.rtx={ssrc:u}),i.push(y),r&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(y))}}),i.length===0&&c&&i.push({ssrc:c});let f=t.matchPrefix(n,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-2e3*8:f=void 0,i.forEach(m=>{m.maxBitrate=f})),i},t.parseRtcpParameters=function(n){const i={},s=t.matchPrefix(n,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);const r=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;const o=t.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const s=t.matchPrefix(n,"a=msid:");if(s.length===1)return i=s[0].substring(7).split(" "),{stream:i[0],track:i[1]};const r=t.matchPrefix(n,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},t.parseSctpDescription=function(n){const i=t.parseMLine(n),s=t.matchPrefix(n,"a=max-message-size:");let r;s.length>0&&(r=parseInt(s[0].substring(19),10)),isNaN(r)&&(r=65536);const o=t.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:r};const a=t.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:r}}},t.writeSctpDescription=function(n,i){let s=[];return n.protocol!=="DTLS/SCTP"?s=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:s=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,s){let r;const o=i!==void 0?i:2;return n?r=n:r=t.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const s=t.splitLines(n);for(let r=0;r<s.length;r++)switch(s[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[r].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const s=t.splitLines(n)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},t.parseOLine=function(n){const s=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},e.exports=t})(_0)),_0.exports}var v5=lV(),_u=X9(v5),cV=y7({__proto__:null,default:_u},[v5]);function dg(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const s=new t(i),r=_u.parseCandidate(i.candidate);for(const o in r)o in s||Object.defineProperty(s,o,{value:r[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(i)},e.RTCIceCandidate.prototype=t.prototype,Zl(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function wx(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Zl(e,"icecandidate",t=>{if(t.candidate){const n=_u.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function hg(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=_u.splitSections(a.sdp);return c.shift(),c.some(u=>{const h=_u.parseMLine(u);return h&&h.kind==="application"&&h.protocol.indexOf("SCTP")!==-1})},i=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const u=parseInt(c[1],10);return u!==u?-1:u},s=function(a){let c=65536;return t.browser==="firefox"&&(t.version<57?a===-1?c=16384:c=2147483637:t.version<60?c=t.version===57?65535:65536:c=2147483637),c},r=function(a,c){let u=65536;t.browser==="firefox"&&t.version===57&&(u=65535);const h=_u.matchPrefix(a.sdp,"a=max-message-size:");return h.length>0?u=parseInt(h[0].substring(19),10):t.browser==="firefox"&&c!==-1&&(u=2147483637),u},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=i(arguments[0]),u=s(c),h=r(arguments[0],c);let f;u===0&&h===0?f=Number.POSITIVE_INFINITY:u===0||h===0?f=Math.max(u,h):f=Math.min(u,h);const m={};Object.defineProperty(m,"maxMessageSize",{get(){return f}}),this._sctp=m}return o.apply(this,arguments)}}function fg(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,s){const r=i.send;i.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(i.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const s=n.apply(this,arguments);return t(s,this),s},Zl(e,"datachannel",i=>(t(i.channel,i.target),i))}function Cx(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const r=s.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const o=new Event("connectionstatechange",s);r.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function kx(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t._safariVersion>=13.1)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&s instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:s.type,sdp:r}):s.sdp=r}return n.apply(this,arguments)}}function pg(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function mg(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return n.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?n.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var uV=Object.freeze({__proto__:null,removeExtmapAllowMixed:kx,shimAddIceCandidateNullOrEmpty:pg,shimConnectionState:Cx,shimMaxMessageSize:hg,shimParameterlessSetLocalDescription:mg,shimRTCIceCandidate:dg,shimRTCIceCandidateRelayProtocol:wx,shimSendThrowTypeError:fg});function dV(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=$O,i=oV(e),s={browserDetails:i,commonShim:uV,extractVersion:xh,disableLog:sV,disableWarnings:rV,sdp:cV};switch(i.browser){case"chrome":if(!nP||!Sx||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=nP,pg(e,i),mg(e),HO(e,i),VO(e),Sx(e,i),WO(e),XO(e,i),GO(e),KO(e),QO(e,i),dg(e),wx(e),Cx(e),hg(e,i),fg(e),kx(e,i);break;case"firefox":if(!iP||!xx||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=iP,pg(e,i),mg(e),JO(e,i),xx(e,i),ZO(e),n5(e),e5(e),t5(e),i5(e),s5(e),r5(e),o5(e),a5(e),dg(e),Cx(e),hg(e,i),fg(e);break;case"safari":if(!sP||!t.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=sP,pg(e,i),mg(e),f5(e),m5(e),u5(e),l5(e),c5(e),p5(e),d5(e),g5(e),dg(e),wx(e),hg(e,i),fg(e),kx(e,i);break;default:n("Unsupported browser!");break}return s}dV({window:typeof window>"u"?void 0:window});class qi extends Promise{constructor(t){super(t)}catch(t){return super.catch(t)}static reject(t){return super.reject(t)}static all(t){return super.all(t)}static race(t){return super.race(t)}}const hV=/version\/(\d+(\.?_?\d+)+)/i;let S0;function Vi(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(S0===void 0||t){const i=fV.find(s=>{let{test:r}=s;return r.test(n)});S0=i?.describe(n)}return S0}const fV=[{test:/firefox|iceweasel|fxios/i,describe(e){return{name:"Firefox",version:gg(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:x0(e)}}},{test:/chrom|crios|crmo/i,describe(e){return{name:"Chrome",version:gg(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e),os:e.toLowerCase().includes("crios")?"iOS":void 0,osVersion:x0(e)}}},{test:/safari|applewebkit/i,describe(e){return{name:"Safari",version:gg(hV,e),os:e.includes("mobile/")?"iOS":"macOS",osVersion:x0(e)}}}];function gg(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=t.match(e);return i&&i.length>=n&&i[n]||""}function x0(e){return e.includes("mac os")?gg(/\(.+?(\d+_\d+(:?_\d+)?)/,e,1).replace(/_/g,"."):void 0}var pV="2.17.0";const mV=pV,gV=16;class Kr extends Error{constructor(t,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=t}}var Ht;(function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest",e[e.Timeout=5]="Timeout",e[e.WebSocket=6]="WebSocket",e[e.ServiceNotFound=7]="ServiceNotFound"})(Ht||(Ht={}));class ze extends Kr{constructor(t,n,i,s){super(1,t),this.name="ConnectionError",this.status=i,this.reason=n,this.context=s,this.reasonName=Ht[n]}static notAllowed(t,n,i){return new ze(t,Ht.NotAllowed,n,i)}static timeout(t){return new ze(t,Ht.Timeout)}static leaveRequest(t,n){return new ze(t,Ht.LeaveRequest,void 0,n)}static internal(t,n){return new ze(t,Ht.InternalError,void 0,n)}static cancelled(t){return new ze(t,Ht.Cancelled)}static serverUnreachable(t,n){return new ze(t,Ht.ServerUnreachable,n)}static websocket(t,n,i){return new ze(t,Ht.WebSocket,n,i)}static serviceNotFound(t,n){return new ze(t,Ht.ServiceNotFound,void 0,n)}}class ek extends Kr{constructor(t){super(21,t??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Ao extends Kr{constructor(t){super(20,t??"track is invalid"),this.name="TrackInvalidError"}}class vV extends Kr{constructor(t){super(10,t??"unsupported server"),this.name="UnsupportedServer"}}class yn extends Kr{constructor(t){super(12,t??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Su extends Kr{constructor(t){super(13,t??"unable to negotiate"),this.name="NegotiationError"}}class oP extends Kr{constructor(t,n){super(15,t),this.name="PublishTrackError",this.status=n}}class aP extends Kr{constructor(t,n){super(15,t),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:JC[n]}}var Ci;(function(e){e[e.AlreadyOpened=0]="AlreadyOpened",e[e.AbnormalEnd=1]="AbnormalEnd",e[e.DecodeFailed=2]="DecodeFailed",e[e.LengthExceeded=3]="LengthExceeded",e[e.Incomplete=4]="Incomplete",e[e.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",e[e.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Ci||(Ci={}));class As extends Kr{constructor(t,n){super(16,t),this.name="DataStreamError",this.reason=n,this.reasonName=Ci[n]}}class Kc extends Kr{constructor(t){super(18,t),this.name="SignalReconnectError"}}var rv;(function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"})(rv||(rv={}));(function(e){function t(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?e.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?e.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?e.DeviceInUse:e.Other}e.getFailure=t})(rv||(rv={}));class ri{}ri.setTimeout=function(){return setTimeout(...arguments)};ri.setInterval=function(){return setInterval(...arguments)};ri.clearTimeout=function(){return clearTimeout(...arguments)};ri.clearInterval=function(){return clearInterval(...arguments)};var ge;(function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.Moved="moved",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.ParticipantAttributesChanged="participantAttributesChanged",e.ParticipantActive="participantActive",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.VideoPlaybackStatusChanged="videoPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ActiveDeviceChanged="activeDeviceChanged",e.ChatMessage="chatMessage",e.LocalTrackSubscribed="localTrackSubscribed",e.MetricsReceived="metricsReceived"})(ge||(ge={}));var Te;(function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackCpuConstrained="localTrackCpuConstrained",e.LocalSenderCreated="localSenderCreated",e.ParticipantMetadataChanged="participantMetadataChanged",e.ParticipantNameChanged="participantNameChanged",e.DataReceived="dataReceived",e.SipDTMFReceived="sipDTMFReceived",e.TranscriptionReceived="transcriptionReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.TrackCpuConstrained="trackCpuConstrained",e.MediaDevicesError="mediaDevicesError",e.AudioStreamAcquired="audioStreamAcquired",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.PCTrackAdded="pcTrackAdded",e.AttributesChanged="attributesChanged",e.LocalTrackSubscribed="localTrackSubscribed",e.ChatMessage="chatMessage",e.Active="active"})(Te||(Te={}));var ke;(function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.SignalRestarted="signalRestarted",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e.RTPVideoMapUpdate="rtpVideoMapUpdate",e.DCBufferStatusChanged="dcBufferStatusChanged",e.ParticipantUpdate="participantUpdate",e.RoomUpdate="roomUpdate",e.SpeakersChanged="speakersChanged",e.StreamStateChanged="streamStateChanged",e.ConnectionQualityUpdate="connectionQualityUpdate",e.SubscriptionError="subscriptionError",e.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",e.RemoteMute="remoteMute",e.SubscribedQualityUpdate="subscribedQualityUpdate",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalTrackSubscribed="localTrackSubscribed",e.Offline="offline",e.SignalRequestResponse="signalRequestResponse",e.SignalConnected="signalConnected",e.RoomMoved="roomMoved"})(ke||(ke={}));var xe;(function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.CpuConstrained="cpuConstrained",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.VideoPlaybackStarted="videoPlaybackStarted",e.VideoPlaybackFailed="videoPlaybackFailed",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e.SubscriptionFailed="subscriptionFailed",e.TrackProcessorUpdate="trackProcessorUpdate",e.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",e.TranscriptionReceived="transcriptionReceived",e.TimeSyncUpdate="timeSyncUpdate",e.PreConnectBufferFlushed="preConnectBufferFlushed"})(xe||(xe={}));function yV(e){return typeof e>"u"?e:typeof structuredClone=="function"?typeof e=="object"&&e!==null?structuredClone(Object.assign({},e)):structuredClone(e):JSON.parse(JSON.stringify(e))}class zt{constructor(t,n,i,s,r){if(typeof t=="object")this.width=t.width,this.height=t.height,this.aspectRatio=t.aspectRatio,this.encoding={maxBitrate:t.maxBitrate,maxFramerate:t.maxFramerate,priority:t.priority};else if(n!==void 0&&i!==void 0)this.width=t,this.height=n,this.aspectRatio=t/n,this.encoding={maxBitrate:i,maxFramerate:s,priority:r};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const bV=["vp8","h264"],_V=["vp8","h264","vp9","av1","h265"];function SV(e){return!!bV.find(t=>t===e)}const xV=SV;var lP;(function(e){e[e.PREFER_REGRESSION=0]="PREFER_REGRESSION",e[e.SIMULCAST=1]="SIMULCAST",e[e.REGRESSION=2]="REGRESSION"})(lP||(lP={}));var Tx;(function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:24e3},e.music={maxBitrate:48e3},e.musicStereo={maxBitrate:64e3},e.musicHighQuality={maxBitrate:96e3},e.musicHighQualityStereo={maxBitrate:128e3}})(Tx||(Tx={}));const cf={h90:new zt(160,90,9e4,20),h180:new zt(320,180,16e4,20),h216:new zt(384,216,18e4,20),h360:new zt(640,360,45e4,20),h540:new zt(960,540,8e5,25),h720:new zt(1280,720,17e5,30),h1080:new zt(1920,1080,3e6,30),h1440:new zt(2560,1440,5e6,30),h2160:new zt(3840,2160,8e6,30)},Ex={h120:new zt(160,120,7e4,20),h180:new zt(240,180,125e3,20),h240:new zt(320,240,14e4,20),h360:new zt(480,360,33e4,20),h480:new zt(640,480,5e5,20),h540:new zt(720,540,6e5,25),h720:new zt(960,720,13e5,30),h1080:new zt(1440,1080,23e5,30),h1440:new zt(1920,1440,38e5,30)},tk={h360fps3:new zt(640,360,2e5,3,"medium"),h360fps15:new zt(640,360,4e5,15,"medium"),h720fps5:new zt(1280,720,8e5,5,"medium"),h720fps15:new zt(1280,720,15e5,15,"medium"),h720fps30:new zt(1280,720,2e6,30,"medium"),h1080fps15:new zt(1920,1080,25e5,15,"medium"),h1080fps30:new zt(1920,1080,5e6,30,"medium"),original:new zt(0,0,7e6,30,"medium")};function y5(e,t,n){var i,s,r,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:u}=S5(e??{}),h=t?.processor,f=n?.processor,m=a??{};return m.audio===!0&&(m.audio={}),m.video===!0&&(m.video={}),m.audio&&(Rx(m.audio,t),(i=(r=m.audio).deviceId)!==null&&i!==void 0||(r.deviceId={ideal:"default"}),(c||h)&&(m.audio.processor=c??h)),m.video&&(Rx(m.video,n),(s=(o=m.video).deviceId)!==null&&s!==void 0||(o.deviceId={ideal:"default"}),(u||f)&&(m.video.processor=u??f)),m}function Rx(e,t){return Object.keys(t).forEach(n=>{e[n]===void 0&&(e[n]=t[n])}),e}function nk(e){var t,n,i,s;const r={};if(e.video)if(typeof e.video=="object"){const o={},a=o,c=e.video;Object.keys(c).forEach(u=>{switch(u){case"resolution":Rx(a,c.resolution);break;default:a[u]=c[u]}}),r.video=o,(t=(i=r.video).deviceId)!==null&&t!==void 0||(i.deviceId={ideal:"default"})}else r.video=e.video?{deviceId:{ideal:"default"}}:!1;else r.video=!1;return e.audio?typeof e.audio=="object"?(r.audio=e.audio,(n=(s=r.audio).deviceId)!==null&&n!==void 0||(s.deviceId={ideal:"default"})):r.audio={deviceId:{ideal:"default"}}:r.audio=!1,r}function b5(e){return K(this,arguments,void 0,function(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const i=_5();if(i){const s=i.createAnalyser();s.fftSize=2048;const r=s.frequencyBinCount,o=new Uint8Array(r);i.createMediaStreamSource(new MediaStream([t.mediaStreamTrack])).connect(s),yield oi(n),s.getByteTimeDomainData(o);const c=o.some(u=>u!==128&&u!==0);return i.close(),!c}return!1})()})}function _5(){var e;const t=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(t){const n=new t({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((e=window.document)===null||e===void 0)&&e.body)){const i=()=>K(this,void 0,void 0,function*(){var s;try{n.state==="suspended"&&(yield n.resume())}catch(r){console.warn("Error trying to auto-resume audio context",r)}finally{(s=window.document.body)===null||s===void 0||s.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var s;n.state==="closed"&&((s=window.document.body)===null||s===void 0||s.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function wV(e){return e==="audioinput"?pe.Source.Microphone:e==="videoinput"?pe.Source.Camera:pe.Source.Unknown}function Mx(e){return e===pe.Source.Microphone?"audioinput":e===pe.Source.Camera?"videoinput":void 0}function CV(e){var t,n;let i=(t=e.video)!==null&&t!==void 0?t:!0;return e.resolution&&e.resolution.width>0&&e.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Wl()?i=Object.assign(Object.assign({},i),{width:{max:e.resolution.width},height:{max:e.resolution.height},frameRate:e.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:e.resolution.width},height:{ideal:e.resolution.height},frameRate:e.resolution.frameRate})),{audio:(n=e.audio)!==null&&n!==void 0?n:!1,video:i,controller:e.controller,selfBrowserSurface:e.selfBrowserSurface,surfaceSwitching:e.surfaceSwitching,systemAudio:e.systemAudio,preferCurrentTab:e.preferCurrentTab}}function Oh(e){return e.split("/")[1].toLowerCase()}function kV(e){const t=[];return e.forEach(n=>{n.track!==void 0&&t.push(new GC({cid:n.track.mediaStreamID,track:n.trackInfo}))}),t}function pt(e){return"mediaStreamTrack"in e?{trackID:e.sid,source:e.source,muted:e.isMuted,enabled:e.mediaStreamTrack.enabled,kind:e.kind,streamID:e.mediaStreamID,streamTrackID:e.mediaStreamTrack.id}:{trackID:e.trackSid,enabled:e.isEnabled,muted:e.isMuted,trackInfo:Object.assign({mimeType:e.mimeType,name:e.trackName,encrypted:e.isEncrypted,kind:e.kind,source:e.source},e.track?pt(e.track):{})}}function TV(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function EV(e,t){var n;e===void 0&&(e={}),t===void 0&&(t={});const i=[...Object.keys(t),...Object.keys(e)],s={};for(const r of i)e[r]!==t[r]&&(s[r]=(n=t[r])!==null&&n!==void 0?n:"");return s}function S5(e){const t=Object.assign({},e);let n,i;return typeof t.audio=="object"&&t.audio.processor&&(n=t.audio.processor,t.audio=Object.assign(Object.assign({},t.audio),{processor:void 0})),typeof t.video=="object"&&t.video.processor&&(i=t.video.processor,t.video=Object.assign(Object.assign({},t.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:yV(t)}}function RV(e){switch(e){case En.CAMERA:return pe.Source.Camera;case En.MICROPHONE:return pe.Source.Microphone;case En.SCREEN_SHARE:return pe.Source.ScreenShare;case En.SCREEN_SHARE_AUDIO:return pe.Source.ScreenShareAudio;default:return pe.Source.Unknown}}function cP(e,t){return e.width*e.height<t.width*t.height}function MV(e,t){var n;return(n=e.layers)===null||n===void 0?void 0:n.find(i=>i.quality===t)}const AV=5e3,eh=[];var cs;(function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH"})(cs||(cs={}));class pe extends Gr.EventEmitter{get streamState(){return this._streamState}setStreamState(t){this._streamState=t}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var s;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=pe.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=nt,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),AV):this.handleAppVisibilityChanged()},this.log=Oo((s=i.loggerName)!==null&&s!==void 0?s:cr.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=pe.Source.Unknown}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),pt(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let n="audio";this.kind===pe.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===pe.Kind.Video&&this.addAppVisibilityListener(),t||(n==="audio"&&(eh.forEach(r=>{r.parentElement===null&&!t&&(t=r)}),t&&eh.splice(eh.indexOf(t),1)),t||(t=document.createElement(n))),this.attachedElements.includes(t)||this.attachedElements.push(t),fu(this.mediaStreamTrack,t);const i=t.srcObject.getTracks(),s=i.some(r=>r.kind==="audio");return t.play().then(()=>{this.emit(s?xe.AudioPlaybackStarted:xe.VideoPlaybackStarted)}).catch(r=>{r.name==="NotAllowedError"?this.emit(s?xe.AudioPlaybackFailed:xe.VideoPlaybackFailed,r):r.name==="AbortError"?nt.debug("".concat(s?"audio":"video"," playback aborted, likely due to new play request")):nt.warn("could not playback ".concat(s?"audio":"video"),r),s&&t&&i.some(o=>o.kind==="video")&&r.name==="NotAllowedError"&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(xe.ElementAttached,t),t}detach(t){try{if(t){xu(this.mediaStreamTrack,t);const i=this.attachedElements.indexOf(t);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(t),this.emit(xe.ElementDetached,t)),t}const n=[];return this.attachedElements.forEach(i=>{xu(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(xe.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(t){t.loggerName&&(this.log=Oo(t.loggerName)),t.loggerContextCb&&(this.loggerContextCb=t.loggerContextCb)}recycleElement(t){if(t instanceof HTMLAudioElement){let n=!0;t.pause(),eh.forEach(i=>{i.parentElement||(n=!1)}),n&&eh.push(t)}}handleAppVisibilityChanged(){return K(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===pe.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(t=>t.play().catch(()=>{})),0)})}addAppVisibilityListener(){Hi()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Hi()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function fu(e,t){let n;t.srcObject instanceof MediaStream?n=t.srcObject:n=new MediaStream;let i;e.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(e)||(i.forEach(s=>{n.removeTrack(s)}),n.addTrack(e)),(!Wl()||!(t instanceof HTMLVideoElement))&&(t.autoplay=!0),t.muted=n.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(Wl()||Vl())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=n,t.play().catch(()=>{})},0))}function xu(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}(function(e){let t;(function(u){u.Audio="audio",u.Video="video",u.Unknown="unknown"})(t=e.Kind||(e.Kind={}));let n;(function(u){u.Camera="camera",u.Microphone="microphone",u.ScreenShare="screen_share",u.ScreenShareAudio="screen_share_audio",u.Unknown="unknown"})(n=e.Source||(e.Source={}));let i;(function(u){u.Active="active",u.Paused="paused",u.Unknown="unknown"})(i=e.StreamState||(e.StreamState={}));function s(u){switch(u){case t.Audio:return er.AUDIO;case t.Video:return er.VIDEO;default:return er.DATA}}e.kindToProto=s;function r(u){switch(u){case er.AUDIO:return t.Audio;case er.VIDEO:return t.Video;default:return t.Unknown}}e.kindFromProto=r;function o(u){switch(u){case n.Camera:return En.CAMERA;case n.Microphone:return En.MICROPHONE;case n.ScreenShare:return En.SCREEN_SHARE;case n.ScreenShareAudio:return En.SCREEN_SHARE_AUDIO;default:return En.UNKNOWN}}e.sourceToProto=o;function a(u){switch(u){case En.CAMERA:return n.Camera;case En.MICROPHONE:return n.Microphone;case En.SCREEN_SHARE:return n.ScreenShare;case En.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}e.sourceFromProto=a;function c(u){switch(u){case vx.ACTIVE:return i.Active;case vx.PAUSED:return i.Paused;default:return i.Unknown}}e.streamStateFromProto=c})(pe||(pe={}));const PV="|",uP="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function LV(e){const t=e.split(PV);return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}function oi(e){return new qi(t=>ri.setTimeout(t,e))}function Ax(){return"addTransceiver"in RTCPeerConnection.prototype}function Px(){return"addTrack"in RTCPeerConnection.prototype}function NV(){if(!("getCapabilities"in RTCRtpSender)||Wl()||Vl())return!1;const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e){for(const n of e.codecs)if(n.mimeType.toLowerCase()==="video/av1"){t=!0;break}}return t}function IV(){if(!("getCapabilities"in RTCRtpSender)||Vl())return!1;if(Wl()){const n=Vi();if(n?.version&&$r(n.version,"16")<0||n?.os==="iOS"&&n?.osVersion&&$r(n.osVersion,"16")<0)return!1}const e=RTCRtpSender.getCapabilities("video");let t=!1;if(e){for(const n of e.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){t=!0;break}}return t}function nr(e){return e==="av1"||e==="vp9"}function Lx(e){return!document||uf()?!1:(e||(e=document.createElement("audio")),"setSinkId"in e)}function DV(){return typeof RTCPeerConnection>"u"?!1:Ax()||Px()}function Vl(){var e;return((e=Vi())===null||e===void 0?void 0:e.name)==="Firefox"}function dP(){const e=Vi();return!!e&&e.name==="Chrome"&&e.os!=="iOS"}function Wl(){var e;return((e=Vi())===null||e===void 0?void 0:e.name)==="Safari"}function uf(){const e=Vi();return e?.name==="Safari"||e?.os==="iOS"}function OV(){const e=Vi();return e?.name==="Safari"&&e.version.startsWith("17.")||e?.os==="iOS"&&!!e?.osVersion&&$r(e.osVersion,"17")>=0}function jV(e){return e||(e=Vi()),e?.name==="Safari"&&$r(e.version,"18.3")>0||e?.os==="iOS"&&!!e?.osVersion&&$r(e.osVersion,"18.3")>0}function x5(){var e,t;return Hi()?(t=(e=navigator.userAgentData)===null||e===void 0?void 0:e.mobile)!==null&&t!==void 0?t:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function BV(){const e=Vi(),t="17.2";if(e)return e.name!=="Safari"&&e.os!=="iOS"||e.os==="iOS"&&e.osVersion&&$r(e.osVersion,t)>=0?!0:e.name==="Safari"&&$r(e.version,t)>=0}function Hi(){return typeof document<"u"}function zr(){return navigator.product=="ReactNative"}function Nu(e){return e.hostname.endsWith(".livekit.cloud")||e.hostname.endsWith(".livekit.run")}function w0(e){return Nu(e)?e.hostname.split(".")[0]:null}function w5(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function C5(){if(!zr())return;let e=w5();if(e)return e.platform}function hP(){if(Hi())return window.devicePixelRatio;if(zr()){let e=w5();if(e)return e.devicePixelRatio}return 1}function $r(e,t){const n=e.split("."),i=t.split("."),s=Math.min(n.length,i.length);for(let r=0;r<s;++r){const o=parseInt(n[r],10),a=parseInt(i[r],10);if(o>a)return 1;if(o<a)return-1;if(r===s-1&&o===a)return 0}return e===""&&t!==""?-1:t===""?1:n.length==i.length?0:n.length<i.length?-1:1}function FV(e){for(const t of e)t.target.handleResize(t)}function UV(e){for(const t of e)t.target.handleVisibilityChanged(t)}let C0=null;const fP=()=>(C0||(C0=new ResizeObserver(FV)),C0);let k0=null;const pP=()=>(k0||(k0=new IntersectionObserver(UV,{root:null,rootMargin:"0px"})),k0);function zV(){var e;const t=new CO({sdk:kO.JS,protocol:gV,version:mV});return zr()&&(t.os=(e=C5())!==null&&e!==void 0?e:""),t}function mP(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const s=document.createElement("canvas");s.width=e,s.height=t;const r=s.getContext("2d");r?.fillRect(0,0,s.width,s.height),i&&r&&(r.beginPath(),r.arc(e/2,t/2,50,0,Math.PI*2,!0),r.closePath(),r.fillStyle="grey",r.fill());const o=s.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let th;function T0(){if(!th){const e=new AudioContext,t=e.createOscillator(),n=e.createGain();n.gain.setValueAtTime(0,0);const i=e.createMediaStreamDestination();if(t.connect(n),n.connect(i),t.start(),[th]=i.stream.getAudioTracks(),!th)throw Error("Could not get empty media stream audio track");th.enabled=!1}return th.clone()}class Bs{get isResolved(){return this._isResolved}constructor(t,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,s)=>K(this,void 0,void 0,function*(){this.resolve=i,this.reject=s,t&&(yield t(i,s))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function $V(e){return _V.includes(e)}function Ia(e){if(typeof e=="string"||typeof e=="number")return e;if(Array.isArray(e))return e[0];if(e.exact!==void 0)return Array.isArray(e.exact)?e.exact[0]:e.exact;if(e.ideal!==void 0)return Array.isArray(e.ideal)?e.ideal[0]:e.ideal;throw Error("could not unwrap constraint")}function qV(e){return e.startsWith("http")?e.replace(/^(http)/,"ws"):e}function df(e){return e.startsWith("ws")?e.replace(/^(ws)/,"http"):e}function HV(e,t){return e.segments.map(n=>{let{id:i,text:s,language:r,startTime:o,endTime:a,final:c}=n;var u;const h=(u=t.get(i))!==null&&u!==void 0?u:Date.now(),f=Date.now();return c?t.delete(i):t.set(i,h),{id:i,text:s,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:r,firstReceivedTime:h,lastReceivedTime:f}})}function VV(e){const{id:t,timestamp:n,message:i,editTimestamp:s}=e;return{id:t,timestamp:Number.parseInt(n.toString()),editTimestamp:s?Number.parseInt(s.toString()):void 0,message:i}}function gP(e){switch(e.reason){case Ht.LeaveRequest:return e.context;case Ht.Cancelled:return sr.CLIENT_INITIATED;case Ht.NotAllowed:return sr.USER_REJECTED;case Ht.ServerUnreachable:return sr.JOIN_FAILURE;default:return sr.UNKNOWN_REASON}}function vg(e){return e!==void 0?Number(e):void 0}function xl(e){return e!==void 0?BigInt(e):void 0}function wu(e){return!!e&&!(e instanceof MediaStreamTrack)&&e.isLocal}function Dr(e){return!!e&&e.kind==pe.Kind.Audio}function qa(e){return!!e&&e.kind==pe.Kind.Video}function fa(e){return wu(e)&&qa(e)}function So(e){return wu(e)&&Dr(e)}function Nx(e){return!!e&&!e.isLocal}function WV(e){return!!e&&!e.isLocal}function E0(e){return Nx(e)&&qa(e)}function GV(e){return e.isLocal}function KV(e,t){const n=[];let i=new TextEncoder().encode(e);for(;i.length>t;){let s=t;for(;s>0;){const r=i[s];if(r!==void 0&&(r&192)!==128)break;s--}n.push(i.slice(0,s)),i=i.slice(s)}return i.length>0&&n.push(i),n}function YV(e){var t;const n=e.get("Cache-Control");if(n){const i=(t=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||t===void 0?void 0:t[1];if(i)return parseInt(i,10)}}function XV(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=QV(e,t);return n?i:ik(i,"v1")}function QV(e,t){const n=new URL(qV(e));return t.forEach((i,s)=>{n.searchParams.set(s,i)}),ik(n,"rtc")}function JV(e){const t=new URL(df(e));return ik(t,"validate")}function k5(e){return e.endsWith("/")?e:"".concat(e,"/")}function ik(e,t){return e.pathname="".concat(k5(e.pathname)).concat(t),e}function vP(e){if(typeof e=="string")return YA.fromJson(JSON.parse(e),{ignoreUnknownFields:!0});if(e instanceof ArrayBuffer)return YA.fromBinary(new Uint8Array(e));throw new Error("could not decode websocket message: ".concat(typeof e))}function ZV(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(e instanceof AbortSignal))return t;const n=e.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:t;default:return"toString"in n?n.toString():t}}const eW=10,nh="lk_e2ee",tW="LKFrameEncryptionKey",nW={sharedKey:!1,ratchetSalt:tW,ratchetWindowSize:8,failureTolerance:eW,keyringSize:16};var Da;(function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"})(Da||(Da={}));var yP;(function(e){e.KeyRatcheted="keyRatcheted"})(yP||(yP={}));var Ra;(function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"})(Ra||(Ra={}));var bP;(function(e){e.Error="cryptorError"})(bP||(bP={}));function iW(){return sW()||Ix()}function Ix(){return typeof window.RTCRtpScriptTransform<"u"}function sW(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function rW(e){var t,n,i,s,r;if(((t=e.value)===null||t===void 0?void 0:t.case)!=="sipDtmf"&&((n=e.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=e.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((s=e.value)===null||s===void 0?void 0:s.case)!=="transcription"&&((r=e.value)===null||r===void 0?void 0:r.case)!=="encryptedPacket")return new vO({value:e.value})}class ySe extends Gr.EventEmitter{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,s)=>{nt.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:s})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},nW),t),this.on(Da.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(t,n,i){const s={key:t,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),s),this.emit(Da.SetKey,s)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(t,n){this.emit(Da.RatchetRequest,t,n)}}var _P;(function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"})(_P||(_P={}));class oW extends Gr.EventEmitter{constructor(t,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var s,r;const{kind:o,data:a}=i.data;switch(o){case"error":if(nt.error(a.error.message),a.uuid){const h=this.decryptDataRequests.get(a.uuid);if(h?.reject){h.reject(a.error);break}const f=this.encryptDataRequests.get(a.uuid);if(f?.reject){f.reject(a.error);break}}this.emit(Ra.EncryptionError,a.error,a.participantIdentity);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(h=>{this.postKey(h)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(h=>{this.postKey(h)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity))this.emit(Ra.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const h=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(a.participantIdentity);if(!h)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(Ra.ParticipantEncryptionStatusChanged,a.enabled,h)}break;case"ratchetKey":this.keyProvider.emit(Da.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(a.uuid);c?.resolve&&c.resolve(a);break;case"encryptDataResponse":const u=this.encryptDataRequests.get(a.uuid);u?.resolve&&u.resolve(a);break}},this.onWorkerError=i=>{nt.error("e2ee worker encountered an error:",{error:i.error}),this.emit(Ra.EncryptionError,i.error,void 0)},this.keyProvider=t.keyProvider,this.worker=t.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(t){if(!iW())throw new ek("tried to setup end-to-end encryption on an unsupported browser");if(nt.info("setting up e2ee"),t!==this.room){this.room=t,this.setupEventListeners(t,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Z9.getLevel()}};this.worker&&(nt.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(t,n){nt.debug("set e2ee to ".concat(t," for participant ").concat(n)),this.postEnable(t,n)}setSifTrailer(t){!t||t.length===0?nt.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(t)}setupEngine(t){t.on(ke.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(t,n){t.on(ge.TrackPublished,(i,s)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==On.NONE,s.identity)),t.on(ge.ConnectionStateChanged,i=>{i===Mt.Connected&&t.remoteParticipants.forEach(s=>{s.trackPublications.forEach(r=>{this.setParticipantCryptorEnabled(r.trackInfo.encryption!==On.NONE,s.identity)})})}).on(ge.TrackUnsubscribed,(i,s,r)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:r.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(ge.TrackSubscribed,(i,s,r)=>{this.setupE2EEReceiver(i,r.identity,s.trackInfo)}).on(ge.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),t.localParticipant.on(Te.LocalSenderCreated,(i,s)=>K(this,void 0,void 0,function*(){this.setupE2EESender(s,i)})),t.localParticipant.on(Te.LocalTrackPublished,i=>{if(!qa(i.track)||!uf())return;const s={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:Oh(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(s)}),n.on(Da.SetKey,i=>this.postKey(i)).on(Da.RatchetRequest,(i,s)=>this.postRatchetRequest(i,s))}encryptData(t){return K(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:t,participantIdentity:this.room.localParticipant.identity}},s=new Bs;return s.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,s),this.worker.postMessage(i),s.promise})}handleEncryptedData(t,n,i,s){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const r=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:r,payload:t,iv:n,participantIdentity:i,keyIndex:s}},a=new Bs;return a.onFinally=()=>{this.decryptDataRequests.delete(r)},this.decryptDataRequests.set(r,a),this.worker.postMessage(o),a.promise}postRatchetRequest(t,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:t,keyIndex:n}};this.worker.postMessage(i)}postKey(t){let{key:n,participantIdentity:i,keyIndex:s}=t;var r;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity),key:n,keyIndex:s}};this.worker.postMessage(o)}postEnable(t,n){if(this.worker){const i={kind:"enable",data:{enabled:t,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(t){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(t){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:t}};this.worker.postMessage(n)}setupE2EEReceiver(t,n,i){if(t.receiver){if(!i?.mimeType||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(t.receiver,t.mediaStreamID,n,t.kind==="video"?Oh(i.mimeType):void 0)}}setupE2EESender(t,n){if(!wu(t)||!n){n||nt.warn("early return because sender is not ready");return}this.handleSender(n,t.mediaStreamID,void 0)}handleReceiver(t,n,i,s){return K(this,void 0,void 0,function*(){if(this.worker){if(Ix()&&!dP()){const r={kind:"decode",participantIdentity:i,trackId:n,codec:s};t.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(nh in t&&s){const c={kind:"updateCodec",data:{trackId:n,codec:s,participantIdentity:i}};this.worker.postMessage(c);return}let r=t.writableStream,o=t.readableStream;if(!r||!o){const c=t.createEncodedStreams();t.writableStream=c.writable,r=c.writable,t.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:r,trackId:n,codec:s,participantIdentity:i,isReuse:nh in t}};this.worker.postMessage(a,[o,r])}t[nh]=!0}})}handleSender(t,n,i){var s;if(!(nh in t||!this.worker)){if(!(!((s=this.room)===null||s===void 0)&&s.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Ix()&&!dP()){nt.info("initialize script transform");const r={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};t.transform=new RTCRtpScriptTransform(this.worker,r)}else{nt.info("initialize encoded streams");const r=t.createEncodedStreams(),o={kind:"encode",data:{readableStream:r.readable,writableStream:r.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[r.readable,r.writable])}t[nh]=!0}}}const aW=500,lW=15e3;class Cu{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new Cu),this._instance}addFailedConnectionAttempt(t){var n;const i=new URL(t),s=w0(i);if(!s)return;let r=(n=this.failedConnectionAttempts.get(s))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(s,r+1),this.backOffPromises.set(s,oi(Math.min(aW*Math.pow(2,r),lW)))}getBackOffPromise(t){const n=new URL(t),i=n&&w0(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(t){const n=new URL(t),i=n&&w0(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}Cu._instance=null;const R0="default";class Gn{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Gn),this.instance}get previousDevices(){return this._previousDevices}getDevices(t){return K(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var r;if(((r=Gn.userMediaPromiseMap)===null||r===void 0?void 0:r.size)>0){nt.debug("awaiting getUserMedia promise");try{n?yield Gn.userMediaPromiseMap.get(n):yield Promise.all(Gn.userMediaPromiseMap.values())}catch{nt.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(s&&!(Wl()&&i.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const u=c.label==="",h=n?c.kind===n:!0;return u&&h}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},u=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),u.getTracks().forEach(h=>{h.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o})()})}normalizeDeviceId(t,n,i){return K(this,void 0,void 0,function*(){if(n!==R0)return n;const s=yield this.getDevices(t),r=s.find(a=>a.deviceId===R0);if(!r){nt.warn("could not reliably determine default device");return}const o=s.find(a=>a.deviceId!==R0&&a.groupId===(i??r.groupId));if(!o){nt.warn("could not reliably determine default device");return}return o?.deviceId})}hasDeviceInUse(t){return t?Gn.userMediaPromiseMap.has(t):Gn.userMediaPromiseMap.size>0}}Gn.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Gn.userMediaPromiseMap=new Map;var jh;(function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"})(jh||(jh={}));class cW{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ei,this.nextTaskIndex=0}run(t){return K(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:jh.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=jh.RUNNING,yield t()}finally{n.status=jh.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return K(this,void 0,void 0,function*(){return this.run(()=>K(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class uW{get readyState(){return this.ws.readyState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,s;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=t;const r=new WebSocket(t,(s=n.protocols)!==null&&s!==void 0?s:[]);r.binaryType="arraybuffer",this.ws=r;const o=function(){let{closeCode:a,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r.close(a,c)};this.opened=new qi((a,c)=>{const u=()=>{c(ze.websocket("Encountered websocket error during connection establishment"))};r.onopen=()=>{a({readable:new ReadableStream({start(h){r.onmessage=f=>{let{data:m}=f;return h.enqueue(m)},r.onerror=f=>h.error(f)},cancel:o}),writable:new WritableStream({write(h){r.send(h)},abort(){r.close()},close:o}),protocol:r.protocol,extensions:r.extensions}),r.removeEventListener("error",u)},r.addEventListener("error",u)}),this.closed=new qi((a,c)=>{const u=()=>K(this,void 0,void 0,function*(){const h=new qi(m=>{r.readyState!==WebSocket.CLOSED&&r.addEventListener("close",y=>{m(y)},{once:!0})}),f=yield qi.race([oi(250),h]);f?a(f):c(ze.websocket("Encountered unspecified websocket error without a timely close event"))});r.onclose=h=>{let{code:f,reason:m}=h;a({closeCode:f,reason:m}),r.removeEventListener("error",u)},r.addEventListener("error",u)}),n.signal&&(n.signal.onabort=()=>r.close()),this.close=o}}const dW=["syncState","trickle","offer","answer","simulate","leave"];function hW(e){const t=dW.indexOf(e.case)>=0;return nt.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}var qt;(function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.RECONNECTING=2]="RECONNECTING",e[e.DISCONNECTING=3]="DISCONNECTING",e[e.DISCONNECTED=4]="DISCONNECTED"})(qt||(qt={}));const fW=250;class sk{get currentState(){return this.state}get isDisconnected(){return this.state===qt.DISCONNECTING||this.state===qt.DISCONNECTED}get isEstablishingConnection(){return this.state===qt.CONNECTING||this.state===qt.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=qt.DISCONNECTED,this.log=nt,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=Oo((i=n.loggerName)!==null&&i!==void 0?i:cr.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=t,this.requestQueue=new cW,this.queuedRequests=[],this.closingLock=new Ei,this.connectionLock=new Ei,this.state=qt.DISCONNECTED}get logContext(){var t,n;return(n=(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this))!==null&&n!==void 0?n:{}}join(t,n,i,s){return K(this,arguments,void 0,function(r,o,a,c){var u=this;let h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){return u.state=qt.CONNECTING,u.options=a,yield u.connect(r,o,a,c,h)})()})}reconnect(t,n,i,s){return K(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=qt.RECONNECTING,this.clearPingInterval(),yield this.connect(t,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:s}),void 0,this.useV0SignalPath)})}connect(t,n,i,s){return K(this,arguments,void 0,function(r,o,a,c){var u=this;let h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){const f=yield u.connectionLock.lock();u.connectOptions=a,u.useV0SignalPath=h;const m=zV(),y=h?pW(o,m,a):mW(o,m,a),b=XV(r,y,h).toString(),S=JV(b).toString();return new Promise((_,w)=>K(u,void 0,void 0,function*(){var M,R;try{let E=!1;const A=N=>K(this,void 0,void 0,function*(){if(E)return;E=!0;const O=N instanceof Event?N.currentTarget:N,j=ZV(O,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(j)).catch($=>{this.log.error($),this.close()}):this.close(),T(),w(ze.cancelled(j))});c?.addEventListener("abort",A);const T=()=>{clearTimeout(L),c?.removeEventListener("abort",A)},L=setTimeout(()=>{A(ze.timeout("room connection has timed out (signal)"))},a.websocketTimeout),P=(N,O)=>{this.handleSignalConnected(N,L,O)},I=new URL(b);I.searchParams.has("access_token")&&I.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(I),Object.assign({reconnect:a.reconnect,reconnectReason:a.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new uW(b);try{this.ws.closed.then(B=>{var W;this.isEstablishingConnection&&w(ze.internal("Websocket got closed during a (re)connection attempt: ".concat(B.reason))),B.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:B.reason,code:B.closeCode,wasClean:B.closeCode===1e3,state:this.state})),this.state===qt.CONNECTED&&this.handleOnClose((W=B.reason)!==null&&W!==void 0?W:"Unexpected WS error"))}).catch(B=>{this.isEstablishingConnection&&w(ze.internal("Websocket error during a (re)connection attempt: ".concat(B)))});const N=yield this.ws.opened.catch(B=>K(this,void 0,void 0,function*(){if(this.state!==qt.CONNECTED){this.state=qt.DISCONNECTED,clearTimeout(L);const W=yield this.handleConnectionError(B,S);w(W);return}this.handleWSError(B),w(B)}));if(clearTimeout(L),!N)return;const O=N.readable.getReader();this.streamWriter=N.writable.getWriter();const j=yield O.read();if(O.releaseLock(),!j.value)throw ze.internal("no message received as first message");const $=vP(j.value),V=this.validateFirstMessage($,(M=a.reconnect)!==null&&M!==void 0?M:!1);if(!V.isValid){w(V.error);return}((R=$.message)===null||R===void 0?void 0:R.case)==="join"&&(this.pingTimeoutDuration=$.message.value.pingTimeout,this.pingIntervalDuration=$.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const H=V.shouldProcessFirstMessage?$:void 0;P(N,H),_(V.response)}catch(N){w(N)}finally{T()}}finally{f()}}))})()})}startReadingLoop(t,n){return K(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield oi(this.signalLatency));const{done:i,value:s}=yield t.read();if(i)break;const r=vP(s);this.handleSignalResponse(r)}})}close(){return K(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([qt.DISCONNECTING||qt.DISCONNECTED].includes(t.state)){t.log.debug("ignoring signal close as it's already in disconnecting state");return}const s=yield t.closingLock.lock();try{if(t.clearPingInterval(),n&&(t.state=qt.DISCONNECTING),t.ws){t.ws.close({closeCode:1e3,reason:i});const r=t.ws.closed;t.ws=void 0,t.streamWriter=void 0,yield Promise.race([r,oi(fW)])}}catch(r){t.log.debug("websocket error while closing",Object.assign(Object.assign({},t.logContext),{error:r}))}finally{n&&(t.state=qt.DISCONNECTED),s()}})()})}sendOffer(t,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:t.sdp})),this.sendRequest({case:"offer",value:pu(t,n)})}sendAnswer(t,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:t.sdp})),this.sendRequest({case:"answer",value:pu(t,n)})}sendIceCandidate(t,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:t})),this.sendRequest({case:"trickle",value:new Zv({candidateInit:JSON.stringify(t),target:n})})}sendMuteTrack(t,n){return this.sendRequest({case:"mute",value:new ey({sid:t,muted:n})})}sendAddTrack(t){return this.sendRequest({case:"addTrack",value:t})}sendUpdateLocalMetadata(t,n){return K(this,arguments,void 0,function(i,s){var r=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const a=r.getNextRequestId();return yield r.sendRequest({case:"updateMetadata",value:new YC({requestId:a,metadata:i,name:s,attributes:o})}),a})()})}sendUpdateTrackSettings(t){this.sendRequest({case:"trackSetting",value:t})}sendUpdateSubscription(t){return this.sendRequest({case:"subscription",value:t})}sendSyncState(t){return this.sendRequest({case:"syncState",value:t})}sendUpdateVideoLayers(t,n){return this.sendRequest({case:"updateLayers",value:new LO({trackSid:t,layers:n})})}sendUpdateSubscriptionPermissions(t,n){return this.sendRequest({case:"subscriptionPermission",value:new DO({allParticipants:t,trackPermissions:n})})}sendSimulateScenario(t){return this.sendRequest({case:"simulate",value:t})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Jt.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new BO({timestamp:Jt.parse(Date.now()),rtt:Jt.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(t,n){return this.sendRequest({case:"updateAudioTrack",value:new KC({trackSid:t,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new ny({reason:sr.CLIENT_INITIATED,action:bu.DISCONNECT})})}sendRequest(t){return K(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!s&&!hW(n)&&i.state===qt.RECONNECTING){i.queuedRequests.push(()=>K(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(s||(yield i.requestQueue.flush()),i.signalLatency&&(yield oi(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n?.case),i.logContext);return}const o=new C9({message:n});try{i.useJSON?yield i.streamWriter.write(o.toJsonString()):yield i.streamWriter.write(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}})()})}handleSignalResponse(t){var n,i;const s=t.message;if(s==null){this.log.debug("received unsupported message",this.logContext);return}let r=!1;if(s.case==="answer"){const o=SP(s.value);this.onAnswer&&this.onAnswer(o,s.value.id,s.value.midToTrackId)}else if(s.case==="offer"){const o=SP(s.value);this.onOffer&&this.onOffer(o,s.value.id,s.value.midToTrackId)}else if(s.case==="trickle"){const o=JSON.parse(s.value.candidateInit);this.onTrickle&&this.onTrickle(o,s.value.target)}else s.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=s.value.participants)!==null&&n!==void 0?n:[]):s.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(s.value):s.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=s.value.speakers)!==null&&i!==void 0?i:[]):s.case==="leave"?this.onLeave&&this.onLeave(s.value):s.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(s.value.sid,s.value.muted):s.case==="roomUpdate"?this.onRoomUpdate&&s.value.room&&this.onRoomUpdate(s.value.room):s.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(s.value):s.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(s.value):s.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(s.value):s.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(s.value):s.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(s.value):s.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(s.value):s.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(s.value):s.case==="pong"||(s.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(s.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):s.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(s.value):s.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(s.value.trackSid):s.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(s.value.token),this.onRoomMoved&&this.onRoomMoved(s.value)):s.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(s.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:s.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const t=this.queuedRequests.shift();t&&this.requestQueue.run(t)}}handleOnClose(t){return K(this,void 0,void 0,function*(){if(this.state===qt.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,t),this.log.debug("websocket connection closed: ".concat(t),Object.assign(Object.assign({},this.logContext),{reason:t})),n&&n(t)})}handleWSError(t){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:t}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=ri.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&ri.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=ri.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&ri.clearInterval(this.pingInterval)}handleSignalConnected(t,n,i){this.state=qt.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(t.readable.getReader(),i)}validateFirstMessage(t,n){var i,s,r,o,a;return((i=t.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:t.message.value}:this.state===qt.RECONNECTING&&((s=t.message)===null||s===void 0?void 0:s.case)!=="leave"?((r=t.message)===null||r===void 0?void 0:r.case)==="reconnect"?{isValid:!0,response:t.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((o=t.message)===null||o===void 0?void 0:o.case)==="leave"?{isValid:!1,error:ze.leaveRequest("Received leave request while trying to (re)connect",t.message.value.reason)}:n?{isValid:!1,error:ze.internal("Unexpected first message")}:{isValid:!1,error:ze.internal("did not receive join response, got ".concat((a=t.message)===null||a===void 0?void 0:a.case," instead"))}}handleConnectionError(t,n){return K(this,void 0,void 0,function*(){try{const i=yield fetch(n);switch(i.status){case 404:return ze.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const s=yield i.text();return ze.notAllowed(s,i.status);default:break}return t instanceof ze?t:ze.internal("Encountered unknown websocket error during connection: ".concat(t),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof ze?i:ze.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function SP(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type;break}return t}function pu(e,t){return new Ua({sdp:e.sdp,type:e.type,id:t})}function pW(e,t,n){var i;const s=new URLSearchParams;return s.set("access_token",e),n.reconnect&&(s.set("reconnect","1"),n.sid&&s.set("sid",n.sid)),s.set("auto_subscribe",n.autoSubscribe?"1":"0"),s.set("sdk",zr()?"reactnative":"js"),s.set("version",t.version),s.set("protocol",t.protocol.toString()),t.deviceModel&&s.set("device_model",t.deviceModel),t.os&&s.set("os",t.os),t.osVersion&&s.set("os_version",t.osVersion),t.browser&&s.set("browser",t.browser),t.browserVersion&&s.set("browser_version",t.browserVersion),n.adaptiveStream&&s.set("adaptive_stream","1"),n.reconnectReason&&s.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&s.set("network",navigator.connection.type),s}function mW(e,t,n){const i=new URLSearchParams;i.set("access_token",e);const s=new W9({clientInfo:t,connectionSettings:new FO({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(s.reconnectReason=n.reconnectReason);const r=new G9({joinRequest:s.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(r.toBinary()))),i}class xP{constructor(){this.buffer=[],this._totalSize=0}push(t){this.buffer.push(t),this._totalSize+=t.data.byteLength}pop(){const t=this.buffer.shift();return t&&(this._totalSize-=t.data.byteLength),t}getAll(){return this.buffer.slice()}popToSequence(t){for(;this.buffer.length>0&&this.buffer[0].sequence<=t;)this.pop()}alignBufferedAmount(t){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=t)break;this.pop()}}get length(){return this.buffer.length}}class gW{constructor(t){this._map=new Map,this._lastCleanup=0,this.ttl=t}set(t,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const s=i+this.ttl;return this._map.set(t,{value:n,expiresAt:s}),this}get(t){const n=this._map.get(t);if(n){if(n.expiresAt<Date.now()){this._map.delete(t);return}return n.value}}has(t){const n=this._map.get(t);return n?n.expiresAt<Date.now()?(this._map.delete(t),!1):!0:!1}delete(t){return this._map.delete(t)}clear(){this._map.clear()}cleanup(){const t=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<t&&this._map.delete(n);this._lastCleanup=t}get size(){return this.cleanup(),this._map.size}forEach(t){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&t(i.value,n,this.asValueMap())}map(t){this.cleanup();const n=[],i=this.asValueMap();for(const[s,r]of i.entries())n.push(t(r,s,i));return n}asValueMap(){const t=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&t.set(n,i.value);return t}}var Ks={},M0={},A0={exports:{}},wP;function rk(){if(wP)return A0.exports;wP=1;var e=A0.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var n="candidate:%s %d %s %d %s %d typ %s";return n+=t.raddr!=null?" raddr %s rport %d":"%v%v",n+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(n+=" generation %d"),n+=t["network-id"]!=null?" network-id %d":"%v",n+=t["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var n="ssrc:%d";return t.attribute!=null&&(n+=" %s",t.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var n="mediaclk:";return n+=t.id!=null?"id=%s %s":"%v%s",n+=t.mediaClockValue!=null?"=%s":"",n+=t.rateNumerator!=null?" rate=%s":"",n+=t.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(e).forEach(function(t){var n=e[t];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),A0.exports}var CP;function vW(){return CP||(CP=1,(function(e){var t=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,u,h){if(h&&!u)c[h]=t(a[1]);else for(var f=0;f<u.length;f+=1)a[f+1]!=null&&(c[u[f]]=t(a[f+1]))},i=function(a,c,u){var h=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:h&&!c[a.name]&&(c[a.name]={});var f=a.push?{}:h?c[a.name]:c;n(u.match(a.reg),f,a.names,a.name),a.push&&c[a.push].push(f)},s=rk(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(a){var c={},u=[],h=c;return a.split(/(\r\n|\r|\n)/).filter(r).forEach(function(f){var m=f[0],y=f.slice(2);m==="m"&&(u.push({rtp:[],fmtp:[]}),h=u[u.length-1]);for(var b=0;b<(s[m]||[]).length;b+=1){var S=s[m][b];if(S.reg.test(y))return i(S,h,y)}}),c.media=u,c};var o=function(a,c){var u=c.split(/=(.+)/,2);return u.length===2?a[u[0]]=t(u[1]):u.length===1&&c.length>1&&(a[u[0]]=void 0),a};e.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(a){return a.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(a){for(var c=[],u=a.split(" ").map(t),h=0;h<u.length;h+=3)c.push({component:u[h],ip:u[h+1],port:u[h+2]});return c},e.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},e.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(u){var h,f=!1;return u[0]!=="~"?h=t(u):(h=t(u.substring(1,u.length)),f=!0),{scid:h,paused:f}})})}})(M0)),M0}var P0,kP;function yW(){if(kP)return P0;kP=1;var e=rk(),t=/%[sdv%]/g,n=function(o){var a=1,c=arguments,u=c.length;return o.replace(t,function(h){if(a>=u)return h;var f=c[a];switch(a+=1,h){case"%%":return"%";case"%s":return String(f);case"%d":return Number(f);case"%v":return""}})},i=function(o,a,c){var u=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,h=[o+"="+u];if(a.names)for(var f=0;f<a.names.length;f+=1){var m=a.names[f];a.name?h.push(c[a.name][m]):h.push(c[a.names[f]])}else h.push(c[a.name]);return n.apply(null,h)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],r=["i","c","b","a"];return P0=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(f){f.payloads==null&&(f.payloads="")});var c=a.outerOrder||s,u=a.innerOrder||r,h=[];return c.forEach(function(f){e[f].forEach(function(m){m.name in o&&o[m.name]!=null?h.push(i(f,m,o)):m.push in o&&o[m.push]!=null&&o[m.push].forEach(function(y){h.push(i(f,m,y))})})}),o.media.forEach(function(f){h.push(i("m",e.m[0],f)),u.forEach(function(m){e[m].forEach(function(y){y.name in f&&f[y.name]!=null?h.push(i(m,y,f)):y.push in f&&f[y.push]!=null&&f[y.push].forEach(function(b){h.push(i(m,y,b))})})})}),h.join(`\r
`)+`\r
`},P0}var TP;function bW(){if(TP)return Ks;TP=1;var e=vW(),t=yW(),n=rk();return Ks.grammar=n,Ks.write=t,Ks.parse=e.parse,Ks.parseParams=e.parseParams,Ks.parseFmtpConfig=e.parseFmtpConfig,Ks.parsePayloads=e.parsePayloads,Ks.parseRemoteCandidates=e.parseRemoteCandidates,Ks.parseImageAttributes=e.parseImageAttributes,Ks.parseSimulcastStreamList=e.parseSimulcastStreamList,Ks}var ba=bW();function ok(e,t,n){var i,s,r;t===void 0&&(t=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(s=n.callback)!=null&&s,c=n.maxWait,u=Date.now(),h=[];function f(){if(c!==void 0){var y=Date.now()-u;if(y+t>=c)return c-y}return t}var m=function(){var y=[].slice.call(arguments),b=this;return new Promise(function(S,_){var w=o&&r===void 0;if(r!==void 0&&clearTimeout(r),r=setTimeout(function(){if(r=void 0,u=Date.now(),!o){var R=e.apply(b,y);a&&a(R),h.forEach(function(E){return(0,E.resolve)(R)}),h=[]}},f()),w){var M=e.apply(b,y);return a&&a(M),S(M)}h.push({resolve:S,reject:_})})};return m.cancel=function(y){r!==void 0&&clearTimeout(r),h.forEach(function(b){return(0,b.reject)(y)}),h=[]},m}const _W=.7,SW=20,ku={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class EP extends Gr.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=nt,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=ok(s=>K(this,void 0,void 0,function*(){this.emit(ku.NegotiationStarted);try{yield this.createAndSendOffer()}catch(r){if(s)s(r);else throw r}}),SW),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Oo((i=n.loggerName)!==null&&i!==void 0?i:cr.PCTransport),this.loggerOptions=n,this.config=t,this._pc=this.createPC(),this.offerLock=new Ei}createPC(){const t=new RTCPeerConnection(this.config);return t.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},t.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},t.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,t.iceConnectionState)},t.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,t.signalingState)},t.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,t.connectionState)},t.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},t.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},t}get logContext(){var t,n;return Object.assign({},(n=(t=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(t))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(t){return K(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(t);this.pendingCandidates.push(t)})}setRemoteDescription(t,n){return K(this,void 0,void 0,function*(){var i;if(t.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let s;if(t.type==="offer"){let{stereoMids:r,nackMids:o}=xW(t);this.remoteStereoMids=r,this.remoteNackMids=o}else if(t.type==="answer"){const r=ba.parse((i=t.sdp)!==null&&i!==void 0?i:"");r.media.forEach(o=>{const a=ak(o.mid);o.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||a!=c.transceiver.mid)return!1;let u=0;if(o.rtp.some(f=>f.codec.toUpperCase()===c.codec.toUpperCase()?(u=f.payload,!0):!1),u===0)return!0;let h=!1;for(const f of o.fmtp)if(f.payload===u){f.config=f.config.split(";").filter(m=>!m.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(f.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),h=!0;break}return h||c.maxbr>0&&o.fmtp.push({payload:u,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),s=ba.write(r)}return yield this.setMungedSDP(t,s,!0),this.pendingCandidates.forEach(r=>{this.pc.addIceCandidate(r)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):t.type==="answer"&&(this.emit(ku.NegotiationComplete),t.sdp&&ba.parse(t.sdp).media.forEach(o=>{o.type==="video"&&this.emit(ku.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(t){return K(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(t?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(t?.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const s=this.latestOfferId+1;this.latestOfferId=s;const r=yield this.pc.createOffer(t);this.log.debug("original offer",Object.assign({sdp:r.sdp},this.logContext));const o=ba.parse((n=r.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{MP(a),a.type==="audio"?RP(a,["all"],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let u=0;if(a.rtp.some(f=>f.codec.toUpperCase()===c.codec.toUpperCase()?(u=f.payload,!0):!1),u===0||(nr(c.codec)&&!Wl()&&this.ensureVideoDDExtensionForSVC(a,o),!nr(c.codec)))return!0;const h=Math.round(c.maxbr*_W);for(const f of a.fmtp)if(f.payload===u){f.config.includes("x-google-start-bitrate")||(f.config+=";x-google-start-bitrate=".concat(h));break}return!0})}),this.latestOfferId>s){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:s}));return}yield this.setMungedSDP(r,ba.write(o)),this.onOffer(r,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return K(this,void 0,void 0,function*(){var t;const n=yield this.pc.createAnswer(),i=ba.parse((t=n.sdp)!==null&&t!==void 0?t:"");return i.media.forEach(s=>{MP(s),s.type==="audio"&&RP(s,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,ba.write(i)),n})}createDataChannel(t,n){return this.pc.createDataChannel(t,n)}addTransceiver(t,n){return this.pc.addTransceiver(t,n)}addTransceiverOfKind(t,n){return this.pc.addTransceiver(t,n)}addTrack(t){if(!this._pc)throw new yn("PC closed, cannot add track");return this._pc.addTrack(t)}setTrackCodecBitrate(t){this.trackBitrates.push(t)}setConfiguration(t){var n;if(!this._pc)throw new yn("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(t)}canRemoveTrack(){var t;return!!(!((t=this._pc)===null||t===void 0)&&t.removeTrack)}removeTrack(t){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(t)}getConnectionState(){var t,n;return(n=(t=this._pc)===null||t===void 0?void 0:t.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var t,n;return(n=(t=this._pc)===null||t===void 0?void 0:t.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var t,n;return(n=(t=this._pc)===null||t===void 0?void 0:t.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var t,n;return(n=(t=this._pc)===null||t===void 0?void 0:t.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var t,n;return(n=(t=this._pc)===null||t===void 0?void 0:t.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var t;return(t=this._pc)===null||t===void 0?void 0:t.localDescription}getRemoteDescription(){var t;return(t=this.pc)===null||t===void 0?void 0:t.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return K(this,void 0,void 0,function*(){var t;if(!this._pc)return;let n="";const i=new Map,s=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":s.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(t=i.get(n))===null||t===void 0?void 0:t.remoteCandidateId;if(o!==void 0)return s.get(o)})}setMungedSDP(t,n,i){return K(this,void 0,void 0,function*(){if(n){const s=t.sdp;t.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t);return}catch(r){this.log.warn("not able to set ".concat(t.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:r,sdp:n})),t.sdp=s}}try{i?yield this.pc.setRemoteDescription(t):yield this.pc.setLocalDescription(t)}catch(s){let r="unknown error";s instanceof Error?r=s.message:typeof s=="string"&&(r=s);const o={error:r,sdp:t.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(t.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new Su(r)}})}ensureVideoDDExtensionForSVC(t,n){var i,s;if(!((i=t.ext)===null||i===void 0?void 0:i.some(o=>o.uri===uP))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(u=>{u.value>o&&(o=u.value)}))}),this.ddExtID=o+1}(s=t.ext)===null||s===void 0||s.push({value:this.ddExtID,uri:uP})}}}function RP(e,t,n){const i=ak(e.mid);let s=0;e.rtp.some(r=>r.codec==="opus"?(s=r.payload,!0):!1),s>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(i)&&!e.rtcpFb.some(r=>r.payload===s&&r.type==="nack")&&e.rtcpFb.push({payload:s,type:"nack"}),(t.includes(i)||t.length===1&&t[0]==="all")&&e.fmtp.some(r=>r.payload===s?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function xW(e){var t;const n=[],i=[],s=ba.parse((t=e.sdp)!==null&&t!==void 0?t:"");let r=0;return s.media.forEach(o=>{var a;const c=ak(o.mid);o.type==="audio"&&(o.rtp.some(u=>u.codec==="opus"?(r=u.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(u=>u.payload===r&&u.type==="nack")&&i.push(c),o.fmtp.some(u=>u.payload===r?(u.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:i}}function MP(e){if(e.connection){const t=e.connection.ip.indexOf(":")>=0;(e.connection.version===4&&t||e.connection.version===6&&!t)&&(e.connection.ip="0.0.0.0",e.connection.version=4)}}function ak(e){return typeof e=="number"?e.toFixed(0):e}const Dx="vp8",wW={audioPreset:Tx.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:tk.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Dx,backupCodec:!0,preConnectBuffer:!1},T5={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},E5={deviceId:{ideal:"default"},resolution:cf.h720.resolution},CW={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new tV,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},lk={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var an;(function(e){e[e.NEW=0]="NEW",e[e.CONNECTING=1]="CONNECTING",e[e.CONNECTED=2]="CONNECTED",e[e.FAILED=3]="FAILED",e[e.CLOSING=4]="CLOSING",e[e.CLOSED=5]="CLOSED"})(an||(an={}));class kW{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(t,n,i){var s;this.peerConnectionTimeout=lk.peerConnectionTimeout,this.log=nt,this.updateState=()=>{var r,o;const a=this.state,c=this.requiredTransports.map(u=>u.getConnectionState());c.every(u=>u==="connected")?this.state=an.CONNECTED:c.some(u=>u==="failed")?this.state=an.FAILED:c.some(u=>u==="connecting")?this.state=an.CONNECTING:c.every(u=>u==="closed")?this.state=an.CLOSED:c.some(u=>u==="closed")?this.state=an.CLOSING:c.every(u=>u==="new")&&(this.state=an.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(an[a]," to ").concat(an[this.state]),this.logContext),(r=this.onStateChange)===null||r===void 0||r.call(this,this.state,this.publisher.getConnectionState(),(o=this.subscriber)===null||o===void 0?void 0:o.getConnectionState()))},this.log=Oo((s=i.loggerName)!==null&&s!==void 0?s:cr.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new EP(t,i),this._mode=n,n!=="publisher-only"&&(this.subscriber=new EP(t,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=r=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,r,tr.SUBSCRIBER)},this.subscriber.onDataChannel=r=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,r)},this.subscriber.onTrack=r=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,r)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=r=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,r,tr.PUBLISHER)},this.publisher.onTrack=r=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,r)},this.publisher.onOffer=(r,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,r,o)},this.state=an.NEW,this.connectionLock=new Ei,this.remoteOfferLock=new Ei}get logContext(){var t,n;return Object.assign({},(n=(t=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(t))}requirePublisher(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=t,this.updateState()}createAndSendPublisherOffer(t){return this.publisher.createAndSendOffer(t)}setPublisherAnswer(t,n){return this.publisher.setRemoteDescription(t,n)}removeTrack(t){return this.publisher.removeTrack(t)}close(){return K(this,void 0,void 0,function*(){var t;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(s){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:s}))}}yield Promise.all([this.publisher.close(),(t=this.subscriber)===null||t===void 0?void 0:t.close()]),this.updateState()})}triggerIceRestart(){return K(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(t,n){return K(this,void 0,void 0,function*(){var i;n===tr.PUBLISHER?yield this.publisher.addIceCandidate(t):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(t)})}createSubscriberAnswerFromOffer(t,n){return K(this,void 0,void 0,function*(){var i,s,r;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const o=yield this.remoteOfferLock.lock();try{return(yield(s=this.subscriber)===null||s===void 0?void 0:s.setRemoteDescription(t,n))?yield(r=this.subscriber)===null||r===void 0?void 0:r.createAndSetAnswer():void 0}finally{o()}})}updateConfiguration(t,n){var i;this.publisher.setConfiguration(t),(i=this.subscriber)===null||i===void 0||i.setConfiguration(t),n&&this.triggerIceRestart()}ensurePCTransportConnection(t,n){return K(this,void 0,void 0,function*(){var i;const s=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(r=>this.ensureTransportConnected(r,t,n)))}finally{s()}})}negotiate(t){return K(this,void 0,void 0,function*(){return new qi((n,i)=>K(this,void 0,void 0,function*(){const s=setTimeout(()=>{i(new Su("negotiation timed out"))},this.peerConnectionTimeout),r=()=>{clearTimeout(s),i(new Su("negotiation aborted"))};t.signal.addEventListener("abort",r),this.publisher.once(ku.NegotiationStarted,()=>{t.signal.aborted||this.publisher.once(ku.NegotiationComplete,()=>{clearTimeout(s),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(s),o instanceof Error?i(o):i(new Error(String(o)))})}))})}addPublisherTransceiver(t,n){return this.publisher.addTransceiver(t,n)}addPublisherTransceiverOfKind(t,n){return this.publisher.addTransceiverOfKind(t,n)}getMidForReceiver(t){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(s=>s.receiver===t);return i?.mid}addPublisherTrack(t){return this.publisher.addTrack(t)}createPublisherDataChannel(t,n){return this.publisher.createDataChannel(t,n)}getConnectedAddress(t){return t===tr.PUBLISHER?this.publisher.getConnectedAddress():t===tr.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const t=[];return this.isPublisherConnectionRequired&&t.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&t.push(this.subscriber),t}ensureTransportConnected(t,n){return K(this,arguments,void 0,function(i,s){var r=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(i.getConnectionState()!=="connected")return new Promise((c,u)=>K(r,void 0,void 0,function*(){const h=()=>{this.log.warn("abort transport connection",this.logContext),ri.clearTimeout(f),u(ze.cancelled("room connection has been cancelled"))};s?.signal.aborted&&h(),s?.signal.addEventListener("abort",h);const f=ri.setTimeout(()=>{s?.signal.removeEventListener("abort",h),u(ze.internal("could not establish pc connection"))},o);for(;this.state!==an.CONNECTED;)if(yield oi(50),s?.signal.aborted){u(ze.cancelled("room connection has been cancelled"));return}ri.clearTimeout(f),s?.signal.removeEventListener("abort",h),c()}))})()})}}const R5=5e3,TW=3e4;class kt{static fetchRegionSettings(t,n,i){return K(this,void 0,void 0,function*(){const s=yield kt.fetchLock.lock();try{const r=yield fetch("".concat(EW(t),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(r.ok){const o=YV(r.headers),a=o?o*1e3:R5;return{regionSettings:yield r.json(),updatedAtInMs:Date.now(),maxAgeInMs:a}}else throw r.status===401?ze.notAllowed("Could not fetch region settings: ".concat(r.statusText),r.status):ze.internal("Could not fetch region settings: ".concat(r.statusText))}catch(r){throw r instanceof ze?r:i?.aborted?ze.cancelled("Region fetching was aborted"):ze.serverUnreachable("Could not fetch region settings, ".concat(r instanceof Error?"".concat(r.name,": ").concat(r.message):r))}finally{s()}})}static scheduleRefetch(t,n,i){return K(this,void 0,void 0,function*(){const s=kt.settingsTimeouts.get(t.hostname);clearTimeout(s),kt.settingsTimeouts.set(t.hostname,setTimeout(()=>K(this,void 0,void 0,function*(){try{const r=yield kt.fetchRegionSettings(t,n);kt.updateCachedRegionSettings(t,n,r)}catch(r){if(r instanceof ze&&r.reason===Ht.NotAllowed){nt.debug("token is not valid, cancelling auto region refresh");return}nt.debug("auto refetching of region settings failed",{error:r}),kt.scheduleRefetch(t,n,i)}}),i))})}static updateCachedRegionSettings(t,n,i){kt.cache.set(t.hostname,i),kt.scheduleRefetch(t,n,i.maxAgeInMs)}static stopRefetch(t){const n=kt.settingsTimeouts.get(t);n&&(clearTimeout(n),kt.settingsTimeouts.delete(t))}static scheduleCleanup(t){let n=kt.connectionTrackers.get(t);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=kt.connectionTrackers.get(t);i&&i.connectionCount===0&&(nt.debug("stopping region refetch after disconnect delay",{hostname:t}),kt.stopRefetch(t)),i&&(i.cleanupTimeout=void 0)},TW))}static cancelCleanup(t){const n=kt.connectionTrackers.get(t);n?.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const t=this.serverUrl.hostname;let n=kt.connectionTrackers.get(t);n||(n={connectionCount:0},kt.connectionTrackers.set(t,n)),n.connectionCount++,kt.cancelCleanup(t)}notifyDisconnected(){const t=this.serverUrl.hostname,n=kt.connectionTrackers.get(t);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&kt.scheduleCleanup(t))}constructor(t,n){this.attemptedRegions=[],this.serverUrl=new URL(t),this.token=n}updateToken(t){this.token=t}isCloud(){return Nu(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(t){return K(this,void 0,void 0,function*(){return kt.fetchRegionSettings(this.serverUrl,this.token,t)})}getNextBestRegionUrl(t){return K(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=kt.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(t),kt.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(s=>!this.attemptedRegions.find(r=>r.url===s.url));if(i.length>0){const s=i[0];return this.attemptedRegions.push(s),nt.debug("next region: ".concat(s.region)),s.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(t){kt.updateCachedRegionSettings(this.serverUrl,this.token,t)}}kt.cache=new Map;kt.settingsTimeouts=new Map;kt.connectionTrackers=new Map;kt.fetchLock=new Ei;function EW(e){return"".concat(e.protocol.replace("ws","http"),"//").concat(e.host,"/settings")}class un extends Error{constructor(t,n,i){super(n),this.code=t,this.message=AP(n,un.MAX_MESSAGE_BYTES),this.data=i?AP(i,un.MAX_DATA_BYTES):void 0}static fromProto(t){return new un(t.code,t.message,t.data)}toProto(){return new _O({code:this.code,message:this.message,data:this.data})}static builtIn(t,n){return new un(un.ErrorCode[t],un.ErrorMessage[t],n)}}un.MAX_MESSAGE_BYTES=256;un.MAX_DATA_BYTES=15360;un.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};un.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const M5=15360;function ck(e){return new TextEncoder().encode(e).length}function AP(e,t){if(ck(e)<=t)return e;let n=0,i=e.length;const s=new TextEncoder;for(;n<i;){const r=Math.floor((n+i+1)/2);s.encode(e.slice(0,r)).length<=t?n=r:i=r-1}return e.slice(0,n)}const uk=2e3;function sy(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),n===void 0||i===void 0||e.timestamp===void 0||t.timestamp===void 0?0:(n-i)*8*1e3/(e.timestamp-t.timestamp)}const dk=typeof MediaRecorder<"u";class RW{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const MW=dk?MediaRecorder:RW;class AW extends MW{constructor(t,n){if(!dk)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([t.mediaStreamTrack]),n);let i,s;const r=()=>s===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),s?.close(),s=void 0},a=c=>{s?.error(c),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),s=void 0};this.byteStream=new ReadableStream({start:c=>{s=c,i=u=>K(this,void 0,void 0,function*(){let h;if(u.data.arrayBuffer){const f=yield u.data.arrayBuffer();h=new Uint8Array(f)}else if(u.data.byteArray)h=u.data.byteArray;else throw new Error("no data available!");r()||c.enqueue(h)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function PW(){return dk}const LW=1e3,NW=1e4;class A5 extends pe{get sender(){return this._sender}set sender(t){this._sender=t}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(t,n,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=arguments.length>4?arguments[4]:void 0;super(t,n,r),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=ok(()=>K(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>K(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(xe.Ended,this)},this.reacquireTrack=!1,this.providedByUser=s,this.muteLock=new Ei,this.pauseUpstreamLock=new Ei,this.trackChangeLock=new Ei,this.trackChangeLock.lock().then(o=>K(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(t,!0)}finally{o()}})),this._constraints=t.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==pe.Kind.Video)return;const{width:t,height:n}=this._mediaStreamTrack.getSettings();if(t&&n)return{width:t,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var t,n;return(n=(t=this.processor)===null||t===void 0?void 0:t.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(t,n){return K(this,void 0,void 0,function*(){var i;if(t===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(r=>{xu(this._mediaStreamTrack,r)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([t]),t&&(t.addEventListener("ended",this.handleEnded),t.addEventListener("mute",this.handleTrackMuteEvent),t.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=t.getConstraints());let s;if(this.processor&&t){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(fu(t,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:t,kind:this.kind,element:this.processorElement}),s=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(s??t)),!this.providedByUser&&this._mediaStreamTrack!==t&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=t,t&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(r=>{fu(s??t,r)}))})}waitForDimensions(){return K(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:LW;return(function*(){var i;if(t.kind===pe.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=Vi())===null||i===void 0?void 0:i.os)==="iOS"&&(yield oi(10));const s=Date.now();for(;Date.now()-s<n;){const r=t.dimensions;if(r)return r;yield oi(50)}throw new Ao("unable to get track dimensions after timeout")})()})}setDeviceId(t){return K(this,void 0,void 0,function*(){return this._constraints.deviceId===t&&this._mediaStreamTrack.getSettings().deviceId===Ia(t)||(this._constraints.deviceId=t,this.isMuted)?!0:(yield this.restartTrack(),Ia(t)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return K(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(t.source===pe.Source.ScreenShare)return;const{deviceId:i,groupId:s}=t._mediaStreamTrack.getSettings(),r=t.kind===pe.Kind.Audio?"audioinput":"videoinput";return n?Gn.getInstance().normalizeDeviceId(r,i,s):i})()})}mute(){return K(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return K(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(t,n){return K(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Ao("unable to replace an unpublished track");let s,r;return typeof n=="boolean"?s=n:n!==void 0&&(s=n.userProvidedTrack,r=n.stopProcessor),this.providedByUser=s??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(t),r&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(t){return K(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{t||(t=this._constraints);const{deviceId:i,facingMode:s}=t,r=nV(t,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:t}));const o={audio:!1,video:!1};this.kind===pe.Kind.Video?o.video=i||s?{deviceId:i,facingMode:s}:!0:o.audio=i?Object.assign({deviceId:i},r):!0,this.attachedElements.forEach(u=>{xu(this.mediaStreamTrack,u)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===pe.Kind.Video&&(yield c.applyConstraints(r)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=t,this.emit(xe.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(t){this.log.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted"),this.logContext),!(this.isMuted===t&&this._mediaStreamTrack.enabled!==t)&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?xe.Muted:xe.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return K(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),x5()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var t;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(t=this.processor)===null||t===void 0||t.destroy(),this.processor=void 0}pauseUpstream(){return K(this,void 0,void 0,function*(){var t;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(xe.UpstreamPaused,this);const i=Vi();if(i?.name==="Safari"&&$r(i.version,"12.0")<0)throw new ek("pauseUpstream is not supported on Safari < 12.");((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return K(this,void 0,void 0,function*(){var t;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(xe.UpstreamResumed,this),((t=this.sender.transport)===null||t===void 0?void 0:t.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return K(this,void 0,void 0,function*(){var t;return!((t=this.sender)===null||t===void 0)&&t.getStats?yield this.sender.getStats():void 0})}setProcessor(t){return K(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var r;const o=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),c={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(c),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(fu(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(u=>{u instanceof DOMException&&u.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:u})),setTimeout(()=>{a.play().catch(h=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:h}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:u}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const u of i.attachedElements)u!==i.processorElement&&s&&(xu(i._mediaStreamTrack,u),fu(i.processor.processedTrack,u));yield(r=i.sender)===null||r===void 0?void 0:r.replaceTrack(i.processor.processedTrack)}i.emit(xe.TrackProcessorUpdate,i.processor)}finally{o()}})()})}getProcessor(){return this.processor}stopProcessor(){return K(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const i=yield t.trackChangeLock.lock();try{yield t.internalStopProcessor(n)}finally{i()}})()})}internalStopProcessor(){return K(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var i,s;t.processor&&(t.log.debug("stopping processor",t.logContext),(i=t.processor.processedTrack)===null||i===void 0||i.stop(),yield t.processor.destroy(),t.processor=void 0,n||((s=t.processorElement)===null||s===void 0||s.remove(),t.processorElement=void 0),yield t._mediaStreamTrack.applyConstraints(t._constraints),yield t.setMediaStreamTrack(t._mediaStreamTrack,!0),t.emit(xe.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!PW()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new AW(this,{mimeType:n})}this.localTrackRecorder.start(t),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},NW)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.byteStream}getPreConnectBufferMimeType(){var t;return(t=this.localTrackRecorder)===null||t===void 0?void 0:t.mimeType}}class ov extends A5{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(t,pe.Kind.Audio,n,i,r),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>K(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=sy(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(xe.AudioTrackFeatureUpdate,this,Wn.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(xe.AudioTrackFeatureUpdate,this,Wn.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=s,this.checkForSilence()}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return K(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===pe.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{n()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return K(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Ia(this._constraints.deviceId);return this.source===pe.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this}finally{n()}})}restartTrack(t){return K(this,void 0,void 0,function*(){let n;if(t){const i=nk({audio:t});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(t){const n=Object.create(null,{restart:{get:()=>super.restart}});return K(this,void 0,void 0,function*(){const i=yield n.restart.call(this,t);return this.checkForSilence(),i})}startMonitor(){Hi()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},uk)))}setProcessor(t){return K(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!zr()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const s={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(t.name),this.logContext),yield t.init(s),this.processor=t,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(xe.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(t){this.audioContext=t}getSenderStats(){return K(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(s=>{s.type==="outbound-rtp"&&(i={type:"audio",streamId:s.id,packetsSent:s.packetsSent,packetsLost:s.packetsLost,bytesSent:s.bytesSent,timestamp:s.timestamp,roundTripTime:s.roundTripTime,jitter:s.jitter})}),i})}checkForSilence(){return K(this,void 0,void 0,function*(){const t=yield b5(this);return t&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(xe.AudioSilenceDetected)),t})}}function IW(e,t,n){switch(e.kind){case"audio":return new ov(e,t,!1,void 0,n);case"video":return new av(e,t,!1,n);default:throw new Ao("unsupported track type: ".concat(e.kind))}}const DW=Object.values(cf),OW=Object.values(Ex),jW=Object.values(tk),BW=[cf.h180,cf.h360],FW=[Ex.h180,Ex.h360],UW=e=>[{scaleResolutionDownBy:2,fps:e.encoding.maxFramerate}].map(n=>{var i,s;return new zt(Math.floor(e.width/n.scaleResolutionDownBy),Math.floor(e.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=e.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((s=n.fps)!==null&&s!==void 0?s:30))))),n.fps,e.encoding.priority)}),Ox=["q","h","f"];function jx(e,t,n,i){var s,r;let o=i?.videoEncoding;e&&(o=i?.screenShareEncoding);const a=i?.simulcast,c=i?.scalabilityMode,u=i?.videoCodec;if(!o&&!a&&!c||!t||!n)return[{}];o||(o=$W(e,t,n,u),nt.debug("using video encoding",o));const h=o.maxFramerate,f=new zt(t,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&nr(u)){const b=new P5(c),S=[];if(b.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const _=Vi();if(uf()||zr()||_?.name==="Chrome"&&$r(_?.version,"113")<0){const w=b.suffix=="h"?2:3,M=jV(_);for(let R=0;R<b.spatial;R+=1)S.push({rid:Ox[2-R],maxBitrate:o.maxBitrate/Math.pow(w,R),maxFramerate:f.encoding.maxFramerate,scaleResolutionDownBy:M?Math.pow(2,R):void 0});S[0].scalabilityMode=c}else S.push({maxBitrate:o.maxBitrate,maxFramerate:f.encoding.maxFramerate,scalabilityMode:c});return f.encoding.priority&&(S[0].priority=f.encoding.priority,S[0].networkPriority=f.encoding.priority),nt.debug("using svc encoding",{encodings:S}),S}if(!a)return[o];let m=[];e?m=(s=LP(i?.screenShareSimulcastLayers))!==null&&s!==void 0?s:PP(e,f):m=(r=LP(i?.videoSimulcastLayers))!==null&&r!==void 0?r:PP(e,f);let y;if(m.length>0){const b=m[0];m.length>1&&([,y]=m);const S=Math.max(t,n);if(S>=960&&y)return L0(t,n,[b,y,f],h);if(S>=480)return L0(t,n,[b,f],h)}return L0(t,n,[f])}function zW(e,t,n){var i,s,r,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&nt.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const a=e.mediaStreamTrack.getSettings(),c=(i=a.width)!==null&&i!==void 0?i:(s=e.dimensions)===null||s===void 0?void 0:s.width,u=(r=a.height)!==null&&r!==void 0?r:(o=e.dimensions)===null||o===void 0?void 0:o.height;return e.source===pe.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),jx(e.source===pe.Source.ScreenShare,c,u,n)}function $W(e,t,n,i){const s=qW(e,t,n);let{encoding:r}=s[0];const o=Math.max(t,n);for(let a=0;a<s.length;a+=1){const c=s[a];if(r=c.encoding,c.width>=o)break}if(i)switch(i){case"av1":case"h265":r=Object.assign({},r),r.maxBitrate=r.maxBitrate*.7;break;case"vp9":r=Object.assign({},r),r.maxBitrate=r.maxBitrate*.85;break}return r}function qW(e,t,n){if(e)return jW;const i=t>n?t/n:n/t;return Math.abs(i-16/9)<Math.abs(i-4/3)?DW:OW}function PP(e,t){if(e)return UW(t);const{width:n,height:i}=t,s=n>i?n/i:i/n;return Math.abs(s-16/9)<Math.abs(s-4/3)?BW:FW}function L0(e,t,n,i){const s=[];if(n.forEach((r,o)=>{if(o>=Ox.length)return;const a=Math.min(e,t),u={rid:Ox[o],scaleResolutionDownBy:Math.max(1,a/Math.min(r.width,r.height)),maxBitrate:r.encoding.maxBitrate},h=i&&r.encoding.maxFramerate?Math.min(i,r.encoding.maxFramerate):r.encoding.maxFramerate;h&&(u.maxFramerate=h);const f=Vl()||o===0;r.encoding.priority&&f&&(u.priority=r.encoding.priority,u.networkPriority=r.encoding.priority),s.push(u)}),zr()&&C5()==="ios"){let r;s.forEach(a=>{r?a.maxFramerate&&a.maxFramerate>r&&(r=a.maxFramerate):r=a.maxFramerate});let o=!0;s.forEach(a=>{var c;a.maxFramerate!=r&&(o&&(o=!1,nt.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),nt.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(r)),a.maxFramerate=r)})}return s}function LP(e){if(e)return e.sort((t,n)=>{const{encoding:i}=t,{encoding:s}=n;return i.maxBitrate>s.maxBitrate?1:i.maxBitrate<s.maxBitrate?-1:i.maxBitrate===s.maxBitrate&&i.maxFramerate&&s.maxFramerate?i.maxFramerate>s.maxFramerate?1:-1:0})}class P5{constructor(t){const n=t.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var t;return"L".concat(this.spatial,"T").concat(this.temporal).concat((t=this.suffix)!==null&&t!==void 0?t:"")}}function HW(e){return e.source===pe.Source.ScreenShare||e.constraints.height&&Ia(e.constraints.height)>=1080?"maintain-resolution":"balanced"}const VW=5e3;class av extends A5{get sender(){return this._sender}set sender(t){this._sender=t,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,s=arguments.length>3?arguments[3]:void 0;super(t,pe.Kind.Video,n,i,s),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>K(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let r;try{r=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(r.map(c=>[c.rid,c])),a=r.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(xe.CpuConstrained)),this.prevStats){let c=0;o.forEach((u,h)=>{var f;const m=(f=this.prevStats)===null||f===void 0?void 0:f.get(h);c+=sy(u,m)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new Ei}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(t){var n;if(this.signalClient=t,!Hi())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},uk))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(t=>{t.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const t=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return K(this,void 0,void 0,function*(){var n,i,s,r,o;yield t.pauseUpstream.call(this);try{for(var a=!0,c=Mo(this.simulcastCodecs.values()),u;u=yield c.next(),n=u.done,!n;a=!0)r=u.value,a=!1,yield(o=r.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(h){i={error:h}}finally{try{!a&&!n&&(s=c.return)&&(yield s.call(c))}finally{if(i)throw i.error}}})}resumeUpstream(){const t=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return K(this,void 0,void 0,function*(){var n,i,s,r,o;yield t.resumeUpstream.call(this);try{for(var a=!0,c=Mo(this.simulcastCodecs.values()),u;u=yield c.next(),n=u.done,!n;a=!0){r=u.value,a=!1;const h=r;yield(o=h.sender)===null||o===void 0?void 0:o.replaceTrack(h.mediaStreamTrack)}}catch(h){i={error:h}}finally{try{!a&&!n&&(s=c.return)&&(yield s.call(c))}finally{if(i)throw i.error}}})}mute(){const t=Object.create(null,{mute:{get:()=>super.mute}});return K(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===pe.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield t.mute.call(this),this)}finally{n()}})}unmute(){const t=Object.create(null,{unmute:{get:()=>super.unmute}});return K(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===pe.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield t.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(t){super.setTrackMuted(t);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!t}getSenderStats(){return K(this,void 0,void 0,function*(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(s=>{var r;if(s.type==="outbound-rtp"){const o={type:"video",streamId:s.id,frameHeight:s.frameHeight,frameWidth:s.frameWidth,framesPerSecond:s.framesPerSecond,framesSent:s.framesSent,firCount:s.firCount,pliCount:s.pliCount,nackCount:s.nackCount,packetsSent:s.packetsSent,bytesSent:s.bytesSent,qualityLimitationReason:s.qualityLimitationReason,qualityLimitationDurations:s.qualityLimitationDurations,qualityLimitationResolutionChanges:s.qualityLimitationResolutionChanges,rid:(r=s.rid)!==null&&r!==void 0?r:s.id,retransmittedPacketsSent:s.retransmittedPacketsSent,targetBitrate:s.targetBitrate,timestamp:s.timestamp},a=i.get(s.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((s,r)=>{var o,a;return((o=r.frameWidth)!==null&&o!==void 0?o:0)-((a=s.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(t){const n=[];for(let i=cs.LOW;i<=cs.HIGH;i+=1)n.push(new XC({quality:i,enabled:i<=t}));this.log.debug("setting publishing quality. max quality ".concat(t),this.logContext),this.setPublishingLayers(nr(this.codec),n)}restartTrack(t){return K(this,void 0,void 0,function*(){var n,i,s,r,o;let a;if(t){const f=nk({video:t});typeof f.video!="boolean"&&(a=f.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,u=Mo(this.simulcastCodecs.values()),h;h=yield u.next(),n=h.done,!n;c=!0){r=h.value,c=!1;const f=r;f.sender&&((o=f.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(f.mediaStreamTrack=this.mediaStreamTrack.clone(),yield f.sender.replaceTrack(f.mediaStreamTrack))}}catch(f){i={error:f}}finally{try{!c&&!n&&(s=u.return)&&(yield s.call(u))}finally{if(i)throw i.error}}})}setProcessor(t){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return K(this,arguments,void 0,function(i){var s=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o,a,c,u,h,f;if(yield n.setProcessor.call(s,i,r),!((h=s.processor)===null||h===void 0)&&h.processedTrack)try{for(var m=!0,y=Mo(s.simulcastCodecs.values()),b;b=yield y.next(),o=b.done,!o;m=!0)u=b.value,m=!1,yield(f=u.sender)===null||f===void 0?void 0:f.replaceTrack(s.processor.processedTrack)}catch(S){a={error:S}}finally{try{!m&&!o&&(c=y.return)&&(yield c.call(y))}finally{if(a)throw a.error}}})()})}setDegradationPreference(t){return K(this,void 0,void 0,function*(){if(this.degradationPreference=t,this.sender)try{this.log.debug("setting degradationPreference to ".concat(t),this.logContext);const n=this.sender.getParameters();n.degradationPreference=t,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(t,n){if(this.simulcastCodecs.has(t)){this.log.error("".concat(t," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:t,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(t,i),i}setSimulcastTrackSender(t,n){const i=this.simulcastCodecs.get(t);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},VW))}setPublishingCodecs(t){return K(this,void 0,void 0,function*(){var n,i,s,r,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:t,currentCodec:this.codec})),!this.codec&&t.length>0)return yield this.setPublishingLayers(nr(t[0].codec),t[0].qualities),[];this.subscribedCodecs=t;const u=[];try{for(n=!0,i=Mo(t);s=yield i.next(),r=s.done,!r;n=!0){c=s.value,n=!1;const h=c;if(!this.codec||this.codec===h.codec)yield this.setPublishingLayers(nr(h.codec),h.qualities);else{const f=this.simulcastCodecs.get(h.codec);if(this.log.debug("try setPublishingCodec for ".concat(h.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:f})),!f||!f.sender){for(const m of h.qualities)if(m.enabled){u.push(h.codec);break}}else f.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(h.codec),this.logContext),yield NP(f.sender,f.encodings,h.qualities,this.senderLock,nr(h.codec),this.log,this.logContext))}}}catch(h){o={error:h}}finally{try{!n&&!r&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return u})}setPublishingLayers(t,n){return K(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield NP(this.sender,this.encodings,n,this.senderLock,t,this.log,this.logContext))})}prioritizePerformance(){return K(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const t=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,s)=>{var r;return Object.assign(Object.assign({},i),{active:s===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((r=this.mediaStreamTrack.getSettings().height)!==null&&r!==void 0?r:360)/360)),scalabilityMode:s===0&&nr(this.codec)?"L1T3":void 0,maxFramerate:s===0?15:0,maxBitrate:s===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{t()}})}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return K(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),x5()&&this.isInBackground&&this.source===pe.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function NP(e,t,n,i,s,r,o){return K(this,void 0,void 0,function*(){const a=yield i.lock();r.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:e,qualities:n,senderEncodings:t}));try{const c=e.getParameters(),{encodings:u}=c;if(!u)return;if(u.length!==t.length){r.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:u,senderEncodings:t}));return}let h=!1;!1&&u[0].scalabilityMode||(s&&n.some(y=>y.enabled)&&n.forEach(y=>y.enabled=!0),u.forEach((m,y)=>{var b;let S=(b=m.rid)!==null&&b!==void 0?b:"";S===""&&(S="q");const _=L5(S),w=n.find(M=>M.quality===_);w&&m.active!==w.enabled&&(h=!0,m.active=w.enabled,r.debug("setting layer ".concat(w.quality," to ").concat(m.active?"enabled":"disabled"),o),Vl()&&(w.enabled?(m.scaleResolutionDownBy=t[y].scaleResolutionDownBy,m.maxBitrate=t[y].maxBitrate,m.maxFrameRate=t[y].maxFrameRate):(m.scaleResolutionDownBy=4,m.maxBitrate=10,m.maxFrameRate=2)))})),h&&(c.encodings=u,r.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield e.setParameters(c))}finally{a()}})}function L5(e){switch(e){case"f":return cs.HIGH;case"h":return cs.MEDIUM;case"q":return cs.LOW;default:return cs.HIGH}}function IP(e,t,n,i){if(!n)return[new Na({quality:cs.HIGH,width:e,height:t,bitrate:0,ssrc:0})];if(i){const s=n[0].scalabilityMode,r=new P5(s),o=[],a=r.suffix=="h"?1.5:2,c=r.suffix=="h"?2:3;for(let u=0;u<r.spatial;u+=1)o.push(new Na({quality:Math.min(cs.HIGH,r.spatial-1)-u,width:Math.ceil(e/Math.pow(a,u)),height:Math.ceil(t/Math.pow(a,u)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,u)):0,ssrc:0}));return o}return n.map(s=>{var r,o,a;const c=(r=s.scaleResolutionDownBy)!==null&&r!==void 0?r:1;let u=L5((o=s.rid)!==null&&o!==void 0?o:"");return new Na({quality:u,width:Math.ceil(e/c),height:Math.ceil(t/c),bitrate:(a=s.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const DP="_lossy",OP="_reliable",WW=2*1e3,N0="leave-reconnect",GW=3e4,KW=8*1024,YW=256*1024;var Ms;(function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"})(Ms||(Ms={}));class XW extends Gr.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(t){var n;super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=lk.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Ms.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=nt,this.reliableDataSequence=1,this.reliableMessageBuffer=new xP,this.reliableReceivedState=new gW(GW),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>K(this,[i],void 0,function(s){var r=this;let{channel:o}=s;return(function*(){if(o){if(o.label===OP)r.reliableDCSub=o;else if(o.label===DP)r.lossyDCSub=o;else return;r.log.debug("on data channel ".concat(o.id,", ").concat(o.label),r.logContext),o.onmessage=r.handleDataMessage}})()}),this.handleDataMessage=i=>K(this,void 0,void 0,function*(){var s,r,o,a,c;const u=yield this.dataProcessLock.lock();try{let h;if(i.data instanceof ArrayBuffer)h=i.data;else if(i.data instanceof Blob)h=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const f=Ti.fromBinary(new Uint8Array(h));if(f.sequence>0&&f.participantSid!==""){const m=this.reliableReceivedState.get(f.participantSid);if(m&&f.sequence<=m)return;this.reliableReceivedState.set(f.participantSid,f.sequence)}if(((s=f.value)===null||s===void 0?void 0:s.case)==="speaker")this.emit(ke.ActiveSpeakersUpdate,f.value.value.speakers);else if(((r=f.value)===null||r===void 0?void 0:r.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const m=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(f.value.value.encryptedValue,f.value.value.iv,f.participantIdentity,f.value.value.keyIndex),y=vO.fromBinary(m.payload),b=new Ti({value:y.value,participantIdentity:f.participantIdentity,participantSid:f.participantSid});((a=b.value)===null||a===void 0?void 0:a.case)==="user"&&jP(b,b.value.value),this.emit(ke.DataPacketReceived,b,f.value.value.encryptionType)}else((c=f.value)===null||c===void 0?void 0:c.case)==="user"&&jP(f,f.value.value),this.emit(ke.DataPacketReceived,f,On.NONE)}finally{u()}}),this.handleDataError=i=>{const r=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(r,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(r),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const r=i.currentTarget.maxRetransmits===0?ut.LOSSY:ut.RELIABLE;this.updateAndEmitDCBufferStatus(r)},this.handleDisconnect=(i,s)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const r=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(ke.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){r(o);return}i===N0&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=ri.setTimeout(()=>this.attemptReconnect(s).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,s)=>{this.pcState===Ms.Connected&&i();const r=()=>{this.off(ke.Disconnected,o),i()},o=()=>{this.off(ke.Restarted,r),s()};this.once(ke.Restarted,r),this.once(ke.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{if(i===ut.RELIABLE){const r=this.dataChannelForKind(i);r&&this.reliableMessageBuffer.alignBufferedAmount(r.bufferedAmount)}const s=this.isBufferStatusLow(i);typeof s<"u"&&s!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,s),this.emit(ke.DCBufferStatusChanged,s,i))},this.isBufferStatusLow=i=>{const s=this.dataChannelForKind(i);if(s)return s.bufferedAmount<=s.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>K(this,void 0,void 0,function*(){!this.url||!(yield fetch(df(this.url),{method:"HEAD"}).then(s=>s.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===qt.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===qt.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Sl.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>K(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(df(this.url),{method:"HEAD"}),oi(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=Oo((n=t.loggerName)!==null&&n!==void 0?n:cr.Engine),this.loggerOptions={loggerName:t.loggerName,loggerContextCb:()=>this.logContext},this.client=new sk(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Ei,this.dataProcessLock=new Ei,this.dcBufferStatus=new Map([[ut.LOSSY,!0],[ut.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(ke.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(ke.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(ke.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(ke.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(ke.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(ke.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(ke.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(ke.SignalRequestResponse,i)}get logContext(){var t,n,i,s,r,o;return{room:(n=(t=this.latestJoinResponse)===null||t===void 0?void 0:t.room)===null||n===void 0?void 0:n.name,roomID:(s=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||s===void 0?void 0:s.sid,participant:(o=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(t,n,i,s){return K(this,arguments,void 0,function(r,o,a,c){var u=this;let h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return(function*(){u.url=r,u.token=o,u.signalOpts=a,u.maxJoinAttempts=a.maxRetries;try{u.joinAttempts+=1,u.setupSignalClientCallbacks();const f=yield u.client.join(r,o,a,c,h);return u._isClosed=!1,u.latestJoinResponse=f,u.subscriberPrimary=f.subscriberPrimary,u.pcManager||(yield u.configure(f,!h)),(!u.subscriberPrimary||f.fastPublish)&&u.negotiate().catch(m=>{nt.error(m,u.logContext)}),u.registerOnLineListener(),u.clientConfiguration=f.clientConfiguration,u.emit(ke.SignalConnected,f),f}catch(f){if(f instanceof ze){if(f.reason===Ht.ServerUnreachable){if(u.log.warn("Couldn't connect to server, attempt ".concat(u.joinAttempts," of ").concat(u.maxJoinAttempts),u.logContext),u.joinAttempts<u.maxJoinAttempts)return u.join(r,o,a,c,h)}else if(f.reason===Ht.ServiceNotFound)return u.log.warn("Initial connection failed: ".concat(f.message,"  Retrying")),u.join(r,o,a,c,!0)}throw f}})()})}close(){return K(this,void 0,void 0,function*(){const t=yield this.closingLock.lock();if(this.isClosed){t();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(ke.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{t()}})}cleanupPeerConnections(){return K(this,void 0,void 0,function*(){var t;yield(t=this.pcManager)===null||t===void 0?void 0:t.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new xP,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return K(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new Ao("a track with the same ID has already been published");return new Promise((n,i)=>{const s=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],i(ze.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[t.cid]={resolve:r=>{clearTimeout(s),n(r)},reject:()=>{clearTimeout(s),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(t){if(t.track&&this.pendingTrackResolvers[t.track.id]){const{reject:n}=this.pendingTrackResolvers[t.track.id];n&&n(),delete this.pendingTrackResolvers[t.track.id]}try{return this.pcManager.removeTrack(t),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(t,n){this.client.sendMuteTrack(t,n)}get dataSubscriberReadyState(){var t;return(t=this.reliableDCSub)===null||t===void 0?void 0:t.readyState}getConnectedServerAddress(){return K(this,void 0,void 0,function*(){var t;return(t=this.pcManager)===null||t===void 0?void 0:t.getConnectedAddress()})}setRegionUrlProvider(t){this.regionUrlProvider=t}configure(t,n){return K(this,void 0,void 0,function*(){var i,s;if(this.pcManager&&this.pcManager.currentState!==an.NEW)return;this.participantSid=(i=t.participant)===null||i===void 0?void 0:i.sid;const r=this.makeRTCConfiguration(t);this.pcManager=new kW(r,n?"publisher-only":t.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(ke.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(o,a)=>{this.client.sendIceCandidate(o,a)},this.pcManager.onPublisherOffer=(o,a)=>{this.client.sendOffer(o,a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(o,a,c)=>K(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(o),this.logContext),["closed","disconnected","failed"].includes(a)&&(this.publisherConnectionPromise=void 0),o===an.CONNECTED){const f=this.pcState===Ms.New;this.pcState=Ms.Connected,f&&this.emit(ke.Connected,t)}else o===an.FAILED&&(this.pcState===Ms.Connected||this.pcState===Ms.Reconnecting)&&(this.pcState=Ms.Disconnected,this.handleDisconnect("peerconnection failed",c==="failed"?Sl.RR_SUBSCRIBER_FAILED:Sl.RR_PUBLISHER_FAILED));const u=this.client.isDisconnected||this.client.currentState===qt.RECONNECTING,h=[an.FAILED,an.CLOSING,an.CLOSED].includes(o);u&&h&&!this._isClosed&&this.emit(ke.Offline)}),this.pcManager.onTrack=o=>{o.streams.length!==0&&this.emit(ke.MediaTrackAdded,o.track,o.streams[0],o.receiver)},QW((s=t.serverInfo)===null||s===void 0?void 0:s.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(t,n,i)=>K(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:t.type,sdp:t.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(t,n))}),this.client.onTrickle=(t,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:t,target:n})),this.pcManager.addIceCandidate(t,n))},this.client.onOffer=(t,n,i)=>K(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const s=yield this.pcManager.createSubscriberAnswerFromOffer(t,n);s&&this.client.sendAnswer(s,n)}),this.client.onLocalTrackPublished=t=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:t.cid,track:(n=t.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[t.cid]){this.log.error("missing track resolver for ".concat(t.cid),Object.assign(Object.assign({},this.logContext),{cid:t.cid}));return}const{resolve:i}=this.pendingTrackResolvers[t.cid];delete this.pendingTrackResolvers[t.cid],i(t.track)},this.client.onLocalTrackUnpublished=t=>{this.emit(ke.LocalTrackUnpublished,t)},this.client.onLocalTrackSubscribed=t=>{this.emit(ke.LocalTrackSubscribed,t)},this.client.onTokenRefresh=t=>{var n;this.token=t,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(t)},this.client.onRemoteMuteChanged=(t,n)=>{this.emit(ke.RemoteMute,t,n)},this.client.onSubscribedQualityUpdate=t=>{this.emit(ke.SubscribedQualityUpdate,t)},this.client.onRoomMoved=t=>{var n;this.participantSid=(n=t.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=t.room),this.emit(ke.RoomMoved,t)},this.client.onMediaSectionsRequirement=t=>{var n,i;const s={direction:"recvonly"};for(let r=0;r<t.numAudios;r++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",s);for(let r=0;r<t.numVideos;r++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",s);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Sl.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=t=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:t?.reason})),t.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:R5,regionSettings:t.regions})),t.action){case bu.DISCONNECT:this.emit(ke.Disconnected,t?.reason),this.close();break;case bu.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(N0);break;case bu.RESUME:this.handleDisconnect(N0)}}}makeRTCConfiguration(t){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),t.iceServers&&!i.iceServers){const s=[];t.iceServers.forEach(r=>{const o={urls:r.urls};r.username&&(o.username=r.username),r.credential&&(o.credential=r.credential),s.push(o)}),i.iceServers=s}return t.clientConfiguration&&t.clientConfiguration.forceRelay===of.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(DP,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(OP,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const t=this.dataChannelForKind(ut.LOSSY);if(t){const n=this.lossyDataStatByterate/10;t.bufferedAmountLowThreshold=Math.min(Math.max(n,KW),YW)}},1e3))}createSender(t,n,i){return K(this,void 0,void 0,function*(){if(Ax())return yield this.createTransceiverRTCRtpSender(t,n,i);if(Px())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(t.mediaStreamTrack);throw new yn("Required webRTC APIs not supported on this device")})}createSimulcastSender(t,n,i,s){return K(this,void 0,void 0,function*(){if(Ax())return this.createSimulcastTransceiverSender(t,n,i,s);if(Px())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(t.mediaStreamTrack);throw new yn("Cannot stream on this device")})}createTransceiverRTCRtpSender(t,n,i){return K(this,void 0,void 0,function*(){if(!this.pcManager)throw new yn("publisher is closed");const s=[];t.mediaStream&&s.push(t.mediaStream),qa(t)&&(t.codec=n.videoCodec);const r={direction:"sendonly",streams:s};return i&&(r.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,r)).sender})}createSimulcastTransceiverSender(t,n,i,s){return K(this,void 0,void 0,function*(){if(!this.pcManager)throw new yn("publisher is closed");const r={direction:"sendonly"};s&&(r.sendEncodings=s);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,r);if(i.videoCodec)return t.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(t){return K(this,void 0,void 0,function*(){if(!this.pcManager)throw new yn("publisher is closed");return this.pcManager.addPublisherTrack(t)})}attemptReconnect(t){return K(this,void 0,void 0,function*(){var n,i,s;if(!this._isClosed){if(this.attemptingReconnect){nt.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===of.DISABLED||((s=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&s!==void 0?s:an.NEW)===an.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(r){this.reconnectAttempts+=1;let o=!0;r instanceof yn?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:r})),o=!1):r instanceof Kc||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",Sl.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(ke.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(t){try{return this.reconnectPolicy.nextRetryDelayInMs(t)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(t){return K(this,void 0,void 0,function*(){var n,i,s;try{if(!this.url||!this.token)throw new yn("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(ke.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let r;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Kc;r=yield this.join(t??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(o){throw o instanceof ze&&o.reason===Ht.NotAllowed?new yn("could not reconnect, token might be expired"):new Kc}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(ke.SignalRestarted,r),yield this.waitForPCReconnected(),this.client.currentState!==qt.CONNECTED)throw new Kc("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(ke.Restarted)}catch(r){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(s=this.regionUrlProvider)===null||s===void 0||s.resetAttempts(),r}})}resumeConnection(t){return K(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new yn("could not reconnect, url or token not saved");if(!this.pcManager)throw new yn("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(ke.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,t)}catch(s){let r="";throw s instanceof Error&&(r=s.message,this.log.error(s.message,Object.assign(Object.assign({},this.logContext),{error:s}))),s instanceof ze&&s.reason===Ht.NotAllowed?new yn("could not reconnect, token might be expired"):s instanceof ze&&s.reason===Ht.LeaveRequest?s:new Kc(r)}if(this.emit(ke.SignalResumed),i){const s=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(s),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==qt.CONNECTED)throw new Kc("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i?.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(ke.Resumed)})}waitForPCInitialConnection(t,n){return K(this,void 0,void 0,function*(){if(!this.pcManager)throw new yn("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,t)})}waitForPCReconnected(){return K(this,void 0,void 0,function*(){this.pcState=Ms.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield oi(WW),!this.pcManager)throw new yn("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ms.Connected}catch(t){throw this.pcState=Ms.Disconnected,ze.internal("could not establish PC connection, ".concat(t.message))}})}publishRpcResponse(t,n,i,s){return K(this,void 0,void 0,function*(){const r=new Ti({destinationIdentities:[t],kind:ut.RELIABLE,value:{case:"rpcResponse",value:new WC({requestId:n,value:s?{case:"error",value:s.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(r,ut.RELIABLE)})}publishRpcAck(t,n){return K(this,void 0,void 0,function*(){const i=new Ti({destinationIdentities:[t],kind:ut.RELIABLE,value:{case:"rpcAck",value:new VC({requestId:n})}});yield this.sendDataPacket(i,ut.RELIABLE)})}sendDataPacket(t,n){return K(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const r=rW(t);if(r){const o=yield this.e2eeManager.encryptData(r.toBinary());t.value={case:"encryptedPacket",value:new gO({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===ut.RELIABLE&&(t.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=t.toBinary(),s=this.dataChannelForKind(n);if(s){if(n===ut.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:t.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;s.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(t){return K(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(ut.RELIABLE);const n=this.dataChannelForKind(ut.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(t),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(ut.RELIABLE)})}waitForBufferStatusLow(t){return new qi((n,i)=>K(this,void 0,void 0,function*(){if(this.isBufferStatusLow(t))n();else{const s=()=>i(new yn("engine closed"));for(this.once(ke.Closing,s);!this.dcBufferStatus.get(t);)yield oi(10);this.off(ke.Closing,s),n()}}))}ensureDataTransportConnected(t){return K(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var r;if(!i.pcManager)throw new yn("PC manager is closed");const o=s?i.pcManager.subscriber:i.pcManager.publisher,a=s?"Subscriber":"Publisher";if(!o)throw ze.internal("".concat(a," connection not set"));let c=!1;!s&&!i.dataChannelForKind(n,s)&&(i.createDataChannels(),c=!0),!c&&!s&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&i.negotiate().catch(f=>{nt.error(f,i.logContext)});const u=i.dataChannelForKind(n,s);if(u?.readyState==="open")return;const h=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<h;){if(o.isICEConnected&&((r=i.dataChannelForKind(n,s))===null||r===void 0?void 0:r.readyState)==="open")return;yield oi(50)}throw ze.internal("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()))})()})}ensurePublisherConnected(t){return K(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(t,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==an.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return K(this,void 0,void 0,function*(){return new qi((t,n)=>K(this,void 0,void 0,function*(){if(!this.pcManager){n(new Su("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,s=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),t()};this.isClosed&&n(new Su("cannot negotiate on closed engine")),this.on(ke.Closing,s),this.pcManager.publisher.once(ku.RTPVideoPayloadTypes,r=>{const o=new Map;r.forEach(a=>{const c=a.codec.toLowerCase();$V(c)&&o.set(a.payload,c)}),this.emit(ke.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),t()}catch(r){r instanceof Su&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Sl.RR_UNKNOWN),r instanceof Error?n(r):n(new Error(String(r)))}finally{this.off(ke.Closing,s)}}))})}dataChannelForKind(t,n){if(n){if(t===ut.LOSSY)return this.lossyDCSub;if(t===ut.RELIABLE)return this.reliableDCSub}else{if(t===ut.LOSSY)return this.lossyDC;if(t===ut.RELIABLE)return this.reliableDC}}sendSyncState(t,n){var i,s,r,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),u=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),h=(s=this.pcManager.subscriber)===null||s===void 0?void 0:s.getLocalDescription(),f=(o=(r=this.signalOpts)===null||r===void 0?void 0:r.autoSubscribe)!==null&&o!==void 0?o:!0,m=new Array,y=new Array;t.forEach(b=>{b.isDesired!==f&&m.push(b.trackSid),b.isEnabled||y.push(b.trackSid)}),this.client.sendSyncState(new QC({answer:this.pcManager.mode==="publisher-only"?c?pu({sdp:c.sdp,type:c.type}):void 0:h?pu({sdp:h.sdp,type:h.type}):void 0,offer:this.pcManager.mode==="publisher-only"?a?pu({sdp:a.sdp,type:a.type}):void 0:u?pu({sdp:u.sdp,type:u.type}):void 0,subscription:new ty({trackSids:m,subscribe:!f,participantTracks:[]}),publishTracks:kV(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:y,datachannelReceiveStates:this.reliableReceivedState.map((b,S)=>new OO({publisherSid:S,lastSeq:b}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const t=[],n=(i,s)=>{i?.id!==void 0&&i.id!==null&&t.push(new jO({label:i.label,id:i.id,target:s}))};return n(this.dataChannelForKind(ut.LOSSY),tr.PUBLISHER),n(this.dataChannelForKind(ut.RELIABLE),tr.PUBLISHER),n(this.dataChannelForKind(ut.LOSSY,!0),tr.SUBSCRIBER),n(this.dataChannelForKind(ut.RELIABLE,!0),tr.SUBSCRIBER),t}clearReconnectTimeout(){this.reconnectTimeout&&ri.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Hi()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Hi()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(t){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(t);if(i){const s=Object.entries(this.midToTrackId).find(r=>{let[o]=r;return o===i});if(s)return s[1]}}}function QW(e){return e!==void 0&&e>13}function jP(e,t){const n=e.participantIdentity?e.participantIdentity:t.participantIdentity;e.participantIdentity=n,t.participantIdentity=n;const i=e.destinationIdentities.length!==0?e.destinationIdentities:t.destinationIdentities;e.destinationIdentities=i,t.destinationIdentities=i}class N5{get info(){return this._info}validateBytesReceived(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(t&&this.bytesReceived<this.totalByteSize)throw new As("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Ci.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new As("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Ci.LengthExceeded)}}constructor(t,n,i,s){this.reader=n,this.totalByteSize=i,this._info=t,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=s}}class JW extends N5{handleChunkReceived(t){var n;this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const t=this.reader.getReader();let n=new Bs,i=null,s=null;if(this.signal){const o=this.signal;s=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",s),i=o}const r=()=>{t.releaseLock(),i&&s&&i.removeEventListener("abort",s),this.signal=void 0};return{next:()=>K(this,void 0,void 0,function*(){var o,a;try{const{done:c,value:u}=yield Promise.race([t.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(u),{done:!1,value:u.content})}catch(c){throw r(),c}}),return(){return K(this,void 0,void 0,function*(){return r(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return K(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,s,r,o;let a=new Set;const c=n.signal?t.withAbortSignal(n.signal):t;try{for(var u=!0,h=Mo(c),f;f=yield h.next(),i=f.done,!i;u=!0){o=f.value,u=!1;const m=o;a.add(m)}}catch(m){s={error:m}}finally{try{!u&&!i&&(r=h.return)&&(yield r.call(h))}finally{if(s)throw s.error}}return Array.from(a)})()})}}class ZW extends N5{constructor(t,n,i,s){super(t,n,i,s),this.receivedChunks=new Map}handleChunkReceived(t){var n;const i=vg(t.chunkIndex),s=this.receivedChunks.get(i);if(s&&s.version>t.version)return;this.receivedChunks.set(i,t),this.bytesReceived+=t.content.byteLength,this.validateBytesReceived();const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,r)}[Symbol.asyncIterator](){const t=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Bs,s=null,r=null;if(this.signal){const a=this.signal;r=()=>{var c;(c=i.reject)===null||c===void 0||c.call(i,a.reason)},a.addEventListener("abort",r),s=a}const o=()=>{t.releaseLock(),s&&r&&s.removeEventListener("abort",r),this.signal=void 0};return{next:()=>K(this,void 0,void 0,function*(){var a,c;try{const{done:u,value:h}=yield Promise.race([t.read(),i.promise,(c=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(u)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(h);let f;try{f=n.decode(h.content)}catch(m){throw new As("Cannot decode datastream chunk ".concat(h.chunkIndex," as text: ").concat(m),Ci.DecodeFailed)}return{done:!1,value:f}}}catch(u){throw o(),u}}),return(){return K(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(t){return this.signal=t,this}readAll(){return K(this,arguments,void 0,function(){var t=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var i,s,r,o;let a="";const c=n.signal?t.withAbortSignal(n.signal):t;try{for(var u=!0,h=Mo(c),f;f=yield h.next(),i=f.done,!i;u=!0)o=f.value,u=!1,a+=o}catch(m){s={error:m}}finally{try{!u&&!i&&(r=h.return)&&(yield r.call(h))}finally{if(s)throw s.error}}return a})()})}}class eG{constructor(){this.log=nt,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(t,n){if(this.textStreamHandlers.has(t))throw new As('A text stream handler for topic "'.concat(t,'" has already been set.'),Ci.HandlerAlreadyRegistered);this.textStreamHandlers.set(t,n)}unregisterTextStreamHandler(t){this.textStreamHandlers.delete(t)}registerByteStreamHandler(t,n){if(this.byteStreamHandlers.has(t))throw new As('A byte stream handler for topic "'.concat(t,'" has already been set.'),Ci.HandlerAlreadyRegistered);this.byteStreamHandlers.set(t,n)}unregisterByteStreamHandler(t){this.byteStreamHandlers.delete(t)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(t){var n,i,s,r;const o=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===t),a=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===t);if(o.length>0||a.length>0){const c=new As("Participant ".concat(t," unexpectedly disconnected in the middle of sending data"),Ci.AbnormalEnd);for(const[u,h]of a)(i=(n=h.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,c),this.byteStreamControllers.delete(u);for(const[u,h]of o)(r=(s=h.outOfBandFailureRejectingFuture).reject)===null||r===void 0||r.call(s,c),this.textStreamControllers.delete(u)}}handleDataStreamPacket(t,n){return K(this,void 0,void 0,function*(){switch(t.value.case){case"streamHeader":return this.handleStreamHeader(t.value.value,t.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(t.value.value,n);case"streamTrailer":return this.handleStreamTrailer(t.value.value,n);default:throw new Error('DataPacket of value "'.concat(t.value.case,'" is not data stream related!'))}})}handleStreamHeader(t,n,i){return K(this,void 0,void 0,function*(){var s;if(t.contentHeader.case==="byteHeader"){const r=this.byteStreamHandlers.get(t.topic);if(!r){this.log.debug("ignoring incoming byte stream due to no handler for topic",t.topic);return}let o;const a=new Bs;a.promise.catch(h=>{this.log.error(h)});const c={id:t.streamId,name:(s=t.contentHeader.value.name)!==null&&s!==void 0?s:"unknown",mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:vg(t.timestamp),attributes:t.attributes,encryptionType:i},u=new ReadableStream({start:h=>{if(o=h,this.textStreamControllers.has(t.streamId))throw new As("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),Ci.AlreadyOpened);this.byteStreamControllers.set(t.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});r(new JW(c,u,vg(t.totalLength),a),{identity:n})}else if(t.contentHeader.case==="textHeader"){const r=this.textStreamHandlers.get(t.topic);if(!r){this.log.debug("ignoring incoming text stream due to no handler for topic",t.topic);return}let o;const a=new Bs;a.promise.catch(h=>{this.log.error(h)});const c={id:t.streamId,mimeType:t.mimeType,size:t.totalLength?Number(t.totalLength):void 0,topic:t.topic,timestamp:Number(t.timestamp),attributes:t.attributes,encryptionType:i},u=new ReadableStream({start:h=>{if(o=h,this.textStreamControllers.has(t.streamId))throw new As("A data stream read is already in progress for a stream with id ".concat(t.streamId,"."),Ci.AlreadyOpened);this.textStreamControllers.set(t.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});r(new ZW(c,u,vg(t.totalLength),a),{identity:n})}})}handleStreamChunk(t,n){const i=this.byteStreamControllers.get(t.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new As("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Ci.EncryptionTypeMismatch)),this.byteStreamControllers.delete(t.streamId)):t.content.length>0&&i.controller.enqueue(t));const s=this.textStreamControllers.get(t.streamId);s&&(s.info.encryptionType!==n?(s.controller.error(new As("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(n,", got ").concat(s.info.encryptionType),Ci.EncryptionTypeMismatch)),this.textStreamControllers.delete(t.streamId)):t.content.length>0&&s.controller.enqueue(t))}handleStreamTrailer(t,n){const i=this.textStreamControllers.get(t.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new As("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Ci.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),t.attributes),i.controller.close(),this.textStreamControllers.delete(t.streamId)));const s=this.byteStreamControllers.get(t.streamId);s&&(s.info.encryptionType!==n?s.controller.error(new As("Encryption type mismatch for stream ".concat(t.streamId,". Expected ").concat(n,", got ").concat(s.info.encryptionType),Ci.EncryptionTypeMismatch)):(s.info.attributes=Object.assign(Object.assign({},s.info.attributes),t.attributes),s.controller.close()),this.byteStreamControllers.delete(t.streamId))}}class I5{constructor(t,n,i){this.writableStream=t,this.defaultWriter=t.getWriter(),this.onClose=i,this.info=n}write(t){return this.defaultWriter.write(t)}close(){return K(this,void 0,void 0,function*(){var t;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(t=this.onClose)===null||t===void 0||t.call(this)})}}class tG extends I5{}class nG extends I5{}const BP=15e3;class iG{constructor(t,n){this.engine=t,this.log=n}setupEngine(t){this.engine=t}sendText(t,n){return K(this,void 0,void 0,function*(){var i;const s=crypto.randomUUID(),o=new TextEncoder().encode(t).byteLength,a=(i=n?.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),u=(f,m)=>{var y;c[m]=f;const b=c.reduce((S,_)=>S+_,0);(y=n?.onProgress)===null||y===void 0||y.call(n,b)},h=yield this.streamText({streamId:s,totalSize:o,destinationIdentities:n?.destinationIdentities,topic:n?.topic,attachedStreamIds:a,attributes:n?.attributes});return yield h.write(t),u(1,0),yield h.close(),n?.attachments&&a&&(yield Promise.all(n.attachments.map((f,m)=>K(this,void 0,void 0,function*(){return this._sendFile(a[m],f,{topic:n.topic,mimeType:f.type,onProgress:y=>{u(y,m+1)}})})))),h.info})}streamText(t){return K(this,void 0,void 0,function*(){var n,i,s;const r=(n=t?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:(i=t?.topic)!==null&&i!==void 0?i:"",size:t?.totalSize,attributes:t?.attributes,encryptionType:!((s=this.engine.e2eeManager)===null||s===void 0)&&s.isDataChannelEncryptionEnabled?On.GCM:On.NONE},a=new nv({streamId:r,mimeType:o.mimeType,topic:o.topic,timestamp:xl(o.timestamp),totalLength:xl(t?.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new RO({version:t?.version,attachedStreamIds:t?.attachedStreamIds,replyToStreamId:t?.replyToStreamId,operationType:t?.type==="update"?gx.UPDATE:gx.CREATE})}}),c=t?.destinationIdentities,u=new Ti({destinationIdentities:c,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(u,ut.RELIABLE);let h=0;const f=this.engine,m=new WritableStream({write(S){return K(this,void 0,void 0,function*(){for(const _ of KV(S,BP)){const w=new iv({content:_,streamId:r,chunkIndex:xl(h)}),M=new Ti({destinationIdentities:c,value:{case:"streamChunk",value:w}});yield f.sendDataPacket(M,ut.RELIABLE),h+=1}})},close(){return K(this,void 0,void 0,function*(){const S=new sv({streamId:r}),_=new Ti({destinationIdentities:c,value:{case:"streamTrailer",value:S}});yield f.sendDataPacket(_,ut.RELIABLE)})},abort(S){console.log("Sink error:",S)}});let y=()=>K(this,void 0,void 0,function*(){yield b.close()});f.once(ke.Closing,y);const b=new tG(m,o,()=>this.engine.off(ke.Closing,y));return b})}sendFile(t,n){return K(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,t,n),{id:i}})}_sendFile(t,n,i){return K(this,void 0,void 0,function*(){var s;const r=yield this.streamBytes({streamId:t,totalSize:n.size,name:n.name,mimeType:(s=i?.mimeType)!==null&&s!==void 0?s:n.type,topic:i?.topic,destinationIdentities:i?.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield r.write(c)}return yield r.close(),r.info})}streamBytes(t){return K(this,void 0,void 0,function*(){var n,i,s,r,o,a;const c=(n=t?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),u=t?.destinationIdentities,h={id:c,mimeType:(i=t?.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(s=t?.topic)!==null&&s!==void 0?s:"",timestamp:Date.now(),attributes:t?.attributes,size:t?.totalSize,name:(r=t?.name)!==null&&r!==void 0?r:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?On.GCM:On.NONE},f=new nv({totalLength:xl((a=h.size)!==null&&a!==void 0?a:0),mimeType:h.mimeType,streamId:c,topic:h.topic,timestamp:xl(Date.now()),attributes:h.attributes,contentHeader:{case:"byteHeader",value:new MO({name:h.name})}}),m=new Ti({destinationIdentities:u,value:{case:"streamHeader",value:f}});yield this.engine.sendDataPacket(m,ut.RELIABLE);let y=0;const b=new Ei,S=this.engine,_=this.log,w=new WritableStream({write(R){return K(this,void 0,void 0,function*(){const E=yield b.lock();let A=0;try{for(;A<R.byteLength;){const T=R.slice(A,A+BP),L=new Ti({destinationIdentities:u,value:{case:"streamChunk",value:new iv({content:T,streamId:c,chunkIndex:xl(y)})}});yield S.sendDataPacket(L,ut.RELIABLE),y+=1,A+=T.byteLength}}finally{E()}})},close(){return K(this,void 0,void 0,function*(){const R=new sv({streamId:c}),E=new Ti({destinationIdentities:u,value:{case:"streamTrailer",value:R}});yield S.sendDataPacket(E,ut.RELIABLE)})},abort(R){_.error("Sink error:",R)}});return new nG(w,h)})}}class D5 extends pe{constructor(t,n,i,s,r){super(t,i,r),this.sid=n,this.receiver=s}get isLocal(){return!1}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?xe.Muted:xe.Unmuted,this))}setMediaStream(t){this.mediaStream=t;const n=i=>{i.track===this._mediaStreamTrack&&(t.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(xe.Ended,this))};t.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return K(this,void 0,void 0,function*(){var t;return!((t=this.receiver)===null||t===void 0)&&t.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(t){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=t:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),uk)),TV()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const t=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>t());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:s,rtpTimestamp:r}=i;r&&this.rtpTimestamp!==r&&(this.emit(xe.TimeSyncUpdate,{timestamp:s,rtpTimestamp:r}),this.rtpTimestamp=r)}};t()}}class sG extends D5{constructor(t,n,i,s,r,o){super(t,n,pe.Kind.Audio,i,o),this.monitorReceiver=()=>K(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=sy(a,this.prevStats)),this.prevStats=a}),this.audioContext=s,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(t){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(t,0,.1):i.volume=t;zr()&&this._mediaStreamTrack._setVolume(t),this.elementVolume=t}getVolume(){if(this.elementVolume)return this.elementVolume;if(zr())return 1;let t=0;return this.attachedElements.forEach(n=>{n.volume>t&&(t=n.volume)}),t}setSinkId(t){return K(this,void 0,void 0,function*(){this.sinkId=t,yield Promise.all(this.attachedElements.map(n=>{if(Lx(n))return n.setSinkId(t)}))})}attach(t){const n=this.attachedElements.length===0;return t?super.attach(t):t=super.attach(),this.sinkId&&Lx(t)&&t.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,t),t.volume=0,t.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),t}detach(t){let n;return t?(n=super.detach(t),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(t){this.audioContext=t,t&&this.attachedElements.length>0?this.connectWebAudio(t,this.attachedElements[0]):t||this.disconnectWebAudio()}setWebAudioPlugins(t){this.webAudioPluginNodes=t,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,n){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(s=>{i.connect(s),i=s}),this.gainNode=t.createGain(),i.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),t.state!=="running"&&t.resume().then(()=>{t.state!=="running"&&this.emit(xe.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(s=>{this.emit(xe.AudioPlaybackFailed,s)})}disconnectWebAudio(){var t,n;(t=this.gainNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return K(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let n;return t.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const I0=100;class rG extends D5{constructor(t,n,i,s,r){super(t,n,pe.Kind.Video,i,r),this.elementInfos=[],this.monitorReceiver=()=>K(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=sy(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=ok(()=>{this.updateDimensions()},I0),this.adaptiveStreamSettings=s}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(t){super.setStreamState(t),this.log.debug("setStreamState",t),this.isAdaptiveStream&&t===pe.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(t){super.setMuted(t),this.attachedElements.forEach(n=>{t?xu(this._mediaStreamTrack,n):fu(this._mediaStreamTrack,n)})}attach(t){if(t?super.attach(t):t=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===t)===void 0){const n=new oG(t);this.observeElementInfo(n)}return t}observeElementInfo(t){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===t)===void 0?(t.handleResize=()=>{this.debouncedHandleResize()},t.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(t),t.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(t){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===t);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==t),this.updateVisibility(),this.debouncedHandleResize()}detach(t){let n=[];if(t)return this.stopObservingElement(t),super.detach(t);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var t;return(t=this.prevStats)===null||t===void 0?void 0:t.decoderImplementation}getReceiverStats(){return K(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const t=yield this.receiver.getStats();let n,i="",s=new Map;return t.forEach(r=>{r.type==="inbound-rtp"?(i=r.codecId,n={type:"video",streamId:r.id,framesDecoded:r.framesDecoded,framesDropped:r.framesDropped,framesReceived:r.framesReceived,packetsReceived:r.packetsReceived,packetsLost:r.packetsLost,frameWidth:r.frameWidth,frameHeight:r.frameHeight,pliCount:r.pliCount,firCount:r.firCount,nackCount:r.nackCount,jitter:r.jitter,timestamp:r.timestamp,bytesReceived:r.bytesReceived,decoderImplementation:r.decoderImplementation}):r.type==="codec"&&s.set(r.id,r)}),n&&i!==""&&s.get(i)&&(n.mimeType=s.get(i).mimeType),n})}stopObservingElement(t){const n=this.elementInfos.filter(i=>i.element===t);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const t=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return K(this,void 0,void 0,function*(){yield t.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(t){var n,i;const s=this.elementInfos.reduce((c,u)=>Math.max(c,u.visibilityChangedAt||0),0),r=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,o=this.elementInfos.some(c=>c.pictureInPicture),a=this.elementInfos.some(c=>c.visible)&&!r||o;if(!(this.lastVisible===a&&!t)){if(!a&&Date.now()-s<I0){ri.setTimeout(()=>{this.updateVisibility()},I0);return}this.lastVisible=a,this.emit(xe.VisibilityChanged,a,this)}}updateDimensions(){var t,n;let i=0,s=0;const r=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*r,c=o.height()*r;a+c>i+s&&(i=a,s=c)}((t=this.lastDimensions)===null||t===void 0?void 0:t.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===s||(this.lastDimensions={width:i,height:s},this.emit(xe.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var t;const n=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pixelDensity;return n==="screen"?hP():n||(hP()>2?2:1)}}class oG{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(t,n){this.onVisibilityChanged=i=>{var s;const{target:r,isIntersecting:o}=i;r===this.element&&(this.isIntersecting=o,this.isPiP=ih(this.element),this.visibilityChangedAt=Date.now(),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this))},this.onEnterPiP=()=>{var i,s,r;(s=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||s===void 0||s.addEventListener("pagehide",this.onLeavePiP),this.isPiP=ih(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=ih(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=t,this.isIntersecting=n??Bx(t),this.isPiP=Hi()&&ih(t),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var t,n,i;this.isIntersecting=Bx(this.element),this.isPiP=ih(this.element),this.element.handleResize=()=>{var s;(s=this.handleResize)===null||s===void 0||s.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,pP().observe(this.element),fP().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(t=window.documentPictureInPicture)===null||t===void 0||t.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var t,n,i,s,r;(t=pP())===null||t===void 0||t.unobserve(this.element),(n=fP())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(r=(s=window.documentPictureInPicture)===null||s===void 0?void 0:s.window)===null||r===void 0||r.removeEventListener("pagehide",this.onLeavePiP)}}function ih(e){var t,n;return document.pictureInPictureElement===e?!0:!((t=window.documentPictureInPicture)===null||t===void 0)&&t.window?Bx(e,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Bx(e,t){const n=t||window;let i=e.offsetTop,s=e.offsetLeft;const r=e.offsetWidth,o=e.offsetHeight,{hidden:a}=e,{display:c}=getComputedStyle(e);for(;e.offsetParent;)e=e.offsetParent,i+=e.offsetTop,s+=e.offsetLeft;return i<n.pageYOffset+n.innerHeight&&s<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&s+r>n.pageXOffset&&!a&&c!=="none"}class ko extends Gr.EventEmitter{constructor(t,n,i,s){var r;super(),this.metadataMuted=!1,this.encryption=On.NONE,this.log=nt,this.handleMuted=()=>{this.emit(xe.Muted)},this.handleUnmuted=()=>{this.emit(xe.Unmuted)},this.log=Oo((r=s?.loggerName)!==null&&r!==void 0?r:cr.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=t,this.trackSid=n,this.trackName=i,this.source=pe.Source.Unknown}setTrack(t){this.track&&(this.track.off(xe.Muted,this.handleMuted),this.track.off(xe.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(xe.Muted,this.handleMuted),t.on(xe.Unmuted,this.handleUnmuted))}get logContext(){var t;return Object.assign(Object.assign({},(t=this.loggerContextCb)===null||t===void 0?void 0:t.call(this)),pt(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==On.NONE}get audioTrack(){if(Dr(this.track))return this.track}get videoTrack(){if(qa(this.track))return this.track}updateInfo(t){this.trackSid=t.sid,this.trackName=t.name,this.source=pe.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===pe.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.encryption=t.encryption,this.trackInfo=t,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:t}))}}(function(e){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(e.SubscriptionStatus||(e.SubscriptionStatus={})),(function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"})(e.PermissionStatus||(e.PermissionStatus={}))})(ko||(ko={}));class Fx extends ko{get isUpstreamPaused(){var t;return(t=this.track)===null||t===void 0?void 0:t.isUpstreamPaused}constructor(t,n,i,s){super(t,n.sid,n.name,s),this.track=void 0,this.handleTrackEnded=()=>{this.emit(xe.Ended)},this.handleCpuConstrained=()=>{this.track&&qa(this.track)&&this.emit(xe.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(t){this.track&&(this.track.off(xe.Ended,this.handleTrackEnded),this.track.off(xe.CpuConstrained,this.handleCpuConstrained)),super.setTrack(t),t&&(t.on(xe.Ended,this.handleTrackEnded),t.on(xe.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return K(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.mute()})}unmute(){return K(this,void 0,void 0,function*(){var t;return(t=this.track)===null||t===void 0?void 0:t.unmute()})}pauseUpstream(){return K(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.pauseUpstream()})}resumeUpstream(){return K(this,void 0,void 0,function*(){var t;yield(t=this.track)===null||t===void 0?void 0:t.resumeUpstream()})}getTrackFeatures(){var t;if(Dr(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Wn.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Wn.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Wn.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Wn.TF_STEREO),!((t=this.options)===null||t===void 0)&&t.dtx||i.add(Wn.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Wn.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function ry(e,t){return K(this,void 0,void 0,function*(){e??(e={});let n=!1;const{audioProcessor:i,videoProcessor:s,optionsWithoutProcessor:r}=S5(e);let o=r.audio,a=r.video;if(i&&typeof r.audio=="object"&&(r.audio.processor=i),s&&typeof r.video=="object"&&(r.video.processor=s),e.audio&&typeof r.audio=="object"&&typeof r.audio.deviceId=="string"){const f=r.audio.deviceId;r.audio.deviceId={exact:f},n=!0,o=Object.assign(Object.assign({},r.audio),{deviceId:{ideal:f}})}if(r.video&&typeof r.video=="object"&&typeof r.video.deviceId=="string"){const f=r.video.deviceId;r.video.deviceId={exact:f},n=!0,a=Object.assign(Object.assign({},r.video),{deviceId:{ideal:f}})}r.audio===!0?r.audio={deviceId:"default"}:typeof r.audio=="object"&&r.audio!==null&&(r.audio=Object.assign(Object.assign({},r.audio),{deviceId:r.audio.deviceId||"default"})),r.video===!0?r.video={deviceId:"default"}:typeof r.video=="object"&&!r.video.deviceId&&(r.video.deviceId="default");const c=y5(r,T5,E5),u=nk(c),h=navigator.mediaDevices.getUserMedia(u);r.audio&&(Gn.userMediaPromiseMap.set("audioinput",h),h.catch(()=>Gn.userMediaPromiseMap.delete("audioinput"))),r.video&&(Gn.userMediaPromiseMap.set("videoinput",h),h.catch(()=>Gn.userMediaPromiseMap.delete("videoinput")));try{const f=yield h;return yield Promise.all(f.getTracks().map(m=>K(this,void 0,void 0,function*(){const y=m.kind==="audio";let b=y?c.audio:c.video;(typeof b=="boolean"||!b)&&(b={});let S;const _=y?u.audio:u.video;typeof _!="boolean"&&(S=_);const w=m.getSettings().deviceId;S?.deviceId&&Ia(S.deviceId)!==w?S.deviceId=w:S||(S={deviceId:w});const M=IW(m,S,t);return M.kind===pe.Kind.Video?M.source=pe.Source.Camera:M.kind===pe.Kind.Audio&&(M.source=pe.Source.Microphone),M.mediaStream=f,Dr(M)&&i?yield M.setProcessor(i):qa(M)&&s&&(yield M.setProcessor(s)),M})))}catch(f){if(!n)throw f;return ry(Object.assign(Object.assign({},e),{audio:o,video:a}),t)}})}function aG(e){return K(this,void 0,void 0,function*(){return(yield ry({audio:!1,video:!0}))[0]})}function O5(e){return K(this,void 0,void 0,function*(){return(yield ry({audio:e??!0,video:!1}))[0]})}var Ca;(function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Lost="lost",e.Unknown="unknown"})(Ca||(Ca={}));function lG(e){switch(e){case Sh.EXCELLENT:return Ca.Excellent;case Sh.GOOD:return Ca.Good;case Sh.POOR:return Ca.Poor;case Sh.LOST:return Ca.Lost;default:return Ca.Unknown}}class j5 extends Gr.EventEmitter{get logContext(){var t,n;return Object.assign({},(n=(t=this.loggerOptions)===null||t===void 0?void 0:t.loggerContextCb)===null||n===void 0?void 0:n.call(t))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(t=>t.isEncrypted)}get isAgent(){var t;return((t=this.permissions)===null||t===void 0?void 0:t.agent)||this.kind===af.AGENT}get isActive(){var t;return((t=this.participantInfo)===null||t===void 0?void 0:t.state)===yu.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(t,n,i,s,r,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:af.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Ca.Unknown,this.log=nt,this.log=Oo((c=o?.loggerName)!==null&&c!==void 0?c:cr.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=t,this.identity=n,this.name=i,this.metadata=s,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=r??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(t){for(const[,n]of this.trackPublications)if(n.source===t)return n}getTrackPublicationByName(t){for(const[,n]of this.trackPublications)if(n.trackName===t)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Bs,this.once(Te.Active,()=>{var t,n;(n=(t=this.activeFuture)===null||t===void 0?void 0:t.resolve)===null||n===void 0||n.call(t),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var t;const n=this.getTrackPublication(pe.Source.Camera);return!(!((t=n?.isMuted)!==null&&t!==void 0)||t)}get isMicrophoneEnabled(){var t;const n=this.getTrackPublication(pe.Source.Microphone);return!(!((t=n?.isMuted)!==null&&t!==void 0)||t)}get isScreenShareEnabled(){return!!this.getTrackPublication(pe.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(t){var n;return this.participantInfo&&this.participantInfo.sid===t.sid&&this.participantInfo.version>t.version?!1:(this.identity=t.identity,this.sid=t.sid,this._setName(t.name),this._setMetadata(t.metadata),this._setAttributes(t.attributes),t.state===yu.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==yu.ACTIVE&&this.emit(Te.Active),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,!0)}_setMetadata(t){const n=this.metadata!==t,i=this.metadata;this.metadata=t,n&&this.emit(Te.ParticipantMetadataChanged,i)}_setName(t){const n=this.name!==t;this.name=t,n&&this.emit(Te.ParticipantNameChanged,t)}_setAttributes(t){const n=EV(this.attributes,t);this._attributes=t,Object.keys(n).length>0&&this.emit(Te.AttributesChanged,n)}setPermissions(t){var n,i,s,r,o,a;const c=this.permissions,u=t.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||t.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||t.canPublishData!==((s=this.permissions)===null||s===void 0?void 0:s.canPublishData)||t.hidden!==((r=this.permissions)===null||r===void 0?void 0:r.hidden)||t.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((h,f)=>{var m;return h!==((m=this.permissions)===null||m===void 0?void 0:m.canPublishSources[f])})||t.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=t,u&&this.emit(Te.ParticipantPermissionsChanged,c),u}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(Te.IsSpeakingChanged,t))}setConnectionQuality(t){const n=this._connectionQuality;this._connectionQuality=lG(t),n!==this._connectionQuality&&this.emit(Te.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var t,n;this.activeFuture&&((n=(t=this.activeFuture).reject)===null||n===void 0||n.call(t,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(t){this.audioContext=t,this.audioTrackPublications.forEach(n=>Dr(n.track)&&n.track.setAudioContext(t))}addTrackPublication(t){t.on(xe.Muted,()=>{this.emit(Te.TrackMuted,t)}),t.on(xe.Unmuted,()=>{this.emit(Te.TrackUnmuted,t)});const n=t;switch(n.track&&(n.track.sid=t.trackSid),this.trackPublications.set(t.trackSid,t),t.kind){case pe.Kind.Audio:this.audioTrackPublications.set(t.trackSid,t);break;case pe.Kind.Video:this.videoTrackPublications.set(t.trackSid,t);break}}}function cG(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new IO({participantIdentity:(t=e.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(n=e.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=e.allowAll)!==null&&i!==void 0?i:!1,trackSids:e.allowedTrackSids||[]})}class uG extends j5{constructor(t,n,i,s,r,o){super(t,n,void 0,void 0,void 0,{loggerName:s.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=On.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Bs)},this.handleReconnected=()=>{var a,c;(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||c===void 0||c.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,c,u,h,f,m;this.reconnectFuture&&(this.reconnectFuture.promise.catch(y=>this.log.warn(y.message,this.logContext)),(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||c===void 0||c.call(a,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((h=(u=this.signalConnectedFuture).reject)===null||h===void 0||h.call(u,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(m=(f=this.activeAgentFuture)===null||f===void 0?void 0:f.reject)===null||m===void 0||m.call(f,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var c,u;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Bs),(u=(c=this.signalConnectedFuture).resolve)===null||u===void 0||u.call(c)},this.handleSignalRequestResponse=a=>{const{requestId:c,reason:u,message:h}=a,f=this.pendingSignalRequests.get(c);f&&(u!==JC.OK&&f.reject(new aP(h,u)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let c=a.value.value,u=null,h=null;c.value.case==="payload"?u=c.value.value:c.value.case==="error"&&(h=un.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,u,h);break;case"rpcAck":let f=a.value.value;this.handleIncomingRpcAck(f.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>cG(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,c)=>{if(c===void 0&&(c=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),pt(a)));return}this.engine.updateMuteStatus(a.sid,c)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),pt(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),pt(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const c=this.audioTrackPublications.get(a.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(a,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),pt(c))),this.emit(Te.LocalTrackCpuConstrained,a,c)},this.handleSubscribedQualityUpdate=a=>K(this,void 0,void 0,function*(){var c,u,h,f,m;if(!(!((m=this.roomOptions)===null||m===void 0)&&m.dynacast))return;const y=this.videoTrackPublications.get(a.trackSid);if(!y){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!y.videoTrack)return;const b=yield y.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var S=!0,_=Mo(b),w;w=yield _.next(),c=w.done,!c;S=!0){f=w.value,S=!1;const M=f;xV(M)&&(this.log.debug("publish ".concat(M," for ").concat(y.videoTrack.sid),Object.assign(Object.assign({},this.logContext),pt(y))),yield this.publishAdditionalCodecForTrack(y.videoTrack,M,y.options))}}catch(M){u={error:M}}finally{try{!S&&!c&&(h=_.return)&&(yield h.call(_))}finally{if(u)throw u.error}}}),this.handleLocalTrackUnpublished=a=>{const c=this.trackPublications.get(a.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=a=>K(this,void 0,void 0,function*(){if(a.source===pe.Source.ScreenShare||a.source===pe.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),pt(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(So(a)||fa(a))try{if(Hi())try{const c=yield navigator?.permissions.query({name:a.source===pe.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),pt(a))),c.onchange=()=>{c.state!=="denied"&&(a.isMuted||a.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),pt(a))),So(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),pt(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=s,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=r,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==On.NONE}getTrackPublication(t){const n=super.getTrackPublication(t);if(n)return n}getTrackPublicationByName(t){const n=super.getTrackPublicationByName(t);if(n)return n}setupEngine(t){var n;this.engine=t,this.engine.on(ke.RemoteMute,(i,s)=>{const r=this.trackPublications.get(i);!r||!r.track||(s?r.mute():r.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(ke.Connected,this.handleReconnected).on(ke.SignalConnected,this.handleSignalConnected).on(ke.SignalRestarted,this.handleReconnected).on(ke.SignalResumed,this.handleReconnected).on(ke.Restarting,this.handleReconnecting).on(ke.Resuming,this.handleReconnecting).on(ke.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(ke.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(ke.Closing,this.handleClosing).on(ke.SignalRequestResponse,this.handleSignalRequestResponse).on(ke.DataPacketReceived,this.handleDataPacket)}setMetadata(t){return K(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:t})})}setName(t){return K(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:t})})}setAttributes(t){return K(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:t})})}requestMetadataUpdate(t){return K(this,arguments,void 0,function(n){var i=this;let{metadata:s,name:r,attributes:o}=n;return(function*(){return new qi((a,c)=>K(i,void 0,void 0,function*(){var u,h;try{let f=!1;const m=yield this.engine.client.sendUpdateLocalMetadata((u=s??this.metadata)!==null&&u!==void 0?u:"",(h=r??this.name)!==null&&h!==void 0?h:"",o),y=performance.now();for(this.pendingSignalRequests.set(m,{resolve:a,reject:b=>{c(b),f=!0},values:{name:r,metadata:s,attributes:o}});performance.now()-y<5e3&&!f;){if((!r||this.name===r)&&(!s||this.metadata===s)&&(!o||Object.entries(o).every(b=>{let[S,_]=b;return this.attributes[S]===_||_===""&&!this.attributes[S]}))){this.pendingSignalRequests.delete(m),a();return}yield oi(50)}c(new aP("Request to update local metadata timed out","TimeoutError"))}catch(f){f instanceof Error?c(f):c(new Error(String(f)))}}))})()})}setCameraEnabled(t,n,i){return this.setTrackEnabled(pe.Source.Camera,t,n,i)}setMicrophoneEnabled(t,n,i){return this.setTrackEnabled(pe.Source.Microphone,t,n,i)}setScreenShareEnabled(t,n,i){return this.setTrackEnabled(pe.Source.ScreenShare,t,n,i)}setE2EEEnabled(t){return K(this,void 0,void 0,function*(){this.encryptionType=t?On.GCM:On.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(t,n,i,s){return K(this,void 0,void 0,function*(){var r,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:t,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(t);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(t)){const u=yield this.waitForPendingPublicationOfSource(t);return u||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t})),yield u?.unmute(),u}this.pendingPublishing.add(t);try{switch(t){case pe.Source.Camera:c=yield this.createTracks({video:(r=i)!==null&&r!==void 0?r:!0});break;case pe.Source.Microphone:c=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case pe.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Ao(t)}}catch(u){throw c?.forEach(h=>{h.stop()}),u instanceof Error&&this.emit(Te.MediaDevicesError,u,Mx(t)),this.pendingPublishing.delete(t),u}for(const u of c){const h=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);t===pe.Source.Microphone&&Dr(u)&&h.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),u.startPreConnectBuffer())}try{const u=[];for(const f of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),pt(f))),u.push(this.publishTrack(f,s));[a]=yield Promise.all(u)}catch(u){throw c?.forEach(h=>{h.stop()}),u}finally{this.pendingPublishing.delete(t)}}else if(!a?.track&&this.pendingPublishing.has(t)&&(a=yield this.waitForPendingPublicationOfSource(t),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:t}))),a&&a.track)if(t===pe.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(pe.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return K(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(pe.Source.Camera)||this.pendingPublishing.has(pe.Source.Microphone))){this.pendingPublishing.add(pe.Source.Camera),this.pendingPublishing.add(pe.Source.Microphone);try{const t=yield this.createTracks({audio:!0,video:!0});yield Promise.all(t.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(pe.Source.Camera),this.pendingPublishing.delete(pe.Source.Microphone)}}})}createTracks(t){return K(this,void 0,void 0,function*(){var n,i;t??(t={});const s=y5(t,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield ry(s,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(Dr(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=pe.Source.Microphone,this.emit(Te.AudioStreamAcquired)),qa(a)&&(this.cameraError=void 0,a.source=pe.Source.Camera),a))}catch(r){throw r instanceof Error&&(t.audio&&(this.microphoneError=r),t.video&&(this.cameraError=r)),r}})}createScreenTracks(t){return K(this,void 0,void 0,function*(){if(t===void 0&&(t={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new ek("getDisplayMedia not supported");t.resolution===void 0&&!OV()&&(t.resolution=tk.h1080fps30.resolution);const n=CV(t),i=yield navigator.mediaDevices.getDisplayMedia(n),s=i.getVideoTracks();if(s.length===0)throw new Ao("no video track found");const r=new av(s[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});r.source=pe.Source.ScreenShare,t.contentHint&&(r.mediaStreamTrack.contentHint=t.contentHint);const o=[r];if(i.getAudioTracks().length>0){this.emit(Te.AudioStreamAcquired);const a=new ov(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=pe.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(t,n){return K(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(t,n)})}publishOrRepublishTrack(t,n){return K(this,arguments,void 0,function(i,s){var r=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var a,c,u,h;So(i)&&i.setAudioContext(r.audioContext),yield(a=r.reconnectFuture)===null||a===void 0?void 0:a.promise,r.republishPromise&&!o&&(yield r.republishPromise),wu(i)&&r.pendingPublishPromises.has(i)&&(yield r.pendingPublishPromises.get(i));let f;if(i instanceof MediaStreamTrack)f=i.getConstraints();else{f=i.constraints;let w;switch(i.source){case pe.Source.Microphone:w="audioinput";break;case pe.Source.Camera:w="videoinput"}w&&r.activeDeviceMap.has(w)&&(f=Object.assign(Object.assign({},f),{deviceId:r.activeDeviceMap.get(w)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new ov(i,f,!0,r.audioContext,{loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});break;case"video":i=new av(i,f,!0,{loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});break;default:throw new Ao("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});let m;if(r.trackPublications.forEach(w=>{w.track&&w.track===i&&(m=w)}),m)return r.log.warn("track has already been published, skipping",Object.assign(Object.assign({},r.logContext),pt(m))),m;const y=Object.assign(Object.assign({},r.roomOptions.publishDefaults),s),b="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,S=(c=y.forceStereo)!==null&&c!==void 0?c:b;S&&(y.dtx===void 0&&r.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},r.logContext),pt(i))),y.red===void 0&&r.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(u=y.dtx)!==null&&u!==void 0||(y.dtx=!1),(h=y.red)!==null&&h!==void 0||(y.red=!1)),!BV()&&r.roomOptions.e2ee&&(r.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},r.logContext)),y.simulcast=!1),y.source&&(i.source=y.source);const _=new Promise((w,M)=>K(r,void 0,void 0,function*(){try{if(this.engine.client.currentState!==qt.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:pt(i)}));let R=!1;const E=setTimeout(()=>{R=!0,i.stop(),M(new oP("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(E),R)return;const A=yield this.publish(i,y,S);w(A)}else try{const R=yield this.publish(i,y,S);w(R)}catch(R){M(R)}}catch(R){M(R)}}));r.pendingPublishPromises.set(i,_);try{return yield _}catch(w){throw w}finally{r.pendingPublishPromises.delete(i)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Bs),this.signalConnectedFuture.promise}hasPermissionsToPublish(t){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),pt(t))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(s=>RV(s)).includes(t.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),pt(t))),!1)}publish(t,n,i){return K(this,void 0,void 0,function*(){var s,r,o,a,c,u,h,f,m,y;if(!this.hasPermissionsToPublish(t))throw new oP("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(I=>wu(t)&&I.source===t.source)&&t.source!==pe.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(t.source),Object.assign(Object.assign({},this.logContext),pt(t))),n.stopMicTrackOnMute&&Dr(t)&&(t.stopOnMute=!0),t.source===pe.Source.ScreenShare&&Vl()&&(n.simulcast=!1),n.videoCodec==="av1"&&!NV()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!IV()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Dx),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(I=>n.videoCodec===Oh(I.mime))||(n.videoCodec=Oh(this.enabledPublishVideoCodecs[0].mime)));const S=n.videoCodec;t.on(xe.Muted,this.onTrackMuted),t.on(xe.Unmuted,this.onTrackUnmuted),t.on(xe.Ended,this.handleTrackEnded),t.on(xe.UpstreamPaused,this.onTrackUpstreamPaused),t.on(xe.UpstreamResumed,this.onTrackUpstreamResumed),t.on(xe.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const _=[],w=!(!((s=n.dtx)!==null&&s!==void 0)||s),M=t.getSourceTrackSettings();M.autoGainControl&&_.push(Wn.TF_AUTO_GAIN_CONTROL),M.echoCancellation&&_.push(Wn.TF_ECHO_CANCELLATION),M.noiseSuppression&&_.push(Wn.TF_NOISE_SUPPRESSION),M.channelCount&&M.channelCount>1&&_.push(Wn.TF_STEREO),w&&_.push(Wn.TF_NO_DTX),So(t)&&t.hasPreConnectBuffer&&_.push(Wn.TF_PRECONNECT_BUFFER);const R=new lf({cid:t.mediaStreamTrack.id,name:n.name,type:pe.kindToProto(t.kind),muted:t.isMuted,source:pe.sourceToProto(t.source),disableDtx:w,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((r=n.red)!==null&&r!==void 0)||r),stream:n?.stream,backupCodecPolicy:n?.backupCodecPolicy,audioFeatures:_});let E;if(t.kind===pe.Kind.Video){let I={width:0,height:0};try{I=yield t.waitForDimensions()}catch{const O=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:cf.h720.resolution;I={width:O.width,height:O.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),pt(t)),{dims:I}))}R.width=I.width,R.height=I.height,fa(t)&&(nr(S)&&(t.source===pe.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in t.mediaStreamTrack&&(t.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),pt(t))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),R.simulcastCodecs=[new yx({codec:S,cid:t.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Dx}),n.backupCodec&&S!==n.backupCodec.codec&&R.encryption===On.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),R.simulcastCodecs.push(new yx({codec:n.backupCodec.codec,cid:""})))),E=jx(t.source===pe.Source.ScreenShare,R.width,R.height,n),R.layers=IP(R.width,R.height,E,nr(n.videoCodec))}else t.kind===pe.Kind.Audio&&(E=[{maxBitrate:(u=n.audioPreset)===null||u===void 0?void 0:u.maxBitrate,priority:(f=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&f!==void 0?f:"high",networkPriority:(y=(m=n.audioPreset)===null||m===void 0?void 0:m.priority)!==null&&y!==void 0?y:"high"}]);if(!this.engine||this.engine.isClosed)throw new yn("cannot publish track when not connected");const A=()=>K(this,void 0,void 0,function*(){var I,N,O;if(!this.engine.pcManager)throw new yn("pcManager is not ready");if(t.sender=yield this.engine.createSender(t,n,E),this.emit(Te.LocalSenderCreated,t.sender,t),fa(t)&&((I=n.degradationPreference)!==null&&I!==void 0||(n.degradationPreference=HW(t)),t.setDegradationPreference(n.degradationPreference)),E)if(Vl()&&t.kind===pe.Kind.Audio){let j;for(const $ of this.engine.pcManager.publisher.getTransceivers())if($.sender===t.sender){j=$;break}j&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:j,codec:"opus",maxbr:!((N=E[0])===null||N===void 0)&&N.maxBitrate?E[0].maxBitrate/1e3:0})}else t.codec&&nr(t.codec)&&(!((O=E[0])===null||O===void 0)&&O.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:R.cid,codec:t.codec,maxbr:E[0].maxBitrate/1e3});yield this.engine.negotiate()});let T;const L=new Promise((I,N)=>K(this,void 0,void 0,function*(){var O;try{T=yield this.engine.addTrack(R),I(T)}catch(j){t.sender&&(!((O=this.engine.pcManager)===null||O===void 0)&&O.publisher)&&(this.engine.pcManager.publisher.removeTrack(t.sender),yield this.engine.negotiate().catch($=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),pt(t)),{error:$}))})),N(j)}}));if(this.enabledPublishVideoCodecs.length>0)T=(yield Promise.all([L,A()]))[0];else{T=yield L;let I;if(T.codecs.forEach(N=>{I===void 0&&(I=N.mimeType)}),I&&t.kind===pe.Kind.Video){const N=Oh(I);N!==S&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),pt(t)),{codec:N})),n.videoCodec=N,E=jx(t.source===pe.Source.ScreenShare,R.width,R.height,n))}yield A()}const P=new Fx(t.kind,T,t,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(P.on(xe.CpuConstrained,I=>this.onTrackCpuConstrained(I,P)),P.options=n,t.sid=T.sid,this.log.debug("publishing ".concat(t.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:E,trackInfo:T})),fa(t)?t.startMonitor(this.engine.client):So(t)&&t.startMonitor(),this.addTrackPublication(P),this.emit(Te.LocalTrackPublished,P),So(t)&&T.audioFeatures.includes(Wn.TF_PRECONNECT_BUFFER)){const I=t.getPreConnectBuffer(),N=t.getPreConnectBufferMimeType();this.on(Te.LocalTrackSubscribed,O=>{if(O.trackSid===T.sid){if(!t.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),pt(t))),t.stopPreConnectBuffer()}}),I&&new Promise((j,$)=>K(this,void 0,void 0,function*(){var V,H,B,W,q,ne;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),pt(t)));const U=setTimeout(()=>{$(new Error("agent not active within 10 seconds"))},1e4),re=yield this.waitUntilActiveAgentPresent();clearTimeout(U),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),pt(t)));const de=yield this.streamBytes({name:"preconnect-buffer",mimeType:N,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[re.identity],attributes:{trackId:P.trackSid,sampleRate:String((q=M.sampleRate)!==null&&q!==void 0?q:"48000"),channels:String((ne=M.channelCount)!==null&&ne!==void 0?ne:"1")}});try{for(var z=!0,G=Mo(I),J;J=yield G.next(),V=J.done,!V;z=!0){W=J.value,z=!1;const ce=W;yield de.write(ce)}}catch(ce){H={error:ce}}finally{try{!z&&!V&&(B=G.return)&&(yield B.call(G))}finally{if(H)throw H.error}}yield de.close(),j()}catch(U){$(U)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),pt(t)))}).catch(j=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),pt(t)),{error:j}))})}return P})}get isLocal(){return!0}publishAdditionalCodecForTrack(t,n,i){return K(this,void 0,void 0,function*(){var s;if(this.encryptionType!==On.NONE)return;let r;if(this.trackPublications.forEach(y=>{y.track&&y.track===t&&(r=y)}),!r)throw new Ao("track is not published");if(!fa(t))throw new Ao("track is not a video track");const o=Object.assign(Object.assign({},(s=this.roomOptions)===null||s===void 0?void 0:s.publishDefaults),i),a=zW(t,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),pt(t)));return}const c=t.addSimulcastTrack(n,a);if(!c)return;const u=new lf({cid:c.mediaStreamTrack.id,type:pe.kindToProto(t.kind),muted:t.isMuted,source:pe.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(u.layers=IP(u.width,u.height,a),!this.engine||this.engine.isClosed)throw new yn("cannot publish track when not connected");const h=()=>K(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(t,c,o,a),yield this.engine.negotiate()}),m=(yield Promise.all([this.engine.addTrack(u),h()]))[0];this.log.debug("published ".concat(n," for track ").concat(t.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:m}))})}unpublishTrack(t,n){return K(this,void 0,void 0,function*(){var i,s;if(wu(t)){const u=this.pendingPublishPromises.get(t);u&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),pt(t))),yield u)}const r=this.getPublicationForTrack(t),o=r?pt(r):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!r||!r.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}t=r.track,t.off(xe.Muted,this.onTrackMuted),t.off(xe.Unmuted,this.onTrackUnmuted),t.off(xe.Ended,this.handleTrackEnded),t.off(xe.UpstreamPaused,this.onTrackUpstreamPaused),t.off(xe.UpstreamResumed,this.onTrackUpstreamResumed),t.off(xe.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(s=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&s!==void 0?s:!0),n?t.stop():t.stopMonitor();let a=!1;const c=t.sender;if(t.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<an.FAILED&&c)try{for(const u of this.engine.pcManager.publisher.getTransceivers())u.sender===c&&(u.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),fa(t)){for(const[,u]of t.simulcastCodecs)u.sender&&(this.engine.removeTrack(u.sender)&&(a=!0),u.sender=void 0);t.simulcastCodecs.clear()}}catch(u){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:u}))}switch(this.trackPublications.delete(r.trackSid),r.kind){case pe.Kind.Audio:this.audioTrackPublications.delete(r.trackSid);break;case pe.Kind.Video:this.videoTrackPublications.delete(r.trackSid);break}return this.emit(Te.LocalTrackUnpublished,r),r.setTrack(void 0),a&&(yield this.engine.negotiate()),r})}unpublishTracks(t){return K(this,void 0,void 0,function*(){return(yield Promise.all(t.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(t){return K(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new qi((r,o)=>K(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>K(this,void 0,void 0,function*(){const u=c.track;yield this.unpublishTrack(u,!1),s&&!u.isMuted&&u.source!==pe.Source.ScreenShare&&u.source!==pe.Source.ScreenShareAudio&&(So(u)||fa(u))&&!u.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield u.restartTrack()),yield this.publishOrRepublishTrack(u,c.options,!0)}))),r()}catch(a){a instanceof Error?o(a):o(new Error(String(a)))}finally{this.republishPromise=void 0}})),yield i.republishPromise})()})}publishData(t){return K(this,arguments,void 0,function(n){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const r=s.reliable?ut.RELIABLE:ut.LOSSY,o=s.destinationIdentities,a=s.topic;let c=new qC({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a});const u=new Ti({kind:r,value:{case:"user",value:c}});yield i.engine.sendDataPacket(u,r)})()})}publishDtmf(t,n){return K(this,void 0,void 0,function*(){const i=new Ti({kind:ut.RELIABLE,value:{case:"sipDtmf",value:new bO({code:t,digit:n})}});yield this.engine.sendDataPacket(i,ut.RELIABLE)})}sendChatMessage(t,n){return K(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:t,timestamp:Date.now(),attachedFiles:n?.attachments},s=new Ti({value:{case:"chatMessage",value:new tv(Object.assign(Object.assign({},i),{timestamp:Jt.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(s,ut.RELIABLE),this.emit(Te.ChatMessage,i),i})}editChatMessage(t,n){return K(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:t,editTimestamp:Date.now()}),s=new Ti({value:{case:"chatMessage",value:new tv(Object.assign(Object.assign({},i),{timestamp:Jt.parse(i.timestamp),editTimestamp:Jt.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(s,ut.RELIABLE),this.emit(Te.ChatMessage,i),i})}sendText(t,n){return K(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(t,n)})}streamText(t){return K(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(t)})}sendFile(t,n){return K(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(t,n)})}streamBytes(t){return K(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(t)})}performRpc(t){let{destinationIdentity:n,method:i,payload:s,responseTimeout:r=15e3}=t;const o=7e3,a=o+1e3;return new qi((c,u)=>K(this,void 0,void 0,function*(){var h,f,m,y;if(ck(s)>M5){u(un.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((f=(h=this.engine.latestJoinResponse)===null||h===void 0?void 0:h.serverInfo)===null||f===void 0)&&f.version&&$r((y=(m=this.engine.latestJoinResponse)===null||m===void 0?void 0:m.serverInfo)===null||y===void 0?void 0:y.version,"1.8.0")<0){u(un.builtIn("UNSUPPORTED_SERVER"));return}const b=Math.max(r,a),S=crypto.randomUUID();yield this.publishRpcRequest(n,S,i,s,b);const _=setTimeout(()=>{this.pendingAcks.delete(S),u(un.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(S),clearTimeout(w)},o);this.pendingAcks.set(S,{resolve:()=>{clearTimeout(_)},participantIdentity:n});const w=setTimeout(()=>{this.pendingResponses.delete(S),u(un.builtIn("RESPONSE_TIMEOUT"))},r);this.pendingResponses.set(S,{resolve:(M,R)=>{clearTimeout(w),this.pendingAcks.has(S)&&(this.log.warn("RPC response received before ack",S),this.pendingAcks.delete(S),clearTimeout(_)),R?u(R):c(M??"")},participantIdentity:n})}))}registerRpcMethod(t,n){this.rpcHandlers.has(t)&&this.log.warn("you're overriding the RPC handler for method ".concat(t,", in the future this will throw an error")),this.rpcHandlers.set(t,n)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setTrackSubscriptionPermissions(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=t,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(t){const n=this.pendingAcks.get(t);n?(n.resolve(),this.pendingAcks.delete(t)):console.error("Ack received for unexpected RPC request",t)}handleIncomingRpcResponse(t,n,i){const s=this.pendingResponses.get(t);s?(s.resolve(n,i),this.pendingResponses.delete(t)):console.error("Response received for unexpected RPC request",t)}publishRpcRequest(t,n,i,s,r){return K(this,void 0,void 0,function*(){const o=new Ti({destinationIdentities:[t],kind:ut.RELIABLE,value:{case:"rpcRequest",value:new HC({id:n,method:i,payload:s,responseTimeoutMs:r,version:1})}});yield this.engine.sendDataPacket(o,ut.RELIABLE)})}handleParticipantDisconnected(t){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===t&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:s}]of this.pendingResponses)i===t&&(s(null,un.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(t){this.enabledPublishVideoCodecs=t.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(t){return super.updateInfo(t)?(t.tracks.forEach(n=>{var i,s;const r=this.trackPublications.get(n.sid);if(r){const o=r.isMuted||((s=(i=r.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&s!==void 0?s:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),pt(r)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(t){var n,i,s,r;this.firstActiveAgent=t,t&&!this.firstActiveAgent&&(this.firstActiveAgent=t),t?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,t):(r=(s=this.activeAgentFuture)===null||s===void 0?void 0:s.reject)===null||r===void 0||r.call(s,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Bs),this.activeAgentFuture.promise)}getPublicationForTrack(t){let n;return this.trackPublications.forEach(i=>{const s=i.track;s&&(t instanceof MediaStreamTrack?(So(s)||fa(s))&&s.mediaStreamTrack===t&&(n=i):t===s&&(n=i))}),n}waitForPendingPublicationOfSource(t){return K(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const s=Array.from(this.pendingPublishPromises.entries()).find(r=>{let[o]=r;return o.source===t});if(s)return s[1];yield oi(20)}})}}class dG extends ko{constructor(t,n,i,s){super(t,n.sid,n.name,s),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=r=>{this.setTrack(void 0),this.emit(xe.Ended,r)},this.handleVisibilityChange=r=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(r),this.logContext),this.visible=r,this.emitTrackUpdate()},this.handleVideoDimensionsChange=r=>{this.log.debug("adaptivestream video dimensions ".concat(r.width,"x").concat(r.height),this.logContext),this.videoDimensionsAdaptiveStream=r,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(t){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const s=new ty({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new SO({participantSid:"",trackSids:[this.trackSid]})]});this.emit(xe.UpdateSubscription,s),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?ko.SubscriptionStatus.Unsubscribed:super.isSubscribed?ko.SubscriptionStatus.Subscribed:ko.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?ko.PermissionStatus.Allowed:ko.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(t){!this.isManualOperationAllowed()||this.requestedDisabled===!t||(this.requestedDisabled=!t,this.emitTrackUpdate())}setVideoQuality(t){!this.isManualOperationAllowed()||this.requestedMaxQuality===t||(this.requestedMaxQuality=t,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(t){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===t.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===t.height||(E0(this.track)&&(this.requestedVideoDimensions=t),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(t){this.isManualOperationAllowed()&&E0(this.track)&&this.fps!==t&&(this.fps=t,this.emitTrackUpdate())}get videoQuality(){var t;return(t=this.requestedMaxQuality)!==null&&t!==void 0?t:cs.HIGH}setTrack(t){const n=this.subscriptionStatus,i=this.permissionStatus,s=this.track;s!==t&&(s&&(s.off(xe.VideoDimensionsChanged,this.handleVideoDimensionsChange),s.off(xe.VisibilityChanged,this.handleVisibilityChange),s.off(xe.Ended,this.handleEnded),s.detach(),s.stopMonitor(),this.emit(xe.Unsubscribed,s)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(xe.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(xe.VisibilityChanged,this.handleVisibilityChange),t.on(xe.Ended,this.handleEnded),this.emit(xe.Subscribed,t)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(t){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=t,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(t){this.emit(xe.SubscriptionFailed,t)}updateInfo(t){super.updateInfo(t);const n=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):n!==t.muted&&this.emit(t.muted?xe.Muted:xe.Unmuted)}emitSubscriptionUpdateIfChanged(t){const n=this.subscriptionStatus;t!==n&&this.emit(xe.SubscriptionStatusChanged,n,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(xe.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return E0(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=new AO({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===pe.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)cP(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=MV(this.trackInfo,this.requestedMaxQuality);i&&cP(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(t.width=Math.ceil(n.width),t.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),t.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:cs.HIGH})),t.quality=cs.HIGH)}this.emit(xe.UpdateSettings,t)}}class lv extends j5{static fromParticipantInfo(t,n,i){return new lv(t,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(t,n,i,s,r,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:af.STANDARD;super(n,i||"",s,r,o,a,c),this.signalClient=t,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(xe.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),pt(t)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),t.on(xe.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),t.on(xe.SubscriptionPermissionChanged,n=>{this.emit(Te.TrackSubscriptionPermissionChanged,t,n)}),t.on(xe.SubscriptionStatusChanged,n=>{this.emit(Te.TrackSubscriptionStatusChanged,t,n)}),t.on(xe.Subscribed,n=>{this.emit(Te.TrackSubscribed,n,t)}),t.on(xe.Unsubscribed,n=>{this.emit(Te.TrackUnsubscribed,n,t)}),t.on(xe.SubscriptionFailed,n=>{this.emit(Te.TrackSubscriptionFailed,t.trackSid,n)})}getTrackPublication(t){const n=super.getTrackPublication(t);if(n)return n}getTrackPublicationByName(t){const n=super.getTrackPublicationByName(t);if(n)return n}setVolume(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pe.Source.Microphone;this.volumeMap.set(n,t);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(t)}getVolume(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pe.Source.Microphone;const n=this.getTrackPublication(t);return n&&n.track?n.track.getVolume():this.volumeMap.get(t)}addSubscribedMediaTrack(t,n,i,s,r,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(h=>{!a&&t.kind===h.kind.toString()&&(a=h)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(Te.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(t,n,i,s,r,o-1)},150);return}if(t.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),pt(a))),this.emit(Te.TrackSubscriptionFailed,n);return}const c=t.kind==="video";let u;return c?u=new rG(t,n,s,r):u=new sG(t,n,s,this.audioContext,this.audioOutput),u.source=a.source,u.isMuted=a.isMuted,u.setMediaStream(i),u.start(),a.setTrack(u),this.volumeMap.has(a.source)&&Nx(u)&&Dr(u)&&u.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(t){return this.trackPublications.get(t)}updateInfo(t){if(!super.updateInfo(t))return!1;const n=new Map,i=new Map;return t.tracks.forEach(s=>{var r,o;let a=this.getTrackPublicationBySid(s.sid);if(a)a.updateInfo(s);else{const c=pe.kindFromProto(s.type);if(!c)return;a=new dG(c,s,(r=this.signalClient.connectOptions)===null||r===void 0?void 0:r.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(s),i.set(s.sid,a);const u=Array.from(this.trackPublications.values()).find(h=>h.source===a?.source);u&&a.source!==pe.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:pt(u),newTrack:pt(a)})),this.addTrackPublication(a)}n.set(s.sid,a)}),this.trackPublications.forEach(s=>{n.has(s.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),pt(s))),this.unpublishTrack(s.trackSid,!0))}),i.forEach(s=>{this.emit(Te.TrackPublished,s)}),!0}unpublishTrack(t,n){const i=this.trackPublications.get(t);if(!i)return;const{track:s}=i;switch(s&&(s.stop(),i.setTrack(void 0)),this.trackPublications.delete(t),i.kind){case pe.Kind.Audio:this.audioTrackPublications.delete(t);break;case pe.Kind.Video:this.videoTrackPublications.delete(t);break}n&&this.emit(Te.TrackUnpublished,i)}setAudioOutput(t){return K(this,void 0,void 0,function*(){this.audioOutput=t;const n=[];this.audioTrackPublications.forEach(i=>{var s;Dr(i.track)&&Nx(i.track)&&n.push(i.track.setSinkId((s=t.deviceId)!==null&&s!==void 0?s:"default"))}),yield Promise.all(n)})}emit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:t,args:i})),super.emit(t,...i)}}var Mt;(function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.SignalReconnecting="signalReconnecting"})(Mt||(Mt={}));const hG=4*1e3;class Iu extends Gr.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(t){var n,i,s,r,o;if(super(),n=this,this.state=Mt.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=nt,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(a,c,u)=>K(this,void 0,void 0,function*(){var h;if(!DV())throw zr()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const f=yield this.disconnectLock.lock();if(this.state===Mt.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),f(),Promise.resolve();if(this.connectFuture)return f(),this.connectFuture.promise;this.setAndEmitConnectionState(Mt.Connecting),((h=this.regionUrlProvider)===null||h===void 0?void 0:h.getServerUrl().toString())!==k5(a)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Nu(new URL(a))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new kt(a,c):this.regionUrlProvider.updateToken(c),this.regionUrlProvider.fetchRegionSettings().then(b=>{var S;(S=this.regionUrlProvider)===null||S===void 0||S.setServerReportedRegions(b)}).catch(b=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:b}))}));const m=(b,S,_)=>K(this,void 0,void 0,function*(){var w,M;this.abortController&&this.abortController.abort();const R=new AbortController;this.abortController=R,f?.();try{if(yield Cu.getInstance().getBackOffPromise(a),R.signal.aborted)throw ze.cancelled("Connection attempt aborted");yield this.attemptConnection(_??a,c,u,R),this.abortController=void 0,b()}catch(E){if(this.regionUrlProvider&&E instanceof ze&&E.reason!==Ht.Cancelled&&E.reason!==Ht.NotAllowed){let A=null;try{this.log.debug("Fetching next region"),A=yield this.regionUrlProvider.getNextBestRegionUrl((w=this.abortController)===null||w===void 0?void 0:w.signal)}catch(T){if(T instanceof ze&&(T.status===401||T.reason===Ht.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),S(T);return}}[Ht.InternalError,Ht.ServerUnreachable,Ht.Timeout].includes(E.reason)&&(this.log.debug("Adding failed connection attempt to back off"),Cu.getInstance().addFailedConnectionAttempt(a)),A&&!(!((M=this.abortController)===null||M===void 0)&&M.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(E.message,". Retrying with another region: ").concat(A),this.logContext),this.recreateEngine(),yield m(b,S,A)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,gP(E)),S(E))}else{let A=sr.UNKNOWN_REASON;E instanceof ze&&(A=gP(E)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,A),S(E)}}}),y=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Bs((b,S)=>{m(b,S,y)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(a,c,u,h,f,m)=>K(this,void 0,void 0,function*(){var y,b,S;const _=yield u.join(a,c,{autoSubscribe:h.autoSubscribe,adaptiveStream:typeof f.adaptiveStream=="object"?!0:f.adaptiveStream,maxRetries:h.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:h.websocketTimeout},m.signal,!f.singlePeerConnection);let w=_.serverInfo;if(w||(w={version:_.serverVersion,region:_.serverRegion}),this.serverInfo=w,this.log.debug("connected to Livekit Server ".concat(Object.entries(w).map(M=>{let[R,E]=M;return"".concat(R,": ").concat(E)}).join(", ")),{room:(y=_.room)===null||y===void 0?void 0:y.name,roomSid:(b=_.room)===null||b===void 0?void 0:b.sid,identity:(S=_.participant)===null||S===void 0?void 0:S.identity}),!w.version)throw new vV("unknown server version");return w.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),f.dynacast=!1),_}),this.applyJoinResponse=a=>{const c=a.participant;if(this.localParticipant.sid=c.sid,this.localParticipant.identity=c.identity,this.localParticipant.setEnabledPublishCodecs(a.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(a.sifTrailer)}catch(u){this.log.error(u instanceof Error?u.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:u}))}this.handleParticipantUpdates([c,...a.otherParticipants]),a.room&&this.handleRoomUpdate(a.room)},this.attemptConnection=(a,c,u,h)=>K(this,void 0,void 0,function*(){var f,m;this.state===Mt.Reconnecting||this.isResuming||!((f=this.engine)===null||f===void 0)&&f.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((m=this.regionUrlProvider)===null||m===void 0)&&m.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},lk),u),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const y=yield this.connectSignal(a,c,this.engine,this.connOptions,this.options,h);this.applyJoinResponse(y),this.setupLocalParticipantEvents(),this.emit(ge.SignalConnected)}catch(y){yield this.engine.close(),this.recreateEngine();const b=h.signal.aborted?ze.cancelled("Signal connection aborted"):ze.serverUnreachable("could not establish signal connection");throw y instanceof Error&&(b.message="".concat(b.message,": ").concat(y.message)),y instanceof ze&&(b.reason=y.reason,b.status=y.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:y})),b}if(h.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),ze.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,h)}catch(y){throw yield this.engine.close(),this.recreateEngine(),y}Hi()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Hi()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Mt.Connected),this.emit(ge.Connected),Cu.getInstance().resetFailedConnectionAttempts(a),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var a=arguments.length,c=new Array(a),u=0;u<a;u++)c[u]=arguments[u];return K(n,[...c],void 0,function(){var h=this;let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var m,y,b;const S=yield h.disconnectLock.lock();try{if(h.state===Mt.Disconnected){h.log.debug("already disconnected",h.logContext);return}if(h.log.info("disconnect from room",Object.assign({},h.logContext)),h.state===Mt.Connecting||h.state===Mt.Reconnecting||h.isResuming){const _="Abort connection attempt due to user initiated disconnect";h.log.warn(_,h.logContext),(m=h.abortController)===null||m===void 0||m.abort(_),(b=(y=h.connectFuture)===null||y===void 0?void 0:y.reject)===null||b===void 0||b.call(y,ze.cancelled("Client initiated disconnect")),h.connectFuture=void 0}h.engine&&(h.engine.client.isDisconnected||(yield h.engine.client.sendLeave()),yield h.engine.close()),h.handleDisconnect(f,sr.CLIENT_INITIATED),h.engine=void 0}finally{S()}})()})},this.onPageLeave=()=>K(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>K(this,void 0,void 0,function*(){const a=[],c=Vi();if(c&&c.os==="iOS"){const u="livekit-dummy-audio-el";let h=document.getElementById(u);if(!h){h=document.createElement("audio"),h.id=u,h.autoplay=!0,h.hidden=!0;const f=T0();f.enabled=!0;const m=new MediaStream([f]);h.srcObject=m,document.addEventListener("visibilitychange",()=>{h&&(h.srcObject=document.hidden?null:m,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(h),this.once(ge.Disconnected,()=>{h?.remove(),h=null})}a.push(h)}this.remoteParticipants.forEach(u=>{u.audioTrackPublications.forEach(h=>{h.track&&h.track.attachedElements.forEach(f=>{a.push(f)})})});try{yield Promise.all([this.acquireAudioContext(),...a.map(u=>(u.muted=!1,u.play()))]),this.handleAudioPlaybackStarted()}catch(u){throw this.handleAudioPlaybackFailed(u),u}}),this.startVideo=()=>K(this,void 0,void 0,function*(){const a=[];for(const c of this.remoteParticipants.values())c.videoTrackPublications.forEach(u=>{var h;(h=u.track)===null||h===void 0||h.attachedElements.forEach(f=>{a.includes(f)||a.push(f)})});yield Promise.all(a.map(c=>c.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(c=>{c.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const a of this.remoteParticipants.values())this.handleParticipantDisconnected(a.identity,a);this.setAndEmitConnectionState(Mt.Reconnecting)&&this.emit(ge.Reconnecting)},this.handleSignalRestarted=a=>K(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(a.serverRegion),Object.assign(Object.assign({},this.logContext),{region:a.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(a);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(c){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:c}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:a.serverRegion}))}catch{return}this.setAndEmitConnectionState(Mt.Connected),this.emit(ge.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=a=>{a.forEach(c=>{var u;if(c.identity===this.localParticipant.identity){this.localParticipant.updateInfo(c);return}c.identity===""&&(c.identity=(u=this.sidToIdentity.get(c.sid))!==null&&u!==void 0?u:"");let h=this.remoteParticipants.get(c.identity);c.state===yu.DISCONNECTED?this.handleParticipantDisconnected(c.identity,h):h=this.getOrCreateParticipant(c.identity,c)})},this.handleActiveSpeakersUpdate=a=>{const c=[],u={};a.forEach(h=>{if(u[h.sid]=!0,h.sid===this.localParticipant.sid)this.localParticipant.audioLevel=h.level,this.localParticipant.setIsSpeaking(!0),c.push(this.localParticipant);else{const f=this.getRemoteParticipantBySid(h.sid);f&&(f.audioLevel=h.level,f.setIsSpeaking(!0),c.push(f))}}),u[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(h=>{u[h.sid]||(h.audioLevel=0,h.setIsSpeaking(!1))}),this.activeSpeakers=c,this.emitWhenConnected(ge.ActiveSpeakersChanged,c)},this.handleSpeakersChanged=a=>{const c=new Map;this.activeSpeakers.forEach(h=>{const f=this.remoteParticipants.get(h.identity);f&&f.sid!==h.sid||c.set(h.sid,h)}),a.forEach(h=>{let f=this.getRemoteParticipantBySid(h.sid);h.sid===this.localParticipant.sid&&(f=this.localParticipant),f&&(f.audioLevel=h.level,f.setIsSpeaking(h.active),h.active?c.set(h.sid,f):c.delete(h.sid))});const u=Array.from(c.values());u.sort((h,f)=>f.audioLevel-h.audioLevel),this.activeSpeakers=u,this.emitWhenConnected(ge.ActiveSpeakersChanged,u)},this.handleStreamStateUpdate=a=>{a.streamStates.forEach(c=>{const u=this.getRemoteParticipantBySid(c.participantSid);if(!u)return;const h=u.getTrackPublicationBySid(c.trackSid);if(!h||!h.track)return;const f=pe.streamStateFromProto(c.state);h.track.setStreamState(f),f!==h.track.streamState&&(u.emit(Te.TrackStreamStateChanged,h,h.track.streamState),this.emitWhenConnected(ge.TrackStreamStateChanged,h,h.track.streamState,u))})},this.handleSubscriptionPermissionUpdate=a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const u=c.getTrackPublicationBySid(a.trackSid);u&&u.setAllowed(a.allowed)},this.handleSubscriptionError=a=>{const c=Array.from(this.remoteParticipants.values()).find(h=>h.trackPublications.has(a.trackSid));if(!c)return;const u=c.getTrackPublicationBySid(a.trackSid);u&&u.setSubscriptionError(a.err)},this.handleDataPacket=(a,c)=>{const u=this.remoteParticipants.get(a.participantIdentity);if(a.value.case==="user")this.handleUserPacket(u,a.value.value,a.kind,c);else if(a.value.case==="transcription")this.handleTranscription(u,a.value.value);else if(a.value.case==="sipDtmf")this.handleSipDtmf(u,a.value.value);else if(a.value.case==="chatMessage")this.handleChatMessage(u,a.value.value);else if(a.value.case==="metrics")this.handleMetrics(a.value.value,u);else if(a.value.case==="streamHeader"||a.value.case==="streamChunk"||a.value.case==="streamTrailer")this.handleDataStream(a,c);else if(a.value.case==="rpcRequest"){const h=a.value.value;this.handleIncomingRpcRequest(a.participantIdentity,h.id,h.method,h.payload,h.responseTimeoutMs,h.version)}},this.handleUserPacket=(a,c,u,h)=>{this.emit(ge.DataReceived,c.payload,a,u,c.topic,h),a?.emit(Te.DataReceived,c.payload,u,h)},this.handleSipDtmf=(a,c)=>{this.emit(ge.SipDTMFReceived,c,a),a?.emit(Te.SipDTMFReceived,c)},this.handleTranscription=(a,c)=>{const u=c.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(c.transcribedParticipantIdentity),h=u?.trackPublications.get(c.trackId),f=HV(c,this.transcriptionReceivedTimes);h?.emit(xe.TranscriptionReceived,f),u?.emit(Te.TranscriptionReceived,f,h),this.emit(ge.TranscriptionReceived,f,u,h)},this.handleChatMessage=(a,c)=>{const u=VV(c);this.emit(ge.ChatMessage,u,a)},this.handleMetrics=(a,c)=>{this.emit(ge.MetricsReceived,a,c)},this.handleDataStream=(a,c)=>{this.incomingDataStreamManager.handleDataStreamPacket(a,c)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(ge.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=a=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:a})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(ge.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(ge.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(ge.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>K(this,void 0,void 0,function*(){var a;((a=Vi())===null||a===void 0?void 0:a.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(ge.MediaDevicesChanged)}),this.handleRoomUpdate=a=>{const c=this.roomInfo;this.roomInfo=a,c&&c.metadata!==a.metadata&&this.emitWhenConnected(ge.RoomMetadataChanged,a.metadata),c?.activeRecording!==a.activeRecording&&this.emitWhenConnected(ge.RecordingStatusChanged,a.activeRecording)},this.handleConnectionQualityUpdate=a=>{a.updates.forEach(c=>{if(c.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(c.quality);return}const u=this.getRemoteParticipantBySid(c.participantSid);u&&u.setConnectionQuality(c.quality)})},this.onLocalParticipantMetadataChanged=a=>{this.emit(ge.ParticipantMetadataChanged,a,this.localParticipant)},this.onLocalParticipantNameChanged=a=>{this.emit(ge.ParticipantNameChanged,a,this.localParticipant)},this.onLocalAttributesChanged=a=>{this.emit(ge.ParticipantAttributesChanged,a,this.localParticipant)},this.onLocalTrackMuted=a=>{this.emit(ge.TrackMuted,a,this.localParticipant)},this.onLocalTrackUnmuted=a=>{this.emit(ge.TrackUnmuted,a,this.localParticipant)},this.onTrackProcessorUpdate=a=>{var c;(c=a?.onPublish)===null||c===void 0||c.call(a,this)},this.onLocalTrackPublished=a=>K(this,void 0,void 0,function*(){var c,u,h,f,m,y;(c=a.track)===null||c===void 0||c.on(xe.TrackProcessorUpdate,this.onTrackProcessorUpdate),(u=a.track)===null||u===void 0||u.on(xe.Restarted,this.onLocalTrackRestarted),(m=(f=(h=a.track)===null||h===void 0?void 0:h.getProcessor())===null||f===void 0?void 0:f.onPublish)===null||m===void 0||m.call(f,this),this.emit(ge.LocalTrackPublished,a,this.localParticipant),So(a.track)&&(yield a.track.checkForSilence())&&this.emit(ge.LocalAudioSilenceDetected,a);const b=yield(y=a.track)===null||y===void 0?void 0:y.getDeviceId(!1),S=Mx(a.source);S&&b&&b!==this.localParticipant.activeDeviceMap.get(S)&&(this.localParticipant.activeDeviceMap.set(S,b),this.emit(ge.ActiveDeviceChanged,S,b))}),this.onLocalTrackUnpublished=a=>{var c,u;(c=a.track)===null||c===void 0||c.off(xe.TrackProcessorUpdate,this.onTrackProcessorUpdate),(u=a.track)===null||u===void 0||u.off(xe.Restarted,this.onLocalTrackRestarted),this.emit(ge.LocalTrackUnpublished,a,this.localParticipant)},this.onLocalTrackRestarted=a=>K(this,void 0,void 0,function*(){const c=yield a.getDeviceId(!1),u=Mx(a.source);u&&c&&c!==this.localParticipant.activeDeviceMap.get(u)&&(this.log.debug("local track restarted, setting ".concat(u," ").concat(c," active"),this.logContext),this.localParticipant.activeDeviceMap.set(u,c),this.emit(ge.ActiveDeviceChanged,u,c))}),this.onLocalConnectionQualityChanged=a=>{this.emit(ge.ConnectionQualityChanged,a,this.localParticipant)},this.onMediaDevicesError=(a,c)=>{this.emit(ge.MediaDevicesError,a,c)},this.onLocalParticipantPermissionsChanged=a=>{this.emit(ge.ParticipantPermissionsChanged,a,this.localParticipant)},this.onLocalChatMessageSent=a=>{this.emit(ge.ChatMessage,a,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},CW),t),this.log=Oo((i=this.options.loggerName)!==null&&i!==void 0?i:cr.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},T5),t?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},E5),t?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},wW),t?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new eG,this.outgoingDataStreamManager=new iG(this.engine,this.log),this.disconnectLock=new Ei,this.localParticipant=new uG("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Ia(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Ia(this.options.audioCaptureDefaults.deviceId)),!((s=this.options.audioOutput)===null||s===void 0)&&s.deviceId&&this.switchActiveDevice("audiooutput",Ia(this.options.audioOutput.deviceId)).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),Hi()){const a=new AbortController;(o=(r=navigator.mediaDevices)===null||r===void 0?void 0:r.addEventListener)===null||o===void 0||o.call(r,"devicechange",this.handleDeviceChange,{signal:a.signal}),Iu.cleanupRegistry&&Iu.cleanupRegistry.register(this,()=>{a.abort()})}}registerTextStreamHandler(t,n){return this.incomingDataStreamManager.registerTextStreamHandler(t,n)}unregisterTextStreamHandler(t){return this.incomingDataStreamManager.unregisterTextStreamHandler(t)}registerByteStreamHandler(t,n){return this.incomingDataStreamManager.registerByteStreamHandler(t,n)}unregisterByteStreamHandler(t){return this.incomingDataStreamManager.unregisterByteStreamHandler(t)}registerRpcMethod(t,n){if(this.rpcHandlers.has(t))throw Error("RPC handler already registered for method ".concat(t,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(t,n)}unregisterRpcMethod(t){this.rpcHandlers.delete(t)}setE2EEEnabled(t){return K(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(t)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(t,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var t;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new oW(i,n),this.e2eeManager.on(Ra.ParticipantEncryptionStatusChanged,(s,r)=>{GV(r)&&(this.isE2EEEnabled=s),this.emit(ge.ParticipantEncryptionStatusChanged,s,r)}),this.e2eeManager.on(Ra.EncryptionError,(s,r)=>{const o=r?this.getParticipantByIdentity(r):void 0;this.emit(ge.EncryptionError,s,o)}),(t=this.e2eeManager)===null||t===void 0||t.setup(this))}get logContext(){var t;return{room:this.name,roomID:(t=this.roomInfo)===null||t===void 0?void 0:t.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var t,n;return(n=(t=this.roomInfo)===null||t===void 0?void 0:t.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return this.state===Mt.Disconnected?qi.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?qi.resolve(this.roomInfo.sid):new qi((t,n)=>{const i=s=>{s.sid!==""&&(this.engine.off(ke.RoomUpdate,i),t(s.sid))};this.engine.on(ke.RoomUpdate,i),this.once(ge.Disconnected,()=>{this.engine.off(ke.RoomUpdate,i),n(new yn("Room disconnected before room server id was available"))})})}get name(){var t,n;return(n=(t=this.roomInfo)===null||t===void 0?void 0:t.name)!==null&&n!==void 0?n:""}get metadata(){var t;return(t=this.roomInfo)===null||t===void 0?void 0:t.metadata}get numParticipants(){var t,n;return(n=(t=this.roomInfo)===null||t===void 0?void 0:t.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var t,n;return(n=(t=this.roomInfo)===null||t===void 0?void 0:t.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new XW(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(ke.ParticipantUpdate,this.handleParticipantUpdates).on(ke.RoomUpdate,this.handleRoomUpdate).on(ke.SpeakersChanged,this.handleSpeakersChanged).on(ke.StreamStateChanged,this.handleStreamStateUpdate).on(ke.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(ke.SubscriptionError,this.handleSubscriptionError).on(ke.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(ke.MediaTrackAdded,(t,n,i)=>{this.onTrackAdded(t,n,i)}).on(ke.Disconnected,t=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t)}).on(ke.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(ke.DataPacketReceived,this.handleDataPacket).on(ke.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Mt.SignalReconnecting)&&this.emit(ge.SignalReconnecting)}).on(ke.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Mt.Connected)&&this.emit(ge.Reconnected)}).on(ke.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Mt.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(ke.Restarting,this.handleRestarting).on(ke.SignalRestarted,this.handleSignalRestarted).on(ke.Offline,()=>{this.setAndEmitConnectionState(Mt.Reconnecting)&&this.emit(ge.Reconnecting)}).on(ke.DCBufferStatusChanged,(t,n)=>{this.emit(ge.DCBufferStatusChanged,t,n)}).on(ke.LocalTrackSubscribed,t=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:s}=i;return s===t});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(Te.LocalTrackSubscribed,n),this.emitWhenConnected(ge.LocalTrackSubscribed,n,this.localParticipant)}).on(ke.RoomMoved,t=>{this.log.debug("room moved",t),t.room&&this.handleRoomUpdate(t.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(ge.Moved,t.room.name),t.participant?this.handleParticipantUpdates([t.participant,...t.otherParticipants]):this.handleParticipantUpdates(t.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Gn.getInstance().getDevices(t,n)}prepareConnection(t,n){return K(this,void 0,void 0,function*(){if(this.state===Mt.Disconnected){this.log.debug("prepareConnection to ".concat(t),this.logContext);try{if(Nu(new URL(t))&&n){this.regionUrlProvider=new kt(t,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===Mt.Disconnected&&(this.regionUrl=i,yield fetch(df(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(df(t),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(t){return this.localParticipant.identity===t?this.localParticipant:this.remoteParticipants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(t,n){return K(this,void 0,void 0,function*(){let i=()=>K(this,void 0,void 0,function*(){}),s;switch(t){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":s=new Cr({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":s=new Cr({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":s=new Cr({scenario:{case:"serverLeave",value:!0}});break;case"migration":s=new Cr({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>K(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),s=new Cr({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>K(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),s=new Cr({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":s=new Cr({scenario:{case:"switchCandidateProtocol",value:t==="force-tls"?2:1}}),i=()=>K(this,void 0,void 0,function*(){const r=this.engine.client.onLeave;r&&r(new ny({reason:sr.CLIENT_INITIATED,action:bu.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");s=new Cr({scenario:{case:"subscriberBandwidth",value:xl(n)}});break;case"leave-full-reconnect":s=new Cr({scenario:{case:"leaveRequestFullReconnect",value:!0}})}s&&(yield this.engine.client.sendSimulateScenario(s),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(t){return this.localParticipant.activeDeviceMap.get(t)}switchActiveDevice(t,n){return K(this,arguments,void 0,function(i,s){var r=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var a,c,u,h,f,m,y;let b=!0,S=!1;const _=o?{exact:s}:s;if(i==="audioinput"){S=r.localParticipant.audioTrackPublications.size===0;const w=(a=r.getActiveDevice(i))!==null&&a!==void 0?a:r.options.audioCaptureDefaults.deviceId;r.options.audioCaptureDefaults.deviceId=_;const M=Array.from(r.localParticipant.audioTrackPublications.values()).filter(E=>E.source===pe.Source.Microphone);try{b=(yield Promise.all(M.map(E=>{var A;return(A=E.audioTrack)===null||A===void 0?void 0:A.setDeviceId(_)}))).every(E=>E===!0)}catch(E){throw r.options.audioCaptureDefaults.deviceId=w,E}const R=M.some(E=>{var A,T;return(T=(A=E.track)===null||A===void 0?void 0:A.isMuted)!==null&&T!==void 0?T:!1});b&&R&&(S=!0)}else if(i==="videoinput"){S=r.localParticipant.videoTrackPublications.size===0;const w=(c=r.getActiveDevice(i))!==null&&c!==void 0?c:r.options.videoCaptureDefaults.deviceId;r.options.videoCaptureDefaults.deviceId=_;const M=Array.from(r.localParticipant.videoTrackPublications.values()).filter(E=>E.source===pe.Source.Camera);try{b=(yield Promise.all(M.map(E=>{var A;return(A=E.videoTrack)===null||A===void 0?void 0:A.setDeviceId(_)}))).every(E=>E===!0)}catch(E){throw r.options.videoCaptureDefaults.deviceId=w,E}const R=M.some(E=>{var A,T;return(T=(A=E.track)===null||A===void 0?void 0:A.isMuted)!==null&&T!==void 0?T:!1});b&&R&&(S=!0)}else if(i==="audiooutput"){if(S=!0,!Lx()&&!r.options.webAudioMix||r.options.webAudioMix&&r.audioContext&&!("setSinkId"in r.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");r.options.webAudioMix&&(s=(u=yield Gn.getInstance().normalizeDeviceId("audiooutput",s))!==null&&u!==void 0?u:""),(h=(y=r.options).audioOutput)!==null&&h!==void 0||(y.audioOutput={});const w=(f=r.getActiveDevice(i))!==null&&f!==void 0?f:r.options.audioOutput.deviceId;r.options.audioOutput.deviceId=s;try{r.options.webAudioMix&&((m=r.audioContext)===null||m===void 0||m.setSinkId(s)),yield Promise.all(Array.from(r.remoteParticipants.values()).map(M=>M.setAudioOutput({deviceId:s})))}catch(M){throw r.options.audioOutput.deviceId=w,M}}return S&&(r.localParticipant.activeDeviceMap.set(i,s),r.emit(ge.ActiveDeviceChanged,i,s)),b})()})}setupLocalParticipantEvents(){this.localParticipant.on(Te.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(Te.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(Te.AttributesChanged,this.onLocalAttributesChanged).on(Te.TrackMuted,this.onLocalTrackMuted).on(Te.TrackUnmuted,this.onLocalTrackUnmuted).on(Te.LocalTrackPublished,this.onLocalTrackPublished).on(Te.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(Te.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(Te.MediaDevicesError,this.onMediaDevicesError).on(Te.AudioStreamAcquired,this.startAudio).on(Te.ChatMessage,this.onLocalChatMessageSent).on(Te.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var t;(t=this.engine)===null||t===void 0||t.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(t,n,i){if(this.state===Mt.Connecting||this.state===Mt.Reconnecting){const f=()=>{this.log.debug("deferring on track for later",{mediaTrackId:t.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(y=>y.id)}),this.onTrackAdded(t,n,i),m()},m=()=>{this.off(ge.Reconnected,f),this.off(ge.Connected,f),this.off(ge.Disconnected,m)};this.once(ge.Reconnected,f),this.once(ge.Connected,f),this.once(ge.Disconnected,m);return}if(this.state===Mt.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(t.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const s=LV(n.id),r=s[0];let o=s[1],a=t.id;if(o&&o.startsWith("TR")&&(a=o),r===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(f=>f.sid===r);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(r),this.logContext);return}if(!a.startsWith("TR")){const f=this.engine.getTrackIdForReceiver(i);if(!f){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(r),this.logContext);return}a=f}a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(r,", streamId: ").concat(o,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:r,streamId:o,trackId:a}));let u;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?u=this.options.adaptiveStream:u={});const h=c.addSubscribedMediaTrack(t,a,n,i,u);h?.isEncrypted&&!this.e2eeManager&&this.emit(ge.EncryptionError,new Error("Encrypted ".concat(h.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i,s;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Mt.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(o=>{r.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var o,a,c;r.track&&this.localParticipant.unpublishTrack(r.track,t),t?((o=r.track)===null||o===void 0||o.detach(),(a=r.track)===null||a===void 0||a.stop()):(c=r.track)===null||c===void 0||c.stopMonitor()}),this.localParticipant.off(Te.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(Te.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(Te.AttributesChanged,this.onLocalAttributesChanged).off(Te.TrackMuted,this.onLocalTrackMuted).off(Te.TrackUnmuted,this.onLocalTrackUnmuted).off(Te.LocalTrackPublished,this.onLocalTrackPublished).off(Te.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(Te.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(Te.MediaDevicesError,this.onMediaDevicesError).off(Te.AudioStreamAcquired,this.startAudio).off(Te.ChatMessage,this.onLocalChatMessageSent).off(Te.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Hi()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(s=(i=navigator.mediaDevices)===null||i===void 0?void 0:i.removeEventListener)===null||s===void 0||s.call(i,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Mt.Disconnected),this.emit(ge.Disconnected,n)}}}handleParticipantDisconnected(t,n){var i;this.remoteParticipants.delete(t),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(t),n.trackPublications.forEach(s=>{n.unpublishTrack(s.trackSid,!0)}),this.emit(ge.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(t,n,i,s,r,o){return K(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(t,n),o!==1){yield this.engine.publishRpcResponse(t,n,null,un.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(t,n,null,un.builtIn("UNSUPPORTED_METHOD"));return}let c=null,u=null;try{const h=yield a({requestId:n,callerIdentity:t,payload:s,responseTimeout:r});ck(h)>M5?(c=un.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):u=h}catch(h){h instanceof un?c=h:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),h),c=un.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(t,n,u,c)})}selectDefaultDevices(){return K(this,void 0,void 0,function*(){var t,n,i;const s=Gn.getInstance().previousDevices,r=yield Gn.getInstance().getDevices(void 0,!1),o=Vi();if(o?.name==="Chrome"&&o.os!=="iOS")for(let c of r){const u=s.find(h=>h.deviceId===c.deviceId);u&&u.label!==""&&u.kind===c.kind&&u.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(ge.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const u=wV(c),h=this.localParticipant.getTrackPublication(u);if(h&&(!((t=h.track)===null||t===void 0)&&t.isUserProvided))continue;const f=r.filter(y=>y.kind===c),m=this.getActiveDevice(c);if(m===((n=s.filter(y=>y.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&f.length>0&&((i=f[0])===null||i===void 0?void 0:i.deviceId)!==m){yield this.switchActiveDevice(c,f[0].deviceId);continue}c==="audioinput"&&!uf()||c==="videoinput"||f.length>0&&!f.find(y=>y.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!uf())&&(yield this.switchActiveDevice(c,f[0].deviceId))}})}acquireAudioContext(){return K(this,void 0,void 0,function*(){var t,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(t=_5())!==null&&t!==void 0?t:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(s=>s.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),oi(200)])}catch(s){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:s}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(ge.AudioPlaybackStatusChanged,i))})}createParticipant(t,n){var i;let s;return n?s=lv.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):s=new lv(this.engine.client,"",t,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&s.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&s.setAudioOutput(this.options.audioOutput).catch(r=>this.log.warn("Could not set audio output: ".concat(r.message),this.logContext)),s}getOrCreateParticipant(t,n){if(this.remoteParticipants.has(t)){const s=this.remoteParticipants.get(t);return n&&s.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),s}const i=this.createParticipant(t,n);return this.remoteParticipants.set(t,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(ge.ParticipantConnected,i),i.on(Te.TrackPublished,s=>{this.emitWhenConnected(ge.TrackPublished,s,i)}).on(Te.TrackSubscribed,(s,r)=>{s.kind===pe.Kind.Audio?(s.on(xe.AudioPlaybackStarted,this.handleAudioPlaybackStarted),s.on(xe.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):s.kind===pe.Kind.Video&&(s.on(xe.VideoPlaybackFailed,this.handleVideoPlaybackFailed),s.on(xe.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(ge.TrackSubscribed,s,r,i)}).on(Te.TrackUnpublished,s=>{this.emit(ge.TrackUnpublished,s,i)}).on(Te.TrackUnsubscribed,(s,r)=>{this.emit(ge.TrackUnsubscribed,s,r,i)}).on(Te.TrackMuted,s=>{this.emitWhenConnected(ge.TrackMuted,s,i)}).on(Te.TrackUnmuted,s=>{this.emitWhenConnected(ge.TrackUnmuted,s,i)}).on(Te.ParticipantMetadataChanged,s=>{this.emitWhenConnected(ge.ParticipantMetadataChanged,s,i)}).on(Te.ParticipantNameChanged,s=>{this.emitWhenConnected(ge.ParticipantNameChanged,s,i)}).on(Te.AttributesChanged,s=>{this.emitWhenConnected(ge.ParticipantAttributesChanged,s,i)}).on(Te.ConnectionQualityChanged,s=>{this.emitWhenConnected(ge.ConnectionQualityChanged,s,i)}).on(Te.ParticipantPermissionsChanged,s=>{this.emitWhenConnected(ge.ParticipantPermissionsChanged,s,i)}).on(Te.TrackSubscriptionStatusChanged,(s,r)=>{this.emitWhenConnected(ge.TrackSubscriptionStatusChanged,s,r,i)}).on(Te.TrackSubscriptionFailed,(s,r)=>{this.emit(ge.TrackSubscriptionFailed,s,i,r)}).on(Te.TrackSubscriptionPermissionChanged,(s,r)=>{this.emitWhenConnected(ge.TrackSubscriptionPermissionChanged,s,r,i)}).on(Te.Active,()=>{this.emitWhenConnected(ge.ParticipantActive,i),i.kind===af.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const t=Array.from(this.remoteParticipants.values()).reduce((i,s)=>(i.push(...s.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(t,n)}updateSubscriptions(){for(const t of this.remoteParticipants.values())for(const n of t.videoTrackPublications.values())n.isSubscribed&&WV(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(t){const n=this.sidToIdentity.get(t);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let t=0;this.connectionReconcileInterval=ri.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(t++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:t,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),t>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,sr.STATE_MISMATCH))):t=0},hG)}clearConnectionReconcile(){this.connectionReconcileInterval&&ri.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(t){return t===this.state?!1:(this.state=t,this.emit(ge.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(t=>{let[n,i]=t;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];if(this.state===Mt.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([t,i]);else if(this.state===Mt.Connected)return this.emit(t,...i);return!1}simulateParticipants(t){return K(this,void 0,void 0,function*(){var n,i,s,r;const o=Object.assign({audio:!0,video:!0,useRealTracks:!1},t.publish),a=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.roomInfo=new Jv({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Jt.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Hl({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(ge.SignalConnected),this.emit(ge.Connected),this.setAndEmitConnectionState(Mt.Connected),o.video){const c=new Fx(pe.Kind.Video,new hu({source:En.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:er.AUDIO,name:"video-dummy"}),new av(o.useRealTracks&&(!((n=window.navigator.mediaDevices)===null||n===void 0)&&n.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:mP(160*((i=a.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(Te.LocalTrackPublished,c)}if(o.audio){const c=new Fx(pe.Kind.Audio,new hu({source:En.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:er.AUDIO}),new ov(o.useRealTracks&&(!((s=navigator.mediaDevices)===null||s===void 0)&&s.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:T0(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(c),this.localParticipant.emit(Te.LocalTrackPublished,c)}for(let c=0;c<a.count-1;c+=1){let u=new Hl({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(c),state:yu.ACTIVE,tracks:[],joinedAt:Jt.parse(Date.now())});const h=this.getOrCreateParticipant(u.identity,u);if(a.video){const f=mP(160*((r=a.aspectRatios[c%a.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),m=new hu({source:En.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:er.AUDIO});h.addSubscribedMediaTrack(f,m.sid,new MediaStream([f]),new RTCRtpReceiver),u.tracks=[...u.tracks,m]}if(a.audio){const f=T0(),m=new hu({source:En.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:er.AUDIO});h.addSubscribedMediaTrack(f,m.sid,new MediaStream([f]),new RTCRtpReceiver),u.tracks=[...u.tracks,m]}h.updateInfo(u)}})}emit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];if(t!==ge.ActiveSpeakersChanged&&t!==ge.TranscriptionReceived){const r=B5(i).filter(o=>o!==void 0);(t===ge.TrackSubscribed||t===ge.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:r})),this.log.debug("room event ".concat(t),Object.assign(Object.assign({},this.logContext),{event:t,args:r}))}return super.emit(t,...i)}}Iu.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(e=>{e()});function B5(e){return e.map(t=>{if(t)return Array.isArray(t)?B5(t):typeof t=="object"?"logContext"in t?t.logContext:void 0:t})}var Qs;(function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"})(Qs||(Qs={}));class Ha extends Gr.EventEmitter{constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Qs.IDLE,this.logs=[],this.options={},this.url=t,this.token=n,this.name=this.constructor.name,this.room=new Iu(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(t){return K(this,void 0,void 0,function*(){if(this.status!==Qs.IDLE)throw Error("check is running already");this.setStatus(Qs.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Qs.SKIPPED&&this.setStatus(this.isSuccess()?Qs.SUCCESS:Qs.FAILED),t&&t(),this.getInfo()})}isSuccess(){return!this.logs.some(t=>t.level==="error")}connect(t){return K(this,void 0,void 0,function*(){return this.room.state===Mt.Connected?this.room:(t||(t=this.url),yield this.room.connect(t,this.token,this.connectOptions),this.room)})}disconnect(){return K(this,void 0,void 0,function*(){this.room&&this.room.state!==Mt.Disconnected&&(yield this.room.disconnect(),yield new Promise(t=>setTimeout(t,500)))})}skip(){this.setStatus(Qs.SKIPPED)}switchProtocol(t){return K(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(ge.Reconnecting,()=>{n=!0}),this.room.once(ge.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(t)),yield new Promise(r=>setTimeout(r,1e3)),!n)return;const s=Date.now()+1e4;for(;Date.now()<s;){if(i)return;yield oi(100)}throw new Error("Could not reconnect using ".concat(t," protocol after 10 seconds"))})}appendMessage(t){this.logs.push({level:"info",message:t}),this.emit("update",this.getInfo())}appendWarning(t){this.logs.push({level:"warning",message:t}),this.emit("update",this.getInfo())}appendError(t){this.logs.push({level:"error",message:t}),this.emit("update",this.getInfo())}setStatus(t){this.status=t,this.emit("update",this.getInfo())}get engine(){var t;return(t=this.room)===null||t===void 0?void 0:t.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class fG extends Ha{get description(){return"Cloud regions"}perform(){return K(this,void 0,void 0,function*(){const t=new kt(this.url,this.token);if(!t.isCloud()){this.skip();return}const n=[],i=new Set;for(let r=0;r<3;r++){const o=yield t.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((r,o)=>(r.duration-o.duration)*.5+(r.rtt-o.rtt)*.5);const s=n[0];this.bestStats=s,this.appendMessage("best Cloud region: ".concat(s.region))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkCloudRegion(t){return K(this,void 0,void 0,function*(){var n,i;yield this.connect(t),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const s=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!s)throw new Error("Region not found");const r=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,u="A".repeat(o),h=Date.now();for(let b=0;b<c;b++)yield r.write(u);yield r.close();const f=Date.now(),m=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),y={region:s,rtt:1e4,duration:f-h};return m?.forEach(b=>{b.type==="candidate-pair"&&b.nominated&&(y.rtt=b.currentRoundTripTime*1e3)}),yield this.disconnect(),y})}}const D0=1e4;class pG extends Ha{get description(){return"Connection via UDP vs TCP"}perform(){return K(this,void 0,void 0,function*(){const t=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=t,t.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(t.packetsLost-n.packetsLost)/t.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(D0/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(D0/1e3)*100).toFixed(2),"%"))})}getInfo(){const t=super.getInfo();return t.data=this.bestStats,t}checkConnectionProtocol(t){return K(this,void 0,void 0,function*(){yield this.connect(),t==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let s=0;const r=()=>{s=(s+1)%360,i.fillStyle="hsl(".concat(s,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(r)};r();const a=n.captureStream(30).getVideoTracks()[0],u=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,h={protocol:t,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},f=setInterval(()=>K(this,void 0,void 0,function*(){const m=yield u.getRTCStatsReport();m?.forEach(y=>{y.type==="outbound-rtp"?(h.packetsSent=y.packetsSent,h.qualityLimitationDurations=y.qualityLimitationDurations,h.bitrateTotal+=y.targetBitrate,h.count++):y.type==="remote-inbound-rtp"&&(h.packetsLost=y.packetsLost,h.rttTotal+=y.roundTripTime,h.jitterTotal+=y.jitter)})}),1e3);return yield new Promise(m=>setTimeout(m,D0)),clearInterval(f),a.stop(),n.remove(),yield this.disconnect(),h})}}class mG extends Ha{get description(){return"Can publish audio"}perform(){return K(this,void 0,void 0,function*(){var t;const n=yield this.connect(),i=yield O5();if(yield b5(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const r=yield(t=i.sender)===null||t===void 0?void 0:t.getStats();if(!r)throw new Error("Could not get RTCStats");let o=0;if(r.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class gG extends Ha{get description(){return"Can publish video"}perform(){return K(this,void 0,void 0,function*(){var t;const n=yield this.connect(),i=yield aG();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const s=yield(t=i.sender)===null||t===void 0?void 0:t.getStats();if(!s)throw new Error("Could not get RTCStats");let r=0;if(s.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(r+=o.packetsSent)}),r===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(r," video packets"))})}checkForVideo(t){return K(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(t.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(s=>{i.onplay=()=>{setTimeout(()=>{var r,o,a,c;const u=document.createElement("canvas"),h=t.getSettings(),f=(o=(r=h.width)!==null&&r!==void 0?r:i.videoWidth)!==null&&o!==void 0?o:1280,m=(c=(a=h.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&c!==void 0?c:720;u.width=f,u.height=m;const y=u.getContext("2d");y.drawImage(i,0,0);const S=y.getImageData(0,0,u.width,u.height).data;let _=!0;for(let w=0;w<S.length;w+=4)if(S[w]!==0||S[w+1]!==0||S[w+2]!==0){_=!1;break}_?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),s()},1e3)},i.play()}),n.getTracks().forEach(s=>s.stop()),i.remove()})}}class vG extends Ha{get description(){return"Resuming connection after interruption"}perform(){return K(this,void 0,void 0,function*(){var t;const n=yield this.connect();let i=!1,s=!1,r;const o=new Promise(u=>{setTimeout(u,5e3),r=u}),a=()=>{i=!0};n.on(ge.SignalReconnecting,a).on(ge.Reconnecting,a).on(ge.Reconnected,()=>{s=!0,r(!0)}),(t=n.engine.client.ws)===null||t===void 0||t.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,i){if(!s||n.state!==Mt.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class yG extends Ha{get description(){return"Can connect via TURN"}perform(){return K(this,void 0,void 0,function*(){var t,n,i;Nu(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(t=yield new kt(this.url,this.token).getNextBestRegionUrl())!==null&&t!==void 0?t:this.url);const s=new sk,r=yield s.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let o=!1,a=!1,c=!1;for(let u of r.iceServers)for(let h of u.urls)h.startsWith("turn:")?(a=!0,c=!0):h.startsWith("turns:")&&(a=!0,c=!0,o=!0),h.startsWith("stun:")&&(c=!0);c?a&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield s.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(u=>setTimeout(u,0)))})}}class bG extends Ha{get description(){return"Establishing WebRTC connection"}perform(){return K(this,void 0,void 0,function*(){let t=!1,n=!1;this.room.on(ge.SignalConnected,()=>{var i;const s=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,o)=>{if(r.candidate){const a=new RTCIceCandidate(r);let c="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(_G(a.address)?c+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(t=!0,c+=" (passive)"):a.protocol==="udp"&&(n=!0)),this.appendMessage(c)}s&&s(r,o)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),nt.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}t||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function _G(e){const t=e.split(".");if(t.length===4){if(t[0]==="10")return!0;if(t[0]==="192"&&t[1]==="168")return!0;if(t[0]==="172"){const n=parseInt(t[1],10);if(n>=16&&n<=31)return!0}}return!1}class SG extends Ha{get description(){return"Connecting to signal connection via WebSocket"}perform(){return K(this,void 0,void 0,function*(){var t,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let s=new sk,r;try{r=yield s.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(o){if(Nu(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(o.message,". Retrying with region fallback"));const c=yield new kt(this.url,this.token).getNextBestRegionUrl();c&&(r=yield s.join(c,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}r?(this.appendMessage("Connected to server, version ".concat(r.serverVersion,".")),((t=r.serverInfo)===null||t===void 0?void 0:t.edition)===wO.Cloud&&(!((n=r.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=r.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield s.close()})}}class bSe extends Gr.EventEmitter{constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=t,this.token=n,this.options=i}getNextCheckId(){const t=this.checkResults.size;return this.checkResults.set(t,{logs:[],status:Qs.IDLE,name:"",description:""}),t}updateCheck(t,n){this.checkResults.set(t,n),this.emit("checkUpdate",t,n)}isSuccess(){return Array.from(this.checkResults.values()).every(t=>t.status!==Qs.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(t){return K(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new t(this.url,this.token,this.options),s=o=>{this.updateCheck(n,o)};i.on("update",s);const r=yield i.run();return i.off("update",s),r})}checkWebsocket(){return K(this,void 0,void 0,function*(){return this.createAndRunCheck(SG)})}checkWebRTC(){return K(this,void 0,void 0,function*(){return this.createAndRunCheck(bG)})}checkTURN(){return K(this,void 0,void 0,function*(){return this.createAndRunCheck(yG)})}checkReconnect(){return K(this,void 0,void 0,function*(){return this.createAndRunCheck(vG)})}checkPublishAudio(){return K(this,void 0,void 0,function*(){return this.createAndRunCheck(mG)})}checkPublishVideo(){return K(this,void 0,void 0,function*(){return this.createAndRunCheck(gG)})}checkConnectionProtocol(){return K(this,void 0,void 0,function*(){const t=yield this.createAndRunCheck(pG);if(t.data&&"protocol"in t.data){const n=t.data;this.options.protocol=n.protocol}return t})}checkCloudRegion(){return K(this,void 0,void 0,function*(){return this.createAndRunCheck(fG)})}}function vt(e,t,n){return(t=wG(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xG(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function wG(e){var t=xG(e,"string");return typeof t=="symbol"?t:t+""}new TextEncoder;new TextDecoder;class Mi extends Error{constructor(t,n){var i;super(t,n),vt(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}vt(Mi,"code","ERR_JOSE_GENERIC");class CG extends Mi{constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:i,reason:s,payload:n}}),vt(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),vt(this,"claim",void 0),vt(this,"reason",void 0),vt(this,"payload",void 0),this.claim=i,this.reason=s,this.payload=n}}vt(CG,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class kG extends Mi{constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(t,{cause:{claim:i,reason:s,payload:n}}),vt(this,"code","ERR_JWT_EXPIRED"),vt(this,"claim",void 0),vt(this,"reason",void 0),vt(this,"payload",void 0),this.claim=i,this.reason=s,this.payload=n}}vt(kG,"code","ERR_JWT_EXPIRED");class TG extends Mi{constructor(){super(...arguments),vt(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}vt(TG,"code","ERR_JOSE_ALG_NOT_ALLOWED");class EG extends Mi{constructor(){super(...arguments),vt(this,"code","ERR_JOSE_NOT_SUPPORTED")}}vt(EG,"code","ERR_JOSE_NOT_SUPPORTED");class RG extends Mi{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(t,n),vt(this,"code","ERR_JWE_DECRYPTION_FAILED")}}vt(RG,"code","ERR_JWE_DECRYPTION_FAILED");class MG extends Mi{constructor(){super(...arguments),vt(this,"code","ERR_JWE_INVALID")}}vt(MG,"code","ERR_JWE_INVALID");class AG extends Mi{constructor(){super(...arguments),vt(this,"code","ERR_JWS_INVALID")}}vt(AG,"code","ERR_JWS_INVALID");class PG extends Mi{constructor(){super(...arguments),vt(this,"code","ERR_JWT_INVALID")}}vt(PG,"code","ERR_JWT_INVALID");class LG extends Mi{constructor(){super(...arguments),vt(this,"code","ERR_JWK_INVALID")}}vt(LG,"code","ERR_JWK_INVALID");class NG extends Mi{constructor(){super(...arguments),vt(this,"code","ERR_JWKS_INVALID")}}vt(NG,"code","ERR_JWKS_INVALID");class IG extends Mi{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(t,n),vt(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}vt(IG,"code","ERR_JWKS_NO_MATCHING_KEY");class DG extends Mi{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(t,n),vt(this,Symbol.asyncIterator,void 0),vt(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}vt(DG,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class OG extends Mi{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(t,n),vt(this,"code","ERR_JWKS_TIMEOUT")}}vt(OG,"code","ERR_JWKS_TIMEOUT");class jG extends Mi{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(t,n),vt(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}vt(jG,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function Po(){return Po=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Po.apply(null,arguments)}const FP=new Uint8Array(0);let hf=class{static getFullOptions(t){return Po({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},t)}constructor(t,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(s){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect&&i.options.onDisconnect(s))},this.onMessage=async function(s){switch(s.type){case"interruption":return void i.handleInterruption(s);case"agent_response":return void i.handleAgentResponse(s);case"user_transcript":return void i.handleUserTranscript(s);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(s);case"client_tool_call":try{await i.handleClientToolCall(s)}catch(r){i.onError(`Unexpected error in client tool call handling: ${r instanceof Error?r.message:String(r)}`,{clientToolName:s.client_tool_call.tool_name,toolCallId:s.client_tool_call.tool_call_id})}return;case"audio":return void i.handleAudio(s);case"vad_score":return void i.handleVadScore(s);case"ping":return void i.connection.sendMessage({type:"pong",event_id:s.ping_event.event_id});case"mcp_tool_call":return void i.handleMCPToolCall(s);case"mcp_connection_status":return void i.handleMCPConnectionStatus(s);case"agent_tool_request":return void i.handleAgentToolRequest(s);case"agent_tool_response":return void i.handleAgentToolResponse(s);case"conversation_initiation_metadata":return void i.handleConversationMetadata(s);case"asr_initiation_metadata":return void i.handleAsrInitiationMetadata(s);case"agent_chat_response_part":return void i.handleAgentChatResponsePart(s);case"error":return void i.handleErrorEvent(s);default:return void(i.options.onDebug&&i.options.onDebug(s))}},this.setVolume=({volume:s})=>{this.volume=s},this.options=t,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(s=>this.updateMode(s)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(t){t!==this.mode&&(this.mode=t,this.options.onModeChange&&this.options.onModeChange({mode:t}))}updateStatus(t){t!==this.status&&(this.status=t,this.options.onStatusChange&&this.options.onStatusChange({status:t}))}updateCanSendFeedback(){const t=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==t&&(this.canSendFeedback=t,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:t}))}handleInterruption(t){t.interruption_event&&(this.lastInterruptTimestamp=t.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:t.interruption_event.event_id}))}handleAgentResponse(t){this.options.onMessage&&this.options.onMessage({source:"ai",role:"agent",message:t.agent_response_event.agent_response})}handleUserTranscript(t){this.options.onMessage&&this.options.onMessage({source:"user",role:"user",message:t.user_transcription_event.user_transcript})}handleTentativeAgentResponse(t){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:t.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(t){this.options.onVadScore&&this.options.onVadScore({vadScore:t.vad_score_event.vad_score})}async handleClientToolCall(t){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,t.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[t.client_tool_call.tool_name](t.client_tool_call.parameters))!=null?n:"Client tool execution successful.",s=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:t.client_tool_call.tool_call_id,result:s,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i?.message}`,{clientToolName:t.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:t.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i?.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(t.client_tool_call);this.onError(`Client tool with name ${t.client_tool_call.tool_name} is not defined on client`,{clientToolName:t.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:t.client_tool_call.tool_call_id,result:`Client tool with name ${t.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(t){}handleMCPToolCall(t){this.options.onMCPToolCall&&this.options.onMCPToolCall(t.mcp_tool_call)}handleMCPConnectionStatus(t){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(t.mcp_connection_status)}handleAgentToolRequest(t){this.options.onAgentToolRequest&&this.options.onAgentToolRequest(t.agent_tool_request)}handleAgentToolResponse(t){t.agent_tool_response.tool_name==="end_call"&&this.endSessionWithDetails({reason:"agent",context:new CloseEvent("end_call",{reason:"Agent ended the call"})}),this.options.onAgentToolResponse&&this.options.onAgentToolResponse(t.agent_tool_response)}handleConversationMetadata(t){this.options.onConversationMetadata&&this.options.onConversationMetadata(t.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(t){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(t.asr_initiation_metadata_event)}handleAgentChatResponsePart(t){this.options.onAgentChatResponsePart&&this.options.onAgentChatResponsePart(t.text_response_part)}handleErrorEvent(t){const n=t.error_event.error_type,i=t.error_event.message||t.error_event.reason||"Unknown error";n!=="max_duration_exceeded"?this.onError(`Server error: ${i}`,{errorType:n,code:t.error_event.code,debugMessage:t.error_event.debug_message,details:t.error_event.details}):this.endSessionWithDetails({reason:"error",message:i,context:new Event("max_duration_exceeded")})}onError(t,n){console.error(t,n),this.options.onError&&this.options.onError(t,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(t){this.connection.setMicMuted(t)}getInputByteFrequencyData(){return FP}getOutputByteFrequencyData(){return FP}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(t){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:t?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(t){this.connection.sendMessage({type:"contextual_update",text:t})}sendUserMessage(t){this.connection.sendMessage({type:"user_message",text:t})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(t,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:t,is_approved:n})}},F5=class{constructor(t={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=t.onDebug}debug(t){this.onDebug&&this.onDebug(t)}onMessage(t){this.onMessageCallback=t;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(t)})}onDisconnect(t){this.onDisconnectCallback=t;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{t(n)})}onModeChange(t){this.onModeChangeCallback=t}updateMode(t){var n;(n=this.onModeChangeCallback)==null||n.call(this,t)}disconnect(t){var n;this.disconnectionDetails||(this.disconnectionDetails=t,(n=this.onDisconnectCallback)==null||n.call(this,t))}handleMessage(t){this.onMessageCallback?this.onMessageCallback(t):this.queue.push(t)}};function cv(e){const[t,n]=e.split("_");if(!["pcm","ulaw"].includes(t))throw new Error(`Invalid format: ${e}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:t,sampleRate:i}}const U5="0.13.0";function Ux(e){return!!e.type}const z5="conversation_initiation_client_data";function $5(e){var t;const n={type:z5};var i,s,r,o,a,c,u,h;return e.overrides&&(n.conversation_config_override={agent:{prompt:(i=e.overrides.agent)==null?void 0:i.prompt,first_message:(s=e.overrides.agent)==null?void 0:s.firstMessage,language:(r=e.overrides.agent)==null?void 0:r.language},tts:{voice_id:(o=e.overrides.tts)==null?void 0:o.voiceId,speed:(a=e.overrides.tts)==null?void 0:a.speed,stability:(c=e.overrides.tts)==null?void 0:c.stability,similarity_boost:(u=e.overrides.tts)==null?void 0:u.similarityBoost},conversation:{text_only:(h=e.overrides.conversation)==null?void 0:h.textOnly}}),e.customLlmExtraBody&&(n.custom_llm_extra_body=e.customLlmExtraBody),e.dynamicVariables&&(n.dynamic_variables=e.dynamicVariables),e.userId&&(n.user_id=e.userId),(t=e.overrides)!=null&&t.client&&(n.source_info={source:e.overrides.client.source,version:e.overrides.client.version}),n}let UP=class extends Error{constructor(t,n){super(t),this.closeCode=void 0,this.closeReason=void 0,this.name="SessionConnectionError",this.closeCode=n?.closeCode,this.closeReason=n?.closeReason}},zx=class q5 extends F5{constructor(t,n,i,s){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=t,this.conversationId=n,this.inputFormat=i,this.outputFormat=s,this.socket.addEventListener("error",r=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:r}),0)}),this.socket.addEventListener("close",r=>{this.disconnect(r.code===1e3?{reason:"agent",context:r,closeCode:r.code,closeReason:r.reason||void 0}:{reason:"error",message:r.reason||"The connection was closed by the server.",context:r,closeCode:r.code,closeReason:r.reason||void 0})}),this.socket.addEventListener("message",r=>{try{const o=JSON.parse(r.data);if(!Ux(o))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:r.data});this.handleMessage(o)}catch(o){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:o instanceof Error?o.message:String(o),data:r.data})}})}static async create(t){let n=null;try{var i,s,r;const a=(i=t.origin)!=null?i:"wss://api.elevenlabs.io";let c;const u=((s=t.overrides)==null||(s=s.client)==null?void 0:s.version)||U5,h=((r=t.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk";if(t.signedUrl){const M=t.signedUrl.includes("?")?"&":"?";c=`${t.signedUrl}${M}source=${h}&version=${u}`}else c=`${a}/v1/convai/conversation?agent_id=${t.agentId}&source=${h}&version=${u}`;const f=["convai"];t.authorization&&f.push(`bearer.${t.authorization}`),n=new WebSocket(c,f);const m=await new Promise((M,R)=>{n.addEventListener("open",()=>{var E;const A=$5(t);(E=n)==null||E.send(JSON.stringify(A))},{once:!0}),n.addEventListener("error",E=>{setTimeout(()=>R(new UP("The connection was closed due to a socket error.")),0)}),n.addEventListener("close",E=>{R(new UP(E.reason||(E.code===1e3?"Connection closed normally before session could be established.":"Connection closed unexpectedly before session could be established."),{closeCode:E.code,closeReason:E.reason||void 0}))}),n.addEventListener("message",E=>{const A=JSON.parse(E.data);Ux(A)&&(A.type==="conversation_initiation_metadata"?M(A.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:y,agent_output_audio_format:b,user_input_audio_format:S}=m,_=cv(S??"pcm_16000"),w=cv(b);return new q5(n,y,_,w)}catch(a){var o;throw(o=n)==null||o.close(),a}}close(){this.socket.close(1e3,"User ended conversation")}sendMessage(t){this.socket.send(JSON.stringify(t))}async setMicMuted(t){console.warn(`WebSocket connection setMicMuted called with ${t}, but this is handled by VoiceConversation`)}};function H5(e){const t=new Uint8Array(e);return window.btoa(String.fromCharCode(...t))}function BG(e){const t=window.atob(e),n=t.length,i=new Uint8Array(n);for(let s=0;s<n;s++)i[s]=t.charCodeAt(s);return i.buffer}const Sm=new Map;function V5(e,t){return async(n,i)=>{const s=Sm.get(e);if(s)return n.addModule(s);if(i)try{return await n.addModule(i),void Sm.set(e,i)}catch(a){throw new Error(`Failed to load the ${e} worklet module from path: ${i}. Error: ${a}`)}const r=new Blob([t],{type:"application/javascript"}),o=URL.createObjectURL(r);try{return await n.addModule(o),void Sm.set(e,o)}catch{URL.revokeObjectURL(o)}try{const a=`data:application/javascript;base64,${btoa(t)}`;await n.addModule(a),Sm.set(e,a)}catch{throw new Error(`Failed to load the ${e} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const W5=V5("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);let wl=class G5 extends F5{constructor(t,n,i,s,r={}){super(r),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=t,this.conversationId=n,this.inputFormat=i,this.outputFormat=s,this.setupRoomEventListeners()}static async create(t){let n;if("conversationToken"in t&&t.conversationToken)n=t.conversationToken;else{if(!("agentId"in t)||!t.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,s,r;const u=((i=t.overrides)==null||(i=i.client)==null?void 0:i.version)||U5,h=((s=t.overrides)==null||(s=s.client)==null?void 0:s.source)||"js_sdk",f=`${o=(r=t.origin)!=null?r:"https://api.elevenlabs.io",o.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${t.agentId}&source=${h}&version=${u}`,m=await fetch(f);if(!m.ok)throw new Error(`ElevenLabs API returned ${m.status} ${m.statusText}`);if(n=(await m.json()).token,!n)throw new Error("No conversation token received from API")}catch(u){let h=u instanceof Error?u.message:String(u);throw u instanceof Error&&u.message.includes("401")&&(h="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${t.agentId}: ${h}`)}}var o;const a=new Iu;try{const u=`room_${Date.now()}`,h=cv("pcm_48000"),f=cv("pcm_48000"),m=new G5(a,u,h,f,t),y=t.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var c;await a.connect(y,n),await new Promise(S=>{if(m.isConnected)S();else{const _=()=>{a.off(ge.Connected,_),S()};a.on(ge.Connected,_)}}),a.name&&(m.conversationId=((c=a.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:c[0])||a.name),t.textOnly||await a.localParticipant.setMicrophoneEnabled(!0);const b=$5(t);return m.debug({type:z5,message:b}),await m.sendMessage(b),m}catch(u){throw await a.disconnect(),u}}setupRoomEventListeners(){var t=this;this.room.on(ge.Connected,async function(){t.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(ge.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n?.toString()})})}),this.room.on(ge.ConnectionStateChanged,n=>{n===Mt.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(ge.DataReceived,(n,i)=>{try{const s=JSON.parse(new TextDecoder().decode(n));if(s.type==="audio")return;Ux(s)?this.handleMessage(s):console.warn("Invalid socket event received:",s)}catch(s){console.warn("Failed to parse incoming data message:",s),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(ge.TrackSubscribed,async function(n,i,s){if(n.kind===pe.Kind.Audio&&s.identity.includes("agent")){const r=n,o=r.attach();if(o.autoplay=!0,o.controls=!1,t.outputDeviceId&&o.setSinkId)try{await o.setSinkId(t.outputDeviceId)}catch(a){console.warn("Failed to set output device for new audio element:",a)}o.style.display="none",document.body.appendChild(o),t.audioElements.push(o),t.audioElements.length===1&&(t.onDebug==null||t.onDebug({type:"audio_element_ready"})),await t.setupAudioCapture(r)}}),this.room.on(ge.ActiveSpeakersChanged,async function(n){t.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")}),this.room.on(ge.ParticipantDisconnected,n=>{var i;(i=n.identity)!=null&&i.startsWith("agent")&&this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:"agent disconnected"})})})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(t=>{t.track&&t.track.stop()})}catch(t){console.warn("Error stopping local tracks:",t)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(t=>{console.warn("Error closing audio capture context:",t)}),this.audioCaptureContext=null),this.audioElements.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(t){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in t))try{const n=new TextEncoder().encode(JSON.stringify(t));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:t,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(t){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(pe.Source.Microphone);if(n!=null&&n.track)try{t?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!t)}else await this.room.localParticipant.setMicrophoneEnabled(!t)}async setupAudioCapture(t){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const i=new MediaStream([t.mediaStreamTrack]),s=n.createMediaStreamSource(i);s.connect(this.outputAnalyser),await W5(n.audioWorklet);const r=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(r),r.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),r.port.onmessage=o=>{const[a,c]=o.data;if(c>.01){const u=H5(a.buffer),h=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:u,event_id:h}})}},s.connect(r)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(t){this.audioElements.forEach(n=>{n.volume=t})}async setAudioOutputDevice(t){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(i){try{await i.setSinkId(t)}catch(s){throw console.error("Failed to set sink ID for audio element:",s),s}});await Promise.all(n),this.outputDeviceId=t}async setAudioInputDevice(t){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(pe.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const i={deviceId:{exact:t},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},s=await O5(i);await this.room.localParticipant.publishTrack(s,{name:"microphone",source:pe.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(i){console.error("Failed to recover microphone after device switch error:",i)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}};async function K5(e){const t=(function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"})(e);switch(t){case"websocket":return zx.create(e);case"webrtc":return wl.create(e);default:throw new Error(`Unknown connection type: ${t}`)}}function $x(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function Y5(e={default:0,android:3e3}){let t=e.default;var n;if(/android/i.test(navigator.userAgent))t=(n=e.android)!=null?n:t;else if($x()){var i;t=(i=e.ios)!=null?i:t}t>0&&await new Promise(s=>setTimeout(s,t))}let FG=class X5 extends hf{static async startSession(t){const n=hf.getFullOptions(t);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await Y5(n.connectionDelay),i=await K5(t),new X5(n,i)}catch(r){var s;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(s=i)==null||s.close(),r}}};const zP={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};let $P=class yg{static async create({sampleRate:t,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:s,workletPaths:r,libsampleratePath:o}){let a=null,c=null;try{const f=Po({sampleRate:{ideal:t}},zP);if($x()&&i){const w=(await window.navigator.mediaDevices.enumerateDevices()).find(M=>M.kind==="audioinput"&&["airpod","headphone","earphone"].find(R=>M.label.toLowerCase().includes(R)));w&&(f.deviceId={ideal:w.deviceId})}s&&(f.deviceId=yg.getDeviceIdConstraint(s));const m=navigator.mediaDevices.getSupportedConstraints().sampleRate;a=new window.AudioContext(m?{sampleRate:t}:{});const y=a.createAnalyser();if(!m){const w=o||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await a.audioWorklet.addModule(w)}await W5(a.audioWorklet,r?.rawAudioProcessor);const b=Po({voiceIsolation:!0},f);c=await navigator.mediaDevices.getUserMedia({audio:b});const S=a.createMediaStreamSource(c),_=new AudioWorkletNode(a,"rawAudioProcessor");return _.port.postMessage({type:"setFormat",format:n,sampleRate:t}),S.connect(y),y.connect(_),await a.resume(),new yg(a,y,_,c,S)}catch(f){var u,h;throw(u=c)==null||u.getTracks().forEach(m=>{m.stop()}),(h=a)==null||h.close(),f}}static getDeviceIdConstraint(t){if(t)return $x()?{ideal:t}:{exact:t}}constructor(t,n,i,s,r){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=t,this.analyser=n,this.worklet=i,this.inputStream=s,this.mediaStreamSource=r}async close(){this.inputStream.getTracks().forEach(t=>{t.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(t){this.worklet.port.postMessage({type:"setMuted",isMuted:t})}async setInputDevice(t){try{const n=Po({},zP);t&&(n.deviceId=yg.getDeviceIdConstraint(t));const i=Po({voiceIsolation:!0},n),s=await navigator.mediaDevices.getUserMedia({audio:i});this.inputStream.getTracks().forEach(r=>{r.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=s,this.mediaStreamSource=this.context.createMediaStreamSource(s),this.mediaStreamSource.connect(this.analyser)}catch(n){throw console.error("Failed to switch input device:",n),n}}};const UG=V5("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);let qP=class Q5{static async create({sampleRate:t,format:n,outputDeviceId:i,workletPaths:s}){let r=null,o=null;try{r=new AudioContext({sampleRate:t});const u=r.createAnalyser(),h=r.createGain();o=new Audio,o.src="",o.load(),o.autoplay=!0,o.style.display="none",document.body.appendChild(o);const f=r.createMediaStreamDestination();o.srcObject=f.stream,h.connect(u),u.connect(f),await UG(r.audioWorklet,s?.audioConcatProcessor);const m=new AudioWorkletNode(r,"audioConcatProcessor");return m.port.postMessage({type:"setFormat",format:n}),m.connect(h),await r.resume(),i&&o.setSinkId&&await o.setSinkId(i),new Q5(r,u,h,m,o)}catch(u){var a,c;throw(a=o)!=null&&a.parentNode&&o.parentNode.removeChild(o),(c=o)==null||c.pause(),r&&r.state!=="closed"&&await r.close(),u}}constructor(t,n,i,s,r){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=t,this.analyser=n,this.gain=i,this.worklet=s,this.audioElement=r}async setOutputDevice(t){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(t||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}},zG=class bg extends hf{static async requestWakeLock(){if("wakeLock"in navigator)try{return await navigator.wakeLock.request("screen")}catch{}return null}static async startSession(t){var n;const i=hf.getFullOptions(t);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let s=null,r=null,o=null,a=null,c=null;((n=t.useWakeLock)==null||n)&&(c=await bg.requestWakeLock());try{var u;return a=await navigator.mediaDevices.getUserMedia({audio:!0}),await Y5(i.connectionDelay),r=await K5(t),[s,o]=await Promise.all([$P.create(Po({},r.inputFormat,{preferHeadphonesForIosDevices:t.preferHeadphonesForIosDevices,inputDeviceId:t.inputDeviceId,workletPaths:t.workletPaths,libsampleratePath:t.libsampleratePath})),qP.create(Po({},r.outputFormat,{outputDeviceId:t.outputDeviceId,workletPaths:t.workletPaths}))]),(u=a)==null||u.getTracks().forEach(S=>{S.stop()}),a=null,new bg(i,r,s,o,c)}catch(S){var h,f,m,y;i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(h=a)==null||h.getTracks().forEach(_=>{_.stop()}),(f=r)==null||f.close(),await((m=s)==null?void 0:m.close()),await((y=o)==null?void 0:y.close());try{var b;await((b=c)==null?void 0:b.release()),c=null}catch{}throw S}}constructor(t,n,i,s,r){super(t,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.visibilityChangeHandler=null,this.onInputWorkletMessage=o=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:H5(o.data[0].buffer)})},this.onOutputWorkletMessage=({data:o})=>{o.type==="process"&&this.updateMode(o.finished?"listening":"speaking")},this.addAudioBase64Chunk=o=>{this.output.gain.gain.cancelScheduledValues(this.output.context.currentTime),this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:BG(o)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=o=>{if(o.length===0)return 0;let a=0;for(let c=0;c<o.length;c++)a+=o[c]/255;return a/=o.length,a<0?0:a>1?1:a},this.setVolume=({volume:o})=>{const a=Number.isFinite(o)?Math.min(1,Math.max(0,o)):1;this.volume=a,this.connection instanceof wl?this.connection.setAudioVolume(a):this.output.gain.gain.value=a},this.input=i,this.output=s,this.wakeLock=r,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage,r&&(this.visibilityChangeHandler=()=>{var o;document.visibilityState==="visible"&&(o=this.wakeLock)!=null&&o.released&&bg.requestWakeLock().then(a=>{this.wakeLock=a})},document.addEventListener("visibilitychange",this.visibilityChangeHandler))}async handleEndSession(){await super.handleEndSession(),this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler);try{var t;await((t=this.wakeLock)==null?void 0:t.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(t){super.handleInterruption(t),this.fadeOutAudio()}handleAudio(t){var n,i;super.handleAudio(t),t.audio_event.alignment&&this.options.onAudioAlignment&&this.options.onAudioAlignment(t.audio_event.alignment),this.lastInterruptTimestamp<=t.audio_event.event_id&&(t.audio_event.audio_base_64&&((n=(i=this.options).onAudio)==null||n.call(i,t.audio_event.audio_base_64),this.connection instanceof wl||this.addAudioBase64Chunk(t.audio_event.audio_base_64)),this.currentEventId=t.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(t){this.connection instanceof wl?this.connection.setMicMuted(t):this.input.setMuted(t)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof wl?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:t,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:s}){try{if(this.connection instanceof zx)try{return await this.input.setInputDevice(s),this.input}catch(o){console.warn("Failed to change device on existing input, recreating:",o)}this.connection instanceof wl&&await this.connection.setAudioInputDevice(s||""),await this.input.close();const r=await $P.create({sampleRate:t??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:s,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=r,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(r){throw console.error("Error changing input device",r),r}}async changeOutputDevice({sampleRate:t,format:n,outputDeviceId:i}){try{if(this.connection instanceof zx)try{return await this.output.setOutputDevice(i),this.output}catch(r){console.warn("Failed to change device on existing output, recreating:",r)}this.connection instanceof wl&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const s=await qP.create({sampleRate:t??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=s,this.output}catch(s){throw console.error("Error changing output device",s),s}}};var HP;(function(e){e.SESSION_STARTED="session_started",e.PARTIAL_TRANSCRIPT="partial_transcript",e.COMMITTED_TRANSCRIPT="committed_transcript",e.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS="committed_transcript_with_timestamps",e.AUTH_ERROR="auth_error",e.ERROR="error",e.OPEN="open",e.CLOSE="close",e.QUOTA_EXCEEDED="quota_exceeded",e.COMMIT_THROTTLED="commit_throttled",e.TRANSCRIBER_ERROR="transcriber_error",e.UNACCEPTED_TERMS="unaccepted_terms",e.RATE_LIMITED="rate_limited",e.INPUT_ERROR="input_error",e.QUEUE_OVERFLOW="queue_overflow",e.RESOURCE_EXHAUSTED="resource_exhausted",e.SESSION_TIME_LIMIT_EXCEEDED="session_time_limit_exceeded",e.CHUNK_SIZE_EXCEEDED="chunk_size_exceeded",e.INSUFFICIENT_AUDIO_ACTIVITY="insufficient_audio_activity"})(HP||(HP={}));var VP,WP;(function(e){e.PCM_8000="pcm_8000",e.PCM_16000="pcm_16000",e.PCM_22050="pcm_22050",e.PCM_24000="pcm_24000",e.PCM_44100="pcm_44100",e.PCM_48000="pcm_48000",e.ULAW_8000="ulaw_8000"})(VP||(VP={})),(function(e){e.MANUAL="manual",e.VAD="vad"})(WP||(WP={}));let $G=class extends hf{static startSession(t){return t.textOnly?FG.startSession(t):zG.startSession(t)}};function Bh(){return Bh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Bh.apply(null,arguments)}const qG=["micMuted","volume","serverLocation"];function HG(e="us"){switch(e){case"eu-residency":case"in-residency":case"us":case"global":return e;default:return console.warn(`[ConversationalAI] Invalid server-location: ${e}. Defaulting to "us"`),"us"}}function VG(e){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[e]}function WG(e){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[e]}function GG(e={}){const{micMuted:t,volume:n,serverLocation:i}=e,s=(function(_,w){if(_==null)return{};var M={};for(var R in _)if({}.hasOwnProperty.call(_,R)){if(w.indexOf(R)!==-1)continue;M[R]=_[R]}return M})(e,qG),r=k.useRef(null),o=k.useRef(null),a=k.useRef(!1),[c,u]=k.useState("disconnected"),[h,f]=k.useState(!1),[m,y]=k.useState("listening"),b=k.useRef(t),S=k.useRef(n);return b.current=t,S.current=n,k.useEffect(()=>{var _;t!==void 0&&(r==null||(_=r.current)==null||_.setMicMuted(t))},[t]),k.useEffect(()=>{var _;n!==void 0&&(r==null||(_=r.current)==null||_.setVolume({volume:n}))},[n]),k.useEffect(()=>()=>{var _;a.current=!0,o.current?o.current.then(w=>w.endSession()):(_=r.current)==null||_.endSession()},[]),{startSession:async _=>{var w;if((w=r.current)!=null&&w.isOpen())return r.current.getId();if(o.current)return(await o.current).getId();a.current=!1;try{var M,R,E,A,T,L,P,I,N,O;const j=HG(_?.serverLocation||i),$=VG(j),V=WG(j);if(o.current=$G.startSession(Bh({},s??{},_??{},{origin:$,livekitUrl:_?.livekitUrl||s?.livekitUrl||V,overrides:Bh({},(M=s?.overrides)!=null?M:{},(R=_?.overrides)!=null?R:{},{client:Bh({},(E=s==null||(A=s.overrides)==null?void 0:A.client)!=null?E:{},(T=_==null||(L=_.overrides)==null?void 0:L.client)!=null?T:{},{source:(_==null||(P=_.overrides)==null||(P=P.client)==null?void 0:P.source)||(s==null||(I=s.overrides)==null||(I=I.client)==null?void 0:I.source)||"react_sdk",version:(_==null||(N=_.overrides)==null||(N=N.client)==null?void 0:N.version)||(s==null||(O=s.overrides)==null||(O=O.client)==null?void 0:O.version)||"0.13.0"})}),onConnect:_?.onConnect||s?.onConnect,onDisconnect:_?.onDisconnect||s?.onDisconnect,onError:_?.onError||s?.onError,onMessage:_?.onMessage||s?.onMessage,onAudio:_?.onAudio||s?.onAudio,onDebug:_?.onDebug||s?.onDebug,onUnhandledClientToolCall:_?.onUnhandledClientToolCall||s?.onUnhandledClientToolCall,onVadScore:_?.onVadScore||s?.onVadScore,onInterruption:_?.onInterruption||s?.onInterruption,onAgentToolRequest:_?.onAgentToolRequest||s?.onAgentToolRequest,onAgentToolResponse:_?.onAgentToolResponse||s?.onAgentToolResponse,onConversationMetadata:_?.onConversationMetadata||s?.onConversationMetadata,onMCPToolCall:_?.onMCPToolCall||s?.onMCPToolCall,onMCPConnectionStatus:_?.onMCPConnectionStatus||s?.onMCPConnectionStatus,onAsrInitiationMetadata:_?.onAsrInitiationMetadata||s?.onAsrInitiationMetadata,onAgentChatResponsePart:_?.onAgentChatResponsePart||s?.onAgentChatResponsePart,onAudioAlignment:_?.onAudioAlignment||s?.onAudioAlignment,onModeChange:({mode:H})=>{var B;y(H),(B=_?.onModeChange||s?.onModeChange)==null||B({mode:H})},onStatusChange:({status:H})=>{var B;u(H),(B=_?.onStatusChange||s?.onStatusChange)==null||B({status:H})},onCanSendFeedbackChange:({canSendFeedback:H})=>{var B;f(H),(B=_?.onCanSendFeedbackChange||s?.onCanSendFeedbackChange)==null||B({canSendFeedback:H})}})),r.current=await o.current,a.current)throw await r.current.endSession(),r.current=null,o.current=null,new Error("Session cancelled during connection");return b.current!==void 0&&r.current.setMicMuted(b.current),S.current!==void 0&&r.current.setVolume({volume:S.current}),r.current.getId()}finally{o.current=null}},endSession:async()=>{a.current=!0;const _=o.current,w=r.current;r.current=null,_?await(await _).endSession():await w?.endSession()},setVolume:({volume:_})=>{var w;(w=r.current)==null||w.setVolume({volume:_})},getInputByteFrequencyData:()=>{var _;return(_=r.current)==null?void 0:_.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var _;return(_=r.current)==null?void 0:_.getOutputByteFrequencyData()},getInputVolume:()=>{var _,w;return(_=(w=r.current)==null?void 0:w.getInputVolume())!=null?_:0},getOutputVolume:()=>{var _,w;return(_=(w=r.current)==null?void 0:w.getOutputVolume())!=null?_:0},sendFeedback:_=>{var w;(w=r.current)==null||w.sendFeedback(_)},getId:()=>{var _;return(_=r.current)==null?void 0:_.getId()},sendContextualUpdate:_=>{var w;(w=r.current)==null||w.sendContextualUpdate(_)},sendUserMessage:_=>{var w;(w=r.current)==null||w.sendUserMessage(_)},sendUserActivity:()=>{var _;(_=r.current)==null||_.sendUserActivity()},sendMCPToolApprovalResult:(_,w)=>{var M;(M=r.current)==null||M.sendMCPToolApprovalResult(_,w)},changeInputDevice:async _=>{if(r.current&&"changeInputDevice"in r.current)return await r.current.changeInputDevice(_);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async _=>{if(r.current&&"changeOutputDevice"in r.current)return await r.current.changeOutputDevice(_);throw new Error("Device switching is only available for voice conversations")},status:c,canSendFeedback:h,micMuted:t,isSpeaking:m==="speaking"}}async function KG(e,t){try{return await e.fetchVoiceToken(t)}catch(n){return{allowed:!1,error:n instanceof Error?n.message:"Network error"}}}const YG=!1;let Er=null,Co=null;class XG{constructor(t){this.api=t}async startSession(t){if(!Er){const s=new Error("Realtime voice session not initialized");throw console.warn("[Voice] Realtime voice session not initialized"),Co?.("error","Voice session not initialized"),s}Co?.("connecting");let n=null;try{n=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(s){throw console.error("[Voice] Failed to get microphone permission:",s),Co?.("error","Microphone permission denied"),s}finally{n?.getTracks().forEach(s=>s.stop())}let i;try{i=await KG(this.api)}catch(s){throw console.error("[Voice] Failed to fetch voice token:",s),Co?.("error","Network error"),s}if(!i.allowed||!i.token){const s=new Error(i.error??"Voice not allowed or no token");throw console.error("[Voice] Voice not allowed or no token:",i.error),Co?.("error",i.error??"Voice not allowed"),s}try{const s=await Er.startSession({conversationToken:i.token,connectionType:"webrtc",dynamicVariables:{sessionId:t.sessionId,initialConversationContext:t.initialContext||""},overrides:{agent:{language:t.language}}})}catch(s){throw console.error("[Voice] Failed to start realtime session:",s),Co?.("error","Failed to start voice session"),s}}async endSession(){if(Er)try{await Er.endSession(),Co?.("disconnected")}catch(t){console.error("[Voice] Failed to end realtime session:",t)}}sendTextMessage(t){if(!Er){console.warn("[Voice] Realtime voice session not initialized");return}Er.sendUserMessage(t)}sendContextualUpdate(t){if(!Er){console.warn("[Voice] Realtime voice session not initialized");return}Er.sendContextualUpdate(t)}}function QG({api:e,micMuted:t=!1,onStatusChange:n,getSession:i,sendMessage:s,approvePermission:r,denyPermission:o}){const a=k.useRef(!1),[c,u]=k.useState(t);k.useEffect(()=>{u(t)},[t]),k.useEffect(()=>(Co=n||null,()=>{Co=null}),[n]),k.useEffect(()=>{i&&s&&r&&o&&YD({getSession:M=>i(M),sendMessage:s,approvePermission:r,denyPermission:o})},[i,s,r,o]);const h=k.useCallback(()=>{n?.("connected")},[n]),f=k.useCallback(()=>{m7(),n?.("disconnected")},[n]),m=k.useCallback(M=>{const R=M instanceof Error?M.message:"Connection error";n?.("error",R)},[n]),y=k.useCallback(M=>{},[]),b=k.useCallback(M=>{},[]),S=k.useCallback(M=>{},[]),_=k.useCallback(M=>{},[]);k.useEffect(()=>{},[c]);const w=GG({clientTools:v7,micMuted:c,onConnect:h,onDisconnect:f,onMessage:y,onError:m,onStatusChange:b,onModeChange:S,onDebug:_});return k.useEffect(()=>{if(Er=w,!a.current)try{g7(new XG(e)),a.current=!0}catch(M){console.error("[Voice] Failed to register voice session:",M)}return()=>{Er=null}},[w,e]),null}function JG(e){return Array.isArray(e)}function ZG(e){return e==="agent"||e==="assistant"?"assistant":e==="user"?"user":null}function eK(e){const t=ID(e.content);return t?{role:ZG(t.role),content:t.content}:{role:null,content:e.content}}function tK(e){if(!ye(e)||e.type!=="output")return{roleOverride:null,content:e};const t=ye(e.data)?e.data:null;if(!t||typeof t.type!="string")return{roleOverride:null,content:e};const n=ye(t.message)?t.message:null;if(!n)return{roleOverride:null,content:e};const i=n.content;return typeof i>"u"?{roleOverride:null,content:e}:{roleOverride:t.type==="assistant"?"assistant":t.type==="user"?"user":null,content:i}}function O0(e,t){return e==="assistant"?`Claude Code: 
<text>${t}</text>`:`User sent message: 
<text>${t}</text>`}function nK(e,t,n,i){return`Claude Code is requesting permission to use ${n} (session ${e}):
<request_id>${t}</request_id>
<tool_name>${n}</tool_name>
<tool_args>${JSON.stringify(i)}</tool_args>`}function J5(e){const t=[],{role:n,content:i}=eK(e),{roleOverride:s,content:r}=tK(i),o=s??n;if(!JG(r))return typeof r=="string"?O0(o,r):ye(r)&&r.type==="text"&&typeof r.text=="string"?O0(o,r.text):null;const a=r.some(u=>u.type==="tool_use"),c=o==="assistant"?!0:o==="user"?!1:a||r.some(u=>u.type==="text"&&r.length!==1);for(const u of r)if(u.type==="text"&&u.text)t.push(O0(c?"assistant":"user",u.text));else if(u.type==="tool_use"){const h=u.name||"unknown";t.push(`Claude Code is using ${h}`)}return t.length===0?null:t.join(`

`)}function iK(e,t){const n=[...t].sort((i,s)=>(i.seq??0)-(s.seq??0)).map(J5).filter(Boolean);return n.length===0?null:"New messages in session: "+e+`

`+n.join(`

`)}function sK(e,t){const i=t.slice(-50).map(J5).filter(Boolean);return"History of messages in session: "+e+`

`+i.join(`

`)}function Z5(e,t){if(!e)return"Session not available";const n=e.metadata?.summary?.text,i=e.metadata?.path,s=[];return s.push(`# Session ID: ${e.id}`),s.push(`# Project path: ${i}`),s.push(`# Session summary:
${n}`),e.metadata?.summary?.text&&(s.push("## Session Summary"),s.push(e.metadata.summary.text),s.push("")),s.push("## Our interaction history so far"),s.push(""),s.push(sK(e.id,t)),s.join(`

`)}function rK(e,t){return`Session became focused: ${e}`}function oK(e){return`Claude Code done working in session: ${e}. The previous message(s) are the summary of the work done. Report this to the human immediately.`}const Fh=new Set;let j0=null,hk=null,fk=null;function aK(e,t){hk=e,fk=t}function qx(e){if(!e)return;const t=KD();!t||!GD()||t.sendContextualUpdate(e)}function GP(e){if(!e)return;const t=KD();!t||!GD()||t.sendTextMessage(e)}function xm(e){if(Fh.has(e))return;Fh.add(e);const t=hk?.(e)??null;if(!t)return;const n=fk?.(e)??[],i=Z5(t,n);qx(i)}const Uh={onSessionOnline(e,t){},onSessionOffline(e,t){},onSessionFocus(e,t){j0!==e&&(j0=e,xm(e),qx(rK(e)))},onPermissionRequested(e,t,n,i){xm(e),GP(nK(e,t,n,i))},onMessages(e,t){xm(e),qx(iK(e,t))},onVoiceStarted(e){Fh.clear();const t=hk?.(e)??null,n=fk?.(e)??[];let i=`THIS IS AN ACTIVE SESSION: 

`+Z5(t,n);return Fh.add(e),i},onReady(e){xm(e),GP(oK(e))},onVoiceStopped(){Fh.clear(),j0=null}},ej=[{code:null,name:"Auto-detect",nativeName:"Auto-detect"},{code:"en-US",name:"English",nativeName:"English",region:"United States",elevenLabsCode:"en"},{code:"en-GB",name:"English",nativeName:"English",region:"United Kingdom",elevenLabsCode:"en"},{code:"en-AU",name:"English",nativeName:"English",region:"Australia",elevenLabsCode:"en"},{code:"en-CA",name:"English",nativeName:"English",region:"Canada",elevenLabsCode:"en"},{code:"es-ES",name:"Spanish",nativeName:"Espaol",region:"Spain",elevenLabsCode:"es"},{code:"es-MX",name:"Spanish",nativeName:"Espaol",region:"Mexico",elevenLabsCode:"es"},{code:"es-AR",name:"Spanish",nativeName:"Espaol",region:"Argentina",elevenLabsCode:"es"},{code:"fr-FR",name:"French",nativeName:"Franais",region:"France",elevenLabsCode:"fr"},{code:"fr-CA",name:"French",nativeName:"Franais",region:"Canada",elevenLabsCode:"fr"},{code:"de-DE",name:"German",nativeName:"Deutsch",region:"Germany",elevenLabsCode:"de"},{code:"de-AT",name:"German",nativeName:"Deutsch",region:"Austria",elevenLabsCode:"de"},{code:"it-IT",name:"Italian",nativeName:"Italiano",elevenLabsCode:"it"},{code:"pt-BR",name:"Portuguese",nativeName:"Portugus",region:"Brazil",elevenLabsCode:"pt-br"},{code:"pt-PT",name:"Portuguese",nativeName:"Portugus",region:"Portugal",elevenLabsCode:"pt"},{code:"ru-RU",name:"Russian",nativeName:"",elevenLabsCode:"ru"},{code:"zh-CN",name:"Chinese",nativeName:"",region:"Simplified",elevenLabsCode:"zh"},{code:"zh-TW",name:"Chinese",nativeName:"",region:"Traditional",elevenLabsCode:"zh"},{code:"ja-JP",name:"Japanese",nativeName:"",elevenLabsCode:"ja"},{code:"ko-KR",name:"Korean",nativeName:"",elevenLabsCode:"ko"},{code:"ar-SA",name:"Arabic",nativeName:"",elevenLabsCode:"ar"},{code:"hi-IN",name:"Hindi",nativeName:"",elevenLabsCode:"hi"},{code:"nl-NL",name:"Dutch",nativeName:"Nederlands",elevenLabsCode:"nl"},{code:"sv-SE",name:"Swedish",nativeName:"Svenska",elevenLabsCode:"sv"},{code:"no-NO",name:"Norwegian",nativeName:"Norsk",elevenLabsCode:"no"},{code:"da-DK",name:"Danish",nativeName:"Dansk",elevenLabsCode:"da"},{code:"fi-FI",name:"Finnish",nativeName:"Suomi",elevenLabsCode:"fi"},{code:"pl-PL",name:"Polish",nativeName:"Polski",elevenLabsCode:"pl"},{code:"tr-TR",name:"Turkish",nativeName:"Trke",elevenLabsCode:"tr"},{code:"he-IL",name:"Hebrew",nativeName:""},{code:"th-TH",name:"Thai",nativeName:""},{code:"vi-VN",name:"Vietnamese",nativeName:"Ting Vit",elevenLabsCode:"vi"},{code:"id-ID",name:"Indonesian",nativeName:"Bahasa Indonesia",elevenLabsCode:"id"},{code:"ms-MY",name:"Malay",nativeName:"Bahasa Melayu",elevenLabsCode:"ms"},{code:"tl-PH",name:"Tagalog",nativeName:"Tagalog",elevenLabsCode:"tl"},{code:"uk-UA",name:"Ukrainian",nativeName:"",elevenLabsCode:"uk"},{code:"cs-CZ",name:"Czech",nativeName:"etina",elevenLabsCode:"cs"},{code:"hu-HU",name:"Hungarian",nativeName:"Magyar",elevenLabsCode:"hu"},{code:"ro-RO",name:"Romanian",nativeName:"Romn",elevenLabsCode:"ro"},{code:"bg-BG",name:"Bulgarian",nativeName:"",elevenLabsCode:"bg"},{code:"el-GR",name:"Greek",nativeName:"",elevenLabsCode:"el"},{code:"hr-HR",name:"Croatian",nativeName:"Hrvatski",elevenLabsCode:"hr"},{code:"sk-SK",name:"Slovak",nativeName:"Slovenina",elevenLabsCode:"sk"},{code:"sl-SI",name:"Slovenian",nativeName:"Slovenina"},{code:"et-EE",name:"Estonian",nativeName:"Eesti"},{code:"lv-LV",name:"Latvian",nativeName:"Latvieu"},{code:"lt-LT",name:"Lithuanian",nativeName:"Lietuvi"}],KP=e=>{const t=[];return e.name!==e.nativeName?t.push(`${e.name} (${e.nativeName})`):t.push(e.name),e.region&&t.push(e.region),t.join(" - ")},lK=e=>ej.find(t=>t.code===e),cK=e=>e?lK(e)?.elevenLabsCode:void 0,uK=()=>ej.filter(e=>e.code===null||e.elevenLabsCode!==void 0),tj=k.createContext(null);function dK({children:e}){const[t,n]=k.useState("disconnected"),[i,s]=k.useState(null),[r,o]=k.useState(!1),[a,c]=k.useState(null),u=k.useCallback((y,b)=>{n(y),y==="error"?s(b??null):y==="connected"&&s(null)},[]),h=k.useCallback(()=>{o(y=>!y)},[]),f=k.useCallback(async y=>{c(y);const b=Uh.onVoiceStarted(y),S=localStorage.getItem("hapi-voice-lang"),_=cK(S);await f7(y,b,_)},[]),m=k.useCallback(async()=>{Uh.onVoiceStopped(),await p7(),c(null),n("disconnected"),s(null)},[]);return g.jsx(tj.Provider,{value:{status:t,errorMessage:i,micMuted:r,currentSessionId:a,setStatus:u,setMicMuted:o,toggleMic:h,startVoice:f,stopVoice:m},children:e})}function nj(){return k.useContext(tj)}function hK(e){return!1}function fK(){return hK()}const pK=[{value:"en",label:"English"},{value:"zh-CN",label:""}];function mK(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("path",{d:"m5 8 6 6"}),g.jsx("path",{d:"m4 14 6-6 2-3"}),g.jsx("path",{d:"M2 5h12"}),g.jsx("path",{d:"M7 2h1"}),g.jsx("path",{d:"m22 22-5-10-5 10"}),g.jsx("path",{d:"M14 18h6"})]})}function gK(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:g.jsx("polyline",{points:"20 6 9 17 4 12"})})}function vK(){const{locale:e,setLocale:t,t:n}=rt(),[i,s]=k.useState(!1),r=k.useRef(null),o=a=>{t(a),s(!1)};return k.useEffect(()=>{if(!i)return;const a=c=>{r.current&&!r.current.contains(c.target)&&s(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[i]),k.useEffect(()=>{if(!i)return;const a=c=>{c.key==="Escape"&&s(!1)};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[i]),g.jsxs("div",{ref:r,className:"relative",children:[g.jsx("button",{type:"button",onClick:()=>s(!i),className:"flex items-center justify-center h-8 w-8 rounded-md text-[var(--app-hint)] hover:text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)] transition-colors",title:n("language.title"),"aria-label":n("language.title"),"aria-expanded":i,"aria-haspopup":"listbox",children:g.jsx(mK,{})}),i&&g.jsx("div",{className:"absolute right-0 top-full mt-1 min-w-[140px] rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] shadow-lg overflow-hidden z-50",role:"listbox","aria-label":n("language.title"),children:pK.map(a=>{const c=e===a.value;return g.jsxs("button",{type:"button",role:"option","aria-selected":c,onClick:()=>o(a.value),className:`flex items-center justify-between w-full px-3 py-2 text-sm text-left transition-colors ${c?"text-[var(--app-link)] bg-[var(--app-subtle-bg)]":"text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)]"}`,children:[g.jsx("span",{children:a.label}),c&&g.jsx("span",{className:"ml-2 text-[var(--app-link)]",children:g.jsx(gK,{})})]},a.value)})})]})}function ij(e){var t,n,i="";if(typeof e=="string"||typeof e=="number")i+=e;else if(typeof e=="object")if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=ij(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function sj(){for(var e,t,n=0,i="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=ij(e))&&(i&&(i+=" "),i+=t);return i}const yK=(e,t)=>{const n=new Array(e.length+t.length);for(let i=0;i<e.length;i++)n[i]=e[i];for(let i=0;i<t.length;i++)n[e.length+i]=t[i];return n},bK=(e,t)=>({classGroupId:e,validator:t}),rj=(e=new Map,t=null,n)=>({nextPart:e,validators:t,classGroupId:n}),uv="-",YP=[],_K="arbitrary..",SK=e=>{const t=wK(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:i}=e;return{getClassGroupId:o=>{if(o.startsWith("[")&&o.endsWith("]"))return xK(o);const a=o.split(uv),c=a[0]===""&&a.length>1?1:0;return oj(a,c,t)},getConflictingClassGroupIds:(o,a)=>{if(a){const c=i[o],u=n[o];return c?u?yK(u,c):c:u||YP}return n[o]||YP}}},oj=(e,t,n)=>{if(e.length-t===0)return n.classGroupId;const s=e[t],r=n.nextPart.get(s);if(r){const u=oj(e,t+1,r);if(u)return u}const o=n.validators;if(o===null)return;const a=t===0?e.join(uv):e.slice(t).join(uv),c=o.length;for(let u=0;u<c;u++){const h=o[u];if(h.validator(a))return h.classGroupId}},xK=e=>e.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const t=e.slice(1,-1),n=t.indexOf(":"),i=t.slice(0,n);return i?_K+i:void 0})(),wK=e=>{const{theme:t,classGroups:n}=e;return CK(n,t)},CK=(e,t)=>{const n=rj();for(const i in e){const s=e[i];pk(s,n,i,t)}return n},pk=(e,t,n,i)=>{const s=e.length;for(let r=0;r<s;r++){const o=e[r];kK(o,t,n,i)}},kK=(e,t,n,i)=>{if(typeof e=="string"){TK(e,t,n);return}if(typeof e=="function"){EK(e,t,n,i);return}RK(e,t,n,i)},TK=(e,t,n)=>{const i=e===""?t:aj(t,e);i.classGroupId=n},EK=(e,t,n,i)=>{if(MK(e)){pk(e(i),t,n,i);return}t.validators===null&&(t.validators=[]),t.validators.push(bK(n,e))},RK=(e,t,n,i)=>{const s=Object.entries(e),r=s.length;for(let o=0;o<r;o++){const[a,c]=s[o];pk(c,aj(t,a),n,i)}},aj=(e,t)=>{let n=e;const i=t.split(uv),s=i.length;for(let r=0;r<s;r++){const o=i[r];let a=n.nextPart.get(o);a||(a=rj(),n.nextPart.set(o,a)),n=a}return n},MK=e=>"isThemeGetter"in e&&e.isThemeGetter===!0,AK=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=Object.create(null),i=Object.create(null);const s=(r,o)=>{n[r]=o,t++,t>e&&(t=0,i=n,n=Object.create(null))};return{get(r){let o=n[r];if(o!==void 0)return o;if((o=i[r])!==void 0)return s(r,o),o},set(r,o){r in n?n[r]=o:s(r,o)}}},Hx="!",XP=":",PK=[],QP=(e,t,n,i,s)=>({modifiers:e,hasImportantModifier:t,baseClassName:n,maybePostfixModifierPosition:i,isExternal:s}),LK=e=>{const{prefix:t,experimentalParseClassName:n}=e;let i=s=>{const r=[];let o=0,a=0,c=0,u;const h=s.length;for(let S=0;S<h;S++){const _=s[S];if(o===0&&a===0){if(_===XP){r.push(s.slice(c,S)),c=S+1;continue}if(_==="/"){u=S;continue}}_==="["?o++:_==="]"?o--:_==="("?a++:_===")"&&a--}const f=r.length===0?s:s.slice(c);let m=f,y=!1;f.endsWith(Hx)?(m=f.slice(0,-1),y=!0):f.startsWith(Hx)&&(m=f.slice(1),y=!0);const b=u&&u>c?u-c:void 0;return QP(r,y,m,b)};if(t){const s=t+XP,r=i;i=o=>o.startsWith(s)?r(o.slice(s.length)):QP(PK,!1,o,void 0,!0)}if(n){const s=i;i=r=>n({className:r,parseClassName:s})}return i},NK=e=>{const t=new Map;return e.orderSensitiveModifiers.forEach((n,i)=>{t.set(n,1e6+i)}),n=>{const i=[];let s=[];for(let r=0;r<n.length;r++){const o=n[r],a=o[0]==="[",c=t.has(o);a||c?(s.length>0&&(s.sort(),i.push(...s),s=[]),i.push(o)):s.push(o)}return s.length>0&&(s.sort(),i.push(...s)),i}},IK=e=>({cache:AK(e.cacheSize),parseClassName:LK(e),sortModifiers:NK(e),...SK(e)}),DK=/\s+/,OK=(e,t)=>{const{parseClassName:n,getClassGroupId:i,getConflictingClassGroupIds:s,sortModifiers:r}=t,o=[],a=e.trim().split(DK);let c="";for(let u=a.length-1;u>=0;u-=1){const h=a[u],{isExternal:f,modifiers:m,hasImportantModifier:y,baseClassName:b,maybePostfixModifierPosition:S}=n(h);if(f){c=h+(c.length>0?" "+c:c);continue}let _=!!S,w=i(_?b.substring(0,S):b);if(!w){if(!_){c=h+(c.length>0?" "+c:c);continue}if(w=i(b),!w){c=h+(c.length>0?" "+c:c);continue}_=!1}const M=m.length===0?"":m.length===1?m[0]:r(m).join(":"),R=y?M+Hx:M,E=R+w;if(o.indexOf(E)>-1)continue;o.push(E);const A=s(w,_);for(let T=0;T<A.length;++T){const L=A[T];o.push(R+L)}c=h+(c.length>0?" "+c:c)}return c},jK=(...e)=>{let t=0,n,i,s="";for(;t<e.length;)(n=e[t++])&&(i=lj(n))&&(s&&(s+=" "),s+=i);return s},lj=e=>{if(typeof e=="string")return e;let t,n="";for(let i=0;i<e.length;i++)e[i]&&(t=lj(e[i]))&&(n&&(n+=" "),n+=t);return n},BK=(e,...t)=>{let n,i,s,r;const o=c=>{const u=t.reduce((h,f)=>f(h),e());return n=IK(u),i=n.cache.get,s=n.cache.set,r=a,a(c)},a=c=>{const u=i(c);if(u)return u;const h=OK(c,n);return s(c,h),h};return r=o,(...c)=>r(jK(...c))},FK=[],Pn=e=>{const t=n=>n[e]||FK;return t.isThemeGetter=!0,t},cj=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,uj=/^\((?:(\w[\w-]*):)?(.+)\)$/i,UK=/^\d+\/\d+$/,zK=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,$K=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,qK=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,HK=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,VK=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Yc=e=>UK.test(e),lt=e=>!!e&&!Number.isNaN(Number(e)),pa=e=>!!e&&Number.isInteger(Number(e)),B0=e=>e.endsWith("%")&&lt(e.slice(0,-1)),vo=e=>zK.test(e),WK=()=>!0,GK=e=>$K.test(e)&&!qK.test(e),dj=()=>!1,KK=e=>HK.test(e),YK=e=>VK.test(e),XK=e=>!Pe(e)&&!Le(e),QK=e=>Wu(e,pj,dj),Pe=e=>cj.test(e),fl=e=>Wu(e,mj,GK),F0=e=>Wu(e,nY,lt),JP=e=>Wu(e,hj,dj),JK=e=>Wu(e,fj,YK),wm=e=>Wu(e,gj,KK),Le=e=>uj.test(e),sh=e=>Gu(e,mj),ZK=e=>Gu(e,iY),ZP=e=>Gu(e,hj),eY=e=>Gu(e,pj),tY=e=>Gu(e,fj),Cm=e=>Gu(e,gj,!0),Wu=(e,t,n)=>{const i=cj.exec(e);return i?i[1]?t(i[1]):n(i[2]):!1},Gu=(e,t,n=!1)=>{const i=uj.exec(e);return i?i[1]?t(i[1]):n:!1},hj=e=>e==="position"||e==="percentage",fj=e=>e==="image"||e==="url",pj=e=>e==="length"||e==="size"||e==="bg-size",mj=e=>e==="length",nY=e=>e==="number",iY=e=>e==="family-name",gj=e=>e==="shadow",sY=()=>{const e=Pn("color"),t=Pn("font"),n=Pn("text"),i=Pn("font-weight"),s=Pn("tracking"),r=Pn("leading"),o=Pn("breakpoint"),a=Pn("container"),c=Pn("spacing"),u=Pn("radius"),h=Pn("shadow"),f=Pn("inset-shadow"),m=Pn("text-shadow"),y=Pn("drop-shadow"),b=Pn("blur"),S=Pn("perspective"),_=Pn("aspect"),w=Pn("ease"),M=Pn("animate"),R=()=>["auto","avoid","all","avoid-page","page","left","right","column"],E=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],A=()=>[...E(),Le,Pe],T=()=>["auto","hidden","clip","visible","scroll"],L=()=>["auto","contain","none"],P=()=>[Le,Pe,c],I=()=>[Yc,"full","auto",...P()],N=()=>[pa,"none","subgrid",Le,Pe],O=()=>["auto",{span:["full",pa,Le,Pe]},pa,Le,Pe],j=()=>[pa,"auto",Le,Pe],$=()=>["auto","min","max","fr",Le,Pe],V=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],H=()=>["start","end","center","stretch","center-safe","end-safe"],B=()=>["auto",...P()],W=()=>[Yc,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...P()],q=()=>[e,Le,Pe],ne=()=>[...E(),ZP,JP,{position:[Le,Pe]}],z=()=>["no-repeat",{repeat:["","x","y","space","round"]}],G=()=>["auto","cover","contain",eY,QK,{size:[Le,Pe]}],J=()=>[B0,sh,fl],U=()=>["","none","full",u,Le,Pe],re=()=>["",lt,sh,fl],de=()=>["solid","dashed","dotted","double"],ce=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ae=()=>[lt,B0,ZP,JP],be=()=>["","none",b,Le,Pe],Ce=()=>["none",lt,Le,Pe],qe=()=>["none",lt,Le,Pe],dt=()=>[lt,Le,Pe],yt=()=>[Yc,"full",...P()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[vo],breakpoint:[vo],color:[WK],container:[vo],"drop-shadow":[vo],ease:["in","out","in-out"],font:[XK],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[vo],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[vo],shadow:[vo],spacing:["px",lt],text:[vo],"text-shadow":[vo],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Yc,Pe,Le,_]}],container:["container"],columns:[{columns:[lt,Pe,Le,a]}],"break-after":[{"break-after":R()}],"break-before":[{"break-before":R()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:A()}],overflow:[{overflow:T()}],"overflow-x":[{"overflow-x":T()}],"overflow-y":[{"overflow-y":T()}],overscroll:[{overscroll:L()}],"overscroll-x":[{"overscroll-x":L()}],"overscroll-y":[{"overscroll-y":L()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:I()}],"inset-x":[{"inset-x":I()}],"inset-y":[{"inset-y":I()}],start:[{start:I()}],end:[{end:I()}],top:[{top:I()}],right:[{right:I()}],bottom:[{bottom:I()}],left:[{left:I()}],visibility:["visible","invisible","collapse"],z:[{z:[pa,"auto",Le,Pe]}],basis:[{basis:[Yc,"full","auto",a,...P()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[lt,Yc,"auto","initial","none",Pe]}],grow:[{grow:["",lt,Le,Pe]}],shrink:[{shrink:["",lt,Le,Pe]}],order:[{order:[pa,"first","last","none",Le,Pe]}],"grid-cols":[{"grid-cols":N()}],"col-start-end":[{col:O()}],"col-start":[{"col-start":j()}],"col-end":[{"col-end":j()}],"grid-rows":[{"grid-rows":N()}],"row-start-end":[{row:O()}],"row-start":[{"row-start":j()}],"row-end":[{"row-end":j()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":$()}],"auto-rows":[{"auto-rows":$()}],gap:[{gap:P()}],"gap-x":[{"gap-x":P()}],"gap-y":[{"gap-y":P()}],"justify-content":[{justify:[...V(),"normal"]}],"justify-items":[{"justify-items":[...H(),"normal"]}],"justify-self":[{"justify-self":["auto",...H()]}],"align-content":[{content:["normal",...V()]}],"align-items":[{items:[...H(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...H(),{baseline:["","last"]}]}],"place-content":[{"place-content":V()}],"place-items":[{"place-items":[...H(),"baseline"]}],"place-self":[{"place-self":["auto",...H()]}],p:[{p:P()}],px:[{px:P()}],py:[{py:P()}],ps:[{ps:P()}],pe:[{pe:P()}],pt:[{pt:P()}],pr:[{pr:P()}],pb:[{pb:P()}],pl:[{pl:P()}],m:[{m:B()}],mx:[{mx:B()}],my:[{my:B()}],ms:[{ms:B()}],me:[{me:B()}],mt:[{mt:B()}],mr:[{mr:B()}],mb:[{mb:B()}],ml:[{ml:B()}],"space-x":[{"space-x":P()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":P()}],"space-y-reverse":["space-y-reverse"],size:[{size:W()}],w:[{w:[a,"screen",...W()]}],"min-w":[{"min-w":[a,"screen","none",...W()]}],"max-w":[{"max-w":[a,"screen","none","prose",{screen:[o]},...W()]}],h:[{h:["screen","lh",...W()]}],"min-h":[{"min-h":["screen","lh","none",...W()]}],"max-h":[{"max-h":["screen","lh",...W()]}],"font-size":[{text:["base",n,sh,fl]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[i,Le,F0]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",B0,Pe]}],"font-family":[{font:[ZK,Pe,t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[s,Le,Pe]}],"line-clamp":[{"line-clamp":[lt,"none",Le,F0]}],leading:[{leading:[r,...P()]}],"list-image":[{"list-image":["none",Le,Pe]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Le,Pe]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:q()}],"text-color":[{text:q()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...de(),"wavy"]}],"text-decoration-thickness":[{decoration:[lt,"from-font","auto",Le,fl]}],"text-decoration-color":[{decoration:q()}],"underline-offset":[{"underline-offset":[lt,"auto",Le,Pe]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:P()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Le,Pe]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Le,Pe]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:ne()}],"bg-repeat":[{bg:z()}],"bg-size":[{bg:G()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},pa,Le,Pe],radial:["",Le,Pe],conic:[pa,Le,Pe]},tY,JK]}],"bg-color":[{bg:q()}],"gradient-from-pos":[{from:J()}],"gradient-via-pos":[{via:J()}],"gradient-to-pos":[{to:J()}],"gradient-from":[{from:q()}],"gradient-via":[{via:q()}],"gradient-to":[{to:q()}],rounded:[{rounded:U()}],"rounded-s":[{"rounded-s":U()}],"rounded-e":[{"rounded-e":U()}],"rounded-t":[{"rounded-t":U()}],"rounded-r":[{"rounded-r":U()}],"rounded-b":[{"rounded-b":U()}],"rounded-l":[{"rounded-l":U()}],"rounded-ss":[{"rounded-ss":U()}],"rounded-se":[{"rounded-se":U()}],"rounded-ee":[{"rounded-ee":U()}],"rounded-es":[{"rounded-es":U()}],"rounded-tl":[{"rounded-tl":U()}],"rounded-tr":[{"rounded-tr":U()}],"rounded-br":[{"rounded-br":U()}],"rounded-bl":[{"rounded-bl":U()}],"border-w":[{border:re()}],"border-w-x":[{"border-x":re()}],"border-w-y":[{"border-y":re()}],"border-w-s":[{"border-s":re()}],"border-w-e":[{"border-e":re()}],"border-w-t":[{"border-t":re()}],"border-w-r":[{"border-r":re()}],"border-w-b":[{"border-b":re()}],"border-w-l":[{"border-l":re()}],"divide-x":[{"divide-x":re()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":re()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...de(),"hidden","none"]}],"divide-style":[{divide:[...de(),"hidden","none"]}],"border-color":[{border:q()}],"border-color-x":[{"border-x":q()}],"border-color-y":[{"border-y":q()}],"border-color-s":[{"border-s":q()}],"border-color-e":[{"border-e":q()}],"border-color-t":[{"border-t":q()}],"border-color-r":[{"border-r":q()}],"border-color-b":[{"border-b":q()}],"border-color-l":[{"border-l":q()}],"divide-color":[{divide:q()}],"outline-style":[{outline:[...de(),"none","hidden"]}],"outline-offset":[{"outline-offset":[lt,Le,Pe]}],"outline-w":[{outline:["",lt,sh,fl]}],"outline-color":[{outline:q()}],shadow:[{shadow:["","none",h,Cm,wm]}],"shadow-color":[{shadow:q()}],"inset-shadow":[{"inset-shadow":["none",f,Cm,wm]}],"inset-shadow-color":[{"inset-shadow":q()}],"ring-w":[{ring:re()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:q()}],"ring-offset-w":[{"ring-offset":[lt,fl]}],"ring-offset-color":[{"ring-offset":q()}],"inset-ring-w":[{"inset-ring":re()}],"inset-ring-color":[{"inset-ring":q()}],"text-shadow":[{"text-shadow":["none",m,Cm,wm]}],"text-shadow-color":[{"text-shadow":q()}],opacity:[{opacity:[lt,Le,Pe]}],"mix-blend":[{"mix-blend":[...ce(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ce()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[lt]}],"mask-image-linear-from-pos":[{"mask-linear-from":ae()}],"mask-image-linear-to-pos":[{"mask-linear-to":ae()}],"mask-image-linear-from-color":[{"mask-linear-from":q()}],"mask-image-linear-to-color":[{"mask-linear-to":q()}],"mask-image-t-from-pos":[{"mask-t-from":ae()}],"mask-image-t-to-pos":[{"mask-t-to":ae()}],"mask-image-t-from-color":[{"mask-t-from":q()}],"mask-image-t-to-color":[{"mask-t-to":q()}],"mask-image-r-from-pos":[{"mask-r-from":ae()}],"mask-image-r-to-pos":[{"mask-r-to":ae()}],"mask-image-r-from-color":[{"mask-r-from":q()}],"mask-image-r-to-color":[{"mask-r-to":q()}],"mask-image-b-from-pos":[{"mask-b-from":ae()}],"mask-image-b-to-pos":[{"mask-b-to":ae()}],"mask-image-b-from-color":[{"mask-b-from":q()}],"mask-image-b-to-color":[{"mask-b-to":q()}],"mask-image-l-from-pos":[{"mask-l-from":ae()}],"mask-image-l-to-pos":[{"mask-l-to":ae()}],"mask-image-l-from-color":[{"mask-l-from":q()}],"mask-image-l-to-color":[{"mask-l-to":q()}],"mask-image-x-from-pos":[{"mask-x-from":ae()}],"mask-image-x-to-pos":[{"mask-x-to":ae()}],"mask-image-x-from-color":[{"mask-x-from":q()}],"mask-image-x-to-color":[{"mask-x-to":q()}],"mask-image-y-from-pos":[{"mask-y-from":ae()}],"mask-image-y-to-pos":[{"mask-y-to":ae()}],"mask-image-y-from-color":[{"mask-y-from":q()}],"mask-image-y-to-color":[{"mask-y-to":q()}],"mask-image-radial":[{"mask-radial":[Le,Pe]}],"mask-image-radial-from-pos":[{"mask-radial-from":ae()}],"mask-image-radial-to-pos":[{"mask-radial-to":ae()}],"mask-image-radial-from-color":[{"mask-radial-from":q()}],"mask-image-radial-to-color":[{"mask-radial-to":q()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":E()}],"mask-image-conic-pos":[{"mask-conic":[lt]}],"mask-image-conic-from-pos":[{"mask-conic-from":ae()}],"mask-image-conic-to-pos":[{"mask-conic-to":ae()}],"mask-image-conic-from-color":[{"mask-conic-from":q()}],"mask-image-conic-to-color":[{"mask-conic-to":q()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:ne()}],"mask-repeat":[{mask:z()}],"mask-size":[{mask:G()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Le,Pe]}],filter:[{filter:["","none",Le,Pe]}],blur:[{blur:be()}],brightness:[{brightness:[lt,Le,Pe]}],contrast:[{contrast:[lt,Le,Pe]}],"drop-shadow":[{"drop-shadow":["","none",y,Cm,wm]}],"drop-shadow-color":[{"drop-shadow":q()}],grayscale:[{grayscale:["",lt,Le,Pe]}],"hue-rotate":[{"hue-rotate":[lt,Le,Pe]}],invert:[{invert:["",lt,Le,Pe]}],saturate:[{saturate:[lt,Le,Pe]}],sepia:[{sepia:["",lt,Le,Pe]}],"backdrop-filter":[{"backdrop-filter":["","none",Le,Pe]}],"backdrop-blur":[{"backdrop-blur":be()}],"backdrop-brightness":[{"backdrop-brightness":[lt,Le,Pe]}],"backdrop-contrast":[{"backdrop-contrast":[lt,Le,Pe]}],"backdrop-grayscale":[{"backdrop-grayscale":["",lt,Le,Pe]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[lt,Le,Pe]}],"backdrop-invert":[{"backdrop-invert":["",lt,Le,Pe]}],"backdrop-opacity":[{"backdrop-opacity":[lt,Le,Pe]}],"backdrop-saturate":[{"backdrop-saturate":[lt,Le,Pe]}],"backdrop-sepia":[{"backdrop-sepia":["",lt,Le,Pe]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":P()}],"border-spacing-x":[{"border-spacing-x":P()}],"border-spacing-y":[{"border-spacing-y":P()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Le,Pe]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[lt,"initial",Le,Pe]}],ease:[{ease:["linear","initial",w,Le,Pe]}],delay:[{delay:[lt,Le,Pe]}],animate:[{animate:["none",M,Le,Pe]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[S,Le,Pe]}],"perspective-origin":[{"perspective-origin":A()}],rotate:[{rotate:Ce()}],"rotate-x":[{"rotate-x":Ce()}],"rotate-y":[{"rotate-y":Ce()}],"rotate-z":[{"rotate-z":Ce()}],scale:[{scale:qe()}],"scale-x":[{"scale-x":qe()}],"scale-y":[{"scale-y":qe()}],"scale-z":[{"scale-z":qe()}],"scale-3d":["scale-3d"],skew:[{skew:dt()}],"skew-x":[{"skew-x":dt()}],"skew-y":[{"skew-y":dt()}],transform:[{transform:[Le,Pe,"","none","gpu","cpu"]}],"transform-origin":[{origin:A()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:yt()}],"translate-x":[{"translate-x":yt()}],"translate-y":[{"translate-y":yt()}],"translate-z":[{"translate-z":yt()}],"translate-none":["translate-none"],accent:[{accent:q()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:q()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Le,Pe]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":P()}],"scroll-mx":[{"scroll-mx":P()}],"scroll-my":[{"scroll-my":P()}],"scroll-ms":[{"scroll-ms":P()}],"scroll-me":[{"scroll-me":P()}],"scroll-mt":[{"scroll-mt":P()}],"scroll-mr":[{"scroll-mr":P()}],"scroll-mb":[{"scroll-mb":P()}],"scroll-ml":[{"scroll-ml":P()}],"scroll-p":[{"scroll-p":P()}],"scroll-px":[{"scroll-px":P()}],"scroll-py":[{"scroll-py":P()}],"scroll-ps":[{"scroll-ps":P()}],"scroll-pe":[{"scroll-pe":P()}],"scroll-pt":[{"scroll-pt":P()}],"scroll-pr":[{"scroll-pr":P()}],"scroll-pb":[{"scroll-pb":P()}],"scroll-pl":[{"scroll-pl":P()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Le,Pe]}],fill:[{fill:["none",...q()]}],"stroke-w":[{stroke:[lt,sh,fl,F0]}],stroke:[{stroke:["none",...q()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},rY=BK(sY);function Ie(...e){return rY(sj(e))}function vj(e){try{const t=atob(e),n=Uint8Array.from(t,s=>s.charCodeAt(0));return{text:new TextDecoder("utf-8").decode(n),ok:!0}}catch{return{text:"",ok:!1}}}function km(e){const t=new TextEncoder().encode(e),n=Array.from(t,i=>String.fromCharCode(i)).join("");return btoa(n)}function Bo({size:e="md",className:t,label:n}){const{t:i}=rt(),s={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"},r=n===void 0?i("loading"):n,o=r===null?{"aria-hidden":!0}:{role:"status","aria-label":r};return g.jsxs("svg",{className:Ie(s[e],"animate-spin text-[var(--app-hint)]",t),viewBox:"0 0 24 24",fill:"none",...o,children:[g.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"2.5",opacity:"0.25"}),g.jsx("path",{d:"M21 12a9 9 0 0 0-9-9",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",opacity:"0.75"})]})}function eL(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function mk(...e){return t=>{let n=!1;const i=e.map(s=>{const r=eL(s,t);return!n&&typeof r=="function"&&(n=!0),r});if(n)return()=>{for(let s=0;s<i.length;s++){const r=i[s];typeof r=="function"?r():eL(e[s],null)}}}}function pr(...e){return k.useCallback(mk(...e),e)}var oY=Symbol.for("react.lazy"),dv=yC[" use ".trim().toString()];function aY(e){return typeof e=="object"&&e!==null&&"then"in e}function yj(e){return e!=null&&typeof e=="object"&&"$$typeof"in e&&e.$$typeof===oY&&"_payload"in e&&aY(e._payload)}function bj(e){const t=lY(e),n=k.forwardRef((i,s)=>{let{children:r,...o}=i;yj(r)&&typeof dv=="function"&&(r=dv(r._payload));const a=k.Children.toArray(r),c=a.find(uY);if(c){const u=c.props.children,h=a.map(f=>f===c?k.Children.count(u)>1?k.Children.only(null):k.isValidElement(u)?u.props.children:null:f);return g.jsx(t,{...o,ref:s,children:k.isValidElement(u)?k.cloneElement(u,void 0,h):null})}return g.jsx(t,{...o,ref:s,children:r})});return n.displayName=`${e}.Slot`,n}var gk=bj("Slot");function lY(e){const t=k.forwardRef((n,i)=>{let{children:s,...r}=n;if(yj(s)&&typeof dv=="function"&&(s=dv(s._payload)),k.isValidElement(s)){const o=hY(s),a=dY(r,s.props);return s.type!==k.Fragment&&(a.ref=i?mk(i,o):o),k.cloneElement(s,a)}return k.Children.count(s)>1?k.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var cY=Symbol("radix.slottable");function uY(e){return k.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===cY}function dY(e,t){const n={...t};for(const i in t){const s=e[i],r=t[i];/^on[A-Z]/.test(i)?s&&r?n[i]=(...a)=>{const c=r(...a);return s(...a),c}:s&&(n[i]=s):i==="style"?n[i]={...s,...r}:i==="className"&&(n[i]=[s,r].filter(Boolean).join(" "))}return{...e,...n}}function hY(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}const tL=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,nL=sj,vk=(e,t)=>n=>{var i;if(t?.variants==null)return nL(e,n?.class,n?.className);const{variants:s,defaultVariants:r}=t,o=Object.keys(s).map(u=>{const h=n?.[u],f=r?.[u];if(h===null)return null;const m=tL(h)||tL(f);return s[u][m]}),a=n&&Object.entries(n).reduce((u,h)=>{let[f,m]=h;return m===void 0||(u[f]=m),u},{}),c=t==null||(i=t.compoundVariants)===null||i===void 0?void 0:i.reduce((u,h)=>{let{class:f,className:m,...y}=h;return Object.entries(y).every(b=>{let[S,_]=b;return Array.isArray(_)?_.includes({...r,...a}[S]):{...r,...a}[S]===_})?[...u,f,m]:u},[]);return nL(e,o,c,n?.class,n?.className)},fY=vk("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-link)] disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-[var(--app-button)] text-[var(--app-button-text)] hover:opacity-90",secondary:"bg-[var(--app-secondary-bg)] text-[var(--app-fg)] hover:opacity-90",outline:"border border-[var(--app-border)] bg-transparent hover:bg-[var(--app-subtle-bg)]",destructive:"bg-red-600 text-white hover:bg-red-600/90"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3",lg:"h-10 rounded-md px-8"}},defaultVariants:{variant:"default",size:"default"}}),Xn=k.forwardRef(({className:e,variant:t,size:n,asChild:i=!1,...s},r)=>{const o=i?gk:"button";return g.jsx(o,{className:Ie(fY({variant:t,size:n,className:e})),ref:r,...s})});Xn.displayName="Button";function fs(e,t,{checkForDefaultPrevented:n=!0}={}){return function(s){if(e?.(s),n===!1||!s.defaultPrevented)return t?.(s)}}function pY(e,t){const n=k.createContext(t),i=r=>{const{children:o,...a}=r,c=k.useMemo(()=>a,Object.values(a));return g.jsx(n.Provider,{value:c,children:o})};i.displayName=e+"Provider";function s(r){const o=k.useContext(n);if(o)return o;if(t!==void 0)return t;throw new Error(`\`${r}\` must be used within \`${e}\``)}return[i,s]}function mY(e,t=[]){let n=[];function i(r,o){const a=k.createContext(o),c=n.length;n=[...n,o];const u=f=>{const{scope:m,children:y,...b}=f,S=m?.[e]?.[c]||a,_=k.useMemo(()=>b,Object.values(b));return g.jsx(S.Provider,{value:_,children:y})};u.displayName=r+"Provider";function h(f,m){const y=m?.[e]?.[c]||a,b=k.useContext(y);if(b)return b;if(o!==void 0)return o;throw new Error(`\`${f}\` must be used within \`${r}\``)}return[u,h]}const s=()=>{const r=n.map(o=>k.createContext(o));return function(a){const c=a?.[e]||r;return k.useMemo(()=>({[`__scope${e}`]:{...a,[e]:c}}),[a,c])}};return s.scopeName=e,[i,gY(s,...t)]}function gY(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const i=e.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(r){const o=i.reduce((a,{useScope:c,scopeName:u})=>{const f=c(r)[`__scope${u}`];return{...a,...f}},{});return k.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return n.scopeName=t.scopeName,n}var ff=globalThis?.document?k.useLayoutEffect:()=>{},vY=yC[" useId ".trim().toString()]||(()=>{}),yY=0;function U0(e){const[t,n]=k.useState(vY());return ff(()=>{n(i=>i??String(yY++))},[e]),e||(t?`radix-${t}`:"")}var bY=yC[" useInsertionEffect ".trim().toString()]||ff;function _Y({prop:e,defaultProp:t,onChange:n=()=>{},caller:i}){const[s,r,o]=SY({defaultProp:t,onChange:n}),a=e!==void 0,c=a?e:s;{const h=k.useRef(e!==void 0);k.useEffect(()=>{const f=h.current;f!==a&&console.warn(`${i} is changing from ${f?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=a},[a,i])}const u=k.useCallback(h=>{if(a){const f=xY(h)?h(e):h;f!==e&&o.current?.(f)}else r(h)},[a,e,r,o]);return[c,u]}function SY({defaultProp:e,onChange:t}){const[n,i]=k.useState(e),s=k.useRef(n),r=k.useRef(t);return bY(()=>{r.current=t},[t]),k.useEffect(()=>{s.current!==n&&(r.current?.(n),s.current=n)},[n,s]),[n,i,r]}function xY(e){return typeof e=="function"}function _j(e){const t=wY(e),n=k.forwardRef((i,s)=>{const{children:r,...o}=i,a=k.Children.toArray(r),c=a.find(kY);if(c){const u=c.props.children,h=a.map(f=>f===c?k.Children.count(u)>1?k.Children.only(null):k.isValidElement(u)?u.props.children:null:f);return g.jsx(t,{...o,ref:s,children:k.isValidElement(u)?k.cloneElement(u,void 0,h):null})}return g.jsx(t,{...o,ref:s,children:r})});return n.displayName=`${e}.Slot`,n}function wY(e){const t=k.forwardRef((n,i)=>{const{children:s,...r}=n;if(k.isValidElement(s)){const o=EY(s),a=TY(r,s.props);return s.type!==k.Fragment&&(a.ref=i?mk(i,o):o),k.cloneElement(s,a)}return k.Children.count(s)>1?k.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var CY=Symbol("radix.slottable");function kY(e){return k.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===CY}function TY(e,t){const n={...t};for(const i in t){const s=e[i],r=t[i];/^on[A-Z]/.test(i)?s&&r?n[i]=(...a)=>{const c=r(...a);return s(...a),c}:s&&(n[i]=s):i==="style"?n[i]={...s,...r}:i==="className"&&(n[i]=[s,r].filter(Boolean).join(" "))}return{...e,...n}}function EY(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var RY=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Fo=RY.reduce((e,t)=>{const n=_j(`Primitive.${t}`),i=k.forwardRef((s,r)=>{const{asChild:o,...a}=s,c=o?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(c,{...a,ref:r})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{});function MY(e,t){e&&PC.flushSync(()=>e.dispatchEvent(t))}function ur(e){const t=k.useRef(e);return k.useEffect(()=>{t.current=e}),k.useMemo(()=>(...n)=>t.current?.(...n),[])}function Sj(e,t=globalThis?.document){const n=ur(e);k.useEffect(()=>{const i=s=>{s.key==="Escape"&&n(s)};return t.addEventListener("keydown",i,{capture:!0}),()=>t.removeEventListener("keydown",i,{capture:!0})},[n,t])}var AY="DismissableLayer",Vx="dismissableLayer.update",PY="dismissableLayer.pointerDownOutside",LY="dismissableLayer.focusOutside",iL,xj=k.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),wj=k.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:s,onFocusOutside:r,onInteractOutside:o,onDismiss:a,...c}=e,u=k.useContext(xj),[h,f]=k.useState(null),m=h?.ownerDocument??globalThis?.document,[,y]=k.useState({}),b=pr(t,L=>f(L)),S=Array.from(u.layers),[_]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),w=S.indexOf(_),M=h?S.indexOf(h):-1,R=u.layersWithOutsidePointerEventsDisabled.size>0,E=M>=w,A=DY(L=>{const P=L.target,I=[...u.branches].some(N=>N.contains(P));!E||I||(s?.(L),o?.(L),L.defaultPrevented||a?.())},m),T=OY(L=>{const P=L.target;[...u.branches].some(N=>N.contains(P))||(r?.(L),o?.(L),L.defaultPrevented||a?.())},m);return Sj(L=>{M===u.layers.size-1&&(i?.(L),!L.defaultPrevented&&a&&(L.preventDefault(),a()))},m),k.useEffect(()=>{if(h)return n&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(iL=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(h)),u.layers.add(h),sL(),()=>{n&&u.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=iL)}},[h,m,n,u]),k.useEffect(()=>()=>{h&&(u.layers.delete(h),u.layersWithOutsidePointerEventsDisabled.delete(h),sL())},[h,u]),k.useEffect(()=>{const L=()=>y({});return document.addEventListener(Vx,L),()=>document.removeEventListener(Vx,L)},[]),g.jsx(Fo.div,{...c,ref:b,style:{pointerEvents:R?E?"auto":"none":void 0,...e.style},onFocusCapture:fs(e.onFocusCapture,T.onFocusCapture),onBlurCapture:fs(e.onBlurCapture,T.onBlurCapture),onPointerDownCapture:fs(e.onPointerDownCapture,A.onPointerDownCapture)})});wj.displayName=AY;var NY="DismissableLayerBranch",IY=k.forwardRef((e,t)=>{const n=k.useContext(xj),i=k.useRef(null),s=pr(t,i);return k.useEffect(()=>{const r=i.current;if(r)return n.branches.add(r),()=>{n.branches.delete(r)}},[n.branches]),g.jsx(Fo.div,{...e,ref:s})});IY.displayName=NY;function DY(e,t=globalThis?.document){const n=ur(e),i=k.useRef(!1),s=k.useRef(()=>{});return k.useEffect(()=>{const r=a=>{if(a.target&&!i.current){let c=function(){Cj(PY,n,u,{discrete:!0})};const u={originalEvent:a};a.pointerType==="touch"?(t.removeEventListener("click",s.current),s.current=c,t.addEventListener("click",s.current,{once:!0})):c()}else t.removeEventListener("click",s.current);i.current=!1},o=window.setTimeout(()=>{t.addEventListener("pointerdown",r)},0);return()=>{window.clearTimeout(o),t.removeEventListener("pointerdown",r),t.removeEventListener("click",s.current)}},[t,n]),{onPointerDownCapture:()=>i.current=!0}}function OY(e,t=globalThis?.document){const n=ur(e),i=k.useRef(!1);return k.useEffect(()=>{const s=r=>{r.target&&!i.current&&Cj(LY,n,{originalEvent:r},{discrete:!1})};return t.addEventListener("focusin",s),()=>t.removeEventListener("focusin",s)},[t,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function sL(){const e=new CustomEvent(Vx);document.dispatchEvent(e)}function Cj(e,t,n,{discrete:i}){const s=n.originalEvent.target,r=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&s.addEventListener(e,t,{once:!0}),i?MY(s,r):s.dispatchEvent(r)}var z0="focusScope.autoFocusOnMount",$0="focusScope.autoFocusOnUnmount",rL={bubbles:!1,cancelable:!0},jY="FocusScope",kj=k.forwardRef((e,t)=>{const{loop:n=!1,trapped:i=!1,onMountAutoFocus:s,onUnmountAutoFocus:r,...o}=e,[a,c]=k.useState(null),u=ur(s),h=ur(r),f=k.useRef(null),m=pr(t,S=>c(S)),y=k.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;k.useEffect(()=>{if(i){let S=function(R){if(y.paused||!a)return;const E=R.target;a.contains(E)?f.current=E:_a(f.current,{select:!0})},_=function(R){if(y.paused||!a)return;const E=R.relatedTarget;E!==null&&(a.contains(E)||_a(f.current,{select:!0}))},w=function(R){if(document.activeElement===document.body)for(const A of R)A.removedNodes.length>0&&_a(a)};document.addEventListener("focusin",S),document.addEventListener("focusout",_);const M=new MutationObserver(w);return a&&M.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",S),document.removeEventListener("focusout",_),M.disconnect()}}},[i,a,y.paused]),k.useEffect(()=>{if(a){aL.add(y);const S=document.activeElement;if(!a.contains(S)){const w=new CustomEvent(z0,rL);a.addEventListener(z0,u),a.dispatchEvent(w),w.defaultPrevented||(BY(qY(Tj(a)),{select:!0}),document.activeElement===S&&_a(a))}return()=>{a.removeEventListener(z0,u),setTimeout(()=>{const w=new CustomEvent($0,rL);a.addEventListener($0,h),a.dispatchEvent(w),w.defaultPrevented||_a(S??document.body,{select:!0}),a.removeEventListener($0,h),aL.remove(y)},0)}}},[a,u,h,y]);const b=k.useCallback(S=>{if(!n&&!i||y.paused)return;const _=S.key==="Tab"&&!S.altKey&&!S.ctrlKey&&!S.metaKey,w=document.activeElement;if(_&&w){const M=S.currentTarget,[R,E]=FY(M);R&&E?!S.shiftKey&&w===E?(S.preventDefault(),n&&_a(R,{select:!0})):S.shiftKey&&w===R&&(S.preventDefault(),n&&_a(E,{select:!0})):w===M&&S.preventDefault()}},[n,i,y.paused]);return g.jsx(Fo.div,{tabIndex:-1,...o,ref:m,onKeyDown:b})});kj.displayName=jY;function BY(e,{select:t=!1}={}){const n=document.activeElement;for(const i of e)if(_a(i,{select:t}),document.activeElement!==n)return}function FY(e){const t=Tj(e),n=oL(t,e),i=oL(t.reverse(),e);return[n,i]}function Tj(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const s=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||s?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function oL(e,t){for(const n of e)if(!UY(n,{upTo:t}))return n}function UY(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function zY(e){return e instanceof HTMLInputElement&&"select"in e}function _a(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&zY(e)&&t&&e.select()}}var aL=$Y();function $Y(){let e=[];return{add(t){const n=e[0];t!==n&&n?.pause(),e=lL(e,t),e.unshift(t)},remove(t){e=lL(e,t),e[0]?.resume()}}}function lL(e,t){const n=[...e],i=n.indexOf(t);return i!==-1&&n.splice(i,1),n}function qY(e){return e.filter(t=>t.tagName!=="A")}var HY="Portal",Ej=k.forwardRef((e,t)=>{const{container:n,...i}=e,[s,r]=k.useState(!1);ff(()=>r(!0),[]);const o=n||s&&globalThis?.document?.body;return o?kq.createPortal(g.jsx(Fo.div,{...i,ref:t}),o):null});Ej.displayName=HY;function VY(e,t){return k.useReducer((n,i)=>t[n][i]??n,e)}var oy=e=>{const{present:t,children:n}=e,i=WY(t),s=typeof n=="function"?n({present:i.isPresent}):k.Children.only(n),r=pr(i.ref,GY(s));return typeof n=="function"||i.isPresent?k.cloneElement(s,{ref:r}):null};oy.displayName="Presence";function WY(e){const[t,n]=k.useState(),i=k.useRef(null),s=k.useRef(e),r=k.useRef("none"),o=e?"mounted":"unmounted",[a,c]=VY(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return k.useEffect(()=>{const u=Tm(i.current);r.current=a==="mounted"?u:"none"},[a]),ff(()=>{const u=i.current,h=s.current;if(h!==e){const m=r.current,y=Tm(u);e?c("MOUNT"):y==="none"||u?.display==="none"?c("UNMOUNT"):c(h&&m!==y?"ANIMATION_OUT":"UNMOUNT"),s.current=e}},[e,c]),ff(()=>{if(t){let u;const h=t.ownerDocument.defaultView??window,f=y=>{const S=Tm(i.current).includes(CSS.escape(y.animationName));if(y.target===t&&S&&(c("ANIMATION_END"),!s.current)){const _=t.style.animationFillMode;t.style.animationFillMode="forwards",u=h.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=_)})}},m=y=>{y.target===t&&(r.current=Tm(i.current))};return t.addEventListener("animationstart",m),t.addEventListener("animationcancel",f),t.addEventListener("animationend",f),()=>{h.clearTimeout(u),t.removeEventListener("animationstart",m),t.removeEventListener("animationcancel",f),t.removeEventListener("animationend",f)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:k.useCallback(u=>{i.current=u?getComputedStyle(u):null,n(u)},[])}}function Tm(e){return e?.animationName||"none"}function GY(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var q0=0;function KY(){k.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??cL()),document.body.insertAdjacentElement("beforeend",e[1]??cL()),q0++,()=>{q0===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),q0--}},[])}function cL(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var Ar=function(){return Ar=Object.assign||function(t){for(var n,i=1,s=arguments.length;i<s;i++){n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Ar.apply(this,arguments)};function Rj(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]]);return n}function YY(e,t,n){if(n||arguments.length===2)for(var i=0,s=t.length,r;i<s;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var _g="right-scroll-bar-position",Sg="width-before-scroll-bar",XY="with-scroll-bars-hidden",QY="--removed-body-scroll-bar-size";function H0(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function JY(e,t){var n=k.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(i){var s=n.value;s!==i&&(n.value=i,n.callback(i,s))}}}})[0];return n.callback=t,n.facade}var ZY=typeof window<"u"?k.useLayoutEffect:k.useEffect,uL=new WeakMap;function eX(e,t){var n=JY(null,function(i){return e.forEach(function(s){return H0(s,i)})});return ZY(function(){var i=uL.get(n);if(i){var s=new Set(i),r=new Set(e),o=n.current;s.forEach(function(a){r.has(a)||H0(a,null)}),r.forEach(function(a){s.has(a)||H0(a,o)})}uL.set(n,e)},[e]),n}function tX(e){return e}function nX(e,t){t===void 0&&(t=tX);var n=[],i=!1,s={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(r){var o=t(r,i);return n.push(o),function(){n=n.filter(function(a){return a!==o})}},assignSyncMedium:function(r){for(i=!0;n.length;){var o=n;n=[],o.forEach(r)}n={push:function(a){return r(a)},filter:function(){return n}}},assignMedium:function(r){i=!0;var o=[];if(n.length){var a=n;n=[],a.forEach(r),o=n}var c=function(){var h=o;o=[],h.forEach(r)},u=function(){return Promise.resolve().then(c)};u(),n={push:function(h){o.push(h),u()},filter:function(h){return o=o.filter(h),n}}}};return s}function iX(e){e===void 0&&(e={});var t=nX(null);return t.options=Ar({async:!0,ssr:!1},e),t}var Mj=function(e){var t=e.sideCar,n=Rj(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=t.read();if(!i)throw new Error("Sidecar medium not found");return k.createElement(i,Ar({},n))};Mj.isSideCarExport=!0;function sX(e,t){return e.useMedium(t),Mj}var Aj=iX(),V0=function(){},ay=k.forwardRef(function(e,t){var n=k.useRef(null),i=k.useState({onScrollCapture:V0,onWheelCapture:V0,onTouchMoveCapture:V0}),s=i[0],r=i[1],o=e.forwardProps,a=e.children,c=e.className,u=e.removeScrollBar,h=e.enabled,f=e.shards,m=e.sideCar,y=e.noRelative,b=e.noIsolation,S=e.inert,_=e.allowPinchZoom,w=e.as,M=w===void 0?"div":w,R=e.gapMode,E=Rj(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),A=m,T=eX([n,t]),L=Ar(Ar({},E),s);return k.createElement(k.Fragment,null,h&&k.createElement(A,{sideCar:Aj,removeScrollBar:u,shards:f,noRelative:y,noIsolation:b,inert:S,setCallbacks:r,allowPinchZoom:!!_,lockRef:n,gapMode:R}),o?k.cloneElement(k.Children.only(a),Ar(Ar({},L),{ref:T})):k.createElement(M,Ar({},L,{className:c,ref:T}),a))});ay.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};ay.classNames={fullWidth:Sg,zeroRight:_g};var rX=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function oX(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=rX();return t&&e.setAttribute("nonce",t),e}function aX(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function lX(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var cX=function(){var e=0,t=null;return{add:function(n){e==0&&(t=oX())&&(aX(t,n),lX(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},uX=function(){var e=cX();return function(t,n){k.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},Pj=function(){var e=uX(),t=function(n){var i=n.styles,s=n.dynamic;return e(i,s),null};return t},dX={left:0,top:0,right:0,gap:0},W0=function(e){return parseInt(e||"",10)||0},hX=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],i=t[e==="padding"?"paddingTop":"marginTop"],s=t[e==="padding"?"paddingRight":"marginRight"];return[W0(n),W0(i),W0(s)]},fX=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return dX;var t=hX(e),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,i-n+t[2]-t[0])}},pX=Pj(),Tu="data-scroll-locked",mX=function(e,t,n,i){var s=e.left,r=e.top,o=e.right,a=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(XY,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(a,"px ").concat(i,`;
  }
  body[`).concat(Tu,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(i,";"),n==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(r,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(i,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(_g,` {
    right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(Sg,` {
    margin-right: `).concat(a,"px ").concat(i,`;
  }
  
  .`).concat(_g," .").concat(_g,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(Sg," .").concat(Sg,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(Tu,`] {
    `).concat(QY,": ").concat(a,`px;
  }
`)},dL=function(){var e=parseInt(document.body.getAttribute(Tu)||"0",10);return isFinite(e)?e:0},gX=function(){k.useEffect(function(){return document.body.setAttribute(Tu,(dL()+1).toString()),function(){var e=dL()-1;e<=0?document.body.removeAttribute(Tu):document.body.setAttribute(Tu,e.toString())}},[])},vX=function(e){var t=e.noRelative,n=e.noImportant,i=e.gapMode,s=i===void 0?"margin":i;gX();var r=k.useMemo(function(){return fX(s)},[s]);return k.createElement(pX,{styles:mX(r,!t,s,n?"":"!important")})},Wx=!1;if(typeof window<"u")try{var Em=Object.defineProperty({},"passive",{get:function(){return Wx=!0,!0}});window.addEventListener("test",Em,Em),window.removeEventListener("test",Em,Em)}catch{Wx=!1}var Xc=Wx?{passive:!1}:!1,yX=function(e){return e.tagName==="TEXTAREA"},Lj=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!yX(e)&&n[t]==="visible")},bX=function(e){return Lj(e,"overflowY")},_X=function(e){return Lj(e,"overflowX")},hL=function(e,t){var n=t.ownerDocument,i=t;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var s=Nj(e,i);if(s){var r=Ij(e,i),o=r[1],a=r[2];if(o>a)return!0}i=i.parentNode}while(i&&i!==n.body);return!1},SX=function(e){var t=e.scrollTop,n=e.scrollHeight,i=e.clientHeight;return[t,n,i]},xX=function(e){var t=e.scrollLeft,n=e.scrollWidth,i=e.clientWidth;return[t,n,i]},Nj=function(e,t){return e==="v"?bX(t):_X(t)},Ij=function(e,t){return e==="v"?SX(t):xX(t)},wX=function(e,t){return e==="h"&&t==="rtl"?-1:1},CX=function(e,t,n,i,s){var r=wX(e,window.getComputedStyle(t).direction),o=r*i,a=n.target,c=t.contains(a),u=!1,h=o>0,f=0,m=0;do{if(!a)break;var y=Ij(e,a),b=y[0],S=y[1],_=y[2],w=S-_-r*b;(b||w)&&Nj(e,a)&&(f+=w,m+=b);var M=a.parentNode;a=M&&M.nodeType===Node.DOCUMENT_FRAGMENT_NODE?M.host:M}while(!c&&a!==document.body||c&&(t.contains(a)||t===a));return(h&&Math.abs(f)<1||!h&&Math.abs(m)<1)&&(u=!0),u},Rm=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},fL=function(e){return[e.deltaX,e.deltaY]},pL=function(e){return e&&"current"in e?e.current:e},kX=function(e,t){return e[0]===t[0]&&e[1]===t[1]},TX=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},EX=0,Qc=[];function RX(e){var t=k.useRef([]),n=k.useRef([0,0]),i=k.useRef(),s=k.useState(EX++)[0],r=k.useState(Pj)[0],o=k.useRef(e);k.useEffect(function(){o.current=e},[e]),k.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(s));var S=YY([e.lockRef.current],(e.shards||[]).map(pL),!0).filter(Boolean);return S.forEach(function(_){return _.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),S.forEach(function(_){return _.classList.remove("allow-interactivity-".concat(s))})}}},[e.inert,e.lockRef.current,e.shards]);var a=k.useCallback(function(S,_){if("touches"in S&&S.touches.length===2||S.type==="wheel"&&S.ctrlKey)return!o.current.allowPinchZoom;var w=Rm(S),M=n.current,R="deltaX"in S?S.deltaX:M[0]-w[0],E="deltaY"in S?S.deltaY:M[1]-w[1],A,T=S.target,L=Math.abs(R)>Math.abs(E)?"h":"v";if("touches"in S&&L==="h"&&T.type==="range")return!1;var P=window.getSelection(),I=P&&P.anchorNode,N=I?I===T||I.contains(T):!1;if(N)return!1;var O=hL(L,T);if(!O)return!0;if(O?A=L:(A=L==="v"?"h":"v",O=hL(L,T)),!O)return!1;if(!i.current&&"changedTouches"in S&&(R||E)&&(i.current=A),!A)return!0;var j=i.current||A;return CX(j,_,S,j==="h"?R:E)},[]),c=k.useCallback(function(S){var _=S;if(!(!Qc.length||Qc[Qc.length-1]!==r)){var w="deltaY"in _?fL(_):Rm(_),M=t.current.filter(function(A){return A.name===_.type&&(A.target===_.target||_.target===A.shadowParent)&&kX(A.delta,w)})[0];if(M&&M.should){_.cancelable&&_.preventDefault();return}if(!M){var R=(o.current.shards||[]).map(pL).filter(Boolean).filter(function(A){return A.contains(_.target)}),E=R.length>0?a(_,R[0]):!o.current.noIsolation;E&&_.cancelable&&_.preventDefault()}}},[]),u=k.useCallback(function(S,_,w,M){var R={name:S,delta:_,target:w,should:M,shadowParent:MX(w)};t.current.push(R),setTimeout(function(){t.current=t.current.filter(function(E){return E!==R})},1)},[]),h=k.useCallback(function(S){n.current=Rm(S),i.current=void 0},[]),f=k.useCallback(function(S){u(S.type,fL(S),S.target,a(S,e.lockRef.current))},[]),m=k.useCallback(function(S){u(S.type,Rm(S),S.target,a(S,e.lockRef.current))},[]);k.useEffect(function(){return Qc.push(r),e.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:m}),document.addEventListener("wheel",c,Xc),document.addEventListener("touchmove",c,Xc),document.addEventListener("touchstart",h,Xc),function(){Qc=Qc.filter(function(S){return S!==r}),document.removeEventListener("wheel",c,Xc),document.removeEventListener("touchmove",c,Xc),document.removeEventListener("touchstart",h,Xc)}},[]);var y=e.removeScrollBar,b=e.inert;return k.createElement(k.Fragment,null,b?k.createElement(r,{styles:TX(s)}):null,y?k.createElement(vX,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function MX(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const AX=sX(Aj,RX);var Dj=k.forwardRef(function(e,t){return k.createElement(ay,Ar({},e,{ref:t,sideCar:AX}))});Dj.classNames=ay.classNames;var PX=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Jc=new WeakMap,Mm=new WeakMap,Am={},G0=0,Oj=function(e){return e&&(e.host||Oj(e.parentNode))},LX=function(e,t){return t.map(function(n){if(e.contains(n))return n;var i=Oj(n);return i&&e.contains(i)?i:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},NX=function(e,t,n,i){var s=LX(t,Array.isArray(e)?e:[e]);Am[n]||(Am[n]=new WeakMap);var r=Am[n],o=[],a=new Set,c=new Set(s),u=function(f){!f||a.has(f)||(a.add(f),u(f.parentNode))};s.forEach(u);var h=function(f){!f||c.has(f)||Array.prototype.forEach.call(f.children,function(m){if(a.has(m))h(m);else try{var y=m.getAttribute(i),b=y!==null&&y!=="false",S=(Jc.get(m)||0)+1,_=(r.get(m)||0)+1;Jc.set(m,S),r.set(m,_),o.push(m),S===1&&b&&Mm.set(m,!0),_===1&&m.setAttribute(n,"true"),b||m.setAttribute(i,"true")}catch(w){console.error("aria-hidden: cannot operate on ",m,w)}})};return h(t),a.clear(),G0++,function(){o.forEach(function(f){var m=Jc.get(f)-1,y=r.get(f)-1;Jc.set(f,m),r.set(f,y),m||(Mm.has(f)||f.removeAttribute(i),Mm.delete(f)),y||f.removeAttribute(n)}),G0--,G0||(Jc=new WeakMap,Jc=new WeakMap,Mm=new WeakMap,Am={})}},IX=function(e,t,n){n===void 0&&(n="data-aria-hidden");var i=Array.from(Array.isArray(e)?e:[e]),s=PX(e);return s?(i.push.apply(i,Array.from(s.querySelectorAll("[aria-live], script"))),NX(i,s,n,"aria-hidden")):function(){return null}},ly="Dialog",[jj]=mY(ly),[DX,mr]=jj(ly),Bj=e=>{const{__scopeDialog:t,children:n,open:i,defaultOpen:s,onOpenChange:r,modal:o=!0}=e,a=k.useRef(null),c=k.useRef(null),[u,h]=_Y({prop:i,defaultProp:s??!1,onChange:r,caller:ly});return g.jsx(DX,{scope:t,triggerRef:a,contentRef:c,contentId:U0(),titleId:U0(),descriptionId:U0(),open:u,onOpenChange:h,onOpenToggle:k.useCallback(()=>h(f=>!f),[h]),modal:o,children:n})};Bj.displayName=ly;var Fj="DialogTrigger",Uj=k.forwardRef((e,t)=>{const{__scopeDialog:n,...i}=e,s=mr(Fj,n),r=pr(t,s.triggerRef);return g.jsx(Fo.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":_k(s.open),...i,ref:r,onClick:fs(e.onClick,s.onOpenToggle)})});Uj.displayName=Fj;var yk="DialogPortal",[OX,zj]=jj(yk,{forceMount:void 0}),$j=e=>{const{__scopeDialog:t,forceMount:n,children:i,container:s}=e,r=mr(yk,t);return g.jsx(OX,{scope:t,forceMount:n,children:k.Children.map(i,o=>g.jsx(oy,{present:n||r.open,children:g.jsx(Ej,{asChild:!0,container:s,children:o})}))})};$j.displayName=yk;var hv="DialogOverlay",qj=k.forwardRef((e,t)=>{const n=zj(hv,e.__scopeDialog),{forceMount:i=n.forceMount,...s}=e,r=mr(hv,e.__scopeDialog);return r.modal?g.jsx(oy,{present:i||r.open,children:g.jsx(BX,{...s,ref:t})}):null});qj.displayName=hv;var jX=_j("DialogOverlay.RemoveScroll"),BX=k.forwardRef((e,t)=>{const{__scopeDialog:n,...i}=e,s=mr(hv,n);return g.jsx(Dj,{as:jX,allowPinchZoom:!0,shards:[s.contentRef],children:g.jsx(Fo.div,{"data-state":_k(s.open),...i,ref:t,style:{pointerEvents:"auto",...i.style}})})}),Gl="DialogContent",Hj=k.forwardRef((e,t)=>{const n=zj(Gl,e.__scopeDialog),{forceMount:i=n.forceMount,...s}=e,r=mr(Gl,e.__scopeDialog);return g.jsx(oy,{present:i||r.open,children:r.modal?g.jsx(FX,{...s,ref:t}):g.jsx(UX,{...s,ref:t})})});Hj.displayName=Gl;var FX=k.forwardRef((e,t)=>{const n=mr(Gl,e.__scopeDialog),i=k.useRef(null),s=pr(t,n.contentRef,i);return k.useEffect(()=>{const r=i.current;if(r)return IX(r)},[]),g.jsx(Vj,{...e,ref:s,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:fs(e.onCloseAutoFocus,r=>{r.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:fs(e.onPointerDownOutside,r=>{const o=r.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&r.preventDefault()}),onFocusOutside:fs(e.onFocusOutside,r=>r.preventDefault())})}),UX=k.forwardRef((e,t)=>{const n=mr(Gl,e.__scopeDialog),i=k.useRef(!1),s=k.useRef(!1);return g.jsx(Vj,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{e.onCloseAutoFocus?.(r),r.defaultPrevented||(i.current||n.triggerRef.current?.focus(),r.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:r=>{e.onInteractOutside?.(r),r.defaultPrevented||(i.current=!0,r.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const o=r.target;n.triggerRef.current?.contains(o)&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&s.current&&r.preventDefault()}})}),Vj=k.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:r,...o}=e,a=mr(Gl,n),c=k.useRef(null),u=pr(t,c);return KY(),g.jsxs(g.Fragment,{children:[g.jsx(kj,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:s,onUnmountAutoFocus:r,children:g.jsx(wj,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":_k(a.open),...o,ref:u,onDismiss:()=>a.onOpenChange(!1)})}),g.jsxs(g.Fragment,{children:[g.jsx($X,{titleId:a.titleId}),g.jsx(HX,{contentRef:c,descriptionId:a.descriptionId})]})]})}),bk="DialogTitle",Wj=k.forwardRef((e,t)=>{const{__scopeDialog:n,...i}=e,s=mr(bk,n);return g.jsx(Fo.h2,{id:s.titleId,...i,ref:t})});Wj.displayName=bk;var Gj="DialogDescription",Kj=k.forwardRef((e,t)=>{const{__scopeDialog:n,...i}=e,s=mr(Gj,n);return g.jsx(Fo.p,{id:s.descriptionId,...i,ref:t})});Kj.displayName=Gj;var Yj="DialogClose",zX=k.forwardRef((e,t)=>{const{__scopeDialog:n,...i}=e,s=mr(Yj,n);return g.jsx(Fo.button,{type:"button",...i,ref:t,onClick:fs(e.onClick,()=>s.onOpenChange(!1))})});zX.displayName=Yj;function _k(e){return e?"open":"closed"}var Xj="DialogTitleWarning",[CSe,Qj]=pY(Xj,{contentName:Gl,titleName:bk,docsSlug:"dialog"}),$X=({titleId:e})=>{const t=Qj(Xj),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return k.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},qX="DialogDescriptionWarning",HX=({contentRef:e,descriptionId:t})=>{const i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Qj(qX).contentName}}.`;return k.useEffect(()=>{const s=e.current?.getAttribute("aria-describedby");t&&s&&(document.getElementById(t)||console.warn(i))},[i,e,t]),null},VX=Bj,WX=Uj,GX=$j,KX=qj,YX=Hj,XX=Wj,QX=Kj;const ec=VX,cy=WX,Va=k.forwardRef(({className:e,...t},n)=>g.jsxs(GX,{children:[g.jsx(KX,{className:"fixed inset-0 z-50 bg-black/50"}),g.jsx(YX,{ref:n,className:Ie("fixed left-1/2 top-1/2 z-50 w-[calc(100vw-24px)] max-w-lg -translate-x-1/2 -translate-y-1/2 rounded-xl bg-[var(--app-secondary-bg)] p-4 shadow-2xl",e),...t})]}));Va.displayName="DialogContent";const tc=({className:e,...t})=>g.jsx("div",{className:Ie("flex flex-col space-y-1.5 text-center sm:text-left",e),...t}),Wa=k.forwardRef(({className:e,...t},n)=>g.jsx(XX,{ref:n,className:Ie("text-base font-semibold leading-none tracking-tight",e),...t}));Wa.displayName="DialogTitle";const Df=k.forwardRef(({className:e,...t},n)=>g.jsx(QX,{ref:n,className:Ie("text-sm text-[var(--app-hint)]",e),...t}));Df.displayName="DialogDescription";function K0(e){const{t}=rt(),n=e.mode==="bind",[i,s]=k.useState(""),[r,o]=k.useState(!1),[a,c]=k.useState(null),[u,h]=k.useState(!1),[f,m]=k.useState(e.serverUrl??""),[y,b]=k.useState(null),S=k.useCallback(async P=>{P.preventDefault();const I=i.trim();if(!I){c(t("login.error.enterToken"));return}if(!n&&e.requireServerUrl&&!e.serverUrl){b(t("login.server.required")),h(!0);return}o(!0),c(null);try{if(n){if(!e.onBind){c(t("login.error.bindingUnavailable"));return}await e.onBind(I)}else{if(await new bh("",{baseUrl:e.baseUrl}).authenticate({accessToken:I}),!e.onLogin){c(t("login.error.loginUnavailable"));return}e.onLogin(I)}}catch(N){const O=t(n?"login.error.bindFailed":"login.error.authFailed");c(N instanceof Error?N.message:O)}finally{o(!1)}},[i,e,t,n]);k.useEffect(()=>{u&&m(e.serverUrl??"")},[u,e.serverUrl]);const _=k.useCallback(P=>{P.preventDefault();const I=e.setServerUrl(f);if(!I.ok){b(I.error);return}b(null),m(I.value),h(!1)},[e,f]),w=k.useCallback(()=>{e.clearServerUrl(),m(""),b(null),h(!1)},[e]),M=k.useCallback(P=>{h(P),P||b(null)},[]),R=a||e.error,E=e.serverUrl??`${e.baseUrl} ${t("login.server.default")}`,A=t(n?"login.bind.title":"login.title"),T=t("login.subtitle"),L=t(n?"login.bind.submit":"login.submit");return g.jsxs("div",{className:"relative h-full flex items-center justify-center p-4",children:[g.jsx("div",{className:"absolute top-4 right-4",children:g.jsx(vK,{})}),g.jsxs("div",{className:"w-full max-w-sm space-y-6",children:[g.jsxs("div",{className:"text-center space-y-2",children:[g.jsx("div",{className:"text-2xl font-semibold",children:A}),g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:T})]}),g.jsxs("form",{onSubmit:S,className:"space-y-4",children:[g.jsx("div",{children:g.jsx("input",{type:"password",value:i,onChange:P=>s(P.target.value),placeholder:t("login.placeholder"),autoComplete:"current-password",disabled:r,className:"w-full px-3 py-2.5 rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent disabled:opacity-50"})}),R&&g.jsx("div",{className:"text-sm text-red-500 text-center",children:R}),g.jsx("button",{type:"submit",disabled:r||!i.trim(),"aria-busy":r,className:"w-full py-2.5 rounded-lg bg-[var(--app-button)] text-[var(--app-button-text)] font-medium disabled:opacity-50 hover:opacity-90 transition-opacity inline-flex items-center justify-center gap-2",children:r?g.jsxs(g.Fragment,{children:[g.jsx(Bo,{size:"sm",label:null,className:"text-[var(--app-button-text)]"}),t(n?"login.bind.submitting":"login.submitting")]}):L})]}),!n&&g.jsxs("div",{className:"flex items-center justify-between text-xs text-[var(--app-hint)]",children:[g.jsx("a",{href:"https://hapi.run/docs",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-[var(--app-fg)]",children:t("login.help")}),g.jsxs(ec,{open:u,onOpenChange:M,children:[g.jsx(cy,{asChild:!0,children:g.jsxs("button",{type:"button",className:"underline hover:text-[var(--app-fg)]",children:["Hub ",e.serverUrl?`${t("login.server.custom")}`:`${t("login.server.default")}`]})}),g.jsxs(Va,{className:"max-w-md",children:[g.jsxs(tc,{children:[g.jsx(Wa,{children:t("login.server.title")}),g.jsx(Df,{children:t("login.server.description")})]}),g.jsxs("form",{onSubmit:_,className:"space-y-4",children:[g.jsxs("div",{className:"text-xs text-[var(--app-hint)]",children:[t("login.server.current")," ",E]}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("label",{className:"text-xs font-medium",children:t("login.server.origin")}),g.jsx("input",{type:"url",value:f,onChange:P=>{m(P.target.value),b(null)},placeholder:t("login.server.placeholder"),className:"w-full px-3 py-2.5 rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent"}),g.jsx("div",{className:"text-[11px] text-[var(--app-hint)]",children:t("login.server.hint")})]}),y&&g.jsx("div",{className:"text-sm text-red-500",children:y}),g.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.serverUrl&&g.jsx(Xn,{type:"button",variant:"outline",onClick:w,children:t("login.server.useSameOrigin")}),g.jsx(Xn,{type:"submit",children:t("login.server.save")})]})]})]})]})]})]}),g.jsxs("div",{className:"absolute bottom-4 left-0 right-0 text-center text-xs text-[var(--app-hint)] space-y-1",children:[g.jsxs("div",{children:[t("login.footer")," ",g.jsx("span",{className:"text-red-500",children:""})," ",t("login.footer.for")]}),g.jsxs("div",{children:[t("login.footer.copyright")," ",new Date().getFullYear()," HAPI"]})]})]})}const Jj="pwa_install_dismissed";function JX(){if(typeof window>"u")return!1;const e=window.navigator.userAgent,t=/iPad|iPhone|iPod/.test(e),n=/WebKit/.test(e),i=/CriOS/.test(e),s=/FxiOS/.test(e);return t&&n&&!i&&!s}function ZX(){try{return localStorage.getItem(Jj)==="true"}catch{return!1}}function eQ(){try{localStorage.setItem(Jj,"true")}catch{}}function Zj(){const[e,t]=k.useState("idle"),[n,i]=k.useState(null),[s,r]=k.useState(()=>ZX()),o=typeof window<"u"&&JX(),a=typeof window<"u"&&(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0);k.useEffect(()=>{if(a){t("installed");return}const h=m=>{m.preventDefault(),i(m),t("available")},f=()=>{t("installed"),i(null)};return window.addEventListener("beforeinstallprompt",h),window.addEventListener("appinstalled",f),()=>{window.removeEventListener("beforeinstallprompt",h),window.removeEventListener("appinstalled",f)}},[a]);const c=k.useCallback(async()=>{if(!n)return!1;const h=n;i(null),t("installing");try{await h.prompt();const{outcome:f}=await h.userChoice;return f==="accepted"?(t("installed"),!0):(t("idle"),!1)}catch{return t("idle"),!1}},[n]),u=k.useCallback(()=>{r(!0),eQ()},[]);return{installState:e,canInstall:e==="available"&&!s,canInstallIOS:o&&!a&&!s,isStandalone:a,isIOS:o,promptInstall:c,dismissInstall:u}}const Y0={light:10,medium:20,heavy:30,rigid:15,soft:10,success:20,warning:[20,50,20],error:[30,50,30],selection:5};function X0(e){navigator.vibrate?.(e)}const tQ={impact:e=>{const t=Ir();t?.HapticFeedback?t.HapticFeedback.impactOccurred(e):X0(Y0[e])},notification:e=>{const t=Ir();t?.HapticFeedback?t.HapticFeedback.notificationOccurred(e):X0(Y0[e])},selection:()=>{const e=Ir();e?.HapticFeedback?e.HapticFeedback.selectionChanged():X0(Y0.selection)}};function Yr(){const e=k.useMemo(()=>Xv(),[]),t=k.useMemo(()=>typeof window<"u"&&window.matchMedia("(pointer: coarse)").matches,[]);return{isTelegram:e,isTouch:t,haptic:tQ}}function Of(e,t,n=1.5){return g.jsx("svg",{className:t.className??"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round",children:e})}function Q0(e){return Of(g.jsx("path",{d:"M6 18 18 6M6 6l12 12"}),e,2)}function nQ(e){return Of(g.jsx("path",{d:"M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3v12"}),e)}function iQ(e){return Of(g.jsx("path",{d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}),e)}function fv(e){return Of(g.jsxs(g.Fragment,{children:[g.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),g.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),e,2)}function pv(e){return Of(g.jsx("polyline",{points:"20 6 9 17 4 12"}),e,2)}function sQ(){const{t:e}=rt(),{canInstall:t,canInstallIOS:n,promptInstall:i,dismissInstall:s,isStandalone:r}=Zj(),{isTelegram:o,haptic:a}=Yr(),[c,u]=k.useState(!1);if(o||r)return null;if(n)return c?g.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end justify-center",children:g.jsxs("div",{className:"w-full max-w-lg bg-[var(--app-bg)] rounded-t-2xl p-5 pb-8 space-y-4 animate-slide-up",children:[g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsx("h3",{className:"text-base font-semibold text-[var(--app-fg)]",children:e("install.title")}),g.jsx("button",{onClick:()=>u(!1),className:"p-1 -mr-1 text-[var(--app-hint)] active:opacity-60","aria-label":"Close",children:g.jsx(Q0,{className:"w-5 h-5"})})]}),g.jsxs("div",{className:"space-y-3",children:[g.jsxs("div",{className:"flex items-start gap-3",children:[g.jsx("div",{className:"shrink-0 w-8 h-8 rounded-full bg-[var(--app-fg)] text-[var(--app-bg)] flex items-center justify-center text-sm font-medium",children:"1"}),g.jsx("div",{className:"flex-1 pt-1",children:g.jsxs("p",{className:"text-sm text-[var(--app-fg)]",children:["Tap the ",g.jsx(nQ,{className:"inline w-5 h-5 align-text-bottom"})," Share button in the toolbar"]})})]}),g.jsxs("div",{className:"flex items-start gap-3",children:[g.jsx("div",{className:"shrink-0 w-8 h-8 rounded-full bg-[var(--app-fg)] text-[var(--app-bg)] flex items-center justify-center text-sm font-medium",children:"2"}),g.jsx("div",{className:"flex-1 pt-1",children:g.jsxs("p",{className:"text-sm text-[var(--app-fg)]",children:["Scroll down and tap ",g.jsx(iQ,{className:"inline w-5 h-5 align-text-bottom"})," ",g.jsx("strong",{children:"Add to Home Screen"})]})})]}),g.jsxs("div",{className:"flex items-start gap-3",children:[g.jsx("div",{className:"shrink-0 w-8 h-8 rounded-full bg-[var(--app-fg)] text-[var(--app-bg)] flex items-center justify-center text-sm font-medium",children:"3"}),g.jsx("div",{className:"flex-1 pt-1",children:g.jsxs("p",{className:"text-sm text-[var(--app-fg)]",children:["Tap ",g.jsx("strong",{children:"Add"})," in the top right corner"]})})]})]}),g.jsx("button",{onClick:()=>{u(!1),s()},className:"w-full py-3 text-sm text-[var(--app-hint)] active:opacity-60",children:e("button.dismiss")})]})}):g.jsx("div",{className:"fixed bottom-4 left-4 right-4 bg-[var(--app-secondary-bg)] border border-[var(--app-border)] rounded-lg p-4 shadow-lg z-50",children:g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("p",{className:"text-sm font-medium text-[var(--app-fg)]",children:e("install.title")}),g.jsx("p",{className:"text-xs text-[var(--app-hint)] mt-0.5",children:e("install.description")})]}),g.jsx("button",{onClick:()=>{a.impact("light"),u(!0)},className:"shrink-0 px-4 py-2 bg-[var(--app-fg)] text-[var(--app-bg)] rounded-lg text-sm font-medium active:opacity-80",children:e("install.button")}),g.jsx("button",{onClick:()=>{a.impact("light"),s()},className:"shrink-0 p-2 text-[var(--app-hint)] active:opacity-60","aria-label":"Dismiss",children:g.jsx(Q0,{className:"w-4 h-4"})})]})});if(!t)return null;const h=async()=>{a.impact("light"),await i()&&a.notification("success")};return g.jsx("div",{className:"fixed bottom-4 left-4 right-4 bg-[var(--app-secondary-bg)] border border-[var(--app-border)] rounded-lg p-4 shadow-lg z-50",children:g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[g.jsx("p",{className:"text-sm font-medium text-[var(--app-fg)]",children:e("install.title")}),g.jsx("p",{className:"text-xs text-[var(--app-hint)] mt-0.5",children:e("install.description")})]}),g.jsx("button",{onClick:h,className:"shrink-0 px-4 py-2 bg-[var(--app-fg)] text-[var(--app-bg)] rounded-lg text-sm font-medium active:opacity-80",children:e("install.button")}),g.jsx("button",{onClick:()=>{a.impact("light"),s()},className:"shrink-0 p-2 text-[var(--app-hint)] active:opacity-60","aria-label":"Dismiss",children:g.jsx(Q0,{className:"w-4 h-4"})})]})})}function rQ(e){return window.addEventListener("online",e),window.addEventListener("offline",e),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e)}}function oQ(){return navigator.onLine}function aQ(){return!0}function Sk(){return k.useSyncExternalStore(rQ,oQ,aQ)}function lQ(){const{t:e}=rt();return Sk()?null:g.jsx("div",{className:"fixed top-0 left-0 right-0 bg-amber-500 text-white text-center py-2 text-sm font-medium z-50",children:e("offline.message")})}function cQ({isSyncing:e}){const{t}=rt(),n=Sk();return!e||!n?null:g.jsxs("div",{className:"fixed top-0 left-0 right-0 bg-[var(--app-banner-bg)] text-[var(--app-banner-text)] text-center py-2 text-sm font-medium z-50 flex items-center justify-center gap-2 border-b border-[var(--app-divider)]",children:[g.jsx(Bo,{size:"sm",label:null,className:"text-[var(--app-banner-text)]"}),t("syncing.title")]})}function uQ({isReconnecting:e}){const{t}=rt(),n=Sk();return!e||!n?null:g.jsxs("div",{className:"fixed top-0 left-0 right-0 bg-amber-500 text-white text-center py-2 text-sm font-medium z-50 flex items-center justify-center gap-2",children:[g.jsx("span",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),t("reconnecting.message")]})}function dQ(){const e=nj(),t=e&&e.status==="error"&&e.errorMessage;return k.useEffect(()=>{if(!t||!e)return;const n=setTimeout(()=>{e.setStatus("disconnected")},3e3);return()=>clearTimeout(n)},[t,e]),t?g.jsx("div",{className:"fixed top-0 left-0 right-0 bg-red-500 text-white text-center py-2 text-sm font-medium z-50 flex items-center justify-center border-b border-red-600",children:e.errorMessage}):null}function mv({label:e,className:t,spinnerSize:n="md"}){const{t:i}=rt(),s=e??i("loading");return g.jsxs("div",{className:Ie("inline-flex items-center gap-2 text-[var(--app-hint)]",t),role:"status","aria-live":"polite",children:[g.jsx(Bo,{size:n,label:null}),g.jsx("span",{children:s})]})}const hQ=vk("pointer-events-auto w-full max-w-sm rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] text-[var(--app-fg)] shadow-lg",{variants:{variant:{default:"border-[var(--app-border)] bg-[var(--app-bg)]"}},defaultVariants:{variant:"default"}});function fQ({title:e,body:t,onClose:n,className:i,variant:s,...r}){const o=a=>{a.stopPropagation(),n?.()};return g.jsx("div",{className:Ie(hQ({variant:s}),i),role:"status",...r,children:g.jsxs("div",{className:"flex items-start gap-3 p-3",children:[g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"text-sm font-semibold leading-5",children:e}),g.jsx("div",{className:"mt-1 text-xs text-[var(--app-hint)]",children:t})]}),n?g.jsx("button",{type:"button",className:"text-xs text-[var(--app-hint)] hover:text-[var(--app-fg)]",onClick:o,"aria-label":"Dismiss",children:"x"}):null]})})}const eB=k.createContext(null),pQ=6e3;function mQ(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`toast_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}function gQ({children:e}){const[t,n]=k.useState([]),i=k.useRef(new Map);k.useEffect(()=>()=>{for(const a of i.current.values())clearTimeout(a);i.current.clear()},[]);const s=k.useCallback(a=>{n(u=>u.filter(h=>h.id!==a));const c=i.current.get(a);c&&(clearTimeout(c),i.current.delete(a))},[]),r=k.useCallback(a=>{const c=mQ();n(h=>[...h,{id:c,...a}]);const u=setTimeout(()=>{s(c)},pQ);i.current.set(c,u)},[s]),o=k.useMemo(()=>({toasts:t,addToast:r,removeToast:s}),[t,r,s]);return g.jsx(eB.Provider,{value:o,children:e})}function xk(){const e=k.useContext(eB);if(!e)throw new Error("useToast must be used within ToastProvider");return e}function vQ(){const e=fr(),{toasts:t,removeToast:n}=xk();return t.length===0?null:g.jsx("div",{className:"pointer-events-none fixed inset-x-0 top-[calc(env(safe-area-inset-top)+1rem)] z-50 flex flex-col items-center gap-2 px-3","aria-live":"polite",children:t.map(i=>g.jsx(fQ,{title:i.title,body:i.body,className:"cursor-pointer",onClick:()=>{if(n(i.id),i.sessionId){e({to:"/sessions/$sessionId",params:{sessionId:i.sessionId}});return}i.url&&e({to:i.url})},onClose:()=>n(i.id)},i.id))})}const J0=fK();function yQ(){return g.jsx(gQ,{children:g.jsx(bQ,{})})}function bQ(){const{t:e}=rt(),{serverUrl:t,baseUrl:n,setServerUrl:i,clearServerUrl:s}=gH(),{authSource:r,isLoading:o,setAccessToken:a}=hH(n),{token:c,api:u,isLoading:h,error:f,needsBinding:m,bind:y}=oH(r,n),b=Jl(),S=ef({select:de=>de.pathname}),_=MD(),w=ai(),{addToast:M}=xk();k.useEffect(()=>{const de=Ir();de?.ready(),de?.expand(),rH()},[]),k.useEffect(()=>{const de=be=>{be.preventDefault()},ce=be=>{be.ctrlKey&&be.preventDefault()},ae=be=>{(be.ctrlKey||be.metaKey)&&(be.key==="+"||be.key==="-"||be.key==="="||be.key==="0")&&be.preventDefault()};return document.addEventListener("gesturestart",de,{passive:!1}),document.addEventListener("gesturechange",de,{passive:!1}),document.addEventListener("gestureend",de,{passive:!1}),window.addEventListener("wheel",ce,{passive:!1}),window.addEventListener("keydown",ae),()=>{document.removeEventListener("gesturestart",de),document.removeEventListener("gesturechange",de),document.removeEventListener("gestureend",de),window.removeEventListener("wheel",ce),window.removeEventListener("keydown",ae)}},[]),k.useEffect(()=>{const ce=Ir()?.BackButton;if(ce){if(S==="/"||S==="/sessions"){ce.offClick(b),ce.hide();return}return ce.show(),ce.onClick(b),()=>{ce.offClick(b),ce.hide()}}},[b,S]);const R=jo(),E=_({to:"/sessions/$sessionId"}),A=E&&E.sessionId!=="new"?E.sessionId:null,{isSyncing:T,startSync:L,endSync:P}=i7(),[I,N]=k.useState(!1),O=k.useRef(0),j=k.useRef(!0),$=k.useRef(n),V=k.useRef(!1),{isSupported:H,permission:B,requestPermission:W,subscribe:q}=r7(u);k.useEffect(()=>{$.current!==n&&($.current=n,j.current=!0,O.current=0,R.clear())},[n,R]),k.useEffect(()=>{if(!c||!u)return;const{pathname:de,search:ce,hash:ae,state:be}=w.history.location,Ce=new URLSearchParams(ce);if(!Ce.has("server")&&!Ce.has("hub")&&!Ce.has("token"))return;Ce.delete("server"),Ce.delete("hub"),Ce.delete("token");const qe=Ce.toString(),dt=`${de}${qe?`?${qe}`:""}${ae}`;w.history.replace(dt,be)},[c,u,w]),k.useEffect(()=>{if(!u||!c){V.current=!1;return}if(Xv()||!H||V.current)return;V.current=!0,(async()=>{if(B==="granted"){await q();return}B==="default"&&await W()&&await q()})()},[u,H,B,W,q,c]);const ne=k.useCallback(()=>{N(!1);const de=++O.current;j.current?(j.current=!1,L({force:!0})):L();const ce=[R.invalidateQueries({queryKey:Xt.sessions}),...A?[R.invalidateQueries({queryKey:Xt.session(A)})]:[]],ae=A&&u?Nh(u,A):Promise.resolve();Promise.all([...ce,ae]).catch(be=>{console.error("Failed to invalidate queries on SSE connect:",be)}).finally(()=>{O.current===de&&P()})},[u,R,A,L,P]),z=k.useCallback(()=>{j.current||N(!0)},[]),G=k.useCallback(()=>{},[]),J=k.useCallback(de=>{M({title:de.data.title,body:de.data.body,sessionId:de.data.sessionId,url:de.data.url})},[M]),U=k.useMemo(()=>A?{sessionId:A}:{all:!0},[A]),{subscriptionId:re}=ZH({enabled:!!(u&&c),token:c??"",baseUrl:n,subscription:U,onConnect:ne,onDisconnect:z,onEvent:G,onToast:J});return a7({api:u,subscriptionId:re,enabled:!!(u&&c)}),o?g.jsx("div",{className:"h-full flex items-center justify-center p-4",children:g.jsx(mv,{label:e("loading"),className:"text-sm"})}):r?m?g.jsx(K0,{mode:"bind",onBind:y,baseUrl:n,serverUrl:t,setServerUrl:i,clearServerUrl:s,requireServerUrl:J0,error:f??void 0}):h||r&&!c&&!f?g.jsx("div",{className:"h-full flex items-center justify-center p-4",children:g.jsx(mv,{label:e("authorizing"),className:"text-sm"})}):f||!c||!u?r.type==="accessToken"?g.jsx(K0,{onLogin:a,baseUrl:n,serverUrl:t,setServerUrl:i,clearServerUrl:s,requireServerUrl:J0,error:f??e("login.error.authFailed")}):g.jsxs("div",{className:"p-4 space-y-3",children:[g.jsx("div",{className:"text-base font-semibold",children:e("login.title")}),g.jsx("div",{className:"text-sm text-red-600",children:f??e("login.error.authFailed")}),g.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:`Open this page from Telegram using the bot's "Open App" button (not "Open in browser").`})]}):g.jsx(l7,{value:{api:u,token:c,baseUrl:n},children:g.jsxs(dK,{children:[g.jsx(cQ,{isSyncing:T}),g.jsx(uQ,{isReconnecting:I&&!T}),g.jsx(dQ,{}),g.jsx(lQ,{}),g.jsx("div",{className:"h-full flex flex-col",children:g.jsx(Yv,{})}),g.jsx(vQ,{}),g.jsx(sQ,{})]})}):g.jsx(K0,{onLogin:a,baseUrl:n,serverUrl:t,setServerUrl:i,clearServerUrl:s,requireServerUrl:J0})}const _Q=e=>Array.from(e).map(n=>n.getModelContext()).sort((n,i)=>(i.priority??0)-(n.priority??0)).reduce((n,i)=>{if(i.system&&(n.system?n.system+=`

${i.system}`:n.system=i.system),i.tools)for(const[s,r]of Object.entries(i.tools)){const o=n.tools?.[s];if(o&&o!==r)throw new Error(`You tried to define a tool with the name ${s}, but it already exists.`);n.tools||(n.tools={}),n.tools[s]=r}return i.config&&(n.config={...n.config,...i.config}),i.callSettings&&(n.callSettings={...n.callSettings,...i.callSettings}),n},{});class wk{_providers=new Set;getModelContext(){return _Q(this._providers)}registerModelContextProvider(t){this._providers.add(t);const n=t.subscribe?.(()=>{this.notifySubscribers()});return this.notifySubscribers(),()=>{this._providers.delete(t),n?.(),this.notifySubscribers()}}_subscribers=new Set;notifySubscribers(){for(const t of this._subscribers)t()}subscribe(t){return this._subscribers.add(t),()=>this._subscribers.delete(t)}}class tB{_contextProvider=new wk;registerModelContextProvider(t){return this._contextProvider.registerModelContextProvider(t)}getModelContextProvider(){return this._contextProvider}}class SQ{_subscribers=new Set;subscribe(t){return this._subscribers.add(t),()=>this._subscribers.delete(t)}waitForUpdate(){return new Promise(t=>{const n=this.subscribe(()=>{n(),t()})})}_notifySubscribers(){const t=[];for(const n of this._subscribers)try{n()}catch(i){t.push(i)}if(t.length>0)throw t.length===1?t[0]:new AggregateError(t)}}const xQ=e=>e.status.type==="complete";class nB extends SQ{isEditing=!0;get attachmentAccept(){return this.getAttachmentAdapter()?.accept??"*"}_attachments=[];get attachments(){return this._attachments}setAttachments(t){this._attachments=t,this._notifySubscribers()}get isEmpty(){return!this.text.trim()&&!this.attachments.length}_text="";get text(){return this._text}_role="user";get role(){return this._role}_runConfig={};get runConfig(){return this._runConfig}setText(t){this._text!==t&&(this._text=t,this._notifySubscribers())}setRole(t){this._role!==t&&(this._role=t,this._notifySubscribers())}setRunConfig(t){this._runConfig!==t&&(this._runConfig=t,this._notifySubscribers())}_emptyTextAndAttachments(){this._attachments=[],this._text="",this._notifySubscribers()}async _onClearAttachments(){const t=this.getAttachmentAdapter();t&&await Promise.all(this._attachments.map(n=>t.remove(n)))}async reset(){if(this._attachments.length===0&&this._text===""&&this._role==="user"&&Object.keys(this._runConfig).length===0)return;this._role="user",this._runConfig={};const t=this._onClearAttachments();this._emptyTextAndAttachments(),await t}async clearAttachments(){const t=this._onClearAttachments();this.setAttachments([]),await t}async send(){const t=this.getAttachmentAdapter(),n=t&&this.attachments.length>0?Promise.all(this.attachments.map(async r=>xQ(r)?r:await t.send(r))):[],i=this.text;this._emptyTextAndAttachments();const s={createdAt:new Date,role:this.role,content:i?[{type:"text",text:i}]:[],attachments:await n,runConfig:this.runConfig,metadata:{custom:{}}};this.handleSend(s),this._notifyEventSubscribers("send")}cancel(){this.handleCancel()}async addAttachment(t){const n=this.getAttachmentAdapter();if(!n)throw new Error("Attachments are not supported");const i=r=>{const o=this._attachments.findIndex(a=>a.id===r.id);o!==-1?this._attachments=[...this._attachments.slice(0,o),r,...this._attachments.slice(o+1)]:this._attachments=[...this._attachments,r],this._notifySubscribers()},s=n.add({file:t});if(Symbol.asyncIterator in s)for await(const r of s)i(r);else i(await s);this._notifyEventSubscribers("attachment-add"),this._notifySubscribers()}async removeAttachment(t){const n=this.getAttachmentAdapter();if(!n)throw new Error("Attachments are not supported");const i=this._attachments.findIndex(r=>r.id===t);if(i===-1)throw new Error("Attachment not found");const s=this._attachments[i];await n.remove(s),this._attachments=[...this._attachments.slice(0,i),...this._attachments.slice(i+1)],this._notifySubscribers()}_eventSubscribers=new Map;_notifyEventSubscribers(t){const n=this._eventSubscribers.get(t);if(n)for(const i of n)i()}unstable_on(t,n){const i=this._eventSubscribers.get(t);return i?i.add(n):this._eventSubscribers.set(t,new Set([n])),()=>{const s=this._eventSubscribers.get(t);s&&s.delete(n)}}}class iB extends nB{runtime;_canCancel=!1;get canCancel(){return this._canCancel}get attachments(){return super.attachments}getAttachmentAdapter(){return this.runtime.adapters?.attachments}constructor(t){super(),this.runtime=t,this.connect()}connect(){return this.runtime.subscribe(()=>{this.canCancel!==this.runtime.capabilities.cancel&&(this._canCancel=this.runtime.capabilities.cancel,this._notifySubscribers())})}async handleSend(t){this.runtime.append({...t,parentId:this.runtime.messages.at(-1)?.id??null,sourceId:null})}async handleCancel(){this.runtime.cancelRun()}}let sB=(e,t=21)=>(n=t)=>{let i="",s=n|0;for(;s--;)i+=e[Math.random()*e.length|0];return i};const uy=sB("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7),wQ="__optimistic__",CQ=()=>`${wQ}${uy()}`,Ku=Symbol("autoStatus"),kQ=Object.freeze(Object.assign({type:"running"},{[Ku]:!0})),TQ=Object.freeze(Object.assign({type:"complete",reason:"unknown"},{[Ku]:!0})),EQ=Object.freeze(Object.assign({type:"requires-action",reason:"tool-calls"},{[Ku]:!0})),RQ=Object.freeze(Object.assign({type:"requires-action",reason:"interrupt"},{[Ku]:!0})),rB=e=>e[Ku]===!0,dy=(e,t,n,i,s)=>e&&s?Object.assign({type:"incomplete",reason:"error",error:s},{[Ku]:!0}):e&&t?kQ:n?RQ:i?EQ:TQ;var pl={exports:{}},mL;function MQ(){if(mL)return pl.exports;mL=1;const e=typeof Buffer<"u",t=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,n=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function i(a,c,u){u==null&&c!==null&&typeof c=="object"&&(u=c,c=void 0),e&&Buffer.isBuffer(a)&&(a=a.toString()),a&&a.charCodeAt(0)===65279&&(a=a.slice(1));const h=JSON.parse(a,c);if(h===null||typeof h!="object")return h;const f=u&&u.protoAction||"error",m=u&&u.constructorAction||"error";if(f==="ignore"&&m==="ignore")return h;if(f!=="ignore"&&m!=="ignore"){if(t.test(a)===!1&&n.test(a)===!1)return h}else if(f!=="ignore"&&m==="ignore"){if(t.test(a)===!1)return h}else if(n.test(a)===!1)return h;return s(h,{protoAction:f,constructorAction:m,safe:u&&u.safe})}function s(a,{protoAction:c="error",constructorAction:u="error",safe:h}={}){let f=[a];for(;f.length;){const m=f;f=[];for(const y of m){if(c!=="ignore"&&Object.prototype.hasOwnProperty.call(y,"__proto__")){if(h===!0)return null;if(c==="error")throw new SyntaxError("Object contains forbidden prototype property");delete y.__proto__}if(u!=="ignore"&&Object.prototype.hasOwnProperty.call(y,"constructor")&&y.constructor!==null&&typeof y.constructor=="object"&&Object.prototype.hasOwnProperty.call(y.constructor,"prototype")){if(h===!0)return null;if(u==="error")throw new SyntaxError("Object contains forbidden prototype property");delete y.constructor}for(const b in y){const S=y[b];S&&typeof S=="object"&&f.push(S)}}}return a}function r(a,c,u){const{stackTraceLimit:h}=Error;Error.stackTraceLimit=0;try{return i(a,c,u)}finally{Error.stackTraceLimit=h}}function o(a,c){const{stackTraceLimit:u}=Error;Error.stackTraceLimit=0;try{return i(a,c,{safe:!0})}catch{return}finally{Error.stackTraceLimit=u}}return pl.exports=r,pl.exports.default=r,pl.exports.parse=r,pl.exports.safeParse=o,pl.exports.scan=s,pl.exports}var AQ=MQ();const Gx=Ql(AQ);function PQ(e){const t=["ROOT"];let n=-1,i=null;const s=[];let r;function o(){r!==void 0&&(s.push(JSON.parse(`"${r}"`)),r=void 0)}function a(f,m,y){switch(f){case'"':{n=m,t.pop(),t.push(y),t.push("INSIDE_STRING"),o();break}case"f":case"t":case"n":{n=m,i=m,t.pop(),t.push(y),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(y),t.push("INSIDE_NUMBER"),o();break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=m,t.pop(),t.push(y),t.push("INSIDE_NUMBER"),o();break}case"{":{n=m,t.pop(),t.push(y),t.push("INSIDE_OBJECT_START"),o();break}case"[":{n=m,t.pop(),t.push(y),t.push("INSIDE_ARRAY_START"),o();break}}}function c(f,m){switch(f){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{n=m,t.pop(),r=s.pop();break}}}function u(f,m){switch(f){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA"),r=(Number(r)+1).toString();break}case"]":{n=m,t.pop(),r=s.pop();break}}}for(let f=0;f<e.length;f++){const m=e[f];switch(t[t.length-1]){case"ROOT":a(m,f,"FINISH");break;case"INSIDE_OBJECT_START":{switch(m){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY"),r="";break}case"}":{n=f,t.pop(),r=s.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(m){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY"),r="";break}}break}case"INSIDE_OBJECT_KEY":{switch(m){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}case"\\":{t.push("INSIDE_STRING_ESCAPE"),r+=m;break}default:{r+=m;break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(m){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{a(m,f,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{c(m,f);break}case"INSIDE_STRING":{switch(m){case'"':{t.pop(),n=f,r=s.pop();break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:n=f}break}case"INSIDE_ARRAY_START":{switch(m){case"]":{n=f,t.pop(),r=s.pop();break}default:{n=f,r="0",a(m,f,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(m){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA"),r=(Number(r)+1).toString();break}case"]":{n=f,t.pop(),r=s.pop();break}default:{n=f;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{a(m,f,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),t[t.length-1]==="INSIDE_STRING"?n=f:t[t.length-1]==="INSIDE_OBJECT_KEY"&&(r+=m);break}case"INSIDE_NUMBER":{switch(m){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=f;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),r=s.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(m,f),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&c(m,f);break}case"}":{t.pop(),r=s.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&c(m,f);break}case"]":{t.pop(),r=s.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(m,f);break}default:{t.pop(),r=s.pop();break}}break}case"INSIDE_LITERAL":{const b=e.substring(i,f+1);!"false".startsWith(b)&&!"true".startsWith(b)&&!"null".startsWith(b)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?c(m,f):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(m,f)):n=f;break}}}let h=e.slice(0,n+1);for(let f=t.length-1;f>=0;f--)switch(t[f]){case"INSIDE_STRING":{h+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{h+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{h+="]";break}case"INSIDE_LITERAL":{const y=e.substring(i,e.length);"true".startsWith(y)?h+="true".slice(y.length):"false".startsWith(y)?h+="false".slice(y.length):"null".startsWith(y)&&(h+="null".slice(y.length))}}return[h,s]}const xg=Symbol("aui.parse-partial-json-object.meta"),LQ=e=>e?.[xg],Kx=e=>{if(e.length===0)return{[xg]:{state:"partial",partialPath:[]}};try{const t=Gx.parse(e);if(typeof t!="object"||t===null)throw new Error("argsText is expected to be an object");return t[xg]={state:"complete",partialPath:[]},t}catch{try{const[t,n]=PQ(e),i=Gx.parse(t);if(typeof i!="object"||i===null)throw new Error("argsText is expected to be an object");return i[xg]={state:"partial",partialPath:n},i}catch{return}}},oB=(e,t,n)=>{if(typeof e!="object"||e===null)return t.state;if(t.state==="complete")return"complete";if(n.length===0)return t.state;const[i,...s]=n;if(!Object.prototype.hasOwnProperty.call(e,i))return"partial";const[r,...o]=t.partialPath;if(i!==r)return"complete";const a=e[i];return oB(a,{state:"partial",partialPath:o},s)},Du=(e,t)=>{const n=LQ(e);if(!n)throw new Error("unable to determine object state");return oB(e,n,t.map(String))};async function*NQ(){const e=this.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)break;yield n}}finally{e.releaseLock()}}function Z0(e){return e[Symbol.asyncIterator]??=NQ,e}const Ck=function(){let e,t;const n=new Promise((i,s)=>{e=i,t=s});if(!e||!t)throw new Error("Failed to create promise");return{promise:n,resolve:e,reject:t}},IQ=()=>{const e=[];let t=!1,n,i;const s=o=>{o.promise||(o.promise=o.reader.read().then(({done:a,value:c})=>{o.promise=void 0,a?(e.splice(e.indexOf(o),1),t&&e.length===0&&n.close()):n.enqueue(c),i?.resolve(),i=void 0}).catch(a=>{console.error(a),e.forEach(c=>{c.reader.cancel()}),e.length=0,n.error(a),i?.reject(a),i=void 0}))};return{readable:new ReadableStream({start(o){n=o},pull(){return i=Ck(),e.forEach(o=>{s(o)}),i.promise},cancel(){e.forEach(o=>{o.reader.cancel()}),e.length=0}}),isSealed(){return t},seal(){t=!0,e.length===0&&n.close()},addStream(o){if(t)throw new Error("Cannot add streams after the run callback has settled.");const a={reader:o.getReader()};e.push(a),s(a)},enqueue(o){this.addStream(new ReadableStream({start(a){a.enqueue(o),a.close()}}))}}};class gL{_controller;_isClosed=!1;constructor(t){this._controller=t}append(t){return this._controller.enqueue({type:"text-delta",path:[],textDelta:t}),this}close(){this._isClosed||(this._isClosed=!0,this._controller.enqueue({type:"part-finish",path:[]}),this._controller.close())}}const aB=e=>new ReadableStream({start(t){return e.start?.(new gL(t))},pull(t){return e.pull?.(new gL(t))},cancel(t){return e.cancel?.(t)}}),vL=()=>{let e;return[aB({start(n){e=n}}),e]};class yL{_controller;_isClosed=!1;_mergeTask;constructor(t){this._controller=t;const n=aB({start:s=>{this._argsTextController=s}});let i=!1;this._mergeTask=n.pipeTo(new WritableStream({write:s=>{switch(s.type){case"text-delta":i=!0,this._controller.enqueue(s);break;case"part-finish":i||this._controller.enqueue({type:"text-delta",textDelta:"{}",path:[]}),this._controller.enqueue({type:"tool-call-args-text-finish",path:[]});break;default:throw new Error(`Unexpected chunk type: ${s.type}`)}}}))}get argsText(){return this._argsTextController}_argsTextController;async setResponse(t){this._argsTextController.close(),await Promise.resolve(),this._controller.enqueue({type:"result",path:[],...t.artifact!==void 0?{artifact:t.artifact}:{},result:t.result,isError:t.isError??!1})}async close(){this._isClosed||(this._isClosed=!0,this._argsTextController.close(),await this._mergeTask,this._controller.enqueue({type:"part-finish",path:[]}),this._controller.close())}}const DQ=e=>new ReadableStream({start(t){return e.start?.(new yL(t))},pull(t){return e.pull?.(new yL(t))},cancel(t){return e.cancel?.(t)}}),OQ=()=>{let e;return[DQ({start(n){e=n}}),e]};class lB{value=-1;up(){return++this.value}}class jQ extends TransformStream{constructor(t){super({transform(n,i){i.enqueue({...n,path:[t,...n.path]})}})}}class kSe extends TransformStream{constructor(t){super({transform(n,i){const{path:[s,...r]}=n;if(t!==s)throw new Error(`Path mismatch: expected ${t}, got ${s}`);i.enqueue({...n,path:r})}})}}class BQ extends TransformStream{constructor(t){const n=new lB,i=new Map;super({transform(s,r){s.type==="part-start"&&s.path.length===0&&i.set(n.up(),t.up());const[o,...a]=s.path;if(o===void 0){r.enqueue(s);return}const c=i.get(o);if(c===void 0)throw new Error("Path not found");r.enqueue({...s,path:[c,...a]})}})}}class FQ extends TransformStream{constructor(t){super();const n=t(super.readable);Object.defineProperty(this,"readable",{value:n,writable:!1})}}class cB extends TransformStream{constructor(){const t=[];super({transform(n,i){if(n.type==="part-start"){if(n.path.length!==0){i.error(new Error("Nested parts are not supported"));return}t.push(n.part),i.enqueue(n);return}if(n.type==="text-delta"||n.type==="result"||n.type==="part-finish"||n.type==="tool-call-args-text-finish"){if(n.path.length!==1){i.error(new Error(`${n.type} chunks must have a path of length 1`));return}const s=n.path[0];if(s<0||s>=t.length){i.error(new Error(`Invalid path index: ${s}`));return}const r=t[s];i.enqueue({...n,meta:r});return}i.enqueue(n)}})}}const UQ=sB("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);class kk{_state;_parentId;constructor(t){this._state=t||{merger:IQ(),contentCounter:new lB}}get __internal_isClosed(){return this._state.merger.isSealed()}__internal_getReadable(){return this._state.merger.readable}__internal_subscribeToClose(t){this._state.closeSubscriber=t}_addPart(t,n){this._state.append&&(this._state.append.controller.close(),this._state.append=void 0),this.enqueue({type:"part-start",part:t,path:[]}),this._state.merger.addStream(n.pipeThrough(new jQ(this._state.contentCounter.value)))}merge(t){this._state.merger.addStream(t.pipeThrough(new BQ(this._state.contentCounter)))}appendText(t){this._state.append?.kind!=="text"&&(this._state.append={kind:"text",controller:this.addTextPart()}),this._state.append.controller.append(t)}appendReasoning(t){this._state.append?.kind!=="reasoning"&&(this._state.append={kind:"reasoning",controller:this.addReasoningPart()}),this._state.append.controller.append(t)}addTextPart(){const[t,n]=vL();return this._addPart({type:"text"},t),n}addReasoningPart(){const[t,n]=vL();return this._addPart({type:"reasoning"},t),n}addToolCallPart(t){const n=typeof t=="string"?{toolName:t}:t,i=n.toolName,s=n.toolCallId??UQ(),[r,o]=OQ();return this._addPart({type:"tool-call",toolName:i,toolCallId:s,...this._parentId&&{parentId:this._parentId}},r),n.argsText!==void 0&&(o.argsText.append(n.argsText),o.argsText.close()),n.args!==void 0&&(o.argsText.append(JSON.stringify(n.args)),o.argsText.close()),n.response!==void 0&&o.setResponse(n.response),o}appendSource(t){this._addPart({...t,...this._parentId&&{parentId:this._parentId}},new ReadableStream({start(n){n.enqueue({type:"part-finish",path:[]}),n.close()}}))}appendFile(t){this._addPart(t,new ReadableStream({start(n){n.enqueue({type:"part-finish",path:[]}),n.close()}}))}enqueue(t){this._state.merger.enqueue(t),t.type==="part-start"&&t.path.length===0&&this._state.contentCounter.up()}withParentId(t){const n=new kk(this._state);return n._parentId=t,n}close(){this._state.append?.controller?.close(),this._state.merger.seal(),this._state.closeSubscriber?.()}}function zQ(e){const t=new kk;return(async()=>{try{await e(t)}catch(i){throw t.__internal_isClosed||t.enqueue({type:"error",path:[],error:String(i)}),i}finally{t.__internal_isClosed||t.close()}})(),t.__internal_getReadable()}function $Q(){const{resolve:e,promise:t}=Ck();let n;return[zQ(s=>(n=s,n.__internal_subscribeToClose(e),t)),n]}const jf=(e,t,n)=>{const{role:i,id:s,createdAt:r,attachments:o,status:a,metadata:c}=e,u={id:s??t,createdAt:r??new Date},h=typeof e.content=="string"?[{type:"text",text:e.content}]:e.content,f=({image:m,...y})=>m.match(/^data:image\/(png|jpeg|jpg|gif|webp);base64,(.*)$/)?{...y,image:m}:(console.warn("Invalid image data format detected"),null);if(i!=="user"&&o?.length)throw new Error("attachments are only supported for user messages");if(i!=="assistant"&&a)throw new Error("status is only supported for assistant messages");if(i!=="assistant"&&c?.steps)throw new Error("metadata.steps is only supported for assistant messages");switch(i){case"assistant":return{...u,role:i,content:h.map(m=>{const y=m.type;switch(y){case"text":case"reasoning":return m.text.trim().length===0?null:m;case"file":case"source":return m;case"image":return f(m);case"data":return m;case"tool-call":{const{parentId:b,messages:S,..._}=m,w={..._,toolCallId:m.toolCallId??`tool-${uy()}`,...b!==void 0&&{parentId:b},...S!==void 0&&{messages:S}};return m.args?{...w,args:m.args,argsText:m.argsText??JSON.stringify(m.args)}:{...w,args:Kx(m.argsText??"")??{},argsText:m.argsText??""}}default:{const b=y;throw new Error(`Unsupported assistant message part type: ${b}`)}}}).filter(m=>!!m),status:a??n,metadata:{unstable_state:c?.unstable_state??null,unstable_annotations:c?.unstable_annotations??[],unstable_data:c?.unstable_data??[],custom:c?.custom??{},steps:c?.steps??[],...c?.submittedFeedback&&{submittedFeedback:c.submittedFeedback}}};case"user":return{...u,role:i,content:h.map(m=>{const y=m.type;switch(y){case"text":case"image":case"audio":case"file":return m;default:{const b=y;throw new Error(`Unsupported user message part type: ${b}`)}}}),attachments:o??[],metadata:{custom:c?.custom??{}}};case"system":if(h.length!==1||h[0].type!=="text")throw new Error("System messages must have exactly one text message part.");return{...u,role:i,content:h,metadata:{custom:c?.custom??{}}};default:{const m=i;throw new Error(`Unknown message role: ${m}`)}}},Tk={fromArray:e=>{const t=e.map(n=>jf(n,uy(),dy(!1,!1,!1,!1,void 0)));return{messages:t.map((n,i)=>({parentId:i>0?t[i-1].id:null,message:n}))}}},wg=e=>e.next?wg(e.next):"current"in e?e:null;class qQ{func;_value=null;constructor(t){this.func=t}get value(){return this._value===null&&(this._value=this.func()),this._value}dirty(){this._value=null}}class Ek{messages=new Map;head=null;root={children:[],next:null};updateLevels(t,n){t.level=n;for(const i of t.children){const s=this.messages.get(i);s&&this.updateLevels(s,n+1)}}performOp(t,n,i){const s=n.prev??this.root,r=t??this.root;if(!(i==="relink"&&s===r)){if(i!=="link"&&(s.children=s.children.filter(o=>o!==n.current.id),s.next===n)){const o=s.children.at(-1),a=o?this.messages.get(o):null;if(a===void 0)throw new Error("MessageRepository(performOp/cut): Fallback sibling message not found. This is likely an internal bug in assistant-ui.");s.next=a}if(i!=="cut"){for(let a=t;a;a=a.prev)if(a.current.id===n.current.id)throw new Error("MessageRepository(performOp/link): A message with the same id already exists in the parent tree. This error occurs if the same message id is found multiple times. This is likely an internal bug in assistant-ui.");r.children=[...r.children,n.current.id],(wg(n)===this.head||r.next===null)&&(r.next=n),n.prev=t;const o=t?t.level+1:0;this.updateLevels(n,o)}}}_messages=new qQ(()=>{const t=new Array((this.head?.level??-1)+1);for(let n=this.head;n;n=n.prev)t[n.level]=n.current;return t});get headId(){return this.head?.current.id??null}getMessages(t){if(t===void 0||t===this.head?.current.id)return this._messages.value;const n=this.messages.get(t);if(!n)throw new Error("MessageRepository(getMessages): Head message not found. This is likely an internal bug in assistant-ui.");const i=new Array(n.level+1);for(let s=n;s;s=s.prev)i[s.level]=s.current;return i}addOrUpdateMessage(t,n){const i=this.messages.get(n.id),s=t?this.messages.get(t):null;if(s===void 0)throw new Error("MessageRepository(addOrUpdateMessage): Parent message not found. This is likely an internal bug in assistant-ui.");if(i){i.current=n,this.performOp(s,i,"relink"),this._messages.dirty();return}const r={prev:s,current:n,next:null,children:[],level:s?s.level+1:0};this.messages.set(n.id,r),this.performOp(s,r,"link"),this.head===s&&(this.head=r),this._messages.dirty()}getMessage(t){const n=this.messages.get(t);if(!n)throw new Error("MessageRepository(updateMessage): Message not found. This is likely an internal bug in assistant-ui.");return{parentId:n.prev?.current.id??null,message:n.current,index:n.level}}appendOptimisticMessage(t,n){let i;do i=CQ();while(this.messages.has(i));return this.addOrUpdateMessage(t,jf(n,i,{type:"running"})),i}deleteMessage(t,n){const i=this.messages.get(t);if(!i)throw new Error("MessageRepository(deleteMessage): Message not found. This is likely an internal bug in assistant-ui.");const s=n===void 0?i.prev:n===null?null:this.messages.get(n);if(s===void 0)throw new Error("MessageRepository(deleteMessage): Replacement not found. This is likely an internal bug in assistant-ui.");for(const r of i.children){const o=this.messages.get(r);if(!o)throw new Error("MessageRepository(deleteMessage): Child message not found. This is likely an internal bug in assistant-ui.");this.performOp(s,o,"relink")}this.performOp(null,i,"cut"),this.messages.delete(t),this.head===i&&(this.head=wg(s??this.root)),this._messages.dirty()}getBranches(t){const n=this.messages.get(t);if(!n)throw new Error("MessageRepository(getBranches): Message not found. This is likely an internal bug in assistant-ui.");const{children:i}=n.prev??this.root;return i}switchToBranch(t){const n=this.messages.get(t);if(!n)throw new Error("MessageRepository(switchToBranch): Branch not found. This is likely an internal bug in assistant-ui.");const i=n.prev??this.root;i.next=n,this.head=wg(n),this._messages.dirty()}resetHead(t){if(t===null){this.clear();return}const n=this.messages.get(t);if(!n)throw new Error("MessageRepository(resetHead): Branch not found. This is likely an internal bug in assistant-ui.");if(n.children.length>0){const i=s=>{for(const r of s.children){const o=this.messages.get(r);o&&(i(o),this.messages.delete(r))}};i(n),n.children=[],n.next=null}this.head=n;for(let i=n;i;i=i.prev)i.prev&&(i.prev.next=i);this._messages.dirty()}clear(){this.messages.clear(),this.head=null,this.root={children:[],next:null},this._messages.dirty()}export(){const t=[];for(const[,n]of this.messages)t.push({message:n.current,parentId:n.prev?.current.id??null});return{headId:this.head?.current.id??null,messages:t}}import({headId:t,messages:n}){for(const{message:i,parentId:s}of n)this.addOrUpdateMessage(s,i);this.resetHead(t??n.at(-1)?.message.id??null)}}class hy{_subscriptions=new Set;_connection;get isConnected(){return!!this._connection}notifySubscribers(){for(const t of this._subscriptions)t()}_updateConnection(){if(this._subscriptions.size>0){if(this._connection)return;this._connection=this._connect()}else this._connection?.(),this._connection=void 0}subscribe(t){return this._subscriptions.add(t),this._updateConnection(),()=>{this._subscriptions.delete(t),this._updateConnection()}}}const dr=Symbol("skip-update");class Rk extends hy{binding;get path(){return this.binding.path}constructor(t){super(),this.binding=t}_previousStateDirty=!0;_previousState;getState=()=>{if(!this.isConnected||this._previousStateDirty){const t=this.binding.getState();t!==dr&&(this._previousState=t),this._previousStateDirty=!1}if(this._previousState===void 0)throw new Error("Entry not available in the store");return this._previousState};_connect(){const t=()=>{this._previousStateDirty=!0,this.notifySubscribers()};return this.binding.subscribe(t)}}class Pm{_core;_threadListBinding;get path(){return this._core.path}constructor(t,n){this._core=t,this._threadListBinding=n,this.__internal_bindMethods()}__internal_bindMethods(){this.switchTo=this.switchTo.bind(this),this.rename=this.rename.bind(this),this.archive=this.archive.bind(this),this.unarchive=this.unarchive.bind(this),this.delete=this.delete.bind(this),this.initialize=this.initialize.bind(this),this.generateTitle=this.generateTitle.bind(this),this.subscribe=this.subscribe.bind(this),this.unstable_on=this.unstable_on.bind(this),this.getState=this.getState.bind(this),this.detach=this.detach.bind(this)}getState(){return this._core.getState()}switchTo(){const t=this._core.getState();return this._threadListBinding.switchToThread(t.id)}rename(t){const n=this._core.getState();return this._threadListBinding.rename(n.id,t)}archive(){const t=this._core.getState();return this._threadListBinding.archive(t.id)}unarchive(){const t=this._core.getState();return this._threadListBinding.unarchive(t.id)}delete(){const t=this._core.getState();return this._threadListBinding.delete(t.id)}initialize(){const t=this._core.getState();return this._threadListBinding.initialize(t.id)}generateTitle(){const t=this._core.getState();return this._threadListBinding.generateTitle(t.id)}unstable_on(t,n){let i=this._core.getState().isMain,s=this._core.getState().id;return this.subscribe(()=>{const r=this._core.getState(),o=r.isMain,a=r.id;i===o&&s===a||(i=o,s=a,!(t==="switched-to"&&!o)&&(t==="switched-away"&&o||n()))})}subscribe(t){return this._core.subscribe(t)}detach(){const t=this._core.getState();this._threadListBinding.detach(t.id)}__internal_getRuntime(){return this}}function HQ(e,t){if(e===void 0&&t===void 0)return!0;if(e===void 0||t===void 0)return!1;for(const n of Object.keys(e)){const i=e[n],s=t[n];if(!Object.is(i,s))return!1}return!0}class rr extends hy{binding;get path(){return this.binding.path}constructor(t){super(),this.binding=t;const n=t.getState();if(n===dr)throw new Error("Entry not available in the store");this._previousState=n}_previousState;getState=()=>(this.isConnected||this._syncState(),this._previousState);_syncState(){const t=this.binding.getState();return t===dr||HQ(t,this._previousState)?!1:(this._previousState=t,!0)}_connect(){const t=()=>{this._syncState()&&this.notifySubscribers()};return this.binding.subscribe(t)}}const Us=Symbol("innerMessage"),eS=Symbol("innerMessages"),VQ=e=>e[Us],WQ=[],GQ=e=>{const t="messages"in e?e.messages:e,n=t[eS]||t[Us];return n?Array.isArray(n)?n:(t[eS]=[n],t[eS]):WQ},pf=e=>e.content.filter(n=>n.type==="text").map(n=>n.text).join(`

`);class uB{_core;get path(){return this._core.path}constructor(t){this._core=t,this.__internal_bindMethods()}__internal_bindMethods(){this.getState=this.getState.bind(this),this.remove=this.remove.bind(this),this.subscribe=this.subscribe.bind(this)}getState(){return this._core.getState()}subscribe(t){return this._core.subscribe(t)}}class dB extends uB{_composerApi;constructor(t,n){super(t),this._composerApi=n}remove(){const t=this._composerApi.getState();if(!t)throw new Error("Composer is not available");return t.removeAttachment(this.getState().id)}}class KQ extends dB{get source(){return"thread-composer"}}class YQ extends dB{get source(){return"edit-composer"}}class XQ extends uB{get source(){return"message"}constructor(t){super(t)}remove(){throw new Error("Message attachments cannot be removed")}}class hB extends hy{config;constructor(t){super(),this.config=t}getState(){return this.config.binding.getState()}outerSubscribe(t){return this.config.binding.subscribe(t)}_connect(){const t=()=>{this.notifySubscribers()};let n=this.config.binding.getState(),i=n?.unstable_on(this.config.event,t);const s=()=>{const o=this.config.binding.getState();o!==n&&(n=o,i?.(),i=this.config.binding.getState()?.unstable_on(this.config.event,t))},r=this.outerSubscribe(s);return()=>{r?.(),i?.()}}}const fB=Object.freeze([]),pB=Object.freeze({}),QQ=e=>Object.freeze({type:"thread",isEditing:e?.isEditing??!1,canCancel:e?.canCancel??!1,isEmpty:e?.isEmpty??!0,attachments:e?.attachments??fB,text:e?.text??"",role:e?.role??"user",runConfig:e?.runConfig??pB,attachmentAccept:e?.attachmentAccept??"",value:e?.text??""}),JQ=e=>Object.freeze({type:"edit",isEditing:e?.isEditing??!1,canCancel:e?.canCancel??!1,isEmpty:e?.isEmpty??!0,text:e?.text??"",role:e?.role??"user",attachments:e?.attachments??fB,runConfig:e?.runConfig??pB,attachmentAccept:e?.attachmentAccept??"",value:e?.text??""});class mB{_core;get path(){return this._core.path}constructor(t){this._core=t}__internal_bindMethods(){this.setText=this.setText.bind(this),this.setRunConfig=this.setRunConfig.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.addAttachment=this.addAttachment.bind(this),this.reset=this.reset.bind(this),this.clearAttachments=this.clearAttachments.bind(this),this.send=this.send.bind(this),this.cancel=this.cancel.bind(this),this.setRole=this.setRole.bind(this),this.getAttachmentByIndex=this.getAttachmentByIndex.bind(this),this.unstable_on=this.unstable_on.bind(this)}setText(t){const n=this._core.getState();if(!n)throw new Error("Composer is not available");n.setText(t)}setRunConfig(t){const n=this._core.getState();if(!n)throw new Error("Composer is not available");n.setRunConfig(t)}addAttachment(t){const n=this._core.getState();if(!n)throw new Error("Composer is not available");return n.addAttachment(t)}reset(){const t=this._core.getState();if(!t)throw new Error("Composer is not available");return t.reset()}clearAttachments(){const t=this._core.getState();if(!t)throw new Error("Composer is not available");return t.clearAttachments()}send(){const t=this._core.getState();if(!t)throw new Error("Composer is not available");t.send()}cancel(){const t=this._core.getState();if(!t)throw new Error("Composer is not available");t.cancel()}setRole(t){const n=this._core.getState();if(!n)throw new Error("Composer is not available");n.setRole(t)}subscribe(t){return this._core.subscribe(t)}_eventSubscriptionSubjects=new Map;unstable_on(t,n){let i=this._eventSubscriptionSubjects.get(t);return i||(i=new hB({event:t,binding:this._core}),this._eventSubscriptionSubjects.set(t,i)),i.subscribe(n)}}class ZQ extends mB{get path(){return this._core.path}get type(){return"thread"}_getState;constructor(t){const n=new Rk({path:t.path,getState:()=>QQ(t.getState()),subscribe:i=>t.subscribe(i)});super({path:t.path,getState:()=>t.getState(),subscribe:i=>n.subscribe(i)}),this._getState=n.getState.bind(n),this.__internal_bindMethods()}getState(){return this._getState()}getAttachmentByIndex(t){return new KQ(new rr({path:{...this.path,attachmentSource:"thread-composer",attachmentSelector:{type:"index",index:t},ref:`${this.path.ref}${this.path.ref}.attachments[${t}]`},getState:()=>{const i=this.getState().attachments[t];return i?{...i,source:"thread-composer"}:dr},subscribe:n=>this._core.subscribe(n)}),this._core)}}class eJ extends mB{_beginEdit;get path(){return this._core.path}get type(){return"edit"}_getState;constructor(t,n){const i=new Rk({path:t.path,getState:()=>JQ(t.getState()),subscribe:s=>t.subscribe(s)});super({path:t.path,getState:()=>t.getState(),subscribe:s=>i.subscribe(s)}),this._beginEdit=n,this._getState=i.getState.bind(i),this.__internal_bindMethods()}__internal_bindMethods(){super.__internal_bindMethods(),this.beginEdit=this.beginEdit.bind(this)}getState(){return this._getState()}beginEdit(){this._beginEdit()}getAttachmentByIndex(t){return new YQ(new rr({path:{...this.path,attachmentSource:"edit-composer",attachmentSelector:{type:"index",index:t},ref:`${this.path.ref}${this.path.ref}.attachments[${t}]`},getState:()=>{const i=this.getState().attachments[t];return i?{...i,source:"edit-composer"}:dr},subscribe:n=>this._core.subscribe(n)}),this._core)}}const bL=Symbol.for("aui.tool-response");class ar{get[bL](){return!0}artifact;result;isError;constructor(t){t.artifact!==void 0&&(this.artifact=t.artifact),this.result=t.result,this.isError=t.isError??!1}static[Symbol.hasInstance](t){return typeof t=="object"&&t!==null&&bL in t}static toResponse(t){return t instanceof ar?t:new ar({result:t===void 0?"<no result>":t})}}function tJ(e,t,n){try{const i=e();if(typeof i=="object"&&i!==null&&"then"in i)return i.then(t,n);t(i)}catch(i){n(i)}}function Bf(e,t){let n=e;for(const i of t){if(n==null)return;n=n[i]}return n}class nJ{resolve;reject;disposed=!1;fieldPath;constructor(t,n,i){this.resolve=t,this.reject=n,this.fieldPath=i}update(t){if(!this.disposed)try{if(Du(t,this.fieldPath)==="complete"){const n=Bf(t,this.fieldPath);n!==void 0&&(this.resolve(n),this.dispose())}}catch(n){this.reject(n),this.dispose()}}dispose(){this.disposed=!0}}class _L{controller;disposed=!1;fieldPath;constructor(t,n){this.controller=t,this.fieldPath=n}update(t){if(!this.disposed)try{const n=Bf(t,this.fieldPath);n!==void 0&&this.controller.enqueue(n),Du(t,this.fieldPath)==="complete"&&(this.controller.close(),this.dispose())}catch(n){this.controller.error(n),this.dispose()}}dispose(){this.disposed=!0}}class SL{controller;disposed=!1;fieldPath;lastValue=void 0;constructor(t,n){this.controller=t,this.fieldPath=n}update(t){if(!this.disposed)try{const n=Bf(t,this.fieldPath);if(n!==void 0&&typeof n=="string"){const i=n.substring(this.lastValue?.length||0);this.lastValue=n,this.controller.enqueue(i)}Du(t,this.fieldPath)==="complete"&&(this.controller.close(),this.dispose())}catch(n){this.controller.error(n),this.dispose()}}dispose(){this.disposed=!0}}class xL{controller;disposed=!1;fieldPath;processedIndexes=new Set;constructor(t,n){this.controller=t,this.fieldPath=n}update(t){if(!this.disposed)try{const n=Bf(t,this.fieldPath);if(!Array.isArray(n))return;for(let i=0;i<n.length;i++)if(!this.processedIndexes.has(i)){const s=[...this.fieldPath,i];Du(t,s)==="complete"&&(this.controller.enqueue(n[i]),this.processedIndexes.add(i))}Du(t,this.fieldPath)==="complete"&&(this.controller.close(),this.dispose())}catch(n){this.controller.error(n),this.dispose()}}dispose(){this.disposed=!0}}class iJ{argTextDeltas;handles=new Set;args=Kx("");constructor(t){this.argTextDeltas=t,this.processStream()}async processStream(){try{let t="";const n=this.argTextDeltas.getReader();for(;;){const{value:i,done:s}=await n.read();if(s)break;t+=i;const r=Kx(t);if(r!==void 0){this.args=r;for(const o of this.handles)o.update(r)}}}catch(t){console.error("Error processing argument stream:",t);for(const n of this.handles)n.dispose()}}get(...t){return new Promise((n,i)=>{const s=new nJ(n,i,t);if(this.args&&Du(this.args,t)==="complete"){const r=Bf(this.args,t);if(r!==void 0){n(r);return}}this.handles.add(s),s.update(this.args)})}streamValues(...t){const n=t,i=new ReadableStream({start:s=>{const r=new _L(s,n);this.handles.add(r),r.update(this.args)},cancel:()=>{for(const s of this.handles)if(s instanceof _L){s.dispose(),this.handles.delete(s);break}}});return Z0(i)}streamText(...t){const n=t,i=new ReadableStream({start:s=>{const r=new SL(s,n);this.handles.add(r),r.update(this.args)},cancel:()=>{for(const s of this.handles)if(s instanceof SL){s.dispose(),this.handles.delete(s);break}}});return Z0(i)}forEach(...t){const n=t,i=new ReadableStream({start:s=>{const r=new xL(s,n);this.handles.add(r),r.update(this.args)},cancel:()=>{for(const s of this.handles)if(s instanceof xL){s.dispose(),this.handles.delete(s);break}}});return Z0(i)}}class sJ{promise;constructor(t){this.promise=t}get(){return this.promise}}class rJ{args;response;writable;resolve;argsText="";constructor(){const t=new TransformStream;this.writable=t.writable,this.args=new iJ(t.readable);const{promise:n,resolve:i}=Ck();this.resolve=i,this.response=new sJ(n)}async appendArgsTextDelta(t){const n=this.writable.getWriter();try{await n.write(t)}catch(i){console.warn(i)}finally{n.releaseLock()}this.argsText+=t}setResponse(t){this.resolve(t)}result={get:async()=>(await this.response.get()).result}}class oJ extends FQ{constructor(t){const n=new Map,i=new Map;super(s=>{const r=new TransformStream({transform(o,a){switch((o.type!=="part-finish"||o.meta.type!=="tool-call")&&a.enqueue(o),o.type){case"part-start":if(o.part.type==="tool-call"){const u=new rJ;i.set(o.part.toolCallId,u),t.streamCall({reader:u,toolCallId:o.part.toolCallId,toolName:o.part.toolName})}break;case"text-delta":{if(o.meta.type==="tool-call"){const u=o.meta.toolCallId,h=i.get(u);if(!h)throw new Error("No controller found for tool call");h.appendArgsTextDelta(o.textDelta)}break}case"result":{if(o.meta.type!=="tool-call")break;const{toolCallId:u}=o.meta,h=i.get(u);if(!h)throw new Error("No controller found for tool call");h.setResponse(new ar({result:o.result,artifact:o.artifact,isError:o.isError}));break}case"tool-call-args-text-finish":{if(o.meta.type!=="tool-call")break;const{toolCallId:u,toolName:h}=o.meta,f=i.get(u);if(!f)throw new Error("No controller found for tool call");let m=!1;const y=tJ(()=>{let b;try{b=Gx.parse(f.argsText)}catch(_){throw new Error(`Function parameter parsing failed. ${JSON.stringify(_.message)}`)}const S=t.execute({toolCallId:u,toolName:h,args:b});return S!==void 0&&(m=!0,t.onExecutionStart?.(u,h)),S},b=>{if(m&&t.onExecutionEnd?.(u,h),b===void 0)return;const S=new ar({artifact:b.artifact,result:b.result,isError:b.isError});f.setResponse(S),a.enqueue({type:"result",path:o.path,...S})},b=>{m&&t.onExecutionEnd?.(u,h);const S=new ar({result:String(b),isError:!0});f.setResponse(S),a.enqueue({type:"result",path:o.path,...S})});y&&n.set(u,y);break}case"part-finish":{if(o.meta.type!=="tool-call")break;const{toolCallId:u}=o.meta,h=n.get(u);h?h.then(()=>{n.delete(u),i.delete(u),a.enqueue(o)}):a.enqueue(o)}}},async flush(){await Promise.all(n.values())}});return s.pipeThrough(new cB).pipeThrough(r)})}}const aJ=e=>typeof e=="object"&&e!==null&&"~standard"in e&&e["~standard"].version===1;function lJ(e,t,n,i){const s=e?.[n.toolName];return!s||!s.execute?void 0:(async o=>{if(t.aborted)return new ar({result:"Tool execution was cancelled.",isError:!0});let a=o;if(aJ(s.parameters)){let h=s.parameters["~standard"].validate(n.args);h instanceof Promise&&(h=await h),h.issues&&(a=s.experimental_onSchemaValidationError??(()=>{throw new Error(`Function parameter validation failed. ${JSON.stringify(h.issues)}`)}))}const c=new Promise(h=>{const f=()=>{queueMicrotask(()=>{queueMicrotask(()=>{h(new ar({result:"Tool execution was cancelled.",isError:!0}))})})};t.aborted?f():t.addEventListener("abort",f,{once:!0})}),u=(async()=>{const h=await a(n.args,{toolCallId:n.toolCallId,abortSignal:t,human:f=>i(n.toolCallId,f)});return ar.toResponse(h)})();return Promise.race([u,c])})(s.execute)}function cJ(e,t,n,i,s){e?.[i.toolName]?.streamCall?.(n,{toolCallId:i.toolCallId,abortSignal:t,human:r=>s(i.toolCallId,r)})}function uJ(e,t,n,i){const s=typeof e=="function"?e:()=>e,r=typeof t=="function"?t:()=>t;return new oJ({execute:o=>lJ(s(),r(),o,n),streamCall:({reader:o,...a})=>cJ(s(),r(),o,a,n),onExecutionStart:i?.onExecutionStart,onExecutionEnd:i?.onExecutionEnd})}class wL{contentBinding;messageApi;threadApi;get path(){return this.contentBinding.path}constructor(t,n,i){this.contentBinding=t,this.messageApi=n,this.threadApi=i,this.__internal_bindMethods()}__internal_bindMethods(){this.addToolResult=this.addToolResult.bind(this),this.resumeToolCall=this.resumeToolCall.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this)}getState(){return this.contentBinding.getState()}addToolResult(t){const n=this.contentBinding.getState();if(!n)throw new Error("Message part is not available");if(n.type!=="tool-call")throw new Error("Tried to add tool result to non-tool message part");if(!this.messageApi)throw new Error("Message API is not available. This is likely a bug in assistant-ui.");if(!this.threadApi)throw new Error("Thread API is not available");const i=this.messageApi.getState();if(!i)throw new Error("Message is not available");const s=n.toolName,r=n.toolCallId,o=ar.toResponse(t);this.threadApi.getState().addToolResult({messageId:i.id,toolName:s,toolCallId:r,result:o.result,artifact:o.artifact,isError:o.isError})}resumeToolCall(t){const n=this.contentBinding.getState();if(!n)throw new Error("Message part is not available");if(n.type!=="tool-call")throw new Error("Tried to resume tool call on non-tool message part");if(!this.threadApi)throw new Error("Thread API is not available");const i=n.toolCallId;this.threadApi.getState().resumeToolCall({toolCallId:i,payload:t})}subscribe(t){return this.contentBinding.subscribe(t)}}class gv extends hy{binding;get path(){return this.binding.path}constructor(t){super(),this.binding=t}getState(){return this.binding.getState()}outerSubscribe(t){return this.binding.subscribe(t)}_connect(){const t=()=>{this.notifySubscribers()};let n=this.binding.getState(),i=n?.subscribe(t);const s=()=>{const o=this.binding.getState();o!==n&&(n=o,i?.(),i=this.binding.getState()?.subscribe(t),t())},r=this.outerSubscribe(s);return()=>{r?.(),i?.()}}}const Lm=Object.freeze({type:"complete"}),dJ=(e,t,n)=>{if(e.role!=="assistant")return Lm;if(n.type==="tool-call")return n.result?Lm:e.status;const i=t===Math.max(0,e.content.length-1);return e.status.type==="requires-action"?Lm:i?e.status:Lm},CL=(e,t)=>{const n=e.content[t];if(!n)return dr;const i=dJ(e,t,n);return Object.freeze({...n,[Us]:n[Us],status:i})};class hJ{_core;_threadBinding;get path(){return this._core.path}constructor(t,n){this._core=t,this._threadBinding=n,this.composer=new eJ(new gv({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.composer`,composerSource:"edit"},getState:this._getEditComposerRuntimeCore,subscribe:i=>this._threadBinding.subscribe(i)}),()=>this._threadBinding.getState().beginEdit(this._core.getState().id)),this.__internal_bindMethods()}__internal_bindMethods(){this.reload=this.reload.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.getMessagePartByIndex=this.getMessagePartByIndex.bind(this),this.getMessagePartByToolCallId=this.getMessagePartByToolCallId.bind(this),this.getAttachmentByIndex=this.getAttachmentByIndex.bind(this),this.unstable_getCopyText=this.unstable_getCopyText.bind(this),this.speak=this.speak.bind(this),this.stopSpeaking=this.stopSpeaking.bind(this),this.submitFeedback=this.submitFeedback.bind(this),this.switchToBranch=this.switchToBranch.bind(this)}composer;_getEditComposerRuntimeCore=()=>this._threadBinding.getState().getEditComposer(this._core.getState().id);getState(){return this._core.getState()}reload(t={}){const n=this._getEditComposerRuntimeCore(),i=n??this._threadBinding.getState().composer,s=n??i,{runConfig:r=s.runConfig}=t,o=this._core.getState();if(o.role!=="assistant")throw new Error("Can only reload assistant messages");this._threadBinding.getState().startRun({parentId:o.parentId,sourceId:o.id,runConfig:r})}speak(){const t=this._core.getState();return this._threadBinding.getState().speak(t.id)}stopSpeaking(){const t=this._core.getState();if(this._threadBinding.getState().speech?.messageId===t.id)this._threadBinding.getState().stopSpeaking();else throw new Error("Message is not being spoken")}submitFeedback({type:t}){const n=this._core.getState();this._threadBinding.getState().submitFeedback({messageId:n.id,type:t})}switchToBranch({position:t,branchId:n}){const i=this._core.getState();if(n&&t)throw new Error("May not specify both branchId and position");if(!n&&!t)throw new Error("Must specify either branchId or position");const r=this._threadBinding.getState().getBranches(i.id);let o=n;if(t==="previous"?o=r[i.branchNumber-2]:t==="next"&&(o=r[i.branchNumber]),!o)throw new Error("Branch not found");this._threadBinding.getState().switchToBranch(o)}unstable_getCopyText(){return pf(this.getState())}subscribe(t){return this._core.subscribe(t)}getMessagePartByIndex(t){if(t<0)throw new Error("Message part index must be >= 0");return new wL(new rr({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.content[${t}]`,messagePartSelector:{type:"index",index:t}},getState:()=>CL(this.getState(),t),subscribe:n=>this._core.subscribe(n)}),this._core,this._threadBinding)}getMessagePartByToolCallId(t){return new wL(new rr({path:{...this.path,ref:this.path.ref+`${this.path.ref}.content[toolCallId=${JSON.stringify(t)}]`,messagePartSelector:{type:"toolCallId",toolCallId:t}},getState:()=>{const n=this._core.getState(),i=n.content.findIndex(s=>s.type==="tool-call"&&s.toolCallId===t);return i===-1?dr:CL(n,i)},subscribe:n=>this._core.subscribe(n)}),this._core,this._threadBinding)}getAttachmentByIndex(t){return new XQ(new rr({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.attachments[${t}]`,attachmentSource:"message",attachmentSelector:{type:"index",index:t}},getState:()=>{const i=this.getState().attachments?.[t];return i?{...i,source:"message"}:dr},subscribe:n=>this._core.subscribe(n)}))}}const fJ=e=>({parentId:e.parentId??null,sourceId:e.sourceId??null,runConfig:e.runConfig??{},...e.stream?{stream:e.stream}:{}}),pJ=e=>({parentId:e.parentId??null,sourceId:e.sourceId??null,runConfig:e.runConfig??{}}),mJ=(e,t)=>typeof t=="string"?{createdAt:new Date,parentId:e.at(-1)?.id??null,sourceId:null,runConfig:{},role:"user",content:[{type:"text",text:t}],attachments:[],metadata:{custom:{}}}:{createdAt:t.createdAt??new Date,parentId:t.parentId??e.at(-1)?.id??null,sourceId:t.sourceId??null,role:t.role??"user",content:t.content,attachments:t.attachments??[],metadata:t.metadata??{custom:{}},runConfig:t.runConfig??{},startRun:t.startRun},gJ=(e,t)=>{const n=e.messages.at(-1);return Object.freeze({threadId:t.id,metadata:t,capabilities:e.capabilities,isDisabled:e.isDisabled,isLoading:e.isLoading,isRunning:n?.role!=="assistant"?!1:n.status.type==="running",messages:e.messages,state:e.state,suggestions:e.suggestions,extras:e.extras,speech:e.speech})};class gB{get path(){return this._threadBinding.path}get __internal_threadBinding(){return this._threadBinding}_threadBinding;constructor(t,n){const i=new rr({path:t.path,getState:()=>gJ(t.getState(),n.getState()),subscribe:s=>{const r=t.subscribe(s),o=n.subscribe(s);return()=>{r(),o()}}});this._threadBinding={path:t.path,getState:()=>t.getState(),getStateState:()=>i.getState(),outerSubscribe:s=>t.outerSubscribe(s),subscribe:s=>t.subscribe(s)},this.composer=new ZQ(new gv({path:{...this.path,ref:`${this.path.ref}${this.path.ref}.composer`,composerSource:"thread"},getState:()=>this._threadBinding.getState().composer,subscribe:s=>this._threadBinding.subscribe(s)})),this.__internal_bindMethods()}__internal_bindMethods(){this.append=this.append.bind(this),this.unstable_resumeRun=this.unstable_resumeRun.bind(this),this.unstable_loadExternalState=this.unstable_loadExternalState.bind(this),this.startRun=this.startRun.bind(this),this.cancelRun=this.cancelRun.bind(this),this.stopSpeaking=this.stopSpeaking.bind(this),this.export=this.export.bind(this),this.import=this.import.bind(this),this.reset=this.reset.bind(this),this.getMessageByIndex=this.getMessageByIndex.bind(this),this.getMessageById=this.getMessageById.bind(this),this.subscribe=this.subscribe.bind(this),this.unstable_on=this.unstable_on.bind(this),this.getModelContext=this.getModelContext.bind(this),this.getModelConfig=this.getModelConfig.bind(this),this.getState=this.getState.bind(this)}composer;getState(){return this._threadBinding.getStateState()}append(t){this._threadBinding.getState().append(mJ(this._threadBinding.getState().messages,t))}subscribe(t){return this._threadBinding.subscribe(t)}getModelContext(){return this._threadBinding.getState().getModelContext()}getModelConfig(){return this.getModelContext()}startRun(t){const n=t===null||typeof t=="string"?{parentId:t}:t;return this._threadBinding.getState().startRun(pJ(n))}unstable_resumeRun(t){return this._threadBinding.getState().resumeRun(fJ(t))}unstable_loadExternalState(t){this._threadBinding.getState().unstable_loadExternalState(t)}cancelRun(){this._threadBinding.getState().cancelRun()}stopSpeaking(){return this._threadBinding.getState().stopSpeaking()}export(){return this._threadBinding.getState().export()}import(t){this._threadBinding.getState().import(t)}reset(t){this._threadBinding.getState().reset(t)}getMessageByIndex(t){if(t<0)throw new Error("Message index must be >= 0");return this._getMessageRuntime({...this.path,ref:`${this.path.ref}${this.path.ref}.messages[${t}]`,messageSelector:{type:"index",index:t}},()=>{const n=this._threadBinding.getState().messages,i=n[t];if(i)return{message:i,parentId:n[t-1]?.id??null,index:t}})}getMessageById(t){return this._getMessageRuntime({...this.path,ref:this.path.ref+`${this.path.ref}.messages[messageId=${JSON.stringify(t)}]`,messageSelector:{type:"messageId",messageId:t}},()=>this._threadBinding.getState().getMessageById(t))}_getMessageRuntime(t,n){return new hJ(new rr({path:t,getState:()=>{const{message:i,parentId:s,index:r}=n()??{},{messages:o,speech:a}=this._threadBinding.getState();if(!i||s===void 0||r===void 0)return dr;const u=this._threadBinding.getState().getBranches(i.id),h=i.metadata.submittedFeedback;return{...i,[Us]:i[Us],index:r,isLast:o.at(-1)?.id===i.id,parentId:s,branchNumber:u.indexOf(i.id)+1,branchCount:u.length,speech:a?.messageId===i.id?a:void 0,submittedFeedback:h}},subscribe:i=>this._threadBinding.subscribe(i)}),this._threadBinding)}_eventSubscriptionSubjects=new Map;unstable_on(t,n){let i=this._eventSubscriptionSubjects.get(t);return i||(i=new hB({event:t,binding:this._threadBinding}),this._eventSubscriptionSubjects.set(t,i)),i.subscribe(n)}}const vJ=e=>({mainThreadId:e.mainThreadId,newThread:e.newThreadId,threads:e.threadIds,archivedThreads:e.archivedThreadIds,isLoading:e.isLoading,threadItems:e.threadData}),Nm=(e,t)=>{if(t===void 0)return dr;const n=e.getItemById(t);return n?{id:n.id,threadId:n.id,remoteId:n.remoteId,externalId:n.externalId,title:n.title,status:n.status,isMain:n.id===e.mainThreadId}:dr};class yJ{_core;_runtimeFactory;_getState;constructor(t,n=gB){this._core=t,this._runtimeFactory=n;const i=new Rk({path:{},getState:()=>vJ(t),subscribe:s=>t.subscribe(s)});this._getState=i.getState.bind(i),this._mainThreadListItemRuntime=new Pm(new rr({path:{ref:"threadItems[main]",threadSelector:{type:"main"}},getState:()=>Nm(this._core,this._core.mainThreadId),subscribe:s=>this._core.subscribe(s)}),this._core),this.main=new n(new gv({path:{ref:"threads.main",threadSelector:{type:"main"}},getState:()=>t.getMainThreadRuntimeCore(),subscribe:s=>t.subscribe(s)}),this._mainThreadListItemRuntime),this.__internal_bindMethods()}__internal_bindMethods(){this.switchToThread=this.switchToThread.bind(this),this.switchToNewThread=this.switchToNewThread.bind(this),this.getState=this.getState.bind(this),this.subscribe=this.subscribe.bind(this),this.getById=this.getById.bind(this),this.getItemById=this.getItemById.bind(this),this.getItemByIndex=this.getItemByIndex.bind(this),this.getArchivedItemByIndex=this.getArchivedItemByIndex.bind(this)}switchToThread(t){return this._core.switchToThread(t)}switchToNewThread(){return this._core.switchToNewThread()}getState(){return this._getState()}subscribe(t){return this._core.subscribe(t)}_mainThreadListItemRuntime;main;get mainItem(){return this._mainThreadListItemRuntime}getById(t){return new this._runtimeFactory(new gv({path:{ref:`threads[threadId=${JSON.stringify(t)}]`,threadSelector:{type:"threadId",threadId:t}},getState:()=>this._core.getThreadRuntimeCore(t),subscribe:n=>this._core.subscribe(n)}),this.mainItem)}getItemByIndex(t){return new Pm(new rr({path:{ref:`threadItems[${t}]`,threadSelector:{type:"index",index:t}},getState:()=>Nm(this._core,this._core.threadIds[t]),subscribe:n=>this._core.subscribe(n)}),this._core)}getArchivedItemByIndex(t){return new Pm(new rr({path:{ref:`archivedThreadItems[${t}]`,threadSelector:{type:"archiveIndex",index:t}},getState:()=>Nm(this._core,this._core.archivedThreadIds[t]),subscribe:n=>this._core.subscribe(n)}),this._core)}getItemById(t){return new Pm(new rr({path:{ref:`threadItems[threadId=${t}]`,threadSelector:{type:"threadId",threadId:t}},getState:()=>Nm(this._core,t),subscribe:n=>this._core.subscribe(n)}),this._core)}}const bJ=k.createContext(null),_J=()=>k.useContext(bJ),ml=Object.freeze([]),Pl="DEFAULT_THREAD_ID",SJ=Object.freeze([Pl]),vB=Object.freeze({id:Pl,remoteId:void 0,externalId:void 0,status:"regular"}),xJ=Promise.resolve(),kL=Object.freeze({[Pl]:vB});class wJ{adapter;threadFactory;_mainThreadId=Pl;_threads=SJ;_archivedThreads=ml;_threadData=kL;get isLoading(){return this.adapter.isLoading??!1}get newThreadId(){}get threadIds(){return this._threads}get archivedThreadIds(){return this._archivedThreads}get threadData(){return this._threadData}getLoadThreadsPromise(){return xJ}_mainThread;get mainThreadId(){return this._mainThreadId}constructor(t={},n){this.adapter=t,this.threadFactory=n,this._mainThread=this.threadFactory(),this.__internal_setAdapter(t,!0)}getMainThreadRuntimeCore(){return this._mainThread}getThreadRuntimeCore(){throw new Error("Method not implemented.")}getItemById(t){for(const n of this.adapter.threads??[])if(n.id===t)return n;for(const n of this.adapter.archivedThreads??[])if(n.id===t)return n;if(t===Pl)return vB}__internal_setAdapter(t,n=!1){const i=this.adapter;this.adapter=t;const s=t.threadId??Pl,r=t.threads??ml,o=t.archivedThreads??ml,a=i.threadId??Pl,c=i.threads??ml,u=i.archivedThreads??ml;!n&&a===s&&c===r&&u===o||(this._threadData={...kL,...Object.fromEntries(t.threads?.map(h=>[h.id,{...h,remoteId:h.remoteId,externalId:h.externalId,status:"regular"}])??[]),...Object.fromEntries(t.archivedThreads?.map(h=>[h.id,{...h,remoteId:h.remoteId,externalId:h.externalId,status:"archived"}])??[])},c!==r&&(this._threads=this.adapter.threads?.map(h=>h.id)??ml),u!==o&&(this._archivedThreads=this.adapter.archivedThreads?.map(h=>h.id)??ml),a!==s&&(this._mainThreadId=s,this._mainThread=this.threadFactory()),this._notifySubscribers())}async switchToThread(t){if(this._mainThreadId===t)return;const n=this.adapter.onSwitchToThread;if(!n)throw new Error("External store adapter does not support switching to thread");n(t)}async switchToNewThread(){const t=this.adapter.onSwitchToNewThread;if(!t)throw new Error("External store adapter does not support switching to new thread");t()}async rename(t,n){const i=this.adapter.onRename;if(!i)throw new Error("External store adapter does not support renaming");i(t,n)}async detach(){}async archive(t){const n=this.adapter.onArchive;if(!n)throw new Error("External store adapter does not support archiving");n(t)}async unarchive(t){const n=this.adapter.onUnarchive;if(!n)throw new Error("External store adapter does not support unarchiving");n(t)}async delete(t){const n=this.adapter.onDelete;if(!n)throw new Error("External store adapter does not support deleting");n(t)}initialize(t){return Promise.resolve({remoteId:t,externalId:void 0})}generateTitle(){throw new Error("Method not implemented.")}_subscriptions=new Set;subscribe(t){return this._subscriptions.add(t),()=>this._subscriptions.delete(t)}_notifySubscribers(){for(const t of this._subscriptions)t()}}class Yx{cache=new WeakMap;convertMessages(t,n){return t.map((i,s)=>{const r=this.cache.get(i),o=n(r,i,s);return this.cache.set(i,o),o})}}class CJ extends nB{runtime;endEditCallback;get canCancel(){return!0}getAttachmentAdapter(){return this.runtime.adapters?.attachments}_nonTextParts;_previousText;_parentId;_sourceId;constructor(t,n,{parentId:i,message:s}){super(),this.runtime=t,this.endEditCallback=n,this._parentId=i,this._sourceId=s.id,this._previousText=pf(s),this.setText(this._previousText),this.setRole(s.role),this.setAttachments(s.attachments??[]),this._nonTextParts=s.content.filter(r=>r.type!=="text"),this.setRunConfig({...t.composer.runConfig})}async handleSend(t){pf(t)!==this._previousText&&this.runtime.append({...t,content:[...t.content,...this._nonTextParts],parentId:this._parentId,sourceId:this._sourceId}),this.handleCancel()}handleCancel(){this.endEditCallback(),this._notifySubscribers()}}class kJ{_contextProvider;_subscriptions=new Set;_isInitialized=!1;repository=new Ek;get messages(){return this.repository.getMessages()}get state(){let t;for(const n of this.messages)if(n.role==="assistant"){t=n;break}return t?.metadata.unstable_state??null}composer=new iB(this);constructor(t){this._contextProvider=t}getModelContext(){return this._contextProvider.getModelContext()}_editComposers=new Map;getEditComposer(t){return this._editComposers.get(t)}beginEdit(t){if(this._editComposers.has(t))throw new Error("Edit already in progress");this._editComposers.set(t,new CJ(this,()=>this._editComposers.delete(t),this.repository.getMessage(t))),this._notifySubscribers()}getMessageById(t){try{return this.repository.getMessage(t)}catch{return}}getBranches(t){return this.repository.getBranches(t)}switchToBranch(t){this.repository.switchToBranch(t),this._notifySubscribers()}_notifySubscribers(){for(const t of this._subscriptions)t()}_notifyEventSubscribers(t){const n=this._eventSubscribers.get(t);if(n)for(const i of n)i()}subscribe(t){return this._subscriptions.add(t),()=>this._subscriptions.delete(t)}submitFeedback({messageId:t,type:n}){const i=this.adapters?.feedback;if(!i)throw new Error("Feedback adapter not configured");const{message:s,parentId:r}=this.repository.getMessage(t);if(i.submit({message:s,type:n}),s.role==="assistant"){const o={...s,metadata:{...s.metadata,submittedFeedback:{type:n}}};this.repository.addOrUpdateMessage(r,o)}this._notifySubscribers()}_stopSpeaking;speech;speak(t){const n=this.adapters?.speech;if(!n)throw new Error("Speech adapter not configured");const{message:i}=this.repository.getMessage(t);this._stopSpeaking?.();const s=n.speak(pf(i)),r=s.subscribe(()=>{s.status.type==="ended"?(this._stopSpeaking=void 0,this.speech=void 0):this.speech={messageId:t,status:s.status},this._notifySubscribers()});this.speech={messageId:t,status:s.status},this._notifySubscribers(),this._stopSpeaking=()=>{s.cancel(),r(),this.speech=void 0,this._stopSpeaking=void 0}}stopSpeaking(){if(!this._stopSpeaking)throw new Error("No message is being spoken");this._stopSpeaking(),this._notifySubscribers()}ensureInitialized(){this._isInitialized||(this._isInitialized=!0,this._notifyEventSubscribers("initialize"))}export(){return this.repository.export()}import(t){this.ensureInitialized(),this.repository.clear(),this.repository.import(t),this._notifySubscribers()}reset(t){this.import(Tk.fromArray(t??[]))}_eventSubscribers=new Map;unstable_on(t,n){if(t==="model-context-update")return this._contextProvider.subscribe?.(n)??(()=>{});const i=this._eventSubscribers.get(t);return i?i.add(n):this._eventSubscribers.set(t,new Set([n])),()=>{this._eventSubscribers.get(t).delete(n)}}}const TJ=Object.freeze([]),EJ=(e,t)=>e&&t[t.length-1]?.role!=="assistant";class RJ extends kJ{_assistantOptimisticId=null;_capabilities={switchToBranch:!1,switchBranchDuringRun:!1,edit:!1,reload:!1,cancel:!1,unstable_copy:!1,speech:!1,attachments:!1,feedback:!1};get capabilities(){return this._capabilities}_messages;isDisabled;get isLoading(){return this._store.isLoading??!1}get messages(){return this._messages}get state(){return this._store.state??super.state}get adapters(){return this._store.adapters}suggestions=[];extras=void 0;_converter=new Yx;_store;beginEdit(t){if(!this._store.onEdit)throw new Error("Runtime does not support editing.");super.beginEdit(t)}constructor(t,n){super(t),this.__internal_setAdapter(n)}__internal_setAdapter(t){if(this._store===t)return;const n=t.isRunning??!1;this.isDisabled=t.isDisabled??!1;const i=this._store;this._store=t,this.extras=t.extras,this.suggestions=t.suggestions??TJ,this._capabilities={switchToBranch:this._store.setMessages!==void 0,switchBranchDuringRun:!1,edit:this._store.onEdit!==void 0,reload:this._store.onReload!==void 0,cancel:this._store.onCancel!==void 0,speech:this._store.adapters?.speech!==void 0,unstable_copy:this._store.unstable_capabilities?.copy!==!1,attachments:!!this._store.adapters?.attachments,feedback:!!this._store.adapters?.feedback};let s;if(t.messageRepository){if(i&&i.isRunning===t.isRunning&&i.messageRepository===t.messageRepository){this._notifySubscribers();return}this.repository.clear(),this._assistantOptimisticId=null,this.repository.import(t.messageRepository),s=this.repository.getMessages()}else if(t.messages){if(i){if(i.convertMessage!==t.convertMessage)this._converter=new Yx;else if(i.isRunning===t.isRunning&&i.messages===t.messages){this._notifySubscribers();return}}s=t.convertMessage?this._converter.convertMessages(t.messages,(r,o,a)=>{if(!t.convertMessage)return o;const c=a===t.messages.length-1,u=dy(c,n,!1,!1,void 0);if(r&&(r.role!=="assistant"||!rB(r.status)||r.status===u))return r;const h=t.convertMessage(o,a),f=jf(h,a.toString(),u);return f[Us]=o,f}):t.messages;for(let r=0;r<s.length;r++){const o=s[r],a=s[r-1];this.repository.addOrUpdateMessage(a?.id??null,o)}}else throw new Error("ExternalStoreAdapter must provide either 'messages' or 'messageRepository'");s.length>0&&this.ensureInitialized(),(i?.isRunning??!1)!==(t.isRunning??!1)&&(t.isRunning?this._notifyEventSubscribers("run-start"):this._notifyEventSubscribers("run-end")),this._assistantOptimisticId&&(this.repository.deleteMessage(this._assistantOptimisticId),this._assistantOptimisticId=null),EJ(n,s)&&(this._assistantOptimisticId=this.repository.appendOptimisticMessage(s.at(-1)?.id??null,{role:"assistant",content:[]})),this.repository.resetHead(this._assistantOptimisticId??s.at(-1)?.id??null),this._messages=this.repository.getMessages(),this._notifySubscribers()}switchToBranch(t){if(!this._store.setMessages)throw new Error("Runtime does not support switching branches.");this._store.isRunning||(this.repository.switchToBranch(t),this.updateMessages(this.repository.getMessages()))}async append(t){if(t.parentId!==(this.messages.at(-1)?.id??null)){if(!this._store.onEdit)throw new Error("Runtime does not support editing messages.");await this._store.onEdit(t)}else await this._store.onNew(t)}async startRun(t){if(!this._store.onReload)throw new Error("Runtime does not support reloading messages.");await this._store.onReload(t.parentId,t)}async resumeRun(t){if(!this._store.onResume)throw new Error("Runtime does not support resuming runs.");await this._store.onResume(t)}unstable_loadExternalState(t){if(!this._store.onLoadExternalState)throw new Error("Runtime does not support importing states.");this._store.onLoadExternalState(t)}cancelRun(){if(!this._store.onCancel)throw new Error("Runtime does not support cancelling runs.");this._store.onCancel(),this._assistantOptimisticId&&(this.repository.deleteMessage(this._assistantOptimisticId),this._assistantOptimisticId=null);let t=this.repository.getMessages();const n=t[t.length-1];n?.role==="user"&&n.id===t.at(-1)?.id?(this.repository.deleteMessage(n.id),this.composer.text.trim()||this.composer.setText(pf(n)),t=this.repository.getMessages()):this._notifySubscribers(),setTimeout(()=>{this.updateMessages(t)},0)}addToolResult(t){if(!this._store.onAddToolResult&&!this._store.onAddToolResult)throw new Error("Runtime does not support tool results.");this._store.onAddToolResult?.(t)}resumeToolCall(t){if(!this._store.onResumeToolCall)throw new Error("Runtime does not support resuming tool calls.");this._store.onResumeToolCall(t)}reset(t){const n=new Ek;n.import(Tk.fromArray(t??[])),this.updateMessages(n.getMessages())}import(t){this._assistantOptimisticId=null,super.import(t),this._store.onImport&&this._store.onImport(this.repository.getMessages())}updateMessages=t=>{this._store.convertMessage!==void 0?this._store.setMessages?.(t.flatMap(VQ).filter(i=>i!=null)):this._store.setMessages?.(t)}}const TL=e=>e.adapters?.threadList??{};class MJ extends tB{threads;constructor(t){super(),this.threads=new wJ(TL(t),()=>new RJ(this._contextProvider,t))}setAdapter(t){this.threads.__internal_setAdapter(TL(t)),this.threads.getMainThreadRuntimeCore().__internal_setAdapter(t)}}const AJ=e=>{const[t]=k.useState(()=>new MJ(e));k.useEffect(()=>{t.setAdapter(e)});const{modelContext:n}=_J()??{};return k.useEffect(()=>{if(n)return t.registerModelContextProvider(n)},[n,t]),k.useMemo(()=>new FB(t),[t])},PJ=e=>{try{return JSON.parse(e),!0}catch{return!1}};function LJ({state:e,getTools:t,onResult:n,setToolStatuses:i}){const s=k.useRef({}),r=k.useRef(new Map),o=k.useRef(new AbortController),a=k.useRef(0),c=k.useRef([]),[u]=k.useState(()=>{const[y,b]=$Q(),S=uJ(t,()=>o.current?.signal??new AbortController().signal,(_,w)=>new Promise((M,R)=>{const E=r.current.get(_);E&&E.reject(new Error("Human input request was superseded by a new request")),r.current.set(_,{resolve:M,reject:R}),i(A=>({...A,[_]:{type:"interrupt",payload:{type:"human",payload:w}}}))}),{onExecutionStart:_=>{a.current++,i(w=>({...w,[_]:{type:"executing"}}))},onExecutionEnd:_=>{a.current--,i(w=>{const M={...w};return delete M[_],M}),a.current===0&&(c.current.forEach(w=>w()),c.current=[])}});return y.pipeThrough(S).pipeThrough(new cB).pipeTo(new WritableStream({write(_){if(_.type==="result"){if(s.current[_.meta.toolCallId]?.hasResult)return;n({type:"add-tool-result",toolCallId:_.meta.toolCallId,toolName:_.meta.toolName,result:_.result,isError:_.isError,..._.artifact&&{artifact:_.artifact}})}}})),b}),h=k.useRef(new Set),f=k.useRef(!0);k.useEffect(()=>{const y=b=>{b.forEach(S=>{S.content.forEach(_=>{if(_.type==="tool-call"){if(f.current)h.current.add(_.toolCallId);else{if(h.current.has(_.toolCallId))return;let w=s.current[_.toolCallId];if(w||(w={argsText:"",hasResult:!1,argsComplete:!1,controller:u.addToolCallPart({toolName:_.toolName,toolCallId:_.toolCallId})},s.current[_.toolCallId]=w),_.argsText!==w.argsText&&!w.argsComplete){if(!_.argsText.startsWith(w.argsText))throw new Error(`Tool call argsText can only be appended, not updated: ${_.argsText} does not start with ${w.argsText}`);const M=_.argsText.slice(w.argsText.length);w.controller.argsText.append(M);const R=PJ(_.argsText);R&&w.controller.argsText.close(),s.current[_.toolCallId]={argsText:_.argsText,hasResult:w.hasResult,argsComplete:R,controller:w.controller}}_.result!==void 0&&!w.hasResult&&(w.controller.setResponse(new ar({result:_.result,artifact:_.artifact,isError:_.isError})),w.controller.close(),s.current[_.toolCallId]={hasResult:!0,argsComplete:!0,argsText:w.argsText,controller:w.controller})}_.messages&&y(_.messages)}})})};y(e.messages),f.current&&(f.current=!1)},[e,u,n]);const m=()=>(r.current.forEach(({reject:y})=>{y(new Error("Tool execution aborted"))}),r.current.clear(),o.current.abort(),o.current=new AbortController,a.current===0?Promise.resolve():new Promise(y=>{c.current.push(y)}));return{reset:()=>{m(),f.current=!0},abort:m,resume:(y,b)=>{const S=r.current.get(y);if(S)r.current.delete(y),i(_=>({..._,[y]:{type:"executing"}})),S.resolve(b);else throw new Error(`Tool call ${y} is not waiting for human input`)}}}function NJ(e,t){e.commitTasks.forEach(n=>{const i=n.cellIndex,s=t.cells[i];if(s.type!=="effect")throw new Error("Cannot find effect cell");let r=!0;if(s.deps!==void 0&&n.deps!==void 0&&(r=s.deps.length!==n.deps.length||s.deps.some((o,a)=>!Object.is(o,n.deps[a]))),r){if(s.mounted){if(typeof s.deps!=typeof n.deps)throw new Error("tapEffect called with and without dependencies across re-renders");try{s.mounted&&s.cleanup&&s.cleanup()}finally{s.mounted=!1}}const o=n.effect();if(o!==void 0&&typeof o!="function")throw new Error(`An effect function must either return a cleanup function or nothing. Received: ${typeof o}`);s.mounted=!0,s.cleanup=typeof o=="function"?o:void 0,s.deps=n.deps}})}function IJ(e){let t=null;for(let n=e.cells.length-1;n>=0;n--){const i=e.cells[n];if(i?.type==="effect"&&i.mounted&&i.cleanup)try{i.cleanup()}catch(s){t==null&&(t=s)}finally{i.mounted=!1}}if(t!=null)throw t}let zh=null;function DJ(e,t){e.currentIndex=0;const n=zh;zh=e;try{if(t(),e.isFirstRender=!1,e.cells.length!==e.currentIndex)throw new Error(`Rendered ${e.currentIndex} hooks but expected ${e.cells.length}. Hooks must be called in the exact same order in every render.`)}finally{zh=n}}function Mk(){if(!zh)throw new Error("No resource fiber available");return zh}function yB(e,t){const n=e[bB];if(!n)throw new Error("ResourceElement.type is not a valid Resource");return n(t)}const bB=Symbol("fnSymbol");function fy(e,t){return{resource:e,scheduleRerender:t,cells:[],currentIndex:0,renderContext:void 0,isFirstRender:!0,isMounted:!1,isNeverMounted:!0}}function mf(e){e.isMounted=!1,IJ(e)}function gf(e,t){const n={commitTasks:[],props:t,state:void 0};return DJ(e,()=>{e.renderContext=n;try{n.state=yB(e.resource,t)}finally{e.renderContext=void 0}}),n}function vf(e,t){e.isMounted=!0,e.isNeverMounted=!1,NJ(t,e)}const OJ=globalThis.__ASSISTANT_UI_DISABLE_LAYOUT_EFFECT__===!0,EL=OJ?k.useEffect:k.useLayoutEffect;function Ak(e){const[,t]=k.useState({}),n=k.useMemo(()=>fy(e.type,()=>t({})),[e.type]),i=gf(n,e.props);return EL(()=>()=>mf(n),[n]),EL(()=>{vf(n,i)}),i.state}const py=e=>typeof e=="string"?{scope:e.split(".")[0],event:e}:{scope:e.scope,event:e.event},$h=(e,t,n)=>t===e;let Zc;const tS=()=>{if(Zc)return Zc;const e=()=>({apis:new Map,nextId:0,listeners:new Set});if(typeof window>"u")return Zc=e(),Zc;const t=window.__ASSISTANT_UI_DEVTOOLS_HOOK__;if(t)return Zc=t,t;const n=e();return window.__ASSISTANT_UI_DEVTOOLS_HOOK__=n,Zc=n,n};class Rl{static MAX_EVENT_LOGS_PER_API=200;static register(t){const n=tS();for(const a of n.apis.values())if(a.api===t)return()=>{};const i=n.nextId++,s={api:t,logs:[]},r=t.on?.("*",a=>{const c=n.apis.get(i);c&&(c.logs.push({time:new Date,event:a.event,data:a.payload}),c.logs.length>Rl.MAX_EVENT_LOGS_PER_API&&(c.logs=c.logs.slice(-200)),Rl.notifyListeners(i))}),o=t.subscribe?.(()=>{Rl.notifyListeners(i)});return n.apis.set(i,s),Rl.notifyListeners(i),()=>{const a=tS();a.apis.get(i)&&(r?.(),o?.(),a.apis.delete(i),Rl.notifyListeners(i))}}static notifyListeners(t){tS().listeners.forEach(i=>i(t))}}function sn(e){const t=n=>({type:t,props:n});return t[bB]=e,t}const jJ=e=>{if(e.renderContext)throw new Error("Resource updated during render");if(e.isMounted)e.scheduleRerender();else if(e.isNeverMounted)throw new Error("Resource updated before mount")};function BJ(e){const t=Mk(),n=t.currentIndex++;if(!t.isFirstRender&&n>=t.cells.length)throw new Error("Rendered more hooks than during the previous render. Hooks must be called in the exact same order in every render.");if(!t.cells[n]){const r={type:"state",value:typeof e=="function"?e():e,set:o=>{const a=r.value,c=typeof o=="function"?o(a):o;Object.is(a,c)||(r.value=c,jJ(t))}};t.cells[n]=r}const i=t.cells[n];if(i.type!=="state")throw new Error("Hook order changed between renders");return i}function qr(e){const t=BJ(e);return[t.value,t.set]}function FJ(){const e=Mk(),t=e.currentIndex++;if(!e.isFirstRender&&t>=e.cells.length)throw new Error("Rendered more hooks than during the previous render. Hooks must be called in the exact same order in every render.");if(!e.cells[t]){const i={type:"effect",mounted:!1};e.cells[t]=i}if(e.cells[t].type!=="effect")throw new Error("Hook order changed between renders");return t}function Ri(e,t){const n=Mk(),i=FJ();n.renderContext.commitTasks.push({effect:e,deps:t,cellIndex:i})}function Ou(e){const[t]=qr(()=>({current:e}));return t}const UJ=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0},Lt=(e,t)=>{const n=Ou();return n.current||(n.current={value:e(),deps:t}),UJ(n.current.deps,t)||(n.current.value=e(),n.current.deps=t),n.current.value},zJ=(e,t)=>Lt(()=>e,t);function qh(e,t){const[n,i]=qr({}),s=Lt(()=>fy(e.type,()=>i({})),[e.type]),r=t?Lt(()=>e.props,t):e.props,o=Lt(()=>gf(s,r),[s,r,n]);return Ri(()=>()=>mf(s),[s]),Ri(()=>{vf(s,o)},[s,o]),o.state}function Xr(e){return yB(e.type,e.props)}function _B(e,t,n){const[i,s]=qr(0),r=zJ(()=>s(u=>u+1),[]),[o]=qr(()=>new Map),a=Lt(()=>t,n),c=Lt(()=>{const u={remove:[],add:[],commit:[],return:{}};for(const h in e){const f=e[h],m=a(f,h);let y=o.get(h);(!y||y.resource!==m.type)&&(y&&u.remove.push(h),y=fy(m.type,r),u.add.push([h,y]));const b=gf(y,m.props);u.commit.push([h,b]),u.return[h]=b.state}if(o.size>u.commit.length-u.add.length+u.remove.length)for(const h of o.keys())h in e||u.remove.push(h);return u},[e,a,i]);return Ri(()=>()=>{for(const u of o.keys())mf(o.get(u)),o.delete(u)},[]),Ri(()=>{for(const u of c.remove)mf(o.get(u)),o.delete(u);for(const[u,h]of c.add)o.set(u,h);for(const[u,h]of c.commit)vf(o.get(u),h)},[c]),c.return}const $J=50;let Lr={schedulers:new Set([]),isScheduled:!1};class qJ{_task;_isDirty=!1;constructor(t){this._task=t}get isDirty(){return this._isDirty}markDirty(){this._isDirty=!0,Lr.schedulers.add(this),HJ()}runTask(){this._isDirty=!1,this._task()}}const HJ=()=>{Lr.isScheduled||(Lr.isScheduled=!0,queueMicrotask(SB))},SB=()=>{try{const e=[];let t=0;for(const n of Lr.schedulers)if(Lr.schedulers.delete(n),!!n.isDirty){if(t++,t>$J)throw new Error("Maximum update depth exceeded. This can happen when a resource repeatedly calls setState inside tapEffect.");try{n.runTask()}catch(i){e.push(i)}}if(e.length>0)throw e.length===1?e[0]:new AggregateError(e,"Errors occurred during flushSync")}finally{Lr.schedulers.clear(),Lr.isScheduled=!1}},Xx=e=>{const t=Lr;Lr={schedulers:new Set([]),isScheduled:!0};try{const n=e();return SB(),n}finally{Lr=t}},VJ=sn(e=>{const[,t]=qr(e.element),n=qh(e.element),i=Ou(new Set).current,s=Ou(n);return Ri(()=>{n!==s.current&&(s.current=n,i.forEach(o=>o()))}),Lt(()=>({getState:()=>s.current,subscribe:o=>(i.add(o),()=>i.delete(o)),render:o=>{const a=e.element!==o;e.element=o,e.onRender(a)&&t(o)},unmount:e.onUnmount}),[])}),WJ=(e,{mount:t=!0}={})=>{let n=t,i;const s={element:e,onRender:a=>n?a:(n=!0,Xx(()=>{a&&(i=gf(o,s)),!r.isDirty&&vf(o,i)}),!1),onUnmount:()=>{if(!n)throw new Error("Resource not mounted");n=!1,mf(o)}},r=new qJ(()=>{i=gf(o,s),!(r.isDirty||!n)&&vf(o,i)}),o=fy(VJ,()=>r.markDirty());return Xx(()=>{r.markDirty()}),i.state},Hh=Symbol("tap.Context"),xB=e=>({[Hh]:e}),wB=(e,t,n)=>{const i=e[Hh];e[Hh]=t;try{return n()}finally{e[Hh]=i}},CB=e=>e[Hh],RL=e=>{let t;const n=new Set,i=(u,h)=>{const f=typeof u=="function"?u(t):u;if(!Object.is(f,t)){const m=t;t=h??(typeof f!="object"||f===null)?f:Object.assign({},t,f),n.forEach(y=>y(t,m))}},s=()=>t,a={setState:i,getState:s,getInitialState:()=>c,subscribe:u=>(n.add(u),()=>n.delete(u))},c=t=e(i,s,a);return a},GJ=(e=>e?RL(e):RL),KJ=e=>e;function YJ(e,t=KJ){const n=pi.useSyncExternalStore(e.subscribe,pi.useCallback(()=>t(e.getState()),[e,t]),pi.useCallback(()=>t(e.getInitialState()),[e,t]));return pi.useDebugValue(n),n}const ML=e=>{const t=GJ(e),n=i=>YJ(t,i);return Object.assign(n,t),n},kB=(e=>e?ML(e):ML),TB=sn(e=>{const t=Lt(()=>WJ(e,{mount:!1}),[e.type]);return Ri(()=>{t.render(e)}),t});class XJ{ref;constructor(t){this.ref=t}get(t,n){return this.ref.current[n]}ownKeys(){return Object.keys(this.ref.current)}has(t,n){return n in this.ref.current}getOwnPropertyDescriptor(t,n){return Object.getOwnPropertyDescriptor(this.ref.current,n)}set(){return!1}setPrototypeOf(){return!1}defineProperty(){return!1}deleteProperty(){return!1}preventExtensions(){return!1}}const gr=(e,t)=>{const n=Ou(e);Ri(()=>{n.current=e});const i=Lt(()=>new Proxy({},new XJ(n)),[]),s=t?.key,r=e.getState();return Lt(()=>({key:s,state:r,api:i}),[r,s])},yf=sn(e=>{const t=Ou(e.get);return Ri(()=>{t.current=e.get}),Lt(()=>hi({source:e.source,query:e.query,get:()=>t.current()}),[e.source,JSON.stringify(e.query)])}),QJ=sn(e=>{const t=qh(e.scopeElement);return Lt(()=>[e.fieldName,t],[e.fieldName,t])}),JJ=sn(e=>{const{on:t,subscribe:n,...i}=e,s=Ou({on:t,subscribe:n});Ri(()=>{s.current={on:t,subscribe:n}});const r=_B(i,(o,a)=>QJ({fieldName:a,scopeElement:o}),[]);return Lt(()=>{const o=Object.fromEntries(Object.values(r)),{on:a,subscribe:c}=s.current;return a&&(o.on=(u,h)=>a(u,h)),c&&(o.subscribe=u=>c(u)),o},[r])}),EB=xB(null),ZJ=(e,t)=>wB(EB,e,t),RB=()=>{const e=CB(EB);if(!e)throw new Error("Model context is not available in this context");return e},eZ=sn(({toolkit:e})=>{const[t,n]=qr(()=>({tools:{}})),i=RB();Ri(()=>{if(!e)return;const r=[];for(const[c,u]of Object.entries(e))u.render&&r.push(s(c,u.render));const o=Object.entries(e).reduce((c,[u,h])=>{const{render:f,...m}=h;return c[u]=m,c},{}),a={getModelContext:()=>({tools:o})};return r.push(i.register(a)),()=>{r.forEach(c=>c())}},[e,i]);const s=(r,o)=>(n(a=>({...a,tools:{...a.tools,[r]:[...a.tools[r]??[],o]}})),()=>{n(a=>({...a,tools:{...a.tools,[r]:a.tools[r]?.filter(c=>c!==o)??[]}}))});return gr({getState:()=>t,setToolUI:s})}),tZ=sn(()=>Lt(()=>{const t=new Map;return{on:(n,i)=>{t.has(n)||t.set(n,new Set);const s=t.get(n);return s.add(i),()=>{s.delete(i),s.size===0&&t.delete(n)}},emit:(n,i)=>{const s=t.get(n),r=t.get("*");!s&&!r||queueMicrotask(()=>{if(s)for(const o of s)o(i);if(r)for(const o of r)o({event:n,payload:i})})}}},[])),MB=xB(null),nZ=(e,t)=>wB(MB,e,t),Pk=()=>{const e=CB(MB);if(!e)throw new Error("Events context is not available");return e},iZ=sn(()=>{const[e]=qr(()=>({})),t=new wk;return gr({getState:()=>e,getModelContext:()=>t.getModelContext(),subscribe:n=>t.subscribe(n),register:n=>t.registerModelContextProvider(n)})}),sZ=sn(({threads:e,modelContext:t,tools:n})=>{const i=Xr(tZ()),{threads:s,tools:r,modelContext:o}=nZ(i,()=>{const c=qh(t??iZ(),[t]);return ZJ(c.api,()=>({modelContext:c,tools:qh(n??eZ({}),[n]),threads:qh(e,[e])}))}),a=Lt(()=>({threads:s.state,tools:r.state,modelContext:o.state}),[s.state,r.state,o.state]);return gr({getState:()=>a,threads:s.api,tools:r.api,modelContext:o.api,on:i.on})}),rZ=e=>{const t=()=>e.getState().api.threads.item("main");return{threads:hi({source:"root",query:{},get:()=>e.getState().api.threads}),tools:hi({source:"root",query:{},get:()=>e.getState().api.tools}),modelContext:hi({source:"root",query:{},get:()=>e.getState().api.modelContext}),thread:hi({source:"threads",query:{type:"main"},get:()=>e.getState().api.threads.thread("main")}),threadListItem:hi({source:"threads",query:{type:"main"},get:()=>t()}),composer:hi({source:"thread",query:{},get:()=>e.getState().api.threads.thread("main").composer}),on(n,i){const{event:s,scope:r}=py(n);if(r==="*")return e.getState().api.on(s,i);if($h("thread",r)||$h("thread-list-item",r)||$h("composer",r))return e.getState().api.on(s,o=>{o.threadId===t().getState().id&&i(o)});throw new Error(`Event scope is not available in this component: ${r}`)},subscribe:e.subscribe}},oZ=e=>{const t=Lk(),n=Ak(TB(sZ(e))),i=k.useMemo(()=>rZ(n),[n]);return k.useMemo(()=>PB(t,i),[t,i])},hi=e=>{const t=e.get;return t.source=e.source,t.query=e.query,t},vv=()=>()=>{},AB=k.createContext({threads:hi({source:null,query:{},get:()=>{throw new Error("Threads is only available inside <AssistantProvider />")}}),tools:hi({source:null,query:{},get:()=>{throw new Error("Tools is only available inside <AssistantProvider />")}}),modelContext:hi({source:null,query:{},get:()=>{throw new Error("ModelContext is only available inside <AssistantProvider />")}}),threadListItem:hi({source:null,query:{},get:()=>{throw new Error("ThreadListItem is only available inside <AssistantProvider />")}}),thread:hi({source:null,query:{},get:()=>{throw new Error("Thread is only available inside <AssistantProvider />")}}),composer:hi({source:null,query:{},get:()=>{throw new Error("Composer is only available inside <AssistantProvider />")}}),message:hi({source:null,query:{},get:()=>{throw new Error("Message is only available inside <ThreadPrimitive.Messages />")}}),part:hi({source:null,query:{},get:()=>{throw new Error("Part is only available inside <MessagePrimitive.Parts />")}}),attachment:hi({source:null,query:{},get:()=>{throw new Error("Attachment is only available inside <MessagePrimitive.Attachments /> or <ComposerPrimitive.Attachments />")}}),subscribe:vv,on:e=>{const{scope:t}=py(e);throw new Error(`Event scope is not available in this component: ${t}`)}}),Lk=()=>k.useContext(AB),my=e=>{const t=Lk(),n=Ak(JJ(e));return k.useMemo(()=>PB(t,n),[t,n])},aZ=e=>oZ(e);function gi(e){return e?aZ(e):Lk()}const lZ=(e,t)=>e===vv?t:t===vv?e:(...n)=>{const i=e(...n),s=t(...n);return()=>{i(),s()}},PB=(e,t)=>{const n=t.subscribe;return{...e,...t,subscribe:lZ(e.subscribe,n??vv)}},Ff=({api:e,children:t,devToolsVisible:n=!0})=>(k.useEffect(()=>{if(!(!n||!e.subscribe))return Rl.register(e)},[e,n]),g.jsx(AB.Provider,{value:e,children:t}));class AL{#e;constructor(t){this.#e=t}get threads(){return this.#e.threads().getState()}get tools(){return this.#e.tools().getState()}get threadListItem(){return this.#e.threadListItem().getState()}get thread(){return this.#e.thread().getState()}get composer(){return this.#e.composer().getState()}get message(){return this.#e.message().getState()}get part(){return this.#e.part().getState()}get attachment(){return this.#e.attachment().getState()}}const st=e=>{const t=gi(),n=k.useMemo(()=>new AL(t),[t]),i=k.useSyncExternalStore(t.subscribe,()=>e(n),()=>e(n));if(k.useDebugValue(i),i instanceof AL)throw new Error("You tried to return the entire AssistantState. This is not supported due to technical limitations.");return i},nS=(e,t)=>{const n=gi(),i=k.useRef(t);k.useEffect(()=>{i.current=t});const{scope:s,event:r}=py(e);k.useEffect(()=>n.on({scope:s,event:r},o=>i.current(o)),[n,s,r])};function cZ(e,t){function n(i){const s=k.useContext(e);if(!i?.optional&&!s)throw new Error(`This component must be used within ${t}.`);return s}return n}function LB(e,t){function n(s){const r=e(s);return r?r[t]:null}function i(s){let r=!1,o;typeof s=="function"?o=s:s&&typeof s=="object"&&(r=!!s.optional,o=s.selector);const a=n({optional:r});return a?o?a(o):a():null}return{[t]:i,[`${t}Store`]:n}}const NB=k.createContext(null),uZ=cZ(NB,"ThreadPrimitive.Viewport"),{useThreadViewport:yv,useThreadViewportStore:Nk}=LB(uZ,"useThreadViewport"),dZ=e=>{const t=e;t.__isBound||(t.__internal_bindMethods?.(),t.__isBound=!0)};function hZ(e,t=fZ){dZ(e);const n=k.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getState()));return k.useDebugValue(n),n}const fZ=e=>e;function IB(e){function t(n){let i=!1,s;typeof n=="function"?s=n:n&&(i=!!n.optional,s=n.selector);const r=e({optional:i});return r?hZ(r,s):null}return t}function pZ(e){const t=gi(),n=st(()=>t.attachment.source?t.attachment().__internal_getRuntime?.()??null:null);if(!n&&!e?.optional)throw new Error("AttachmentRuntime is not available");return n}function mZ(e){const t=pZ(e);if(!t)return null;if(t.source!=="thread-composer")throw new Error("This component must be used within a thread's ComposerPrimitive.Attachments component.");return t}const gZ=IB(mZ);function vZ(e){const t=gi(),n=st(()=>t.message.source?t.message().__internal_getRuntime?.()??null:null);if(!n&&!e?.optional)throw new Error("MessageRuntime is not available");return n}const yZ=IB(vZ),bZ=e=>{const t={role:"assistant",content:[]};for(const n of e)if(n.role==="tool"){const i=t.content.findIndex(s=>s.type==="tool-call"&&s.toolCallId===n.toolCallId);if(i!==-1){const s=t.content[i];if(n.toolName!==void 0&&s.toolName!==n.toolName)throw new Error(`Tool call name ${n.toolCallId} ${n.toolName} does not match existing tool call ${s.toolName}`);t.content[i]={...s,[Us]:[...s[Us]??[],n],result:n.result,artifact:n.artifact,isError:n.isError,messages:n.messages}}else throw new Error(`Tool call ${n.toolCallId} ${n.toolName} not found in assistant message`)}else{const i=n.role,s=(typeof n.content=="string"?[{type:"text",text:n.content}]:n.content).map(r=>({...r,[Us]:[n]}));switch(i){case"system":case"user":return{...n,content:s};case"assistant":t.content.length===0&&(t.id=n.id,t.createdAt??=n.createdAt,t.status??=n.status,n.attachments&&(t.attachments=[...t.attachments??[],...n.attachments]),n.metadata&&(t.metadata??={},n.metadata.unstable_state&&(t.metadata.unstable_state=n.metadata.unstable_state),n.metadata.unstable_annotations&&(t.metadata.unstable_annotations=[...t.metadata.unstable_annotations??[],...n.metadata.unstable_annotations]),n.metadata.unstable_data&&(t.metadata.unstable_data=[...t.metadata.unstable_data??[],...n.metadata.unstable_data]),n.metadata.steps&&(t.metadata.steps=[...t.metadata.steps??[],...n.metadata.steps]),n.metadata.custom&&(t.metadata.custom={...t.metadata.custom??{},...n.metadata.custom}),n.metadata.submittedFeedback&&(t.metadata.submittedFeedback=n.metadata.submittedFeedback))),t.content.push(...s);break;default:{const r=i;throw new Error(`Unknown message role: ${r}`)}}}return t},_Z=(e,t)=>{const n=[];let i=!1,s=!1,r=[],o=[];const a=()=>{o.length&&n.push({inputs:r,outputs:o}),r=[],o=[],i=!1,s=!1};for(const c of e)for(const u of c.outputs)(s&&u.role!=="tool"||!i||u.role==="user"||u.role==="system")&&a(),i=u.role==="assistant"||u.role==="tool",r.at(-1)!==c.input&&r.push(c.input),o.push(u),u.role==="assistant"&&(u.convertConfig?.joinStrategy==="none"||t==="none")&&(s=!0);return a(),n},SZ=({callback:e,messages:t,isRunning:n,joinStrategy:i,metadata:s})=>{const r=k.useMemo(()=>({metadata:s??{},callback:e,callbackCache:new WeakMap,chunkCache:new WeakMap,converterCache:new Yx}),[e,s]);return k.useMemo(()=>{const o=[];for(const u of t){let h=r.callbackCache.get(u);if(!h){const f=r.callback(u,r.metadata),m=Array.isArray(f)?f:[f];h={input:u,outputs:m},r.callbackCache.set(u,h)}o.push(h)}const a=_Z(o,i).map(u=>{const h=u.outputs[0];if(!h)return u;const f=r.chunkCache.get(h);return f&&PL(f.outputs,u.outputs)?f:(r.chunkCache.set(h,u),u)}),c=r.converterCache.convertMessages(a,(u,h,f)=>{const m=f===a.length-1,y=bZ(h.outputs),b=typeof y.content=="object"&&y.content.some(M=>M.type==="tool-call"&&M.result===void 0),S=typeof y.content=="object"&&y.content.some(M=>M.type==="tool-call"&&M.result===void 0),_=dy(m,n,b,S,m?r.metadata.error:void 0);if(u&&(u.role!=="assistant"||!rB(u.status)||u.status===_)){const M=GQ(u);if(PL(M,h.inputs))return u}const w=jf(y,f.toString(),_);return w[Us]=h.inputs,w});return c[Us]=t,c},[r,t,n,i])},PL=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},nc=e=>{const[,t]=qr(e.getState);return Ri(()=>(t(e.getState()),e.subscribe(()=>{t(e.getState())})),[e]),e.getState()},xZ=sn(({runtime:e})=>{const t=nc(e),n=Pk();return Ri(()=>{const i=[],s=["switched-to","switched-away"];for(const r of s){const o=e.unstable_on(r,()=>{n.emit(`thread-list-item.${r}`,{threadId:e.getState().id})});i.push(o)}return()=>{for(const r of i)r()}},[e,n]),gr({getState:()=>t,switchTo:e.switchTo,rename:e.rename,archive:e.archive,unarchive:e.unarchive,delete:e.delete,generateTitle:e.generateTitle,initialize:e.initialize,detach:e.detach,__internal_getRuntime:()=>e},{key:t.id})}),bf=e=>{const t=Lt(()=>Object.fromEntries(e),[e]),n=_B(t,r=>r,[]),i=Lt(()=>Object.keys(n),[n]);return{state:Lt(()=>{const r=new Array(i.length);for(let o=0;o<i.length;o++)r[o]=n[i[o]].state;return r},[i,n]),api:r=>{const o="index"in r?n[i[r.index]]?.api:n[r.key]?.api;if(!o)throw new Error(`tapLookupResources: Resource not found for lookup: ${JSON.stringify(r)}`);return o}}},DB=sn(({runtime:e})=>{const t=nc(e);return gr({getState:()=>t,remove:e.remove,__internal_getRuntime:()=>e},{key:t.id})}),wZ=sn(({runtime:e,index:t})=>{const n=Lt(()=>e.getAttachmentByIndex(t),[e,t]);return Xr(DB({runtime:n}))}),OB=sn(({threadIdRef:e,messageIdRef:t,runtime:n})=>{const i=nc(n),s=Pk();Ri(()=>{const a=[],c=["send","attachment-add"];for(const u of c){const h=n.unstable_on(u,()=>{s.emit(`composer.${u}`,{threadId:e.current,...t&&{messageId:t.current}})});a.push(h)}return()=>{for(const u of a)u()}},[n,s,e,t]);const r=bf(i.attachments.map((a,c)=>[a.id,wZ({runtime:n,index:c})])),o=Lt(()=>({text:i.text,role:i.role,attachments:r.state,runConfig:i.runConfig,isEditing:i.isEditing,canCancel:i.canCancel,attachmentAccept:i.attachmentAccept,isEmpty:i.isEmpty,type:i.type??"thread"}),[i,r.state]);return gr({getState:()=>o,setText:n.setText,setRole:n.setRole,setRunConfig:n.setRunConfig,addAttachment:n.addAttachment,reset:n.reset,clearAttachments:n.clearAttachments,send:n.send,cancel:n.cancel,beginEdit:n.beginEdit??(()=>{throw new Error("beginEdit is not supported in this runtime")}),attachment:a=>"id"in a?r.api({key:a.id}):r.api(a),__internal_getRuntime:()=>n})}),CZ=sn(({runtime:e})=>{const t=nc(e);return gr({getState:()=>t,addToolResult:i=>e.addToolResult(i),resumeToolCall:i=>e.resumeToolCall(i),__internal_getRuntime:()=>e},{key:t.type==="tool-call"?`toolCallId-${t.toolCallId}`:void 0})}),kZ=sn(({runtime:e,index:t})=>{const n=Lt(()=>e.getAttachmentByIndex(t),[e,t]);return Xr(DB({runtime:n}))}),TZ=sn(({runtime:e,index:t})=>{const n=Lt(()=>e.getMessagePartByIndex(t),[e,t]);return Xr(CZ({runtime:n}))}),EZ=sn(({runtime:e,threadIdRef:t})=>{const n=nc(e),[i,s]=qr(!1),[r,o]=qr(!1),a=Lt(()=>({get current(){return e.getState().id}}),[e]),c=Xr(OB({runtime:e.composer,threadIdRef:t,messageIdRef:a})),u=bf(n.content.map((m,y)=>["toolCallId"in m&&m.toolCallId!=null?`toolCallId-${m.toolCallId}`:`index-${y}`,TZ({runtime:e,index:y})])),h=bf(n.attachments?.map((m,y)=>[m.id,kZ({runtime:e,index:y})])??[]),f=Lt(()=>({...n,parts:u.state,composer:c.state,isCopied:i,isHovering:r}),[n,u.state,c.state,i,r]);return gr({getState:()=>f,composer:c.api,reload:m=>e.reload(m),speak:()=>e.speak(),stopSpeaking:()=>e.stopSpeaking(),submitFeedback:m=>e.submitFeedback(m),switchToBranch:m=>e.switchToBranch(m),getCopyText:()=>e.unstable_getCopyText(),part:m=>"index"in m?u.api({index:m.index}):u.api({key:`toolCallId-${m.toolCallId}`}),attachment:m=>"id"in m?h.api({key:m.id}):h.api(m),setIsCopied:s,setIsHovering:o,__internal_getRuntime:()=>e},{key:n.id})}),RZ=sn(({runtime:e,id:t,threadIdRef:n})=>{const i=Lt(()=>e.getMessageById(t),[e,t]);return Xr(EZ({runtime:i,threadIdRef:n}))}),MZ=sn(({runtime:e})=>{const t=nc(e),n=Pk();Ri(()=>{const a=[],c=["run-start","run-end","initialize","model-context-update"];for(const u of c){const h=e.unstable_on(u,()=>{const f=e.getState()?.threadId||"unknown";n.emit(`thread.${u}`,{threadId:f})});a.push(h)}return()=>{for(const u of a)u()}},[e]);const i=Lt(()=>({get current(){return e.getState().threadId}}),[e]),s=Xr(OB({runtime:e.composer,threadIdRef:i})),r=bf(t.messages.map(a=>[a.id,RZ({runtime:e,id:a.id,threadIdRef:i})])),o=Lt(()=>({isEmpty:r.state.length===0&&!t.isLoading,isDisabled:t.isDisabled,isLoading:t.isLoading,isRunning:t.isRunning,capabilities:t.capabilities,state:t.state,suggestions:t.suggestions,extras:t.extras,speech:t.speech,composer:s.state,messages:r.state}),[t,r,s.state]);return gr({getState:()=>o,composer:s.api,append:e.append,startRun:e.startRun,unstable_resumeRun:e.unstable_resumeRun,cancelRun:e.cancelRun,getModelContext:e.getModelContext,export:e.export,import:e.import,reset:e.reset,stopSpeaking:e.stopSpeaking,startVoice:async()=>{throw new Error("startVoice is not supported in this runtime")},stopVoice:async()=>{throw new Error("stopVoice is not supported in this runtime")},message:a=>"id"in a?r.api({key:a.id}):r.api(a),__internal_getRuntime:()=>e})}),AZ=sn(({runtime:e,id:t})=>{const n=Lt(()=>e.getItemById(t),[e,t]);return Xr(xZ({runtime:n}))}),PZ=sn(({runtime:e,__internal_assistantRuntime:t})=>{const n=nc(e),i=Xr(MZ({runtime:e.main})),s=bf(Object.keys(n.threadItems).map(o=>[o,AZ({runtime:e,id:o})])),r=Lt(()=>({mainThreadId:n.mainThreadId,newThreadId:n.newThread??null,isLoading:n.isLoading,threadIds:n.threads,archivedThreadIds:n.archivedThreads,threadItems:s.state,main:i.state}),[n,s.state,i.state]);return gr({getState:()=>r,thread:()=>i.api,item:o=>{if(o==="main")return s.api({key:r.mainThreadId});if("id"in o)return s.api({key:o.id});const{index:a,archived:c=!1}=o,u=c?r.archivedThreadIds[a]:r.threadIds[a];return s.api({key:u})},switchToThread:o=>{e.switchToThread(o)},switchToNewThread:()=>{e.switchToNewThread()},__internal_getAssistantRuntime:()=>t})}),LZ=sn(e=>{const t=RB();return Ri(()=>e.registerModelContextProvider(t),[e,t]),Xr(PZ({runtime:e.threads,__internal_assistantRuntime:e}))}),iS=e=>{const t=new Map,n=()=>{let i=0;for(const s of t.values())i+=s;e(i)};return{register:()=>{const i=Symbol();return t.set(i,0),{setHeight:s=>{t.get(i)!==s&&(t.set(i,s),n())},unregister:()=>{t.delete(i),n()}}}}},NZ=(e={})=>{const t=new Set,n=iS(o=>{r.setState({height:{...r.getState().height,viewport:o}})}),i=iS(o=>{r.setState({height:{...r.getState().height,inset:o}})}),s=iS(o=>{r.setState({height:{...r.getState().height,userMessage:o}})}),r=kB(()=>({isAtBottom:!0,scrollToBottom:({behavior:o="auto"}={})=>{for(const a of t)a({behavior:o})},onScrollToBottom:o=>(t.add(o),()=>{t.delete(o)}),turnAnchor:e.turnAnchor??"bottom",height:{viewport:0,inset:0,userMessage:0},registerViewport:n.register,registerContentInset:i.register,registerUserMessageHeight:s.register}));return r},_f=e=>e,IZ=e=>{const t=Nk({optional:!0}),[n]=k.useState(()=>NZ(e));return k.useEffect(()=>t?.getState().onScrollToBottom(()=>{n.getState().scrollToBottom()}),[t,n]),k.useEffect(()=>{if(t)return n.subscribe(i=>{t.getState().isAtBottom!==i.isAtBottom&&_f(t).setState({isAtBottom:i.isAtBottom})})},[n,t]),k.useEffect(()=>{const i={turnAnchor:e.turnAnchor??"bottom"};n.getState().turnAnchor!==i.turnAnchor&&_f(n).setState(i)},[n,e.turnAnchor]),n},jB=({children:e,options:t={}})=>{const n=IZ(t),[i]=k.useState(()=>({useThreadViewport:n}));return g.jsx(NB.Provider,{value:i,children:e})},DZ=e=>e._core?.RenderComponent,OZ=({children:e,runtime:t})=>{const n=gi({threads:LZ(t)}),i=DZ(t);return g.jsxs(Ff,{api:n,children:[i&&g.jsx(i,{}),g.jsx(jB,{children:e})]})},jZ=k.memo(OZ),BZ=({index:e,children:t})=>{const n=gi(),i=my({message:yf({source:"thread",query:{type:"index",index:e},get:()=>n.thread().message({index:e})}),composer:yf({source:"message",query:{},get:()=>n.thread().message({index:e}).composer}),on(s,r){const o=()=>n.thread().message({index:e}),{event:a,scope:c}=py(s);return!$h("composer",c)&&!$h("message",c)?n.on(s,r):n.on({scope:"thread",event:a},u=>{u.messageId===o().getState().id&&r(u)})}});return g.jsx(Ff,{api:i,children:t})},FZ=({index:e,children:t})=>{const n=gi(),i=my({part:yf({source:"message",query:{type:"index",index:e},get:()=>n.message().part({index:e})})});return g.jsx(Ff,{api:i,children:t})},UZ=({index:e,children:t})=>{const n=gi(),i=my({attachment:yf({source:"composer",query:{type:"index",index:e},get:()=>n.composer().attachment({index:e})})});return g.jsx(Ff,{api:i,children:t})},zZ=sn(({text:e,isRunning:t})=>{const n=Lt(()=>({type:"text",text:e,status:t?{type:"running"}:{type:"complete"}}),[e,t]);return gr({getState:()=>n,addToolResult:()=>{throw new Error("Not supported")},resumeToolCall:()=>{throw new Error("Not supported")}})}),BB=({text:e,isRunning:t=!1,children:n})=>{const i=Ak(TB(zZ({text:e,isRunning:t}))),s=my({part:yf({source:"root",query:{},get:()=>i.getState().api}),subscribe:i.subscribe});return g.jsx(Ff,{api:s,children:n})};class FB{_core;threads;get threadList(){return this.threads}_thread;constructor(t){this._core=t,this.threads=new yJ(t.threads),this._thread=this.threads.main,this.__internal_bindMethods()}__internal_bindMethods(){this.switchToNewThread=this.switchToNewThread.bind(this),this.switchToThread=this.switchToThread.bind(this),this.registerModelContextProvider=this.registerModelContextProvider.bind(this),this.registerModelConfigProvider=this.registerModelConfigProvider.bind(this),this.reset=this.reset.bind(this)}get thread(){return this._thread}switchToNewThread(){return this._core.threads.switchToNewThread()}switchToThread(t){return this._core.threads.switchToThread(t)}registerModelContextProvider(t){return this._core.registerModelContextProvider(t)}registerModelConfigProvider(t){return this.registerModelContextProvider(t)}reset({initialMessages:t}={}){return this._core.threads.getMainThreadRuntimeCore().import(Tk.fromArray(t??[]))}}const $Z=e=>{const{cloud:t,initialMessages:n,maxSteps:i,adapters:s,unstable_humanToolNames:r,...o}=e;return{localRuntimeOptions:{cloud:t,initialMessages:n,maxSteps:i,adapters:s,unstable_humanToolNames:r},otherOptions:o}},UB=k.createContext(null),qZ=e=>({useSmoothStatus:kB(()=>e)}),HZ=({children:e})=>{const t=zB({optional:!0}),n=gi(),[i]=k.useState(()=>qZ(n.part().getState().status));return t?e:g.jsx(UB.Provider,{value:i,children:e})},VZ=e=>{const t=k.forwardRef((n,i)=>g.jsx(HZ,{children:g.jsx(e,{...n,ref:i})}));return t.displayName=e.displayName,t};function zB(e){const t=k.useContext(UB);if(!e?.optional&&!t)throw new Error("This component must be used within a SmoothContextProvider.");return t}const{useSmoothStatus:WZ,useSmoothStatusStore:GZ}=LB(zB,"useSmoothStatus");class KZ{currentText;setText;animationFrameId=null;lastUpdateTime=Date.now();targetText="";constructor(t,n){this.currentText=t,this.setText=n}start(){this.animationFrameId===null&&(this.lastUpdateTime=Date.now(),this.animate())}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}animate=()=>{const t=Date.now();let i=t-this.lastUpdateTime;const s=this.targetText.length-this.currentText.length,r=Math.min(5,250/s);let o=0;for(;i>=r&&o<s;)o++,i-=r;o!==s?this.animationFrameId=requestAnimationFrame(this.animate):this.animationFrameId=null,o!==0&&(this.currentText=this.targetText.slice(0,this.currentText.length+o),this.lastUpdateTime=t-i,this.setText(this.currentText))}}const sS=Object.freeze({type:"running"}),$B=(e,t=!1)=>{const{text:n}=e,i=st(({message:h})=>h.id),s=k.useRef(i),[r,o]=k.useState(n),a=GZ({optional:!0}),c=ur(h=>{if(o(h),a){const f=r!==h||e.status.type==="running"?sS:e.status;_f(a).setState(f,!0)}});k.useEffect(()=>{if(a){const h=t&&(r!==n||e.status.type==="running")?sS:e.status;_f(a).setState(h,!0)}},[a,t,n,r,e.status]);const[u]=k.useState(new KZ(n,c));return k.useEffect(()=>{if(!t){u.stop();return}if(s.current!==i||!n.startsWith(u.targetText)){s.current=i,c(n),u.currentText=n,u.targetText=n,u.stop();return}u.targetText=n,u.start()},[c,u,i,t,n]),k.useEffect(()=>()=>{u.stop()},[u]),k.useMemo(()=>t?{type:"text",text:r,status:n===r?e.status:sS}:e,[t,r,e,n])},YZ=Object.freeze(Object.defineProperty({__proto__:null,AssistantRuntimeImpl:FB,BaseAssistantRuntimeCore:tB,CompositeContextProvider:wk,DefaultThreadComposerRuntimeCore:iB,MessageRepository:Ek,ThreadRuntimeImpl:gB,fromThreadMessageLike:jf,generateId:uy,getAutoStatus:dy,splitLocalRuntimeOptions:$Z,useSmooth:$B,useSmoothStatus:WZ,useToolInvocations:LJ,withSmoothContextProvider:VZ},Symbol.toStringTag,{value:"Module"}));var XZ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ic=XZ.reduce((e,t)=>{const n=bj(`Primitive.${t}`),i=k.forwardRef((s,r)=>{const{asChild:o,...a}=s,c=o?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(c,{...a,ref:r})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{});const Ik=(e,t,n=[])=>{const i=k.forwardRef((s,r)=>{const o={},a={};Object.keys(s).forEach(u=>{n.includes(u)?o[u]=s[u]:a[u]=s[u]});const c=t(o)??void 0;return g.jsx(ic.button,{type:"button",...a,ref:r,disabled:a.disabled||!c,onClick:fs(a.onClick,c)})});return i.displayName=e,i},qB=k.forwardRef((e,t)=>g.jsx(ic.div,{...e,ref:t}));qB.displayName="AttachmentPrimitive.Root";const QZ=()=>{const e=gi();return k.useCallback(()=>{e.attachment().remove()},[e])},JZ=Ik("AttachmentPrimitive.Remove",QZ),Uf=e=>{const t=k.useRef(void 0);return k.useCallback(i=>{t.current&&t.current(),i&&(t.current=e(i))},[e])},HB=(e,t)=>{const n=k.useCallback(i=>{if(!e)return;const s=e(),r=()=>{const a=t?t(i):i.offsetHeight;s.setHeight(a)},o=new ResizeObserver(r);return o.observe(i),r(),()=>{o.disconnect(),s.unregister()}},[e,t]);return Uf(n)},LL=k.createContext(!1),NL=(e,t)=>{const n=e.match(/^([\d.]+)(em|px|rem)$/);if(!n)return 0;const i=parseFloat(n[1]),s=n[2];if(s==="px")return i;if(s==="em"){const r=parseFloat(getComputedStyle(t).fontSize)||16;return i*r}if(s==="rem"){const r=parseFloat(getComputedStyle(document.documentElement).fontSize)||16;return i*r}return 0},VB=({children:e,fillClampThreshold:t="10em",fillClampOffset:n="6em"})=>{const i=st(({message:c})=>c.isLast&&c.index>=2),s=Nk({optional:!0}),r=k.useContext(LL),o=k.useCallback(c=>{if(!s||r)return;const u=()=>{const h=s.getState();if(h.turnAnchor==="top"&&i){const{viewport:f,inset:m,userMessage:y}=h.height,b=NL(t,c),S=NL(n,c),_=y<=b?y:S,w=Math.max(0,f-m-_);c.style.minHeight=`${w}px`,c.style.flexShrink="0",c.style.transition="min-height 0s"}else c.style.minHeight="",c.style.flexShrink="",c.style.transition=""};return u(),s.subscribe(u)},[s,i,r,t,n]),a=Uf(o);return g.jsx(LL.Provider,{value:!0,children:g.jsx(gk,{ref:a,children:e})})};VB.displayName="ThreadPrimitive.ViewportSlack";const ZZ=()=>{const e=gi(),t=st(()=>e.message()),n=k.useCallback(i=>{const s=()=>{t.setIsHovering(!0)},r=()=>{t.setIsHovering(!1)};return i.addEventListener("mouseenter",s),i.addEventListener("mouseleave",r),i.matches(":hover")&&queueMicrotask(()=>t.setIsHovering(!0)),()=>{i.removeEventListener("mouseenter",s),i.removeEventListener("mouseleave",r),t.setIsHovering(!1)}},[t]);return Uf(n)},eee=()=>{const e=yv(s=>s.turnAnchor),t=yv(s=>s.registerUserMessageHeight),n=st(({thread:s,message:r})=>e==="top"&&r.role==="user"&&r.index===s.messages.length-2&&s.messages.at(-1)?.role==="assistant"),i=k.useCallback(s=>s.offsetHeight,[]);return HB(n?t:null,i)},Sf=k.forwardRef((e,t)=>{const n=ZZ(),i=eee(),s=pr(t,n,i);return g.jsx(VB,{children:g.jsx(ic.div,{...e,ref:s})})});Sf.displayName="MessagePrimitive.Root";const WB=()=>st(({part:t})=>{if(t.type!=="text"&&t.type!=="reasoning")throw new Error("MessagePartText can only be used inside text or reasoning message parts.");return t}),GB=k.forwardRef(({smooth:e=!0,component:t="span",...n},i)=>{const{text:s,status:r}=$B(WB(),e);return g.jsx(t,{"data-status":r.type,...n,ref:i,children:s})});GB.displayName="MessagePartPrimitive.Text";const tee=()=>st(({part:t})=>{if(t.type!=="image")throw new Error("MessagePartImage can only be used inside image message parts.");return t}),KB=k.forwardRef((e,t)=>{const{image:n}=tee();return g.jsx(ic.img,{src:n,...e,ref:t})});KB.displayName="MessagePartPrimitive.Image";const YB=({children:e})=>st(({part:n})=>n.status.type==="running")?e:null;YB.displayName="MessagePartPrimitive.InProgress";const IL=e=>Symbol.iterator in e,DL=e=>"entries"in e,OL=(e,t)=>{const n=e instanceof Map?e:new Map(e.entries()),i=t instanceof Map?t:new Map(t.entries());if(n.size!==i.size)return!1;for(const[s,r]of n)if(!i.has(s)||!Object.is(r,i.get(s)))return!1;return!0},nee=(e,t)=>{const n=e[Symbol.iterator](),i=t[Symbol.iterator]();let s=n.next(),r=i.next();for(;!s.done&&!r.done;){if(!Object.is(s.value,r.value))return!1;s=n.next(),r=i.next()}return!!s.done&&!!r.done};function iee(e,t){return Object.is(e,t)?!0:typeof e!="object"||e===null||typeof t!="object"||t===null||Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?!1:IL(e)&&IL(t)?DL(e)&&DL(t)?OL(e,t):nee(e,t):OL({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})}function see(e){const t=pi.useRef(void 0);return n=>{const i=e(n);return iee(t.current,i)?t.current:t.current=i}}const jL=e=>{let t=-1;return{startGroup:n=>{t===-1&&(t=n)},endGroup:(n,i)=>{t!==-1&&(i.push({type:e,startIndex:t,endIndex:n}),t=-1)},finalize:(n,i)=>{t!==-1&&i.push({type:e,startIndex:t,endIndex:n})}}},ree=e=>{const t=[],n=jL("toolGroup"),i=jL("reasoningGroup");for(let s=0;s<e.length;s++){const r=e[s];r==="tool-call"?(i.endGroup(s-1,t),n.startGroup(s)):r==="reasoning"?(n.endGroup(s-1,t),i.startGroup(s)):(n.endGroup(s-1,t),i.endGroup(s-1,t),t.push({type:"single",index:s}))}return n.finalize(e.length-1,t),i.finalize(e.length-1,t),t},oee=()=>{const e=st(see(t=>t.message.parts.map(n=>n.type)));return k.useMemo(()=>e.length===0?[]:ree(e),[e])},aee=({Fallback:e,...t})=>{const n=st(({tools:i})=>{const s=i.tools[t.toolName]??e;return Array.isArray(s)?s[0]??e:s});return n?g.jsx(n,{...t}):null},To={Text:()=>g.jsxs("p",{style:{whiteSpace:"pre-line"},children:[g.jsx(GB,{}),g.jsx(YB,{children:g.jsx("span",{style:{fontFamily:"revert"},children:" "})})]}),Reasoning:()=>null,Source:()=>null,Image:()=>g.jsx(KB,{}),File:()=>null,Unstable_Audio:()=>null,ToolGroup:({children:e})=>e,ReasoningGroup:({children:e})=>e},lee=({components:{Text:e=To.Text,Reasoning:t=To.Reasoning,Image:n=To.Image,Source:i=To.Source,File:s=To.File,Unstable_Audio:r=To.Unstable_Audio,tools:o={}}={}})=>{const a=gi(),c=st(({part:h})=>h),u=c.type;if(u==="tool-call"){const h=a.part().addToolResult,f=a.part().resumeToolCall;if("Override"in o)return g.jsx(o.Override,{...c,addResult:h,resume:f});const m=o.by_name?.[c.toolName]??o.Fallback;return g.jsx(aee,{...c,Fallback:m,addResult:h,resume:f})}if(c.status?.type==="requires-action")throw new Error("Encountered unexpected requires-action status");switch(u){case"text":return g.jsx(e,{...c});case"reasoning":return g.jsx(t,{...c});case"source":return g.jsx(i,{...c});case"image":return g.jsx(n,{...c});case"file":return g.jsx(s,{...c});case"audio":return g.jsx(r,{...c});case"data":return null;default:const h=u;throw new Error(`Unknown message part type: ${h}`)}},Cg=k.memo(({index:e,components:t})=>g.jsx(FZ,{index:e,children:g.jsx(lee,{components:t})}),(e,t)=>e.index===t.index&&e.components?.Text===t.components?.Text&&e.components?.Reasoning===t.components?.Reasoning&&e.components?.Source===t.components?.Source&&e.components?.Image===t.components?.Image&&e.components?.File===t.components?.File&&e.components?.Unstable_Audio===t.components?.Unstable_Audio&&e.components?.tools===t.components?.tools&&e.components?.ToolGroup===t.components?.ToolGroup&&e.components?.ReasoningGroup===t.components?.ReasoningGroup);Cg.displayName="MessagePrimitive.PartByIndex";const cee=({status:e,component:t})=>g.jsx(BB,{text:"",isRunning:e.type==="running",children:g.jsx(t,{type:"text",text:"",status:e})}),uee=Object.freeze({type:"complete"}),dee=({components:e})=>{const t=st(n=>n.message.status??uee);return e?.Empty?g.jsx(e.Empty,{status:t}):g.jsx(cee,{status:t,component:e?.Text??To.Text})},hee=k.memo(dee,(e,t)=>e.components?.Empty===t.components?.Empty&&e.components?.Text===t.components?.Text),XB=({components:e})=>{const t=st(({message:s})=>s.parts.length),n=oee(),i=k.useMemo(()=>t===0?g.jsx(hee,{components:e}):n.map(s=>{if(s.type==="single")return g.jsx(Cg,{index:s.index,components:e},s.index);if(s.type==="toolGroup"){const r=e?.ToolGroup??To.ToolGroup;return g.jsx(r,{startIndex:s.startIndex,endIndex:s.endIndex,children:Array.from({length:s.endIndex-s.startIndex+1},(o,a)=>g.jsx(Cg,{index:s.startIndex+a,components:e},a))},`tool-${s.startIndex}`)}else{const r=e?.ReasoningGroup??To.ReasoningGroup;return g.jsx(r,{startIndex:s.startIndex,endIndex:s.endIndex,children:Array.from({length:s.endIndex-s.startIndex+1},(o,a)=>g.jsx(Cg,{index:s.startIndex+a,components:e},a))},`reasoning-${s.startIndex}`)}}),[n,e,t]);return g.jsx(g.Fragment,{children:i})};XB.displayName="MessagePrimitive.Parts";const QB=()=>{const e=gi(),t=st(i=>i.thread.isRunning||!i.composer.isEditing||i.composer.isEmpty),n=k.useCallback(()=>{e.composer().send()},[e]);return t?null:n};Ik("ComposerPrimitive.Send",QB);const JB=k.forwardRef(({onSubmit:e,...t},n)=>{const i=QB(),s=r=>{r.preventDefault(),i&&i()};return g.jsx(ic.form,{...t,ref:n,onSubmit:fs(e,s)})});JB.displayName="ComposerPrimitive.Root";function Qx(){return Qx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Qx.apply(null,arguments)}function fee(e,t){if(e==null)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.indexOf(i)!==-1)continue;n[i]=e[i]}return n}var pee=k.useLayoutEffect,mee=function(t){var n=pi.useRef(t);return pee(function(){n.current=t}),n},BL=function(t,n){if(typeof t=="function"){t(n);return}t.current=n},gee=function(t,n){var i=pi.useRef();return pi.useCallback(function(s){t.current=s,i.current&&BL(i.current,null),i.current=n,n&&BL(n,s)},[n])},FL={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},vee=function(t){Object.keys(FL).forEach(function(n){t.style.setProperty(n,FL[n],"important")})},UL=vee,xi=null,zL=function(t,n){var i=t.scrollHeight;return n.sizingStyle.boxSizing==="border-box"?i+n.borderSize:i-n.paddingSize};function yee(e,t,n,i){n===void 0&&(n=1),i===void 0&&(i=1/0),xi||(xi=document.createElement("textarea"),xi.setAttribute("tabindex","-1"),xi.setAttribute("aria-hidden","true"),UL(xi)),xi.parentNode===null&&document.body.appendChild(xi);var s=e.paddingSize,r=e.borderSize,o=e.sizingStyle,a=o.boxSizing;Object.keys(o).forEach(function(m){var y=m;xi.style[y]=o[y]}),UL(xi),xi.value=t;var c=zL(xi,e);xi.value=t,c=zL(xi,e),xi.value="x";var u=xi.scrollHeight-s,h=u*n;a==="border-box"&&(h=h+s+r),c=Math.max(h,c);var f=u*i;return a==="border-box"&&(f=f+s+r),c=Math.min(f,c),[c,u]}var $L=function(){},bee=function(t,n){return t.reduce(function(i,s){return i[s]=n[s],i},{})},_ee=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],See=!!document.documentElement.currentStyle,xee=function(t){var n=window.getComputedStyle(t);if(n===null)return null;var i=bee(_ee,n),s=i.boxSizing;if(s==="")return null;See&&s==="border-box"&&(i.width=parseFloat(i.width)+parseFloat(i.borderRightWidth)+parseFloat(i.borderLeftWidth)+parseFloat(i.paddingRight)+parseFloat(i.paddingLeft)+"px");var r=parseFloat(i.paddingBottom)+parseFloat(i.paddingTop),o=parseFloat(i.borderBottomWidth)+parseFloat(i.borderTopWidth);return{sizingStyle:i,paddingSize:r,borderSize:o}},wee=xee;function Dk(e,t,n){var i=mee(n);k.useLayoutEffect(function(){var s=function(o){return i.current(o)};if(e)return e.addEventListener(t,s),function(){return e.removeEventListener(t,s)}},[])}var Cee=function(t,n){Dk(document.body,"reset",function(i){t.current.form===i.target&&n(i)})},kee=function(t){Dk(window,"resize",t)},Tee=function(t){Dk(document.fonts,"loadingdone",t)},Eee=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],Ree=function(t,n){var i=t.cacheMeasurements,s=t.maxRows,r=t.minRows,o=t.onChange,a=o===void 0?$L:o,c=t.onHeightChange,u=c===void 0?$L:c,h=fee(t,Eee),f=h.value!==void 0,m=k.useRef(null),y=gee(m,n),b=k.useRef(0),S=k.useRef(),_=function(){var R=m.current,E=i&&S.current?S.current:wee(R);if(E){S.current=E;var A=yee(E,R.value||R.placeholder||"x",r,s),T=A[0],L=A[1];b.current!==T&&(b.current=T,R.style.setProperty("height",T+"px","important"),u(T,{rowHeight:L}))}},w=function(R){f||_(),a(R)};return k.useLayoutEffect(_),Cee(m,function(){if(!f){var M=m.current.value;requestAnimationFrame(function(){var R=m.current;R&&M!==R.value&&_()})}}),kee(_),Tee(_),k.createElement("textarea",Qx({},h,{onChange:w,ref:y}))},Mee=k.forwardRef(Ree);const ZB=e=>{const t=ur(e),n=yv(i=>i.onScrollToBottom);k.useEffect(()=>n(t),[n,t])},e3=k.forwardRef(({autoFocus:e=!1,asChild:t,disabled:n,onChange:i,onKeyDown:s,onPaste:r,submitOnEnter:o=!0,cancelOnEscape:a=!0,unstable_focusOnRunStart:c=!0,unstable_focusOnScrollToBottom:u=!0,unstable_focusOnThreadSwitched:h=!0,addAttachmentOnPaste:f=!0,...m},y)=>{const b=gi(),S=st(({composer:P})=>P.isEditing?P.text:""),_=t?gk:Mee,w=st(({thread:P})=>P.isDisabled)||n,M=k.useRef(null),R=pr(y,M);Sj(P=>{if(!a||!M.current?.contains(P.target))return;const I=b.composer();I.getState().canCancel&&(I.cancel(),P.preventDefault())});const E=P=>{w||!o||P.nativeEvent.isComposing||P.key==="Enter"&&P.shiftKey===!1&&(b.thread().getState().isRunning||(P.preventDefault(),M.current?.closest("form")?.requestSubmit()))},A=async P=>{if(!f)return;const I=b.thread().getState().capabilities,N=Array.from(P.clipboardData?.files||[]);if(I.attachments&&N.length>0)try{P.preventDefault(),await Promise.all(N.map(O=>b.composer().addAttachment(O)))}catch(O){console.error("Error adding attachment:",O)}},T=e&&!w,L=k.useCallback(()=>{const P=M.current;!P||!T||(P.focus({preventScroll:!0}),P.setSelectionRange(P.value.length,P.value.length))},[T]);return k.useEffect(()=>L(),[L]),ZB(()=>{b.composer().getState().type==="thread"&&u&&L()}),k.useEffect(()=>{if(!(b.composer().getState().type!=="thread"||!c))return b.on("thread.run-start",L)},[c,L,b]),k.useEffect(()=>{if(!(b.composer().getState().type!=="thread"||!h))return b.on("thread-list-item.switched-to",L)},[h,L,b]),g.jsx(_,{name:"input",value:S,...m,ref:R,disabled:w,onChange:fs(i,P=>{b.composer().getState().isEditing&&Xx(()=>{b.composer().setText(P.target.value)})}),onKeyDown:fs(s,E),onPaste:fs(r,A)})});e3.displayName="ComposerPrimitive.Input";const Aee=({multiple:e=!0}={})=>{const t=st(({composer:s})=>!s.isEditing),n=gi(),i=k.useCallback(()=>{const s=document.createElement("input");s.type="file",s.multiple=e,s.hidden=!0;const r=n.composer().getState().attachmentAccept;r!=="*"&&(s.accept=r),document.body.appendChild(s),s.onchange=o=>{const a=o.target.files;if(a){for(const c of a)n.composer().addAttachment(c);document.body.removeChild(s)}},s.oncancel=()=>{(!s.files||s.files.length===0)&&document.body.removeChild(s)},s.click()},[n,e]);return t?null:i},Pee=Ik("ComposerPrimitive.AddAttachment",Aee,["multiple"]),Lee=(e,t)=>{const n=t.type;switch(n){case"image":return e?.Image??e?.Attachment;case"document":return e?.Document??e?.Attachment;case"file":return e?.File??e?.Attachment;default:const i=n;throw new Error(`Unknown attachment type: ${i}`)}},Nee=({components:e})=>{const t=st(({attachment:i})=>i);if(!t)return null;const n=Lee(e,t);return n?g.jsx(n,{}):null},t3=k.memo(({index:e,components:t})=>g.jsx(UZ,{index:e,children:g.jsx(Nee,{components:t})}),(e,t)=>e.index===t.index&&e.components?.Image===t.components?.Image&&e.components?.Document===t.components?.Document&&e.components?.File===t.components?.File&&e.components?.Attachment===t.components?.Attachment);t3.displayName="ComposerPrimitive.AttachmentByIndex";const n3=({components:e})=>{const t=st(i=>i.composer.attachments.length);return k.useMemo(()=>Array.from({length:t},(i,s)=>g.jsx(t3,{index:s,components:e},s)),[t,e])};n3.displayName="ComposerPrimitive.Attachments";const i3=k.forwardRef((e,t)=>g.jsx(ic.div,{...e,ref:t}));i3.displayName="ThreadPrimitive.Root";const Iee=e=>{const t=ur(e),n=k.useCallback(i=>{const s=new ResizeObserver(()=>{t()}),r=new MutationObserver(()=>{t()});return s.observe(i),r.observe(i,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),()=>{s.disconnect(),r.disconnect()}},[t]);return Uf(n)},Dee=({autoScroll:e,scrollToBottomOnRunStart:t=!0,scrollToBottomOnInitialize:n=!0,scrollToBottomOnThreadSwitch:i=!0})=>{const s=k.useRef(null),r=Nk();e===void 0&&(e=r.getState().turnAnchor!=="top");const o=k.useRef(0),a=k.useRef(null),c=k.useCallback(y=>{const b=s.current;b&&(a.current=y,b.scrollTo({top:b.scrollHeight,behavior:y}))},[]),u=()=>{const y=s.current;if(!y)return;const b=r.getState().isAtBottom,S=Math.abs(y.scrollHeight-y.scrollTop-y.clientHeight)<1||y.scrollHeight<=y.clientHeight;!S&&o.current<y.scrollTop||(S&&(a.current=null),(S||a.current===null)&&S!==b&&_f(r).setState({isAtBottom:S})),o.current=y.scrollTop},h=Iee(()=>{const y=a.current;y?c(y):e&&r.getState().isAtBottom&&c("instant"),u()}),f=Uf(y=>(y.addEventListener("scroll",u),()=>{y.removeEventListener("scroll",u)}));return ZB(({behavior:y})=>{c(y)}),nS("thread.run-start",()=>{t&&(a.current="auto",requestAnimationFrame(()=>{c("auto")}))}),nS("thread.initialize",()=>{n&&(a.current="instant",requestAnimationFrame(()=>{c("instant")}))}),nS("thread-list-item.switched-to",()=>{i&&(a.current="instant",requestAnimationFrame(()=>{c("instant")}))}),pr(h,f,s)},Oee=()=>{const e=yv(n=>n.registerViewport),t=k.useCallback(n=>n.clientHeight,[]);return HB(e,t)},s3=k.forwardRef(({autoScroll:e,scrollToBottomOnRunStart:t,scrollToBottomOnInitialize:n,scrollToBottomOnThreadSwitch:i,children:s,...r},o)=>{const a=Dee({autoScroll:e,scrollToBottomOnRunStart:t,scrollToBottomOnInitialize:n,scrollToBottomOnThreadSwitch:i}),c=Oee(),u=pr(o,a,c);return g.jsx(ic.div,{...r,ref:u,children:s})});s3.displayName="ThreadPrimitive.ViewportScrollable";const r3=k.forwardRef(({turnAnchor:e,...t},n)=>g.jsx(jB,{options:{turnAnchor:e},children:g.jsx(s3,{...t,ref:n})}));r3.displayName="ThreadPrimitive.Viewport";const o3=(e,t)=>e.Message===t.Message&&e.EditComposer===t.EditComposer&&e.UserEditComposer===t.UserEditComposer&&e.AssistantEditComposer===t.AssistantEditComposer&&e.SystemEditComposer===t.SystemEditComposer&&e.UserMessage===t.UserMessage&&e.AssistantMessage===t.AssistantMessage&&e.SystemMessage===t.SystemMessage,jee=()=>null,Bee=(e,t,n)=>{switch(t){case"user":return n?e.UserEditComposer??e.EditComposer??e.UserMessage??e.Message:e.UserMessage??e.Message;case"assistant":return n?e.AssistantEditComposer??e.EditComposer??e.AssistantMessage??e.Message:e.AssistantMessage??e.Message;case"system":return n?e.SystemEditComposer??e.EditComposer??e.SystemMessage??e.Message:e.SystemMessage??jee;default:const i=t;throw new Error(`Unknown message role: ${i}`)}},Fee=({components:e})=>{const t=st(({message:s})=>s.role),n=st(({message:s})=>s.composer.isEditing),i=Bee(e,t,n);return g.jsx(i,{})},a3=k.memo(({index:e,components:t})=>g.jsx(BZ,{index:e,children:g.jsx(Fee,{components:t})}),(e,t)=>e.index===t.index&&o3(e.components,t.components));a3.displayName="ThreadPrimitive.MessageByIndex";const l3=({components:e})=>{const t=st(({thread:i})=>i.messages.length);return k.useMemo(()=>t===0?null:Array.from({length:t},(i,s)=>g.jsx(a3,{index:s,components:e},s)),[t,e])};l3.displayName="ThreadPrimitive.Messages";const Uee=k.memo(l3,(e,t)=>o3(e.components,t.components));function c3(e){if(e.role==="agent"&&e.content.length>0){const t=e.content[0];return typeof t.uuid=="string"?t.uuid:null}return null}function zee(e){if(e.role==="agent"&&e.content.length>0){const t=e.content[0];return typeof t.parentUUID=="string"?t.parentUUID:null}return null}function Jx(e,t,n){const i=[],s=e.orphanMessages.get(t);if(!s)return i;e.orphanMessages.delete(t);for(const r of s){const o=c3(r);o&&e.uuidToSidechainId.set(o,n),i.push({...r,sidechainId:n}),o&&i.push(...Jx(e,o,n))}return i}function $ee(e){const t={promptToTaskId:new Map,uuidToSidechainId:new Map,orphanMessages:new Map},n=[];for(const i of e)if(i.role==="agent")for(const s of i.content){if(s.type!=="tool-call"||s.name!=="Task")continue;const r=s.input;!ye(r)||typeof r.prompt!="string"||t.promptToTaskId.set(r.prompt,i.id)}for(const i of e){if(!i.isSidechain){n.push({...i});continue}const s=c3(i),r=zee(i);let o;if(i.role==="agent")for(const a of i.content){if(a.type!=="sidechain")continue;const c=t.promptToTaskId.get(a.prompt);if(c){o=c;break}}if(o&&s){t.uuidToSidechainId.set(s,o),n.push({...i,sidechainId:o}),n.push(...Jx(t,s,o));continue}if(r){const a=t.uuidToSidechainId.get(r);if(a)s&&t.uuidToSidechainId.set(s,a),n.push({...i,sidechainId:a}),s&&n.push(...Jx(t,s,a));else{const c=t.orphanMessages.get(r)??[];c.push(i),t.orphanMessages.set(r,c)}continue}n.push({...i})}return n}function qee(e){const t=e.match(/^Claude AI usage limit reached\|(\d+)$/);if(!t)return null;const n=Number.parseInt(t[1],10);return Number.isFinite(n)?n:null}function Hee(e){if(e.isSidechain||e.role!=="agent")return null;for(const t of e.content)if(t.type==="text"){const n=qee(t.text);if(n!==null)return{type:"limit-reached",endsAt:n}}return null}function Vee(e){const t=[];let n=null,i=null;for(const s of e){if(s.kind!=="agent-event"){t.push(s),n=null,i=null;continue}const r=s.event;if(r.type==="title-changed"&&typeof r.title=="string"){const a=r.title.trim(),c=`title-changed:${a}`;if(c===n)continue;t.push(s),n=c,i=a;continue}if(r.type==="message"&&typeof r.message=="string"){const a=r.message.trim(),c=`message:${a}`;if(c===n||i&&a===i)continue;t.push(s),n=c,i=null;continue}let o;try{o=`event:${JSON.stringify(r)}`}catch{o=`event:${String(r.type)}`}o!==n&&(t.push(s),n=o,i=null)}return t}function Wee(e){const t=[];for(const n of e){if(n.kind!=="agent-event"){t.push(n);continue}if(n.event.type!=="api-error"){t.push(n);continue}const s=t[t.length-1];s?.kind==="agent-event"&&s.event.type==="api-error"?t[t.length-1]=n:t.push(n)}return t}function Gee(e){const t=new Map,n=e?.completedRequests??null;if(n)for(const[s,r]of Object.entries(n))t.set(s,{toolName:r.tool,input:r.arguments,permission:{id:s,status:r.status,reason:r.reason??void 0,mode:r.mode??void 0,decision:r.decision??void 0,allowedTools:r.allowTools,answers:r.answers,createdAt:r.createdAt??null,completedAt:r.completedAt??null}});const i=e?.requests??null;if(i)for(const[s,r]of Object.entries(i))t.has(s)||t.set(s,{toolName:r.tool,input:r.arguments,permission:{id:s,status:"pending",createdAt:r.createdAt??null}});return t}function Zx(e,t,n,i){const s=t.get(n);if(s){const c=u=>{const h=u.trim().toLowerCase();return h===""||h==="tool"||h==="unknown"};return i.createdAt<s.createdAt&&(s.createdAt=i.createdAt,s.tool.createdAt=i.createdAt),i.permission&&(s.tool.permission={...s.tool.permission,...i.permission},s.tool.state==="running"&&i.permission.status==="pending"&&(s.tool.state="pending")),i.name&&(!c(i.name)||c(s.tool.name))&&(s.tool.name=i.name),i.input!==null&&i.input!==void 0&&(s.tool.input=i.input),i.description!==null&&(s.tool.description=i.description),s}const r=i.permission?.status==="pending"?"pending":i.permission?.status==="denied"||i.permission?.status==="canceled"?"error":"running",o={id:n,name:i.name,state:r,input:i.input,createdAt:i.createdAt,startedAt:r==="running"?i.createdAt:null,completedAt:null,description:i.description,permission:i.permission},a={kind:"tool-call",id:n,localId:i.localId,createdAt:i.createdAt,tool:o,children:[],meta:i.meta};return t.set(n,a),e.push(a),a}function Kee(e){const t=new Set;for(const n of e)if(n.role==="agent")for(const i of n.content)i.type==="tool-call"?t.add(i.id):i.type==="tool-result"&&t.add(i.tool_use_id);return t}function u3(e){return e==="mcp__hapi__change_title"||e==="hapi__change_title"}function d3(e){if(!e||typeof e!="object")return null;const t=e.title;return typeof t=="string"&&t.trim().length>0?t.trim():null}function Yee(e){const t=new Map;for(const n of e)if(n.role==="agent")for(const i of n.content){if(i.type!=="tool-call"||!u3(i.name))continue;const s=d3(i.input);s&&t.set(i.id,s)}return t}const Xee=/<(?:local-command-[a-z-]+|command-(?:name|message|args))>/i,Qee=/<command-name>/i,Jee=/<local-command-stdout>/i;function Zee(e){if(!e||typeof e!="object")return null;const t=e.sentFrom;return typeof t=="string"?t:null}function ete(e){return Xee.test(e)}function tte(e){return Qee.test(e)}function qL(e){return Jee.test(e)}function HL(e,t){return Zee(t)==="cli"&&ete(e)}function VL(e){return{kind:"cli-output",id:e.id,localId:e.localId,createdAt:e.createdAt,text:e.text,source:e.source,meta:e.meta}}function nte(e){const t=[];for(const n of e){if(n.kind!=="cli-output"){t.push(n);continue}const i=t[t.length-1];if(i&&i.kind==="cli-output"&&i.source===n.source&&tte(i.text)&&!qL(i.text)&&qL(n.text)){const s=i.text.endsWith(`
`)||n.text.startsWith(`
`)?"":`
`;t[t.length-1]={...i,text:`${i.text}${s}${n.text}`};continue}t.push(n)}return t}function h3(e,t){const n=[],i=new Map;let s=!1;for(const r of e){if(r.role==="event"){if(r.content.type==="ready"){s=!0;continue}n.push({kind:"agent-event",id:r.id,createdAt:r.createdAt,event:r.content,meta:r.meta});continue}const o=Hee(r);if(o){n.push({kind:"agent-event",id:r.id,createdAt:r.createdAt,event:o,meta:r.meta});continue}if(r.role==="user"){if(HL(r.content.text,r.meta)){n.push(VL({id:r.id,localId:r.localId,createdAt:r.createdAt,text:r.content.text,source:"user",meta:r.meta}));continue}n.push({kind:"user-text",id:r.id,localId:r.localId,createdAt:r.createdAt,text:r.content.text,attachments:r.content.attachments,status:r.status,originalText:r.originalText,meta:r.meta});continue}if(r.role==="agent")for(let a=0;a<r.content.length;a+=1){const c=r.content[a];if(c.type==="text"){if(HL(c.text,r.meta)){n.push(VL({id:`${r.id}:${a}`,localId:r.localId,createdAt:r.createdAt,text:c.text,source:"assistant",meta:r.meta}));continue}n.push({kind:"agent-text",id:`${r.id}:${a}`,localId:r.localId,createdAt:r.createdAt,text:c.text,meta:r.meta});continue}if(c.type==="reasoning"){n.push({kind:"agent-reasoning",id:`${r.id}:${a}`,localId:r.localId,createdAt:r.createdAt,text:c.text,meta:r.meta});continue}if(c.type==="summary"){n.push({kind:"agent-event",id:`${r.id}:${a}`,createdAt:r.createdAt,event:{type:"message",message:c.summary},meta:r.meta});continue}if(c.type==="tool-call"){if(u3(c.name)){const f=t.titleChangesByToolUseId.get(c.id)??d3(c.input);f&&!t.emittedTitleChangeToolUseIds.has(c.id)&&(t.emittedTitleChangeToolUseIds.add(c.id),n.push({kind:"agent-event",id:`${r.id}:${a}`,createdAt:r.createdAt,event:{type:"title-changed",title:f},meta:r.meta}));continue}const u=t.permissionsById.get(c.id)?.permission,h=Zx(n,i,c.id,{createdAt:r.createdAt,localId:r.localId,meta:r.meta,name:c.name,input:c.input,description:c.description,permission:u});if(h.tool.state==="pending"&&(h.tool.state="running",h.tool.startedAt=r.createdAt),c.name==="Task"&&!t.consumedGroupIds.has(r.id)){const f=t.groups.get(r.id)??null;if(f&&f.length>0){t.consumedGroupIds.add(r.id);const m=h3(f,t);s=s||m.hasReadyEvent,h.children=m.blocks}}continue}if(c.type==="tool-result"){const u=t.titleChangesByToolUseId.get(c.tool_use_id)??null;if(u){t.emittedTitleChangeToolUseIds.has(c.tool_use_id)||(t.emittedTitleChangeToolUseIds.add(c.tool_use_id),n.push({kind:"agent-event",id:`${r.id}:${a}`,createdAt:r.createdAt,event:{type:"title-changed",title:u},meta:r.meta}));continue}const h=t.permissionsById.get(c.tool_use_id),f=c.permissions?{id:c.tool_use_id,status:c.permissions.result==="approved"?"approved":"denied",date:c.permissions.date,mode:c.permissions.mode,allowedTools:c.permissions.allowedTools,decision:c.permissions.decision}:void 0,m=f&&h?.permission?{...h.permission,...f,allowedTools:f.allowedTools??h.permission.allowedTools,decision:f.decision??h.permission.decision}:f??h?.permission,y=Zx(n,i,c.tool_use_id,{createdAt:r.createdAt,localId:r.localId,meta:r.meta,name:h?.toolName??"Tool",input:h?.input??null,description:null,permission:m});y.tool.result=c.content,y.tool.completedAt=r.createdAt,y.tool.state=c.is_error?"error":"completed";continue}c.type==="sidechain"&&n.push({kind:"user-text",id:`${r.id}:${a}`,localId:null,createdAt:r.createdAt,text:c.prompt})}}return{blocks:nte(n),toolBlocksById:i,hasReadyEvent:s}}function ite(e){return(e.cache_creation_input_tokens||0)+(e.cache_read_input_tokens||0)+e.input_tokens}function ste(e,t){const n=Gee(t),i=Kee(e),s=Yee(e),r=$ee(e),o=new Map,a=[];for(const S of r)if(S.sidechainId){const _=o.get(S.sidechainId)??[];_.push(S),o.set(S.sidechainId,_)}else a.push(S);const f=h3(a,{permissionsById:n,groups:o,consumedGroupIds:new Set,titleChangesByToolUseId:s,emittedTitleChangeToolUseIds:new Set});let m=f.hasReadyEvent;const y=e.length>0?Math.min(...e.map(S=>S.createdAt)):null;for(const[S,_]of n){if(i.has(S)||f.toolBlocksById.has(S))continue;const w=_.permission.createdAt??Date.now();if(y!==null&&w<y)continue;const M=Zx(f.blocks,f.toolBlocksById,S,{createdAt:w,localId:null,name:_.toolName,input:_.input,description:null,permission:_.permission});_.permission.status==="approved"?(M.tool.state="completed",M.tool.completedAt=_.permission.completedAt??w,M.tool.result===void 0&&(M.tool.result="Approved")):(_.permission.status==="denied"||_.permission.status==="canceled")&&(M.tool.state="error",M.tool.completedAt=_.permission.completedAt??w,M.tool.result===void 0&&_.permission.reason&&(M.tool.result={error:_.permission.reason}))}let b=null;for(let S=e.length-1;S>=0;S--){const _=e[S];if(_.usage){b={inputTokens:_.usage.input_tokens,outputTokens:_.usage.output_tokens,cacheCreation:_.usage.cache_creation_input_tokens??0,cacheRead:_.usage.cache_read_input_tokens??0,contextSize:ite(_.usage),timestamp:_.createdAt};break}}return{blocks:Vee(Wee(f.blocks)),hasReadyEvent:m,latestUsage:b}}function f3(e,t){for(const n of e)t.set(n.id,n),n.kind==="tool-call"&&f3(n.children,t)}function p3(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0}function WL(e){return Array.isArray(e)?e:e.answers??[]}function rte(e,t){if(e===t)return!0;if(!e||!t)return!1;const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;n.sort(),i.sort();for(let s=0;s<n.length;s+=1){const r=n[s];if(r!==i[s])return!1;const o=e[r],a=t[r];if(!p3(WL(o),WL(a)))return!1}return!0}function ote(e,t){return e===t?!0:!e||!t?!1:e.id===t.id&&e.status===t.status&&e.reason===t.reason&&e.mode===t.mode&&e.decision===t.decision&&e.date===t.date&&e.createdAt===t.createdAt&&e.completedAt===t.completedAt&&p3(e.allowedTools,t.allowedTools)&&rte(e.answers,t.answers)}function GL(e){switch(e.type){case"switch":return`switch:${e.mode}`;case"message":return`message:${e.message}`;case"title-changed":return`title:${e.title}`;case"limit-reached":return`limit:${e.endsAt}`;case"ready":return"ready";default:try{return JSON.stringify(e)}catch{return e.type}}}function ate(e,t){return e===t?!0:GL(e)===GL(t)}function lte(e,t){return e.text===t.text&&e.status===t.status&&e.originalText===t.originalText&&e.localId===t.localId&&e.createdAt===t.createdAt&&e.meta===t.meta}function cte(e,t){return e.text===t.text&&e.localId===t.localId&&e.createdAt===t.createdAt&&e.meta===t.meta}function ute(e,t){return e.text===t.text&&e.localId===t.localId&&e.createdAt===t.createdAt&&e.meta===t.meta}function dte(e,t){return e.text===t.text&&e.localId===t.localId&&e.createdAt===t.createdAt&&e.source===t.source&&e.meta===t.meta}function hte(e,t){return e.createdAt===t.createdAt&&e.meta===t.meta&&ate(e.event,t.event)}function fte(e,t,n){return n?e.localId===t.localId&&e.createdAt===t.createdAt&&e.meta===t.meta&&e.tool.id===t.tool.id&&e.tool.name===t.tool.name&&e.tool.state===t.tool.state&&e.tool.input===t.tool.input&&e.tool.result===t.tool.result&&e.tool.description===t.tool.description&&e.tool.createdAt===t.tool.createdAt&&e.tool.startedAt===t.tool.startedAt&&e.tool.completedAt===t.tool.completedAt&&ote(e.tool.permission,t.tool.permission):!1}function m3(e,t){let n=!1;const i=e.map(s=>{const r=pte(s,t);return r!==s&&(n=!0),r});return n?i:e}function pte(e,t){const n=t.get(e.id);if(e.kind==="tool-call"){const s=m3(e.children,t),r=s===e.children?e:{...e,children:s};if(n&&n.kind==="tool-call"){const o=n.children.length===s.length&&n.children.every((a,c)=>a===s[c]);if(fte(n,r,o))return n}return r}if(!n||n.kind!==e.kind)return e;if(e.kind==="user-text"){const s=n;return lte(s,e)?s:e}if(e.kind==="agent-text"){const s=n;return cte(s,e)?s:e}if(e.kind==="cli-output"){const s=n;return dte(s,e)?s:e}if(e.kind==="agent-reasoning"){const s=n;return ute(s,e)?s:e}const i=n;return hte(i,e)?i:e}function mte(e,t){const n=m3(e,t),i=new Map;return f3(n,i),{blocks:n,byId:i}}const g3=[`
`,",","(",")","[","]","{","}","<",">",";","!","?","."];function gte(e,t,n){let i=t.start-1,s=-1,r=!1,o=-1;for(;i>=0;){const a=e.charAt(i);if(a===" "){if(r)return o;if(s>=0)return s+1;s=i,i--}else{if(n.includes(a)&&(i===0||e.charAt(i-1)===" "||e.charAt(i-1)===`
`))return a==="@"&&(r=!0,o=i),i;if(g3.includes(a))return r?o:i+1;i--}}return r?o:(s>=0?s:i)+1}function vte(e,t,n){let i=t,s=!1;for(n!==void 0&&n>=0&&n<e.length&&(s=e.charAt(n)==="@");i<e.length;){const r=e.charAt(i);if(s&&(r==="/"||r===".")){i++;continue}if(r===" "||g3.includes(r))break;i++}return i}function v3(e,t,n=["@","/"]){if(t.start!==t.end||t.start===0)return;const i=gte(e,t,n),s=e.substring(i,t.end);if(!s.endsWith(" ")&&s.length>0){const r=s.charAt(0);if(n.includes(r)){const o=vte(e,t.end,i),a=e.substring(i,o);return s.length===1&&a.length===1?{word:a,activeWord:s,offset:i,length:a.length,activeLength:s.length,endOffset:o}:{word:a,activeWord:s,offset:i,length:a.length,activeLength:s.length,endOffset:o}}}}function yte(e,t,n=["@","/"]){return k.useMemo(()=>{const i=v3(e,t,n);return i?i.activeWord:null},[e,t.start,t.end,n])}class bte{constructor(t){this.hasValue=!1,this.processing=!1,this.stopped=!1,this.command=t}setValue(t){this.stopped&&(this.stopped=!1),this.latestValue=t,this.hasValue=!0,this.processing||(this.processing=!0,this.doSync())}stop(){this.stopped=!0}async doSync(){for(;this.hasValue&&!this.stopped;){const t=this.latestValue;this.hasValue=!1;try{await this.command(t)}catch(n){console.error("ValueSync error:",n)}}this.processing=!1}}function y3(e,t,n={}){const{clampSelection:i=!0,autoSelectFirst:s=!0,wrapAround:r=!0,allowEmptyQuery:o=!1}=n,[a,c]=k.useState({suggestions:[],selected:-1}),u=k.useCallback(()=>{c(b=>b.suggestions.length===0?b:b.selected<=0?r?{...b,selected:b.suggestions.length-1}:{...b,selected:0}:{...b,selected:b.selected-1})},[r]),h=k.useCallback(()=>{c(b=>b.suggestions.length===0?b:b.selected>=b.suggestions.length-1?r?{...b,selected:0}:{...b,selected:b.suggestions.length-1}:b.selected<0?{...b,selected:0}:{...b,selected:b.selected+1})},[r]),f=k.useCallback(()=>{c({suggestions:[],selected:-1})},[]),m=k.useRef(t);m.current=t;const y=k.useRef(null);return k.useEffect(()=>{const b=new bte(async S=>{if(S===null||!o&&S==="")return;const _=await m.current(S);c(w=>{if(i){let M=w.selected;return _.length===0?M=-1:s&&w.suggestions.length===0?M=0:w.selected>=_.length?M=_.length-1:w.selected<0&&_.length>0&&s&&(M=0),{suggestions:_,selected:M}}else{if(w.selected>=0&&w.selected<w.suggestions.length){const R=w.suggestions[w.selected].key,E=_.findIndex(A=>A.key===R);if(E!==-1)return{suggestions:_,selected:E}}const M=Math.min(w.selected,_.length-1);return{suggestions:_,selected:M<0&&_.length>0&&s?0:M}}})});return y.current=b,()=>{b.stop(),y.current===b&&(y.current=null)}},[i,s,o]),k.useEffect(()=>{y.current?.setValue(e)},[e,t,i,s,o]),e===null||!o&&e===""?[[],-1,u,h,f]:[a.suggestions,a.selected,u,h,f]}function _te(e,t,n,i=["@","/"],s=!0){const r=v3(e,t,i);if(!r){const f=e.substring(0,t.start),m=e.substring(t.end),y=s?n+" ":n;return{text:f+y+m,cursorPosition:t.start+y.length}}const o=e.substring(0,r.offset),a=e.substring(r.endOffset);let c=n;s&&(a.length===0||a[0]!==" ")&&(c+=" ");const u=o+c+a,h=r.offset+c.length;return{text:u,cursorPosition:h}}function bv(e){return e==="codex"||e==="gemini"||e==="opencode"}function Ste(e){return e==="claude"}function xte(e){return Ste(e)||bv(e)}const b3="hapi-recent-skills",wte=200;function Cte(e){try{return JSON.parse(e)}catch{return null}}function _3(){if(typeof window>"u")return{};try{const e=localStorage.getItem(b3);if(!e)return{};const t=Cte(e);if(!t||typeof t!="object")return{};const n=t,i={};for(const[s,r]of Object.entries(n))typeof s!="string"||s.trim().length===0||typeof r!="number"||!Number.isFinite(r)||(i[s]=r);return i}catch{return{}}}function kte(e){const t=e.trim();if(t&&!(typeof window>"u"))try{const n=_3();n[t]=Date.now();const i=Object.entries(n).sort((r,o)=>o[1]-r[1]).slice(0,wte),s=Object.fromEntries(i);localStorage.setItem(b3,JSON.stringify(s))}catch{}}const ew=k.memo(function(t){const{children:n,maxHeight:i=240}=t;return g.jsx("div",{className:"overflow-hidden rounded-xl border border-[var(--app-divider)] bg-[var(--app-bg)] shadow-lg",style:{maxHeight:i},children:g.jsx("div",{className:"overflow-y-auto",style:{maxHeight:i},children:n})})}),S3=k.memo(function(t){const{suggestions:n,selectedIndex:i,onSelect:s}=t,r=k.useRef(null);return k.useEffect(()=>{if(i<0||i>=n.length)return;const o=r.current;if(!o)return;o.querySelector(`[data-suggestion-index="${i}"]`)?.scrollIntoView({block:"nearest"})},[i,n]),n.length===0?null:g.jsx("div",{className:"py-1",ref:r,children:n.map((o,a)=>g.jsxs("button",{type:"button","data-suggestion-index":a,className:`flex w-full cursor-pointer flex-col items-start gap-0.5 px-3 py-2 text-left text-sm transition-colors ${a===i?"bg-[var(--app-button)] text-[var(--app-button-text)]":"text-[var(--app-fg)] hover:bg-[var(--app-secondary-bg)]"}`,onClick:()=>s(a),onMouseDown:c=>c.preventDefault(),children:[g.jsx("span",{className:"w-full font-medium",children:o.label}),o.description&&g.jsx("span",{className:`w-full min-h-[2.25rem] text-xs leading-snug line-clamp-2 ${a===i?"opacity-80":"text-[var(--app-hint)]"}`,children:o.description})]},o.key))})}),Tte=1e4,Ete={default:2e5,sonnet:2e5,opus:2e5};function Rte(e){const n=Ete[e??"default"];return n?Math.max(1,n-Tte):null}const KL=["Accomplishing","Actioning","Actualizing","Baking","Booping","Brewing","Calculating","Cerebrating","Channelling","Churning","Clauding","Coalescing","Cogitating","Computing","Combobulating","Concocting","Conjuring","Considering","Contemplating","Cooking","Crafting","Creating","Crunching","Deciphering","Deliberating","Determining","Discombobulating","Divining","Doing","Effecting","Elucidating","Enchanting","Envisioning","Finagling","Flibbertigibbeting","Forging","Forming","Frolicking","Generating","Germinating","Hatching","Herding","Honking","Ideating","Imagining","Incubating","Inferring","Manifesting","Marinating","Meandering","Moseying","Mulling","Mustering","Musing","Noodling","Percolating","Perusing","Philosophising","Pontificating","Pondering","Processing","Puttering","Puzzling","Reticulating","Ruminating","Scheming","Schlepping","Shimmying","Simmering","Smooshing","Spelunking","Spinning","Stewing","Sussing","Synthesizing","Thinking","Tinkering","Transmuting","Unfurling","Unravelling","Vibing","Wandering","Whirring","Wibbling","Wizarding","Working","Wrangling"],Mte={neutral:"text-[var(--app-hint)]",info:"text-blue-500",warning:"text-amber-500",danger:"text-red-500"};function Ate(e,t,n,i,s){const r=n?.requests&&Object.keys(n.requests).length>0;return i==="connecting"?{text:s("voice.connecting"),color:"text-[#007AFF]",dotColor:"bg-[#007AFF]",isPulsing:!0}:e?r?{text:s("misc.permissionRequired"),color:"text-[#FF9500]",dotColor:"bg-[#FF9500]",isPulsing:!0}:t?{text:KL[Math.floor(Math.random()*KL.length)].toLowerCase()+"",color:"text-[#007AFF]",dotColor:"bg-[#007AFF]",isPulsing:!0}:{text:s("misc.online"),color:"text-[#34C759]",dotColor:"bg-[#34C759]",isPulsing:!1}:{text:s("misc.offline"),color:"text-[#999]",dotColor:"bg-[#999]",isPulsing:!1}}function Pte(e,t,n){const i=e/t*100,s=Math.max(0,100-i),r=Math.round(s);return s<=5?{text:n("misc.percentLeft",{percent:r}),color:"text-red-500"}:s<=10?{text:n("misc.percentLeft",{percent:r}),color:"text-amber-500"}:{text:n("misc.percentLeft",{percent:r}),color:"text-[var(--app-hint)]"}}function Lte(e){const{t}=rt(),n=k.useMemo(()=>Ate(e.active,e.thinking,e.agentState,e.voiceStatus,t),[e.active,e.thinking,e.agentState,e.voiceStatus,t]),i=k.useMemo(()=>{if(e.contextSize===void 0)return null;const u=Rte(e.modelMode);return u?Pte(e.contextSize,u,t):null},[e.contextSize,e.modelMode,t]),s=e.permissionMode,r=s&&s!=="default"&&BD(s,e.agentFlavor)?s:null,o=r?DD(r):null,a=r?OD(r):null,c=a?Mte[a]:"text-[var(--app-hint)]";return g.jsxs("div",{className:"flex items-center justify-between px-2 pb-1",children:[g.jsxs("div",{className:"flex items-baseline gap-3",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx("span",{className:`h-2 w-2 rounded-full ${n.dotColor} ${n.isPulsing?"animate-pulse":""}`}),g.jsx("span",{className:`text-xs ${n.color}`,children:n.text})]}),i?g.jsx("span",{className:`text-[10px] ${i.color}`,children:i.text}):null]}),r?g.jsx("span",{className:`text-xs ${c}`,children:o}):null]})}function Nte(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("path",{d:"M12 6v12"}),g.jsx("path",{d:"M8 9v6"}),g.jsx("path",{d:"M16 9v6"}),g.jsx("path",{d:"M4 11v2"}),g.jsx("path",{d:"M20 11v2"})]})}function Ite(e){return e.muted?g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),g.jsx("line",{x1:"22",y1:"9",x2:"16",y2:"15"}),g.jsx("line",{x1:"16",y1:"9",x2:"22",y2:"15"})]}):g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),g.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),g.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]})}function Dte(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("circle",{cx:"12",cy:"12",r:"3"}),g.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}function Ote(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),g.jsx("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"})]})}function jte(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2",ry:"2"}),g.jsx("polyline",{points:"7 9 10 12 7 15"}),g.jsx("line",{x1:"12",y1:"15",x2:"17",y2:"15"})]})}function Bte(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:g.jsx("path",{d:"M21.44 11.05l-8.49 8.49a5.5 5.5 0 0 1-7.78-7.78l8.49-8.49a3.5 3.5 0 0 1 4.95 4.95l-8.49 8.49a1.5 1.5 0 0 1-2.12-2.12l7.78-7.78"})})}function Fte(e){return e.spinning?g.jsxs("svg",{className:"animate-spin",xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[g.jsx("circle",{cx:"12",cy:"12",r:"10",strokeOpacity:"0.25"}),g.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",strokeOpacity:"0.75"})]}):g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 16 16",fill:"currentColor",children:g.jsx("path",{d:"M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4-2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-4Z"})})}function YL(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),g.jsx("polyline",{points:"5 12 12 5 19 12"})]})}function Ute(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:g.jsx("rect",{x:"6",y:"6",width:"12",height:"12",rx:"2"})})}function zte(){return g.jsxs("svg",{className:"animate-spin",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[g.jsx("circle",{cx:"12",cy:"12",r:"10",strokeOpacity:"0.25"}),g.jsx("path",{d:"M12 2a10 10 0 0 1 10 10",strokeOpacity:"0.75"})]})}function $te(e){const{t}=rt(),n=e.voiceStatus==="connecting",i=e.voiceStatus==="connected",s=n||i,r=e.canSend,o=()=>{s?e.onVoiceToggle():r?e.onSend():e.voiceEnabled&&e.onVoiceToggle()};let a,c,u;n?(a=g.jsx(zte,{}),c="bg-black text-white",u=t("voice.connecting")):i?(a=g.jsx(Ute,{}),c="bg-black text-white",u=t("composer.stop")):r?(a=g.jsx(YL,{}),c="bg-black text-white",u=t("composer.send")):e.voiceEnabled?(a=g.jsx(Nte,{}),c="bg-black text-white",u=t("composer.voice")):(a=g.jsx(YL,{}),c="bg-[#C0C0C0] text-white",u=t("composer.send"));const h=e.controlsDisabled||!r&&!e.voiceEnabled&&!s;return g.jsx("button",{type:"button",onClick:o,disabled:h,"aria-label":u,title:u,className:`flex h-8 w-8 items-center justify-center rounded-full transition-colors disabled:cursor-not-allowed disabled:opacity-50 ${c}`,children:a})}function qte(e){const{t}=rt(),n=e.voiceStatus==="connected";return g.jsxs("div",{className:"flex items-center justify-between px-2 pb-2",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Pee,{"aria-label":t("composer.attach"),title:t("composer.attach"),disabled:e.controlsDisabled,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-fg)]/60 transition-colors hover:bg-[var(--app-bg)] hover:text-[var(--app-fg)] disabled:cursor-not-allowed disabled:opacity-50",children:g.jsx(Bte,{})}),e.showSettingsButton?g.jsx("button",{type:"button","aria-label":t("composer.settings"),title:t("composer.settings"),className:"settings-button flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-fg)]/60 transition-colors hover:bg-[var(--app-bg)] hover:text-[var(--app-fg)]",onClick:e.onSettingsToggle,disabled:e.controlsDisabled,children:g.jsx(Dte,{})}):null,e.showTerminalButton?g.jsx("button",{type:"button","aria-label":t("composer.terminal"),title:t("composer.terminal"),className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-fg)]/60 transition-colors hover:bg-[var(--app-bg)] hover:text-emerald-500 disabled:cursor-not-allowed disabled:opacity-50",onClick:e.onTerminal,disabled:e.terminalDisabled,children:g.jsx(jte,{})}):null,e.showAbortButton?g.jsx("button",{type:"button","aria-label":t("composer.abort"),title:t("composer.abort"),disabled:e.abortDisabled,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-fg)]/60 transition-colors hover:bg-[var(--app-bg)] hover:text-red-500 disabled:cursor-not-allowed disabled:opacity-50",onClick:e.onAbort,children:g.jsx(Fte,{spinning:e.isAborting})}):null,e.showSwitchButton?g.jsx("button",{type:"button","aria-label":t("composer.switchRemote"),title:t("composer.switchRemote"),disabled:e.switchDisabled,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-fg)]/60 transition-colors hover:bg-[var(--app-bg)] hover:text-blue-500 disabled:cursor-not-allowed disabled:opacity-50",onClick:e.onSwitch,children:g.jsx(Ote,{})}):null,n&&e.onVoiceMicToggle?g.jsx("button",{type:"button","aria-label":e.voiceMicMuted?t("voice.unmute"):t("voice.mute"),title:e.voiceMicMuted?t("voice.unmute"):t("voice.mute"),className:`flex h-8 w-8 items-center justify-center rounded-full transition-colors ${e.voiceMicMuted?"bg-gray-200 text-gray-600 hover:bg-gray-300":"text-[var(--app-fg)]/60 hover:bg-[var(--app-bg)] hover:text-[var(--app-fg)]"}`,onClick:e.onVoiceMicToggle,children:g.jsx(Ite,{muted:e.voiceMicMuted})}):null]}),g.jsx($te,{canSend:e.canSend,voiceStatus:e.voiceStatus,voiceEnabled:e.voiceEnabled,controlsDisabled:e.controlsDisabled,onSend:e.onSend,onVoiceToggle:e.onVoiceToggle})]})}function Hte(){return g.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 16 16",fill:"none",children:[g.jsx("circle",{cx:"8",cy:"8",r:"6",stroke:"currentColor",strokeWidth:"1.5"}),g.jsx("path",{d:"M8 5v4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),g.jsx("circle",{cx:"8",cy:"11",r:"0.75",fill:"currentColor"})]})}function Vte(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("line",{x1:"3",y1:"3",x2:"9",y2:"9"}),g.jsx("line",{x1:"9",y1:"3",x2:"3",y2:"9"})]})}function Wte(){const{name:e,status:t}=gZ(),n=t.type==="running",i=t.type==="incomplete";return g.jsxs(qB,{className:"flex items-center gap-2 rounded-lg bg-[var(--app-subtle-bg)] px-3 py-2 text-base text-[var(--app-fg)]",children:[n?g.jsx(Bo,{size:"sm",label:null,className:"text-[var(--app-hint)]"}):null,i?g.jsx("span",{className:"text-red-500",children:g.jsx(Hte,{})}):null,g.jsx("span",{className:"max-w-[150px] truncate",children:e}),g.jsx(JZ,{className:"ml-auto flex h-5 w-5 items-center justify-center rounded text-[var(--app-hint)] transition-colors hover:text-[var(--app-fg)]","aria-label":"Remove attachment",title:"Remove attachment",children:g.jsx(Vte,{})})]})}const Gte=async()=>[];function Kte(e){const{t}=rt(),{disabled:n=!1,permissionMode:i,modelMode:s,active:r=!0,allowSendWhenInactive:o=!1,thinking:a=!1,agentState:c,contextSize:u,controlledByUser:h=!1,agentFlavor:f,onPermissionModeChange:m,onModelModeChange:y,onSwitchToRemote:b,onTerminal:S,autocompletePrefixes:_=["@","/","$"],autocompleteSuggestions:w=Gte,voiceStatus:M="disconnected",voiceMicMuted:R=!1,onVoiceToggle:E,onVoiceMicToggle:A}=e,T=i??"default",L=s??"default",P=gi(),I=st(({composer:Ee})=>Ee.text),N=st(({composer:Ee})=>Ee.attachments),O=st(({thread:Ee})=>Ee.isRunning),j=st(({thread:Ee})=>Ee.isDisabled),$=n||!r&&!o||j,H=I.trim().length>0,B=N.length>0,W=!B||N.every(Ee=>{if(Ee.status.type==="complete")return!0;if(Ee.status.type!=="requires-action")return!1;const Xe=Ee.path;return typeof Xe=="string"&&Xe.length>0}),q=(H||B)&&W&&!$&&!O,[ne,z]=k.useState({text:"",selection:{start:0,end:0}}),[G,J]=k.useState(!1),[U,re]=k.useState(!1),[de,ce]=k.useState(!1),[ae,be]=k.useState(!1),Ce=k.useRef(null),qe=k.useRef(h);k.useEffect(()=>{z(Ee=>{if(Ee.text===I)return Ee;const Xe=I.length;return{text:I,selection:{start:Xe,end:Xe}}})},[I]),k.useEffect(()=>{qe.current===!0&&h===!1&&be(!0),h&&be(!1),qe.current=h},[h]);const{haptic:dt,isTouch:yt}=Yr(),{isStandalone:He,isIOS:We}=Zj(),Fn=We&&He?"pb-0":"pb-3",li=yte(ne.text,ne.selection,_),[Be,ot,De,Ge,Ze]=y3(li,w,{clampSelection:!0,wrapAround:!0}),ve=k.useCallback((Ee="light")=>{Ee==="light"?dt.impact("light"):Ee==="success"?dt.notification("success"):dt.notification("error")},[dt]),Me=k.useCallback(Ee=>{const Xe=Be[Ee];if(!Xe||!Ce.current)return;Xe.text.startsWith("$")&&kte(Xe.text.slice(1));let Yi=Xe.text,_i=!0;f==="codex"&&Xe.source==="user"&&Xe.content&&(Yi=Xe.content,_i=!1);const Hs=_te(ne.text,ne.selection,Yi,_,_i);P.composer().setText(Hs.text),z({text:Hs.text,selection:{start:Hs.cursorPosition,end:Hs.cursorPosition}}),setTimeout(()=>{const Ya=Ce.current;if(Ya){Ya.setSelectionRange(Hs.cursorPosition,Hs.cursorPosition);try{Ya.focus({preventScroll:!0})}catch{Ya.focus()}}},0),ve("light")},[P,Be,ne,_,ve,f]),At=$||U||!O,se=$||de||!h,Se=!!(h&&b),Oe=!!S;k.useEffect(()=>{U&&(O||re(!1))},[U,O]),k.useEffect(()=>{de&&(h||ce(!1))},[de,h]);const $e=k.useCallback(()=>{At||(ve("error"),re(!0),P.thread().cancelRun())},[At,P,ve]),Ke=k.useCallback(async()=>{if(!(se||!b)){ve("light"),ce(!0);try{await b()}catch{ce(!1)}}},[se,b,ve]),it=k.useMemo(()=>CH(f),[f]),Nt=k.useMemo(()=>it.map(Ee=>Ee.mode),[it]),hn=k.useCallback(Ee=>{const Xe=Ee.key;if(!Ee.nativeEvent.isComposing){if(Xe==="Enter"&&Ee.shiftKey){if(Ee.preventDefault(),!q)return;P.composer().send(),be(!1);return}if(Be.length>0){if(Xe==="ArrowUp"){Ee.preventDefault(),De();return}if(Xe==="ArrowDown"){Ee.preventDefault(),Ge();return}if((Xe==="Enter"||Xe==="Tab")&&!Ee.shiftKey){Ee.preventDefault();const Yi=ot>=0?ot:0;Me(Yi);return}if(Xe==="Escape"){Ee.preventDefault(),Ze();return}}if(Xe==="Escape"&&O){Ee.preventDefault(),$e();return}if(Xe==="Tab"&&Ee.shiftKey&&m&&Nt.length>0){Ee.preventDefault();const _i=(Nt.indexOf(T)+1)%Nt.length,Hs=Nt[_i]??"default";m(Hs),ve("light")}}},[Be,ot,De,Ge,Ze,Me,O,$e,m,T,Nt,q,P,ve]);k.useEffect(()=>{const Ee=Xe=>{if(Xe.key==="m"&&(Xe.metaKey||Xe.ctrlKey)&&y&&!bv(f)){Xe.preventDefault();const _i=(gm.indexOf(L)+1)%gm.length;y(gm[_i]),ve("light")}};return window.addEventListener("keydown",Ee),()=>window.removeEventListener("keydown",Ee)},[L,y,ve,f]);const Vt=k.useCallback(Ee=>{const Xe={start:Ee.target.selectionStart,end:Ee.target.selectionEnd};z({text:Ee.target.value,selection:Xe})},[]),fn=k.useCallback(Ee=>{const Xe=Ee.target;z(Yi=>({...Yi,selection:{start:Xe.selectionStart,end:Xe.selectionEnd}}))},[]),Tt=k.useCallback(async Ee=>{const Yi=Array.from(Ee.clipboardData?.files||[]).filter(_i=>_i.type.startsWith("image/"));if(Yi.length!==0){Ee.preventDefault();try{for(const _i of Yi)await P.composer().addAttachment(_i)}catch(_i){console.error("Error adding pasted image:",_i)}}},[P]),yi=k.useCallback(()=>{ve("light"),J(Ee=>!Ee)},[ve]),bi=k.useCallback(Ee=>{if(Ee&&!W){Ee.preventDefault();return}be(!1)},[W]),ac=k.useCallback(Ee=>{!m||$||(m(Ee),J(!1),ve("light"))},[m,$,ve]),$s=k.useCallback(Ee=>{!y||$||(y(Ee),J(!1),ve("light"))},[y,$,ve]),Gi=!!(m&&it.length>0),Ki=!!(y&&!bv(f)),qs=!!(Gi||Ki),lc=!0,Ka=!!E,Dy=k.useCallback(()=>{P.composer().send()},[P]),Jf=k.useMemo(()=>G&&(Gi||Ki)?g.jsx("div",{className:"absolute bottom-[100%] mb-2 w-full",children:g.jsxs(ew,{maxHeight:320,children:[Gi?g.jsxs("div",{className:"py-2",children:[g.jsx("div",{className:"px-3 pb-1 text-xs font-semibold text-[var(--app-hint)]",children:t("misc.permissionMode")}),it.map(Ee=>g.jsxs("button",{type:"button",disabled:$,className:`flex w-full items-center gap-2 px-3 py-2 text-left text-sm transition-colors ${$?"cursor-not-allowed opacity-50":"cursor-pointer hover:bg-[var(--app-secondary-bg)]"}`,onClick:()=>ac(Ee.mode),onMouseDown:Xe=>Xe.preventDefault(),children:[g.jsx("div",{className:`flex h-4 w-4 items-center justify-center rounded-full border-2 ${T===Ee.mode?"border-[var(--app-link)]":"border-[var(--app-hint)]"}`,children:T===Ee.mode&&g.jsx("div",{className:"h-2 w-2 rounded-full bg-[var(--app-link)]"})}),g.jsx("span",{className:T===Ee.mode?"text-[var(--app-link)]":"",children:Ee.label})]},Ee.mode))]}):null,Gi&&Ki?g.jsx("div",{className:"mx-3 h-px bg-[var(--app-divider)]"}):null,Ki?g.jsxs("div",{className:"py-2",children:[g.jsx("div",{className:"px-3 pb-1 text-xs font-semibold text-[var(--app-hint)]",children:t("misc.model")}),gm.map(Ee=>g.jsxs("button",{type:"button",disabled:$,className:`flex w-full items-center gap-2 px-3 py-2 text-left text-sm transition-colors ${$?"cursor-not-allowed opacity-50":"cursor-pointer hover:bg-[var(--app-secondary-bg)]"}`,onClick:()=>$s(Ee),onMouseDown:Xe=>Xe.preventDefault(),children:[g.jsx("div",{className:`flex h-4 w-4 items-center justify-center rounded-full border-2 ${L===Ee?"border-[var(--app-link)]":"border-[var(--app-hint)]"}`,children:L===Ee&&g.jsx("div",{className:"h-2 w-2 rounded-full bg-[var(--app-link)]"})}),g.jsx("span",{className:L===Ee?"text-[var(--app-link)]":"",children:wH[Ee]})]},Ee))]}):null]})}):Be.length>0?g.jsx("div",{className:"absolute bottom-[100%] mb-2 w-full",children:g.jsx(ew,{children:g.jsx(S3,{suggestions:Be,selectedIndex:ot,onSelect:Ee=>Me(Ee)})})}):null,[G,Gi,Ki,Be,ot,$,T,L,it,ac,$s,Me]);return g.jsx("div",{className:`px-3 ${Fn} pt-2 bg-[var(--app-bg)]`,children:g.jsx("div",{className:"mx-auto w-full max-w-content",children:g.jsxs(JB,{className:"relative",onSubmit:bi,children:[Jf,g.jsx(Lte,{active:r,thinking:a,agentState:c,contextSize:u,modelMode:L,permissionMode:T,agentFlavor:f,voiceStatus:M}),g.jsxs("div",{className:"overflow-hidden rounded-[20px] bg-[var(--app-secondary-bg)]",children:[N.length>0?g.jsx("div",{className:"flex flex-wrap gap-2 px-4 pt-3",children:g.jsx(n3,{components:{Attachment:Wte}})}):null,g.jsx("div",{className:"flex items-center px-4 py-3",children:g.jsx(e3,{ref:Ce,autoFocus:!$&&!yt,placeholder:t(ae?"misc.typeMessage":"misc.typeAMessage"),disabled:$,maxRows:5,submitOnEnter:!yt,cancelOnEscape:!1,onChange:Vt,onSelect:fn,onKeyDown:hn,onPaste:Tt,className:"flex-1 resize-none bg-transparent text-base leading-snug text-[var(--app-fg)] placeholder-[var(--app-hint)] focus:outline-none disabled:cursor-not-allowed disabled:opacity-50"})}),g.jsx(qte,{canSend:q,controlsDisabled:$,showSettingsButton:qs,onSettingsToggle:yi,showTerminalButton:Oe,terminalDisabled:$,onTerminal:S??(()=>{}),showAbortButton:lc,abortDisabled:At,isAborting:U,onAbort:$e,showSwitchButton:Se,switchDisabled:se,isSwitching:de,onSwitch:Ke,voiceEnabled:Ka,voiceStatus:M,voiceMicMuted:R,onVoiceToggle:E??(()=>{}),onVoiceMicToggle:A,onSend:Dy})]})]})})})}const x3=k.createContext(null);function Yte(e){return g.jsx(x3.Provider,{value:e.value,children:e.children})}function Ok(){const e=k.useContext(x3);if(!e)throw new Error("HappyChatContext is missing");return e}function TSe(){}function w3(e,t){const n=t||{};return(e[e.length-1]===""?[...e,""]:e).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const Xte=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Qte=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Jte={};function XL(e,t){return(Jte.jsx?Qte:Xte).test(e)}const Zte=/[ \t\n\f\r]/g;function gy(e){return typeof e=="object"?e.type==="text"?QL(e.value):!1:QL(e)}function QL(e){return e.replace(Zte,"")===""}class zf{constructor(t,n,i){this.normal=n,this.property=t,i&&(this.space=i)}}zf.prototype.normal={};zf.prototype.property={};zf.prototype.space=void 0;function C3(e,t){const n={},i={};for(const s of e)Object.assign(n,s.property),Object.assign(i,s.normal);return new zf(n,i,t)}function tw(e){return e.toLowerCase()}class Wi{constructor(t,n){this.attribute=n,this.property=t}}Wi.prototype.attribute="";Wi.prototype.booleanish=!1;Wi.prototype.boolean=!1;Wi.prototype.commaOrSpaceSeparated=!1;Wi.prototype.commaSeparated=!1;Wi.prototype.defined=!1;Wi.prototype.mustUseProperty=!1;Wi.prototype.number=!1;Wi.prototype.overloadedBoolean=!1;Wi.prototype.property="";Wi.prototype.spaceSeparated=!1;Wi.prototype.space=void 0;let ene=0;const tt=sc(),kn=sc(),nw=sc(),_e=sc(),Wt=sc(),Eu=sc(),rs=sc();function sc(){return 2**++ene}const iw=Object.freeze(Object.defineProperty({__proto__:null,boolean:tt,booleanish:kn,commaOrSpaceSeparated:rs,commaSeparated:Eu,number:_e,overloadedBoolean:nw,spaceSeparated:Wt},Symbol.toStringTag,{value:"Module"})),rS=Object.keys(iw);class jk extends Wi{constructor(t,n,i,s){let r=-1;if(super(t,n),JL(this,"space",s),typeof i=="number")for(;++r<rS.length;){const o=rS[r];JL(this,rS[r],(i&iw[o])===iw[o])}}}jk.prototype.defined=!0;function JL(e,t,n){n&&(e[t]=n)}function Yu(e){const t={},n={};for(const[i,s]of Object.entries(e.properties)){const r=new jk(i,e.transform(e.attributes||{},i),s,e.space);e.mustUseProperty&&e.mustUseProperty.includes(i)&&(r.mustUseProperty=!0),t[i]=r,n[tw(i)]=i,n[tw(r.attribute)]=i}return new zf(t,n,e.space)}const k3=Yu({properties:{ariaActiveDescendant:null,ariaAtomic:kn,ariaAutoComplete:null,ariaBusy:kn,ariaChecked:kn,ariaColCount:_e,ariaColIndex:_e,ariaColSpan:_e,ariaControls:Wt,ariaCurrent:null,ariaDescribedBy:Wt,ariaDetails:null,ariaDisabled:kn,ariaDropEffect:Wt,ariaErrorMessage:null,ariaExpanded:kn,ariaFlowTo:Wt,ariaGrabbed:kn,ariaHasPopup:null,ariaHidden:kn,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Wt,ariaLevel:_e,ariaLive:null,ariaModal:kn,ariaMultiLine:kn,ariaMultiSelectable:kn,ariaOrientation:null,ariaOwns:Wt,ariaPlaceholder:null,ariaPosInSet:_e,ariaPressed:kn,ariaReadOnly:kn,ariaRelevant:null,ariaRequired:kn,ariaRoleDescription:Wt,ariaRowCount:_e,ariaRowIndex:_e,ariaRowSpan:_e,ariaSelected:kn,ariaSetSize:_e,ariaSort:null,ariaValueMax:_e,ariaValueMin:_e,ariaValueNow:_e,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function T3(e,t){return t in e?e[t]:t}function E3(e,t){return T3(e,t.toLowerCase())}const tne=Yu({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Eu,acceptCharset:Wt,accessKey:Wt,action:null,allow:null,allowFullScreen:tt,allowPaymentRequest:tt,allowUserMedia:tt,alt:null,as:null,async:tt,autoCapitalize:null,autoComplete:Wt,autoFocus:tt,autoPlay:tt,blocking:Wt,capture:null,charSet:null,checked:tt,cite:null,className:Wt,cols:_e,colSpan:null,content:null,contentEditable:kn,controls:tt,controlsList:Wt,coords:_e|Eu,crossOrigin:null,data:null,dateTime:null,decoding:null,default:tt,defer:tt,dir:null,dirName:null,disabled:tt,download:nw,draggable:kn,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:tt,formTarget:null,headers:Wt,height:_e,hidden:nw,high:_e,href:null,hrefLang:null,htmlFor:Wt,httpEquiv:Wt,id:null,imageSizes:null,imageSrcSet:null,inert:tt,inputMode:null,integrity:null,is:null,isMap:tt,itemId:null,itemProp:Wt,itemRef:Wt,itemScope:tt,itemType:Wt,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:tt,low:_e,manifest:null,max:null,maxLength:_e,media:null,method:null,min:null,minLength:_e,multiple:tt,muted:tt,name:null,nonce:null,noModule:tt,noValidate:tt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:tt,optimum:_e,pattern:null,ping:Wt,placeholder:null,playsInline:tt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:tt,referrerPolicy:null,rel:Wt,required:tt,reversed:tt,rows:_e,rowSpan:_e,sandbox:Wt,scope:null,scoped:tt,seamless:tt,selected:tt,shadowRootClonable:tt,shadowRootDelegatesFocus:tt,shadowRootMode:null,shape:null,size:_e,sizes:null,slot:null,span:_e,spellCheck:kn,src:null,srcDoc:null,srcLang:null,srcSet:null,start:_e,step:null,style:null,tabIndex:_e,target:null,title:null,translate:null,type:null,typeMustMatch:tt,useMap:null,value:kn,width:_e,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Wt,axis:null,background:null,bgColor:null,border:_e,borderColor:null,bottomMargin:_e,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:tt,declare:tt,event:null,face:null,frame:null,frameBorder:null,hSpace:_e,leftMargin:_e,link:null,longDesc:null,lowSrc:null,marginHeight:_e,marginWidth:_e,noResize:tt,noHref:tt,noShade:tt,noWrap:tt,object:null,profile:null,prompt:null,rev:null,rightMargin:_e,rules:null,scheme:null,scrolling:kn,standby:null,summary:null,text:null,topMargin:_e,valueType:null,version:null,vAlign:null,vLink:null,vSpace:_e,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:tt,disableRemotePlayback:tt,prefix:null,property:null,results:_e,security:null,unselectable:null},space:"html",transform:E3}),nne=Yu({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:rs,accentHeight:_e,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:_e,amplitude:_e,arabicForm:null,ascent:_e,attributeName:null,attributeType:null,azimuth:_e,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:_e,by:null,calcMode:null,capHeight:_e,className:Wt,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:_e,diffuseConstant:_e,direction:null,display:null,dur:null,divisor:_e,dominantBaseline:null,download:tt,dx:null,dy:null,edgeMode:null,editable:null,elevation:_e,enableBackground:null,end:null,event:null,exponent:_e,externalResourcesRequired:null,fill:null,fillOpacity:_e,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Eu,g2:Eu,glyphName:Eu,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:_e,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:_e,horizOriginX:_e,horizOriginY:_e,id:null,ideographic:_e,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:_e,k:_e,k1:_e,k2:_e,k3:_e,k4:_e,kernelMatrix:rs,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:_e,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:_e,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:_e,overlineThickness:_e,paintOrder:null,panose1:null,path:null,pathLength:_e,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Wt,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:_e,pointsAtY:_e,pointsAtZ:_e,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:rs,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:rs,rev:rs,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:rs,requiredFeatures:rs,requiredFonts:rs,requiredFormats:rs,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:_e,specularExponent:_e,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:_e,strikethroughThickness:_e,string:null,stroke:null,strokeDashArray:rs,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:_e,strokeOpacity:_e,strokeWidth:null,style:null,surfaceScale:_e,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:rs,tabIndex:_e,tableValues:null,target:null,targetX:_e,targetY:_e,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:rs,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:_e,underlineThickness:_e,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:_e,values:null,vAlphabetic:_e,vMathematical:_e,vectorEffect:null,vHanging:_e,vIdeographic:_e,version:null,vertAdvY:_e,vertOriginX:_e,vertOriginY:_e,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:_e,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:T3}),R3=Yu({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),M3=Yu({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:E3}),A3=Yu({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),ine={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},sne=/[A-Z]/g,ZL=/-[a-z]/g,rne=/^data[-\w.:]+$/i;function P3(e,t){const n=tw(t);let i=t,s=Wi;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&rne.test(t)){if(t.charAt(4)==="-"){const r=t.slice(5).replace(ZL,ane);i="data"+r.charAt(0).toUpperCase()+r.slice(1)}else{const r=t.slice(4);if(!ZL.test(r)){let o=r.replace(sne,one);o.charAt(0)!=="-"&&(o="-"+o),t="data"+o}}s=jk}return new s(i,t)}function one(e){return"-"+e.toLowerCase()}function ane(e){return e.charAt(1).toUpperCase()}const L3=C3([k3,tne,R3,M3,A3],"html"),$f=C3([k3,nne,R3,M3,A3],"svg");function N3(e){return e.join(" ").trim()}var eu={},oS,eN;function lne(){if(eN)return oS;eN=1;var e=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,t=/\n/g,n=/^\s*/,i=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,s=/^:\s*/,r=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,o=/^[;\s]*/,a=/^\s+|\s+$/g,c=`
`,u="/",h="*",f="",m="comment",y="declaration";function b(_,w){if(typeof _!="string")throw new TypeError("First argument must be a string");if(!_)return[];w=w||{};var M=1,R=1;function E(V){var H=V.match(t);H&&(M+=H.length);var B=V.lastIndexOf(c);R=~B?V.length-B:R+V.length}function A(){var V={line:M,column:R};return function(H){return H.position=new T(V),I(),H}}function T(V){this.start=V,this.end={line:M,column:R},this.source=w.source}T.prototype.content=_;function L(V){var H=new Error(w.source+":"+M+":"+R+": "+V);if(H.reason=V,H.filename=w.source,H.line=M,H.column=R,H.source=_,!w.silent)throw H}function P(V){var H=V.exec(_);if(H){var B=H[0];return E(B),_=_.slice(B.length),H}}function I(){P(n)}function N(V){var H;for(V=V||[];H=O();)H!==!1&&V.push(H);return V}function O(){var V=A();if(!(u!=_.charAt(0)||h!=_.charAt(1))){for(var H=2;f!=_.charAt(H)&&(h!=_.charAt(H)||u!=_.charAt(H+1));)++H;if(H+=2,f===_.charAt(H-1))return L("End of comment missing");var B=_.slice(2,H-2);return R+=2,E(B),_=_.slice(H),R+=2,V({type:m,comment:B})}}function j(){var V=A(),H=P(i);if(H){if(O(),!P(s))return L("property missing ':'");var B=P(r),W=V({type:y,property:S(H[0].replace(e,f)),value:B?S(B[0].replace(e,f)):f});return P(o),W}}function $(){var V=[];N(V);for(var H;H=j();)H!==!1&&(V.push(H),N(V));return V}return I(),$()}function S(_){return _?_.replace(a,f):f}return oS=b,oS}var tN;function cne(){if(tN)return eu;tN=1;var e=eu&&eu.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(eu,"__esModule",{value:!0}),eu.default=n;const t=e(lne());function n(i,s){let r=null;if(!i||typeof i!="string")return r;const o=(0,t.default)(i),a=typeof s=="function";return o.forEach(c=>{if(c.type!=="declaration")return;const{property:u,value:h}=c;a?s(u,h,c):h&&(r=r||{},r[u]=h)}),r}return eu}var rh={},nN;function une(){if(nN)return rh;nN=1,Object.defineProperty(rh,"__esModule",{value:!0}),rh.camelCase=void 0;var e=/^--[a-zA-Z0-9_-]+$/,t=/-([a-z])/g,n=/^[^-]+$/,i=/^-(webkit|moz|ms|o|khtml)-/,s=/^-(ms)-/,r=function(u){return!u||n.test(u)||e.test(u)},o=function(u,h){return h.toUpperCase()},a=function(u,h){return"".concat(h,"-")},c=function(u,h){return h===void 0&&(h={}),r(u)?u:(u=u.toLowerCase(),h.reactCompat?u=u.replace(s,a):u=u.replace(i,a),u.replace(t,o))};return rh.camelCase=c,rh}var oh,iN;function dne(){if(iN)return oh;iN=1;var e=oh&&oh.__importDefault||function(s){return s&&s.__esModule?s:{default:s}},t=e(cne()),n=une();function i(s,r){var o={};return!s||typeof s!="string"||(0,t.default)(s,function(a,c){a&&c&&(o[(0,n.camelCase)(a,r)]=c)}),o}return i.default=i,oh=i,oh}var hne=dne();const fne=Ql(hne),I3=D3("end"),Bk=D3("start");function D3(e){return t;function t(n){const i=n&&n.position&&n.position[e]||{};if(typeof i.line=="number"&&i.line>0&&typeof i.column=="number"&&i.column>0)return{line:i.line,column:i.column,offset:typeof i.offset=="number"&&i.offset>-1?i.offset:void 0}}}function pne(e){const t=Bk(e),n=I3(e);if(t&&n)return{start:t,end:n}}function Vh(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?sN(e.position):"start"in e||"end"in e?sN(e):"line"in e||"column"in e?sw(e):""}function sw(e){return rN(e&&e.line)+":"+rN(e&&e.column)}function sN(e){return sw(e&&e.start)+"-"+sw(e&&e.end)}function rN(e){return e&&typeof e=="number"?e:1}class vi extends Error{constructor(t,n,i){super(),typeof n=="string"&&(i=n,n=void 0);let s="",r={},o=!1;if(n&&("line"in n&&"column"in n?r={place:n}:"start"in n&&"end"in n?r={place:n}:"type"in n?r={ancestors:[n],place:n.position}:r={...n}),typeof t=="string"?s=t:!r.cause&&t&&(o=!0,s=t.message,r.cause=t),!r.ruleId&&!r.source&&typeof i=="string"){const c=i.indexOf(":");c===-1?r.ruleId=i:(r.source=i.slice(0,c),r.ruleId=i.slice(c+1))}if(!r.place&&r.ancestors&&r.ancestors){const c=r.ancestors[r.ancestors.length-1];c&&(r.place=c.position)}const a=r.place&&"start"in r.place?r.place.start:r.place;this.ancestors=r.ancestors||void 0,this.cause=r.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=s,this.line=a?a.line:void 0,this.name=Vh(r.place)||"1:1",this.place=r.place||void 0,this.reason=this.message,this.ruleId=r.ruleId||void 0,this.source=r.source||void 0,this.stack=o&&r.cause&&typeof r.cause.stack=="string"?r.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}vi.prototype.file="";vi.prototype.name="";vi.prototype.reason="";vi.prototype.message="";vi.prototype.stack="";vi.prototype.column=void 0;vi.prototype.line=void 0;vi.prototype.ancestors=void 0;vi.prototype.cause=void 0;vi.prototype.fatal=void 0;vi.prototype.place=void 0;vi.prototype.ruleId=void 0;vi.prototype.source=void 0;const Fk={}.hasOwnProperty,mne=new Map,gne=/[A-Z]/g,vne=new Set(["table","tbody","thead","tfoot","tr"]),yne=new Set(["td","th"]),O3="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function j3(e,t){if(!t||t.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=t.filePath||void 0;let i;if(t.development){if(typeof t.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");i=Tne(n,t.jsxDEV)}else{if(typeof t.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof t.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");i=kne(n,t.jsx,t.jsxs)}const s={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:i,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space==="svg"?$f:L3,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},r=B3(s,e,void 0);return r&&typeof r!="string"?r:s.create(e,s.Fragment,{children:r||void 0},void 0)}function B3(e,t,n){if(t.type==="element")return bne(e,t,n);if(t.type==="mdxFlowExpression"||t.type==="mdxTextExpression")return _ne(e,t);if(t.type==="mdxJsxFlowElement"||t.type==="mdxJsxTextElement")return xne(e,t,n);if(t.type==="mdxjsEsm")return Sne(e,t);if(t.type==="root")return wne(e,t,n);if(t.type==="text")return Cne(e,t)}function bne(e,t,n){const i=e.schema;let s=i;t.tagName.toLowerCase()==="svg"&&i.space==="html"&&(s=$f,e.schema=s),e.ancestors.push(t);const r=U3(e,t.tagName,!1),o=Ene(e,t);let a=zk(e,t);return vne.has(t.tagName)&&(a=a.filter(function(c){return typeof c=="string"?!gy(c):!0})),F3(e,o,r,t),Uk(o,a),e.ancestors.pop(),e.schema=i,e.create(t,r,o,n)}function _ne(e,t){if(t.data&&t.data.estree&&e.evaluater){const i=t.data.estree.body[0];return i.type,e.evaluater.evaluateExpression(i.expression)}xf(e,t.position)}function Sne(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);xf(e,t.position)}function xne(e,t,n){const i=e.schema;let s=i;t.name==="svg"&&i.space==="html"&&(s=$f,e.schema=s),e.ancestors.push(t);const r=t.name===null?e.Fragment:U3(e,t.name,!0),o=Rne(e,t),a=zk(e,t);return F3(e,o,r,t),Uk(o,a),e.ancestors.pop(),e.schema=i,e.create(t,r,o,n)}function wne(e,t,n){const i={};return Uk(i,zk(e,t)),e.create(t,e.Fragment,i,n)}function Cne(e,t){return t.value}function F3(e,t,n,i){typeof n!="string"&&n!==e.Fragment&&e.passNode&&(t.node=i)}function Uk(e,t){if(t.length>0){const n=t.length>1?t:t[0];n&&(e.children=n)}}function kne(e,t,n){return i;function i(s,r,o,a){const u=Array.isArray(o.children)?n:t;return a?u(r,o,a):u(r,o)}}function Tne(e,t){return n;function n(i,s,r,o){const a=Array.isArray(r.children),c=Bk(i);return t(s,r,o,a,{columnNumber:c?c.column-1:void 0,fileName:e,lineNumber:c?c.line:void 0},void 0)}}function Ene(e,t){const n={};let i,s;for(s in t.properties)if(s!=="children"&&Fk.call(t.properties,s)){const r=Mne(e,s,t.properties[s]);if(r){const[o,a]=r;e.tableCellAlignToStyle&&o==="align"&&typeof a=="string"&&yne.has(t.tagName)?i=a:n[o]=a}}if(i){const r=n.style||(n.style={});r[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=i}return n}function Rne(e,t){const n={};for(const i of t.attributes)if(i.type==="mdxJsxExpressionAttribute")if(i.data&&i.data.estree&&e.evaluater){const r=i.data.estree.body[0];r.type;const o=r.expression;o.type;const a=o.properties[0];a.type,Object.assign(n,e.evaluater.evaluateExpression(a.argument))}else xf(e,t.position);else{const s=i.name;let r;if(i.value&&typeof i.value=="object")if(i.value.data&&i.value.data.estree&&e.evaluater){const a=i.value.data.estree.body[0];a.type,r=e.evaluater.evaluateExpression(a.expression)}else xf(e,t.position);else r=i.value===null?!0:i.value;n[s]=r}return n}function zk(e,t){const n=[];let i=-1;const s=e.passKeys?new Map:mne;for(;++i<t.children.length;){const r=t.children[i];let o;if(e.passKeys){const c=r.type==="element"?r.tagName:r.type==="mdxJsxFlowElement"||r.type==="mdxJsxTextElement"?r.name:void 0;if(c){const u=s.get(c)||0;o=c+"-"+u,s.set(c,u+1)}}const a=B3(e,r,o);a!==void 0&&n.push(a)}return n}function Mne(e,t,n){const i=P3(e.schema,t);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=i.commaSeparated?w3(n):N3(n)),i.property==="style"){let s=typeof n=="object"?n:Ane(e,String(n));return e.stylePropertyNameCase==="css"&&(s=Pne(s)),["style",s]}return[e.elementAttributeNameCase==="react"&&i.space?ine[i.property]||i.property:i.attribute,n]}}function Ane(e,t){try{return fne(t,{reactCompat:!0})}catch(n){if(e.ignoreInvalidStyle)return{};const i=n,s=new vi("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:i,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=e.filePath||void 0,s.url=O3+"#cannot-parse-style-attribute",s}}function U3(e,t,n){let i;if(!n)i={type:"Literal",value:t};else if(t.includes(".")){const s=t.split(".");let r=-1,o;for(;++r<s.length;){const a=XL(s[r])?{type:"Identifier",name:s[r]}:{type:"Literal",value:s[r]};o=o?{type:"MemberExpression",object:o,property:a,computed:!!(r&&a.type==="Literal"),optional:!1}:a}i=o}else i=XL(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};if(i.type==="Literal"){const s=i.value;return Fk.call(e.components,s)?e.components[s]:s}if(e.evaluater)return e.evaluater.evaluateExpression(i);xf(e)}function xf(e,t){const n=new vi("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=e.filePath||void 0,n.url=O3+"#cannot-handle-mdx-estrees-without-createevaluater",n}function Pne(e){const t={};let n;for(n in e)Fk.call(e,n)&&(t[Lne(n)]=e[n]);return t}function Lne(e){let t=e.replace(gne,Nne);return t.slice(0,3)==="ms-"&&(t="-"+t),t}function Nne(e){return"-"+e.toLowerCase()}const aS={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},Ine={};function $k(e,t){const n=Ine,i=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,s=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return z3(e,i,s)}function z3(e,t,n){if(Dne(e)){if("value"in e)return e.type==="html"&&!n?"":e.value;if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return oN(e.children,t,n)}return Array.isArray(e)?oN(e,t,n):""}function oN(e,t,n){const i=[];let s=-1;for(;++s<e.length;)i[s]=z3(e[s],t,n);return i.join("")}function Dne(e){return!!(e&&typeof e=="object")}const aN=document.createElement("i");function qk(e){const t="&"+e+";";aN.innerHTML=t;const n=aN.textContent;return n.charCodeAt(n.length-1)===59&&e!=="semi"||n===t?!1:n}function ps(e,t,n,i){const s=e.length;let r=0,o;if(t<0?t=-t>s?0:s+t:t=t>s?s:t,n=n>0?n:0,i.length<1e4)o=Array.from(i),o.unshift(t,n),e.splice(...o);else for(n&&e.splice(t,n);r<i.length;)o=i.slice(r,r+1e4),o.unshift(t,0),e.splice(...o),r+=1e4,t+=1e4}function Ns(e,t){return e.length>0?(ps(e,e.length,0,t),e):t}const lN={}.hasOwnProperty;function $3(e){const t={};let n=-1;for(;++n<e.length;)One(t,e[n]);return t}function One(e,t){let n;for(n in t){const s=(lN.call(e,n)?e[n]:void 0)||(e[n]={}),r=t[n];let o;if(r)for(o in r){lN.call(s,o)||(s[o]=[]);const a=r[o];jne(s[o],Array.isArray(a)?a:a?[a]:[])}}}function jne(e,t){let n=-1;const i=[];for(;++n<t.length;)(t[n].add==="after"?e:i).push(t[n]);ps(e,0,0,i)}function q3(e,t){const n=Number.parseInt(e,t);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function lr(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Pr=Ga(/[A-Za-z]/),us=Ga(/[\dA-Za-z]/),Bne=Ga(/[#-'*+\--9=?A-Z^-~]/);function rw(e){return e!==null&&(e<32||e===127)}const ow=Ga(/\d/),Fne=Ga(/[\dA-Fa-f]/),Une=Ga(/[!-/:-@[-`{-~]/);function Fe(e){return e!==null&&e<-2}function _n(e){return e!==null&&(e<0||e===32)}function gt(e){return e===-2||e===-1||e===32}const zne=Ga(new RegExp("\\p{P}|\\p{S}","u")),$ne=Ga(/\s/);function Ga(e){return t;function t(n){return n!==null&&n>-1&&e.test(String.fromCharCode(n))}}function Xu(e){const t=[];let n=-1,i=0,s=0;for(;++n<e.length;){const r=e.charCodeAt(n);let o="";if(r===37&&us(e.charCodeAt(n+1))&&us(e.charCodeAt(n+2)))s=2;else if(r<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(r))||(o=String.fromCharCode(r));else if(r>55295&&r<57344){const a=e.charCodeAt(n+1);r<56320&&a>56319&&a<57344?(o=String.fromCharCode(r,a),s=1):o=""}else o=String.fromCharCode(r);o&&(t.push(e.slice(i,n),encodeURIComponent(o)),i=n+s+1,o=""),s&&(n+=s,s=0)}return t.join("")+e.slice(i)}function Ct(e,t,n,i){const s=i?i-1:Number.POSITIVE_INFINITY;let r=0;return o;function o(c){return gt(c)?(e.enter(n),a(c)):t(c)}function a(c){return gt(c)&&r++<s?(e.consume(c),a):(e.exit(n),t(c))}}const qne={tokenize:Hne};function Hne(e){const t=e.attempt(this.parser.constructs.contentInitial,i,s);let n;return t;function i(a){if(a===null){e.consume(a);return}return e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),Ct(e,t,"linePrefix")}function s(a){return e.enter("paragraph"),r(a)}function r(a){const c=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=c),n=c,o(a)}function o(a){if(a===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(a);return}return Fe(a)?(e.consume(a),e.exit("chunkText"),r):(e.consume(a),o)}}const Vne={tokenize:Wne},cN={tokenize:Gne};function Wne(e){const t=this,n=[];let i=0,s,r,o;return a;function a(R){if(i<n.length){const E=n[i];return t.containerState=E[1],e.attempt(E[0].continuation,c,u)(R)}return u(R)}function c(R){if(i++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,s&&M();const E=t.events.length;let A=E,T;for(;A--;)if(t.events[A][0]==="exit"&&t.events[A][1].type==="chunkFlow"){T=t.events[A][1].end;break}w(i);let L=E;for(;L<t.events.length;)t.events[L][1].end={...T},L++;return ps(t.events,A+1,0,t.events.slice(E)),t.events.length=L,u(R)}return a(R)}function u(R){if(i===n.length){if(!s)return m(R);if(s.currentConstruct&&s.currentConstruct.concrete)return b(R);t.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(cN,h,f)(R)}function h(R){return s&&M(),w(i),m(R)}function f(R){return t.parser.lazy[t.now().line]=i!==n.length,o=t.now().offset,b(R)}function m(R){return t.containerState={},e.attempt(cN,y,b)(R)}function y(R){return i++,n.push([t.currentConstruct,t.containerState]),m(R)}function b(R){if(R===null){s&&M(),w(0),e.consume(R);return}return s=s||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:r}),S(R)}function S(R){if(R===null){_(e.exit("chunkFlow"),!0),w(0),e.consume(R);return}return Fe(R)?(e.consume(R),_(e.exit("chunkFlow")),i=0,t.interrupt=void 0,a):(e.consume(R),S)}function _(R,E){const A=t.sliceStream(R);if(E&&A.push(null),R.previous=r,r&&(r.next=R),r=R,s.defineSkip(R.start),s.write(A),t.parser.lazy[R.start.line]){let T=s.events.length;for(;T--;)if(s.events[T][1].start.offset<o&&(!s.events[T][1].end||s.events[T][1].end.offset>o))return;const L=t.events.length;let P=L,I,N;for(;P--;)if(t.events[P][0]==="exit"&&t.events[P][1].type==="chunkFlow"){if(I){N=t.events[P][1].end;break}I=!0}for(w(i),T=L;T<t.events.length;)t.events[T][1].end={...N},T++;ps(t.events,P+1,0,t.events.slice(L)),t.events.length=T}}function w(R){let E=n.length;for(;E-- >R;){const A=n[E];t.containerState=A[1],A[0].exit.call(t,e)}n.length=R}function M(){s.write([null]),r=void 0,s=void 0,t.containerState._closeFlow=void 0}}function Gne(e,t,n){return Ct(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function ju(e){if(e===null||_n(e)||$ne(e))return 1;if(zne(e))return 2}function vy(e,t,n){const i=[];let s=-1;for(;++s<e.length;){const r=e[s].resolveAll;r&&!i.includes(r)&&(t=r(t,n),i.push(r))}return t}const aw={name:"attention",resolveAll:Kne,tokenize:Yne};function Kne(e,t){let n=-1,i,s,r,o,a,c,u,h;for(;++n<e.length;)if(e[n][0]==="enter"&&e[n][1].type==="attentionSequence"&&e[n][1]._close){for(i=n;i--;)if(e[i][0]==="exit"&&e[i][1].type==="attentionSequence"&&e[i][1]._open&&t.sliceSerialize(e[i][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[i][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[i][1].end.offset-e[i][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;c=e[i][1].end.offset-e[i][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;const f={...e[i][1].end},m={...e[n][1].start};uN(f,-c),uN(m,c),o={type:c>1?"strongSequence":"emphasisSequence",start:f,end:{...e[i][1].end}},a={type:c>1?"strongSequence":"emphasisSequence",start:{...e[n][1].start},end:m},r={type:c>1?"strongText":"emphasisText",start:{...e[i][1].end},end:{...e[n][1].start}},s={type:c>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},e[i][1].end={...o.start},e[n][1].start={...a.end},u=[],e[i][1].end.offset-e[i][1].start.offset&&(u=Ns(u,[["enter",e[i][1],t],["exit",e[i][1],t]])),u=Ns(u,[["enter",s,t],["enter",o,t],["exit",o,t],["enter",r,t]]),u=Ns(u,vy(t.parser.constructs.insideSpan.null,e.slice(i+1,n),t)),u=Ns(u,[["exit",r,t],["enter",a,t],["exit",a,t],["exit",s,t]]),e[n][1].end.offset-e[n][1].start.offset?(h=2,u=Ns(u,[["enter",e[n][1],t],["exit",e[n][1],t]])):h=0,ps(e,i-1,n-i+3,u),n=i+u.length-h-2;break}}for(n=-1;++n<e.length;)e[n][1].type==="attentionSequence"&&(e[n][1].type="data");return e}function Yne(e,t){const n=this.parser.constructs.attentionMarkers.null,i=this.previous,s=ju(i);let r;return o;function o(c){return r=c,e.enter("attentionSequence"),a(c)}function a(c){if(c===r)return e.consume(c),a;const u=e.exit("attentionSequence"),h=ju(c),f=!h||h===2&&s||n.includes(c),m=!s||s===2&&h||n.includes(i);return u._open=!!(r===42?f:f&&(s||!m)),u._close=!!(r===42?m:m&&(h||!f)),t(c)}}function uN(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const Xne={name:"autolink",tokenize:Qne};function Qne(e,t,n){let i=0;return s;function s(y){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(y),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),r}function r(y){return Pr(y)?(e.consume(y),o):y===64?n(y):u(y)}function o(y){return y===43||y===45||y===46||us(y)?(i=1,a(y)):u(y)}function a(y){return y===58?(e.consume(y),i=0,c):(y===43||y===45||y===46||us(y))&&i++<32?(e.consume(y),a):(i=0,u(y))}function c(y){return y===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(y),e.exit("autolinkMarker"),e.exit("autolink"),t):y===null||y===32||y===60||rw(y)?n(y):(e.consume(y),c)}function u(y){return y===64?(e.consume(y),h):Bne(y)?(e.consume(y),u):n(y)}function h(y){return us(y)?f(y):n(y)}function f(y){return y===46?(e.consume(y),i=0,h):y===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(y),e.exit("autolinkMarker"),e.exit("autolink"),t):m(y)}function m(y){if((y===45||us(y))&&i++<63){const b=y===45?m:f;return e.consume(y),b}return n(y)}}const qf={partial:!0,tokenize:Jne};function Jne(e,t,n){return i;function i(r){return gt(r)?Ct(e,s,"linePrefix")(r):s(r)}function s(r){return r===null||Fe(r)?t(r):n(r)}}const H3={continuation:{tokenize:eie},exit:tie,name:"blockQuote",tokenize:Zne};function Zne(e,t,n){const i=this;return s;function s(o){if(o===62){const a=i.containerState;return a.open||(e.enter("blockQuote",{_container:!0}),a.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(o),e.exit("blockQuoteMarker"),r}return n(o)}function r(o){return gt(o)?(e.enter("blockQuotePrefixWhitespace"),e.consume(o),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(o))}}function eie(e,t,n){const i=this;return s;function s(o){return gt(o)?Ct(e,r,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):r(o)}function r(o){return e.attempt(H3,t,n)(o)}}function tie(e){e.exit("blockQuote")}const V3={name:"characterEscape",tokenize:nie};function nie(e,t,n){return i;function i(r){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(r),e.exit("escapeMarker"),s}function s(r){return Une(r)?(e.enter("characterEscapeValue"),e.consume(r),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(r)}}const W3={name:"characterReference",tokenize:iie};function iie(e,t,n){const i=this;let s=0,r,o;return a;function a(f){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(f),e.exit("characterReferenceMarker"),c}function c(f){return f===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(f),e.exit("characterReferenceMarkerNumeric"),u):(e.enter("characterReferenceValue"),r=31,o=us,h(f))}function u(f){return f===88||f===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(f),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),r=6,o=Fne,h):(e.enter("characterReferenceValue"),r=7,o=ow,h(f))}function h(f){if(f===59&&s){const m=e.exit("characterReferenceValue");return o===us&&!qk(i.sliceSerialize(m))?n(f):(e.enter("characterReferenceMarker"),e.consume(f),e.exit("characterReferenceMarker"),e.exit("characterReference"),t)}return o(f)&&s++<r?(e.consume(f),h):n(f)}}const dN={partial:!0,tokenize:rie},hN={concrete:!0,name:"codeFenced",tokenize:sie};function sie(e,t,n){const i=this,s={partial:!0,tokenize:A};let r=0,o=0,a;return c;function c(T){return u(T)}function u(T){const L=i.events[i.events.length-1];return r=L&&L[1].type==="linePrefix"?L[2].sliceSerialize(L[1],!0).length:0,a=T,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),h(T)}function h(T){return T===a?(o++,e.consume(T),h):o<3?n(T):(e.exit("codeFencedFenceSequence"),gt(T)?Ct(e,f,"whitespace")(T):f(T))}function f(T){return T===null||Fe(T)?(e.exit("codeFencedFence"),i.interrupt?t(T):e.check(dN,S,E)(T)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),m(T))}function m(T){return T===null||Fe(T)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),f(T)):gt(T)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),Ct(e,y,"whitespace")(T)):T===96&&T===a?n(T):(e.consume(T),m)}function y(T){return T===null||Fe(T)?f(T):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),b(T))}function b(T){return T===null||Fe(T)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),f(T)):T===96&&T===a?n(T):(e.consume(T),b)}function S(T){return e.attempt(s,E,_)(T)}function _(T){return e.enter("lineEnding"),e.consume(T),e.exit("lineEnding"),w}function w(T){return r>0&&gt(T)?Ct(e,M,"linePrefix",r+1)(T):M(T)}function M(T){return T===null||Fe(T)?e.check(dN,S,E)(T):(e.enter("codeFlowValue"),R(T))}function R(T){return T===null||Fe(T)?(e.exit("codeFlowValue"),M(T)):(e.consume(T),R)}function E(T){return e.exit("codeFenced"),t(T)}function A(T,L,P){let I=0;return N;function N(H){return T.enter("lineEnding"),T.consume(H),T.exit("lineEnding"),O}function O(H){return T.enter("codeFencedFence"),gt(H)?Ct(T,j,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(H):j(H)}function j(H){return H===a?(T.enter("codeFencedFenceSequence"),$(H)):P(H)}function $(H){return H===a?(I++,T.consume(H),$):I>=o?(T.exit("codeFencedFenceSequence"),gt(H)?Ct(T,V,"whitespace")(H):V(H)):P(H)}function V(H){return H===null||Fe(H)?(T.exit("codeFencedFence"),L(H)):P(H)}}}function rie(e,t,n){const i=this;return s;function s(o){return o===null?n(o):(e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),r)}function r(o){return i.parser.lazy[i.now().line]?n(o):t(o)}}const lS={name:"codeIndented",tokenize:aie},oie={partial:!0,tokenize:lie};function aie(e,t,n){const i=this;return s;function s(u){return e.enter("codeIndented"),Ct(e,r,"linePrefix",5)(u)}function r(u){const h=i.events[i.events.length-1];return h&&h[1].type==="linePrefix"&&h[2].sliceSerialize(h[1],!0).length>=4?o(u):n(u)}function o(u){return u===null?c(u):Fe(u)?e.attempt(oie,o,c)(u):(e.enter("codeFlowValue"),a(u))}function a(u){return u===null||Fe(u)?(e.exit("codeFlowValue"),o(u)):(e.consume(u),a)}function c(u){return e.exit("codeIndented"),t(u)}}function lie(e,t,n){const i=this;return s;function s(o){return i.parser.lazy[i.now().line]?n(o):Fe(o)?(e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),s):Ct(e,r,"linePrefix",5)(o)}function r(o){const a=i.events[i.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?t(o):Fe(o)?s(o):n(o)}}const cie={name:"codeText",previous:die,resolve:uie,tokenize:hie};function uie(e){let t=e.length-4,n=3,i,s;if((e[n][1].type==="lineEnding"||e[n][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(i=n;++i<t;)if(e[i][1].type==="codeTextData"){e[n][1].type="codeTextPadding",e[t][1].type="codeTextPadding",n+=2,t-=2;break}}for(i=n-1,t++;++i<=t;)s===void 0?i!==t&&e[i][1].type!=="lineEnding"&&(s=i):(i===t||e[i][1].type==="lineEnding")&&(e[s][1].type="codeTextData",i!==s+2&&(e[s][1].end=e[i-1][1].end,e.splice(s+2,i-s-2),t-=i-s-2,i=s+2),s=void 0);return e}function die(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function hie(e,t,n){let i=0,s,r;return o;function o(f){return e.enter("codeText"),e.enter("codeTextSequence"),a(f)}function a(f){return f===96?(e.consume(f),i++,a):(e.exit("codeTextSequence"),c(f))}function c(f){return f===null?n(f):f===32?(e.enter("space"),e.consume(f),e.exit("space"),c):f===96?(r=e.enter("codeTextSequence"),s=0,h(f)):Fe(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),c):(e.enter("codeTextData"),u(f))}function u(f){return f===null||f===32||f===96||Fe(f)?(e.exit("codeTextData"),c(f)):(e.consume(f),u)}function h(f){return f===96?(e.consume(f),s++,h):s===i?(e.exit("codeTextSequence"),e.exit("codeText"),t(f)):(r.type="codeTextData",u(f))}}class fie{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,n){const i=n??Number.POSITIVE_INFINITY;return i<this.left.length?this.left.slice(t,i):t>this.left.length?this.right.slice(this.right.length-i+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-i+this.left.length).reverse())}splice(t,n,i){const s=n||0;this.setCursor(Math.trunc(t));const r=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return i&&ah(this.left,i),r.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),ah(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),ah(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){const n=this.left.splice(t,Number.POSITIVE_INFINITY);ah(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);ah(this.left,n.reverse())}}}function ah(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function G3(e){const t={};let n=-1,i,s,r,o,a,c,u;const h=new fie(e);for(;++n<h.length;){for(;n in t;)n=t[n];if(i=h.get(n),n&&i[1].type==="chunkFlow"&&h.get(n-1)[1].type==="listItemPrefix"&&(c=i[1]._tokenizer.events,r=0,r<c.length&&c[r][1].type==="lineEndingBlank"&&(r+=2),r<c.length&&c[r][1].type==="content"))for(;++r<c.length&&c[r][1].type!=="content";)c[r][1].type==="chunkText"&&(c[r][1]._isInFirstContentOfListItem=!0,r++);if(i[0]==="enter")i[1].contentType&&(Object.assign(t,pie(h,n)),n=t[n],u=!0);else if(i[1]._container){for(r=n,s=void 0;r--;)if(o=h.get(r),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(s&&(h.get(s)[1].type="lineEndingBlank"),o[1].type="lineEnding",s=r);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;s&&(i[1].end={...h.get(s)[1].start},a=h.slice(s,n),a.unshift(i),h.splice(s,n-s+1,a))}}return ps(e,0,Number.POSITIVE_INFINITY,h.slice(0)),!u}function pie(e,t){const n=e.get(t)[1],i=e.get(t)[2];let s=t-1;const r=[];let o=n._tokenizer;o||(o=i.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const a=o.events,c=[],u={};let h,f,m=-1,y=n,b=0,S=0;const _=[S];for(;y;){for(;e.get(++s)[1]!==y;);r.push(s),y._tokenizer||(h=i.sliceStream(y),y.next||h.push(null),f&&o.defineSkip(y.start),y._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(h),y._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),f=y,y=y.next}for(y=n;++m<a.length;)a[m][0]==="exit"&&a[m-1][0]==="enter"&&a[m][1].type===a[m-1][1].type&&a[m][1].start.line!==a[m][1].end.line&&(S=m+1,_.push(S),y._tokenizer=void 0,y.previous=void 0,y=y.next);for(o.events=[],y?(y._tokenizer=void 0,y.previous=void 0):_.pop(),m=_.length;m--;){const w=a.slice(_[m],_[m+1]),M=r.pop();c.push([M,M+w.length-1]),e.splice(M,2,w)}for(c.reverse(),m=-1;++m<c.length;)u[b+c[m][0]]=b+c[m][1],b+=c[m][1]-c[m][0]-1;return u}const mie={resolve:vie,tokenize:yie},gie={partial:!0,tokenize:bie};function vie(e){return G3(e),e}function yie(e,t){let n;return i;function i(a){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),s(a)}function s(a){return a===null?r(a):Fe(a)?e.check(gie,o,r)(a):(e.consume(a),s)}function r(a){return e.exit("chunkContent"),e.exit("content"),t(a)}function o(a){return e.consume(a),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,s}}function bie(e,t,n){const i=this;return s;function s(o){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),Ct(e,r,"linePrefix")}function r(o){if(o===null||Fe(o))return n(o);const a=i.events[i.events.length-1];return!i.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?t(o):e.interrupt(i.parser.constructs.flow,n,t)(o)}}function K3(e,t,n,i,s,r,o,a,c){const u=c||Number.POSITIVE_INFINITY;let h=0;return f;function f(w){return w===60?(e.enter(i),e.enter(s),e.enter(r),e.consume(w),e.exit(r),m):w===null||w===32||w===41||rw(w)?n(w):(e.enter(i),e.enter(o),e.enter(a),e.enter("chunkString",{contentType:"string"}),S(w))}function m(w){return w===62?(e.enter(r),e.consume(w),e.exit(r),e.exit(s),e.exit(i),t):(e.enter(a),e.enter("chunkString",{contentType:"string"}),y(w))}function y(w){return w===62?(e.exit("chunkString"),e.exit(a),m(w)):w===null||w===60||Fe(w)?n(w):(e.consume(w),w===92?b:y)}function b(w){return w===60||w===62||w===92?(e.consume(w),y):y(w)}function S(w){return!h&&(w===null||w===41||_n(w))?(e.exit("chunkString"),e.exit(a),e.exit(o),e.exit(i),t(w)):h<u&&w===40?(e.consume(w),h++,S):w===41?(e.consume(w),h--,S):w===null||w===32||w===40||rw(w)?n(w):(e.consume(w),w===92?_:S)}function _(w){return w===40||w===41||w===92?(e.consume(w),S):S(w)}}function Y3(e,t,n,i,s,r){const o=this;let a=0,c;return u;function u(y){return e.enter(i),e.enter(s),e.consume(y),e.exit(s),e.enter(r),h}function h(y){return a>999||y===null||y===91||y===93&&!c||y===94&&!a&&"_hiddenFootnoteSupport"in o.parser.constructs?n(y):y===93?(e.exit(r),e.enter(s),e.consume(y),e.exit(s),e.exit(i),t):Fe(y)?(e.enter("lineEnding"),e.consume(y),e.exit("lineEnding"),h):(e.enter("chunkString",{contentType:"string"}),f(y))}function f(y){return y===null||y===91||y===93||Fe(y)||a++>999?(e.exit("chunkString"),h(y)):(e.consume(y),c||(c=!gt(y)),y===92?m:f)}function m(y){return y===91||y===92||y===93?(e.consume(y),a++,f):f(y)}}function X3(e,t,n,i,s,r){let o;return a;function a(m){return m===34||m===39||m===40?(e.enter(i),e.enter(s),e.consume(m),e.exit(s),o=m===40?41:m,c):n(m)}function c(m){return m===o?(e.enter(s),e.consume(m),e.exit(s),e.exit(i),t):(e.enter(r),u(m))}function u(m){return m===o?(e.exit(r),c(o)):m===null?n(m):Fe(m)?(e.enter("lineEnding"),e.consume(m),e.exit("lineEnding"),Ct(e,u,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),h(m))}function h(m){return m===o||m===null||Fe(m)?(e.exit("chunkString"),u(m)):(e.consume(m),m===92?f:h)}function f(m){return m===o||m===92?(e.consume(m),h):h(m)}}function Wh(e,t){let n;return i;function i(s){return Fe(s)?(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),n=!0,i):gt(s)?Ct(e,i,n?"linePrefix":"lineSuffix")(s):t(s)}}const _ie={name:"definition",tokenize:xie},Sie={partial:!0,tokenize:wie};function xie(e,t,n){const i=this;let s;return r;function r(y){return e.enter("definition"),o(y)}function o(y){return Y3.call(i,e,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(y)}function a(y){return s=lr(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)),y===58?(e.enter("definitionMarker"),e.consume(y),e.exit("definitionMarker"),c):n(y)}function c(y){return _n(y)?Wh(e,u)(y):u(y)}function u(y){return K3(e,h,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(y)}function h(y){return e.attempt(Sie,f,f)(y)}function f(y){return gt(y)?Ct(e,m,"whitespace")(y):m(y)}function m(y){return y===null||Fe(y)?(e.exit("definition"),i.parser.defined.push(s),t(y)):n(y)}}function wie(e,t,n){return i;function i(a){return _n(a)?Wh(e,s)(a):n(a)}function s(a){return X3(e,r,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function r(a){return gt(a)?Ct(e,o,"whitespace")(a):o(a)}function o(a){return a===null||Fe(a)?t(a):n(a)}}const Cie={name:"hardBreakEscape",tokenize:kie};function kie(e,t,n){return i;function i(r){return e.enter("hardBreakEscape"),e.consume(r),s}function s(r){return Fe(r)?(e.exit("hardBreakEscape"),t(r)):n(r)}}const Tie={name:"headingAtx",resolve:Eie,tokenize:Rie};function Eie(e,t){let n=e.length-2,i=3,s,r;return e[i][1].type==="whitespace"&&(i+=2),n-2>i&&e[n][1].type==="whitespace"&&(n-=2),e[n][1].type==="atxHeadingSequence"&&(i===n-1||n-4>i&&e[n-2][1].type==="whitespace")&&(n-=i+1===n?2:4),n>i&&(s={type:"atxHeadingText",start:e[i][1].start,end:e[n][1].end},r={type:"chunkText",start:e[i][1].start,end:e[n][1].end,contentType:"text"},ps(e,i,n-i+1,[["enter",s,t],["enter",r,t],["exit",r,t],["exit",s,t]])),e}function Rie(e,t,n){let i=0;return s;function s(h){return e.enter("atxHeading"),r(h)}function r(h){return e.enter("atxHeadingSequence"),o(h)}function o(h){return h===35&&i++<6?(e.consume(h),o):h===null||_n(h)?(e.exit("atxHeadingSequence"),a(h)):n(h)}function a(h){return h===35?(e.enter("atxHeadingSequence"),c(h)):h===null||Fe(h)?(e.exit("atxHeading"),t(h)):gt(h)?Ct(e,a,"whitespace")(h):(e.enter("atxHeadingText"),u(h))}function c(h){return h===35?(e.consume(h),c):(e.exit("atxHeadingSequence"),a(h))}function u(h){return h===null||h===35||_n(h)?(e.exit("atxHeadingText"),a(h)):(e.consume(h),u)}}const Mie=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],fN=["pre","script","style","textarea"],Aie={concrete:!0,name:"htmlFlow",resolveTo:Nie,tokenize:Iie},Pie={partial:!0,tokenize:Oie},Lie={partial:!0,tokenize:Die};function Nie(e){let t=e.length;for(;t--&&!(e[t][0]==="enter"&&e[t][1].type==="htmlFlow"););return t>1&&e[t-2][1].type==="linePrefix"&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function Iie(e,t,n){const i=this;let s,r,o,a,c;return u;function u(U){return h(U)}function h(U){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(U),f}function f(U){return U===33?(e.consume(U),m):U===47?(e.consume(U),r=!0,S):U===63?(e.consume(U),s=3,i.interrupt?t:z):Pr(U)?(e.consume(U),o=String.fromCharCode(U),_):n(U)}function m(U){return U===45?(e.consume(U),s=2,y):U===91?(e.consume(U),s=5,a=0,b):Pr(U)?(e.consume(U),s=4,i.interrupt?t:z):n(U)}function y(U){return U===45?(e.consume(U),i.interrupt?t:z):n(U)}function b(U){const re="CDATA[";return U===re.charCodeAt(a++)?(e.consume(U),a===re.length?i.interrupt?t:j:b):n(U)}function S(U){return Pr(U)?(e.consume(U),o=String.fromCharCode(U),_):n(U)}function _(U){if(U===null||U===47||U===62||_n(U)){const re=U===47,de=o.toLowerCase();return!re&&!r&&fN.includes(de)?(s=1,i.interrupt?t(U):j(U)):Mie.includes(o.toLowerCase())?(s=6,re?(e.consume(U),w):i.interrupt?t(U):j(U)):(s=7,i.interrupt&&!i.parser.lazy[i.now().line]?n(U):r?M(U):R(U))}return U===45||us(U)?(e.consume(U),o+=String.fromCharCode(U),_):n(U)}function w(U){return U===62?(e.consume(U),i.interrupt?t:j):n(U)}function M(U){return gt(U)?(e.consume(U),M):N(U)}function R(U){return U===47?(e.consume(U),N):U===58||U===95||Pr(U)?(e.consume(U),E):gt(U)?(e.consume(U),R):N(U)}function E(U){return U===45||U===46||U===58||U===95||us(U)?(e.consume(U),E):A(U)}function A(U){return U===61?(e.consume(U),T):gt(U)?(e.consume(U),A):R(U)}function T(U){return U===null||U===60||U===61||U===62||U===96?n(U):U===34||U===39?(e.consume(U),c=U,L):gt(U)?(e.consume(U),T):P(U)}function L(U){return U===c?(e.consume(U),c=null,I):U===null||Fe(U)?n(U):(e.consume(U),L)}function P(U){return U===null||U===34||U===39||U===47||U===60||U===61||U===62||U===96||_n(U)?A(U):(e.consume(U),P)}function I(U){return U===47||U===62||gt(U)?R(U):n(U)}function N(U){return U===62?(e.consume(U),O):n(U)}function O(U){return U===null||Fe(U)?j(U):gt(U)?(e.consume(U),O):n(U)}function j(U){return U===45&&s===2?(e.consume(U),B):U===60&&s===1?(e.consume(U),W):U===62&&s===4?(e.consume(U),G):U===63&&s===3?(e.consume(U),z):U===93&&s===5?(e.consume(U),ne):Fe(U)&&(s===6||s===7)?(e.exit("htmlFlowData"),e.check(Pie,J,$)(U)):U===null||Fe(U)?(e.exit("htmlFlowData"),$(U)):(e.consume(U),j)}function $(U){return e.check(Lie,V,J)(U)}function V(U){return e.enter("lineEnding"),e.consume(U),e.exit("lineEnding"),H}function H(U){return U===null||Fe(U)?$(U):(e.enter("htmlFlowData"),j(U))}function B(U){return U===45?(e.consume(U),z):j(U)}function W(U){return U===47?(e.consume(U),o="",q):j(U)}function q(U){if(U===62){const re=o.toLowerCase();return fN.includes(re)?(e.consume(U),G):j(U)}return Pr(U)&&o.length<8?(e.consume(U),o+=String.fromCharCode(U),q):j(U)}function ne(U){return U===93?(e.consume(U),z):j(U)}function z(U){return U===62?(e.consume(U),G):U===45&&s===2?(e.consume(U),z):j(U)}function G(U){return U===null||Fe(U)?(e.exit("htmlFlowData"),J(U)):(e.consume(U),G)}function J(U){return e.exit("htmlFlow"),t(U)}}function Die(e,t,n){const i=this;return s;function s(o){return Fe(o)?(e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),r):n(o)}function r(o){return i.parser.lazy[i.now().line]?n(o):t(o)}}function Oie(e,t,n){return i;function i(s){return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),e.attempt(qf,t,n)}}const jie={name:"htmlText",tokenize:Bie};function Bie(e,t,n){const i=this;let s,r,o;return a;function a(z){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(z),c}function c(z){return z===33?(e.consume(z),u):z===47?(e.consume(z),A):z===63?(e.consume(z),R):Pr(z)?(e.consume(z),P):n(z)}function u(z){return z===45?(e.consume(z),h):z===91?(e.consume(z),r=0,b):Pr(z)?(e.consume(z),M):n(z)}function h(z){return z===45?(e.consume(z),y):n(z)}function f(z){return z===null?n(z):z===45?(e.consume(z),m):Fe(z)?(o=f,W(z)):(e.consume(z),f)}function m(z){return z===45?(e.consume(z),y):f(z)}function y(z){return z===62?B(z):z===45?m(z):f(z)}function b(z){const G="CDATA[";return z===G.charCodeAt(r++)?(e.consume(z),r===G.length?S:b):n(z)}function S(z){return z===null?n(z):z===93?(e.consume(z),_):Fe(z)?(o=S,W(z)):(e.consume(z),S)}function _(z){return z===93?(e.consume(z),w):S(z)}function w(z){return z===62?B(z):z===93?(e.consume(z),w):S(z)}function M(z){return z===null||z===62?B(z):Fe(z)?(o=M,W(z)):(e.consume(z),M)}function R(z){return z===null?n(z):z===63?(e.consume(z),E):Fe(z)?(o=R,W(z)):(e.consume(z),R)}function E(z){return z===62?B(z):R(z)}function A(z){return Pr(z)?(e.consume(z),T):n(z)}function T(z){return z===45||us(z)?(e.consume(z),T):L(z)}function L(z){return Fe(z)?(o=L,W(z)):gt(z)?(e.consume(z),L):B(z)}function P(z){return z===45||us(z)?(e.consume(z),P):z===47||z===62||_n(z)?I(z):n(z)}function I(z){return z===47?(e.consume(z),B):z===58||z===95||Pr(z)?(e.consume(z),N):Fe(z)?(o=I,W(z)):gt(z)?(e.consume(z),I):B(z)}function N(z){return z===45||z===46||z===58||z===95||us(z)?(e.consume(z),N):O(z)}function O(z){return z===61?(e.consume(z),j):Fe(z)?(o=O,W(z)):gt(z)?(e.consume(z),O):I(z)}function j(z){return z===null||z===60||z===61||z===62||z===96?n(z):z===34||z===39?(e.consume(z),s=z,$):Fe(z)?(o=j,W(z)):gt(z)?(e.consume(z),j):(e.consume(z),V)}function $(z){return z===s?(e.consume(z),s=void 0,H):z===null?n(z):Fe(z)?(o=$,W(z)):(e.consume(z),$)}function V(z){return z===null||z===34||z===39||z===60||z===61||z===96?n(z):z===47||z===62||_n(z)?I(z):(e.consume(z),V)}function H(z){return z===47||z===62||_n(z)?I(z):n(z)}function B(z){return z===62?(e.consume(z),e.exit("htmlTextData"),e.exit("htmlText"),t):n(z)}function W(z){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(z),e.exit("lineEnding"),q}function q(z){return gt(z)?Ct(e,ne,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(z):ne(z)}function ne(z){return e.enter("htmlTextData"),o(z)}}const Hk={name:"labelEnd",resolveAll:$ie,resolveTo:qie,tokenize:Hie},Fie={tokenize:Vie},Uie={tokenize:Wie},zie={tokenize:Gie};function $ie(e){let t=-1;const n=[];for(;++t<e.length;){const i=e[t][1];if(n.push(e[t]),i.type==="labelImage"||i.type==="labelLink"||i.type==="labelEnd"){const s=i.type==="labelImage"?4:2;i.type="data",t+=s}}return e.length!==n.length&&ps(e,0,e.length,n),e}function qie(e,t){let n=e.length,i=0,s,r,o,a;for(;n--;)if(s=e[n][1],r){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;e[n][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(o){if(e[n][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(r=n,s.type!=="labelLink")){i=2;break}}else s.type==="labelEnd"&&(o=n);const c={type:e[r][1].type==="labelLink"?"link":"image",start:{...e[r][1].start},end:{...e[e.length-1][1].end}},u={type:"label",start:{...e[r][1].start},end:{...e[o][1].end}},h={type:"labelText",start:{...e[r+i+2][1].end},end:{...e[o-2][1].start}};return a=[["enter",c,t],["enter",u,t]],a=Ns(a,e.slice(r+1,r+i+3)),a=Ns(a,[["enter",h,t]]),a=Ns(a,vy(t.parser.constructs.insideSpan.null,e.slice(r+i+4,o-3),t)),a=Ns(a,[["exit",h,t],e[o-2],e[o-1],["exit",u,t]]),a=Ns(a,e.slice(o+1)),a=Ns(a,[["exit",c,t]]),ps(e,r,e.length,a),e}function Hie(e,t,n){const i=this;let s=i.events.length,r,o;for(;s--;)if((i.events[s][1].type==="labelImage"||i.events[s][1].type==="labelLink")&&!i.events[s][1]._balanced){r=i.events[s][1];break}return a;function a(m){return r?r._inactive?f(m):(o=i.parser.defined.includes(lr(i.sliceSerialize({start:r.end,end:i.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(m),e.exit("labelMarker"),e.exit("labelEnd"),c):n(m)}function c(m){return m===40?e.attempt(Fie,h,o?h:f)(m):m===91?e.attempt(Uie,h,o?u:f)(m):o?h(m):f(m)}function u(m){return e.attempt(zie,h,f)(m)}function h(m){return t(m)}function f(m){return r._balanced=!0,n(m)}}function Vie(e,t,n){return i;function i(f){return e.enter("resource"),e.enter("resourceMarker"),e.consume(f),e.exit("resourceMarker"),s}function s(f){return _n(f)?Wh(e,r)(f):r(f)}function r(f){return f===41?h(f):K3(e,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(f)}function o(f){return _n(f)?Wh(e,c)(f):h(f)}function a(f){return n(f)}function c(f){return f===34||f===39||f===40?X3(e,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(f):h(f)}function u(f){return _n(f)?Wh(e,h)(f):h(f)}function h(f){return f===41?(e.enter("resourceMarker"),e.consume(f),e.exit("resourceMarker"),e.exit("resource"),t):n(f)}}function Wie(e,t,n){const i=this;return s;function s(a){return Y3.call(i,e,r,o,"reference","referenceMarker","referenceString")(a)}function r(a){return i.parser.defined.includes(lr(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?t(a):n(a)}function o(a){return n(a)}}function Gie(e,t,n){return i;function i(r){return e.enter("reference"),e.enter("referenceMarker"),e.consume(r),e.exit("referenceMarker"),s}function s(r){return r===93?(e.enter("referenceMarker"),e.consume(r),e.exit("referenceMarker"),e.exit("reference"),t):n(r)}}const Kie={name:"labelStartImage",resolveAll:Hk.resolveAll,tokenize:Yie};function Yie(e,t,n){const i=this;return s;function s(a){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(a),e.exit("labelImageMarker"),r}function r(a){return a===91?(e.enter("labelMarker"),e.consume(a),e.exit("labelMarker"),e.exit("labelImage"),o):n(a)}function o(a){return a===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(a):t(a)}}const Xie={name:"labelStartLink",resolveAll:Hk.resolveAll,tokenize:Qie};function Qie(e,t,n){const i=this;return s;function s(o){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(o),e.exit("labelMarker"),e.exit("labelLink"),r}function r(o){return o===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(o):t(o)}}const cS={name:"lineEnding",tokenize:Jie};function Jie(e,t){return n;function n(i){return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),Ct(e,t,"linePrefix")}}const kg={name:"thematicBreak",tokenize:Zie};function Zie(e,t,n){let i=0,s;return r;function r(u){return e.enter("thematicBreak"),o(u)}function o(u){return s=u,a(u)}function a(u){return u===s?(e.enter("thematicBreakSequence"),c(u)):i>=3&&(u===null||Fe(u))?(e.exit("thematicBreak"),t(u)):n(u)}function c(u){return u===s?(e.consume(u),i++,c):(e.exit("thematicBreakSequence"),gt(u)?Ct(e,a,"whitespace")(u):a(u))}}const Ui={continuation:{tokenize:ise},exit:rse,name:"list",tokenize:nse},ese={partial:!0,tokenize:ose},tse={partial:!0,tokenize:sse};function nse(e,t,n){const i=this,s=i.events[i.events.length-1];let r=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,o=0;return a;function a(y){const b=i.containerState.type||(y===42||y===43||y===45?"listUnordered":"listOrdered");if(b==="listUnordered"?!i.containerState.marker||y===i.containerState.marker:ow(y)){if(i.containerState.type||(i.containerState.type=b,e.enter(b,{_container:!0})),b==="listUnordered")return e.enter("listItemPrefix"),y===42||y===45?e.check(kg,n,u)(y):u(y);if(!i.interrupt||y===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),c(y)}return n(y)}function c(y){return ow(y)&&++o<10?(e.consume(y),c):(!i.interrupt||o<2)&&(i.containerState.marker?y===i.containerState.marker:y===41||y===46)?(e.exit("listItemValue"),u(y)):n(y)}function u(y){return e.enter("listItemMarker"),e.consume(y),e.exit("listItemMarker"),i.containerState.marker=i.containerState.marker||y,e.check(qf,i.interrupt?n:h,e.attempt(ese,m,f))}function h(y){return i.containerState.initialBlankLine=!0,r++,m(y)}function f(y){return gt(y)?(e.enter("listItemPrefixWhitespace"),e.consume(y),e.exit("listItemPrefixWhitespace"),m):n(y)}function m(y){return i.containerState.size=r+i.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(y)}}function ise(e,t,n){const i=this;return i.containerState._closeFlow=void 0,e.check(qf,s,r);function s(a){return i.containerState.furtherBlankLines=i.containerState.furtherBlankLines||i.containerState.initialBlankLine,Ct(e,t,"listItemIndent",i.containerState.size+1)(a)}function r(a){return i.containerState.furtherBlankLines||!gt(a)?(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,o(a)):(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,e.attempt(tse,t,o)(a))}function o(a){return i.containerState._closeFlow=!0,i.interrupt=void 0,Ct(e,e.attempt(Ui,t,n),"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function sse(e,t,n){const i=this;return Ct(e,s,"listItemIndent",i.containerState.size+1);function s(r){const o=i.events[i.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===i.containerState.size?t(r):n(r)}}function rse(e){e.exit(this.containerState.type)}function ose(e,t,n){const i=this;return Ct(e,s,"listItemPrefixWhitespace",i.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function s(r){const o=i.events[i.events.length-1];return!gt(r)&&o&&o[1].type==="listItemPrefixWhitespace"?t(r):n(r)}}const pN={name:"setextUnderline",resolveTo:ase,tokenize:lse};function ase(e,t){let n=e.length,i,s,r;for(;n--;)if(e[n][0]==="enter"){if(e[n][1].type==="content"){i=n;break}e[n][1].type==="paragraph"&&(s=n)}else e[n][1].type==="content"&&e.splice(n,1),!r&&e[n][1].type==="definition"&&(r=n);const o={type:"setextHeading",start:{...e[i][1].start},end:{...e[e.length-1][1].end}};return e[s][1].type="setextHeadingText",r?(e.splice(s,0,["enter",o,t]),e.splice(r+1,0,["exit",e[i][1],t]),e[i][1].end={...e[r][1].end}):e[i][1]=o,e.push(["exit",o,t]),e}function lse(e,t,n){const i=this;let s;return r;function r(u){let h=i.events.length,f;for(;h--;)if(i.events[h][1].type!=="lineEnding"&&i.events[h][1].type!=="linePrefix"&&i.events[h][1].type!=="content"){f=i.events[h][1].type==="paragraph";break}return!i.parser.lazy[i.now().line]&&(i.interrupt||f)?(e.enter("setextHeadingLine"),s=u,o(u)):n(u)}function o(u){return e.enter("setextHeadingLineSequence"),a(u)}function a(u){return u===s?(e.consume(u),a):(e.exit("setextHeadingLineSequence"),gt(u)?Ct(e,c,"lineSuffix")(u):c(u))}function c(u){return u===null||Fe(u)?(e.exit("setextHeadingLine"),t(u)):n(u)}}const cse={tokenize:use};function use(e){const t=this,n=e.attempt(qf,i,e.attempt(this.parser.constructs.flowInitial,s,Ct(e,e.attempt(this.parser.constructs.flow,s,e.attempt(mie,s)),"linePrefix")));return n;function i(r){if(r===null){e.consume(r);return}return e.enter("lineEndingBlank"),e.consume(r),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n}function s(r){if(r===null){e.consume(r);return}return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),t.currentConstruct=void 0,n}}const dse={resolveAll:J3()},hse=Q3("string"),fse=Q3("text");function Q3(e){return{resolveAll:J3(e==="text"?pse:void 0),tokenize:t};function t(n){const i=this,s=this.parser.constructs[e],r=n.attempt(s,o,a);return o;function o(h){return u(h)?r(h):a(h)}function a(h){if(h===null){n.consume(h);return}return n.enter("data"),n.consume(h),c}function c(h){return u(h)?(n.exit("data"),r(h)):(n.consume(h),c)}function u(h){if(h===null)return!0;const f=s[h];let m=-1;if(f)for(;++m<f.length;){const y=f[m];if(!y.previous||y.previous.call(i,i.previous))return!0}return!1}}}function J3(e){return t;function t(n,i){let s=-1,r;for(;++s<=n.length;)r===void 0?n[s]&&n[s][1].type==="data"&&(r=s,s++):(!n[s]||n[s][1].type!=="data")&&(s!==r+2&&(n[r][1].end=n[s-1][1].end,n.splice(r+2,s-r-2),s=r+2),r=void 0);return e?e(n,i):n}}function pse(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||e[n][1].type==="lineEnding")&&e[n-1][1].type==="data"){const i=e[n-1][1],s=t.sliceStream(i);let r=s.length,o=-1,a=0,c;for(;r--;){const u=s[r];if(typeof u=="string"){for(o=u.length;u.charCodeAt(o-1)===32;)a++,o--;if(o)break;o=-1}else if(u===-2)c=!0,a++;else if(u!==-1){r++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(a=0),a){const u={type:n===e.length||c||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:r?o:i.start._bufferIndex+o,_index:i.start._index+r,line:i.end.line,column:i.end.column-a,offset:i.end.offset-a},end:{...i.end}};i.end={...u.start},i.start.offset===i.end.offset?Object.assign(i,u):(e.splice(n,0,["enter",u,t],["exit",u,t]),n+=2)}n++}return e}const mse={42:Ui,43:Ui,45:Ui,48:Ui,49:Ui,50:Ui,51:Ui,52:Ui,53:Ui,54:Ui,55:Ui,56:Ui,57:Ui,62:H3},gse={91:_ie},vse={[-2]:lS,[-1]:lS,32:lS},yse={35:Tie,42:kg,45:[pN,kg],60:Aie,61:pN,95:kg,96:hN,126:hN},bse={38:W3,92:V3},_se={[-5]:cS,[-4]:cS,[-3]:cS,33:Kie,38:W3,42:aw,60:[Xne,jie],91:Xie,92:[Cie,V3],93:Hk,95:aw,96:cie},Sse={null:[aw,dse]},xse={null:[42,95]},wse={null:[]},Cse=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:xse,contentInitial:gse,disable:wse,document:mse,flow:yse,flowInitial:vse,insideSpan:Sse,string:bse,text:_se},Symbol.toStringTag,{value:"Module"}));function kse(e,t,n){let i={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const s={},r=[];let o=[],a=[];const c={attempt:L(A),check:L(T),consume:M,enter:R,exit:E,interrupt:L(T,{interrupt:!0})},u={code:null,containerState:{},defineSkip:S,events:[],now:b,parser:e,previous:null,sliceSerialize:m,sliceStream:y,write:f};let h=t.tokenize.call(u,c);return t.resolveAll&&r.push(t),u;function f(O){return o=Ns(o,O),_(),o[o.length-1]!==null?[]:(P(t,0),u.events=vy(r,u.events,u),u.events)}function m(O,j){return Ese(y(O),j)}function y(O){return Tse(o,O)}function b(){const{_bufferIndex:O,_index:j,line:$,column:V,offset:H}=i;return{_bufferIndex:O,_index:j,line:$,column:V,offset:H}}function S(O){s[O.line]=O.column,N()}function _(){let O;for(;i._index<o.length;){const j=o[i._index];if(typeof j=="string")for(O=i._index,i._bufferIndex<0&&(i._bufferIndex=0);i._index===O&&i._bufferIndex<j.length;)w(j.charCodeAt(i._bufferIndex));else w(j)}}function w(O){h=h(O)}function M(O){Fe(O)?(i.line++,i.column=1,i.offset+=O===-3?2:1,N()):O!==-1&&(i.column++,i.offset++),i._bufferIndex<0?i._index++:(i._bufferIndex++,i._bufferIndex===o[i._index].length&&(i._bufferIndex=-1,i._index++)),u.previous=O}function R(O,j){const $=j||{};return $.type=O,$.start=b(),u.events.push(["enter",$,u]),a.push($),$}function E(O){const j=a.pop();return j.end=b(),u.events.push(["exit",j,u]),j}function A(O,j){P(O,j.from)}function T(O,j){j.restore()}function L(O,j){return $;function $(V,H,B){let W,q,ne,z;return Array.isArray(V)?J(V):"tokenize"in V?J([V]):G(V);function G(ce){return ae;function ae(be){const Ce=be!==null&&ce[be],qe=be!==null&&ce.null,dt=[...Array.isArray(Ce)?Ce:Ce?[Ce]:[],...Array.isArray(qe)?qe:qe?[qe]:[]];return J(dt)(be)}}function J(ce){return W=ce,q=0,ce.length===0?B:U(ce[q])}function U(ce){return ae;function ae(be){return z=I(),ne=ce,ce.partial||(u.currentConstruct=ce),ce.name&&u.parser.constructs.disable.null.includes(ce.name)?de():ce.tokenize.call(j?Object.assign(Object.create(u),j):u,c,re,de)(be)}}function re(ce){return O(ne,z),H}function de(ce){return z.restore(),++q<W.length?U(W[q]):B}}}function P(O,j){O.resolveAll&&!r.includes(O)&&r.push(O),O.resolve&&ps(u.events,j,u.events.length-j,O.resolve(u.events.slice(j),u)),O.resolveTo&&(u.events=O.resolveTo(u.events,u))}function I(){const O=b(),j=u.previous,$=u.currentConstruct,V=u.events.length,H=Array.from(a);return{from:V,restore:B};function B(){i=O,u.previous=j,u.currentConstruct=$,u.events.length=V,a=H,N()}}function N(){i.line in s&&i.column<2&&(i.column=s[i.line],i.offset+=s[i.line]-1)}}function Tse(e,t){const n=t.start._index,i=t.start._bufferIndex,s=t.end._index,r=t.end._bufferIndex;let o;if(n===s)o=[e[n].slice(i,r)];else{if(o=e.slice(n,s),i>-1){const a=o[0];typeof a=="string"?o[0]=a.slice(i):o.shift()}r>0&&o.push(e[s].slice(0,r))}return o}function Ese(e,t){let n=-1;const i=[];let s;for(;++n<e.length;){const r=e[n];let o;if(typeof r=="string")o=r;else switch(r){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=t?" ":"	";break}case-1:{if(!t&&s)continue;o=" ";break}default:o=String.fromCharCode(r)}s=r===-2,i.push(o)}return i.join("")}function Rse(e){const i={constructs:$3([Cse,...(e||{}).extensions||[]]),content:s(qne),defined:[],document:s(Vne),flow:s(cse),lazy:{},string:s(hse),text:s(fse)};return i;function s(r){return o;function o(a){return kse(i,r,a)}}}function Mse(e){for(;!G3(e););return e}const mN=/[\0\t\n\r]/g;function Ase(){let e=1,t="",n=!0,i;return s;function s(r,o,a){const c=[];let u,h,f,m,y;for(r=t+(typeof r=="string"?r.toString():new TextDecoder(o||void 0).decode(r)),f=0,t="",n&&(r.charCodeAt(0)===65279&&f++,n=void 0);f<r.length;){if(mN.lastIndex=f,u=mN.exec(r),m=u&&u.index!==void 0?u.index:r.length,y=r.charCodeAt(m),!u){t=r.slice(f);break}if(y===10&&f===m&&i)c.push(-3),i=void 0;else switch(i&&(c.push(-5),i=void 0),f<m&&(c.push(r.slice(f,m)),e+=m-f),y){case 0:{c.push(65533),e++;break}case 9:{for(h=Math.ceil(e/4)*4,c.push(-2);e++<h;)c.push(-1);break}case 10:{c.push(-4),e=1;break}default:i=!0,e=1}f=m+1}return a&&(i&&c.push(-5),t&&c.push(t),c.push(null)),c}}const Pse=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Lse(e){return e.replace(Pse,Nse)}function Nse(e,t,n){if(t)return t;if(n.charCodeAt(0)===35){const s=n.charCodeAt(1),r=s===120||s===88;return q3(n.slice(r?2:1),r?16:10)}return qk(n)||e}const Z3={}.hasOwnProperty;function Ise(e,t,n){return typeof t!="string"&&(n=t,t=void 0),Dse(n)(Mse(Rse(n).document().write(Ase()(e,t,!0))))}function Dse(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:r(ot),autolinkProtocol:I,autolinkEmail:I,atxHeading:r(Jn),blockQuote:r(qe),characterEscape:I,characterReference:I,codeFenced:r(dt),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:r(dt,o),codeText:r(yt,o),codeTextData:I,data:I,codeFlowValue:I,definition:r(He),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:r(We),hardBreakEscape:r(Fn),hardBreakTrailing:r(Fn),htmlFlow:r(li,o),htmlFlowData:I,htmlText:r(li,o),htmlTextData:I,image:r(Be),label:o,link:r(ot),listItem:r(Ge),listItemValue:m,listOrdered:r(De,f),listUnordered:r(De),paragraph:r(Ze),reference:U,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:r(Jn),strong:r(ve),thematicBreak:r(At)},exit:{atxHeading:c(),atxHeadingSequence:A,autolink:c(),autolinkEmail:Ce,autolinkProtocol:be,blockQuote:c(),characterEscapeValue:N,characterReferenceMarkerHexadecimal:de,characterReferenceMarkerNumeric:de,characterReferenceValue:ce,characterReference:ae,codeFenced:c(_),codeFencedFence:S,codeFencedFenceInfo:y,codeFencedFenceMeta:b,codeFlowValue:N,codeIndented:c(w),codeText:c(H),codeTextData:N,data:N,definition:c(),definitionDestinationString:E,definitionLabelString:M,definitionTitleString:R,emphasis:c(),hardBreakEscape:c(j),hardBreakTrailing:c(j),htmlFlow:c($),htmlFlowData:N,htmlText:c(V),htmlTextData:N,image:c(W),label:ne,labelText:q,lineEnding:O,link:c(B),listItem:c(),listOrdered:c(),listUnordered:c(),paragraph:c(),referenceString:re,resourceDestinationString:z,resourceTitleString:G,resource:J,setextHeading:c(P),setextHeadingLineSequence:L,setextHeadingText:T,strong:c(),thematicBreak:c()}};eF(t,(e||{}).mdastExtensions||[]);const n={};return i;function i(se){let Se={type:"root",children:[]};const Oe={stack:[Se],tokenStack:[],config:t,enter:a,exit:u,buffer:o,resume:h,data:n},$e=[];let Ke=-1;for(;++Ke<se.length;)if(se[Ke][1].type==="listOrdered"||se[Ke][1].type==="listUnordered")if(se[Ke][0]==="enter")$e.push(Ke);else{const it=$e.pop();Ke=s(se,it,Ke)}for(Ke=-1;++Ke<se.length;){const it=t[se[Ke][0]];Z3.call(it,se[Ke][1].type)&&it[se[Ke][1].type].call(Object.assign({sliceSerialize:se[Ke][2].sliceSerialize},Oe),se[Ke][1])}if(Oe.tokenStack.length>0){const it=Oe.tokenStack[Oe.tokenStack.length-1];(it[1]||gN).call(Oe,void 0,it[0])}for(Se.position={start:ma(se.length>0?se[0][1].start:{line:1,column:1,offset:0}),end:ma(se.length>0?se[se.length-2][1].end:{line:1,column:1,offset:0})},Ke=-1;++Ke<t.transforms.length;)Se=t.transforms[Ke](Se)||Se;return Se}function s(se,Se,Oe){let $e=Se-1,Ke=-1,it=!1,Nt,hn,Vt,fn;for(;++$e<=Oe;){const Tt=se[$e];switch(Tt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Tt[0]==="enter"?Ke++:Ke--,fn=void 0;break}case"lineEndingBlank":{Tt[0]==="enter"&&(Nt&&!fn&&!Ke&&!Vt&&(Vt=$e),fn=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:fn=void 0}if(!Ke&&Tt[0]==="enter"&&Tt[1].type==="listItemPrefix"||Ke===-1&&Tt[0]==="exit"&&(Tt[1].type==="listUnordered"||Tt[1].type==="listOrdered")){if(Nt){let yi=$e;for(hn=void 0;yi--;){const bi=se[yi];if(bi[1].type==="lineEnding"||bi[1].type==="lineEndingBlank"){if(bi[0]==="exit")continue;hn&&(se[hn][1].type="lineEndingBlank",it=!0),bi[1].type="lineEnding",hn=yi}else if(!(bi[1].type==="linePrefix"||bi[1].type==="blockQuotePrefix"||bi[1].type==="blockQuotePrefixWhitespace"||bi[1].type==="blockQuoteMarker"||bi[1].type==="listItemIndent"))break}Vt&&(!hn||Vt<hn)&&(Nt._spread=!0),Nt.end=Object.assign({},hn?se[hn][1].start:Tt[1].end),se.splice(hn||$e,0,["exit",Nt,Tt[2]]),$e++,Oe++}if(Tt[1].type==="listItemPrefix"){const yi={type:"listItem",_spread:!1,start:Object.assign({},Tt[1].start),end:void 0};Nt=yi,se.splice($e,0,["enter",yi,Tt[2]]),$e++,Oe++,Vt=void 0,fn=!0}}}return se[Se][1]._spread=it,Oe}function r(se,Se){return Oe;function Oe($e){a.call(this,se($e),$e),Se&&Se.call(this,$e)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(se,Se,Oe){this.stack[this.stack.length-1].children.push(se),this.stack.push(se),this.tokenStack.push([Se,Oe||void 0]),se.position={start:ma(Se.start),end:void 0}}function c(se){return Se;function Se(Oe){se&&se.call(this,Oe),u.call(this,Oe)}}function u(se,Se){const Oe=this.stack.pop(),$e=this.tokenStack.pop();if($e)$e[0].type!==se.type&&(Se?Se.call(this,se,$e[0]):($e[1]||gN).call(this,se,$e[0]));else throw new Error("Cannot close `"+se.type+"` ("+Vh({start:se.start,end:se.end})+"): its not open");Oe.position.end=ma(se.end)}function h(){return $k(this.stack.pop())}function f(){this.data.expectingFirstListItemValue=!0}function m(se){if(this.data.expectingFirstListItemValue){const Se=this.stack[this.stack.length-2];Se.start=Number.parseInt(this.sliceSerialize(se),10),this.data.expectingFirstListItemValue=void 0}}function y(){const se=this.resume(),Se=this.stack[this.stack.length-1];Se.lang=se}function b(){const se=this.resume(),Se=this.stack[this.stack.length-1];Se.meta=se}function S(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function _(){const se=this.resume(),Se=this.stack[this.stack.length-1];Se.value=se.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function w(){const se=this.resume(),Se=this.stack[this.stack.length-1];Se.value=se.replace(/(\r?\n|\r)$/g,"")}function M(se){const Se=this.resume(),Oe=this.stack[this.stack.length-1];Oe.label=Se,Oe.identifier=lr(this.sliceSerialize(se)).toLowerCase()}function R(){const se=this.resume(),Se=this.stack[this.stack.length-1];Se.title=se}function E(){const se=this.resume(),Se=this.stack[this.stack.length-1];Se.url=se}function A(se){const Se=this.stack[this.stack.length-1];if(!Se.depth){const Oe=this.sliceSerialize(se).length;Se.depth=Oe}}function T(){this.data.setextHeadingSlurpLineEnding=!0}function L(se){const Se=this.stack[this.stack.length-1];Se.depth=this.sliceSerialize(se).codePointAt(0)===61?1:2}function P(){this.data.setextHeadingSlurpLineEnding=void 0}function I(se){const Oe=this.stack[this.stack.length-1].children;let $e=Oe[Oe.length-1];(!$e||$e.type!=="text")&&($e=Me(),$e.position={start:ma(se.start),end:void 0},Oe.push($e)),this.stack.push($e)}function N(se){const Se=this.stack.pop();Se.value+=this.sliceSerialize(se),Se.position.end=ma(se.end)}function O(se){const Se=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Oe=Se.children[Se.children.length-1];Oe.position.end=ma(se.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(Se.type)&&(I.call(this,se),N.call(this,se))}function j(){this.data.atHardBreak=!0}function $(){const se=this.resume(),Se=this.stack[this.stack.length-1];Se.value=se}function V(){const se=this.resume(),Se=this.stack[this.stack.length-1];Se.value=se}function H(){const se=this.resume(),Se=this.stack[this.stack.length-1];Se.value=se}function B(){const se=this.stack[this.stack.length-1];if(this.data.inReference){const Se=this.data.referenceType||"shortcut";se.type+="Reference",se.referenceType=Se,delete se.url,delete se.title}else delete se.identifier,delete se.label;this.data.referenceType=void 0}function W(){const se=this.stack[this.stack.length-1];if(this.data.inReference){const Se=this.data.referenceType||"shortcut";se.type+="Reference",se.referenceType=Se,delete se.url,delete se.title}else delete se.identifier,delete se.label;this.data.referenceType=void 0}function q(se){const Se=this.sliceSerialize(se),Oe=this.stack[this.stack.length-2];Oe.label=Lse(Se),Oe.identifier=lr(Se).toLowerCase()}function ne(){const se=this.stack[this.stack.length-1],Se=this.resume(),Oe=this.stack[this.stack.length-1];if(this.data.inReference=!0,Oe.type==="link"){const $e=se.children;Oe.children=$e}else Oe.alt=Se}function z(){const se=this.resume(),Se=this.stack[this.stack.length-1];Se.url=se}function G(){const se=this.resume(),Se=this.stack[this.stack.length-1];Se.title=se}function J(){this.data.inReference=void 0}function U(){this.data.referenceType="collapsed"}function re(se){const Se=this.resume(),Oe=this.stack[this.stack.length-1];Oe.label=Se,Oe.identifier=lr(this.sliceSerialize(se)).toLowerCase(),this.data.referenceType="full"}function de(se){this.data.characterReferenceType=se.type}function ce(se){const Se=this.sliceSerialize(se),Oe=this.data.characterReferenceType;let $e;Oe?($e=q3(Se,Oe==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):$e=qk(Se);const Ke=this.stack[this.stack.length-1];Ke.value+=$e}function ae(se){const Se=this.stack.pop();Se.position.end=ma(se.end)}function be(se){N.call(this,se);const Se=this.stack[this.stack.length-1];Se.url=this.sliceSerialize(se)}function Ce(se){N.call(this,se);const Se=this.stack[this.stack.length-1];Se.url="mailto:"+this.sliceSerialize(se)}function qe(){return{type:"blockquote",children:[]}}function dt(){return{type:"code",lang:null,meta:null,value:""}}function yt(){return{type:"inlineCode",value:""}}function He(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function We(){return{type:"emphasis",children:[]}}function Jn(){return{type:"heading",depth:0,children:[]}}function Fn(){return{type:"break"}}function li(){return{type:"html",value:""}}function Be(){return{type:"image",title:null,url:"",alt:null}}function ot(){return{type:"link",title:null,url:"",children:[]}}function De(se){return{type:"list",ordered:se.type==="listOrdered",start:null,spread:se._spread,children:[]}}function Ge(se){return{type:"listItem",spread:se._spread,checked:null,children:[]}}function Ze(){return{type:"paragraph",children:[]}}function ve(){return{type:"strong",children:[]}}function Me(){return{type:"text",value:""}}function At(){return{type:"thematicBreak"}}}function ma(e){return{line:e.line,column:e.column,offset:e.offset}}function eF(e,t){let n=-1;for(;++n<t.length;){const i=t[n];Array.isArray(i)?eF(e,i):Ose(e,i)}}function Ose(e,t){let n;for(n in t)if(Z3.call(t,n))switch(n){case"canContainEols":{const i=t[n];i&&e[n].push(...i);break}case"transforms":{const i=t[n];i&&e[n].push(...i);break}case"enter":case"exit":{const i=t[n];i&&Object.assign(e[n],i);break}}}function gN(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+Vh({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+Vh({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+Vh({start:t.start,end:t.end})+") is still open")}function jse(e){const t=this;t.parser=n;function n(i){return Ise(i,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function Bse(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)}function Fse(e,t){const n={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:"text",value:`
`}]}function Use(e,t){const n=t.value?t.value+`
`:"",i={},s=t.lang?t.lang.split(/\s+/):[];s.length>0&&(i.className=["language-"+s[0]]);let r={type:"element",tagName:"code",properties:i,children:[{type:"text",value:n}]};return t.meta&&(r.data={meta:t.meta}),e.patch(t,r),r=e.applyData(t,r),r={type:"element",tagName:"pre",properties:{},children:[r]},e.patch(t,r),r}function zse(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function $se(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function qse(e,t){const n=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",i=String(t.identifier).toUpperCase(),s=Xu(i.toLowerCase()),r=e.footnoteOrder.indexOf(i);let o,a=e.footnoteCounts.get(i);a===void 0?(a=0,e.footnoteOrder.push(i),o=e.footnoteOrder.length):o=r+1,a+=1,e.footnoteCounts.set(i,a);const c={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+s,id:n+"fnref-"+s+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};e.patch(t,c);const u={type:"element",tagName:"sup",properties:{},children:[c]};return e.patch(t,u),e.applyData(t,u)}function Hse(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function Vse(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value};return e.patch(t,n),e.applyData(t,n)}}function tF(e,t){const n=t.referenceType;let i="]";if(n==="collapsed"?i+="[]":n==="full"&&(i+="["+(t.label||t.identifier)+"]"),t.type==="imageReference")return[{type:"text",value:"!["+t.alt+i}];const s=e.all(t),r=s[0];r&&r.type==="text"?r.value="["+r.value:s.unshift({type:"text",value:"["});const o=s[s.length-1];return o&&o.type==="text"?o.value+=i:s.push({type:"text",value:i}),s}function Wse(e,t){const n=String(t.identifier).toUpperCase(),i=e.definitionById.get(n);if(!i)return tF(e,t);const s={src:Xu(i.url||""),alt:t.alt};i.title!==null&&i.title!==void 0&&(s.title=i.title);const r={type:"element",tagName:"img",properties:s,children:[]};return e.patch(t,r),e.applyData(t,r)}function Gse(e,t){const n={src:Xu(t.url)};t.alt!==null&&t.alt!==void 0&&(n.alt=t.alt),t.title!==null&&t.title!==void 0&&(n.title=t.title);const i={type:"element",tagName:"img",properties:n,children:[]};return e.patch(t,i),e.applyData(t,i)}function Kse(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,n);const i={type:"element",tagName:"code",properties:{},children:[n]};return e.patch(t,i),e.applyData(t,i)}function Yse(e,t){const n=String(t.identifier).toUpperCase(),i=e.definitionById.get(n);if(!i)return tF(e,t);const s={href:Xu(i.url||"")};i.title!==null&&i.title!==void 0&&(s.title=i.title);const r={type:"element",tagName:"a",properties:s,children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function Xse(e,t){const n={href:Xu(t.url)};t.title!==null&&t.title!==void 0&&(n.title=t.title);const i={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,i),e.applyData(t,i)}function Qse(e,t,n){const i=e.all(t),s=n?Jse(n):nF(t),r={},o=[];if(typeof t.checked=="boolean"){const h=i[0];let f;h&&h.type==="element"&&h.tagName==="p"?f=h:(f={type:"element",tagName:"p",properties:{},children:[]},i.unshift(f)),f.children.length>0&&f.children.unshift({type:"text",value:" "}),f.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),r.className=["task-list-item"]}let a=-1;for(;++a<i.length;){const h=i[a];(s||a!==0||h.type!=="element"||h.tagName!=="p")&&o.push({type:"text",value:`
`}),h.type==="element"&&h.tagName==="p"&&!s?o.push(...h.children):o.push(h)}const c=i[i.length-1];c&&(s||c.type!=="element"||c.tagName!=="p")&&o.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:r,children:o};return e.patch(t,u),e.applyData(t,u)}function Jse(e){let t=!1;if(e.type==="list"){t=e.spread||!1;const n=e.children;let i=-1;for(;!t&&++i<n.length;)t=nF(n[i])}return t}function nF(e){const t=e.spread;return t??e.children.length>1}function Zse(e,t){const n={},i=e.all(t);let s=-1;for(typeof t.start=="number"&&t.start!==1&&(n.start=t.start);++s<i.length;){const o=i[s];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const r={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(i,!0)};return e.patch(t,r),e.applyData(t,r)}function ere(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function tre(e,t){const n={type:"root",children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)}function nre(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function ire(e,t){const n=e.all(t),i=n.shift(),s=[];if(i){const o={type:"element",tagName:"thead",properties:{},children:e.wrap([i],!0)};e.patch(t.children[0],o),s.push(o)}if(n.length>0){const o={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},a=Bk(t.children[1]),c=I3(t.children[t.children.length-1]);a&&c&&(o.position={start:a,end:c}),s.push(o)}const r={type:"element",tagName:"table",properties:{},children:e.wrap(s,!0)};return e.patch(t,r),e.applyData(t,r)}function sre(e,t,n){const i=n?n.children:void 0,r=(i?i.indexOf(t):1)===0?"th":"td",o=n&&n.type==="table"?n.align:void 0,a=o?o.length:t.children.length;let c=-1;const u=[];for(;++c<a;){const f=t.children[c],m={},y=o?o[c]:void 0;y&&(m.align=y);let b={type:"element",tagName:r,properties:m,children:[]};f&&(b.children=e.all(f),e.patch(f,b),b=e.applyData(f,b)),u.push(b)}const h={type:"element",tagName:"tr",properties:{},children:e.wrap(u,!0)};return e.patch(t,h),e.applyData(t,h)}function rre(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}const vN=9,yN=32;function ore(e){const t=String(e),n=/\r?\n|\r/g;let i=n.exec(t),s=0;const r=[];for(;i;)r.push(bN(t.slice(s,i.index),s>0,!0),i[0]),s=i.index+i[0].length,i=n.exec(t);return r.push(bN(t.slice(s),s>0,!1)),r.join("")}function bN(e,t,n){let i=0,s=e.length;if(t){let r=e.codePointAt(i);for(;r===vN||r===yN;)i++,r=e.codePointAt(i)}if(n){let r=e.codePointAt(s-1);for(;r===vN||r===yN;)s--,r=e.codePointAt(s-1)}return s>i?e.slice(i,s):""}function are(e,t){const n={type:"text",value:ore(String(t.value))};return e.patch(t,n),e.applyData(t,n)}function lre(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)}const cre={blockquote:Bse,break:Fse,code:Use,delete:zse,emphasis:$se,footnoteReference:qse,heading:Hse,html:Vse,imageReference:Wse,image:Gse,inlineCode:Kse,linkReference:Yse,link:Xse,listItem:Qse,list:Zse,paragraph:ere,root:tre,strong:nre,table:ire,tableCell:rre,tableRow:sre,text:are,thematicBreak:lre,toml:Im,yaml:Im,definition:Im,footnoteDefinition:Im};function Im(){}const iF=-1,yy=0,Gh=1,_v=2,Vk=3,Wk=4,Gk=5,Kk=6,sF=7,rF=8,_N=typeof self=="object"?self:globalThis,ure=(e,t)=>{const n=(s,r)=>(e.set(r,s),s),i=s=>{if(e.has(s))return e.get(s);const[r,o]=t[s];switch(r){case yy:case iF:return n(o,s);case Gh:{const a=n([],s);for(const c of o)a.push(i(c));return a}case _v:{const a=n({},s);for(const[c,u]of o)a[i(c)]=i(u);return a}case Vk:return n(new Date(o),s);case Wk:{const{source:a,flags:c}=o;return n(new RegExp(a,c),s)}case Gk:{const a=n(new Map,s);for(const[c,u]of o)a.set(i(c),i(u));return a}case Kk:{const a=n(new Set,s);for(const c of o)a.add(i(c));return a}case sF:{const{name:a,message:c}=o;return n(new _N[a](c),s)}case rF:return n(BigInt(o),s);case"BigInt":return n(Object(BigInt(o)),s);case"ArrayBuffer":return n(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:a}=new Uint8Array(o);return n(new DataView(a),o)}}return n(new _N[r](o),s)};return i},SN=e=>ure(new Map,e)(0),tu="",{toString:dre}={},{keys:hre}=Object,lh=e=>{const t=typeof e;if(t!=="object"||!e)return[yy,t];const n=dre.call(e).slice(8,-1);switch(n){case"Array":return[Gh,tu];case"Object":return[_v,tu];case"Date":return[Vk,tu];case"RegExp":return[Wk,tu];case"Map":return[Gk,tu];case"Set":return[Kk,tu];case"DataView":return[Gh,n]}return n.includes("Array")?[Gh,n]:n.includes("Error")?[sF,n]:[_v,n]},Dm=([e,t])=>e===yy&&(t==="function"||t==="symbol"),fre=(e,t,n,i)=>{const s=(o,a)=>{const c=i.push(o)-1;return n.set(a,c),c},r=o=>{if(n.has(o))return n.get(o);let[a,c]=lh(o);switch(a){case yy:{let h=o;switch(c){case"bigint":a=rF,h=o.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+c);h=null;break;case"undefined":return s([iF],o)}return s([a,h],o)}case Gh:{if(c){let m=o;return c==="DataView"?m=new Uint8Array(o.buffer):c==="ArrayBuffer"&&(m=new Uint8Array(o)),s([c,[...m]],o)}const h=[],f=s([a,h],o);for(const m of o)h.push(r(m));return f}case _v:{if(c)switch(c){case"BigInt":return s([c,o.toString()],o);case"Boolean":case"Number":case"String":return s([c,o.valueOf()],o)}if(t&&"toJSON"in o)return r(o.toJSON());const h=[],f=s([a,h],o);for(const m of hre(o))(e||!Dm(lh(o[m])))&&h.push([r(m),r(o[m])]);return f}case Vk:return s([a,o.toISOString()],o);case Wk:{const{source:h,flags:f}=o;return s([a,{source:h,flags:f}],o)}case Gk:{const h=[],f=s([a,h],o);for(const[m,y]of o)(e||!(Dm(lh(m))||Dm(lh(y))))&&h.push([r(m),r(y)]);return f}case Kk:{const h=[],f=s([a,h],o);for(const m of o)(e||!Dm(lh(m)))&&h.push(r(m));return f}}const{message:u}=o;return s([a,{name:c,message:u}],o)};return r},xN=(e,{json:t,lossy:n}={})=>{const i=[];return fre(!(t||n),!!t,new Map,i)(e),i},Sv=typeof structuredClone=="function"?(e,t)=>t&&("json"in t||"lossy"in t)?SN(xN(e,t)):structuredClone(e):(e,t)=>SN(xN(e,t));function pre(e,t){const n=[{type:"text",value:""}];return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function mre(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}function gre(e){const t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||pre,i=e.options.footnoteBackLabel||mre,s=e.options.footnoteLabel||"Footnotes",r=e.options.footnoteLabelTagName||"h2",o=e.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let c=-1;for(;++c<e.footnoteOrder.length;){const u=e.footnoteById.get(e.footnoteOrder[c]);if(!u)continue;const h=e.all(u),f=String(u.identifier).toUpperCase(),m=Xu(f.toLowerCase());let y=0;const b=[],S=e.footnoteCounts.get(f);for(;S!==void 0&&++y<=S;){b.length>0&&b.push({type:"text",value:" "});let M=typeof n=="string"?n:n(c,y);typeof M=="string"&&(M={type:"text",value:M}),b.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+m+(y>1?"-"+y:""),dataFootnoteBackref:"",ariaLabel:typeof i=="string"?i:i(c,y),className:["data-footnote-backref"]},children:Array.isArray(M)?M:[M]})}const _=h[h.length-1];if(_&&_.type==="element"&&_.tagName==="p"){const M=_.children[_.children.length-1];M&&M.type==="text"?M.value+=" ":_.children.push({type:"text",value:" "}),_.children.push(...b)}else h.push(...b);const w={type:"element",tagName:"li",properties:{id:t+"fn-"+m},children:e.wrap(h,!0)};e.patch(u,w),a.push(w)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:r,properties:{...Sv(o),id:"footnote-label"},children:[{type:"text",value:s}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(a,!0)},{type:"text",value:`
`}]}}const Yk=(function(e){if(e==null)return _re;if(typeof e=="function")return by(e);if(typeof e=="object")return Array.isArray(e)?vre(e):yre(e);if(typeof e=="string")return bre(e);throw new Error("Expected function, string, or object as test")});function vre(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=Yk(e[n]);return by(i);function i(...s){let r=-1;for(;++r<t.length;)if(t[r].apply(this,s))return!0;return!1}}function yre(e){const t=e;return by(n);function n(i){const s=i;let r;for(r in e)if(s[r]!==t[r])return!1;return!0}}function bre(e){return by(t);function t(n){return n&&n.type===e}}function by(e){return t;function t(n,i,s){return!!(Sre(n)&&e.call(this,n,typeof i=="number"?i:void 0,s||void 0))}}function _re(){return!0}function Sre(e){return e!==null&&typeof e=="object"&&"type"in e}const oF=[],xre=!0,lw=!1,wre="skip";function Cre(e,t,n,i){let s;typeof t=="function"&&typeof n!="function"?(i=n,n=t):s=t;const r=Yk(s),o=i?-1:1;a(e,void 0,[])();function a(c,u,h){const f=c&&typeof c=="object"?c:{};if(typeof f.type=="string"){const y=typeof f.tagName=="string"?f.tagName:typeof f.name=="string"?f.name:void 0;Object.defineProperty(m,"name",{value:"node ("+(c.type+(y?"<"+y+">":""))+")"})}return m;function m(){let y=oF,b,S,_;if((!t||r(c,u,h[h.length-1]||void 0))&&(y=kre(n(c,h)),y[0]===lw))return y;if("children"in c&&c.children){const w=c;if(w.children&&y[0]!==wre)for(S=(i?w.children.length:-1)+o,_=h.concat(w);S>-1&&S<w.children.length;){const M=w.children[S];if(b=a(M,S,_)(),b[0]===lw)return b;S=typeof b[1]=="number"?b[1]:S+o}}return y}}}function kre(e){return Array.isArray(e)?e:typeof e=="number"?[xre,e]:e==null?oF:[e]}function Xk(e,t,n,i){let s,r,o;typeof t=="function"&&typeof n!="function"?(r=void 0,o=t,s=n):(r=t,o=n,s=i),Cre(e,r,a,s);function a(c,u){const h=u[u.length-1],f=h?h.children.indexOf(c):void 0;return o(c,f,h)}}const cw={}.hasOwnProperty,Tre={};function Ere(e,t){const n=t||Tre,i=new Map,s=new Map,r=new Map,o={...cre,...n.handlers},a={all:u,applyData:Mre,definitionById:i,footnoteById:s,footnoteCounts:r,footnoteOrder:[],handlers:o,one:c,options:n,patch:Rre,wrap:Pre};return Xk(e,function(h){if(h.type==="definition"||h.type==="footnoteDefinition"){const f=h.type==="definition"?i:s,m=String(h.identifier).toUpperCase();f.has(m)||f.set(m,h)}}),a;function c(h,f){const m=h.type,y=a.handlers[m];if(cw.call(a.handlers,m)&&y)return y(a,h,f);if(a.options.passThrough&&a.options.passThrough.includes(m)){if("children"in h){const{children:S,..._}=h,w=Sv(_);return w.children=a.all(h),w}return Sv(h)}return(a.options.unknownHandler||Are)(a,h,f)}function u(h){const f=[];if("children"in h){const m=h.children;let y=-1;for(;++y<m.length;){const b=a.one(m[y],h);if(b){if(y&&m[y-1].type==="break"&&(!Array.isArray(b)&&b.type==="text"&&(b.value=wN(b.value)),!Array.isArray(b)&&b.type==="element")){const S=b.children[0];S&&S.type==="text"&&(S.value=wN(S.value))}Array.isArray(b)?f.push(...b):f.push(b)}}}return f}}function Rre(e,t){e.position&&(t.position=pne(e))}function Mre(e,t){let n=t;if(e&&e.data){const i=e.data.hName,s=e.data.hChildren,r=e.data.hProperties;if(typeof i=="string")if(n.type==="element")n.tagName=i;else{const o="children"in n?n.children:[n];n={type:"element",tagName:i,properties:{},children:o}}n.type==="element"&&r&&Object.assign(n.properties,Sv(r)),"children"in n&&n.children&&s!==null&&s!==void 0&&(n.children=s)}return n}function Are(e,t){const n=t.data||{},i="value"in t&&!(cw.call(n,"hProperties")||cw.call(n,"hChildren"))?{type:"text",value:t.value}:{type:"element",tagName:"div",properties:{},children:e.all(t)};return e.patch(t,i),e.applyData(t,i)}function Pre(e,t){const n=[];let i=-1;for(t&&n.push({type:"text",value:`
`});++i<e.length;)i&&n.push({type:"text",value:`
`}),n.push(e[i]);return t&&e.length>0&&n.push({type:"text",value:`
`}),n}function wN(e){let t=0,n=e.charCodeAt(t);for(;n===9||n===32;)t++,n=e.charCodeAt(t);return e.slice(t)}function CN(e,t){const n=Ere(e,t),i=n.one(e,void 0),s=gre(n),r=Array.isArray(i)?{type:"root",children:i}:i||{type:"root",children:[]};return s&&r.children.push({type:"text",value:`
`},s),r}function Lre(e,t){return e&&"run"in e?async function(n,i){const s=CN(n,{file:i,...t});await e.run(s,i)}:function(n,i){return CN(n,{file:i,...e||t})}}function kN(e){if(e)throw e}var uS,TN;function Nre(){if(TN)return uS;TN=1;var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n=Object.defineProperty,i=Object.getOwnPropertyDescriptor,s=function(u){return typeof Array.isArray=="function"?Array.isArray(u):t.call(u)==="[object Array]"},r=function(u){if(!u||t.call(u)!=="[object Object]")return!1;var h=e.call(u,"constructor"),f=u.constructor&&u.constructor.prototype&&e.call(u.constructor.prototype,"isPrototypeOf");if(u.constructor&&!h&&!f)return!1;var m;for(m in u);return typeof m>"u"||e.call(u,m)},o=function(u,h){n&&h.name==="__proto__"?n(u,h.name,{enumerable:!0,configurable:!0,value:h.newValue,writable:!0}):u[h.name]=h.newValue},a=function(u,h){if(h==="__proto__")if(e.call(u,h)){if(i)return i(u,h).value}else return;return u[h]};return uS=function c(){var u,h,f,m,y,b,S=arguments[0],_=1,w=arguments.length,M=!1;for(typeof S=="boolean"&&(M=S,S=arguments[1]||{},_=2),(S==null||typeof S!="object"&&typeof S!="function")&&(S={});_<w;++_)if(u=arguments[_],u!=null)for(h in u)f=a(S,h),m=a(u,h),S!==m&&(M&&m&&(r(m)||(y=s(m)))?(y?(y=!1,b=f&&s(f)?f:[]):b=f&&r(f)?f:{},o(S,{name:h,newValue:c(M,b,m)})):typeof m<"u"&&o(S,{name:h,newValue:m}));return S},uS}var Ire=Nre();const dS=Ql(Ire);function uw(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function Dre(){const e=[],t={run:n,use:i};return t;function n(...s){let r=-1;const o=s.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);a(null,...s);function a(c,...u){const h=e[++r];let f=-1;if(c){o(c);return}for(;++f<s.length;)(u[f]===null||u[f]===void 0)&&(u[f]=s[f]);s=u,h?Ore(h,a)(...u):o(null,...u)}}function i(s){if(typeof s!="function")throw new TypeError("Expected `middelware` to be a function, not "+s);return e.push(s),t}}function Ore(e,t){let n;return i;function i(...o){const a=e.length>o.length;let c;a&&o.push(s);try{c=e.apply(this,o)}catch(u){const h=u;if(a&&n)throw h;return s(h)}a||(c&&c.then&&typeof c.then=="function"?c.then(r,s):c instanceof Error?s(c):r(c))}function s(o,...a){n||(n=!0,t(o,...a))}function r(o){s(null,o)}}const Rr={basename:jre,dirname:Bre,extname:Fre,join:Ure,sep:"/"};function jre(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');Hf(e);let n=0,i=-1,s=e.length,r;if(t===void 0||t.length===0||t.length>e.length){for(;s--;)if(e.codePointAt(s)===47){if(r){n=s+1;break}}else i<0&&(r=!0,i=s+1);return i<0?"":e.slice(n,i)}if(t===e)return"";let o=-1,a=t.length-1;for(;s--;)if(e.codePointAt(s)===47){if(r){n=s+1;break}}else o<0&&(r=!0,o=s+1),a>-1&&(e.codePointAt(s)===t.codePointAt(a--)?a<0&&(i=s):(a=-1,i=o));return n===i?i=o:i<0&&(i=e.length),e.slice(n,i)}function Bre(e){if(Hf(e),e.length===0)return".";let t=-1,n=e.length,i;for(;--n;)if(e.codePointAt(n)===47){if(i){t=n;break}}else i||(i=!0);return t<0?e.codePointAt(0)===47?"/":".":t===1&&e.codePointAt(0)===47?"//":e.slice(0,t)}function Fre(e){Hf(e);let t=e.length,n=-1,i=0,s=-1,r=0,o;for(;t--;){const a=e.codePointAt(t);if(a===47){if(o){i=t+1;break}continue}n<0&&(o=!0,n=t+1),a===46?s<0?s=t:r!==1&&(r=1):s>-1&&(r=-1)}return s<0||n<0||r===0||r===1&&s===n-1&&s===i+1?"":e.slice(s,n)}function Ure(...e){let t=-1,n;for(;++t<e.length;)Hf(e[t]),e[t]&&(n=n===void 0?e[t]:n+"/"+e[t]);return n===void 0?".":zre(n)}function zre(e){Hf(e);const t=e.codePointAt(0)===47;let n=$re(e,!t);return n.length===0&&!t&&(n="."),n.length>0&&e.codePointAt(e.length-1)===47&&(n+="/"),t?"/"+n:n}function $re(e,t){let n="",i=0,s=-1,r=0,o=-1,a,c;for(;++o<=e.length;){if(o<e.length)a=e.codePointAt(o);else{if(a===47)break;a=47}if(a===47){if(!(s===o-1||r===1))if(s!==o-1&&r===2){if(n.length<2||i!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(c=n.lastIndexOf("/"),c!==n.length-1){c<0?(n="",i=0):(n=n.slice(0,c),i=n.length-1-n.lastIndexOf("/")),s=o,r=0;continue}}else if(n.length>0){n="",i=0,s=o,r=0;continue}}t&&(n=n.length>0?n+"/..":"..",i=2)}else n.length>0?n+="/"+e.slice(s+1,o):n=e.slice(s+1,o),i=o-s-1;s=o,r=0}else a===46&&r>-1?r++:r=-1}return n}function Hf(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const qre={cwd:Hre};function Hre(){return"/"}function dw(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function Vre(e){if(typeof e=="string")e=new URL(e);else if(!dw(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if(e.protocol!=="file:"){const t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return Wre(e)}function Wre(e){if(e.hostname!==""){const i=new TypeError('File URL host must be "localhost" or empty on darwin');throw i.code="ERR_INVALID_FILE_URL_HOST",i}const t=e.pathname;let n=-1;for(;++n<t.length;)if(t.codePointAt(n)===37&&t.codePointAt(n+1)===50){const i=t.codePointAt(n+2);if(i===70||i===102){const s=new TypeError("File URL path must not include encoded / characters");throw s.code="ERR_INVALID_FILE_URL_PATH",s}}return decodeURIComponent(t)}const hS=["history","path","basename","stem","extname","dirname"];class aF{constructor(t){let n;t?dw(t)?n={path:t}:typeof t=="string"||Gre(t)?n={value:t}:n=t:n={},this.cwd="cwd"in n?"":qre.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let i=-1;for(;++i<hS.length;){const r=hS[i];r in n&&n[r]!==void 0&&n[r]!==null&&(this[r]=r==="history"?[...n[r]]:n[r])}let s;for(s in n)hS.includes(s)||(this[s]=n[s])}get basename(){return typeof this.path=="string"?Rr.basename(this.path):void 0}set basename(t){pS(t,"basename"),fS(t,"basename"),this.path=Rr.join(this.dirname||"",t)}get dirname(){return typeof this.path=="string"?Rr.dirname(this.path):void 0}set dirname(t){EN(this.basename,"dirname"),this.path=Rr.join(t||"",this.basename)}get extname(){return typeof this.path=="string"?Rr.extname(this.path):void 0}set extname(t){if(fS(t,"extname"),EN(this.dirname,"extname"),t){if(t.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Rr.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){dw(t)&&(t=Vre(t)),pS(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return typeof this.path=="string"?Rr.basename(this.path,this.extname):void 0}set stem(t){pS(t,"stem"),fS(t,"stem"),this.path=Rr.join(this.dirname||"",t+(this.extname||""))}fail(t,n,i){const s=this.message(t,n,i);throw s.fatal=!0,s}info(t,n,i){const s=this.message(t,n,i);return s.fatal=void 0,s}message(t,n,i){const s=new vi(t,n,i);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(t){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(t||void 0).decode(this.value)}}function fS(e,t){if(e&&e.includes(Rr.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+Rr.sep+"`")}function pS(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function EN(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}function Gre(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const Kre=(function(e){const i=this.constructor.prototype,s=i[e],r=function(){return s.apply(r,arguments)};return Object.setPrototypeOf(r,i),r}),Yre={}.hasOwnProperty;class Qk extends Kre{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Dre()}copy(){const t=new Qk;let n=-1;for(;++n<this.attachers.length;){const i=this.attachers[n];t.use(...i)}return t.data(dS(!0,{},this.namespace)),t}data(t,n){return typeof t=="string"?arguments.length===2?(vS("data",this.frozen),this.namespace[t]=n,this):Yre.call(this.namespace,t)&&this.namespace[t]||void 0:t?(vS("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;const t=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...i]=this.attachers[this.freezeIndex];if(i[0]===!1)continue;i[0]===!0&&(i[0]=void 0);const s=n.call(t,...i);typeof s=="function"&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();const n=Om(t),i=this.parser||this.Parser;return mS("parse",i),i(String(n),n)}process(t,n){const i=this;return this.freeze(),mS("process",this.parser||this.Parser),gS("process",this.compiler||this.Compiler),n?s(void 0,n):new Promise(s);function s(r,o){const a=Om(t),c=i.parse(a);i.run(c,a,function(h,f,m){if(h||!f||!m)return u(h);const y=f,b=i.stringify(y,m);Jre(b)?m.value=b:m.result=b,u(h,m)});function u(h,f){h||!f?o(h):r?r(f):n(void 0,f)}}}processSync(t){let n=!1,i;return this.freeze(),mS("processSync",this.parser||this.Parser),gS("processSync",this.compiler||this.Compiler),this.process(t,s),MN("processSync","process",n),i;function s(r,o){n=!0,kN(r),i=o}}run(t,n,i){RN(t),this.freeze();const s=this.transformers;return!i&&typeof n=="function"&&(i=n,n=void 0),i?r(void 0,i):new Promise(r);function r(o,a){const c=Om(n);s.run(t,c,u);function u(h,f,m){const y=f||t;h?a(h):o?o(y):i(void 0,y,m)}}}runSync(t,n){let i=!1,s;return this.run(t,n,r),MN("runSync","run",i),s;function r(o,a){kN(o),s=a,i=!0}}stringify(t,n){this.freeze();const i=Om(n),s=this.compiler||this.Compiler;return gS("stringify",s),RN(t),s(t,i)}use(t,...n){const i=this.attachers,s=this.namespace;if(vS("use",this.frozen),t!=null)if(typeof t=="function")c(t,n);else if(typeof t=="object")Array.isArray(t)?a(t):o(t);else throw new TypeError("Expected usable value, not `"+t+"`");return this;function r(u){if(typeof u=="function")c(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[h,...f]=u;c(h,f)}else o(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function o(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(u.plugins),u.settings&&(s.settings=dS(!0,s.settings,u.settings))}function a(u){let h=-1;if(u!=null)if(Array.isArray(u))for(;++h<u.length;){const f=u[h];r(f)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function c(u,h){let f=-1,m=-1;for(;++f<i.length;)if(i[f][0]===u){m=f;break}if(m===-1)i.push([u,...h]);else if(h.length>0){let[y,...b]=h;const S=i[m][1];uw(S)&&uw(y)&&(y=dS(!0,S,y)),i[m]=[u,y,...b]}}}}const Xre=new Qk().freeze();function mS(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function gS(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function vS(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function RN(e){if(!uw(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function MN(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function Om(e){return Qre(e)?e:new aF(e)}function Qre(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function Jre(e){return typeof e=="string"||Zre(e)}function Zre(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const eoe="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",AN=[],PN={allowDangerousHtml:!0},toe=/^(https?|ircs?|mailto|xmpp)$/i,noe=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function ioe(e){const t=soe(e),n=roe(e);return ooe(t.runSync(t.parse(n),n),e)}function soe(e){const t=e.rehypePlugins||AN,n=e.remarkPlugins||AN,i=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...PN}:PN;return Xre().use(jse).use(n).use(Lre,i).use(t)}function roe(e){const t=e.children||"",n=new aF;return typeof t=="string"&&(n.value=t),n}function ooe(e,t){const n=t.allowedElements,i=t.allowElement,s=t.components,r=t.disallowedElements,o=t.skipHtml,a=t.unwrapDisallowed,c=t.urlTransform||aoe;for(const h of noe)Object.hasOwn(t,h.from)&&(""+h.from+(h.to?"use `"+h.to+"` instead":"remove it")+eoe+h.id,void 0);return Xk(e,u),j3(e,{Fragment:g.Fragment,components:s,ignoreInvalidStyle:!0,jsx:g.jsx,jsxs:g.jsxs,passKeys:!0,passNode:!0});function u(h,f,m){if(h.type==="raw"&&m&&typeof f=="number")return o?m.children.splice(f,1):m.children[f]={type:"text",value:h.value},f;if(h.type==="element"){let y;for(y in aS)if(Object.hasOwn(aS,y)&&Object.hasOwn(h.properties,y)){const b=h.properties[y],S=aS[y];(S===null||S.includes(h.tagName))&&(h.properties[y]=c(String(b||""),y,h))}}if(h.type==="element"){let y=n?!n.includes(h.tagName):r?r.includes(h.tagName):!1;if(!y&&i&&typeof f=="number"&&(y=!i(h,f,m)),y&&m&&typeof f=="number")return a&&h.children?m.children.splice(f,1,...h.children):m.children.splice(f,1),f}}}function aoe(e){const t=e.indexOf(":"),n=e.indexOf("?"),i=e.indexOf("#"),s=e.indexOf("/");return t===-1||s!==-1&&t>s||n!==-1&&t>n||i!==-1&&t>i||toe.test(e.slice(0,t))?e:""}const loe=(e,t)=>typeof e=="string"?e===t:JSON.stringify(e)===JSON.stringify(t),coe=(e,t)=>{if(!e||!t)return!1;const n=i=>{const{position:s,data:r,...o}=i||{};return o};return JSON.stringify(n(e.properties))===JSON.stringify(n(t.properties))&&loe(e.children,t.children)},Jk=(e,t)=>coe(e.node,t.node),uoe=(e={})=>Object.fromEntries(Object.entries(e??{}).map(([t,n])=>{if(!n)return[t,n];const i=n,s=({node:r,...o})=>g.jsx(i,{...o});return[t,k.memo(s,Jk)]})),Zk=k.createContext(null),lF=()=>k.useContext(Zk)!==null,doe=({children:e,...t})=>g.jsx(Zk.Provider,{value:t,children:e}),hoe=k.memo(doe,Jk),foe=({node:e,...t})=>g.jsx("pre",{...t}),poe=({node:e,...t})=>g.jsx("code",{...t}),e1=({node:e,components:{Pre:t,Code:n},code:i})=>g.jsx(t,{children:g.jsx(n,{node:e,children:i})}),moe=()=>null,goe=({node:e,components:{Pre:t,Code:n,SyntaxHighlighter:i,CodeHeader:s},language:r,code:o})=>{const a=k.useMemo(()=>({Pre:t,Code:n}),[t,n]),c=r?i:e1;return g.jsxs(g.Fragment,{children:[g.jsx(s,{node:e,language:r,code:o}),g.jsx(c,{node:e,components:a,language:r??"unknown",code:o})]})};var yS={exports:{}};var LN;function voe(){return LN||(LN=1,(function(e){(function(){var t={}.hasOwnProperty;function n(){for(var r="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(r=s(r,i(a)))}return r}function i(r){if(typeof r=="string"||typeof r=="number")return r;if(typeof r!="object")return"";if(Array.isArray(r))return n.apply(null,r);if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]"))return r.toString();var o="";for(var a in r)t.call(r,a)&&r[a]&&(o=s(o,a));return o}function s(r,o){return o?r?r+" "+o:r+o:r}e.exports?(n.default=n,e.exports=n):window.classNames=n})()})(yS)),yS.exports}var yoe=voe();const cF=Ql(yoe),NN=({className:e,...t})=>({className:n,...i})=>({className:cF(e,n),...t,...i}),boe=({node:e,components:{Pre:t,Code:n,SyntaxHighlighter:i,CodeHeader:s},componentsByLanguage:r={},children:o,...a})=>{const c=k.useContext(Zk),u=NN(c),h=ur(_=>g.jsx(t,{...u(_)})),f=NN(a),m=ur(_=>g.jsx(n,{...f(_)})),y=/language-(\w+)/.exec(a.className||"")?.[1]??"";if(typeof o!="string")return g.jsx(e1,{node:e,components:{Pre:h,Code:m},code:o});const b=r[y]?.SyntaxHighlighter??i,S=r[y]?.CodeHeader??s;return g.jsx(goe,{node:e,components:{Pre:h,Code:m,SyntaxHighlighter:b,CodeHeader:S},language:y||"unknown",code:o})},_oe=({node:e,components:t,componentsByLanguage:n,...i})=>lF()?g.jsx(boe,{node:e,components:t,componentsByLanguage:n,...i}):g.jsx(t.Code,{...i}),Soe=k.memo(_oe,(e,t)=>e.components===t.components&&e.componentsByLanguage===t.componentsByLanguage&&Jk(e,t)),{useSmooth:xoe,useSmoothStatus:woe,withSmoothContextProvider:Coe}=YZ,koe=({components:e,componentsByLanguage:t,smooth:n=!0,preprocess:i,...s})=>{const r=WB(),o=k.useMemo(()=>i?{...r,text:i(r.text)}:r,[r,i]),{text:a}=xoe(o,n),{pre:c=foe,code:u=poe,SyntaxHighlighter:h=e1,CodeHeader:f=moe}=e??{},m=k.useMemo(()=>({Pre:c,Code:u,SyntaxHighlighter:h,CodeHeader:f}),[c,u,h,f]),y=ur(S=>g.jsx(Soe,{components:m,componentsByLanguage:t,...S})),b=k.useMemo(()=>{const{pre:S,code:_,SyntaxHighlighter:w,CodeHeader:M,...R}=e??{};return{...R,pre:hoe,code:y}},[y,e]);return g.jsx(ioe,{components:b,...s,children:a})},uF=k.forwardRef(({className:e,containerProps:t,containerComponent:n="div",...i},s)=>{const r=woe();return g.jsx(n,{"data-status":r.type,...t,className:cF(e,t?.className),ref:s,children:g.jsx(koe,{...i})})});uF.displayName="MarkdownTextPrimitive";const t1=Coe(uF);let Kn=class extends Error{constructor(t){super(t),this.name="ShikiError"}};function Toe(e){return n1(e)}function n1(e){return Array.isArray(e)?Eoe(e):e instanceof RegExp?e:typeof e=="object"?Roe(e):e}function Eoe(e){let t=[];for(let n=0,i=e.length;n<i;n++)t[n]=n1(e[n]);return t}function Roe(e){let t={};for(let n in e)t[n]=n1(e[n]);return t}function dF(e,...t){return t.forEach(n=>{for(let i in n)e[i]=n[i]}),e}function hF(e){const t=~e.lastIndexOf("/")||~e.lastIndexOf("\\");return t===0?e:~t===e.length-1?hF(e.substring(0,e.length-1)):e.substr(~t+1)}var bS=/\$(\d+)|\${(\d+):\/(downcase|upcase)}/g,jm=class{static hasCaptures(e){return e===null?!1:(bS.lastIndex=0,bS.test(e))}static replaceCaptures(e,t,n){return e.replace(bS,(i,s,r,o)=>{let a=n[parseInt(s||r,10)];if(a){let c=t.substring(a.start,a.end);for(;c[0]===".";)c=c.substring(1);switch(o){case"downcase":return c.toLowerCase();case"upcase":return c.toUpperCase();default:return c}}else return i})}};function fF(e,t){return e<t?-1:e>t?1:0}function pF(e,t){if(e===null&&t===null)return 0;if(!e)return-1;if(!t)return 1;let n=e.length,i=t.length;if(n===i){for(let s=0;s<n;s++){let r=fF(e[s],t[s]);if(r!==0)return r}return 0}return n-i}function IN(e){return!!(/^#[0-9a-f]{6}$/i.test(e)||/^#[0-9a-f]{8}$/i.test(e)||/^#[0-9a-f]{3}$/i.test(e)||/^#[0-9a-f]{4}$/i.test(e))}function mF(e){return e.replace(/[\-\\\{\}\*\+\?\|\^\$\.\,\[\]\(\)\#\s]/g,"\\$&")}var gF=class{constructor(e){this.fn=e}cache=new Map;get(e){if(this.cache.has(e))return this.cache.get(e);const t=this.fn(e);return this.cache.set(e,t),t}},xv=class{constructor(e,t,n){this._colorMap=e,this._defaults=t,this._root=n}static createFromRawTheme(e,t){return this.createFromParsedTheme(Poe(e),t)}static createFromParsedTheme(e,t){return Noe(e,t)}_cachedMatchRoot=new gF(e=>this._root.match(e));getColorMap(){return this._colorMap.getColorMap()}getDefaults(){return this._defaults}match(e){if(e===null)return this._defaults;const t=e.scopeName,i=this._cachedMatchRoot.get(t).find(s=>Moe(e.parent,s.parentScopes));return i?new vF(i.fontStyle,i.foreground,i.background):null}},_S=class Tg{constructor(t,n){this.parent=t,this.scopeName=n}static push(t,n){for(const i of n)t=new Tg(t,i);return t}static from(...t){let n=null;for(let i=0;i<t.length;i++)n=new Tg(n,t[i]);return n}push(t){return new Tg(this,t)}getSegments(){let t=this;const n=[];for(;t;)n.push(t.scopeName),t=t.parent;return n.reverse(),n}toString(){return this.getSegments().join(" ")}extends(t){return this===t?!0:this.parent===null?!1:this.parent.extends(t)}getExtensionIfDefined(t){const n=[];let i=this;for(;i&&i!==t;)n.push(i.scopeName),i=i.parent;return i===t?n.reverse():void 0}};function Moe(e,t){if(t.length===0)return!0;for(let n=0;n<t.length;n++){let i=t[n],s=!1;if(i===">"){if(n===t.length-1)return!1;i=t[++n],s=!0}for(;e&&!Aoe(e.scopeName,i);){if(s)return!1;e=e.parent}if(!e)return!1;e=e.parent}return!0}function Aoe(e,t){return t===e||e.startsWith(t)&&e[t.length]==="."}var vF=class{constructor(e,t,n){this.fontStyle=e,this.foregroundId=t,this.backgroundId=n}};function Poe(e){if(!e)return[];if(!e.settings||!Array.isArray(e.settings))return[];let t=e.settings,n=[],i=0;for(let s=0,r=t.length;s<r;s++){let o=t[s];if(!o.settings)continue;let a;if(typeof o.scope=="string"){let f=o.scope;f=f.replace(/^[,]+/,""),f=f.replace(/[,]+$/,""),a=f.split(",")}else Array.isArray(o.scope)?a=o.scope:a=[""];let c=-1;if(typeof o.settings.fontStyle=="string"){c=0;let f=o.settings.fontStyle.split(" ");for(let m=0,y=f.length;m<y;m++)switch(f[m]){case"italic":c=c|1;break;case"bold":c=c|2;break;case"underline":c=c|4;break;case"strikethrough":c=c|8;break}}let u=null;typeof o.settings.foreground=="string"&&IN(o.settings.foreground)&&(u=o.settings.foreground);let h=null;typeof o.settings.background=="string"&&IN(o.settings.background)&&(h=o.settings.background);for(let f=0,m=a.length;f<m;f++){let b=a[f].trim().split(" "),S=b[b.length-1],_=null;b.length>1&&(_=b.slice(0,b.length-1),_.reverse()),n[i++]=new Loe(S,_,s,c,u,h)}}return n}var Loe=class{constructor(e,t,n,i,s,r){this.scope=e,this.parentScopes=t,this.index=n,this.fontStyle=i,this.foreground=s,this.background=r}},fi=(e=>(e[e.NotSet=-1]="NotSet",e[e.None=0]="None",e[e.Italic=1]="Italic",e[e.Bold=2]="Bold",e[e.Underline=4]="Underline",e[e.Strikethrough=8]="Strikethrough",e))(fi||{});function Noe(e,t){e.sort((c,u)=>{let h=fF(c.scope,u.scope);return h!==0||(h=pF(c.parentScopes,u.parentScopes),h!==0)?h:c.index-u.index});let n=0,i="#000000",s="#ffffff";for(;e.length>=1&&e[0].scope==="";){let c=e.shift();c.fontStyle!==-1&&(n=c.fontStyle),c.foreground!==null&&(i=c.foreground),c.background!==null&&(s=c.background)}let r=new Ioe(t),o=new vF(n,r.getId(i),r.getId(s)),a=new Ooe(new hw(0,null,-1,0,0),[]);for(let c=0,u=e.length;c<u;c++){let h=e[c];a.insert(0,h.scope,h.parentScopes,h.fontStyle,r.getId(h.foreground),r.getId(h.background))}return new xv(r,o,a)}var Ioe=class{_isFrozen;_lastColorId;_id2color;_color2id;constructor(e){if(this._lastColorId=0,this._id2color=[],this._color2id=Object.create(null),Array.isArray(e)){this._isFrozen=!0;for(let t=0,n=e.length;t<n;t++)this._color2id[e[t]]=t,this._id2color[t]=e[t]}else this._isFrozen=!1}getId(e){if(e===null)return 0;e=e.toUpperCase();let t=this._color2id[e];if(t)return t;if(this._isFrozen)throw new Error(`Missing color in color map - ${e}`);return t=++this._lastColorId,this._color2id[e]=t,this._id2color[t]=e,t}getColorMap(){return this._id2color.slice(0)}},Doe=Object.freeze([]),hw=class yF{scopeDepth;parentScopes;fontStyle;foreground;background;constructor(t,n,i,s,r){this.scopeDepth=t,this.parentScopes=n||Doe,this.fontStyle=i,this.foreground=s,this.background=r}clone(){return new yF(this.scopeDepth,this.parentScopes,this.fontStyle,this.foreground,this.background)}static cloneArr(t){let n=[];for(let i=0,s=t.length;i<s;i++)n[i]=t[i].clone();return n}acceptOverwrite(t,n,i,s){this.scopeDepth>t?console.log("how did this happen?"):this.scopeDepth=t,n!==-1&&(this.fontStyle=n),i!==0&&(this.foreground=i),s!==0&&(this.background=s)}},Ooe=class fw{constructor(t,n=[],i={}){this._mainRule=t,this._children=i,this._rulesWithParentScopes=n}_rulesWithParentScopes;static _cmpBySpecificity(t,n){if(t.scopeDepth!==n.scopeDepth)return n.scopeDepth-t.scopeDepth;let i=0,s=0;for(;t.parentScopes[i]===">"&&i++,n.parentScopes[s]===">"&&s++,!(i>=t.parentScopes.length||s>=n.parentScopes.length);){const r=n.parentScopes[s].length-t.parentScopes[i].length;if(r!==0)return r;i++,s++}return n.parentScopes.length-t.parentScopes.length}match(t){if(t!==""){let i=t.indexOf("."),s,r;if(i===-1?(s=t,r=""):(s=t.substring(0,i),r=t.substring(i+1)),this._children.hasOwnProperty(s))return this._children[s].match(r)}const n=this._rulesWithParentScopes.concat(this._mainRule);return n.sort(fw._cmpBySpecificity),n}insert(t,n,i,s,r,o){if(n===""){this._doInsertHere(t,i,s,r,o);return}let a=n.indexOf("."),c,u;a===-1?(c=n,u=""):(c=n.substring(0,a),u=n.substring(a+1));let h;this._children.hasOwnProperty(c)?h=this._children[c]:(h=new fw(this._mainRule.clone(),hw.cloneArr(this._rulesWithParentScopes)),this._children[c]=h),h.insert(t+1,u,i,s,r,o)}_doInsertHere(t,n,i,s,r){if(n===null){this._mainRule.acceptOverwrite(t,i,s,r);return}for(let o=0,a=this._rulesWithParentScopes.length;o<a;o++){let c=this._rulesWithParentScopes[o];if(pF(c.parentScopes,n)===0){c.acceptOverwrite(t,i,s,r);return}}i===-1&&(i=this._mainRule.fontStyle),s===0&&(s=this._mainRule.foreground),r===0&&(r=this._mainRule.background),this._rulesWithParentScopes.push(new hw(t,n,i,s,r))}},Bu=class Ts{static toBinaryStr(t){return t.toString(2).padStart(32,"0")}static print(t){const n=Ts.getLanguageId(t),i=Ts.getTokenType(t),s=Ts.getFontStyle(t),r=Ts.getForeground(t),o=Ts.getBackground(t);console.log({languageId:n,tokenType:i,fontStyle:s,foreground:r,background:o})}static getLanguageId(t){return(t&255)>>>0}static getTokenType(t){return(t&768)>>>8}static containsBalancedBrackets(t){return(t&1024)!==0}static getFontStyle(t){return(t&30720)>>>11}static getForeground(t){return(t&16744448)>>>15}static getBackground(t){return(t&4278190080)>>>24}static set(t,n,i,s,r,o,a){let c=Ts.getLanguageId(t),u=Ts.getTokenType(t),h=Ts.containsBalancedBrackets(t)?1:0,f=Ts.getFontStyle(t),m=Ts.getForeground(t),y=Ts.getBackground(t);return n!==0&&(c=n),i!==8&&(u=i),s!==null&&(h=s?1:0),r!==-1&&(f=r),o!==0&&(m=o),a!==0&&(y=a),(c<<0|u<<8|h<<10|f<<11|m<<15|y<<24)>>>0}};function wv(e,t){const n=[],i=joe(e);let s=i.next();for(;s!==null;){let c=0;if(s.length===2&&s.charAt(1)===":"){switch(s.charAt(0)){case"R":c=1;break;case"L":c=-1;break;default:console.log(`Unknown priority ${s} in scope selector`)}s=i.next()}let u=o();if(n.push({matcher:u,priority:c}),s!==",")break;s=i.next()}return n;function r(){if(s==="-"){s=i.next();const c=r();return u=>!!c&&!c(u)}if(s==="("){s=i.next();const c=a();return s===")"&&(s=i.next()),c}if(DN(s)){const c=[];do c.push(s),s=i.next();while(DN(s));return u=>t(c,u)}return null}function o(){const c=[];let u=r();for(;u;)c.push(u),u=r();return h=>c.every(f=>f(h))}function a(){const c=[];let u=o();for(;u&&(c.push(u),s==="|"||s===",");){do s=i.next();while(s==="|"||s===",");u=o()}return h=>c.some(f=>f(h))}}function DN(e){return!!e&&!!e.match(/[\w\.:]+/)}function joe(e){let t=/([LR]:|[\w\.:][\w\.:\-]*|[\,\|\-\(\)])/g,n=t.exec(e);return{next:()=>{if(!n)return null;const i=n[0];return n=t.exec(e),i}}}function bF(e){typeof e.dispose=="function"&&e.dispose()}var wf=class{constructor(e){this.scopeName=e}toKey(){return this.scopeName}},Boe=class{constructor(e,t){this.scopeName=e,this.ruleName=t}toKey(){return`${this.scopeName}#${this.ruleName}`}},Foe=class{_references=[];_seenReferenceKeys=new Set;get references(){return this._references}visitedRule=new Set;add(e){const t=e.toKey();this._seenReferenceKeys.has(t)||(this._seenReferenceKeys.add(t),this._references.push(e))}},Uoe=class{constructor(e,t){this.repo=e,this.initialScopeName=t,this.seenFullScopeRequests.add(this.initialScopeName),this.Q=[new wf(this.initialScopeName)]}seenFullScopeRequests=new Set;seenPartialScopeRequests=new Set;Q;processQueue(){const e=this.Q;this.Q=[];const t=new Foe;for(const n of e)zoe(n,this.initialScopeName,this.repo,t);for(const n of t.references)if(n instanceof wf){if(this.seenFullScopeRequests.has(n.scopeName))continue;this.seenFullScopeRequests.add(n.scopeName),this.Q.push(n)}else{if(this.seenFullScopeRequests.has(n.scopeName)||this.seenPartialScopeRequests.has(n.toKey()))continue;this.seenPartialScopeRequests.add(n.toKey()),this.Q.push(n)}}};function zoe(e,t,n,i){const s=n.lookup(e.scopeName);if(!s){if(e.scopeName===t)throw new Error(`No grammar provided for <${t}>`);return}const r=n.lookup(t);e instanceof wf?Eg({baseGrammar:r,selfGrammar:s},i):pw(e.ruleName,{baseGrammar:r,selfGrammar:s,repository:s.repository},i);const o=n.injections(e.scopeName);if(o)for(const a of o)i.add(new wf(a))}function pw(e,t,n){if(t.repository&&t.repository[e]){const i=t.repository[e];Cv([i],t,n)}}function Eg(e,t){e.selfGrammar.patterns&&Array.isArray(e.selfGrammar.patterns)&&Cv(e.selfGrammar.patterns,{...e,repository:e.selfGrammar.repository},t),e.selfGrammar.injections&&Cv(Object.values(e.selfGrammar.injections),{...e,repository:e.selfGrammar.repository},t)}function Cv(e,t,n){for(const i of e){if(n.visitedRule.has(i))continue;n.visitedRule.add(i);const s=i.repository?dF({},t.repository,i.repository):t.repository;Array.isArray(i.patterns)&&Cv(i.patterns,{...t,repository:s},n);const r=i.include;if(!r)continue;const o=_F(r);switch(o.kind){case 0:Eg({...t,selfGrammar:t.baseGrammar},n);break;case 1:Eg(t,n);break;case 2:pw(o.ruleName,{...t,repository:s},n);break;case 3:case 4:const a=o.scopeName===t.selfGrammar.scopeName?t.selfGrammar:o.scopeName===t.baseGrammar.scopeName?t.baseGrammar:void 0;if(a){const c={baseGrammar:t.baseGrammar,selfGrammar:a,repository:s};o.kind===4?pw(o.ruleName,c,n):Eg(c,n)}else o.kind===4?n.add(new Boe(o.scopeName,o.ruleName)):n.add(new wf(o.scopeName));break}}}var $oe=class{kind=0},qoe=class{kind=1},Hoe=class{constructor(e){this.ruleName=e}kind=2},Voe=class{constructor(e){this.scopeName=e}kind=3},Woe=class{constructor(e,t){this.scopeName=e,this.ruleName=t}kind=4};function _F(e){if(e==="$base")return new $oe;if(e==="$self")return new qoe;const t=e.indexOf("#");if(t===-1)return new Voe(e);if(t===0)return new Hoe(e.substring(1));{const n=e.substring(0,t),i=e.substring(t+1);return new Woe(n,i)}}var Goe=/\\(\d+)/,ON=/\\(\d+)/g,Koe=-1,SF=-2;var Vf=class{$location;id;_nameIsCapturing;_name;_contentNameIsCapturing;_contentName;constructor(e,t,n,i){this.$location=e,this.id=t,this._name=n||null,this._nameIsCapturing=jm.hasCaptures(this._name),this._contentName=i||null,this._contentNameIsCapturing=jm.hasCaptures(this._contentName)}get debugName(){const e=this.$location?`${hF(this.$location.filename)}:${this.$location.line}`:"unknown";return`${this.constructor.name}#${this.id} @ ${e}`}getName(e,t){return!this._nameIsCapturing||this._name===null||e===null||t===null?this._name:jm.replaceCaptures(this._name,e,t)}getContentName(e,t){return!this._contentNameIsCapturing||this._contentName===null?this._contentName:jm.replaceCaptures(this._contentName,e,t)}},Yoe=class extends Vf{retokenizeCapturedWithRuleId;constructor(e,t,n,i,s){super(e,t,n,i),this.retokenizeCapturedWithRuleId=s}dispose(){}collectPatterns(e,t){throw new Error("Not supported!")}compile(e,t){throw new Error("Not supported!")}compileAG(e,t,n,i){throw new Error("Not supported!")}},Xoe=class extends Vf{_match;captures;_cachedCompiledPatterns;constructor(e,t,n,i,s){super(e,t,n,null),this._match=new Cf(i,this.id),this.captures=s,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugMatchRegExp(){return`${this._match.source}`}collectPatterns(e,t){t.push(this._match)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,n,i){return this._getCachedCompiledPatterns(e).compileAG(e,n,i)}_getCachedCompiledPatterns(e){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new kf,this.collectPatterns(e,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}},jN=class extends Vf{hasMissingPatterns;patterns;_cachedCompiledPatterns;constructor(e,t,n,i,s){super(e,t,n,i),this.patterns=s.patterns,this.hasMissingPatterns=s.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}collectPatterns(e,t){for(const n of this.patterns)e.getRule(n).collectPatterns(e,t)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,n,i){return this._getCachedCompiledPatterns(e).compileAG(e,n,i)}_getCachedCompiledPatterns(e){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new kf,this.collectPatterns(e,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}},mw=class extends Vf{_begin;beginCaptures;_end;endHasBackReferences;endCaptures;applyEndPatternLast;hasMissingPatterns;patterns;_cachedCompiledPatterns;constructor(e,t,n,i,s,r,o,a,c,u){super(e,t,n,i),this._begin=new Cf(s,this.id),this.beginCaptures=r,this._end=new Cf(o||"",-1),this.endHasBackReferences=this._end.hasBackReferences,this.endCaptures=a,this.applyEndPatternLast=c||!1,this.patterns=u.patterns,this.hasMissingPatterns=u.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugEndRegExp(){return`${this._end.source}`}getEndWithResolvedBackReferences(e,t){return this._end.resolveBackReferences(e,t)}collectPatterns(e,t){t.push(this._begin)}compile(e,t){return this._getCachedCompiledPatterns(e,t).compile(e)}compileAG(e,t,n,i){return this._getCachedCompiledPatterns(e,t).compileAG(e,n,i)}_getCachedCompiledPatterns(e,t){if(!this._cachedCompiledPatterns){this._cachedCompiledPatterns=new kf;for(const n of this.patterns)e.getRule(n).collectPatterns(e,this._cachedCompiledPatterns);this.applyEndPatternLast?this._cachedCompiledPatterns.push(this._end.hasBackReferences?this._end.clone():this._end):this._cachedCompiledPatterns.unshift(this._end.hasBackReferences?this._end.clone():this._end)}return this._end.hasBackReferences&&(this.applyEndPatternLast?this._cachedCompiledPatterns.setSource(this._cachedCompiledPatterns.length()-1,t):this._cachedCompiledPatterns.setSource(0,t)),this._cachedCompiledPatterns}},kv=class extends Vf{_begin;beginCaptures;whileCaptures;_while;whileHasBackReferences;hasMissingPatterns;patterns;_cachedCompiledPatterns;_cachedCompiledWhilePatterns;constructor(e,t,n,i,s,r,o,a,c){super(e,t,n,i),this._begin=new Cf(s,this.id),this.beginCaptures=r,this.whileCaptures=a,this._while=new Cf(o,SF),this.whileHasBackReferences=this._while.hasBackReferences,this.patterns=c.patterns,this.hasMissingPatterns=c.hasMissingPatterns,this._cachedCompiledPatterns=null,this._cachedCompiledWhilePatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null),this._cachedCompiledWhilePatterns&&(this._cachedCompiledWhilePatterns.dispose(),this._cachedCompiledWhilePatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugWhileRegExp(){return`${this._while.source}`}getWhileWithResolvedBackReferences(e,t){return this._while.resolveBackReferences(e,t)}collectPatterns(e,t){t.push(this._begin)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,n,i){return this._getCachedCompiledPatterns(e).compileAG(e,n,i)}_getCachedCompiledPatterns(e){if(!this._cachedCompiledPatterns){this._cachedCompiledPatterns=new kf;for(const t of this.patterns)e.getRule(t).collectPatterns(e,this._cachedCompiledPatterns)}return this._cachedCompiledPatterns}compileWhile(e,t){return this._getCachedCompiledWhilePatterns(e,t).compile(e)}compileWhileAG(e,t,n,i){return this._getCachedCompiledWhilePatterns(e,t).compileAG(e,n,i)}_getCachedCompiledWhilePatterns(e,t){return this._cachedCompiledWhilePatterns||(this._cachedCompiledWhilePatterns=new kf,this._cachedCompiledWhilePatterns.push(this._while.hasBackReferences?this._while.clone():this._while)),this._while.hasBackReferences&&this._cachedCompiledWhilePatterns.setSource(0,t||""),this._cachedCompiledWhilePatterns}},xF=class ui{static createCaptureRule(t,n,i,s,r){return t.registerRule(o=>new Yoe(n,o,i,s,r))}static getCompiledRuleId(t,n,i){return t.id||n.registerRule(s=>{if(t.id=s,t.match)return new Xoe(t.$vscodeTextmateLocation,t.id,t.name,t.match,ui._compileCaptures(t.captures,n,i));if(typeof t.begin>"u"){t.repository&&(i=dF({},i,t.repository));let r=t.patterns;return typeof r>"u"&&t.include&&(r=[{include:t.include}]),new jN(t.$vscodeTextmateLocation,t.id,t.name,t.contentName,ui._compilePatterns(r,n,i))}return t.while?new kv(t.$vscodeTextmateLocation,t.id,t.name,t.contentName,t.begin,ui._compileCaptures(t.beginCaptures||t.captures,n,i),t.while,ui._compileCaptures(t.whileCaptures||t.captures,n,i),ui._compilePatterns(t.patterns,n,i)):new mw(t.$vscodeTextmateLocation,t.id,t.name,t.contentName,t.begin,ui._compileCaptures(t.beginCaptures||t.captures,n,i),t.end,ui._compileCaptures(t.endCaptures||t.captures,n,i),t.applyEndPatternLast,ui._compilePatterns(t.patterns,n,i))}),t.id}static _compileCaptures(t,n,i){let s=[];if(t){let r=0;for(const o in t){if(o==="$vscodeTextmateLocation")continue;const a=parseInt(o,10);a>r&&(r=a)}for(let o=0;o<=r;o++)s[o]=null;for(const o in t){if(o==="$vscodeTextmateLocation")continue;const a=parseInt(o,10);let c=0;t[o].patterns&&(c=ui.getCompiledRuleId(t[o],n,i)),s[a]=ui.createCaptureRule(n,t[o].$vscodeTextmateLocation,t[o].name,t[o].contentName,c)}}return s}static _compilePatterns(t,n,i){let s=[];if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r];let c=-1;if(a.include){const u=_F(a.include);switch(u.kind){case 0:case 1:c=ui.getCompiledRuleId(i[a.include],n,i);break;case 2:let h=i[u.ruleName];h&&(c=ui.getCompiledRuleId(h,n,i));break;case 3:case 4:const f=u.scopeName,m=u.kind===4?u.ruleName:null,y=n.getExternalGrammar(f,i);if(y)if(m){let b=y.repository[m];b&&(c=ui.getCompiledRuleId(b,n,y.repository))}else c=ui.getCompiledRuleId(y.repository.$self,n,y.repository);break}}else c=ui.getCompiledRuleId(a,n,i);if(c!==-1){const u=n.getRule(c);let h=!1;if((u instanceof jN||u instanceof mw||u instanceof kv)&&u.hasMissingPatterns&&u.patterns.length===0&&(h=!0),h)continue;s.push(c)}}return{patterns:s,hasMissingPatterns:(t?t.length:0)!==s.length}}},Cf=class wF{source;ruleId;hasAnchor;hasBackReferences;_anchorCache;constructor(t,n){if(t&&typeof t=="string"){const i=t.length;let s=0,r=[],o=!1;for(let a=0;a<i;a++)if(t.charAt(a)==="\\"&&a+1<i){const u=t.charAt(a+1);u==="z"?(r.push(t.substring(s,a)),r.push("$(?!\\n)(?<!\\n)"),s=a+2):(u==="A"||u==="G")&&(o=!0),a++}this.hasAnchor=o,s===0?this.source=t:(r.push(t.substring(s,i)),this.source=r.join(""))}else this.hasAnchor=!1,this.source=t;this.hasAnchor?this._anchorCache=this._buildAnchorCache():this._anchorCache=null,this.ruleId=n,typeof this.source=="string"?this.hasBackReferences=Goe.test(this.source):this.hasBackReferences=!1}clone(){return new wF(this.source,this.ruleId)}setSource(t){this.source!==t&&(this.source=t,this.hasAnchor&&(this._anchorCache=this._buildAnchorCache()))}resolveBackReferences(t,n){if(typeof this.source!="string")throw new Error("This method should only be called if the source is a string");let i=n.map(s=>t.substring(s.start,s.end));return ON.lastIndex=0,this.source.replace(ON,(s,r)=>mF(i[parseInt(r,10)]||""))}_buildAnchorCache(){if(typeof this.source!="string")throw new Error("This method should only be called if the source is a string");let t=[],n=[],i=[],s=[],r,o,a,c;for(r=0,o=this.source.length;r<o;r++)a=this.source.charAt(r),t[r]=a,n[r]=a,i[r]=a,s[r]=a,a==="\\"&&r+1<o&&(c=this.source.charAt(r+1),c==="A"?(t[r+1]="",n[r+1]="",i[r+1]="A",s[r+1]="A"):c==="G"?(t[r+1]="",n[r+1]="G",i[r+1]="",s[r+1]="G"):(t[r+1]=c,n[r+1]=c,i[r+1]=c,s[r+1]=c),r++);return{A0_G0:t.join(""),A0_G1:n.join(""),A1_G0:i.join(""),A1_G1:s.join("")}}resolveAnchors(t,n){return!this.hasAnchor||!this._anchorCache||typeof this.source!="string"?this.source:t?n?this._anchorCache.A1_G1:this._anchorCache.A1_G0:n?this._anchorCache.A0_G1:this._anchorCache.A0_G0}},kf=class{_items;_hasAnchors;_cached;_anchorCache;constructor(){this._items=[],this._hasAnchors=!1,this._cached=null,this._anchorCache={A0_G0:null,A0_G1:null,A1_G0:null,A1_G1:null}}dispose(){this._disposeCaches()}_disposeCaches(){this._cached&&(this._cached.dispose(),this._cached=null),this._anchorCache.A0_G0&&(this._anchorCache.A0_G0.dispose(),this._anchorCache.A0_G0=null),this._anchorCache.A0_G1&&(this._anchorCache.A0_G1.dispose(),this._anchorCache.A0_G1=null),this._anchorCache.A1_G0&&(this._anchorCache.A1_G0.dispose(),this._anchorCache.A1_G0=null),this._anchorCache.A1_G1&&(this._anchorCache.A1_G1.dispose(),this._anchorCache.A1_G1=null)}push(e){this._items.push(e),this._hasAnchors=this._hasAnchors||e.hasAnchor}unshift(e){this._items.unshift(e),this._hasAnchors=this._hasAnchors||e.hasAnchor}length(){return this._items.length}setSource(e,t){this._items[e].source!==t&&(this._disposeCaches(),this._items[e].setSource(t))}compile(e){if(!this._cached){let t=this._items.map(n=>n.source);this._cached=new BN(e,t,this._items.map(n=>n.ruleId))}return this._cached}compileAG(e,t,n){return this._hasAnchors?t?n?(this._anchorCache.A1_G1||(this._anchorCache.A1_G1=this._resolveAnchors(e,t,n)),this._anchorCache.A1_G1):(this._anchorCache.A1_G0||(this._anchorCache.A1_G0=this._resolveAnchors(e,t,n)),this._anchorCache.A1_G0):n?(this._anchorCache.A0_G1||(this._anchorCache.A0_G1=this._resolveAnchors(e,t,n)),this._anchorCache.A0_G1):(this._anchorCache.A0_G0||(this._anchorCache.A0_G0=this._resolveAnchors(e,t,n)),this._anchorCache.A0_G0):this.compile(e)}_resolveAnchors(e,t,n){let i=this._items.map(s=>s.resolveAnchors(t,n));return new BN(e,i,this._items.map(s=>s.ruleId))}},BN=class{constructor(e,t,n){this.regExps=t,this.rules=n,this.scanner=e.createOnigScanner(t)}scanner;dispose(){typeof this.scanner.dispose=="function"&&this.scanner.dispose()}toString(){const e=[];for(let t=0,n=this.rules.length;t<n;t++)e.push("   - "+this.rules[t]+": "+this.regExps[t]);return e.join(`
`)}findNextMatchSync(e,t,n){const i=this.scanner.findNextMatchSync(e,t,n);return i?{ruleId:this.rules[i.index],captureIndices:i.captureIndices}:null}},SS=class{constructor(e,t){this.languageId=e,this.tokenType=t}},Qoe=class gw{_defaultAttributes;_embeddedLanguagesMatcher;constructor(t,n){this._defaultAttributes=new SS(t,8),this._embeddedLanguagesMatcher=new Joe(Object.entries(n||{}))}getDefaultAttributes(){return this._defaultAttributes}getBasicScopeAttributes(t){return t===null?gw._NULL_SCOPE_METADATA:this._getBasicScopeAttributes.get(t)}static _NULL_SCOPE_METADATA=new SS(0,0);_getBasicScopeAttributes=new gF(t=>{const n=this._scopeToLanguage(t),i=this._toStandardTokenType(t);return new SS(n,i)});_scopeToLanguage(t){return this._embeddedLanguagesMatcher.match(t)||0}_toStandardTokenType(t){const n=t.match(gw.STANDARD_TOKEN_TYPE_REGEXP);if(!n)return 8;switch(n[1]){case"comment":return 1;case"string":return 2;case"regex":return 3;case"meta.embedded":return 0}throw new Error("Unexpected match for standard token type!")}static STANDARD_TOKEN_TYPE_REGEXP=/\b(comment|string|regex|meta\.embedded)\b/},Joe=class{values;scopesRegExp;constructor(e){if(e.length===0)this.values=null,this.scopesRegExp=null;else{this.values=new Map(e);const t=e.map(([n,i])=>mF(n));t.sort(),t.reverse(),this.scopesRegExp=new RegExp(`^((${t.join(")|(")}))($|\\.)`,"")}}match(e){if(!this.scopesRegExp)return;const t=e.match(this.scopesRegExp);if(t)return this.values.get(t[1])}},FN=class{constructor(e,t){this.stack=e,this.stoppedEarly=t}};function CF(e,t,n,i,s,r,o,a){const c=t.content.length;let u=!1,h=-1;if(o){const y=Zoe(e,t,n,i,s,r);s=y.stack,i=y.linePos,n=y.isFirstLine,h=y.anchorPosition}const f=Date.now();for(;!u;){if(a!==0&&Date.now()-f>a)return new FN(s,!0);m()}return new FN(s,!1);function m(){const y=eae(e,t,n,i,s,h);if(!y){r.produce(s,c),u=!0;return}const b=y.captureIndices,S=y.matchedRuleId,_=b&&b.length>0?b[0].end>i:!1;if(S===Koe){const w=s.getRule(e);r.produce(s,b[0].start),s=s.withContentNameScopesList(s.nameScopesList),wh(e,t,n,s,r,w.endCaptures,b),r.produce(s,b[0].end);const M=s;if(s=s.parent,h=M.getAnchorPos(),!_&&M.getEnterPos()===i){s=M,r.produce(s,c),u=!0;return}}else{const w=e.getRule(S);r.produce(s,b[0].start);const M=s,R=w.getName(t.content,b),E=s.contentNameScopesList.pushAttributed(R,e);if(s=s.push(S,i,h,b[0].end===c,null,E,E),w instanceof mw){const A=w;wh(e,t,n,s,r,A.beginCaptures,b),r.produce(s,b[0].end),h=b[0].end;const T=A.getContentName(t.content,b),L=E.pushAttributed(T,e);if(s=s.withContentNameScopesList(L),A.endHasBackReferences&&(s=s.withEndRule(A.getEndWithResolvedBackReferences(t.content,b))),!_&&M.hasSameRuleAs(s)){s=s.pop(),r.produce(s,c),u=!0;return}}else if(w instanceof kv){const A=w;wh(e,t,n,s,r,A.beginCaptures,b),r.produce(s,b[0].end),h=b[0].end;const T=A.getContentName(t.content,b),L=E.pushAttributed(T,e);if(s=s.withContentNameScopesList(L),A.whileHasBackReferences&&(s=s.withEndRule(A.getWhileWithResolvedBackReferences(t.content,b))),!_&&M.hasSameRuleAs(s)){s=s.pop(),r.produce(s,c),u=!0;return}}else if(wh(e,t,n,s,r,w.captures,b),r.produce(s,b[0].end),s=s.pop(),!_){s=s.safePop(),r.produce(s,c),u=!0;return}}b[0].end>i&&(i=b[0].end,n=!1)}}function Zoe(e,t,n,i,s,r){let o=s.beginRuleCapturedEOL?0:-1;const a=[];for(let c=s;c;c=c.pop()){const u=c.getRule(e);u instanceof kv&&a.push({rule:u,stack:c})}for(let c=a.pop();c;c=a.pop()){const{ruleScanner:u,findOptions:h}=iae(c.rule,e,c.stack.endRule,n,i===o),f=u.findNextMatchSync(t,i,h);if(f){if(f.ruleId!==SF){s=c.stack.pop();break}f.captureIndices&&f.captureIndices.length&&(r.produce(c.stack,f.captureIndices[0].start),wh(e,t,n,c.stack,r,c.rule.whileCaptures,f.captureIndices),r.produce(c.stack,f.captureIndices[0].end),o=f.captureIndices[0].end,f.captureIndices[0].end>i&&(i=f.captureIndices[0].end,n=!1))}else{s=c.stack.pop();break}}return{stack:s,linePos:i,anchorPosition:o,isFirstLine:n}}function eae(e,t,n,i,s,r){const o=tae(e,t,n,i,s,r),a=e.getInjections();if(a.length===0)return o;const c=nae(a,e,t,n,i,s,r);if(!c)return o;if(!o)return c;const u=o.captureIndices[0].start,h=c.captureIndices[0].start;return h<u||c.priorityMatch&&h===u?c:o}function tae(e,t,n,i,s,r){const o=s.getRule(e),{ruleScanner:a,findOptions:c}=kF(o,e,s.endRule,n,i===r),u=a.findNextMatchSync(t,i,c);return u?{captureIndices:u.captureIndices,matchedRuleId:u.ruleId}:null}function nae(e,t,n,i,s,r,o){let a=Number.MAX_VALUE,c=null,u,h=0;const f=r.contentNameScopesList.getScopeNames();for(let m=0,y=e.length;m<y;m++){const b=e[m];if(!b.matcher(f))continue;const S=t.getRule(b.ruleId),{ruleScanner:_,findOptions:w}=kF(S,t,null,i,s===o),M=_.findNextMatchSync(n,s,w);if(!M)continue;const R=M.captureIndices[0].start;if(!(R>=a)&&(a=R,c=M.captureIndices,u=M.ruleId,h=b.priority,a===s))break}return c?{priorityMatch:h===-1,captureIndices:c,matchedRuleId:u}:null}function kF(e,t,n,i,s){return{ruleScanner:e.compileAG(t,n,i,s),findOptions:0}}function iae(e,t,n,i,s){return{ruleScanner:e.compileWhileAG(t,n,i,s),findOptions:0}}function wh(e,t,n,i,s,r,o){if(r.length===0)return;const a=t.content,c=Math.min(r.length,o.length),u=[],h=o[0].end;for(let f=0;f<c;f++){const m=r[f];if(m===null)continue;const y=o[f];if(y.length===0)continue;if(y.start>h)break;for(;u.length>0&&u[u.length-1].endPos<=y.start;)s.produceFromScopes(u[u.length-1].scopes,u[u.length-1].endPos),u.pop();if(u.length>0?s.produceFromScopes(u[u.length-1].scopes,y.start):s.produce(i,y.start),m.retokenizeCapturedWithRuleId){const S=m.getName(a,o),_=i.contentNameScopesList.pushAttributed(S,e),w=m.getContentName(a,o),M=_.pushAttributed(w,e),R=i.push(m.retokenizeCapturedWithRuleId,y.start,-1,!1,null,_,M),E=e.createOnigString(a.substring(0,y.end));CF(e,E,n&&y.start===0,y.start,R,s,!1,0),bF(E);continue}const b=m.getName(a,o);if(b!==null){const _=(u.length>0?u[u.length-1].scopes:i.contentNameScopesList).pushAttributed(b,e);u.push(new sae(_,y.end))}}for(;u.length>0;)s.produceFromScopes(u[u.length-1].scopes,u[u.length-1].endPos),u.pop()}var sae=class{scopes;endPos;constructor(e,t){this.scopes=e,this.endPos=t}};function rae(e,t,n,i,s,r,o,a){return new aae(e,t,n,i,s,r,o,a)}function UN(e,t,n,i,s){const r=wv(t,Tv),o=xF.getCompiledRuleId(n,i,s.repository);for(const a of r)e.push({debugSelector:t,matcher:a.matcher,ruleId:o,grammar:s,priority:a.priority})}function Tv(e,t){if(t.length<e.length)return!1;let n=0;return e.every(i=>{for(let s=n;s<t.length;s++)if(oae(t[s],i))return n=s+1,!0;return!1})}function oae(e,t){if(!e)return!1;if(e===t)return!0;const n=t.length;return e.length>n&&e.substr(0,n)===t&&e[n]==="."}var aae=class{constructor(e,t,n,i,s,r,o,a){if(this._rootScopeName=e,this.balancedBracketSelectors=r,this._onigLib=a,this._basicScopeAttributesProvider=new Qoe(n,i),this._rootId=-1,this._lastRuleId=0,this._ruleId2desc=[null],this._includedGrammars={},this._grammarRepository=o,this._grammar=zN(t,null),this._injections=null,this._tokenTypeMatchers=[],s)for(const c of Object.keys(s)){const u=wv(c,Tv);for(const h of u)this._tokenTypeMatchers.push({matcher:h.matcher,type:s[c]})}}_rootId;_lastRuleId;_ruleId2desc;_includedGrammars;_grammarRepository;_grammar;_injections;_basicScopeAttributesProvider;_tokenTypeMatchers;get themeProvider(){return this._grammarRepository}dispose(){for(const e of this._ruleId2desc)e&&e.dispose()}createOnigScanner(e){return this._onigLib.createOnigScanner(e)}createOnigString(e){return this._onigLib.createOnigString(e)}getMetadataForScope(e){return this._basicScopeAttributesProvider.getBasicScopeAttributes(e)}_collectInjections(){const e={lookup:s=>s===this._rootScopeName?this._grammar:this.getExternalGrammar(s),injections:s=>this._grammarRepository.injections(s)},t=[],n=this._rootScopeName,i=e.lookup(n);if(i){const s=i.injections;if(s)for(let o in s)UN(t,o,s[o],this,i);const r=this._grammarRepository.injections(n);r&&r.forEach(o=>{const a=this.getExternalGrammar(o);if(a){const c=a.injectionSelector;c&&UN(t,c,a,this,a)}})}return t.sort((s,r)=>s.priority-r.priority),t}getInjections(){return this._injections===null&&(this._injections=this._collectInjections()),this._injections}registerRule(e){const t=++this._lastRuleId,n=e(t);return this._ruleId2desc[t]=n,n}getRule(e){return this._ruleId2desc[e]}getExternalGrammar(e,t){if(this._includedGrammars[e])return this._includedGrammars[e];if(this._grammarRepository){const n=this._grammarRepository.lookup(e);if(n)return this._includedGrammars[e]=zN(n,t&&t.$base),this._includedGrammars[e]}}tokenizeLine(e,t,n=0){const i=this._tokenize(e,t,!1,n);return{tokens:i.lineTokens.getResult(i.ruleStack,i.lineLength),ruleStack:i.ruleStack,stoppedEarly:i.stoppedEarly}}tokenizeLine2(e,t,n=0){const i=this._tokenize(e,t,!0,n);return{tokens:i.lineTokens.getBinaryResult(i.ruleStack,i.lineLength),ruleStack:i.ruleStack,stoppedEarly:i.stoppedEarly}}_tokenize(e,t,n,i){this._rootId===-1&&(this._rootId=xF.getCompiledRuleId(this._grammar.repository.$self,this,this._grammar.repository),this.getInjections());let s;if(!t||t===vw.NULL){s=!0;const u=this._basicScopeAttributesProvider.getDefaultAttributes(),h=this.themeProvider.getDefaults(),f=Bu.set(0,u.languageId,u.tokenType,null,h.fontStyle,h.foregroundId,h.backgroundId),m=this.getRule(this._rootId).getName(null,null);let y;m?y=Kh.createRootAndLookUpScopeName(m,f,this):y=Kh.createRoot("unknown",f),t=new vw(null,this._rootId,-1,-1,!1,null,y,y)}else s=!1,t.reset();e=e+`
`;const r=this.createOnigString(e),o=r.content.length,a=new cae(n,e,this._tokenTypeMatchers,this.balancedBracketSelectors),c=CF(this,r,s,0,t,a,!0,i);return bF(r),{lineLength:o,lineTokens:a,ruleStack:c.stack,stoppedEarly:c.stoppedEarly}}};function zN(e,t){return e=Toe(e),e.repository=e.repository||{},e.repository.$self={$vscodeTextmateLocation:e.$vscodeTextmateLocation,patterns:e.patterns,name:e.scopeName},e.repository.$base=t||e.repository.$self,e}var Kh=class kr{constructor(t,n,i){this.parent=t,this.scopePath=n,this.tokenAttributes=i}static fromExtension(t,n){let i=t,s=t?.scopePath??null;for(const r of n)s=_S.push(s,r.scopeNames),i=new kr(i,s,r.encodedTokenAttributes);return i}static createRoot(t,n){return new kr(null,new _S(null,t),n)}static createRootAndLookUpScopeName(t,n,i){const s=i.getMetadataForScope(t),r=new _S(null,t),o=i.themeProvider.themeMatch(r),a=kr.mergeAttributes(n,s,o);return new kr(null,r,a)}get scopeName(){return this.scopePath.scopeName}toString(){return this.getScopeNames().join(" ")}equals(t){return kr.equals(this,t)}static equals(t,n){do{if(t===n||!t&&!n)return!0;if(!t||!n||t.scopeName!==n.scopeName||t.tokenAttributes!==n.tokenAttributes)return!1;t=t.parent,n=n.parent}while(!0)}static mergeAttributes(t,n,i){let s=-1,r=0,o=0;return i!==null&&(s=i.fontStyle,r=i.foregroundId,o=i.backgroundId),Bu.set(t,n.languageId,n.tokenType,null,s,r,o)}pushAttributed(t,n){if(t===null)return this;if(t.indexOf(" ")===-1)return kr._pushAttributed(this,t,n);const i=t.split(/ /g);let s=this;for(const r of i)s=kr._pushAttributed(s,r,n);return s}static _pushAttributed(t,n,i){const s=i.getMetadataForScope(n),r=t.scopePath.push(n),o=i.themeProvider.themeMatch(r),a=kr.mergeAttributes(t.tokenAttributes,s,o);return new kr(t,r,a)}getScopeNames(){return this.scopePath.getSegments()}getExtensionIfDefined(t){const n=[];let i=this;for(;i&&i!==t;)n.push({encodedTokenAttributes:i.tokenAttributes,scopeNames:i.scopePath.getExtensionIfDefined(i.parent?.scopePath??null)}),i=i.parent;return i===t?n.reverse():void 0}},vw=class Cl{constructor(t,n,i,s,r,o,a,c){this.parent=t,this.ruleId=n,this.beginRuleCapturedEOL=r,this.endRule=o,this.nameScopesList=a,this.contentNameScopesList=c,this.depth=this.parent?this.parent.depth+1:1,this._enterPos=i,this._anchorPos=s}_stackElementBrand=void 0;static NULL=new Cl(null,0,0,0,!1,null,null,null);_enterPos;_anchorPos;depth;equals(t){return t===null?!1:Cl._equals(this,t)}static _equals(t,n){return t===n?!0:this._structuralEquals(t,n)?Kh.equals(t.contentNameScopesList,n.contentNameScopesList):!1}static _structuralEquals(t,n){do{if(t===n||!t&&!n)return!0;if(!t||!n||t.depth!==n.depth||t.ruleId!==n.ruleId||t.endRule!==n.endRule)return!1;t=t.parent,n=n.parent}while(!0)}clone(){return this}static _reset(t){for(;t;)t._enterPos=-1,t._anchorPos=-1,t=t.parent}reset(){Cl._reset(this)}pop(){return this.parent}safePop(){return this.parent?this.parent:this}push(t,n,i,s,r,o,a){return new Cl(this,t,n,i,s,r,o,a)}getEnterPos(){return this._enterPos}getAnchorPos(){return this._anchorPos}getRule(t){return t.getRule(this.ruleId)}toString(){const t=[];return this._writeString(t,0),"["+t.join(",")+"]"}_writeString(t,n){return this.parent&&(n=this.parent._writeString(t,n)),t[n++]=`(${this.ruleId}, ${this.nameScopesList?.toString()}, ${this.contentNameScopesList?.toString()})`,n}withContentNameScopesList(t){return this.contentNameScopesList===t?this:this.parent.push(this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,this.endRule,this.nameScopesList,t)}withEndRule(t){return this.endRule===t?this:new Cl(this.parent,this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,t,this.nameScopesList,this.contentNameScopesList)}hasSameRuleAs(t){let n=this;for(;n&&n._enterPos===t._enterPos;){if(n.ruleId===t.ruleId)return!0;n=n.parent}return!1}toStateStackFrame(){return{ruleId:this.ruleId,beginRuleCapturedEOL:this.beginRuleCapturedEOL,endRule:this.endRule,nameScopesList:this.nameScopesList?.getExtensionIfDefined(this.parent?.nameScopesList??null)??[],contentNameScopesList:this.contentNameScopesList?.getExtensionIfDefined(this.nameScopesList)??[]}}static pushFrame(t,n){const i=Kh.fromExtension(t?.nameScopesList??null,n.nameScopesList);return new Cl(t,n.ruleId,n.enterPos??-1,n.anchorPos??-1,n.beginRuleCapturedEOL,n.endRule,i,Kh.fromExtension(i,n.contentNameScopesList))}},lae=class{balancedBracketScopes;unbalancedBracketScopes;allowAny=!1;constructor(e,t){this.balancedBracketScopes=e.flatMap(n=>n==="*"?(this.allowAny=!0,[]):wv(n,Tv).map(i=>i.matcher)),this.unbalancedBracketScopes=t.flatMap(n=>wv(n,Tv).map(i=>i.matcher))}get matchesAlways(){return this.allowAny&&this.unbalancedBracketScopes.length===0}get matchesNever(){return this.balancedBracketScopes.length===0&&!this.allowAny}match(e){for(const t of this.unbalancedBracketScopes)if(t(e))return!1;for(const t of this.balancedBracketScopes)if(t(e))return!0;return this.allowAny}},cae=class{constructor(e,t,n,i){this.balancedBracketSelectors=i,this._emitBinaryTokens=e,this._tokenTypeOverrides=n,this._lineText=null,this._tokens=[],this._binaryTokens=[],this._lastTokenEndIndex=0}_emitBinaryTokens;_lineText;_tokens;_binaryTokens;_lastTokenEndIndex;_tokenTypeOverrides;produce(e,t){this.produceFromScopes(e.contentNameScopesList,t)}produceFromScopes(e,t){if(this._lastTokenEndIndex>=t)return;if(this._emitBinaryTokens){let i=e?.tokenAttributes??0,s=!1;if(this.balancedBracketSelectors?.matchesAlways&&(s=!0),this._tokenTypeOverrides.length>0||this.balancedBracketSelectors&&!this.balancedBracketSelectors.matchesAlways&&!this.balancedBracketSelectors.matchesNever){const r=e?.getScopeNames()??[];for(const o of this._tokenTypeOverrides)o.matcher(r)&&(i=Bu.set(i,0,o.type,null,-1,0,0));this.balancedBracketSelectors&&(s=this.balancedBracketSelectors.match(r))}if(s&&(i=Bu.set(i,0,8,s,-1,0,0)),this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-1]===i){this._lastTokenEndIndex=t;return}this._binaryTokens.push(this._lastTokenEndIndex),this._binaryTokens.push(i),this._lastTokenEndIndex=t;return}const n=e?.getScopeNames()??[];this._tokens.push({startIndex:this._lastTokenEndIndex,endIndex:t,scopes:n}),this._lastTokenEndIndex=t}getResult(e,t){return this._tokens.length>0&&this._tokens[this._tokens.length-1].startIndex===t-1&&this._tokens.pop(),this._tokens.length===0&&(this._lastTokenEndIndex=-1,this.produce(e,t),this._tokens[this._tokens.length-1].startIndex=0),this._tokens}getBinaryResult(e,t){this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-2]===t-1&&(this._binaryTokens.pop(),this._binaryTokens.pop()),this._binaryTokens.length===0&&(this._lastTokenEndIndex=-1,this.produce(e,t),this._binaryTokens[this._binaryTokens.length-2]=0);const n=new Uint32Array(this._binaryTokens.length);for(let i=0,s=this._binaryTokens.length;i<s;i++)n[i]=this._binaryTokens[i];return n}},uae=class{constructor(e,t){this._onigLib=t,this._theme=e}_grammars=new Map;_rawGrammars=new Map;_injectionGrammars=new Map;_theme;dispose(){for(const e of this._grammars.values())e.dispose()}setTheme(e){this._theme=e}getColorMap(){return this._theme.getColorMap()}addGrammar(e,t){this._rawGrammars.set(e.scopeName,e),t&&this._injectionGrammars.set(e.scopeName,t)}lookup(e){return this._rawGrammars.get(e)}injections(e){return this._injectionGrammars.get(e)}getDefaults(){return this._theme.getDefaults()}themeMatch(e){return this._theme.match(e)}grammarForScopeName(e,t,n,i,s){if(!this._grammars.has(e)){let r=this._rawGrammars.get(e);if(!r)return null;this._grammars.set(e,rae(e,r,t,n,i,s,this,this._onigLib))}return this._grammars.get(e)}},dae=class{_options;_syncRegistry;_ensureGrammarCache;constructor(t){this._options=t,this._syncRegistry=new uae(xv.createFromRawTheme(t.theme,t.colorMap),t.onigLib),this._ensureGrammarCache=new Map}dispose(){this._syncRegistry.dispose()}setTheme(t,n){this._syncRegistry.setTheme(xv.createFromRawTheme(t,n))}getColorMap(){return this._syncRegistry.getColorMap()}loadGrammarWithEmbeddedLanguages(t,n,i){return this.loadGrammarWithConfiguration(t,n,{embeddedLanguages:i})}loadGrammarWithConfiguration(t,n,i){return this._loadGrammar(t,n,i.embeddedLanguages,i.tokenTypes,new lae(i.balancedBracketSelectors||[],i.unbalancedBracketSelectors||[]))}loadGrammar(t){return this._loadGrammar(t,0,null,null,null)}_loadGrammar(t,n,i,s,r){const o=new Uoe(this._syncRegistry,t);for(;o.Q.length>0;)o.Q.map(a=>this._loadSingleGrammar(a.scopeName)),o.processQueue();return this._grammarForScopeName(t,n,i,s,r)}_loadSingleGrammar(t){this._ensureGrammarCache.has(t)||(this._doLoadSingleGrammar(t),this._ensureGrammarCache.set(t,!0))}_doLoadSingleGrammar(t){const n=this._options.loadGrammar(t);if(n){const i=typeof this._options.getInjections=="function"?this._options.getInjections(t):void 0;this._syncRegistry.addGrammar(n,i)}}addGrammar(t,n=[],i=0,s=null){return this._syncRegistry.addGrammar(t,n),this._grammarForScopeName(t.scopeName,i,s)}_grammarForScopeName(t,n=0,i=null,s=null,r=null){return this._syncRegistry.grammarForScopeName(t,n,i,s,r)}},yw=vw.NULL;const hae=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"],$N={}.hasOwnProperty;function fae(e,t){const n=t||{};function i(s,...r){let o=i.invalid;const a=i.handlers;if(s&&$N.call(s,e)){const c=String(s[e]);o=$N.call(a,c)?a[c]:i.unknown}if(o)return o.call(this,s,...r)}return i.handlers=n.handlers||{},i.invalid=n.invalid,i.unknown=n.unknown,i}const pae=/["&'<>`]/g,mae=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,gae=/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,vae=/[|\\{}()[\]^$+*?.]/g,qN=new WeakMap;function yae(e,t){if(e=e.replace(t.subset?bae(t.subset):pae,i),t.subset||t.escapeOnly)return e;return e.replace(mae,n).replace(gae,i);function n(s,r,o){return t.format((s.charCodeAt(0)-55296)*1024+s.charCodeAt(1)-56320+65536,o.charCodeAt(r+2),t)}function i(s,r,o){return t.format(s.charCodeAt(0),o.charCodeAt(r+1),t)}}function bae(e){let t=qN.get(e);return t||(t=_ae(e),qN.set(e,t)),t}function _ae(e){const t=[];let n=-1;for(;++n<e.length;)t.push(e[n].replace(vae,"\\$&"));return new RegExp("(?:"+t.join("|")+")","g")}const Sae=/[\dA-Fa-f]/;function xae(e,t,n){const i="&#x"+e.toString(16).toUpperCase();return n&&t&&!Sae.test(String.fromCharCode(t))?i:i+";"}const wae=/\d/;function Cae(e,t,n){const i="&#"+String(e);return n&&t&&!wae.test(String.fromCharCode(t))?i:i+";"}const kae=["AElig","AMP","Aacute","Acirc","Agrave","Aring","Atilde","Auml","COPY","Ccedil","ETH","Eacute","Ecirc","Egrave","Euml","GT","Iacute","Icirc","Igrave","Iuml","LT","Ntilde","Oacute","Ocirc","Ograve","Oslash","Otilde","Ouml","QUOT","REG","THORN","Uacute","Ucirc","Ugrave","Uuml","Yacute","aacute","acirc","acute","aelig","agrave","amp","aring","atilde","auml","brvbar","ccedil","cedil","cent","copy","curren","deg","divide","eacute","ecirc","egrave","eth","euml","frac12","frac14","frac34","gt","iacute","icirc","iexcl","igrave","iquest","iuml","laquo","lt","macr","micro","middot","nbsp","not","ntilde","oacute","ocirc","ograve","ordf","ordm","oslash","otilde","ouml","para","plusmn","pound","quot","raquo","reg","sect","shy","sup1","sup2","sup3","szlig","thorn","times","uacute","ucirc","ugrave","uml","uuml","yacute","yen","yuml"],xS={nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",fnof:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",bull:"",hellip:"",prime:"",Prime:"",oline:"",frasl:"",weierp:"",image:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",quot:'"',amp:"&",lt:"<",gt:">",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",permil:"",lsaquo:"",rsaquo:"",euro:""},Tae=["cent","copy","divide","gt","lt","not","para","times"],TF={}.hasOwnProperty,bw={};let Bm;for(Bm in xS)TF.call(xS,Bm)&&(bw[xS[Bm]]=Bm);const Eae=/[^\dA-Za-z]/;function Rae(e,t,n,i){const s=String.fromCharCode(e);if(TF.call(bw,s)){const r=bw[s],o="&"+r;return n&&kae.includes(r)&&!Tae.includes(r)&&(!i||t&&t!==61&&Eae.test(String.fromCharCode(t)))?o:o+";"}return""}function Mae(e,t,n){let i=xae(e,t,n.omitOptionalSemicolons),s;if((n.useNamedReferences||n.useShortestReferences)&&(s=Rae(e,t,n.omitOptionalSemicolons,n.attribute)),(n.useShortestReferences||!s)&&n.useShortestReferences){const r=Cae(e,t,n.omitOptionalSemicolons);r.length<i.length&&(i=r)}return s&&(!n.useShortestReferences||s.length<i.length)?s:i}function Ru(e,t){return yae(e,Object.assign({format:Mae},t))}const Aae=/^>|^->|<!--|-->|--!>|<!-$/g,Pae=[">"],Lae=["<",">"];function Nae(e,t,n,i){return i.settings.bogusComments?"<?"+Ru(e.value,Object.assign({},i.settings.characterReferences,{subset:Pae}))+">":"<!--"+e.value.replace(Aae,s)+"-->";function s(r){return Ru(r,Object.assign({},i.settings.characterReferences,{subset:Lae}))}}function Iae(e,t,n,i){return"<!"+(i.settings.upperDoctype?"DOCTYPE":"doctype")+(i.settings.tightDoctype?"":" ")+"html>"}function HN(e,t){const n=String(e);if(typeof t!="string")throw new TypeError("Expected character");let i=0,s=n.indexOf(t);for(;s!==-1;)i++,s=n.indexOf(t,s+t.length);return i}const Bn=RF(1),EF=RF(-1),Dae=[];function RF(e){return t;function t(n,i,s){const r=n?n.children:Dae;let o=(i||0)+e,a=r[o];if(!s)for(;a&&gy(a);)o+=e,a=r[o];return a}}const Oae={}.hasOwnProperty;function MF(e){return t;function t(n,i,s){return Oae.call(e,n.tagName)&&e[n.tagName](n,i,s)}}const i1=MF({body:Bae,caption:wS,colgroup:wS,dd:$ae,dt:zae,head:wS,html:jae,li:Uae,optgroup:qae,option:Hae,p:Fae,rp:VN,rt:VN,tbody:Wae,td:WN,tfoot:Gae,th:WN,thead:Vae,tr:Kae});function wS(e,t,n){const i=Bn(n,t,!0);return!i||i.type!=="comment"&&!(i.type==="text"&&gy(i.value.charAt(0)))}function jae(e,t,n){const i=Bn(n,t);return!i||i.type!=="comment"}function Bae(e,t,n){const i=Bn(n,t);return!i||i.type!=="comment"}function Fae(e,t,n){const i=Bn(n,t);return i?i.type==="element"&&(i.tagName==="address"||i.tagName==="article"||i.tagName==="aside"||i.tagName==="blockquote"||i.tagName==="details"||i.tagName==="div"||i.tagName==="dl"||i.tagName==="fieldset"||i.tagName==="figcaption"||i.tagName==="figure"||i.tagName==="footer"||i.tagName==="form"||i.tagName==="h1"||i.tagName==="h2"||i.tagName==="h3"||i.tagName==="h4"||i.tagName==="h5"||i.tagName==="h6"||i.tagName==="header"||i.tagName==="hgroup"||i.tagName==="hr"||i.tagName==="main"||i.tagName==="menu"||i.tagName==="nav"||i.tagName==="ol"||i.tagName==="p"||i.tagName==="pre"||i.tagName==="section"||i.tagName==="table"||i.tagName==="ul"):!n||!(n.type==="element"&&(n.tagName==="a"||n.tagName==="audio"||n.tagName==="del"||n.tagName==="ins"||n.tagName==="map"||n.tagName==="noscript"||n.tagName==="video"))}function Uae(e,t,n){const i=Bn(n,t);return!i||i.type==="element"&&i.tagName==="li"}function zae(e,t,n){const i=Bn(n,t);return!!(i&&i.type==="element"&&(i.tagName==="dt"||i.tagName==="dd"))}function $ae(e,t,n){const i=Bn(n,t);return!i||i.type==="element"&&(i.tagName==="dt"||i.tagName==="dd")}function VN(e,t,n){const i=Bn(n,t);return!i||i.type==="element"&&(i.tagName==="rp"||i.tagName==="rt")}function qae(e,t,n){const i=Bn(n,t);return!i||i.type==="element"&&i.tagName==="optgroup"}function Hae(e,t,n){const i=Bn(n,t);return!i||i.type==="element"&&(i.tagName==="option"||i.tagName==="optgroup")}function Vae(e,t,n){const i=Bn(n,t);return!!(i&&i.type==="element"&&(i.tagName==="tbody"||i.tagName==="tfoot"))}function Wae(e,t,n){const i=Bn(n,t);return!i||i.type==="element"&&(i.tagName==="tbody"||i.tagName==="tfoot")}function Gae(e,t,n){return!Bn(n,t)}function Kae(e,t,n){const i=Bn(n,t);return!i||i.type==="element"&&i.tagName==="tr"}function WN(e,t,n){const i=Bn(n,t);return!i||i.type==="element"&&(i.tagName==="td"||i.tagName==="th")}const Yae=MF({body:Jae,colgroup:Zae,head:Qae,html:Xae,tbody:ele});function Xae(e){const t=Bn(e,-1);return!t||t.type!=="comment"}function Qae(e){const t=new Set;for(const i of e.children)if(i.type==="element"&&(i.tagName==="base"||i.tagName==="title")){if(t.has(i.tagName))return!1;t.add(i.tagName)}const n=e.children[0];return!n||n.type==="element"}function Jae(e){const t=Bn(e,-1,!0);return!t||t.type!=="comment"&&!(t.type==="text"&&gy(t.value.charAt(0)))&&!(t.type==="element"&&(t.tagName==="meta"||t.tagName==="link"||t.tagName==="script"||t.tagName==="style"||t.tagName==="template"))}function Zae(e,t,n){const i=EF(n,t),s=Bn(e,-1,!0);return n&&i&&i.type==="element"&&i.tagName==="colgroup"&&i1(i,n.children.indexOf(i),n)?!1:!!(s&&s.type==="element"&&s.tagName==="col")}function ele(e,t,n){const i=EF(n,t),s=Bn(e,-1);return n&&i&&i.type==="element"&&(i.tagName==="thead"||i.tagName==="tbody")&&i1(i,n.children.indexOf(i),n)?!1:!!(s&&s.type==="element"&&s.tagName==="tr")}const Fm={name:[[`	
\f\r &/=>`.split(""),`	
\f\r "&'/=>\``.split("")],[`\0	
\f\r "&'/<=>`.split(""),`\0	
\f\r "&'/<=>\``.split("")]],unquoted:[[`	
\f\r &>`.split(""),`\0	
\f\r "&'<=>\``.split("")],[`\0	
\f\r "&'<=>\``.split(""),`\0	
\f\r "&'<=>\``.split("")]],single:[["&'".split(""),"\"&'`".split("")],["\0&'".split(""),"\0\"&'`".split("")]],double:[['"&'.split(""),"\"&'`".split("")],['\0"&'.split(""),"\0\"&'`".split("")]]};function tle(e,t,n,i){const s=i.schema,r=s.space==="svg"?!1:i.settings.omitOptionalTags;let o=s.space==="svg"?i.settings.closeEmptyElements:i.settings.voids.includes(e.tagName.toLowerCase());const a=[];let c;s.space==="html"&&e.tagName==="svg"&&(i.schema=$f);const u=nle(i,e.properties),h=i.all(s.space==="html"&&e.tagName==="template"?e.content:e);return i.schema=s,h&&(o=!1),(u||!r||!Yae(e,t,n))&&(a.push("<",e.tagName,u?" "+u:""),o&&(s.space==="svg"||i.settings.closeSelfClosing)&&(c=u.charAt(u.length-1),(!i.settings.tightSelfClosing||c==="/"||c&&c!=='"'&&c!=="'")&&a.push(" "),a.push("/")),a.push(">")),a.push(h),!o&&(!r||!i1(e,t,n))&&a.push("</"+e.tagName+">"),a.join("")}function nle(e,t){const n=[];let i=-1,s;if(t){for(s in t)if(t[s]!==null&&t[s]!==void 0){const r=ile(e,s,t[s]);r&&n.push(r)}}for(;++i<n.length;){const r=e.settings.tightAttributes?n[i].charAt(n[i].length-1):void 0;i!==n.length-1&&r!=='"'&&r!=="'"&&(n[i]+=" ")}return n.join("")}function ile(e,t,n){const i=P3(e.schema,t),s=e.settings.allowParseErrors&&e.schema.space==="html"?0:1,r=e.settings.allowDangerousCharacters?0:1;let o=e.quote,a;if(i.overloadedBoolean&&(n===i.attribute||n==="")?n=!0:(i.boolean||i.overloadedBoolean)&&(typeof n!="string"||n===i.attribute||n==="")&&(n=!!n),n==null||n===!1||typeof n=="number"&&Number.isNaN(n))return"";const c=Ru(i.attribute,Object.assign({},e.settings.characterReferences,{subset:Fm.name[s][r]}));return n===!0||(n=Array.isArray(n)?(i.commaSeparated?w3:N3)(n,{padLeft:!e.settings.tightCommaSeparatedLists}):String(n),e.settings.collapseEmptyAttributes&&!n)?c:(e.settings.preferUnquoted&&(a=Ru(n,Object.assign({},e.settings.characterReferences,{attribute:!0,subset:Fm.unquoted[s][r]}))),a!==n&&(e.settings.quoteSmart&&HN(n,o)>HN(n,e.alternative)&&(o=e.alternative),a=o+Ru(n,Object.assign({},e.settings.characterReferences,{subset:(o==="'"?Fm.single:Fm.double)[s][r],attribute:!0}))+o),c+(a&&"="+a))}const sle=["<","&"];function AF(e,t,n,i){return n&&n.type==="element"&&(n.tagName==="script"||n.tagName==="style")?e.value:Ru(e.value,Object.assign({},i.settings.characterReferences,{subset:sle}))}function rle(e,t,n,i){return i.settings.allowDangerousHtml?e.value:AF(e,t,n,i)}function ole(e,t,n,i){return i.all(e)}const ale=fae("type",{invalid:lle,unknown:cle,handlers:{comment:Nae,doctype:Iae,element:tle,raw:rle,root:ole,text:AF}});function lle(e){throw new Error("Expected node, not `"+e+"`")}function cle(e){const t=e;throw new Error("Cannot compile unknown node `"+t.type+"`")}const ule={},dle={},hle=[];function fle(e,t){const n=t||ule,i=n.quote||'"',s=i==='"'?"'":'"';if(i!=='"'&&i!=="'")throw new Error("Invalid quote `"+i+"`, expected `'` or `\"`");return{one:ple,all:mle,settings:{omitOptionalTags:n.omitOptionalTags||!1,allowParseErrors:n.allowParseErrors||!1,allowDangerousCharacters:n.allowDangerousCharacters||!1,quoteSmart:n.quoteSmart||!1,preferUnquoted:n.preferUnquoted||!1,tightAttributes:n.tightAttributes||!1,upperDoctype:n.upperDoctype||!1,tightDoctype:n.tightDoctype||!1,bogusComments:n.bogusComments||!1,tightCommaSeparatedLists:n.tightCommaSeparatedLists||!1,tightSelfClosing:n.tightSelfClosing||!1,collapseEmptyAttributes:n.collapseEmptyAttributes||!1,allowDangerousHtml:n.allowDangerousHtml||!1,voids:n.voids||hae,characterReferences:n.characterReferences||dle,closeSelfClosing:n.closeSelfClosing||!1,closeEmptyElements:n.closeEmptyElements||!1},schema:n.space==="svg"?$f:L3,quote:i,alternative:s}.one(Array.isArray(e)?{type:"root",children:e}:e,void 0,void 0)}function ple(e,t,n){return ale(e,t,n,this)}function mle(e){const t=[],n=e&&e.children||hle;let i=-1;for(;++i<n.length;)t[i]=this.one(n[i],i,e);return t.join("")}function Ev(e,t){const n=typeof e=="string"?{}:{...e.colorReplacements},i=typeof e=="string"?e:e.name;for(const[s,r]of Object.entries(t?.colorReplacements||{}))typeof r=="string"?n[s]=r:s===i&&Object.assign(n,r);return n}function Oa(e,t){return e&&(t?.[e?.toLowerCase()]||e)}function gle(e){return Array.isArray(e)?e:[e]}async function PF(e){return Promise.resolve(typeof e=="function"?e():e).then(t=>t.default||t)}function s1(e){return!e||["plaintext","txt","text","plain"].includes(e)}function vle(e){return e==="ansi"||s1(e)}function r1(e){return e==="none"}function yle(e){return r1(e)}function LF(e,t){if(!t)return e;e.properties||={},e.properties.class||=[],typeof e.properties.class=="string"&&(e.properties.class=e.properties.class.split(/\s+/g)),Array.isArray(e.properties.class)||(e.properties.class=[]);const n=Array.isArray(t)?t:t.split(/\s+/g);for(const i of n)i&&!e.properties.class.includes(i)&&e.properties.class.push(i);return e}function _y(e,t=!1){if(e.length===0)return[["",0]];const n=e.split(/(\r?\n)/g);let i=0;const s=[];for(let r=0;r<n.length;r+=2){const o=t?n[r]+(n[r+1]||""):n[r];s.push([o,i]),i+=n[r].length,i+=n[r+1]?.length||0}return s}function ble(e){const t=_y(e,!0).map(([s])=>s);function n(s){if(s===e.length)return{line:t.length-1,character:t[t.length-1].length};let r=s,o=0;for(const a of t){if(r<a.length)break;r-=a.length,o++}return{line:o,character:r}}function i(s,r){let o=0;for(let a=0;a<s;a++)o+=t[a].length;return o+=r,o}return{lines:t,indexToPos:n,posToIndex:i}}const o1="light-dark()",_le=["color","background-color"];function Sle(e,t){let n=0;const i=[];for(const s of t)s>n&&i.push({...e,content:e.content.slice(n,s),offset:e.offset+n}),n=s;return n<e.content.length&&i.push({...e,content:e.content.slice(n),offset:e.offset+n}),i}function xle(e,t){const n=Array.from(t instanceof Set?t:new Set(t)).sort((i,s)=>i-s);return n.length?e.map(i=>i.flatMap(s=>{const r=n.filter(o=>s.offset<o&&o<s.offset+s.content.length).map(o=>o-s.offset).sort((o,a)=>o-a);return r.length?Sle(s,r):s})):e}function wle(e,t,n,i,s="css-vars"){const r={content:e.content,explanation:e.explanation,offset:e.offset},o=t.map(h=>Rv(e.variants[h])),a=new Set(o.flatMap(h=>Object.keys(h))),c={},u=(h,f)=>{const m=f==="color"?"":f==="background-color"?"-bg":`-${f}`;return n+t[h]+(f==="color"?"":m)};return o.forEach((h,f)=>{for(const m of a){const y=h[m]||"inherit";if(f===0&&i&&_le.includes(m))if(i===o1&&o.length>1){const b=t.findIndex(M=>M==="light"),S=t.findIndex(M=>M==="dark");if(b===-1||S===-1)throw new Kn('When using `defaultColor: "light-dark()"`, you must provide both `light` and `dark` themes');const _=o[b][m]||"inherit",w=o[S][m]||"inherit";c[m]=`light-dark(${_}, ${w})`,s==="css-vars"&&(c[u(f,m)]=y)}else c[m]=y;else s==="css-vars"&&(c[u(f,m)]=y)}}),r.htmlStyle=c,r}function Rv(e){const t={};if(e.color&&(t.color=e.color),e.bgColor&&(t["background-color"]=e.bgColor),e.fontStyle){e.fontStyle&fi.Italic&&(t["font-style"]="italic"),e.fontStyle&fi.Bold&&(t["font-weight"]="bold");const n=[];e.fontStyle&fi.Underline&&n.push("underline"),e.fontStyle&fi.Strikethrough&&n.push("line-through"),n.length&&(t["text-decoration"]=n.join(" "))}return t}function _w(e){return typeof e=="string"?e:Object.entries(e).map(([t,n])=>`${t}:${n}`).join(";")}const NF=new WeakMap;function Sy(e,t){NF.set(e,t)}function Tf(e){return NF.get(e)}class Qu{_stacks={};lang;get themes(){return Object.keys(this._stacks)}get theme(){return this.themes[0]}get _stack(){return this._stacks[this.theme]}static initial(t,n){return new Qu(Object.fromEntries(gle(n).map(i=>[i,yw])),t)}constructor(...t){if(t.length===2){const[n,i]=t;this.lang=i,this._stacks=n}else{const[n,i,s]=t;this.lang=i,this._stacks={[s]:n}}}getInternalStack(t=this.theme){return this._stacks[t]}getScopes(t=this.theme){return Cle(this._stacks[t])}toJSON(){return{lang:this.lang,theme:this.theme,themes:this.themes,scopes:this.getScopes()}}}function Cle(e){const t=[],n=new Set;function i(s){if(n.has(s))return;n.add(s);const r=s?.nameScopesList?.scopeName;r&&t.push(r),s.parent&&i(s.parent)}return i(e),t}function kle(e,t){if(!(e instanceof Qu))throw new Kn("Invalid grammar state");return e.getInternalStack(t)}function Tle(){const e=new WeakMap;function t(n){if(!e.has(n.meta)){let i=function(o){if(typeof o=="number"){if(o<0||o>n.source.length)throw new Kn(`Invalid decoration offset: ${o}. Code length: ${n.source.length}`);return{...s.indexToPos(o),offset:o}}else{const a=s.lines[o.line];if(a===void 0)throw new Kn(`Invalid decoration position ${JSON.stringify(o)}. Lines length: ${s.lines.length}`);let c=o.character;if(c<0&&(c=a.length+c),c<0||c>a.length)throw new Kn(`Invalid decoration position ${JSON.stringify(o)}. Line ${o.line} length: ${a.length}`);return{...o,character:c,offset:s.posToIndex(o.line,c)}}};const s=ble(n.source),r=(n.options.decorations||[]).map(o=>({...o,start:i(o.start),end:i(o.end)}));Ele(r),e.set(n.meta,{decorations:r,converter:s,source:n.source})}return e.get(n.meta)}return{name:"shiki:decorations",tokens(n){if(!this.options.decorations?.length)return;const s=t(this).decorations.flatMap(o=>[o.start.offset,o.end.offset]);return xle(n,s)},code(n){if(!this.options.decorations?.length)return;const i=t(this),s=Array.from(n.children).filter(h=>h.type==="element"&&h.tagName==="span");if(s.length!==i.converter.lines.length)throw new Kn(`Number of lines in code element (${s.length}) does not match the number of lines in the source (${i.converter.lines.length}). Failed to apply decorations.`);function r(h,f,m,y){const b=s[h];let S="",_=-1,w=-1;if(f===0&&(_=0),m===0&&(w=0),m===Number.POSITIVE_INFINITY&&(w=b.children.length),_===-1||w===-1)for(let R=0;R<b.children.length;R++)S+=IF(b.children[R]),_===-1&&S.length===f&&(_=R+1),w===-1&&S.length===m&&(w=R+1);if(_===-1)throw new Kn(`Failed to find start index for decoration ${JSON.stringify(y.start)}`);if(w===-1)throw new Kn(`Failed to find end index for decoration ${JSON.stringify(y.end)}`);const M=b.children.slice(_,w);if(!y.alwaysWrap&&M.length===b.children.length)a(b,y,"line");else if(!y.alwaysWrap&&M.length===1&&M[0].type==="element")a(M[0],y,"token");else{const R={type:"element",tagName:"span",properties:{},children:M};a(R,y,"wrapper"),b.children.splice(_,M.length,R)}}function o(h,f){s[h]=a(s[h],f,"line")}function a(h,f,m){const y=f.properties||{},b=f.transform||(S=>S);return h.tagName=f.tagName||"span",h.properties={...h.properties,...y,class:h.properties.class},f.properties?.class&&LF(h,f.properties.class),h=b(h,m)||h,h}const c=[],u=i.decorations.sort((h,f)=>f.start.offset-h.start.offset||h.end.offset-f.end.offset);for(const h of u){const{start:f,end:m}=h;if(f.line===m.line)r(f.line,f.character,m.character,h);else if(f.line<m.line){r(f.line,f.character,Number.POSITIVE_INFINITY,h);for(let y=f.line+1;y<m.line;y++)c.unshift(()=>o(y,h));r(m.line,0,m.character,h)}}c.forEach(h=>h())}}}function Ele(e){for(let t=0;t<e.length;t++){const n=e[t];if(n.start.offset>n.end.offset)throw new Kn(`Invalid decoration range: ${JSON.stringify(n.start)} - ${JSON.stringify(n.end)}`);for(let i=t+1;i<e.length;i++){const s=e[i],r=n.start.offset<=s.start.offset&&s.start.offset<n.end.offset,o=n.start.offset<s.end.offset&&s.end.offset<=n.end.offset,a=s.start.offset<=n.start.offset&&n.start.offset<s.end.offset,c=s.start.offset<n.end.offset&&n.end.offset<=s.end.offset;if(r||o||a||c){if(r&&o||a&&c||a&&n.start.offset===n.end.offset||o&&s.start.offset===s.end.offset)continue;throw new Kn(`Decorations ${JSON.stringify(n.start)} and ${JSON.stringify(s.start)} intersect.`)}}}}function IF(e){return e.type==="text"?e.value:e.type==="element"?e.children.map(IF).join(""):""}const Rle=[Tle()];function Mv(e){const t=Mle(e.transformers||[]);return[...t.pre,...t.normal,...t.post,...Rle]}function Mle(e){const t=[],n=[],i=[];for(const s of e)switch(s.enforce){case"pre":t.push(s);break;case"post":n.push(s);break;default:i.push(s)}return{pre:t,post:n,normal:i}}var Ll=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"],CS={1:"bold",2:"dim",3:"italic",4:"underline",7:"reverse",8:"hidden",9:"strikethrough"};function Ale(e,t){const n=e.indexOf("\x1B",t);if(n!==-1&&e[n+1]==="["){const i=e.indexOf("m",n);if(i!==-1)return{sequence:e.substring(n+2,i).split(";"),startPosition:n,position:i+1}}return{position:e.length}}function GN(e){const t=e.shift();if(t==="2"){const n=e.splice(0,3).map(i=>Number.parseInt(i));return n.length!==3||n.some(i=>Number.isNaN(i))?void 0:{type:"rgb",rgb:n}}else if(t==="5"){const n=e.shift();if(n)return{type:"table",index:Number(n)}}}function Ple(e){const t=[];for(;e.length>0;){const n=e.shift();if(!n)continue;const i=Number.parseInt(n);if(!Number.isNaN(i))if(i===0)t.push({type:"resetAll"});else if(i<=9)CS[i]&&t.push({type:"setDecoration",value:CS[i]});else if(i<=29){const s=CS[i-20];s&&(t.push({type:"resetDecoration",value:s}),s==="dim"&&t.push({type:"resetDecoration",value:"bold"}))}else if(i<=37)t.push({type:"setForegroundColor",value:{type:"named",name:Ll[i-30]}});else if(i===38){const s=GN(e);s&&t.push({type:"setForegroundColor",value:s})}else if(i===39)t.push({type:"resetForegroundColor"});else if(i<=47)t.push({type:"setBackgroundColor",value:{type:"named",name:Ll[i-40]}});else if(i===48){const s=GN(e);s&&t.push({type:"setBackgroundColor",value:s})}else i===49?t.push({type:"resetBackgroundColor"}):i===53?t.push({type:"setDecoration",value:"overline"}):i===55?t.push({type:"resetDecoration",value:"overline"}):i>=90&&i<=97?t.push({type:"setForegroundColor",value:{type:"named",name:Ll[i-90+8]}}):i>=100&&i<=107&&t.push({type:"setBackgroundColor",value:{type:"named",name:Ll[i-100+8]}})}return t}function Lle(){let e=null,t=null,n=new Set;return{parse(i){const s=[];let r=0;do{const o=Ale(i,r),a=o.sequence?i.substring(r,o.startPosition):i.substring(r);if(a.length>0&&s.push({value:a,foreground:e,background:t,decorations:new Set(n)}),o.sequence){const c=Ple(o.sequence);for(const u of c)u.type==="resetAll"?(e=null,t=null,n.clear()):u.type==="resetForegroundColor"?e=null:u.type==="resetBackgroundColor"?t=null:u.type==="resetDecoration"&&n.delete(u.value);for(const u of c)u.type==="setForegroundColor"?e=u.value:u.type==="setBackgroundColor"?t=u.value:u.type==="setDecoration"&&n.add(u.value)}r=o.position}while(r<i.length);return s}}}var Nle={black:"#000000",red:"#bb0000",green:"#00bb00",yellow:"#bbbb00",blue:"#0000bb",magenta:"#ff00ff",cyan:"#00bbbb",white:"#eeeeee",brightBlack:"#555555",brightRed:"#ff5555",brightGreen:"#00ff00",brightYellow:"#ffff55",brightBlue:"#5555ff",brightMagenta:"#ff55ff",brightCyan:"#55ffff",brightWhite:"#ffffff"};function Ile(e=Nle){function t(a){return e[a]}function n(a){return`#${a.map(c=>Math.max(0,Math.min(c,255)).toString(16).padStart(2,"0")).join("")}`}let i;function s(){if(i)return i;i=[];for(let u=0;u<Ll.length;u++)i.push(t(Ll[u]));let a=[0,95,135,175,215,255];for(let u=0;u<6;u++)for(let h=0;h<6;h++)for(let f=0;f<6;f++)i.push(n([a[u],a[h],a[f]]));let c=8;for(let u=0;u<24;u++,c+=10)i.push(n([c,c,c]));return i}function r(a){return s()[a]}function o(a){switch(a.type){case"named":return t(a.name);case"rgb":return n(a.rgb);case"table":return r(a.index)}}return{value:o}}const Dle={black:"#000000",red:"#cd3131",green:"#0DBC79",yellow:"#E5E510",blue:"#2472C8",magenta:"#BC3FBC",cyan:"#11A8CD",white:"#E5E5E5",brightBlack:"#666666",brightRed:"#F14C4C",brightGreen:"#23D18B",brightYellow:"#F5F543",brightBlue:"#3B8EEA",brightMagenta:"#D670D6",brightCyan:"#29B8DB",brightWhite:"#FFFFFF"};function Ole(e,t,n){const i=Ev(e,n),s=_y(t),r=Object.fromEntries(Ll.map(c=>{const u=`terminal.ansi${c[0].toUpperCase()}${c.substring(1)}`,h=e.colors?.[u];return[c,h||Dle[c]]})),o=Ile(r),a=Lle();return s.map(c=>a.parse(c[0]).map(u=>{let h,f;u.decorations.has("reverse")?(h=u.background?o.value(u.background):e.bg,f=u.foreground?o.value(u.foreground):e.fg):(h=u.foreground?o.value(u.foreground):e.fg,f=u.background?o.value(u.background):void 0),h=Oa(h,i),f=Oa(f,i),u.decorations.has("dim")&&(h=jle(h));let m=fi.None;return u.decorations.has("bold")&&(m|=fi.Bold),u.decorations.has("italic")&&(m|=fi.Italic),u.decorations.has("underline")&&(m|=fi.Underline),u.decorations.has("strikethrough")&&(m|=fi.Strikethrough),{content:u.value,offset:c[1],color:h,bgColor:f,fontStyle:m}}))}function jle(e){const t=e.match(/#([0-9a-f]{3,8})/i);if(t){const i=t[1];if(i.length===8){const s=Math.round(Number.parseInt(i.slice(6,8),16)/2).toString(16).padStart(2,"0");return`#${i.slice(0,6)}${s}`}else{if(i.length===6)return`#${i}80`;if(i.length===4){const s=i[0],r=i[1],o=i[2],a=i[3],c=Math.round(Number.parseInt(`${a}${a}`,16)/2).toString(16).padStart(2,"0");return`#${s}${s}${r}${r}${o}${o}${c}`}else if(i.length===3){const s=i[0],r=i[1],o=i[2];return`#${s}${s}${r}${r}${o}${o}80`}}}const n=e.match(/var\((--[\w-]+-ansi-[\w-]+)\)/);return n?`var(${n[1]}-dim)`:e}function a1(e,t,n={}){const{theme:i=e.getLoadedThemes()[0]}=n,s=e.resolveLangAlias(n.lang||"text");if(s1(s)||r1(i))return _y(t).map(c=>[{content:c[0],offset:c[1]}]);const{theme:r,colorMap:o}=e.setTheme(i);if(s==="ansi")return Ole(r,t,n);const a=e.getLanguage(n.lang||"text");if(n.grammarState){if(n.grammarState.lang!==a.name)throw new Kn(`Grammar state language "${n.grammarState.lang}" does not match highlight language "${a.name}"`);if(!n.grammarState.themes.includes(r.name))throw new Kn(`Grammar state themes "${n.grammarState.themes}" do not contain highlight theme "${r.name}"`)}return Fle(t,a,r,o,n)}function Ble(...e){if(e.length===2)return Tf(e[1]);const[t,n,i={}]=e,{lang:s="text",theme:r=t.getLoadedThemes()[0]}=i;if(s1(s)||r1(r))throw new Kn("Plain language does not have grammar state");if(s==="ansi")throw new Kn("ANSI language does not have grammar state");const{theme:o,colorMap:a}=t.setTheme(r),c=t.getLanguage(s);return new Qu(l1(n,c,o,a,i).stateStack,c.name,o.name)}function Fle(e,t,n,i,s){const r=l1(e,t,n,i,s),o=new Qu(r.stateStack,t.name,n.name);return Sy(r.tokens,o),r.tokens}function l1(e,t,n,i,s){const r=Ev(n,s),{tokenizeMaxLineLength:o=0,tokenizeTimeLimit:a=500}=s,c=_y(e);let u=s.grammarState?kle(s.grammarState,n.name)??yw:s.grammarContextCode!=null?l1(s.grammarContextCode,t,n,i,{...s,grammarState:void 0,grammarContextCode:void 0}).stateStack:yw,h=[];const f=[];for(let m=0,y=c.length;m<y;m++){const[b,S]=c[m];if(b===""){h=[],f.push([]);continue}if(o>0&&b.length>=o){h=[],f.push([{content:b,offset:S,color:"",fontStyle:0}]);continue}let _,w,M;s.includeExplanation&&(_=t.tokenizeLine(b,u,a),w=_.tokens,M=0);const R=t.tokenizeLine2(b,u,a),E=R.tokens.length/2;for(let A=0;A<E;A++){const T=R.tokens[2*A],L=A+1<E?R.tokens[2*A+2]:b.length;if(T===L)continue;const P=R.tokens[2*A+1],I=Oa(i[Bu.getForeground(P)],r),N=Bu.getFontStyle(P),O={content:b.substring(T,L),offset:S+T,color:I,fontStyle:N};if(s.includeExplanation){const j=[];if(s.includeExplanation!=="scopeName")for(const V of n.settings){let H;switch(typeof V.scope){case"string":H=V.scope.split(/,/).map(B=>B.trim());break;case"object":H=V.scope;break;default:continue}j.push({settings:V,selectors:H.map(B=>B.split(/ /))})}O.explanation=[];let $=0;for(;T+$<L;){const V=w[M],H=b.substring(V.startIndex,V.endIndex);$+=H.length,O.explanation.push({content:H,scopes:s.includeExplanation==="scopeName"?Ule(V.scopes):zle(j,V.scopes)}),M+=1}}h.push(O)}f.push(h),h=[],u=R.ruleStack}return{tokens:f,stateStack:u}}function Ule(e){return e.map(t=>({scopeName:t}))}function zle(e,t){const n=[];for(let i=0,s=t.length;i<s;i++){const r=t[i];n[i]={scopeName:r,themeMatches:qle(e,r,t.slice(0,i))}}return n}function KN(e,t){return e===t||t.substring(0,e.length)===e&&t[e.length]==="."}function $le(e,t,n){if(!KN(e[e.length-1],t))return!1;let i=e.length-2,s=n.length-1;for(;i>=0&&s>=0;)KN(e[i],n[s])&&(i-=1),s-=1;return i===-1}function qle(e,t,n){const i=[];for(const{selectors:s,settings:r}of e)for(const o of s)if($le(o,t,n)){i.push(r);break}return i}function DF(e,t,n){const i=Object.entries(n.themes).filter(c=>c[1]).map(c=>({color:c[0],theme:c[1]})),s=i.map(c=>{const u=a1(e,t,{...n,theme:c.theme}),h=Tf(u),f=typeof c.theme=="string"?c.theme:c.theme.name;return{tokens:u,state:h,theme:f}}),r=Hle(...s.map(c=>c.tokens)),o=r[0].map((c,u)=>c.map((h,f)=>{const m={content:h.content,variants:{},offset:h.offset};return"includeExplanation"in n&&n.includeExplanation&&(m.explanation=h.explanation),r.forEach((y,b)=>{const{content:S,explanation:_,offset:w,...M}=y[u][f];m.variants[i[b].color]=M}),m})),a=s[0].state?new Qu(Object.fromEntries(s.map(c=>[c.theme,c.state?.getInternalStack(c.theme)])),s[0].state.lang):void 0;return a&&Sy(o,a),o}function Hle(...e){const t=e.map(()=>[]),n=e.length;for(let i=0;i<e[0].length;i++){const s=e.map(c=>c[i]),r=t.map(()=>[]);t.forEach((c,u)=>c.push(r[u]));const o=s.map(()=>0),a=s.map(c=>c[0]);for(;a.every(c=>c);){const c=Math.min(...a.map(u=>u.content.length));for(let u=0;u<n;u++){const h=a[u];h.content.length===c?(r[u].push(h),o[u]+=1,a[u]=s[u][o[u]]):(r[u].push({...h,content:h.content.slice(0,c)}),a[u]={...h,content:h.content.slice(c),offset:h.offset+c})}}}return t}function Av(e,t,n){let i,s,r,o,a,c;if("themes"in n){const{defaultColor:u="light",cssVariablePrefix:h="--shiki-",colorsRendering:f="css-vars"}=n,m=Object.entries(n.themes).filter(w=>w[1]).map(w=>({color:w[0],theme:w[1]})).sort((w,M)=>w.color===u?-1:M.color===u?1:0);if(m.length===0)throw new Kn("`themes` option must not be empty");const y=DF(e,t,n);if(c=Tf(y),u&&o1!==u&&!m.find(w=>w.color===u))throw new Kn(`\`themes\` option must contain the defaultColor key \`${u}\``);const b=m.map(w=>e.getTheme(w.theme)),S=m.map(w=>w.color);r=y.map(w=>w.map(M=>wle(M,S,h,u,f))),c&&Sy(r,c);const _=m.map(w=>Ev(w.theme,n));s=YN(m,b,_,h,u,"fg",f),i=YN(m,b,_,h,u,"bg",f),o=`shiki-themes ${b.map(w=>w.name).join(" ")}`,a=u?void 0:[s,i].join(";")}else if("theme"in n){const u=Ev(n.theme,n);r=a1(e,t,n);const h=e.getTheme(n.theme);i=Oa(h.bg,u),s=Oa(h.fg,u),o=h.name,c=Tf(r)}else throw new Kn("Invalid options, either `theme` or `themes` must be provided");return{tokens:r,fg:s,bg:i,themeName:o,rootStyle:a,grammarState:c}}function YN(e,t,n,i,s,r,o){return e.map((a,c)=>{const u=Oa(t[c][r],n[c])||"inherit",h=`${i+a.color}${r==="bg"?"-bg":""}:${u}`;if(c===0&&s){if(s===o1&&e.length>1){const f=e.findIndex(S=>S.color==="light"),m=e.findIndex(S=>S.color==="dark");if(f===-1||m===-1)throw new Kn('When using `defaultColor: "light-dark()"`, you must provide both `light` and `dark` themes');const y=Oa(t[f][r],n[f])||"inherit",b=Oa(t[m][r],n[m])||"inherit";return`light-dark(${y}, ${b});${h}`}return u}return o==="css-vars"?h:null}).filter(a=>!!a).join(";")}function Pv(e,t,n,i={meta:{},options:n,codeToHast:(s,r)=>Pv(e,s,r),codeToTokens:(s,r)=>Av(e,s,r)}){let s=t;for(const b of Mv(n))s=b.preprocess?.call(i,s,n)||s;let{tokens:r,fg:o,bg:a,themeName:c,rootStyle:u,grammarState:h}=Av(e,s,n);const{mergeWhitespaces:f=!0,mergeSameStyleTokens:m=!1}=n;f===!0?r=Wle(r):f==="never"&&(r=Gle(r)),m&&(r=Kle(r));const y={...i,get source(){return s}};for(const b of Mv(n))r=b.tokens?.call(y,r)||r;return Vle(r,{...n,fg:o,bg:a,themeName:c,rootStyle:n.rootStyle===!1?!1:n.rootStyle??u},y,h)}function Vle(e,t,n,i=Tf(e)){const s=Mv(t),r=[],o={type:"root",children:[]},{structure:a="classic",tabindex:c="0"}=t,u={class:`shiki ${t.themeName||""}`};t.rootStyle!==!1&&(t.rootStyle!=null?u.style=t.rootStyle:u.style=`background-color:${t.bg};color:${t.fg}`),c!==!1&&c!=null&&(u.tabindex=c.toString());for(const[S,_]of Object.entries(t.meta||{}))S.startsWith("_")||(u[S]=_);let h={type:"element",tagName:"pre",properties:u,children:[]},f={type:"element",tagName:"code",properties:{},children:r};const m=[],y={...n,structure:a,addClassToHast:LF,get source(){return n.source},get tokens(){return e},get options(){return t},get root(){return o},get pre(){return h},get code(){return f},get lines(){return m}};if(e.forEach((S,_)=>{_&&(a==="inline"?o.children.push({type:"element",tagName:"br",properties:{},children:[]}):a==="classic"&&r.push({type:"text",value:`
`}));let w={type:"element",tagName:"span",properties:{class:"line"},children:[]},M=0;for(const R of S){let E={type:"element",tagName:"span",properties:{...R.htmlAttrs},children:[{type:"text",value:R.content}]};const A=_w(R.htmlStyle||Rv(R));A&&(E.properties.style=A);for(const T of s)E=T?.span?.call(y,E,_+1,M,w,R)||E;a==="inline"?o.children.push(E):a==="classic"&&w.children.push(E),M+=R.content.length}if(a==="classic"){for(const R of s)w=R?.line?.call(y,w,_+1)||w;m.push(w),r.push(w)}else a==="inline"&&m.push(w)}),a==="classic"){for(const S of s)f=S?.code?.call(y,f)||f;h.children.push(f);for(const S of s)h=S?.pre?.call(y,h)||h;o.children.push(h)}else if(a==="inline"){const S=[];let _={type:"element",tagName:"span",properties:{class:"line"},children:[]};for(const R of o.children)R.type==="element"&&R.tagName==="br"?(S.push(_),_={type:"element",tagName:"span",properties:{class:"line"},children:[]}):(R.type==="element"||R.type==="text")&&_.children.push(R);S.push(_);let M={type:"element",tagName:"code",properties:{},children:S};for(const R of s)M=R?.code?.call(y,M)||M;o.children=[];for(let R=0;R<M.children.length;R++){R>0&&o.children.push({type:"element",tagName:"br",properties:{},children:[]});const E=M.children[R];E.type==="element"&&o.children.push(...E.children)}}let b=o;for(const S of s)b=S?.root?.call(y,b)||b;return i&&Sy(b,i),b}function Wle(e){return e.map(t=>{const n=[];let i="",s;return t.forEach((r,o)=>{const c=!(r.fontStyle&&(r.fontStyle&fi.Underline||r.fontStyle&fi.Strikethrough));c&&r.content.match(/^\s+$/)&&t[o+1]?(s===void 0&&(s=r.offset),i+=r.content):i?(c?n.push({...r,offset:s,content:i+r.content}):n.push({content:i,offset:s},r),s=void 0,i=""):n.push(r)}),n})}function Gle(e){return e.map(t=>t.flatMap(n=>{if(n.content.match(/^\s+$/))return n;const i=n.content.match(/^(\s*)(.*?)(\s*)$/);if(!i)return n;const[,s,r,o]=i;if(!s&&!o)return n;const a=[{...n,offset:n.offset+s.length,content:r}];return s&&a.unshift({content:s,offset:n.offset}),o&&a.push({content:o,offset:n.offset+s.length+r.length}),a}))}function Kle(e){return e.map(t=>{const n=[];for(const i of t){if(n.length===0){n.push({...i});continue}const s=n[n.length-1],r=_w(s.htmlStyle||Rv(s)),o=_w(i.htmlStyle||Rv(i)),a=s.fontStyle&&(s.fontStyle&fi.Underline||s.fontStyle&fi.Strikethrough),c=i.fontStyle&&(i.fontStyle&fi.Underline||i.fontStyle&fi.Strikethrough);!a&&!c&&r===o?s.content+=i.content:n.push({...i})}return n})}const Yle=fle;function Xle(e,t,n){const i={meta:{},options:n,codeToHast:(r,o)=>Pv(e,r,o),codeToTokens:(r,o)=>Av(e,r,o)};let s=Yle(Pv(e,t,n,i));for(const r of Mv(n))s=r.postprocess?.call(i,s,n)||s;return s}const XN={light:"#333333",dark:"#bbbbbb"},QN={light:"#fffffe",dark:"#1e1e1e"},JN="__shiki_resolved";function c1(e){if(e?.[JN])return e;const t={...e};t.tokenColors&&!t.settings&&(t.settings=t.tokenColors,delete t.tokenColors),t.type||="dark",t.colorReplacements={...t.colorReplacements},t.settings||=[];let{bg:n,fg:i}=t;if(!n||!i){const a=t.settings?t.settings.find(c=>!c.name&&!c.scope):void 0;a?.settings?.foreground&&(i=a.settings.foreground),a?.settings?.background&&(n=a.settings.background),!i&&t?.colors?.["editor.foreground"]&&(i=t.colors["editor.foreground"]),!n&&t?.colors?.["editor.background"]&&(n=t.colors["editor.background"]),i||(i=t.type==="light"?XN.light:XN.dark),n||(n=t.type==="light"?QN.light:QN.dark),t.fg=i,t.bg=n}t.settings[0]&&t.settings[0].settings&&!t.settings[0].scope||t.settings.unshift({settings:{foreground:t.fg,background:t.bg}});let s=0;const r=new Map;function o(a){if(r.has(a))return r.get(a);s+=1;const c=`#${s.toString(16).padStart(8,"0").toLowerCase()}`;return t.colorReplacements?.[`#${c}`]?o(a):(r.set(a,c),c)}t.settings=t.settings.map(a=>{const c=a.settings?.foreground&&!a.settings.foreground.startsWith("#"),u=a.settings?.background&&!a.settings.background.startsWith("#");if(!c&&!u)return a;const h={...a,settings:{...a.settings}};if(c){const f=o(a.settings.foreground);t.colorReplacements[f]=a.settings.foreground,h.settings.foreground=f}if(u){const f=o(a.settings.background);t.colorReplacements[f]=a.settings.background,h.settings.background=f}return h});for(const a of Object.keys(t.colors||{}))if((a==="editor.foreground"||a==="editor.background"||a.startsWith("terminal.ansi"))&&!t.colors[a]?.startsWith("#")){const c=o(t.colors[a]);t.colorReplacements[c]=t.colors[a],t.colors[a]=c}return Object.defineProperty(t,JN,{enumerable:!1,writable:!1,value:!0}),t}async function OF(e){return Array.from(new Set((await Promise.all(e.filter(t=>!vle(t)).map(async t=>await PF(t).then(n=>Array.isArray(n)?n:[n])))).flat()))}async function jF(e){return(await Promise.all(e.map(async n=>yle(n)?null:c1(await PF(n))))).filter(n=>!!n)}let Qle=3;function Jle(e,t=3){t>Qle||console.trace(`[SHIKI DEPRECATE]: ${e}`)}class mu extends Error{constructor(t){super(t),this.name="ShikiError"}}function BF(e,t){if(!t)return e;if(t[e]){const n=new Set([e]);for(;t[e];){if(e=t[e],n.has(e))throw new mu(`Circular alias \`${Array.from(n).join(" -> ")} -> ${e}\``);n.add(e)}}return e}class Zle extends dae{constructor(t,n,i,s={}){super(t),this._resolver=t,this._themes=n,this._langs=i,this._alias=s,this._themes.map(r=>this.loadTheme(r)),this.loadLanguages(this._langs)}_resolvedThemes=new Map;_resolvedGrammars=new Map;_langMap=new Map;_langGraph=new Map;_textmateThemeCache=new WeakMap;_loadedThemesCache=null;_loadedLanguagesCache=null;getTheme(t){return typeof t=="string"?this._resolvedThemes.get(t):this.loadTheme(t)}loadTheme(t){const n=c1(t);return n.name&&(this._resolvedThemes.set(n.name,n),this._loadedThemesCache=null),n}getLoadedThemes(){return this._loadedThemesCache||(this._loadedThemesCache=[...this._resolvedThemes.keys()]),this._loadedThemesCache}setTheme(t){let n=this._textmateThemeCache.get(t);n||(n=xv.createFromRawTheme(t),this._textmateThemeCache.set(t,n)),this._syncRegistry.setTheme(n)}getGrammar(t){return t=BF(t,this._alias),this._resolvedGrammars.get(t)}loadLanguage(t){if(this.getGrammar(t.name))return;const n=new Set([...this._langMap.values()].filter(r=>r.embeddedLangsLazy?.includes(t.name)));this._resolver.addLanguage(t);const i={balancedBracketSelectors:t.balancedBracketSelectors||["*"],unbalancedBracketSelectors:t.unbalancedBracketSelectors||[]};this._syncRegistry._rawGrammars.set(t.scopeName,t);const s=this.loadGrammarWithConfiguration(t.scopeName,1,i);if(s.name=t.name,this._resolvedGrammars.set(t.name,s),t.aliases&&t.aliases.forEach(r=>{this._alias[r]=t.name}),this._loadedLanguagesCache=null,n.size)for(const r of n)this._resolvedGrammars.delete(r.name),this._loadedLanguagesCache=null,this._syncRegistry?._injectionGrammars?.delete(r.scopeName),this._syncRegistry?._grammars?.delete(r.scopeName),this.loadLanguage(this._langMap.get(r.name))}dispose(){super.dispose(),this._resolvedThemes.clear(),this._resolvedGrammars.clear(),this._langMap.clear(),this._langGraph.clear(),this._loadedThemesCache=null}loadLanguages(t){for(const s of t)this.resolveEmbeddedLanguages(s);const n=Array.from(this._langGraph.entries()),i=n.filter(([s,r])=>!r);if(i.length){const s=n.filter(([r,o])=>o?(o.embeddedLanguages||o.embeddedLangs)?.some(c=>i.map(([u])=>u).includes(c)):!1).filter(r=>!i.includes(r));throw new mu(`Missing languages ${i.map(([r])=>`\`${r}\``).join(", ")}, required by ${s.map(([r])=>`\`${r}\``).join(", ")}`)}for(const[s,r]of n)this._resolver.addLanguage(r);for(const[s,r]of n)this.loadLanguage(r)}getLoadedLanguages(){return this._loadedLanguagesCache||(this._loadedLanguagesCache=[...new Set([...this._resolvedGrammars.keys(),...Object.keys(this._alias)])]),this._loadedLanguagesCache}resolveEmbeddedLanguages(t){this._langMap.set(t.name,t),this._langGraph.set(t.name,t);const n=t.embeddedLanguages??t.embeddedLangs;if(n)for(const i of n)this._langGraph.set(i,this._langMap.get(i))}}class ece{_langs=new Map;_scopeToLang=new Map;_injections=new Map;_onigLib;constructor(t,n){this._onigLib={createOnigScanner:i=>t.createScanner(i),createOnigString:i=>t.createString(i)},n.forEach(i=>this.addLanguage(i))}get onigLib(){return this._onigLib}getLangRegistration(t){return this._langs.get(t)}loadGrammar(t){return this._scopeToLang.get(t)}addLanguage(t){this._langs.set(t.name,t),t.aliases&&t.aliases.forEach(n=>{this._langs.set(n,t)}),this._scopeToLang.set(t.scopeName,t),t.injectTo&&t.injectTo.forEach(n=>{this._injections.get(n)||this._injections.set(n,[]),this._injections.get(n).push(t.scopeName)})}getInjections(t){const n=t.split(".");let i=[];for(let s=1;s<=n.length;s++){const r=n.slice(0,s).join(".");i=[...i,...this._injections.get(r)||[]]}return i}}let ch=0;function tce(e){ch+=1,e.warnings!==!1&&ch>=10&&ch%10===0&&console.warn(`[Shiki] ${ch} instances have been created. Shiki is supposed to be used as a singleton, consider refactoring your code to cache your highlighter instance; Or call \`highlighter.dispose()\` to release unused instances.`);let t=!1;if(!e.engine)throw new mu("`engine` option is required for synchronous mode");const n=(e.langs||[]).flat(1),i=(e.themes||[]).flat(1).map(c1),s=new ece(e.engine,n),r=new Zle(s,i,n,e.langAlias);let o;function a(R){return BF(R,e.langAlias)}function c(R){w();const E=r.getGrammar(typeof R=="string"?R:R.name);if(!E)throw new mu(`Language \`${R}\` not found, you may need to load it first`);return E}function u(R){if(R==="none")return{bg:"",fg:"",name:"none",settings:[],type:"dark"};w();const E=r.getTheme(R);if(!E)throw new mu(`Theme \`${R}\` not found, you may need to load it first`);return E}function h(R){w();const E=u(R);o!==R&&(r.setTheme(E),o=R);const A=r.getColorMap();return{theme:E,colorMap:A}}function f(){return w(),r.getLoadedThemes()}function m(){return w(),r.getLoadedLanguages()}function y(...R){w(),r.loadLanguages(R.flat(1))}async function b(...R){return y(await OF(R))}function S(...R){w();for(const E of R.flat(1))r.loadTheme(E)}async function _(...R){return w(),S(await jF(R))}function w(){if(t)throw new mu("Shiki instance has been disposed")}function M(){t||(t=!0,r.dispose(),ch-=1)}return{setTheme:h,getTheme:u,getLanguage:c,getLoadedThemes:f,getLoadedLanguages:m,resolveLangAlias:a,loadLanguage:b,loadLanguageSync:y,loadTheme:_,loadThemeSync:S,dispose:M,[Symbol.dispose]:M}}async function nce(e){e.engine||Jle("`engine` option is required. Use `createOnigurumaEngine` or `createJavaScriptRegexEngine` to create an engine.");const[t,n,i]=await Promise.all([jF(e.themes||[]),OF(e.langs||[]),e.engine]);return tce({...e,themes:t,langs:n,engine:i})}async function ice(e){const t=await nce(e);return{getLastGrammarState:(...n)=>Ble(t,...n),codeToTokensBase:(n,i)=>a1(t,n,i),codeToTokensWithThemes:(n,i)=>DF(t,n,i),codeToTokens:(n,i)=>Av(t,n,i),codeToHast:(n,i)=>Pv(t,n,i),codeToHtml:(n,i)=>Xle(t,n,i),getBundledLanguages:()=>({}),getBundledThemes:()=>({}),...t,getInternalContext:()=>t}}function Ju(e){if([...e].length!==1)throw new Error(`Expected "${e}" to be a single code point`);return e.codePointAt(0)}function sce(e,t,n){return e.has(t)||e.set(t,n),e.get(t)}const u1=new Set(["alnum","alpha","ascii","blank","cntrl","digit","graph","lower","print","punct","space","upper","word","xdigit"]),Yn=String.raw;function Zu(e,t){if(e==null)throw new Error(t??"Value expected");return e}const FF=Yn`\[\^?`,UF=`c.? | C(?:-.?)?|${Yn`[pP]\{(?:\^?[-\x20_]*[A-Za-z][-\x20\w]*\})?`}|${Yn`x[89A-Fa-f]\p{AHex}(?:\\x[89A-Fa-f]\p{AHex})*`}|${Yn`u(?:\p{AHex}{4})? | x\{[^\}]*\}? | x\p{AHex}{0,2}`}|${Yn`o\{[^\}]*\}?`}|${Yn`\d{1,3}`}`,d1=/[?*+][?+]?|\{(?:\d+(?:,\d*)?|,\d+)\}\??/,Um=new RegExp(Yn`
  \\ (?:
    ${UF}
    | [gk]<[^>]*>?
    | [gk]'[^']*'?
    | .
  )
  | \( (?:
    \? (?:
      [:=!>({]
      | <[=!]
      | <[^>]*>
      | '[^']*'
      | ~\|?
      | #(?:[^)\\]|\\.?)*
      | [^:)]*[:)]
    )?
    | \*[^\)]*\)?
  )?
  | (?:${d1.source})+
  | ${FF}
  | .
`.replace(/\s+/g,""),"gsu"),kS=new RegExp(Yn`
  \\ (?:
    ${UF}
    | .
  )
  | \[:(?:\^?\p{Alpha}+|\^):\]
  | ${FF}
  | &&
  | .
`.replace(/\s+/g,""),"gsu");function rce(e,t={}){const n={flags:"",...t,rules:{captureGroup:!1,singleline:!1,...t.rules}};if(typeof e!="string")throw new Error("String expected as pattern");const i=Cce(n.flags),s=[i.extended],r={captureGroup:n.rules.captureGroup,getCurrentModX(){return s.at(-1)},numOpenGroups:0,popModX(){s.pop()},pushModX(f){s.push(f)},replaceCurrentModX(f){s[s.length-1]=f},singleline:n.rules.singleline};let o=[],a;for(Um.lastIndex=0;a=Um.exec(e);){const f=oce(r,e,a[0],Um.lastIndex);f.tokens?o.push(...f.tokens):f.token&&o.push(f.token),f.lastIndex!==void 0&&(Um.lastIndex=f.lastIndex)}const c=[];let u=0;o.filter(f=>f.type==="GroupOpen").forEach(f=>{f.kind==="capturing"?f.number=++u:f.raw==="("&&c.push(f)}),u||c.forEach((f,m)=>{f.kind="capturing",f.number=m+1});const h=u||c.length;return{tokens:o.map(f=>f.type==="EscapedNumber"?Tce(f,h):f).flat(),flags:i}}function oce(e,t,n,i){const[s,r]=n;if(n==="["||n==="[^"){const o=ace(t,n,i);return{tokens:o.tokens,lastIndex:o.lastIndex}}if(s==="\\"){if("AbBGyYzZ".includes(r))return{token:ZN(n,n)};if(/^\\g[<']/.test(n)){if(!/^\\g(?:<[^>]+>|'[^']+')$/.test(n))throw new Error(`Invalid group name "${n}"`);return{token:vce(n)}}if(/^\\k[<']/.test(n)){if(!/^\\k(?:<[^>]+>|'[^']+')$/.test(n))throw new Error(`Invalid group name "${n}"`);return{token:$F(n)}}if(r==="K")return{token:qF("keep",n)};if(r==="N"||r==="R")return{token:Nl("newline",n,{negate:r==="N"})};if(r==="O")return{token:Nl("any",n)};if(r==="X")return{token:Nl("text_segment",n)};const o=zF(n,{inCharClass:!1});return Array.isArray(o)?{tokens:o}:{token:o}}if(s==="("){if(r==="*")return{token:Sce(n)};if(n==="(?{")throw new Error(`Unsupported callout "${n}"`);if(n.startsWith("(?#")){if(t[i]!==")")throw new Error('Unclosed comment group "(?#"');return{lastIndex:i+1}}if(/^\(\?[-imx]+[:)]$/.test(n))return{token:_ce(n,e)};if(e.pushModX(e.getCurrentModX()),e.numOpenGroups++,n==="("&&!e.captureGroup||n==="(?:")return{token:au("group",n)};if(n==="(?>")return{token:au("atomic",n)};if(n==="(?="||n==="(?!"||n==="(?<="||n==="(?<!")return{token:au(n[2]==="<"?"lookbehind":"lookahead",n,{negate:n.endsWith("!")})};if(n==="("&&e.captureGroup||n.startsWith("(?<")&&n.endsWith(">")||n.startsWith("(?'")&&n.endsWith("'"))return{token:au("capturing",n,{...n!=="("&&{name:n.slice(3,-1)}})};if(n.startsWith("(?~")){if(n==="(?~|")throw new Error(`Unsupported absence function kind "${n}"`);return{token:au("absence_repeater",n)}}throw n==="(?("?new Error(`Unsupported conditional "${n}"`):new Error(`Invalid or unsupported group option "${n}"`)}if(n===")"){if(e.popModX(),e.numOpenGroups--,e.numOpenGroups<0)throw new Error('Unmatched ")"');return{token:pce(n)}}if(e.getCurrentModX()){if(n==="#"){const o=t.indexOf(`
`,i);return{lastIndex:o===-1?t.length:o}}if(/^\s$/.test(n)){const o=/\s+/y;return o.lastIndex=i,{lastIndex:o.exec(t)?o.lastIndex:i}}}if(n===".")return{token:Nl("dot",n)};if(n==="^"||n==="$"){const o=e.singleline?{"^":Yn`\A`,$:Yn`\Z`}[n]:n;return{token:ZN(o,n)}}return n==="|"?{token:cce(n)}:d1.test(n)?{tokens:Ece(n)}:{token:Lo(Ju(n),n)}}function ace(e,t,n){const i=[eI(t[1]==="^",t)];let s=1,r;for(kS.lastIndex=n;r=kS.exec(e);){const o=r[0];if(o[0]==="["&&o[1]!==":")s++,i.push(eI(o[1]==="^",o));else if(o==="]"){if(i.at(-1).type==="CharacterClassOpen")i.push(Lo(93,o));else if(s--,i.push(uce(o)),!s)break}else{const a=lce(o);Array.isArray(a)?i.push(...a):i.push(a)}}return{tokens:i,lastIndex:kS.lastIndex||e.length}}function lce(e){if(e[0]==="\\")return zF(e,{inCharClass:!0});if(e[0]==="["){const t=/\[:(?<negate>\^?)(?<name>[a-z]+):\]/.exec(e);if(!t||!u1.has(t.groups.name))throw new Error(`Invalid POSIX class "${e}"`);return Nl("posix",e,{value:t.groups.name,negate:!!t.groups.negate})}return e==="-"?dce(e):e==="&&"?hce(e):Lo(Ju(e),e)}function zF(e,{inCharClass:t}){const n=e[1];if(n==="c"||n==="C")return bce(e);if("dDhHsSwW".includes(n))return xce(e);if(e.startsWith(Yn`\o{`))throw new Error(`Incomplete, invalid, or unsupported octal code point "${e}"`);if(/^\\[pP]\{/.test(e)){if(e.length===3)throw new Error(`Incomplete or invalid Unicode property "${e}"`);return wce(e)}if(new RegExp("^\\\\x[89A-Fa-f]\\p{AHex}","u").test(e))try{const i=e.split(/\\x/).slice(1).map(o=>parseInt(o,16)),s=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}).decode(new Uint8Array(i)),r=new TextEncoder;return[...s].map(o=>{const a=[...r.encode(o)].map(c=>`\\x${c.toString(16)}`).join("");return Lo(Ju(o),a)})}catch{throw new Error(`Multibyte code "${e}" incomplete or invalid in Oniguruma`)}if(n==="u"||n==="x")return Lo(kce(e),e);if(tI.has(n))return Lo(tI.get(n),e);if(/\d/.test(n))return fce(t,e);if(e==="\\")throw new Error(Yn`Incomplete escape "\"`);if(n==="M")throw new Error(`Unsupported meta "${e}"`);if([...e].length===2)return Lo(e.codePointAt(1),e);throw new Error(`Unexpected escape "${e}"`)}function cce(e){return{type:"Alternator",raw:e}}function ZN(e,t){return{type:"Assertion",kind:e,raw:t}}function $F(e){return{type:"Backreference",raw:e}}function Lo(e,t){return{type:"Character",value:e,raw:t}}function uce(e){return{type:"CharacterClassClose",raw:e}}function dce(e){return{type:"CharacterClassHyphen",raw:e}}function hce(e){return{type:"CharacterClassIntersector",raw:e}}function eI(e,t){return{type:"CharacterClassOpen",negate:e,raw:t}}function Nl(e,t,n={}){return{type:"CharacterSet",kind:e,...n,raw:t}}function qF(e,t,n={}){return e==="keep"?{type:"Directive",kind:e,raw:t}:{type:"Directive",kind:e,flags:Zu(n.flags),raw:t}}function fce(e,t){return{type:"EscapedNumber",inCharClass:e,raw:t}}function pce(e){return{type:"GroupClose",raw:e}}function au(e,t,n={}){return{type:"GroupOpen",kind:e,...n,raw:t}}function mce(e,t,n,i){return{type:"NamedCallout",kind:e,tag:t,arguments:n,raw:i}}function gce(e,t,n,i){return{type:"Quantifier",kind:e,min:t,max:n,raw:i}}function vce(e){return{type:"Subroutine",raw:e}}const yce=new Set(["COUNT","CMP","ERROR","FAIL","MAX","MISMATCH","SKIP","TOTAL_COUNT"]),tI=new Map([["a",7],["b",8],["e",27],["f",12],["n",10],["r",13],["t",9],["v",11]]);function bce(e){const t=e[1]==="c"?e[2]:e[3];if(!t||!/[A-Za-z]/.test(t))throw new Error(`Unsupported control character "${e}"`);return Lo(Ju(t.toUpperCase())-64,e)}function _ce(e,t){let{on:n,off:i}=/^\(\?(?<on>[imx]*)(?:-(?<off>[-imx]*))?/.exec(e).groups;i??="";const s=(t.getCurrentModX()||n.includes("x"))&&!i.includes("x"),r=iI(n),o=iI(i),a={};if(r&&(a.enable=r),o&&(a.disable=o),e.endsWith(")"))return t.replaceCurrentModX(s),qF("flags",e,{flags:a});if(e.endsWith(":"))return t.pushModX(s),t.numOpenGroups++,au("group",e,{...(r||o)&&{flags:a}});throw new Error(`Unexpected flag modifier "${e}"`)}function Sce(e){const t=/\(\*(?<name>[A-Za-z_]\w*)?(?:\[(?<tag>(?:[A-Za-z_]\w*)?)\])?(?:\{(?<args>[^}]*)\})?\)/.exec(e);if(!t)throw new Error(`Incomplete or invalid named callout "${e}"`);const{name:n,tag:i,args:s}=t.groups;if(!n)throw new Error(`Invalid named callout "${e}"`);if(i==="")throw new Error(`Named callout tag with empty value not allowed "${e}"`);const r=s?s.split(",").filter(h=>h!=="").map(h=>/^[+-]?\d+$/.test(h)?+h:h):[],[o,a,c]=r,u=yce.has(n)?n.toLowerCase():"custom";switch(u){case"fail":case"mismatch":case"skip":if(r.length>0)throw new Error(`Named callout arguments not allowed "${r}"`);break;case"error":if(r.length>1)throw new Error(`Named callout allows only one argument "${r}"`);if(typeof o=="string")throw new Error(`Named callout argument must be a number "${o}"`);break;case"max":if(!r.length||r.length>2)throw new Error(`Named callout must have one or two arguments "${r}"`);if(typeof o=="string"&&!/^[A-Za-z_]\w*$/.test(o))throw new Error(`Named callout argument one must be a tag or number "${o}"`);if(r.length===2&&(typeof a=="number"||!/^[<>X]$/.test(a)))throw new Error(`Named callout optional argument two must be '<', '>', or 'X' "${a}"`);break;case"count":case"total_count":if(r.length>1)throw new Error(`Named callout allows only one argument "${r}"`);if(r.length===1&&(typeof o=="number"||!/^[<>X]$/.test(o)))throw new Error(`Named callout optional argument must be '<', '>', or 'X' "${o}"`);break;case"cmp":if(r.length!==3)throw new Error(`Named callout must have three arguments "${r}"`);if(typeof o=="string"&&!/^[A-Za-z_]\w*$/.test(o))throw new Error(`Named callout argument one must be a tag or number "${o}"`);if(typeof a=="number"||!/^(?:[<>!=]=|[<>])$/.test(a))throw new Error(`Named callout argument two must be '==', '!=', '>', '<', '>=', or '<=' "${a}"`);if(typeof c=="string"&&!/^[A-Za-z_]\w*$/.test(c))throw new Error(`Named callout argument three must be a tag or number "${c}"`);break;case"custom":throw new Error(`Undefined callout name "${n}"`);default:throw new Error(`Unexpected named callout kind "${u}"`)}return mce(u,i??null,s?.split(",")??null,e)}function nI(e){let t=null,n,i;if(e[0]==="{"){const{minStr:s,maxStr:r}=/^\{(?<minStr>\d*)(?:,(?<maxStr>\d*))?/.exec(e).groups,o=1e5;if(+s>o||r&&+r>o)throw new Error("Quantifier value unsupported in Oniguruma");if(n=+s,i=r===void 0?+s:r===""?1/0:+r,n>i&&(t="possessive",[n,i]=[i,n]),e.endsWith("?")){if(t==="possessive")throw new Error('Unsupported possessive interval quantifier chain with "?"');t="lazy"}else t||(t="greedy")}else n=e[0]==="+"?1:0,i=e[0]==="?"?1:1/0,t=e[1]==="+"?"possessive":e[1]==="?"?"lazy":"greedy";return gce(t,n,i,e)}function xce(e){const t=e[1].toLowerCase();return Nl({d:"digit",h:"hex",s:"space",w:"word"}[t],e,{negate:e[1]!==t})}function wce(e){const{p:t,neg:n,value:i}=/^\\(?<p>[pP])\{(?<neg>\^?)(?<value>[^}]+)/.exec(e).groups;return Nl("property",e,{value:i,negate:t==="P"&&!n||t==="p"&&!!n})}function iI(e){const t={};return e.includes("i")&&(t.ignoreCase=!0),e.includes("m")&&(t.dotAll=!0),e.includes("x")&&(t.extended=!0),Object.keys(t).length?t:null}function Cce(e){const t={ignoreCase:!1,dotAll:!1,extended:!1,digitIsAscii:!1,posixIsAscii:!1,spaceIsAscii:!1,wordIsAscii:!1,textSegmentMode:null};for(let n=0;n<e.length;n++){const i=e[n];if(!"imxDPSWy".includes(i))throw new Error(`Invalid flag "${i}"`);if(i==="y"){if(!/^y{[gw]}/.test(e.slice(n)))throw new Error('Invalid or unspecified flag "y" mode');t.textSegmentMode=e[n+2]==="g"?"grapheme":"word",n+=3;continue}t[{i:"ignoreCase",m:"dotAll",x:"extended",D:"digitIsAscii",P:"posixIsAscii",S:"spaceIsAscii",W:"wordIsAscii"}[i]]=!0}return t}function kce(e){if(new RegExp("^(?:\\\\u(?!\\p{AHex}{4})|\\\\x(?!\\p{AHex}{1,2}|\\{\\p{AHex}{1,8}\\}))","u").test(e))throw new Error(`Incomplete or invalid escape "${e}"`);const t=e[2]==="{"?new RegExp("^\\\\x\\{\\s*(?<hex>\\p{AHex}+)","u").exec(e).groups.hex:e.slice(2);return parseInt(t,16)}function Tce(e,t){const{raw:n,inCharClass:i}=e,s=n.slice(1);if(!i&&(s!=="0"&&s.length===1||s[0]!=="0"&&+s<=t))return[$F(n)];const r=[],o=s.match(/^[0-7]+|\d/g);for(let a=0;a<o.length;a++){const c=o[a];let u;if(a===0&&c!=="8"&&c!=="9"){if(u=parseInt(c,8),u>127)throw new Error(Yn`Octal encoded byte above 177 unsupported "${n}"`)}else u=Ju(c);r.push(Lo(u,(a===0?"\\":"")+c))}return r}function Ece(e){const t=[],n=new RegExp(d1,"gy");let i;for(;i=n.exec(e);){const s=i[0];if(s[0]==="{"){const r=/^\{(?<min>\d+),(?<max>\d+)\}\??$/.exec(s);if(r){const{min:o,max:a}=r.groups;if(+o>+a&&s.endsWith("?")){n.lastIndex--,t.push(nI(s.slice(0,-1)));continue}}}t.push(nI(s))}return t}function HF(e,t){if(!Array.isArray(e.body))throw new Error("Expected node with body array");if(e.body.length!==1)return!1;const n=e.body[0];return!t||Object.keys(t).every(i=>t[i]===n[i])}function Rce(e){return Mce.has(e.type)}const Mce=new Set(["AbsenceFunction","Backreference","CapturingGroup","Character","CharacterClass","CharacterSet","Group","Quantifier","Subroutine"]);function VF(e,t={}){const n={flags:"",normalizeUnknownPropertyNames:!1,skipBackrefValidation:!1,skipLookbehindValidation:!1,skipPropertyNameValidation:!1,unicodePropertyMap:null,...t,rules:{captureGroup:!1,singleline:!1,...t.rules}},i=rce(e,{flags:n.flags,rules:{captureGroup:n.rules.captureGroup,singleline:n.rules.singleline}}),s=(m,y)=>{const b=i.tokens[r.nextIndex];switch(r.parent=m,r.nextIndex++,b.type){case"Alternator":return Kl();case"Assertion":return Ace(b);case"Backreference":return Pce(b,r);case"Character":return xy(b.value,{useLastValid:!!y.isCheckingRangeEnd});case"CharacterClassHyphen":return Lce(b,r,y);case"CharacterClassOpen":return Nce(b,r,y);case"CharacterSet":return Ice(b,r);case"Directive":return Uce(b.kind,{flags:b.flags});case"GroupOpen":return Dce(b,r,y);case"NamedCallout":return $ce(b.kind,b.tag,b.arguments);case"Quantifier":return Oce(b,r);case"Subroutine":return jce(b,r);default:throw new Error(`Unexpected token type "${b.type}"`)}},r={capturingGroups:[],hasNumberedRef:!1,namedGroupsByName:new Map,nextIndex:0,normalizeUnknownPropertyNames:n.normalizeUnknownPropertyNames,parent:null,skipBackrefValidation:n.skipBackrefValidation,skipLookbehindValidation:n.skipLookbehindValidation,skipPropertyNameValidation:n.skipPropertyNameValidation,subroutines:[],tokens:i.tokens,unicodePropertyMap:n.unicodePropertyMap,walk:s},o=Hce(zce(i.flags));let a=o.body[0];for(;r.nextIndex<i.tokens.length;){const m=s(a,{});m.type==="Alternative"?(o.body.push(m),a=m):a.body.push(m)}const{capturingGroups:c,hasNumberedRef:u,namedGroupsByName:h,subroutines:f}=r;if(u&&h.size&&!n.rules.captureGroup)throw new Error("Numbered backref/subroutine not allowed when using named capture");for(const{ref:m}of f)if(typeof m=="number"){if(m>c.length)throw new Error("Subroutine uses a group number that's not defined");m&&(c[m-1].isSubroutined=!0)}else if(h.has(m)){if(h.get(m).length>1)throw new Error(Yn`Subroutine uses a duplicate group name "\g<${m}>"`);h.get(m)[0].isSubroutined=!0}else throw new Error(Yn`Subroutine uses a group name that's not defined "\g<${m}>"`);return o}function Ace({kind:e}){return Sw(Zu({"^":"line_start",$:"line_end","\\A":"string_start","\\b":"word_boundary","\\B":"word_boundary","\\G":"search_start","\\y":"text_segment_boundary","\\Y":"text_segment_boundary","\\z":"string_end","\\Z":"string_end_newline"}[e],`Unexpected assertion kind "${e}"`),{negate:e===Yn`\B`||e===Yn`\Y`})}function Pce({raw:e},t){const n=/^\\k[<']/.test(e),i=n?e.slice(3,-1):e.slice(1),s=(r,o=!1)=>{const a=t.capturingGroups.length;let c=!1;if(r>a)if(t.skipBackrefValidation)c=!0;else throw new Error(`Not enough capturing groups defined to the left "${e}"`);return t.hasNumberedRef=!0,xw(o?a+1-r:r,{orphan:c})};if(n){const r=/^(?<sign>-?)0*(?<num>[1-9]\d*)$/.exec(i);if(r)return s(+r.groups.num,!!r.groups.sign);if(/[-+]/.test(i))throw new Error(`Invalid backref name "${e}"`);if(!t.namedGroupsByName.has(i))throw new Error(`Group name not defined to the left "${e}"`);return xw(i)}return s(+i)}function Lce(e,t,n){const{tokens:i,walk:s}=t,r=t.parent,o=r.body.at(-1),a=i[t.nextIndex];if(!n.isCheckingRangeEnd&&o&&o.type!=="CharacterClass"&&o.type!=="CharacterClassRange"&&a&&a.type!=="CharacterClassOpen"&&a.type!=="CharacterClassClose"&&a.type!=="CharacterClassIntersector"){const c=s(r,{...n,isCheckingRangeEnd:!0});if(o.type==="Character"&&c.type==="Character")return r.body.pop(),Fce(o,c);throw new Error("Invalid character class range")}return xy(Ju("-"))}function Nce({negate:e},t,n){const{tokens:i,walk:s}=t,r=i[t.nextIndex],o=[Rg()];let a=oI(r);for(;a.type!=="CharacterClassClose";){if(a.type==="CharacterClassIntersector")o.push(Rg()),t.nextIndex++;else{const u=o.at(-1);u.body.push(s(u,n))}a=oI(i[t.nextIndex],r)}const c=Rg({negate:e});return o.length===1?c.body=o[0].body:(c.kind="intersection",c.body=o.map(u=>u.body.length===1?u.body[0]:u)),t.nextIndex++,c}function Ice({kind:e,negate:t,value:n},i){const{normalizeUnknownPropertyNames:s,skipPropertyNameValidation:r,unicodePropertyMap:o}=i;if(e==="property"){const a=wy(n);if(u1.has(a)&&!o?.has(a))e="posix",n=a;else return lu(n,{negate:t,normalizeUnknownPropertyNames:s,skipPropertyNameValidation:r,unicodePropertyMap:o})}return e==="posix"?qce(n,{negate:t}):ww(e,{negate:t})}function Dce(e,t,n){const{tokens:i,capturingGroups:s,namedGroupsByName:r,skipLookbehindValidation:o,walk:a}=t,c=Vce(e),u=c.type==="AbsenceFunction",h=rI(c),f=h&&c.negate;if(c.type==="CapturingGroup"&&(s.push(c),c.name&&sce(r,c.name,[]).push(c)),u&&n.isInAbsenceFunction)throw new Error("Nested absence function not supported by Oniguruma");let m=aI(i[t.nextIndex]);for(;m.type!=="GroupClose";){if(m.type==="Alternator")c.body.push(Kl()),t.nextIndex++;else{const y=c.body.at(-1),b=a(y,{...n,isInAbsenceFunction:n.isInAbsenceFunction||u,isInLookbehind:n.isInLookbehind||h,isInNegLookbehind:n.isInNegLookbehind||f});if(y.body.push(b),(h||n.isInLookbehind)&&!o){const S="Lookbehind includes a pattern not allowed by Oniguruma";if(f||n.isInNegLookbehind){if(sI(b)||b.type==="CapturingGroup")throw new Error(S)}else if(sI(b)||rI(b)&&b.negate)throw new Error(S)}}m=aI(i[t.nextIndex])}return t.nextIndex++,c}function Oce({kind:e,min:t,max:n},i){const s=i.parent,r=s.body.at(-1);if(!r||!Rce(r))throw new Error("Quantifier requires a repeatable token");const o=GF(e,t,n,r);return s.body.pop(),o}function jce({raw:e},t){const{capturingGroups:n,subroutines:i}=t;let s=e.slice(3,-1);const r=/^(?<sign>[-+]?)0*(?<num>[1-9]\d*)$/.exec(s);if(r){const a=+r.groups.num,c=n.length;if(t.hasNumberedRef=!0,s={"":a,"+":c+a,"-":c+1-a}[r.groups.sign],s<1)throw new Error("Invalid subroutine number")}else s==="0"&&(s=0);const o=KF(s);return i.push(o),o}function Bce(e,t){return{type:"AbsenceFunction",kind:e,body:Wf(t?.body)}}function Kl(e){return{type:"Alternative",body:YF(e?.body)}}function Sw(e,t){const n={type:"Assertion",kind:e};return(e==="word_boundary"||e==="text_segment_boundary")&&(n.negate=!!t?.negate),n}function xw(e,t){const n=!!t?.orphan;return{type:"Backreference",ref:e,...n&&{orphan:n}}}function WF(e,t){const n={name:void 0,isSubroutined:!1,...t};if(n.name!==void 0&&!Wce(n.name))throw new Error(`Group name "${n.name}" invalid in Oniguruma`);return{type:"CapturingGroup",number:e,...n.name&&{name:n.name},...n.isSubroutined&&{isSubroutined:n.isSubroutined},body:Wf(t?.body)}}function xy(e,t){const n={useLastValid:!1,...t};if(e>1114111){const i=e.toString(16);if(n.useLastValid)e=1114111;else throw e>1310719?new Error(`Invalid code point out of range "\\x{${i}}"`):new Error(`Invalid code point out of range in JS "\\x{${i}}"`)}return{type:"Character",value:e}}function Rg(e){const t={kind:"union",negate:!1,...e};return{type:"CharacterClass",kind:t.kind,negate:t.negate,body:YF(e?.body)}}function Fce(e,t){if(t.value<e.value)throw new Error("Character class range out of order");return{type:"CharacterClassRange",min:e,max:t}}function ww(e,t){const n=!!t?.negate,i={type:"CharacterSet",kind:e};return(e==="digit"||e==="hex"||e==="newline"||e==="space"||e==="word")&&(i.negate=n),(e==="text_segment"||e==="newline"&&!n)&&(i.variableLength=!0),i}function Uce(e,t={}){if(e==="keep")return{type:"Directive",kind:e};if(e==="flags")return{type:"Directive",kind:e,flags:Zu(t.flags)};throw new Error(`Unexpected directive kind "${e}"`)}function zce(e){return{type:"Flags",...e}}function ir(e){const t=e?.atomic,n=e?.flags;if(t&&n)throw new Error("Atomic group cannot have flags");return{type:"Group",...t&&{atomic:t},...n&&{flags:n},body:Wf(e?.body)}}function Ml(e){const t={behind:!1,negate:!1,...e};return{type:"LookaroundAssertion",kind:t.behind?"lookbehind":"lookahead",negate:t.negate,body:Wf(e?.body)}}function $ce(e,t,n){return{type:"NamedCallout",kind:e,tag:t,arguments:n}}function qce(e,t){const n=!!t?.negate;if(!u1.has(e))throw new Error(`Invalid POSIX class "${e}"`);return{type:"CharacterSet",kind:"posix",value:e,negate:n}}function GF(e,t,n,i){if(t>n)throw new Error("Invalid reversed quantifier range");return{type:"Quantifier",kind:e,min:t,max:n,body:i}}function Hce(e,t){return{type:"Regex",body:Wf(t?.body),flags:e}}function KF(e){return{type:"Subroutine",ref:e}}function lu(e,t){const n={negate:!1,normalizeUnknownPropertyNames:!1,skipPropertyNameValidation:!1,unicodePropertyMap:null,...t};let i=n.unicodePropertyMap?.get(wy(e));if(!i){if(n.normalizeUnknownPropertyNames)i=Gce(e);else if(n.unicodePropertyMap&&!n.skipPropertyNameValidation)throw new Error(Yn`Invalid Unicode property "\p{${e}}"`)}return{type:"CharacterSet",kind:"property",value:i??e,negate:n.negate}}function Vce({flags:e,kind:t,name:n,negate:i,number:s}){switch(t){case"absence_repeater":return Bce("repeater");case"atomic":return ir({atomic:!0});case"capturing":return WF(s,{name:n});case"group":return ir({flags:e});case"lookahead":case"lookbehind":return Ml({behind:t==="lookbehind",negate:i});default:throw new Error(`Unexpected group kind "${t}"`)}}function Wf(e){if(e===void 0)e=[Kl()];else if(!Array.isArray(e)||!e.length||!e.every(t=>t.type==="Alternative"))throw new Error("Invalid body; expected array of one or more Alternative nodes");return e}function YF(e){if(e===void 0)e=[];else if(!Array.isArray(e)||!e.every(t=>!!t.type))throw new Error("Invalid body; expected array of nodes");return e}function sI(e){return e.type==="LookaroundAssertion"&&e.kind==="lookahead"}function rI(e){return e.type==="LookaroundAssertion"&&e.kind==="lookbehind"}function Wce(e){return/^[\p{Alpha}\p{Pc}][^)]*$/u.test(e)}function Gce(e){return e.trim().replace(/[- _]+/g,"_").replace(/[A-Z][a-z]+(?=[A-Z])/g,"$&_").replace(/[A-Za-z]+/g,t=>t[0].toUpperCase()+t.slice(1).toLowerCase())}function wy(e){return e.replace(/[- _]+/g,"").toLowerCase()}function oI(e,t){return Zu(e,`${t?.type==="Character"&&t.value===93?"Empty":"Unclosed"} character class`)}function aI(e){return Zu(e,"Unclosed group")}function Yh(e,t,n=null){function i(r,o){for(let a=0;a<r.length;a++){const c=s(r[a],o,a,r);a=Math.max(-1,a+c)}}function s(r,o=null,a=null,c=null){let u=0,h=!1;const f={node:r,parent:o,key:a,container:c,root:e,remove(){zm(c).splice(Math.max(0,nu(a)+u),1),u--,h=!0},removeAllNextSiblings(){return zm(c).splice(nu(a)+1)},removeAllPrevSiblings(){const w=nu(a)+u;return u-=w,zm(c).splice(0,Math.max(0,w))},replaceWith(w,M={}){const R=!!M.traverse;c?c[Math.max(0,nu(a)+u)]=w:Zu(o,"Can't replace root node")[a]=w,R&&s(w,o,a,c),h=!0},replaceWithMultiple(w,M={}){const R=!!M.traverse;if(zm(c).splice(Math.max(0,nu(a)+u),1,...w),u+=w.length-1,R){let E=0;for(let A=0;A<w.length;A++)E+=s(w[A],o,nu(a)+A+E,c)}h=!0},skip(){h=!0}},{type:m}=r,y=t["*"],b=t[m],S=typeof y=="function"?y:y?.enter,_=typeof b=="function"?b:b?.enter;if(S?.(f,n),_?.(f,n),!h)switch(m){case"AbsenceFunction":case"CapturingGroup":case"Group":i(r.body,r);break;case"Alternative":case"CharacterClass":i(r.body,r);break;case"Assertion":case"Backreference":case"Character":case"CharacterSet":case"Directive":case"Flags":case"NamedCallout":case"Subroutine":break;case"CharacterClassRange":s(r.min,r,"min"),s(r.max,r,"max");break;case"LookaroundAssertion":i(r.body,r);break;case"Quantifier":s(r.body,r,"body");break;case"Regex":i(r.body,r),s(r.flags,r,"flags");break;default:throw new Error(`Unexpected node type "${m}"`)}return b?.exit?.(f,n),y?.exit?.(f,n),u}return s(e),e}function zm(e){if(!Array.isArray(e))throw new Error("Container expected");return e}function nu(e){if(typeof e!="number")throw new Error("Numeric key expected");return e}const Kce=String.raw`\(\?(?:[:=!>A-Za-z\-]|<[=!]|\(DEFINE\))`;function Yce(e,t){for(let n=0;n<e.length;n++)e[n]>=t&&e[n]++}function Xce(e,t,n,i){return e.slice(0,t)+i+e.slice(t+n.length)}const Fs=Object.freeze({DEFAULT:"DEFAULT",CHAR_CLASS:"CHAR_CLASS"});function h1(e,t,n,i){const s=new RegExp(String.raw`${t}|(?<$skip>\[\^?|\\?.)`,"gsu"),r=[!1];let o=0,a="";for(const c of e.matchAll(s)){const{0:u,groups:{$skip:h}}=c;if(!h&&(!i||i===Fs.DEFAULT==!o)){n instanceof Function?a+=n(c,{context:o?Fs.CHAR_CLASS:Fs.DEFAULT,negated:r[r.length-1]}):a+=n;continue}u[0]==="["?(o++,r.push(u[1]==="^")):u==="]"&&o&&(o--,r.pop()),a+=u}return a}function XF(e,t,n,i){h1(e,t,n,i)}function Qce(e,t,n=0,i){if(!new RegExp(t,"su").test(e))return null;const s=new RegExp(`${t}|(?<$skip>\\\\?.)`,"gsu");s.lastIndex=n;let r=0,o;for(;o=s.exec(e);){const{0:a,groups:{$skip:c}}=o;if(!c&&(!i||i===Fs.DEFAULT==!r))return o;a==="["?r++:a==="]"&&r&&r--,s.lastIndex==o.index&&s.lastIndex++}return null}function $m(e,t,n){return!!Qce(e,t,0,n)}function Jce(e,t){const n=/\\?./gsu;n.lastIndex=t;let i=e.length,s=0,r=1,o;for(;o=n.exec(e);){const[a]=o;if(a==="[")s++;else if(s)a==="]"&&s--;else if(a==="(")r++;else if(a===")"&&(r--,!r)){i=o.index;break}}return e.slice(t,i)}const lI=new RegExp(String.raw`(?<noncapturingStart>${Kce})|(?<capturingStart>\((?:\?<[^>]+>)?)|\\?.`,"gsu");function Zce(e,t){const n=t?.hiddenCaptures??[];let i=t?.captureTransfers??new Map;if(!/\(\?>/.test(e))return{pattern:e,captureTransfers:i,hiddenCaptures:n};const s="(?>",r="(?:(?=(",o=[0],a=[];let c=0,u=0,h=NaN,f;do{f=!1;let m=0,y=0,b=!1,S;for(lI.lastIndex=Number.isNaN(h)?0:h+r.length;S=lI.exec(e);){const{0:_,index:w,groups:{capturingStart:M,noncapturingStart:R}}=S;if(_==="[")m++;else if(m)_==="]"&&m--;else if(_===s&&!b)h=w,b=!0;else if(b&&R)y++;else if(M)b?y++:(c++,o.push(c+u));else if(_===")"&&b){if(!y){u++;const E=c+u;if(e=`${e.slice(0,h)}${r}${e.slice(h+s.length,w)}))<$$${E}>)${e.slice(w+1)}`,f=!0,a.push(E),Yce(n,E),i.size){const A=new Map;i.forEach((T,L)=>{A.set(L>=E?L+1:L,T.map(P=>P>=E?P+1:P))}),i=A}break}y--}}}while(f);return n.push(...a),e=h1(e,String.raw`\\(?<backrefNum>[1-9]\d*)|<\$\$(?<wrappedBackrefNum>\d+)>`,({0:m,groups:{backrefNum:y,wrappedBackrefNum:b}})=>{if(y){const S=+y;if(S>o.length-1)throw new Error(`Backref "${m}" greater than number of captures`);return`\\${o[S]}`}return`\\${b}`},Fs.DEFAULT),{pattern:e,captureTransfers:i,hiddenCaptures:n}}const QF=String.raw`(?:[?*+]|\{\d+(?:,\d*)?\})`,TS=new RegExp(String.raw`
\\(?: \d+
  | c[A-Za-z]
  | [gk]<[^>]+>
  | [pPu]\{[^\}]+\}
  | u[A-Fa-f\d]{4}
  | x[A-Fa-f\d]{2}
  )
| \((?: \? (?: [:=!>]
  | <(?:[=!]|[^>]+>)
  | [A-Za-z\-]+:
  | \(DEFINE\)
  ))?
| (?<qBase>${QF})(?<qMod>[?+]?)(?<invalidQ>[?*+\{]?)
| \\?.
`.replace(/\s+/g,""),"gsu");function eue(e){if(!new RegExp(`${QF}\\+`).test(e))return{pattern:e};const t=[];let n=null,i=null,s="",r=0,o;for(TS.lastIndex=0;o=TS.exec(e);){const{0:a,index:c,groups:{qBase:u,qMod:h,invalidQ:f}}=o;if(a==="[")r||(i=c),r++;else if(a==="]")r?r--:i=null;else if(!r)if(h==="+"&&s&&!s.startsWith("(")){if(f)throw new Error(`Invalid quantifier "${a}"`);let m=-1;if(/^\{\d+\}$/.test(u))e=Xce(e,c+u.length,h,"");else{if(s===")"||s==="]"){const y=s===")"?n:i;if(y===null)throw new Error(`Invalid unmatched "${s}"`);e=`${e.slice(0,y)}(?>${e.slice(y,c)}${u})${e.slice(c+a.length)}`}else e=`${e.slice(0,c-s.length)}(?>${s}${u})${e.slice(c+a.length)}`;m+=4}TS.lastIndex+=m}else a[0]==="("?t.push(c):a===")"&&(n=t.length?t.pop():null);s=a}return{pattern:e}}const Os=String.raw,tue=Os`\\g<(?<gRNameOrNum>[^>&]+)&R=(?<gRDepth>[^>]+)>`,Cw=Os`\(\?R=(?<rDepth>[^\)]+)\)|${tue}`,Cy=Os`\(\?<(?![=!])(?<captureName>[^>]+)>`,JF=Os`${Cy}|(?<unnamed>\()(?!\?)`,gl=new RegExp(Os`${Cy}|${Cw}|\(\?|\\?.`,"gsu"),ES="Cannot use multiple overlapping recursions";function nue(e,t){const{hiddenCaptures:n,mode:i}={hiddenCaptures:[],mode:"plugin",...t};let s=t?.captureTransfers??new Map;if(!new RegExp(Cw,"su").test(e))return{pattern:e,captureTransfers:s,hiddenCaptures:n};if(i==="plugin"&&$m(e,Os`\(\?\(DEFINE\)`,Fs.DEFAULT))throw new Error("DEFINE groups cannot be used with recursion");const r=[],o=$m(e,Os`\\[1-9]`,Fs.DEFAULT),a=new Map,c=[];let u=!1,h=0,f=0,m;for(gl.lastIndex=0;m=gl.exec(e);){const{0:y,groups:{captureName:b,rDepth:S,gRNameOrNum:_,gRDepth:w}}=m;if(y==="[")h++;else if(h)y==="]"&&h--;else if(S){if(cI(S),u)throw new Error(ES);if(o)throw new Error(`${i==="external"?"Backrefs":"Numbered backrefs"} cannot be used with global recursion`);const M=e.slice(0,m.index),R=e.slice(gl.lastIndex);if($m(R,Cw,Fs.DEFAULT))throw new Error(ES);const E=+S-1;e=uI(M,R,E,!1,n,r,f),s=hI(s,M,E,r.length,0,f);break}else if(_){cI(w);let M=!1;for(const j of c)if(j.name===_||j.num===+_){if(M=!0,j.hasRecursedWithin)throw new Error(ES);break}if(!M)throw new Error(Os`Recursive \g cannot be used outside the referenced group "${i==="external"?_:Os`\g<${_}&R=${w}>`}"`);const R=a.get(_),E=Jce(e,R);if(o&&$m(E,Os`${Cy}|\((?!\?)`,Fs.DEFAULT))throw new Error(`${i==="external"?"Backrefs":"Numbered backrefs"} cannot be used with recursion of capturing groups`);const A=e.slice(R,m.index),T=E.slice(A.length+y.length),L=r.length,P=+w-1,I=uI(A,T,P,!0,n,r,f);s=hI(s,A,P,r.length-L,L,f);const N=e.slice(0,R),O=e.slice(R+E.length);e=`${N}${I}${O}`,gl.lastIndex+=I.length-y.length-A.length-T.length,c.forEach(j=>j.hasRecursedWithin=!0),u=!0}else if(b)f++,a.set(String(f),gl.lastIndex),a.set(b,gl.lastIndex),c.push({num:f,name:b});else if(y[0]==="("){const M=y==="(";M&&(f++,a.set(String(f),gl.lastIndex)),c.push(M?{num:f}:{})}else y===")"&&c.pop()}return n.push(...r),{pattern:e,captureTransfers:s,hiddenCaptures:n}}function cI(e){const t=`Max depth must be integer between 2 and 100; used ${e}`;if(!/^[1-9]\d*$/.test(e))throw new Error(t);if(e=+e,e<2||e>100)throw new Error(t)}function uI(e,t,n,i,s,r,o){const a=new Set;i&&XF(e+t,Cy,({groups:{captureName:u}})=>{a.add(u)},Fs.DEFAULT);const c=[n,i?a:null,s,r,o];return`${e}${dI(`(?:${e}`,"forward",...c)}(?:)${dI(`${t})`,"backward",...c)}${t}`}function dI(e,t,n,i,s,r,o){const c=h=>t==="forward"?h+2:n-h+2-1;let u="";for(let h=0;h<n;h++){const f=c(h);u+=h1(e,Os`${JF}|\\k<(?<backref>[^>]+)>`,({0:m,groups:{captureName:y,unnamed:b,backref:S}})=>{if(S&&i&&!i.has(S))return m;const _=`_$${f}`;if(b||y){const w=o+r.length+1;return r.push(w),iue(s,w),b?m:`(?<${y}${_}>`}return Os`\k<${S}${_}>`},Fs.DEFAULT)}return u}function iue(e,t){for(let n=0;n<e.length;n++)e[n]>=t&&e[n]++}function hI(e,t,n,i,s,r){if(e.size&&i){let o=0;XF(t,JF,()=>o++,Fs.DEFAULT);const a=r-o+s,c=new Map;return e.forEach((u,h)=>{const f=(i-o*n)/n,m=o*n,y=h>a+o?h+i:h,b=[];for(const S of u)if(S<=a)b.push(S);else if(S>a+o+f)b.push(S+i);else if(S<=a+o)for(let _=0;_<=n;_++)b.push(S+o*_);else for(let _=0;_<=n;_++)b.push(S+m+f*_);c.set(y,b)}),c}return e}var In=String.fromCodePoint,Qe=String.raw,Io={flagGroups:(()=>{try{new RegExp("(?i:)")}catch{return!1}return!0})(),unicodeSets:(()=>{try{new RegExp("[[]]","v")}catch{return!1}return!0})()};Io.bugFlagVLiteralHyphenIsRange=Io.unicodeSets?(()=>{try{new RegExp(Qe`[\d\-a]`,"v")}catch{return!0}return!1})():!1;Io.bugNestedClassIgnoresNegation=Io.unicodeSets&&new RegExp("[[^a]]","v").test("a");function Lv(e,{enable:t,disable:n}){return{dotAll:!n?.dotAll&&!!(t?.dotAll||e.dotAll),ignoreCase:!n?.ignoreCase&&!!(t?.ignoreCase||e.ignoreCase)}}function Ef(e,t,n){return e.has(t)||e.set(t,n),e.get(t)}function kw(e,t){return fI[e]>=fI[t]}function sue(e,t){if(e==null)throw new Error(t??"Value expected");return e}var fI={ES2025:2025,ES2024:2024,ES2018:2018},rue={auto:"auto",ES2025:"ES2025",ES2024:"ES2024",ES2018:"ES2018"};function ZF(e={}){if({}.toString.call(e)!=="[object Object]")throw new Error("Unexpected options");if(e.target!==void 0&&!rue[e.target])throw new Error(`Unexpected target "${e.target}"`);const t={accuracy:"default",avoidSubclass:!1,flags:"",global:!1,hasIndices:!1,lazyCompileLength:1/0,target:"auto",verbose:!1,...e,rules:{allowOrphanBackrefs:!1,asciiWordBoundaries:!1,captureGroup:!1,recursionLimit:20,singleline:!1,...e.rules}};return t.target==="auto"&&(t.target=Io.flagGroups?"ES2025":Io.unicodeSets?"ES2024":"ES2018"),t}var oue="[	-\r ]",aue=new Set([In(304),In(305)]),yo=Qe`[\p{L}\p{M}\p{N}\p{Pc}]`;function e4(e){if(aue.has(e))return[e];const t=new Set,n=e.toLowerCase(),i=n.toUpperCase(),s=uue.get(n),r=lue.get(n),o=cue.get(n);return[...i].length===1&&t.add(i),o&&t.add(o),s&&t.add(s),t.add(n),r&&t.add(r),[...t]}var f1=new Map(`C Other
Cc Control cntrl
Cf Format
Cn Unassigned
Co Private_Use
Cs Surrogate
L Letter
LC Cased_Letter
Ll Lowercase_Letter
Lm Modifier_Letter
Lo Other_Letter
Lt Titlecase_Letter
Lu Uppercase_Letter
M Mark Combining_Mark
Mc Spacing_Mark
Me Enclosing_Mark
Mn Nonspacing_Mark
N Number
Nd Decimal_Number digit
Nl Letter_Number
No Other_Number
P Punctuation punct
Pc Connector_Punctuation
Pd Dash_Punctuation
Pe Close_Punctuation
Pf Final_Punctuation
Pi Initial_Punctuation
Po Other_Punctuation
Ps Open_Punctuation
S Symbol
Sc Currency_Symbol
Sk Modifier_Symbol
Sm Math_Symbol
So Other_Symbol
Z Separator
Zl Line_Separator
Zp Paragraph_Separator
Zs Space_Separator
ASCII
ASCII_Hex_Digit AHex
Alphabetic Alpha
Any
Assigned
Bidi_Control Bidi_C
Bidi_Mirrored Bidi_M
Case_Ignorable CI
Cased
Changes_When_Casefolded CWCF
Changes_When_Casemapped CWCM
Changes_When_Lowercased CWL
Changes_When_NFKC_Casefolded CWKCF
Changes_When_Titlecased CWT
Changes_When_Uppercased CWU
Dash
Default_Ignorable_Code_Point DI
Deprecated Dep
Diacritic Dia
Emoji
Emoji_Component EComp
Emoji_Modifier EMod
Emoji_Modifier_Base EBase
Emoji_Presentation EPres
Extended_Pictographic ExtPict
Extender Ext
Grapheme_Base Gr_Base
Grapheme_Extend Gr_Ext
Hex_Digit Hex
IDS_Binary_Operator IDSB
IDS_Trinary_Operator IDST
ID_Continue IDC
ID_Start IDS
Ideographic Ideo
Join_Control Join_C
Logical_Order_Exception LOE
Lowercase Lower
Math
Noncharacter_Code_Point NChar
Pattern_Syntax Pat_Syn
Pattern_White_Space Pat_WS
Quotation_Mark QMark
Radical
Regional_Indicator RI
Sentence_Terminal STerm
Soft_Dotted SD
Terminal_Punctuation Term
Unified_Ideograph UIdeo
Uppercase Upper
Variation_Selector VS
White_Space space
XID_Continue XIDC
XID_Start XIDS`.split(/\s/).map(e=>[wy(e),e])),lue=new Map([["s",In(383)],[In(383),"s"]]),cue=new Map([[In(223),In(7838)],[In(107),In(8490)],[In(229),In(8491)],[In(969),In(8486)]]),uue=new Map([Sa(453),Sa(456),Sa(459),Sa(498),...RS(8072,8079),...RS(8088,8095),...RS(8104,8111),Sa(8124),Sa(8140),Sa(8188)]),due=new Map([["alnum",Qe`[\p{Alpha}\p{Nd}]`],["alpha",Qe`\p{Alpha}`],["ascii",Qe`\p{ASCII}`],["blank",Qe`[\p{Zs}\t]`],["cntrl",Qe`\p{Cc}`],["digit",Qe`\p{Nd}`],["graph",Qe`[\P{space}&&\P{Cc}&&\P{Cn}&&\P{Cs}]`],["lower",Qe`\p{Lower}`],["print",Qe`[[\P{space}&&\P{Cc}&&\P{Cn}&&\P{Cs}]\p{Zs}]`],["punct",Qe`[\p{P}\p{S}]`],["space",Qe`\p{space}`],["upper",Qe`\p{Upper}`],["word",Qe`[\p{Alpha}\p{M}\p{Nd}\p{Pc}]`],["xdigit",Qe`\p{AHex}`]]);function hue(e,t){const n=[];for(let i=e;i<=t;i++)n.push(i);return n}function Sa(e){const t=In(e);return[t.toLowerCase(),t]}function RS(e,t){return hue(e,t).map(n=>Sa(n))}var t4=new Set(["Lower","Lowercase","Upper","Uppercase","Ll","Lowercase_Letter","Lt","Titlecase_Letter","Lu","Uppercase_Letter"]);function fue(e,t){const n={accuracy:"default",asciiWordBoundaries:!1,avoidSubclass:!1,bestEffortTarget:"ES2025",...t};n4(e);const i={accuracy:n.accuracy,asciiWordBoundaries:n.asciiWordBoundaries,avoidSubclass:n.avoidSubclass,flagDirectivesByAlt:new Map,jsGroupNameMap:new Map,minTargetEs2024:kw(n.bestEffortTarget,"ES2024"),passedLookbehind:!1,strategy:null,subroutineRefMap:new Map,supportedGNodes:new Set,digitIsAscii:e.flags.digitIsAscii,spaceIsAscii:e.flags.spaceIsAscii,wordIsAscii:e.flags.wordIsAscii};Yh(e,pue,i);const s={dotAll:e.flags.dotAll,ignoreCase:e.flags.ignoreCase},r={currentFlags:s,prevFlags:null,globalFlags:s,groupOriginByCopy:new Map,groupsByName:new Map,multiplexCapturesToLeftByRef:new Map,openRefs:new Map,reffedNodesByReferencer:new Map,subroutineRefMap:i.subroutineRefMap};Yh(e,mue,r);const o={groupsByName:r.groupsByName,highestOrphanBackref:0,numCapturesToLeft:0,reffedNodesByReferencer:r.reffedNodesByReferencer};return Yh(e,gue,o),e._originMap=r.groupOriginByCopy,e._strategy=i.strategy,e}var pue={AbsenceFunction({node:e,parent:t,replaceWith:n}){const{body:i,kind:s}=e;if(s==="repeater"){const r=ir();r.body[0].body.push(Ml({negate:!0,body:i}),lu("Any"));const o=ir();o.body[0].body.push(GF("greedy",0,1/0,r)),n(vn(o,t),{traverse:!0})}else throw new Error('Unsupported absence function "(?~|"')},Alternative:{enter({node:e,parent:t,key:n},{flagDirectivesByAlt:i}){const s=e.body.filter(r=>r.kind==="flags");for(let r=n+1;r<t.body.length;r++){const o=t.body[r];Ef(i,o,[]).push(...s)}},exit({node:e},{flagDirectivesByAlt:t}){if(t.get(e)?.length){const n=s4(t.get(e));if(n){const i=ir({flags:n});i.body[0].body=e.body,e.body=[vn(i,e)]}}}},Assertion({node:e,parent:t,key:n,container:i,root:s,remove:r,replaceWith:o},a){const{kind:c,negate:u}=e,{asciiWordBoundaries:h,avoidSubclass:f,supportedGNodes:m,wordIsAscii:y}=a;if(c==="text_segment_boundary")throw new Error(`Unsupported text segment boundary "\\${u?"Y":"y"}"`);if(c==="line_end")o(vn(Ml({body:[Kl({body:[Sw("string_end")]}),Kl({body:[xy(10)]})]}),t));else if(c==="line_start")o(vn(bo(Qe`(?<=\A|\n(?!\z))`,{skipLookbehindValidation:!0}),t));else if(c==="search_start")if(m.has(e))s.flags.sticky=!0,r();else{const b=i[n-1];if(b&&xue(b))o(vn(Ml({negate:!0}),t));else{if(f)throw new Error(Qe`Uses "\G" in a way that requires a subclass`);o(xa(Sw("string_start"),t)),a.strategy="clip_search"}}else if(!(c==="string_end"||c==="string_start"))if(c==="string_end_newline")o(vn(bo(Qe`(?=\n?\z)`),t));else if(c==="word_boundary"){if(!y&&!h){const b=`(?:(?<=${yo})(?!${yo})|(?<!${yo})(?=${yo}))`,S=`(?:(?<=${yo})(?=${yo})|(?<!${yo})(?!${yo}))`;o(vn(bo(u?S:b),t))}}else throw new Error(`Unexpected assertion kind "${c}"`)},Backreference({node:e},{jsGroupNameMap:t}){let{ref:n}=e;typeof n=="string"&&!AS(n)&&(n=MS(n,t),e.ref=n)},CapturingGroup({node:e},{jsGroupNameMap:t,subroutineRefMap:n}){let{name:i}=e;i&&!AS(i)&&(i=MS(i,t),e.name=i),n.set(e.number,e),i&&n.set(i,e)},CharacterClassRange({node:e,parent:t,replaceWith:n}){if(t.kind==="intersection"){const i=Rg({body:[e]});n(vn(i,t),{traverse:!0})}},CharacterSet({node:e,parent:t,replaceWith:n},{accuracy:i,minTargetEs2024:s,digitIsAscii:r,spaceIsAscii:o,wordIsAscii:a}){const{kind:c,negate:u,value:h}=e;if(r&&(c==="digit"||h==="digit")){n(xa(ww("digit",{negate:u}),t));return}if(o&&(c==="space"||h==="space")){n(vn(PS(bo(oue),u),t));return}if(a&&(c==="word"||h==="word")){n(xa(ww("word",{negate:u}),t));return}if(c==="any")n(xa(lu("Any"),t));else if(c==="digit")n(xa(lu("Nd",{negate:u}),t));else if(c!=="dot")if(c==="text_segment"){if(i==="strict")throw new Error(Qe`Use of "\X" requires non-strict accuracy`);const f="\\p{Emoji}(?:\\p{EMod}|\\uFE0F\\u20E3?|[\\x{E0020}-\\x{E007E}]+\\x{E007F})?",m=Qe`\p{RI}{2}|${f}(?:\u200D${f})*`;n(vn(bo(Qe`(?>\r\n|${s?Qe`\p{RGI_Emoji}`:m}|\P{M}\p{M}*)`,{skipPropertyNameValidation:!0}),t))}else if(c==="hex")n(xa(lu("AHex",{negate:u}),t));else if(c==="newline")n(vn(bo(u?`[^
]`:`(?>\r
?|[
\v\f\u2028\u2029])`),t));else if(c==="posix")if(!s&&(h==="graph"||h==="print")){if(i==="strict")throw new Error(`POSIX class "${h}" requires min target ES2024 or non-strict accuracy`);let f={graph:"!-~",print:" -~"}[h];u&&(f=`\0-${In(f.codePointAt(0)-1)}${In(f.codePointAt(2)+1)}-`),n(vn(bo(`[${f}]`),t))}else n(vn(PS(bo(due.get(h)),u),t));else if(c==="property")f1.has(wy(h))||(e.key="sc");else if(c==="space")n(xa(lu("space",{negate:u}),t));else if(c==="word")n(vn(PS(bo(yo),u),t));else throw new Error(`Unexpected character set kind "${c}"`)},Directive({node:e,parent:t,root:n,remove:i,replaceWith:s,removeAllPrevSiblings:r,removeAllNextSiblings:o}){const{kind:a,flags:c}=e;if(a==="flags")if(!c.enable&&!c.disable)i();else{const u=ir({flags:c});u.body[0].body=o(),s(vn(u,t),{traverse:!0})}else if(a==="keep"){const u=n.body[0],f=n.body.length===1&&HF(u,{type:"Group"})&&u.body[0].body.length===1?u.body[0]:n;if(t.parent!==f||f.body.length>1)throw new Error(Qe`Uses "\K" in a way that's unsupported`);const m=Ml({behind:!0});m.body[0].body=r(),s(vn(m,t))}else throw new Error(`Unexpected directive kind "${a}"`)},Flags({node:e,parent:t}){if(e.posixIsAscii)throw new Error('Unsupported flag "P"');if(e.textSegmentMode==="word")throw new Error('Unsupported flag "y{w}"');["digitIsAscii","extended","posixIsAscii","spaceIsAscii","wordIsAscii","textSegmentMode"].forEach(n=>delete e[n]),Object.assign(e,{global:!1,hasIndices:!1,multiline:!1,sticky:e.sticky??!1}),t.options={disable:{x:!0,n:!0},force:{v:!0}}},Group({node:e}){if(!e.flags)return;const{enable:t,disable:n}=e.flags;t?.extended&&delete t.extended,n?.extended&&delete n.extended,t?.dotAll&&n?.dotAll&&delete t.dotAll,t?.ignoreCase&&n?.ignoreCase&&delete t.ignoreCase,t&&!Object.keys(t).length&&delete e.flags.enable,n&&!Object.keys(n).length&&delete e.flags.disable,!e.flags.enable&&!e.flags.disable&&delete e.flags},LookaroundAssertion({node:e},t){const{kind:n}=e;n==="lookbehind"&&(t.passedLookbehind=!0)},NamedCallout({node:e,parent:t,replaceWith:n}){const{kind:i}=e;if(i==="fail")n(vn(Ml({negate:!0}),t));else throw new Error(`Unsupported named callout "(*${i.toUpperCase()}"`)},Quantifier({node:e}){if(e.body.type==="Quantifier"){const t=ir();t.body[0].body.push(e.body),e.body=vn(t,e)}},Regex:{enter({node:e},{supportedGNodes:t}){const n=[];let i=!1,s=!1;for(const r of e.body)if(r.body.length===1&&r.body[0].kind==="search_start")r.body.pop();else{const o=o4(r.body);o?(i=!0,Array.isArray(o)?n.push(...o):n.push(o)):s=!0}i&&!s&&n.forEach(r=>t.add(r))},exit(e,{accuracy:t,passedLookbehind:n,strategy:i}){if(t==="strict"&&n&&i)throw new Error(Qe`Uses "\G" in a way that requires non-strict accuracy`)}},Subroutine({node:e},{jsGroupNameMap:t}){let{ref:n}=e;typeof n=="string"&&!AS(n)&&(n=MS(n,t),e.ref=n)}},mue={Backreference({node:e},{multiplexCapturesToLeftByRef:t,reffedNodesByReferencer:n}){const{orphan:i,ref:s}=e;i||n.set(e,[...t.get(s).map(({node:r})=>r)])},CapturingGroup:{enter({node:e,parent:t,replaceWith:n,skip:i},{groupOriginByCopy:s,groupsByName:r,multiplexCapturesToLeftByRef:o,openRefs:a,reffedNodesByReferencer:c}){const u=s.get(e);if(u&&a.has(e.number)){const f=xa(pI(e.number),t);c.set(f,a.get(e.number)),n(f);return}a.set(e.number,e),o.set(e.number,[]),e.name&&Ef(o,e.name,[]);const h=o.get(e.name??e.number);for(let f=0;f<h.length;f++){const m=h[f];if(u===m.node||u&&u===m.origin||e===m.origin){h.splice(f,1);break}}if(o.get(e.number).push({node:e,origin:u}),e.name&&o.get(e.name).push({node:e,origin:u}),e.name){const f=Ef(r,e.name,new Map);let m=!1;if(u)m=!0;else for(const y of f.values())if(!y.hasDuplicateNameToRemove){m=!0;break}r.get(e.name).set(e,{node:e,hasDuplicateNameToRemove:m})}},exit({node:e},{openRefs:t}){t.delete(e.number)}},Group:{enter({node:e},t){t.prevFlags=t.currentFlags,e.flags&&(t.currentFlags=Lv(t.currentFlags,e.flags))},exit(e,t){t.currentFlags=t.prevFlags}},Subroutine({node:e,parent:t,replaceWith:n},i){const{isRecursive:s,ref:r}=e;if(s){let h=t;for(;(h=h.parent)&&!(h.type==="CapturingGroup"&&(h.name===r||h.number===r)););i.reffedNodesByReferencer.set(e,h);return}const o=i.subroutineRefMap.get(r),a=r===0,c=a?pI(0):i4(o,i.groupOriginByCopy,null);let u=c;if(!a){const h=s4(bue(o,m=>m.type==="Group"&&!!m.flags)),f=h?Lv(i.globalFlags,h):i.globalFlags;vue(f,i.currentFlags)||(u=ir({flags:_ue(f)}),u.body[0].body.push(c))}n(vn(u,t),{traverse:!a})}},gue={Backreference({node:e,parent:t,replaceWith:n},i){if(e.orphan){i.highestOrphanBackref=Math.max(i.highestOrphanBackref,e.ref);return}const r=i.reffedNodesByReferencer.get(e).filter(o=>yue(o,e));if(!r.length)n(vn(Ml({negate:!0}),t));else if(r.length>1){const o=ir({atomic:!0,body:r.reverse().map(a=>Kl({body:[xw(a.number)]}))});n(vn(o,t))}else e.ref=r[0].number},CapturingGroup({node:e},t){e.number=++t.numCapturesToLeft,e.name&&t.groupsByName.get(e.name).get(e).hasDuplicateNameToRemove&&delete e.name},Regex:{exit({node:e},t){const n=Math.max(t.highestOrphanBackref-t.numCapturesToLeft,0);for(let i=0;i<n;i++){const s=WF();e.body.at(-1).body.push(s)}}},Subroutine({node:e},t){!e.isRecursive||e.ref===0||(e.ref=t.reffedNodesByReferencer.get(e).number)}};function n4(e){Yh(e,{"*"({node:t,parent:n}){t.parent=n}})}function vue(e,t){return e.dotAll===t.dotAll&&e.ignoreCase===t.ignoreCase}function yue(e,t){let n=t;do{if(n.type==="Regex")return!1;if(n.type==="Alternative")continue;if(n===e)return!1;const i=r4(n.parent);for(const s of i){if(s===n)break;if(s===e||a4(s,e))return!0}}while(n=n.parent);throw new Error("Unexpected path")}function i4(e,t,n,i){const s=Array.isArray(e)?[]:{};for(const[r,o]of Object.entries(e))r==="parent"?s.parent=Array.isArray(n)?i:n:o&&typeof o=="object"?s[r]=i4(o,t,s,n):(r==="type"&&o==="CapturingGroup"&&t.set(s,t.get(e)??e),s[r]=o);return s}function pI(e){const t=KF(e);return t.isRecursive=!0,t}function bue(e,t){const n=[];for(;e=e.parent;)(!t||t(e))&&n.push(e);return n}function MS(e,t){if(t.has(e))return t.get(e);const n=`$${t.size}_${e.replace(/^[^$_\p{IDS}]|[^$\u200C\u200D\p{IDC}]/ug,"_")}`;return t.set(e,n),n}function s4(e){const t=["dotAll","ignoreCase"],n={enable:{},disable:{}};return e.forEach(({flags:i})=>{t.forEach(s=>{i.enable?.[s]&&(delete n.disable[s],n.enable[s]=!0),i.disable?.[s]&&(n.disable[s]=!0)})}),Object.keys(n.enable).length||delete n.enable,Object.keys(n.disable).length||delete n.disable,n.enable||n.disable?n:null}function _ue({dotAll:e,ignoreCase:t}){const n={};return(e||t)&&(n.enable={},e&&(n.enable.dotAll=!0),t&&(n.enable.ignoreCase=!0)),(!e||!t)&&(n.disable={},!e&&(n.disable.dotAll=!0),!t&&(n.disable.ignoreCase=!0)),n}function r4(e){if(!e)throw new Error("Node expected");const{body:t}=e;return Array.isArray(t)?t:t?[t]:null}function o4(e){const t=e.find(n=>n.kind==="search_start"||wue(n,{negate:!1})||!Sue(n));if(!t)return null;if(t.kind==="search_start")return t;if(t.type==="LookaroundAssertion")return t.body[0].body[0];if(t.type==="CapturingGroup"||t.type==="Group"){const n=[];for(const i of t.body){const s=o4(i.body);if(!s)return null;Array.isArray(s)?n.push(...s):n.push(s)}return n}return null}function a4(e,t){const n=r4(e)??[];for(const i of n)if(i===t||a4(i,t))return!0;return!1}function Sue({type:e}){return e==="Assertion"||e==="Directive"||e==="LookaroundAssertion"}function xue(e){const t=["Character","CharacterClass","CharacterSet"];return t.includes(e.type)||e.type==="Quantifier"&&e.min&&t.includes(e.body.type)}function wue(e,t){const n={negate:null,...t};return e.type==="LookaroundAssertion"&&(n.negate===null||e.negate===n.negate)&&e.body.length===1&&HF(e.body[0],{type:"Assertion",kind:"search_start"})}function AS(e){return/^[$_\p{IDS}][$\u200C\u200D\p{IDC}]*$/u.test(e)}function bo(e,t){const i=VF(e,{...t,unicodePropertyMap:f1}).body;return i.length>1||i[0].body.length>1?ir({body:i}):i[0].body[0]}function PS(e,t){return e.negate=t,e}function xa(e,t){return e.parent=t,e}function vn(e,t){return n4(e),e.parent=t,e}function Cue(e,t){const n=ZF(t),i=kw(n.target,"ES2024"),s=kw(n.target,"ES2025"),r=n.rules.recursionLimit;if(!Number.isInteger(r)||r<2||r>20)throw new Error("Invalid recursionLimit; use 2-20");let o=null,a=null;if(!s){const y=[e.flags.ignoreCase];Yh(e,kue,{getCurrentModI:()=>y.at(-1),popModI(){y.pop()},pushModI(b){y.push(b)},setHasCasedChar(){y.at(-1)?o=!0:a=!0}})}const c={dotAll:e.flags.dotAll,ignoreCase:!!((e.flags.ignoreCase||o)&&!a)};let u=e;const h={accuracy:n.accuracy,appliedGlobalFlags:c,captureMap:new Map,currentFlags:{dotAll:e.flags.dotAll,ignoreCase:e.flags.ignoreCase},inCharClass:!1,lastNode:u,originMap:e._originMap,recursionLimit:r,useAppliedIgnoreCase:!!(!s&&o&&a),useFlagMods:s,useFlagV:i,verbose:n.verbose};function f(y){return h.lastNode=u,u=y,sue(Tue[y.type],`Unexpected node type "${y.type}"`)(y,h,f)}const m={pattern:e.body.map(f).join("|"),flags:f(e.flags),options:{...e.options}};return i||(delete m.options.force.v,m.options.disable.v=!0,m.options.unicodeSetsPlugin=null),m._captureTransfers=new Map,m._hiddenCaptures=[],h.captureMap.forEach((y,b)=>{y.hidden&&m._hiddenCaptures.push(b),y.transferTo&&Ef(m._captureTransfers,y.transferTo,[]).push(b)}),m}var kue={"*":{enter({node:e},t){if(gI(e)){const n=t.getCurrentModI();t.pushModI(e.flags?Lv({ignoreCase:n},e.flags).ignoreCase:n)}},exit({node:e},t){gI(e)&&t.popModI()}},Backreference(e,t){t.setHasCasedChar()},Character({node:e},t){p1(In(e.value))&&t.setHasCasedChar()},CharacterClassRange({node:e,skip:t},n){t(),l4(e,{firstOnly:!0}).length&&n.setHasCasedChar()},CharacterSet({node:e},t){e.kind==="property"&&t4.has(e.value)&&t.setHasCasedChar()}},Tue={Alternative({body:e},t,n){return e.map(n).join("")},Assertion({kind:e,negate:t}){if(e==="string_end")return"$";if(e==="string_start")return"^";if(e==="word_boundary")return t?Qe`\B`:Qe`\b`;throw new Error(`Unexpected assertion kind "${e}"`)},Backreference({ref:e},t){if(typeof e!="number")throw new Error("Unexpected named backref in transformed AST");if(!t.useFlagMods&&t.accuracy==="strict"&&t.currentFlags.ignoreCase&&!t.captureMap.get(e).ignoreCase)throw new Error("Use of case-insensitive backref to case-sensitive group requires target ES2025 or non-strict accuracy");return"\\"+e},CapturingGroup(e,t,n){const{body:i,name:s,number:r}=e,o={ignoreCase:t.currentFlags.ignoreCase},a=t.originMap.get(e);return a&&(o.hidden=!0,r>a.number&&(o.transferTo=a.number)),t.captureMap.set(r,o),`(${s?`?<${s}>`:""}${i.map(n).join("|")})`},Character({value:e},t){const n=In(e),i=iu(e,{escDigit:t.lastNode.type==="Backreference",inCharClass:t.inCharClass,useFlagV:t.useFlagV});if(i!==n)return i;if(t.useAppliedIgnoreCase&&t.currentFlags.ignoreCase&&p1(n)){const s=e4(n);return t.inCharClass?s.join(""):s.length>1?`[${s.join("")}]`:s[0]}return n},CharacterClass(e,t,n){const{kind:i,negate:s,parent:r}=e;let{body:o}=e;if(i==="intersection"&&!t.useFlagV)throw new Error("Use of character class intersection requires min target ES2024");Io.bugFlagVLiteralHyphenIsRange&&t.useFlagV&&o.some(vI)&&(o=[xy(45),...o.filter(u=>!vI(u))]);const a=()=>`[${s?"^":""}${o.map(n).join(i==="intersection"?"&&":"")}]`;if(!t.inCharClass){if((!t.useFlagV||Io.bugNestedClassIgnoresNegation)&&!s){const h=o.filter(f=>f.type==="CharacterClass"&&f.kind==="union"&&f.negate);if(h.length){const f=ir(),m=f.body[0];return f.parent=r,m.parent=f,o=o.filter(y=>!h.includes(y)),e.body=o,o.length?(e.parent=m,m.body.push(e)):f.body.pop(),h.forEach(y=>{const b=Kl({body:[y]});y.parent=b,b.parent=f,f.body.push(b)}),n(f)}}t.inCharClass=!0;const u=a();return t.inCharClass=!1,u}const c=o[0];if(i==="union"&&!s&&c&&((!t.useFlagV||!t.verbose)&&r.kind==="union"&&!(Io.bugFlagVLiteralHyphenIsRange&&t.useFlagV)||!t.verbose&&r.kind==="intersection"&&o.length===1&&c.type!=="CharacterClassRange"))return o.map(n).join("");if(!t.useFlagV&&r.type==="CharacterClass")throw new Error("Uses nested character class in a way that requires min target ES2024");return a()},CharacterClassRange(e,t){const n=e.min.value,i=e.max.value,s={escDigit:!1,inCharClass:!0,useFlagV:t.useFlagV},r=iu(n,s),o=iu(i,s),a=new Set;if(t.useAppliedIgnoreCase&&t.currentFlags.ignoreCase){const c=l4(e);Pue(c).forEach(h=>{a.add(Array.isArray(h)?`${iu(h[0],s)}-${iu(h[1],s)}`:iu(h,s))})}return`${r}-${o}${[...a].join("")}`},CharacterSet({kind:e,negate:t,value:n,key:i},s){if(e==="dot")return s.currentFlags.dotAll?s.appliedGlobalFlags.dotAll||s.useFlagMods?".":"[^]":Qe`[^\n]`;if(e==="digit")return t?Qe`\D`:Qe`\d`;if(e==="property"){if(s.useAppliedIgnoreCase&&s.currentFlags.ignoreCase&&t4.has(n))throw new Error(`Unicode property "${n}" can't be case-insensitive when other chars have specific case`);return`${t?Qe`\P`:Qe`\p`}{${i?`${i}=`:""}${n}}`}if(e==="word")return t?Qe`\W`:Qe`\w`;throw new Error(`Unexpected character set kind "${e}"`)},Flags(e,t){return(t.appliedGlobalFlags.ignoreCase?"i":"")+(e.dotAll?"s":"")+(e.sticky?"y":"")},Group({atomic:e,body:t,flags:n,parent:i},s,r){const o=s.currentFlags;n&&(s.currentFlags=Lv(o,n));const a=t.map(r).join("|"),c=!s.verbose&&t.length===1&&i.type!=="Quantifier"&&!e&&(!s.useFlagMods||!n)?a:`(?${Lue(e,n,s.useFlagMods)}${a})`;return s.currentFlags=o,c},LookaroundAssertion({body:e,kind:t,negate:n},i,s){return`(?${`${t==="lookahead"?"":"<"}${n?"!":"="}`}${e.map(s).join("|")})`},Quantifier(e,t,n){return n(e.body)+Nue(e)},Subroutine({isRecursive:e,ref:t},n){if(!e)throw new Error("Unexpected non-recursive subroutine in transformed AST");const i=n.recursionLimit;return t===0?`(?R=${i})`:Qe`\g<${t}&R=${i}>`}},Eue=new Set(["$","(",")","*","+",".","?","[","\\","]","^","{","|","}"]),Rue=new Set(["-","\\","]","^","["]),Mue=new Set(["(",")","-","/","[","\\","]","^","{","|","}","!","#","$","%","&","*","+",",",".",":",";","<","=",">","?","@","`","~"]),mI=new Map([[9,Qe`\t`],[10,Qe`\n`],[11,Qe`\v`],[12,Qe`\f`],[13,Qe`\r`],[8232,Qe`\u2028`],[8233,Qe`\u2029`],[65279,Qe`\uFEFF`]]),Aue=new RegExp("^\\p{Cased}$","u");function p1(e){return Aue.test(e)}function l4(e,t){const n=!!t?.firstOnly,i=e.min.value,s=e.max.value,r=[];if(i<65&&(s===65535||s>=131071)||i===65536&&s>=131071)return r;for(let o=i;o<=s;o++){const a=In(o);if(!p1(a))continue;const c=e4(a).filter(u=>{const h=u.codePointAt(0);return h<i||h>s});if(c.length&&(r.push(...c),n))break}return r}function iu(e,{escDigit:t,inCharClass:n,useFlagV:i}){if(mI.has(e))return mI.get(e);if(e<32||e>126&&e<160||e>262143||t&&Iue(e))return e>255?`\\u{${e.toString(16).toUpperCase()}}`:`\\x${e.toString(16).toUpperCase().padStart(2,"0")}`;const s=n?i?Mue:Rue:Eue,r=In(e);return(s.has(r)?"\\":"")+r}function Pue(e){const t=e.map(s=>s.codePointAt(0)).sort((s,r)=>s-r),n=[];let i=null;for(let s=0;s<t.length;s++)t[s+1]===t[s]+1?i??=t[s]:i===null?n.push(t[s]):(n.push([i,t[s]]),i=null);return n}function Lue(e,t,n){if(e)return">";let i="";if(t&&n){const{enable:s,disable:r}=t;i=(s?.ignoreCase?"i":"")+(s?.dotAll?"s":"")+(r?"-":"")+(r?.ignoreCase?"i":"")+(r?.dotAll?"s":"")}return`${i}:`}function Nue({kind:e,max:t,min:n}){let i;return!n&&t===1?i="?":!n&&t===1/0?i="*":n===1&&t===1/0?i="+":n===t?i=`{${n}}`:i=`{${n},${t===1/0?"":t}}`,i+{greedy:"",lazy:"?",possessive:"+"}[e]}function gI({type:e}){return e==="CapturingGroup"||e==="Group"||e==="LookaroundAssertion"}function Iue(e){return e>47&&e<58}function vI({type:e,value:t}){return e==="Character"&&t===45}var Due=class Tw extends RegExp{#e=new Map;#t=null;#n;#s=null;#i=null;rawOptions={};get source(){return this.#n||"(?:)"}constructor(t,n,i){const s=!!i?.lazyCompile;if(t instanceof RegExp){if(i)throw new Error("Cannot provide options when copying a regexp");const r=t;super(r,n),this.#n=r.source,r instanceof Tw&&(this.#e=r.#e,this.#s=r.#s,this.#i=r.#i,this.rawOptions=r.rawOptions)}else{const r={hiddenCaptures:[],strategy:null,transfers:[],...i};super(s?"":t,n),this.#n=t,this.#e=jue(r.hiddenCaptures,r.transfers),this.#i=r.strategy,this.rawOptions=i??{}}s||(this.#t=this)}exec(t){if(!this.#t){const{lazyCompile:s,...r}=this.rawOptions;this.#t=new Tw(this.#n,this.flags,r)}const n=this.global||this.sticky,i=this.lastIndex;if(this.#i==="clip_search"&&n&&i){this.lastIndex=0;const s=this.#r(t.slice(i));return s&&(Oue(s,i,t,this.hasIndices),this.lastIndex+=i),s}return this.#r(t)}#r(t){this.#t.lastIndex=this.lastIndex;const n=super.exec.call(this.#t,t);if(this.lastIndex=this.#t.lastIndex,!n||!this.#e.size)return n;const i=[...n];n.length=1;let s;this.hasIndices&&(s=[...n.indices],n.indices.length=1);const r=[0];for(let o=1;o<i.length;o++){const{hidden:a,transferTo:c}=this.#e.get(o)??{};if(a?r.push(null):(r.push(n.length),n.push(i[o]),this.hasIndices&&n.indices.push(s[o])),c&&i[o]!==void 0){const u=r[c];if(!u)throw new Error(`Invalid capture transfer to "${u}"`);if(n[u]=i[o],this.hasIndices&&(n.indices[u]=s[o]),n.groups){this.#s||(this.#s=Bue(this.source));const h=this.#s.get(c);h&&(n.groups[h]=i[o],this.hasIndices&&(n.indices.groups[h]=s[o]))}}}return n}};function Oue(e,t,n,i){if(e.index+=t,e.input=n,i){const s=e.indices;for(let o=0;o<s.length;o++){const a=s[o];a&&(s[o]=[a[0]+t,a[1]+t])}const r=s.groups;r&&Object.keys(r).forEach(o=>{const a=r[o];a&&(r[o]=[a[0]+t,a[1]+t])})}}function jue(e,t){const n=new Map;for(const i of e)n.set(i,{hidden:!0});for(const[i,s]of t)for(const r of s)Ef(n,r,{}).transferTo=i;return n}function Bue(e){const t=/(?<capture>\((?:\?<(?![=!])(?<name>[^>]+)>|(?!\?)))|\\?./gsu,n=new Map;let i=0,s=0,r;for(;r=t.exec(e);){const{0:o,groups:{capture:a,name:c}}=r;o==="["?i++:i?o==="]"&&i--:a&&(s++,c&&n.set(s,c))}return n}function Fue(e,t){const n=Uue(e,t);return n.options?new Due(n.pattern,n.flags,n.options):new RegExp(n.pattern,n.flags)}function Uue(e,t){const n=ZF(t),i=VF(e,{flags:n.flags,normalizeUnknownPropertyNames:!0,rules:{captureGroup:n.rules.captureGroup,singleline:n.rules.singleline},skipBackrefValidation:n.rules.allowOrphanBackrefs,unicodePropertyMap:f1}),s=fue(i,{accuracy:n.accuracy,asciiWordBoundaries:n.rules.asciiWordBoundaries,avoidSubclass:n.avoidSubclass,bestEffortTarget:n.target}),r=Cue(s,n),o=nue(r.pattern,{captureTransfers:r._captureTransfers,hiddenCaptures:r._hiddenCaptures,mode:"external"}),a=eue(o.pattern),c=Zce(a.pattern,{captureTransfers:o.captureTransfers,hiddenCaptures:o.hiddenCaptures}),u={pattern:c.pattern,flags:`${n.hasIndices?"d":""}${n.global?"g":""}${r.flags}${r.options.disable.v?"u":"v"}`};if(n.avoidSubclass){if(n.lazyCompileLength!==1/0)throw new Error("Lazy compilation requires subclass")}else{const h=c.hiddenCaptures.sort((b,S)=>b-S),f=Array.from(c.captureTransfers),m=s._strategy,y=u.pattern.length>=n.lazyCompileLength;(h.length||f.length||m||y)&&(u.options={...h.length&&{hiddenCaptures:h},...f.length&&{transfers:f},...m&&{strategy:m},...y&&{lazyCompile:y}})}return u}const yI=4294967295;class zue{constructor(t,n={}){this.patterns=t,this.options=n;const{forgiving:i=!1,cache:s,regexConstructor:r}=n;if(!r)throw new Error("Option `regexConstructor` is not provided");this.regexps=t.map(o=>{if(typeof o!="string")return o;const a=s?.get(o);if(a){if(a instanceof RegExp)return a;if(i)return null;throw a}try{const c=r(o);return s?.set(o,c),c}catch(c){if(s?.set(o,c),i)return null;throw c}})}regexps;findNextMatchSync(t,n,i){const s=typeof t=="string"?t:t.content,r=[];function o(a,c,u=0){return{index:a,captureIndices:c.indices.map(h=>h==null?{start:yI,end:yI,length:0}:{start:h[0]+u,end:h[1]+u,length:h[1]-h[0]})}}for(let a=0;a<this.regexps.length;a++){const c=this.regexps[a];if(c)try{c.lastIndex=n;const u=c.exec(s);if(!u)continue;if(u.index===n)return o(a,u,0);r.push([a,u,0])}catch(u){if(this.options.forgiving)continue;throw u}}if(r.length){const a=Math.min(...r.map(c=>c[1].index));for(const[c,u,h]of r)if(u.index===a)return o(c,u,h)}return null}}function $ue(e,t){return Fue(e,{global:!0,hasIndices:!0,lazyCompileLength:3e3,rules:{allowOrphanBackrefs:!0,asciiWordBoundaries:!0,captureGroup:!0,recursionLimit:5,singleline:!0},...t})}function que(e={}){const t=Object.assign({target:"auto",cache:new Map},e);return t.regexConstructor||=n=>$ue(n,{target:t.target}),{createScanner(n){return new zue(n,t)},createString(n){return{content:n}}}}function Hue(){return typeof navigator>"u"?"":String(navigator.userAgent??"")}function ky(e=Hue()){const t=String(e||""),n=/AppleWebKit/i.test(t),i=/(Mobile|iP(hone|ad|od))/i.test(t),s=/OS 16_2(?:_|\b)/i.test(t),r=/Version\/16\.2/i.test(t)&&n&&i;return s||r}async function Vue(e){if(!ky())return{reloaded:!1};const t=e.maxReloadWindowMs??1e4,n=`hapi:ios162:compat-reload:${e.appVersion}`,i=Date.now(),s=(()=>{try{return"serviceWorker"in navigator&&!!navigator.serviceWorker.controller}catch{return!1}})(),r=await(async()=>{try{return"serviceWorker"in navigator?await navigator.serviceWorker.getRegistrations():[]}catch{return[]}})();try{await Promise.all(r.map(c=>c.unregister()))}catch{}try{if(typeof caches?.keys=="function"){const c=await caches.keys();await Promise.all(c.map(u=>caches.delete(u)))}}catch{}if(!(s||r.length>0))return{reloaded:!1};const a=(()=>{try{return Number(localStorage.getItem(n)||0)}catch{return 0}})();if(a&&i-a<t)return{reloaded:!1};try{localStorage.setItem(n,String(i))}catch{}try{window.location.reload()}catch{}return{reloaded:!0}}const Wue=[xt(()=>import("./github-light-DAi9KRSo.js"),[]),xt(()=>import("./github-dark-DHJKELXO.js"),[])],Gue=[xt(()=>import("./shellscript-Yzrsuije.js"),[]),xt(()=>import("./powershell-Dpen1YoG.js"),[]),xt(()=>import("./json-Cp-IABpG.js"),[]),xt(()=>import("./yaml-Buea-lGh.js"),[]),xt(()=>import("./toml-vGWfd6FD.js"),[]),xt(()=>import("./xml-sdJ4AIDG.js"),__vite__mapDeps([0,1])),xt(()=>import("./ini-BEwlwnbL.js"),[]),xt(()=>import("./markdown-Cvjx9yec.js"),[]),xt(()=>import("./html-GMplVEZG.js"),__vite__mapDeps([2,3,4])),xt(()=>import("./css-DPfMkruS.js"),[]),xt(()=>import("./scss-OYdSNvt2.js"),__vite__mapDeps([5,4])),xt(()=>import("./javascript-wDzz0qaB.js"),[]),xt(()=>import("./typescript-BPQ3VLAy.js"),[]),xt(()=>import("./jsx-g9-lgVsj.js"),[]),xt(()=>import("./tsx-COt5Ahok.js"),[]),xt(()=>import("./sql-BLtJtn59.js"),[]),xt(()=>import("./graphql-ChdNCCLP.js"),__vite__mapDeps([6,3,7,8,9])),xt(()=>import("./c-BIGW1oBm.js"),[]),xt(()=>import("./rust-B1yitclQ.js"),[]),xt(()=>import("./go-Dn2_MT6a.js"),[]),xt(()=>import("./java-CylS5w8V.js"),[]),xt(()=>import("./kotlin-BdnUsdx6.js"),[]),xt(()=>import("./python-B6aJPvgy.js"),[]),xt(()=>import("./php-CDn_0X-4.js"),__vite__mapDeps([10,2,3,4,0,1,11,12])),xt(()=>import("./swift-Dg5xB15N.js"),[]),xt(()=>import("./csharp-K5feNrxe.js"),[]),xt(()=>import("./dockerfile-BcOcwvcX.js"),[]),xt(()=>import("./make-CHLpvVh8.js"),[]),xt(()=>import("./diff-D97Zzqfu.js"),[])],Kue={light:"github-light",dark:"github-dark"},c4={sh:"shellscript",bash:"shellscript",zsh:"shellscript",shell:"shellscript",ps1:"powershell",js:"javascript",ts:"typescript",mjs:"javascript",cjs:"javascript",mts:"typescript",cts:"typescript",yml:"yaml",md:"markdown",htm:"html",pgsql:"sql",mysql:"sql",postgres:"sql",gql:"graphql",py:"python",rs:"rust",kt:"kotlin",cs:"csharp",makefile:"make"};let LS=null;function Yue(){try{return new RegExp("(?<=a)b"),!0}catch{return!1}}async function Xue(){if(Yue()&&!ky())return que({forgiving:!0});try{const[{createOnigurumaEngine:e},t]=await Promise.all([xt(()=>import("./engine-oniguruma-CyoZypuG.js"),[]),xt(()=>import("./wasm-CG6Dc4jp.js"),[])]);return await e(t)}catch(e){return console.warn("[shiki] Failed to init oniguruma engine; disabling syntax highlighting",e),null}}function Que(){return LS||(LS=(async()=>{const e=await Xue();return e?await ice({themes:Wue,langs:Gue,engine:e}):null})()),LS}function Jue(e){if(!e)return"text";const n=(e.startsWith("language-")?e.slice(9):e).toLowerCase().trim();return n==="text"||n==="plaintext"||n==="txt"?"text":c4[n]??n}function m1(e,t){const[n,i]=k.useState(null),s=k.useMemo(()=>Jue(t),[t]);return k.useEffect(()=>{let r=!1;async function o(){const c=await Que();if(r)return;if(!c){i(null);return}const u=c.getLoadedLanguages();if(s==="text"||!u.includes(s)){i(null);return}const h=c.codeToHast(e,{lang:s,themes:Kue,defaultColor:!1,structure:"inline"});if(r)return;const f=j3(h,{jsx:g.jsx,jsxs:g.jsxs,Fragment:g.Fragment});i(f)}const a=setTimeout(o,50);return()=>{r=!0,clearTimeout(a)}},[e,s]),n}function Zue(e){const t=m1(e.code,e.language);return g.jsx("div",{className:"aui-md-codeblock min-w-0 w-full max-w-full overflow-x-auto overflow-y-hidden rounded-b-md bg-[var(--app-code-bg)]",children:g.jsx("pre",{className:"shiki m-0 w-max min-w-full p-2 text-sm font-mono",children:g.jsx("code",{className:"block",children:t??e.code})})})}function ede(e){if(typeof document>"u"||!document.body)return!1;const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly","true"),t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="1px",t.style.height="1px",t.style.padding="0",t.style.border="0",t.style.opacity="0",t.style.pointerEvents="none";const n=document.activeElement instanceof HTMLElement?document.activeElement:null,i=document.getSelection(),s=i&&i.rangeCount>0?i.getRangeAt(0):null;document.body.appendChild(t),t.focus(),t.select(),t.setSelectionRange(0,t.value.length);let r=!1;try{r=document.execCommand("copy")}catch{r=!1}finally{document.body.removeChild(t),i&&(i.removeAllRanges(),s&&i.addRange(s)),n?.focus()}return r}async function tde(e){if(typeof navigator<"u"&&navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(e);return}catch{}if(!ede(e))throw new Error("Copy to clipboard failed")}function Nv(e=1500){const[t,n]=k.useState(!1),{haptic:i}=Yr(),s=k.useCallback(async r=>{try{return await tde(r),i.notification("success"),n(!0),setTimeout(()=>n(!1),e),!0}catch{return i.notification("error"),!1}},[i,e]);return{copied:t,copy:s}}const nde={tokenize:ude,partial:!0};function ide(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:ade,continuation:{tokenize:lde},exit:cde}},text:{91:{name:"gfmFootnoteCall",tokenize:ode},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:sde,resolveTo:rde}}}}function sde(e,t,n){const i=this;let s=i.events.length;const r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let o;for(;s--;){const c=i.events[s][1];if(c.type==="labelImage"){o=c;break}if(c.type==="gfmFootnoteCall"||c.type==="labelLink"||c.type==="label"||c.type==="image"||c.type==="link")break}return a;function a(c){if(!o||!o._balanced)return n(c);const u=lr(i.sliceSerialize({start:o.end,end:i.now()}));return u.codePointAt(0)!==94||!r.includes(u.slice(1))?n(c):(e.enter("gfmFootnoteCallLabelMarker"),e.consume(c),e.exit("gfmFootnoteCallLabelMarker"),t(c))}}function rde(e,t){let n=e.length;for(;n--;)if(e[n][1].type==="labelImage"&&e[n][0]==="enter"){e[n][1];break}e[n+1][1].type="data",e[n+3][1].type="gfmFootnoteCallLabelMarker";const i={type:"gfmFootnoteCall",start:Object.assign({},e[n+3][1].start),end:Object.assign({},e[e.length-1][1].end)},s={type:"gfmFootnoteCallMarker",start:Object.assign({},e[n+3][1].end),end:Object.assign({},e[n+3][1].end)};s.end.column++,s.end.offset++,s.end._bufferIndex++;const r={type:"gfmFootnoteCallString",start:Object.assign({},s.end),end:Object.assign({},e[e.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},r.start),end:Object.assign({},r.end)},a=[e[n+1],e[n+2],["enter",i,t],e[n+3],e[n+4],["enter",s,t],["exit",s,t],["enter",r,t],["enter",o,t],["exit",o,t],["exit",r,t],e[e.length-2],e[e.length-1],["exit",i,t]];return e.splice(n,e.length-n+1,...a),e}function ode(e,t,n){const i=this,s=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let r=0,o;return a;function a(f){return e.enter("gfmFootnoteCall"),e.enter("gfmFootnoteCallLabelMarker"),e.consume(f),e.exit("gfmFootnoteCallLabelMarker"),c}function c(f){return f!==94?n(f):(e.enter("gfmFootnoteCallMarker"),e.consume(f),e.exit("gfmFootnoteCallMarker"),e.enter("gfmFootnoteCallString"),e.enter("chunkString").contentType="string",u)}function u(f){if(r>999||f===93&&!o||f===null||f===91||_n(f))return n(f);if(f===93){e.exit("chunkString");const m=e.exit("gfmFootnoteCallString");return s.includes(lr(i.sliceSerialize(m)))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(f),e.exit("gfmFootnoteCallLabelMarker"),e.exit("gfmFootnoteCall"),t):n(f)}return _n(f)||(o=!0),r++,e.consume(f),f===92?h:u}function h(f){return f===91||f===92||f===93?(e.consume(f),r++,u):u(f)}}function ade(e,t,n){const i=this,s=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let r,o=0,a;return c;function c(b){return e.enter("gfmFootnoteDefinition")._container=!0,e.enter("gfmFootnoteDefinitionLabel"),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(b),e.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(b){return b===94?(e.enter("gfmFootnoteDefinitionMarker"),e.consume(b),e.exit("gfmFootnoteDefinitionMarker"),e.enter("gfmFootnoteDefinitionLabelString"),e.enter("chunkString").contentType="string",h):n(b)}function h(b){if(o>999||b===93&&!a||b===null||b===91||_n(b))return n(b);if(b===93){e.exit("chunkString");const S=e.exit("gfmFootnoteDefinitionLabelString");return r=lr(i.sliceSerialize(S)),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(b),e.exit("gfmFootnoteDefinitionLabelMarker"),e.exit("gfmFootnoteDefinitionLabel"),m}return _n(b)||(a=!0),o++,e.consume(b),b===92?f:h}function f(b){return b===91||b===92||b===93?(e.consume(b),o++,h):h(b)}function m(b){return b===58?(e.enter("definitionMarker"),e.consume(b),e.exit("definitionMarker"),s.includes(r)||s.push(r),Ct(e,y,"gfmFootnoteDefinitionWhitespace")):n(b)}function y(b){return t(b)}}function lde(e,t,n){return e.check(qf,t,e.attempt(nde,t,n))}function cde(e){e.exit("gfmFootnoteDefinition")}function ude(e,t,n){const i=this;return Ct(e,s,"gfmFootnoteDefinitionIndent",5);function s(r){const o=i.events[i.events.length-1];return o&&o[1].type==="gfmFootnoteDefinitionIndent"&&o[2].sliceSerialize(o[1],!0).length===4?t(r):n(r)}}function dde(e){let n=(e||{}).singleTilde;const i={name:"strikethrough",tokenize:r,resolveAll:s};return n==null&&(n=!0),{text:{126:i},insideSpan:{null:[i]},attentionMarkers:{null:[126]}};function s(o,a){let c=-1;for(;++c<o.length;)if(o[c][0]==="enter"&&o[c][1].type==="strikethroughSequenceTemporary"&&o[c][1]._close){let u=c;for(;u--;)if(o[u][0]==="exit"&&o[u][1].type==="strikethroughSequenceTemporary"&&o[u][1]._open&&o[c][1].end.offset-o[c][1].start.offset===o[u][1].end.offset-o[u][1].start.offset){o[c][1].type="strikethroughSequence",o[u][1].type="strikethroughSequence";const h={type:"strikethrough",start:Object.assign({},o[u][1].start),end:Object.assign({},o[c][1].end)},f={type:"strikethroughText",start:Object.assign({},o[u][1].end),end:Object.assign({},o[c][1].start)},m=[["enter",h,a],["enter",o[u][1],a],["exit",o[u][1],a],["enter",f,a]],y=a.parser.constructs.insideSpan.null;y&&ps(m,m.length,0,vy(y,o.slice(u+1,c),a)),ps(m,m.length,0,[["exit",f,a],["enter",o[c][1],a],["exit",o[c][1],a],["exit",h,a]]),ps(o,u-1,c-u+3,m),c=u+m.length-2;break}}for(c=-1;++c<o.length;)o[c][1].type==="strikethroughSequenceTemporary"&&(o[c][1].type="data");return o}function r(o,a,c){const u=this.previous,h=this.events;let f=0;return m;function m(b){return u===126&&h[h.length-1][1].type!=="characterEscape"?c(b):(o.enter("strikethroughSequenceTemporary"),y(b))}function y(b){const S=ju(u);if(b===126)return f>1?c(b):(o.consume(b),f++,y);if(f<2&&!n)return c(b);const _=o.exit("strikethroughSequenceTemporary"),w=ju(b);return _._open=!w||w===2&&!!S,_._close=!S||S===2&&!!w,a(b)}}}class hde{constructor(){this.map=[]}add(t,n,i){fde(this,t,n,i)}consume(t){if(this.map.sort(function(r,o){return r[0]-o[0]}),this.map.length===0)return;let n=this.map.length;const i=[];for(;n>0;)n-=1,i.push(t.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),t.length=this.map[n][0];i.push(t.slice()),t.length=0;let s=i.pop();for(;s;){for(const r of s)t.push(r);s=i.pop()}this.map.length=0}}function fde(e,t,n,i){let s=0;if(!(n===0&&i.length===0)){for(;s<e.map.length;){if(e.map[s][0]===t){e.map[s][1]+=n,e.map[s][2].push(...i);return}s+=1}e.map.push([t,n,i])}}function pde(e,t){let n=!1;const i=[];for(;t<e.length;){const s=e[t];if(n){if(s[0]==="enter")s[1].type==="tableContent"&&i.push(e[t+1][1].type==="tableDelimiterMarker"?"left":"none");else if(s[1].type==="tableContent"){if(e[t-1][1].type==="tableDelimiterMarker"){const r=i.length-1;i[r]=i[r]==="left"?"center":"right"}}else if(s[1].type==="tableDelimiterRow")break}else s[0]==="enter"&&s[1].type==="tableDelimiterRow"&&(n=!0);t+=1}return i}function mde(){return{flow:{null:{name:"table",tokenize:gde,resolveAll:vde}}}}function gde(e,t,n){const i=this;let s=0,r=0,o;return a;function a(N){let O=i.events.length-1;for(;O>-1;){const V=i.events[O][1].type;if(V==="lineEnding"||V==="linePrefix")O--;else break}const j=O>-1?i.events[O][1].type:null,$=j==="tableHead"||j==="tableRow"?T:c;return $===T&&i.parser.lazy[i.now().line]?n(N):$(N)}function c(N){return e.enter("tableHead"),e.enter("tableRow"),u(N)}function u(N){return N===124||(o=!0,r+=1),h(N)}function h(N){return N===null?n(N):Fe(N)?r>1?(r=0,i.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(N),e.exit("lineEnding"),y):n(N):gt(N)?Ct(e,h,"whitespace")(N):(r+=1,o&&(o=!1,s+=1),N===124?(e.enter("tableCellDivider"),e.consume(N),e.exit("tableCellDivider"),o=!0,h):(e.enter("data"),f(N)))}function f(N){return N===null||N===124||_n(N)?(e.exit("data"),h(N)):(e.consume(N),N===92?m:f)}function m(N){return N===92||N===124?(e.consume(N),f):f(N)}function y(N){return i.interrupt=!1,i.parser.lazy[i.now().line]?n(N):(e.enter("tableDelimiterRow"),o=!1,gt(N)?Ct(e,b,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(N):b(N))}function b(N){return N===45||N===58?_(N):N===124?(o=!0,e.enter("tableCellDivider"),e.consume(N),e.exit("tableCellDivider"),S):A(N)}function S(N){return gt(N)?Ct(e,_,"whitespace")(N):_(N)}function _(N){return N===58?(r+=1,o=!0,e.enter("tableDelimiterMarker"),e.consume(N),e.exit("tableDelimiterMarker"),w):N===45?(r+=1,w(N)):N===null||Fe(N)?E(N):A(N)}function w(N){return N===45?(e.enter("tableDelimiterFiller"),M(N)):A(N)}function M(N){return N===45?(e.consume(N),M):N===58?(o=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(N),e.exit("tableDelimiterMarker"),R):(e.exit("tableDelimiterFiller"),R(N))}function R(N){return gt(N)?Ct(e,E,"whitespace")(N):E(N)}function E(N){return N===124?b(N):N===null||Fe(N)?!o||s!==r?A(N):(e.exit("tableDelimiterRow"),e.exit("tableHead"),t(N)):A(N)}function A(N){return n(N)}function T(N){return e.enter("tableRow"),L(N)}function L(N){return N===124?(e.enter("tableCellDivider"),e.consume(N),e.exit("tableCellDivider"),L):N===null||Fe(N)?(e.exit("tableRow"),t(N)):gt(N)?Ct(e,L,"whitespace")(N):(e.enter("data"),P(N))}function P(N){return N===null||N===124||_n(N)?(e.exit("data"),L(N)):(e.consume(N),N===92?I:P)}function I(N){return N===92||N===124?(e.consume(N),P):P(N)}}function vde(e,t){let n=-1,i=!0,s=0,r=[0,0,0,0],o=[0,0,0,0],a=!1,c=0,u,h,f;const m=new hde;for(;++n<e.length;){const y=e[n],b=y[1];y[0]==="enter"?b.type==="tableHead"?(a=!1,c!==0&&(bI(m,t,c,u,h),h=void 0,c=0),u={type:"table",start:Object.assign({},b.start),end:Object.assign({},b.end)},m.add(n,0,[["enter",u,t]])):b.type==="tableRow"||b.type==="tableDelimiterRow"?(i=!0,f=void 0,r=[0,0,0,0],o=[0,n+1,0,0],a&&(a=!1,h={type:"tableBody",start:Object.assign({},b.start),end:Object.assign({},b.end)},m.add(n,0,[["enter",h,t]])),s=b.type==="tableDelimiterRow"?2:h?3:1):s&&(b.type==="data"||b.type==="tableDelimiterMarker"||b.type==="tableDelimiterFiller")?(i=!1,o[2]===0&&(r[1]!==0&&(o[0]=o[1],f=qm(m,t,r,s,void 0,f),r=[0,0,0,0]),o[2]=n)):b.type==="tableCellDivider"&&(i?i=!1:(r[1]!==0&&(o[0]=o[1],f=qm(m,t,r,s,void 0,f)),r=o,o=[r[1],n,0,0])):b.type==="tableHead"?(a=!0,c=n):b.type==="tableRow"||b.type==="tableDelimiterRow"?(c=n,r[1]!==0?(o[0]=o[1],f=qm(m,t,r,s,n,f)):o[1]!==0&&(f=qm(m,t,o,s,n,f)),s=0):s&&(b.type==="data"||b.type==="tableDelimiterMarker"||b.type==="tableDelimiterFiller")&&(o[3]=n)}for(c!==0&&bI(m,t,c,u,h),m.consume(t.events),n=-1;++n<t.events.length;){const y=t.events[n];y[0]==="enter"&&y[1].type==="table"&&(y[1]._align=pde(t.events,n))}return e}function qm(e,t,n,i,s,r){const o=i===1?"tableHeader":i===2?"tableDelimiter":"tableData",a="tableContent";n[0]!==0&&(r.end=Object.assign({},cu(t.events,n[0])),e.add(n[0],0,[["exit",r,t]]));const c=cu(t.events,n[1]);if(r={type:o,start:Object.assign({},c),end:Object.assign({},c)},e.add(n[1],0,[["enter",r,t]]),n[2]!==0){const u=cu(t.events,n[2]),h=cu(t.events,n[3]),f={type:a,start:Object.assign({},u),end:Object.assign({},h)};if(e.add(n[2],0,[["enter",f,t]]),i!==2){const m=t.events[n[2]],y=t.events[n[3]];if(m[1].end=Object.assign({},y[1].end),m[1].type="chunkText",m[1].contentType="text",n[3]>n[2]+1){const b=n[2]+1,S=n[3]-n[2]-1;e.add(b,S,[])}}e.add(n[3]+1,0,[["exit",f,t]])}return s!==void 0&&(r.end=Object.assign({},cu(t.events,s)),e.add(s,0,[["exit",r,t]]),r=void 0),r}function bI(e,t,n,i,s){const r=[],o=cu(t.events,n);s&&(s.end=Object.assign({},o),r.push(["exit",s,t])),i.end=Object.assign({},o),r.push(["exit",i,t]),e.add(n+1,0,r)}function cu(e,t){const n=e[t],i=n[0]==="enter"?"start":"end";return n[1][i]}const yde={name:"tasklistCheck",tokenize:_de};function bde(){return{text:{91:yde}}}function _de(e,t,n){const i=this;return s;function s(c){return i.previous!==null||!i._gfmTasklistFirstContentOfListItem?n(c):(e.enter("taskListCheck"),e.enter("taskListCheckMarker"),e.consume(c),e.exit("taskListCheckMarker"),r)}function r(c){return _n(c)?(e.enter("taskListCheckValueUnchecked"),e.consume(c),e.exit("taskListCheckValueUnchecked"),o):c===88||c===120?(e.enter("taskListCheckValueChecked"),e.consume(c),e.exit("taskListCheckValueChecked"),o):n(c)}function o(c){return c===93?(e.enter("taskListCheckMarker"),e.consume(c),e.exit("taskListCheckMarker"),e.exit("taskListCheck"),a):n(c)}function a(c){return Fe(c)?t(c):gt(c)?e.check({tokenize:Sde},t,n)(c):n(c)}}function Sde(e,t,n){return Ct(e,i,"whitespace");function i(s){return s===null?n(s):t(s)}}u4.peek=Ade;function xde(){this.buffer()}function wde(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function Cde(){this.buffer()}function kde(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function Tde(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=lr(this.sliceSerialize(e)).toLowerCase(),n.label=t}function Ede(e){this.exit(e)}function Rde(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=lr(this.sliceSerialize(e)).toLowerCase(),n.label=t}function Mde(e){this.exit(e)}function Ade(){return"["}function u4(e,t,n,i){const s=n.createTracker(i);let r=s.move("[^");const o=n.enter("footnoteReference"),a=n.enter("reference");return r+=s.move(n.safe(n.associationId(e),{after:"]",before:r})),a(),o(),r+=s.move("]"),r}function Pde(){return{enter:{gfmFootnoteCallString:xde,gfmFootnoteCall:wde,gfmFootnoteDefinitionLabelString:Cde,gfmFootnoteDefinition:kde},exit:{gfmFootnoteCallString:Tde,gfmFootnoteCall:Ede,gfmFootnoteDefinitionLabelString:Rde,gfmFootnoteDefinition:Mde}}}function Lde(e){let t=!1;return e&&e.firstLineBlank&&(t=!0),{handlers:{footnoteDefinition:n,footnoteReference:u4},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(i,s,r,o){const a=r.createTracker(o);let c=a.move("[^");const u=r.enter("footnoteDefinition"),h=r.enter("label");return c+=a.move(r.safe(r.associationId(i),{before:c,after:"]"})),h(),c+=a.move("]:"),i.children&&i.children.length>0&&(a.shift(4),c+=a.move((t?`
`:" ")+r.indentLines(r.containerFlow(i,a.current()),t?d4:Nde))),u(),c}}function Nde(e,t,n){return t===0?e:d4(e,t,n)}function d4(e,t,n){return(n?"":"    ")+e}const Ide=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];h4.peek=Fde;function Dde(){return{canContainEols:["delete"],enter:{strikethrough:jde},exit:{strikethrough:Bde}}}function Ode(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:Ide}],handlers:{delete:h4}}}function jde(e){this.enter({type:"delete",children:[]},e)}function Bde(e){this.exit(e)}function h4(e,t,n,i){const s=n.createTracker(i),r=n.enter("strikethrough");let o=s.move("~~");return o+=n.containerPhrasing(e,{...s.current(),before:o,after:"~"}),o+=s.move("~~"),r(),o}function Fde(){return"~"}function Ude(e){return e.length}function zde(e,t){const n=t||{},i=(n.align||[]).concat(),s=n.stringLength||Ude,r=[],o=[],a=[],c=[];let u=0,h=-1;for(;++h<e.length;){const S=[],_=[];let w=-1;for(e[h].length>u&&(u=e[h].length);++w<e[h].length;){const M=$de(e[h][w]);if(n.alignDelimiters!==!1){const R=s(M);_[w]=R,(c[w]===void 0||R>c[w])&&(c[w]=R)}S.push(M)}o[h]=S,a[h]=_}let f=-1;if(typeof i=="object"&&"length"in i)for(;++f<u;)r[f]=_I(i[f]);else{const S=_I(i);for(;++f<u;)r[f]=S}f=-1;const m=[],y=[];for(;++f<u;){const S=r[f];let _="",w="";S===99?(_=":",w=":"):S===108?_=":":S===114&&(w=":");let M=n.alignDelimiters===!1?1:Math.max(1,c[f]-_.length-w.length);const R=_+"-".repeat(M)+w;n.alignDelimiters!==!1&&(M=_.length+M+w.length,M>c[f]&&(c[f]=M),y[f]=M),m[f]=R}o.splice(1,0,m),a.splice(1,0,y),h=-1;const b=[];for(;++h<o.length;){const S=o[h],_=a[h];f=-1;const w=[];for(;++f<u;){const M=S[f]||"";let R="",E="";if(n.alignDelimiters!==!1){const A=c[f]-(_[f]||0),T=r[f];T===114?R=" ".repeat(A):T===99?A%2?(R=" ".repeat(A/2+.5),E=" ".repeat(A/2-.5)):(R=" ".repeat(A/2),E=R):E=" ".repeat(A)}n.delimiterStart!==!1&&!f&&w.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&M==="")&&(n.delimiterStart!==!1||f)&&w.push(" "),n.alignDelimiters!==!1&&w.push(R),w.push(M),n.alignDelimiters!==!1&&w.push(E),n.padding!==!1&&w.push(" "),(n.delimiterEnd!==!1||f!==u-1)&&w.push("|")}b.push(n.delimiterEnd===!1?w.join("").replace(/ +$/,""):w.join(""))}return b.join(`
`)}function $de(e){return e==null?"":String(e)}function _I(e){const t=typeof e=="string"?e.codePointAt(0):0;return t===67||t===99?99:t===76||t===108?108:t===82||t===114?114:0}function qde(e,t,n,i){const s=n.enter("blockquote"),r=n.createTracker(i);r.move("> "),r.shift(2);const o=n.indentLines(n.containerFlow(e,r.current()),Hde);return s(),o}function Hde(e,t,n){return">"+(n?"":" ")+e}function Vde(e,t){return SI(e,t.inConstruct,!0)&&!SI(e,t.notInConstruct,!1)}function SI(e,t,n){if(typeof t=="string"&&(t=[t]),!t||t.length===0)return n;let i=-1;for(;++i<t.length;)if(e.includes(t[i]))return!0;return!1}function xI(e,t,n,i){let s=-1;for(;++s<n.unsafe.length;)if(n.unsafe[s].character===`
`&&Vde(n.stack,n.unsafe[s]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function Wde(e,t){const n=String(e);let i=n.indexOf(t),s=i,r=0,o=0;if(typeof t!="string")throw new TypeError("Expected substring");for(;i!==-1;)i===s?++r>o&&(o=r):r=1,s=i+t.length,i=n.indexOf(t,s);return o}function Gde(e,t){return!!(t.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function Kde(e){const t=e.options.fence||"`";if(t!=="`"&&t!=="~")throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}function Yde(e,t,n,i){const s=Kde(n),r=e.value||"",o=s==="`"?"GraveAccent":"Tilde";if(Gde(e,n)){const f=n.enter("codeIndented"),m=n.indentLines(r,Xde);return f(),m}const a=n.createTracker(i),c=s.repeat(Math.max(Wde(r,s)+1,3)),u=n.enter("codeFenced");let h=a.move(c);if(e.lang){const f=n.enter(`codeFencedLang${o}`);h+=a.move(n.safe(e.lang,{before:h,after:" ",encode:["`"],...a.current()})),f()}if(e.lang&&e.meta){const f=n.enter(`codeFencedMeta${o}`);h+=a.move(" "),h+=a.move(n.safe(e.meta,{before:h,after:`
`,encode:["`"],...a.current()})),f()}return h+=a.move(`
`),r&&(h+=a.move(r+`
`)),h+=a.move(c),u(),h}function Xde(e,t,n){return(n?"":"    ")+e}function g1(e){const t=e.options.quote||'"';if(t!=='"'&&t!=="'")throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function Qde(e,t,n,i){const s=g1(n),r=s==='"'?"Quote":"Apostrophe",o=n.enter("definition");let a=n.enter("label");const c=n.createTracker(i);let u=c.move("[");return u+=c.move(n.safe(n.associationId(e),{before:u,after:"]",...c.current()})),u+=c.move("]: "),a(),!e.url||/[\0- \u007F]/.test(e.url)?(a=n.enter("destinationLiteral"),u+=c.move("<"),u+=c.move(n.safe(e.url,{before:u,after:">",...c.current()})),u+=c.move(">")):(a=n.enter("destinationRaw"),u+=c.move(n.safe(e.url,{before:u,after:e.title?" ":`
`,...c.current()}))),a(),e.title&&(a=n.enter(`title${r}`),u+=c.move(" "+s),u+=c.move(n.safe(e.title,{before:u,after:s,...c.current()})),u+=c.move(s),a()),o(),u}function Jde(e){const t=e.options.emphasis||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}function Rf(e){return"&#x"+e.toString(16).toUpperCase()+";"}function Iv(e,t,n){const i=ju(e),s=ju(t);return i===void 0?s===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}f4.peek=Zde;function f4(e,t,n,i){const s=Jde(n),r=n.enter("emphasis"),o=n.createTracker(i),a=o.move(s);let c=o.move(n.containerPhrasing(e,{after:s,before:a,...o.current()}));const u=c.charCodeAt(0),h=Iv(i.before.charCodeAt(i.before.length-1),u,s);h.inside&&(c=Rf(u)+c.slice(1));const f=c.charCodeAt(c.length-1),m=Iv(i.after.charCodeAt(0),f,s);m.inside&&(c=c.slice(0,-1)+Rf(f));const y=o.move(s);return r(),n.attentionEncodeSurroundingInfo={after:m.outside,before:h.outside},a+c+y}function Zde(e,t,n){return n.options.emphasis||"*"}function ehe(e,t){let n=!1;return Xk(e,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return n=!0,lw}),!!((!e.depth||e.depth<3)&&$k(e)&&(t.options.setext||n))}function the(e,t,n,i){const s=Math.max(Math.min(6,e.depth||1),1),r=n.createTracker(i);if(ehe(e,n)){const h=n.enter("headingSetext"),f=n.enter("phrasing"),m=n.containerPhrasing(e,{...r.current(),before:`
`,after:`
`});return f(),h(),m+`
`+(s===1?"=":"-").repeat(m.length-(Math.max(m.lastIndexOf("\r"),m.lastIndexOf(`
`))+1))}const o="#".repeat(s),a=n.enter("headingAtx"),c=n.enter("phrasing");r.move(o+" ");let u=n.containerPhrasing(e,{before:"# ",after:`
`,...r.current()});return/^[\t ]/.test(u)&&(u=Rf(u.charCodeAt(0))+u.slice(1)),u=u?o+" "+u:o,n.options.closeAtx&&(u+=" "+o),c(),a(),u}p4.peek=nhe;function p4(e){return e.value||""}function nhe(){return"<"}m4.peek=ihe;function m4(e,t,n,i){const s=g1(n),r=s==='"'?"Quote":"Apostrophe",o=n.enter("image");let a=n.enter("label");const c=n.createTracker(i);let u=c.move("![");return u+=c.move(n.safe(e.alt,{before:u,after:"]",...c.current()})),u+=c.move("]("),a(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(a=n.enter("destinationLiteral"),u+=c.move("<"),u+=c.move(n.safe(e.url,{before:u,after:">",...c.current()})),u+=c.move(">")):(a=n.enter("destinationRaw"),u+=c.move(n.safe(e.url,{before:u,after:e.title?" ":")",...c.current()}))),a(),e.title&&(a=n.enter(`title${r}`),u+=c.move(" "+s),u+=c.move(n.safe(e.title,{before:u,after:s,...c.current()})),u+=c.move(s),a()),u+=c.move(")"),o(),u}function ihe(){return"!"}g4.peek=she;function g4(e,t,n,i){const s=e.referenceType,r=n.enter("imageReference");let o=n.enter("label");const a=n.createTracker(i);let c=a.move("![");const u=n.safe(e.alt,{before:c,after:"]",...a.current()});c+=a.move(u+"]["),o();const h=n.stack;n.stack=[],o=n.enter("reference");const f=n.safe(n.associationId(e),{before:c,after:"]",...a.current()});return o(),n.stack=h,r(),s==="full"||!u||u!==f?c+=a.move(f+"]"):s==="shortcut"?c=c.slice(0,-1):c+=a.move("]"),c}function she(){return"!"}v4.peek=rhe;function v4(e,t,n){let i=e.value||"",s="`",r=-1;for(;new RegExp("(^|[^`])"+s+"([^`]|$)").test(i);)s+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++r<n.unsafe.length;){const o=n.unsafe[r],a=n.compilePattern(o);let c;if(o.atBreak)for(;c=a.exec(i);){let u=c.index;i.charCodeAt(u)===10&&i.charCodeAt(u-1)===13&&u--,i=i.slice(0,u)+" "+i.slice(c.index+1)}}return s+i+s}function rhe(){return"`"}function y4(e,t){const n=$k(e);return!!(!t.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(n===e.url||"mailto:"+n===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}b4.peek=ohe;function b4(e,t,n,i){const s=g1(n),r=s==='"'?"Quote":"Apostrophe",o=n.createTracker(i);let a,c;if(y4(e,n)){const h=n.stack;n.stack=[],a=n.enter("autolink");let f=o.move("<");return f+=o.move(n.containerPhrasing(e,{before:f,after:">",...o.current()})),f+=o.move(">"),a(),n.stack=h,f}a=n.enter("link"),c=n.enter("label");let u=o.move("[");return u+=o.move(n.containerPhrasing(e,{before:u,after:"](",...o.current()})),u+=o.move("]("),c(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(c=n.enter("destinationLiteral"),u+=o.move("<"),u+=o.move(n.safe(e.url,{before:u,after:">",...o.current()})),u+=o.move(">")):(c=n.enter("destinationRaw"),u+=o.move(n.safe(e.url,{before:u,after:e.title?" ":")",...o.current()}))),c(),e.title&&(c=n.enter(`title${r}`),u+=o.move(" "+s),u+=o.move(n.safe(e.title,{before:u,after:s,...o.current()})),u+=o.move(s),c()),u+=o.move(")"),a(),u}function ohe(e,t,n){return y4(e,n)?"<":"["}_4.peek=ahe;function _4(e,t,n,i){const s=e.referenceType,r=n.enter("linkReference");let o=n.enter("label");const a=n.createTracker(i);let c=a.move("[");const u=n.containerPhrasing(e,{before:c,after:"]",...a.current()});c+=a.move(u+"]["),o();const h=n.stack;n.stack=[],o=n.enter("reference");const f=n.safe(n.associationId(e),{before:c,after:"]",...a.current()});return o(),n.stack=h,r(),s==="full"||!u||u!==f?c+=a.move(f+"]"):s==="shortcut"?c=c.slice(0,-1):c+=a.move("]"),c}function ahe(){return"["}function v1(e){const t=e.options.bullet||"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function lhe(e){const t=v1(e),n=e.options.bulletOther;if(!n)return t==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+n+"`) to be different");return n}function che(e){const t=e.options.bulletOrdered||".";if(t!=="."&&t!==")")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}function S4(e){const t=e.options.rule||"*";if(t!=="*"&&t!=="-"&&t!=="_")throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}function uhe(e,t,n,i){const s=n.enter("list"),r=n.bulletCurrent;let o=e.ordered?che(n):v1(n);const a=e.ordered?o==="."?")":".":lhe(n);let c=t&&n.bulletLastUsed?o===n.bulletLastUsed:!1;if(!e.ordered){const h=e.children?e.children[0]:void 0;if((o==="*"||o==="-")&&h&&(!h.children||!h.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(c=!0),S4(n)===o&&h){let f=-1;for(;++f<e.children.length;){const m=e.children[f];if(m&&m.type==="listItem"&&m.children&&m.children[0]&&m.children[0].type==="thematicBreak"){c=!0;break}}}}c&&(o=a),n.bulletCurrent=o;const u=n.containerFlow(e,i);return n.bulletLastUsed=o,n.bulletCurrent=r,s(),u}function dhe(e){const t=e.options.listItemIndent||"one";if(t!=="tab"&&t!=="one"&&t!=="mixed")throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}function hhe(e,t,n,i){const s=dhe(n);let r=n.bulletCurrent||v1(n);t&&t.type==="list"&&t.ordered&&(r=(typeof t.start=="number"&&t.start>-1?t.start:1)+(n.options.incrementListMarker===!1?0:t.children.indexOf(e))+r);let o=r.length+1;(s==="tab"||s==="mixed"&&(t&&t.type==="list"&&t.spread||e.spread))&&(o=Math.ceil(o/4)*4);const a=n.createTracker(i);a.move(r+" ".repeat(o-r.length)),a.shift(o);const c=n.enter("listItem"),u=n.indentLines(n.containerFlow(e,a.current()),h);return c(),u;function h(f,m,y){return m?(y?"":" ".repeat(o))+f:(y?r:r+" ".repeat(o-r.length))+f}}function fhe(e,t,n,i){const s=n.enter("paragraph"),r=n.enter("phrasing"),o=n.containerPhrasing(e,i);return r(),s(),o}const phe=Yk(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function mhe(e,t,n,i){return(e.children.some(function(o){return phe(o)})?n.containerPhrasing:n.containerFlow).call(n,e,i)}function ghe(e){const t=e.options.strong||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}x4.peek=vhe;function x4(e,t,n,i){const s=ghe(n),r=n.enter("strong"),o=n.createTracker(i),a=o.move(s+s);let c=o.move(n.containerPhrasing(e,{after:s,before:a,...o.current()}));const u=c.charCodeAt(0),h=Iv(i.before.charCodeAt(i.before.length-1),u,s);h.inside&&(c=Rf(u)+c.slice(1));const f=c.charCodeAt(c.length-1),m=Iv(i.after.charCodeAt(0),f,s);m.inside&&(c=c.slice(0,-1)+Rf(f));const y=o.move(s+s);return r(),n.attentionEncodeSurroundingInfo={after:m.outside,before:h.outside},a+c+y}function vhe(e,t,n){return n.options.strong||"*"}function yhe(e,t,n,i){return n.safe(e.value,i)}function bhe(e){const t=e.options.ruleRepetition||3;if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}function _he(e,t,n){const i=(S4(n)+(n.options.ruleSpaces?" ":"")).repeat(bhe(n));return n.options.ruleSpaces?i.slice(0,-1):i}const w4={blockquote:qde,break:xI,code:Yde,definition:Qde,emphasis:f4,hardBreak:xI,heading:the,html:p4,image:m4,imageReference:g4,inlineCode:v4,link:b4,linkReference:_4,list:uhe,listItem:hhe,paragraph:fhe,root:mhe,strong:x4,text:yhe,thematicBreak:_he};function She(){return{enter:{table:xhe,tableData:wI,tableHeader:wI,tableRow:Che},exit:{codeText:khe,table:whe,tableData:NS,tableHeader:NS,tableRow:NS}}}function xhe(e){const t=e._align;this.enter({type:"table",align:t.map(function(n){return n==="none"?null:n}),children:[]},e),this.data.inTable=!0}function whe(e){this.exit(e),this.data.inTable=void 0}function Che(e){this.enter({type:"tableRow",children:[]},e)}function NS(e){this.exit(e)}function wI(e){this.enter({type:"tableCell",children:[]},e)}function khe(e){let t=this.resume();this.data.inTable&&(t=t.replace(/\\([\\|])/g,The));const n=this.stack[this.stack.length-1];n.type,n.value=t,this.exit(e)}function The(e,t){return t==="|"?t:e}function Ehe(e){const t=e||{},n=t.tableCellPadding,i=t.tablePipeAlign,s=t.stringLength,r=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:m,table:o,tableCell:c,tableRow:a}};function o(y,b,S,_){return u(h(y,S,_),y.align)}function a(y,b,S,_){const w=f(y,S,_),M=u([w]);return M.slice(0,M.indexOf(`
`))}function c(y,b,S,_){const w=S.enter("tableCell"),M=S.enter("phrasing"),R=S.containerPhrasing(y,{..._,before:r,after:r});return M(),w(),R}function u(y,b){return zde(y,{align:b,alignDelimiters:i,padding:n,stringLength:s})}function h(y,b,S){const _=y.children;let w=-1;const M=[],R=b.enter("table");for(;++w<_.length;)M[w]=f(_[w],b,S);return R(),M}function f(y,b,S){const _=y.children;let w=-1;const M=[],R=b.enter("tableRow");for(;++w<_.length;)M[w]=c(_[w],y,b,S);return R(),M}function m(y,b,S){let _=w4.inlineCode(y,b,S);return S.stack.includes("tableCell")&&(_=_.replace(/\|/g,"\\$&")),_}}function Rhe(){return{exit:{taskListCheckValueChecked:CI,taskListCheckValueUnchecked:CI,paragraph:Ahe}}}function Mhe(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:Phe}}}function CI(e){const t=this.stack[this.stack.length-2];t.type,t.checked=e.type==="taskListCheckValueChecked"}function Ahe(e){const t=this.stack[this.stack.length-2];if(t&&t.type==="listItem"&&typeof t.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const i=n.children[0];if(i&&i.type==="text"){const s=t.children;let r=-1,o;for(;++r<s.length;){const a=s[r];if(a.type==="paragraph"){o=a;break}}o===n&&(i.value=i.value.slice(1),i.value.length===0?n.children.shift():n.position&&i.position&&typeof i.position.start.offset=="number"&&(i.position.start.column++,i.position.start.offset++,n.position.start=Object.assign({},i.position.start)))}}this.exit(e)}function Phe(e,t,n,i){const s=e.children[0],r=typeof e.checked=="boolean"&&s&&s.type==="paragraph",o="["+(e.checked?"x":" ")+"] ",a=n.createTracker(i);r&&a.move(o);let c=w4.listItem(e,t,n,{...i,...a.current()});return r&&(c=c.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),c;function u(h){return h+o}}function kI(e){const t=e??{},n=this.data(),i=n.micromarkExtensions??(n.micromarkExtensions=[]),s=n.fromMarkdownExtensions??(n.fromMarkdownExtensions=[]),r=n.toMarkdownExtensions??(n.toMarkdownExtensions=[]);i.push($3([ide(),dde(t),mde(),bde()])),s.push(Pde(),Dde(),She(),Rhe()),r.push({extensions:[Lde(t),Ode(),Ehe(t),Mhe()]})}function TI(){if(ky())return!1;try{return new RegExp("(?<=a)b"),!0}catch{return!1}}function y1(){const[e,t]=k.useState(()=>TI()?[]:[kI]);return k.useEffect(()=>{if(!TI())return;let n=!1;return xt(()=>import("./index-D2ian3SY.js"),[]).then(i=>{if(n)return;const s=i.default;t(s?[s]:[])}).catch(()=>{n||t([kI])}),()=>{n=!0}},[]),e}function Lhe(e){const{copied:t,copy:n}=Nv(),i=e.language&&e.language!=="unknown"?e.language:"";return g.jsxs("div",{className:"aui-md-codeheader flex items-center justify-between rounded-t-md bg-[var(--app-code-bg)] px-2 py-1",children:[g.jsx("div",{className:"min-w-0 flex-1 pr-2 text-xs font-mono text-[var(--app-hint)]",children:i}),g.jsx("button",{type:"button",onClick:()=>n(e.code),className:"shrink-0 rounded p-1 text-[var(--app-hint)] hover:bg-[var(--app-subtle-bg)] hover:text-[var(--app-fg)] transition-colors",title:"Copy",children:t?g.jsx(pv,{className:"h-3.5 w-3.5"}):g.jsx(fv,{className:"h-3.5 w-3.5"})})]})}function Nhe(e){const{className:t,...n}=e;return g.jsx("div",{className:"aui-md-pre-wrapper min-w-0 w-full max-w-full overflow-x-auto overflow-y-hidden",children:g.jsx("pre",{...n,className:Ie("aui-md-pre m-0 w-max min-w-full rounded-b-md rounded-t-none bg-[var(--app-code-bg)] p-2 text-sm",t)})})}function Ihe(e){return lF()?g.jsx("code",{...e,className:Ie("aui-md-codeblockcode font-mono",e.className)}):g.jsx("code",{...e,className:Ie("aui-md-code break-words rounded bg-[var(--app-inline-code-bg)] px-[0.3em] py-[0.1em] font-mono text-[0.9em]",e.className)})}function Dhe(e){const t=e.target==="_blank"?e.rel??"noreferrer":e.rel;return g.jsx("a",{...e,rel:t,className:Ie("aui-md-a text-[var(--app-link)] underline",e.className)})}function Ohe(e){return g.jsx("p",{...e,className:Ie("aui-md-p leading-relaxed",e.className)})}function jhe(e){return g.jsx("blockquote",{...e,className:Ie("aui-md-blockquote border-l-4 border-[var(--app-hint)] pl-3 opacity-85",e.className)})}function Bhe(e){return g.jsx("ul",{...e,className:Ie("aui-md-ul list-disc pl-6",e.className)})}function Fhe(e){return g.jsx("ol",{...e,className:Ie("aui-md-ol list-decimal pl-6",e.className)})}function Uhe(e){return g.jsx("li",{...e,className:Ie("aui-md-li",e.className)})}function zhe(e){return g.jsx("hr",{...e,className:Ie("aui-md-hr border-[var(--app-divider)]",e.className)})}function $he(e){const{className:t,...n}=e;return g.jsx("div",{className:"aui-md-table-wrapper max-w-full overflow-x-auto",children:g.jsx("table",{...n,className:Ie("aui-md-table w-full border-collapse",t)})})}function qhe(e){return g.jsx("thead",{...e,className:Ie("aui-md-thead",e.className)})}function Hhe(e){return g.jsx("tbody",{...e,className:Ie("aui-md-tbody",e.className)})}function Vhe(e){return g.jsx("tr",{...e,className:Ie("aui-md-tr",e.className)})}function Whe(e){return g.jsx("th",{...e,className:Ie("aui-md-th border border-[var(--app-border)] bg-[var(--app-subtle-bg)] px-2 py-1 text-left font-semibold",e.className)})}function Ghe(e){return g.jsx("td",{...e,className:Ie("aui-md-td border border-[var(--app-border)] px-2 py-1",e.className)})}function Khe(e){return g.jsx("h1",{...e,className:Ie("aui-md-h1 mt-3 text-base font-semibold",e.className)})}function Yhe(e){return g.jsx("h2",{...e,className:Ie("aui-md-h2 mt-3 text-base font-semibold",e.className)})}function Xhe(e){return g.jsx("h3",{...e,className:Ie("aui-md-h3 mt-2 text-base font-semibold",e.className)})}function Qhe(e){return g.jsx("h4",{...e,className:Ie("aui-md-h4 mt-2 text-base font-semibold",e.className)})}function Jhe(e){return g.jsx("h5",{...e,className:Ie("aui-md-h5 mt-2 text-base font-semibold",e.className)})}function Zhe(e){return g.jsx("h6",{...e,className:Ie("aui-md-h6 mt-2 text-base font-semibold",e.className)})}function efe(e){return g.jsx("strong",{...e,className:Ie("aui-md-strong font-semibold",e.className)})}function tfe(e){return g.jsx("em",{...e,className:Ie("aui-md-em italic",e.className)})}function nfe(e){return g.jsx("img",{...e,className:Ie("aui-md-img max-w-full rounded",e.className)})}const Dv=uoe({SyntaxHighlighter:Zue,CodeHeader:Lhe,pre:Nhe,code:Ihe,h1:Khe,h2:Yhe,h3:Xhe,h4:Qhe,h5:Jhe,h6:Zhe,a:Dhe,p:Ohe,strong:efe,em:tfe,blockquote:jhe,ul:Bhe,ol:Fhe,li:Uhe,hr:zhe,table:$he,thead:qhe,tbody:Hhe,tr:Vhe,th:Whe,td:Ghe,img:nfe});function ife(){const e=y1();return g.jsx(t1,{remarkPlugins:e,components:Dv,className:Ie("aui-md min-w-0 max-w-full break-words text-base")})}function sfe(e){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:Ie("transition-transform duration-200",e.open?"rotate-90":"",e.className),children:g.jsx("polyline",{points:"9 18 15 12 9 6"})})}function rfe(){return g.jsx("span",{className:"inline-block w-1.5 h-1.5 bg-current rounded-full animate-pulse"})}const ofe=()=>{const e=y1();return g.jsx(t1,{remarkPlugins:e,components:Dv,className:Ie("aui-reasoning-content min-w-0 max-w-full break-words text-sm text-[var(--app-hint)]")})},afe=({children:e})=>{const[t,n]=k.useState(!1),i=yZ(),s=i.status?.type==="running"&&i.content.length>0&&i.content[i.content.length-1]?.type==="reasoning";return k.useEffect(()=>{s&&n(!0)},[s]),g.jsxs("div",{className:"aui-reasoning-group my-2",children:[g.jsxs("button",{type:"button",onClick:()=>n(!t),className:Ie("flex items-center gap-1.5 text-xs font-medium","text-[var(--app-hint)] hover:text-[var(--app-fg)]","transition-colors cursor-pointer select-none"),children:[g.jsx(sfe,{open:t}),g.jsx("span",{children:"Reasoning"}),s&&g.jsx("span",{className:"flex items-center gap-1 ml-1 text-[var(--app-hint)]",children:g.jsx(rfe,{})})]}),g.jsx("div",{className:Ie("overflow-hidden transition-all duration-200 ease-in-out",t?"max-h-[5000px] opacity-100":"max-h-0 opacity-0"),children:g.jsx("div",{className:"pl-4 pt-2 border-l-2 border-[var(--app-border)] ml-0.5",children:e})})]})};function lfe(e){const t=e<1e12?e*1e3:e,n=new Date(t);return Number.isNaN(n.getTime())?String(e):n.toLocaleString()}function cfe(e){const t=e/1e3;if(t<60)return`${t.toFixed(1)}s`;const n=Math.floor(t/60),i=Math.round(t%60);return`${n}m ${i}s`}function b1(e){if(e.type==="api-error"){const{retryAttempt:t,maxRetries:n}=e;return n>0&&t>=n?{icon:"",text:"API error: Max retries reached"}:n>0?{icon:"",text:`API error: Retrying (${t}/${n})`}:t>0?{icon:"",text:"API error: Retrying..."}:{icon:"",text:"API error"}}if(e.type==="switch")return{icon:"",text:`Switched to ${e.mode==="local"?"local":"remote"}`};if(e.type==="title-changed"){const t=typeof e.title=="string"?e.title:"";return{icon:null,text:t?`Title changed to "${t}"`:"Title changed"}}if(e.type==="permission-mode-changed"){const t=e.mode;return{icon:"",text:`Permission mode: ${typeof t=="string"?t:"default"}`}}if(e.type==="limit-reached"){const t=typeof e.endsAt=="number"?e.endsAt:null;return{icon:"",text:t?`Usage limit reached until ${lfe(t)}`:"Usage limit reached"}}if(e.type==="message")return{icon:null,text:typeof e.message=="string"?e.message:"Message"};if(e.type==="turn-duration"){const t=typeof e.durationMs=="number"?e.durationMs:0;return{icon:"",text:`Turn: ${cfe(t)}`}}if(e.type==="microcompact"){const t=typeof e.tokensSaved=="number"?e.tokensSaved:0;return{icon:"",text:`Context compacted (saved ${t>=1e3?`${Math.round(t/1e3)}K`:String(t)} tokens)`}}if(e.type==="compact")return{icon:"",text:"Conversation compacted"};try{return{icon:null,text:JSON.stringify(e)}}catch{return{icon:null,text:String(e.type)}}}function ufe(e){return b1(e).text}function ds(e){const{t}=rt(),n=e.showCopyButton??!0,{copied:i,copy:s}=Nv(),r=m1(e.code,e.language);return g.jsxs("div",{className:"relative min-w-0 max-w-full",children:[n?g.jsx("button",{type:"button",onClick:()=>s(e.code),className:"absolute right-1.5 top-1.5 rounded p-1 text-[var(--app-hint)] hover:bg-[var(--app-subtle-bg)] hover:text-[var(--app-fg)] transition-colors",title:t("code.copy"),children:i?g.jsx(pv,{className:"h-3.5 w-3.5"}):g.jsx(fv,{className:"h-3.5 w-3.5"})}):null,g.jsx("div",{className:"min-w-0 w-full max-w-full overflow-x-auto overflow-y-hidden rounded-md bg-[var(--app-code-bg)]",children:g.jsx("pre",{className:"shiki m-0 w-max min-w-full p-2 pr-8 text-xs font-mono",children:g.jsx("code",{className:"block",children:r??e.code})})})]})}function dfe(e){const t=y1(),n=e.components?{...Dv,...e.components}:Dv,i=k.useMemo(()=>n,[n]);return g.jsx(BB,{text:e.content,children:g.jsx(t1,{remarkPlugins:t,components:i,className:Ie("aui-md min-w-0 max-w-full break-words text-base")})})}function za(e){return g.jsx(dfe,{...e})}const C4=["ultrathink","fuck","step by step","ELI5","lgtm","impl it","pls fix","stop changing","","","","","","","","","",""];function hfe(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ffe(e){const t=e.map(hfe).join("|");return new RegExp(`(${t})`,"gi")}function pfe(e,t){const n=e.toLowerCase();return t.some(i=>n.includes(i.toLowerCase()))}const EI=ffe(C4);function mfe({word:e,baseKey:t}){const n=e.length,i=2;return g.jsx("span",{children:e.split("").map((s,r)=>{const o=r/n*2,a=r/n*i;return g.jsx("span",{className:"rainbow-letter",style:{animationDelay:`${-o}s, ${-a}s`},children:s===" "?"":s},`${t}-${r}`)})})}function gfe(e){EI.lastIndex=0;const t=[];let n=0,i;for(;(i=EI.exec(e))!==null;)i.index>n&&t.push(e.slice(n,i.index)),t.push(g.jsx(mfe,{word:i[1],baseKey:i.index},i.index)),n=i.index+i[0].length;return n<e.length&&t.push(e.slice(n)),g.jsx(g.Fragment,{children:t})}function vfe(e){return pi.Children.map(e,t=>typeof t=="string"?gfe(t):t)}function k4(e){const t=e.text,n=k.useRef(null),[i,s]=k.useState(!1);k.useEffect(()=>{const a=n.current;if(!a)return;const c=new IntersectionObserver(([u])=>{u.isIntersecting&&s(!0)},{rootMargin:"100px"});return c.observe(a),()=>c.disconnect()},[]);const r=pfe(t,C4),o=k.useMemo(()=>({p:({children:a})=>g.jsx("p",{children:vfe(a)})}),[]);return g.jsx("div",{ref:n,children:g.jsx(za,{content:t,components:r&&i?o:void 0})})}function yfe(){return g.jsxs("svg",{className:"h-[14px] w-[14px]",viewBox:"0 0 16 16",fill:"none",children:[g.jsx("circle",{cx:"8",cy:"8",r:"6",stroke:"currentColor",strokeWidth:"1.5"}),g.jsx("path",{d:"M8 5v4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),g.jsx("circle",{cx:"8",cy:"11",r:"0.75",fill:"currentColor"})]})}function T4(e){return e.status!=="failed"?null:g.jsxs("span",{className:"inline-flex items-center gap-1",children:[g.jsx("span",{className:"text-red-500",children:g.jsx(yfe,{})}),e.onRetry?g.jsx("button",{type:"button",onClick:e.onRetry,className:"text-xs text-blue-500 hover:underline",children:"Retry"}):null]})}const _1=k.forwardRef(({className:e,...t},n)=>g.jsx("div",{ref:n,className:Ie("rounded-lg bg-[var(--app-secondary-bg)] shadow-sm",e),...t}));_1.displayName="Card";const S1=k.forwardRef(({className:e,...t},n)=>g.jsx("div",{ref:n,className:Ie("flex flex-col space-y-1.5 p-4",e),...t}));S1.displayName="CardHeader";const x1=k.forwardRef(({className:e,...t},n)=>g.jsx("h3",{ref:n,className:Ie("text-base font-semibold leading-none tracking-tight",e),...t}));x1.displayName="CardTitle";const E4=k.forwardRef(({className:e,...t},n)=>g.jsx("p",{ref:n,className:Ie("text-sm text-[var(--app-hint)]",e),...t}));E4.displayName="CardDescription";const R4=k.forwardRef(({className:e,...t},n)=>g.jsx("div",{ref:n,className:Ie("p-4 pt-0",e),...t}));R4.displayName="CardContent";class bfe{diff(t,n,i={}){let s;typeof i=="function"?(s=i,i={}):"callback"in i&&(s=i.callback);const r=this.castInput(t,i),o=this.castInput(n,i),a=this.removeEmpty(this.tokenize(r,i)),c=this.removeEmpty(this.tokenize(o,i));return this.diffWithOptionsObj(a,c,i,s)}diffWithOptionsObj(t,n,i,s){var r;const o=M=>{if(M=this.postProcess(M,i),s){setTimeout(function(){s(M)},0);return}else return M},a=n.length,c=t.length;let u=1,h=a+c;i.maxEditLength!=null&&(h=Math.min(h,i.maxEditLength));const f=(r=i.timeout)!==null&&r!==void 0?r:1/0,m=Date.now()+f,y=[{oldPos:-1,lastComponent:void 0}];let b=this.extractCommon(y[0],n,t,0,i);if(y[0].oldPos+1>=c&&b+1>=a)return o(this.buildValues(y[0].lastComponent,n,t));let S=-1/0,_=1/0;const w=()=>{for(let M=Math.max(S,-u);M<=Math.min(_,u);M+=2){let R;const E=y[M-1],A=y[M+1];E&&(y[M-1]=void 0);let T=!1;if(A){const P=A.oldPos-M;T=A&&0<=P&&P<a}const L=E&&E.oldPos+1<c;if(!T&&!L){y[M]=void 0;continue}if(!L||T&&E.oldPos<A.oldPos?R=this.addToPath(A,!0,!1,0,i):R=this.addToPath(E,!1,!0,1,i),b=this.extractCommon(R,n,t,M,i),R.oldPos+1>=c&&b+1>=a)return o(this.buildValues(R.lastComponent,n,t))||!0;y[M]=R,R.oldPos+1>=c&&(_=Math.min(_,M-1)),b+1>=a&&(S=Math.max(S,M+1))}u++};if(s)(function M(){setTimeout(function(){if(u>h||Date.now()>m)return s(void 0);w()||M()},0)})();else for(;u<=h&&Date.now()<=m;){const M=w();if(M)return M}}addToPath(t,n,i,s,r){const o=t.lastComponent;return o&&!r.oneChangePerToken&&o.added===n&&o.removed===i?{oldPos:t.oldPos+s,lastComponent:{count:o.count+1,added:n,removed:i,previousComponent:o.previousComponent}}:{oldPos:t.oldPos+s,lastComponent:{count:1,added:n,removed:i,previousComponent:o}}}extractCommon(t,n,i,s,r){const o=n.length,a=i.length;let c=t.oldPos,u=c-s,h=0;for(;u+1<o&&c+1<a&&this.equals(i[c+1],n[u+1],r);)u++,c++,h++,r.oneChangePerToken&&(t.lastComponent={count:1,previousComponent:t.lastComponent,added:!1,removed:!1});return h&&!r.oneChangePerToken&&(t.lastComponent={count:h,previousComponent:t.lastComponent,added:!1,removed:!1}),t.oldPos=c,u}equals(t,n,i){return i.comparator?i.comparator(t,n):t===n||!!i.ignoreCase&&t.toLowerCase()===n.toLowerCase()}removeEmpty(t){const n=[];for(let i=0;i<t.length;i++)t[i]&&n.push(t[i]);return n}castInput(t,n){return t}tokenize(t,n){return Array.from(t)}join(t){return t.join("")}postProcess(t,n){return t}get useLongestToken(){return!1}buildValues(t,n,i){const s=[];let r;for(;t;)s.push(t),r=t.previousComponent,delete t.previousComponent,t=r;s.reverse();const o=s.length;let a=0,c=0,u=0;for(;a<o;a++){const h=s[a];if(h.removed)h.value=this.join(i.slice(u,u+h.count)),u+=h.count;else{if(!h.added&&this.useLongestToken){let f=n.slice(c,c+h.count);f=f.map(function(m,y){const b=i[u+y];return b.length>m.length?b:m}),h.value=this.join(f)}else h.value=this.join(n.slice(c,c+h.count));c+=h.count,h.added||(u+=h.count)}}return s}}class _fe extends bfe{constructor(){super(...arguments),this.tokenize=wfe}equals(t,n,i){return i.ignoreWhitespace?((!i.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!i.newlineIsToken||!n.includes(`
`))&&(n=n.trim())):i.ignoreNewlineAtEof&&!i.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),n.endsWith(`
`)&&(n=n.slice(0,-1))),super.equals(t,n,i)}}const Sfe=new _fe;function xfe(e,t,n){return Sfe.diff(e,t,n)}function wfe(e,t){t.stripTrailingCr&&(e=e.replace(/\r\n/g,`
`));const n=[],i=e.split(/(\n|\r\n)/);i[i.length-1]||i.pop();for(let s=0;s<i.length;s++){const r=i[s];s%2&&!t.newlineIsToken?n[n.length-1]+=r:n.push(r)}return n}function M4(){const[e,t]=k.useState(!1),n=k.useCallback(r=>{t(!0)},[]),i=k.useCallback(r=>{t(!1)},[]),s=k.useCallback(r=>{t(!1)},[]);return{suppressFocusRing:e,onTriggerPointerDown:n,onTriggerKeyDown:i,onTriggerBlur:s}}function rc(e){const{t}=rt(),n=e.variant??"preview",{suppressFocusRing:i,onTriggerPointerDown:s,onTriggerKeyDown:r,onTriggerBlur:o}=M4(),a=k.useMemo(()=>{const f=e.oldString.length,m=e.newString.length,y=`${f.toLocaleString()} chars`,b=`${m.toLocaleString()} chars`;return{oldChars:f,newChars:m,label:`old: ${y}  new: ${b}`}},[e.oldString.length,e.newString.length]),c=e.filePath?e.filePath:t("diff.title"),u=e.filePath?a.label:`${t("diff.title")}  ${a.label}`,h=g.jsx(Cfe,{oldString:e.oldString,newString:e.newString,filePath:e.filePath});return n==="inline"?h:g.jsxs(ec,{children:[g.jsx(cy,{asChild:!0,children:g.jsx("button",{type:"button",className:Ie("w-full text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-link)]",i&&"focus-visible:ring-0"),onPointerDown:s,onKeyDown:r,onBlur:o,children:g.jsxs("div",{className:"overflow-hidden rounded-md border border-[var(--app-border)] bg-[var(--app-subtle-bg)] hover:bg-[var(--app-secondary-bg)] transition-colors",children:[e.filePath?g.jsx("div",{className:"border-b border-[var(--app-border)] bg-[var(--app-subtle-bg)] px-2 py-1 text-xs text-[var(--app-hint)] truncate",children:e.filePath}):null,g.jsx("div",{className:"px-2 py-2",children:g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsx("div",{className:"min-w-0 font-mono text-xs text-[var(--app-hint)] truncate",children:e.filePath?a.label:u}),g.jsx("div",{className:"shrink-0 text-xs text-[var(--app-link)]",children:t("diff.view")})]})})]})})}),g.jsxs(Va,{className:"max-w-4xl",children:[g.jsxs(tc,{children:[g.jsx(Wa,{className:"break-all",children:c}),g.jsx(Df,{className:"font-mono break-all",children:a.label})]}),g.jsx("div",{className:"mt-3 max-h-[75vh] overflow-auto",children:h})]})]})}function Cfe(e){const t=k.useMemo(()=>xfe(e.oldString,e.newString),[e.oldString,e.newString]);return g.jsxs("div",{className:"overflow-hidden rounded-md border border-[var(--app-border)] bg-[var(--app-subtle-bg)]",children:[e.filePath?g.jsx("div",{className:"border-b border-[var(--app-border)] bg-[var(--app-subtle-bg)] px-2 py-1 text-xs text-[var(--app-hint)] truncate",children:e.filePath}):null,g.jsx("div",{className:"font-mono text-xs",children:t.map((n,i)=>{const s=n.value.split(`
`);s.length>0&&s[s.length-1]===""&&s.pop();const r=n.added?"+":n.removed?"-":" ",o=Ie(n.added&&"bg-[var(--app-diff-added-bg)] text-[var(--app-diff-added-text)]",n.removed&&"bg-[var(--app-diff-removed-bg)] text-[var(--app-diff-removed-text)]");return g.jsx("div",{className:o,children:s.map((a,c)=>g.jsxs("div",{className:"whitespace-pre-wrap px-2",children:[r," ",a]},c))},i)})})]})}function Fu(e,t){if(!ye(e))return null;const n=e[t];return typeof n=="string"?n:null}function mt(e,t){for(const n of t){const i=Fu(e,n);if(i)return i}return null}function Xs(e,t){return e.length<=t?e:e.slice(0,t-3)+"..."}function kfe(e,t,n){if(!n||n.length===0)return!1;if(n.includes(e))return!0;if(e==="Bash"){const i=mt(t,["command","cmd"]);if(i)return n.includes(`Bash(${i})`)}return!1}function Tfe(e,t){return bv(e?.flavor)||t.startsWith("Codex")||t.startsWith("Gemini")||t.startsWith("OpenCode")}function Efe(e,t,n,i,s){return e.status==="pending"?s("tool.waitingForApproval"):e.status==="canceled"?e.reason?`${s("tool.canceled")}: ${e.reason}`:s("tool.canceled"):i?e.status==="approved"&&e.decision==="approved_for_session"?s("tool.approvedForSession"):e.status==="approved"?s("tool.approved"):e.status==="denied"&&e.decision==="abort"?e.reason?`${s("tool.aborted")}: ${e.reason}`:s("tool.aborted"):e.status==="denied"?e.reason?`${s("tool.deny")}: ${e.reason}`:s("tool.deny"):s("tool.allow"):e.status==="approved"?e.mode==="acceptEdits"?s("tool.approvedAllowAllEdits"):kfe(t,n,e.allowedTools)?s("tool.approvedForSession"):s("tool.approved"):e.status==="denied"?e.reason?`${s("tool.deny")}: ${e.reason}`:s("tool.deny"):s("tool.allow")}function vl(e){const t="flex w-full items-center justify-between rounded-md px-2 py-2 text-sm text-left transition-colors disabled:pointer-events-none disabled:opacity-50 hover:bg-[var(--app-subtle-bg)]",n=e.tone==="allow"?"text-emerald-600":e.tone==="deny"?"text-red-600":"text-[var(--app-link)]";return g.jsxs("button",{type:"button",className:`${t} ${n}`,disabled:e.disabled,"aria-busy":e.loading===!0,onClick:e.onClick,children:[g.jsx("span",{className:"flex-1",children:e.label}),e.loading?g.jsx("span",{className:"ml-2 shrink-0",children:g.jsx(Bo,{size:"sm",label:null,className:"text-current"})}):null]})}function Rfe(e){const{t}=rt(),{haptic:n}=Yr(),i=e.tool.permission,[s,r]=k.useState(null),[o,a]=k.useState(!1),[c,u]=k.useState(!1),[h,f]=k.useState(null),m=k.useMemo(()=>Tfe(e.metadata,e.tool.name),[e.metadata,e.tool.name]);if(!i)return null;const y=Efe(i,e.tool.name,e.tool.input,m,t),b=i.status==="pending",S=async(O,j)=>{if(!e.disabled){f(null);try{await O(),n.notification(j),e.onDone()}catch($){n.notification("error"),f($ instanceof Error?$.message:t("tool.requestFailed"))}}},_=e.tool.name,w=_==="Edit"||_==="MultiEdit"||_==="Write"||_==="NotebookEdit",R=!m&&b&&!(_==="Edit"||_==="MultiEdit"||_==="Write"||_==="NotebookEdit"||_==="exit_plan_mode"||_==="ExitPlanMode"),E=!m&&b&&w,A=async()=>{!b||s||o||c||(r("allow"),await S(()=>e.api.approvePermission(e.sessionId,i.id),"success"),r(null))},T=async()=>{!b||s||o||c||(a(!0),await S(()=>e.api.approvePermission(e.sessionId,i.id,"acceptEdits"),"success"),a(!1))},L=async()=>{if(!R||s||o||c)return;u(!0);const O=_==="Bash"?mt(e.tool.input,["command","cmd"]):null,j=_==="Bash"&&O?`Bash(${O})`:_;await S(()=>e.api.approvePermission(e.sessionId,i.id,{allowTools:[j]}),"success"),u(!1)},P=async()=>{!b||s||o||c||(r("deny"),await S(()=>e.api.denyPermission(e.sessionId,i.id),"success"),r(null))},I=async O=>{if(!(!b||s||c)){if(O==="approved_for_session"){u(!0),await S(()=>e.api.approvePermission(e.sessionId,i.id,{decision:O}),"success"),u(!1);return}r("allow"),await S(()=>e.api.approvePermission(e.sessionId,i.id,{decision:O}),"success"),r(null)}},N=async()=>{!b||s||c||(r("abort"),await S(()=>e.api.denyPermission(e.sessionId,i.id,{decision:"abort"}),"success"),r(null))};return b?g.jsxs("div",{className:"mt-2",children:[g.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:y}),h?g.jsx("div",{className:"mt-2 text-xs text-red-600",children:h}):null,g.jsx("div",{className:"mt-2 flex flex-col gap-1",children:m?g.jsxs(g.Fragment,{children:[g.jsx(vl,{label:t("tool.yes"),tone:"allow",loading:s==="allow",disabled:e.disabled||s!==null||c,onClick:()=>I("approved")}),g.jsx(vl,{label:t("tool.yesForSession"),tone:"neutral",loading:c,disabled:e.disabled||s!==null||c,onClick:()=>I("approved_for_session")}),g.jsx(vl,{label:t("tool.abortLabel"),tone:"deny",loading:s==="abort",disabled:e.disabled||s!==null||c,onClick:N})]}):g.jsxs(g.Fragment,{children:[g.jsx(vl,{label:t("tool.allow"),tone:"allow",loading:s==="allow",disabled:e.disabled||s!==null||o||c,onClick:A}),R?g.jsx(vl,{label:t("tool.allowForSession"),tone:"neutral",loading:c,disabled:e.disabled||s!==null||o||c,onClick:L}):null,E?g.jsx(vl,{label:t("tool.allowAll"),tone:"neutral",loading:o,disabled:e.disabled||s!==null||o||c,onClick:T}):null,g.jsx(vl,{label:t("tool.deny"),tone:"deny",loading:s==="deny",disabled:e.disabled||s!==null||o||c,onClick:P})]})})]}):i.status!=="denied"&&i.status!=="canceled"||!i.reason?null:g.jsx("div",{className:"mt-2 text-xs text-red-600",children:i.reason})}const Mfe=vk("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors",{variants:{variant:{default:"border-[var(--app-border)] bg-[var(--app-subtle-bg)] text-[var(--app-fg)]",warning:"border-[var(--app-badge-warning-border)] bg-[var(--app-badge-warning-bg)] text-[var(--app-badge-warning-text)]",success:"border-[var(--app-badge-success-border)] bg-[var(--app-badge-success-bg)] text-[var(--app-badge-success-text)]",destructive:"border-[var(--app-badge-error-border)] bg-[var(--app-badge-error-bg)] text-[var(--app-badge-error-text)]"}},defaultVariants:{variant:"default"}});function Ew({className:e,variant:t,...n}){return g.jsx("div",{className:Ie(Mfe({variant:t}),e),...n})}function A4(e){return e==="AskUserQuestion"||e==="ask_user_question"}function P4(e){if(!ye(e))return{questions:[]};const t=e.questions;if(!Array.isArray(t))return{questions:[]};const n=[];for(const i of t){if(!ye(i))continue;const s=typeof i.question=="string"?i.question.trim():"",r=typeof i.header=="string"?i.header.trim():"",o=typeof i.multiSelect=="boolean"?i.multiSelect:!1,a=Array.isArray(i.options)?i.options:[],c=[];for(const u of a){if(!ye(u))continue;const h=typeof u.label=="string"?u.label.trim():"";if(!h)continue;const f=typeof u.description=="string"?u.description.trim():null;c.push({label:h,description:f})}!s&&c.length===0||n.push({header:r.length>0?r:null,question:s,options:c,multiSelect:o})}return{questions:n}}function Afe(e){const t=e.mode==="multi"?e.checked?"":"":e.checked?"":"";return g.jsx("span",{className:"mt-0.5 w-4 shrink-0 text-center text-[var(--app-hint)]",children:t})}function RI(e){return g.jsxs("button",{type:"button",className:Ie("flex w-full items-start gap-2 rounded-md px-2 py-2 text-left text-sm transition-colors hover:bg-[var(--app-subtle-bg)] disabled:pointer-events-none disabled:opacity-50",e.checked?"bg-[var(--app-subtle-bg)]":null),disabled:e.disabled,onClick:e.onClick,children:[g.jsx(Afe,{checked:e.checked,mode:e.mode}),g.jsxs("span",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"font-medium text-[var(--app-fg)] break-words",children:e.title}),e.description?g.jsx("div",{className:"mt-0.5 text-xs text-[var(--app-hint)] break-words",children:e.description}):null]})]})}function Pfe(e,t,n,i){const s=[];for(const o of t){const a=e.options[o];if(!a)continue;const c=a.label.trim();c.length>0&&s.push(c)}const r=i.trim();return n&&r.length>0&&s.push(r),s}function Lfe(e){const{t}=rt(),{haptic:n}=Yr(),i=e.tool.permission,r=k.useMemo(()=>P4(e.tool.input),[e.tool.input]).questions,[o,a]=k.useState(0),[c,u]=k.useState([]),[h,f]=k.useState([]),[m,y]=k.useState([]),[b,S]=k.useState(""),[_,w]=k.useState(!1),[M,R]=k.useState(null);if(k.useEffect(()=>{a(0),u(r.map(()=>[])),f(r.map(()=>!1)),y(r.map(()=>"")),S(""),w(!1),R(null)},[e.tool.id]),!i||i.status!=="pending"||!A4(e.tool.name))return null;const E=async(H,B)=>{if(!e.disabled){R(null);try{await H(),n.notification(B),e.onDone()}catch(W){n.notification("error"),R(W instanceof Error?W.message:t("dialog.error.default"))}}},A=Math.max(1,r.length),T=Math.min(Math.max(o,0),A-1),L=r[T]?.multiSelect?"multi":"single",P=H=>{if(r.length===0){const q=b.trim();return q.length>0?[q]:null}const B=r[H];if(!B)return null;const W=Pfe(B,c[H]??[],h[H]??!1,m[H]??"");return W.length>0?W:null},I=async()=>{if(_)return;const H={};if(r.length===0){const B=P(0);if(!B){R(t("tool.selectOption"));return}H[0]=B}else for(let B=0;B<r.length;B+=1){const W=P(B);if(!W){R(t("tool.selectOption")),a(B);return}H[String(B)]=W}w(!0),await E(()=>e.api.approvePermission(e.sessionId,i.id,{answers:H}),"success"),w(!1)},N=()=>{if(r.length===0)return;if(!P(T)){R(t("tool.selectOption"));return}R(null),a(B=>Math.min(B+1,r.length-1))},O=()=>{R(null),a(H=>Math.max(H-1,0))},j=(H,B)=>{const W=r[H];W&&(n.selection(),u(q=>{const ne=q.slice(),z=new Set(ne[H]??[]);return W.multiSelect?(z.has(B)?z.delete(B):z.add(B),ne[H]=Array.from(z).sort((G,J)=>G-J),ne):(ne[H]=[B],ne)}),W.multiSelect||f(q=>{const ne=q.slice();return ne[H]=!1,ne}))},$=H=>{const B=r[H];if(B){if(n.selection(),!B.multiSelect){u(W=>{const q=W.slice();return q[H]=[],q}),f(W=>{const q=W.slice();return q[H]=!0,q});return}f(W=>{const q=W.slice();return q[H]=!q[H],q})}},V=(H,B)=>{y(W=>{const q=W.slice();return q[H]=B,q}),B.trim().length>0&&f(W=>{const q=W.slice();return q[H]=!0,q})};return g.jsxs("div",{className:"mt-3 rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] p-3",children:[g.jsx("div",{className:"flex items-start justify-between gap-3",children:g.jsx("div",{className:"min-w-0",children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(Ew,{variant:"default",children:t("tool.question")}),g.jsxs("span",{className:"font-mono text-xs text-[var(--app-hint)]",children:["[",T+1,"/",A,"]"]})]})})}),M?g.jsx("div",{className:"mt-2 text-xs text-red-600",children:M}):null,r.length===0?g.jsxs("div",{className:"mt-3",children:[g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:t("tool.askUserQuestion.fallback")}),g.jsx("textarea",{value:b,onChange:H=>S(H.target.value),disabled:e.disabled||_,placeholder:t("tool.askUserQuestion.placeholder"),className:"mt-2 w-full min-h-[88px] resize-y rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] px-3 py-2 text-sm text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent disabled:opacity-50"})]}):g.jsxs("div",{className:"mt-3",children:[g.jsx("div",{className:"flex items-start justify-between gap-3",children:g.jsxs("div",{className:"min-w-0 flex-1",children:[r[T]?.header?g.jsx("div",{className:"flex items-center gap-2",children:g.jsx(Ew,{variant:"default",children:r[T].header})}):null,r[T]?.question?g.jsx("div",{className:Ie("text-sm text-[var(--app-fg)] break-words",r[T]?.header?"mt-2":""),children:r[T].question}):null]})}),g.jsxs("div",{className:"mt-3 flex flex-col gap-1",children:[r[T].options.map((H,B)=>{const W=(c[T]??[]).includes(B);return g.jsx(RI,{checked:W,mode:L,disabled:e.disabled||_,title:H.label,description:H.description,onClick:()=>j(T,B)},B)}),g.jsx(RI,{checked:h[T]??!1,mode:L,disabled:e.disabled||_,title:t("tool.other"),description:t("tool.otherDescription"),onClick:()=>$(T)}),h[T]??!1?g.jsx("textarea",{value:m[T]??"",onChange:H=>V(T,H.target.value),disabled:e.disabled||_,placeholder:t("tool.askUserQuestion.otherPlaceholder"),className:"mt-2 w-full min-h-[88px] resize-y rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] px-3 py-2 text-sm text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent disabled:opacity-50"}):null]})]}),g.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[g.jsx("div",{className:"flex items-center gap-2",children:r.length>1?g.jsx(Xn,{type:"button",variant:"outline",size:"sm",disabled:e.disabled||_||T===0,onClick:O,children:t("tool.prev")}):null}),g.jsx("div",{className:"flex items-center gap-2",children:r.length>1&&T<r.length-1?g.jsx(Xn,{type:"button",variant:"default",size:"sm",disabled:e.disabled||_,onClick:N,children:t("tool.next")}):g.jsx(Xn,{type:"button",variant:"default",size:"sm",disabled:e.disabled||_,onClick:I,"aria-busy":_,className:"gap-2",children:_?g.jsxs(g.Fragment,{children:[g.jsx(Bo,{size:"sm",label:null,className:"text-[var(--app-button-text)]"}),t("tool.submitting")]}):t("tool.submit")})})]})]})}function L4(e){return e==="request_user_input"}function N4(e){if(!ye(e))return{questions:[]};const t=e.questions;if(!Array.isArray(t))return{questions:[]};const n=[];for(const i of t){if(!ye(i))continue;const s=typeof i.id=="string"?i.id.trim():"",r=typeof i.question=="string"?i.question.trim():"";if(!s)continue;const o=Array.isArray(i.options)?i.options:[],a=[];for(const c of o){if(!ye(c))continue;const u=typeof c.label=="string"?c.label.trim():"";if(!u)continue;const h=typeof c.description=="string"?c.description.trim():null;a.push({label:u,description:h})}n.push({id:s,question:r,options:a})}return{questions:n}}function Nfe(e){const t={};for(const[n,i]of Object.entries(e)){const s=[];i.selected&&s.push(i.selected);const r=i.userNote.trim();r.length>0&&s.push(`user_note: ${r}`),t[n]={answers:s}}return{answers:t}}function Ife(e){if(!ye(e))return null;const t=ye(e.answers)?e.answers:e,n={};for(const[i,s]of Object.entries(t)){let r=[];ye(s)&&Array.isArray(s.answers)?r=s.answers.filter(c=>typeof c=="string"):Array.isArray(s)&&(r=s.filter(c=>typeof c=="string"));let o=null,a=null;for(const c of r)c.startsWith("user_note: ")?a=c.slice(11).trim():o||(o=c.trim());n[i]={selected:o,userNote:a}}return n}function Dfe(e){const t=e.checked?"":"";return g.jsx("span",{className:"mt-0.5 w-4 shrink-0 text-center text-[var(--app-hint)]",children:t})}function Ofe(e){return g.jsxs("button",{type:"button",className:Ie("flex w-full items-start gap-2 rounded-md px-2 py-2 text-left text-sm transition-colors hover:bg-[var(--app-subtle-bg)] disabled:pointer-events-none disabled:opacity-50",e.checked?"bg-[var(--app-subtle-bg)]":null),disabled:e.disabled,onClick:e.onClick,children:[g.jsx(Dfe,{checked:e.checked}),g.jsxs("span",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"font-medium text-[var(--app-fg)] break-words",children:e.title}),e.description?g.jsx("div",{className:"mt-0.5 text-xs text-[var(--app-hint)] break-words",children:e.description}):null]})]})}function jfe(e){const{t}=rt(),{haptic:n}=Yr(),i=e.tool.permission,r=k.useMemo(()=>N4(e.tool.input),[e.tool.input]).questions,[o,a]=k.useState(0),[c,u]=k.useState({}),[h,f]=k.useState(!1),[m,y]=k.useState(null);if(k.useEffect(()=>{a(0);const N={};for(const O of r)N[O.id]={selected:null,userNote:""};u(N),f(!1),y(null)},[e.tool.id]),!i||i.status!=="pending"||!L4(e.tool.name))return null;const b=async(N,O)=>{if(!e.disabled){y(null);try{await N(),n.notification(O),e.onDone()}catch(j){n.notification("error"),y(j instanceof Error?j.message:t("dialog.error.default"))}}},S=Math.max(1,r.length),_=Math.min(Math.max(o,0),S-1),w=r[_],M=N=>{const O=c[N.id];return O?N.options.length>0&&O.selected!==null||O.userNote.trim().length>0:!1},R=async()=>{if(h)return;for(let O=0;O<r.length;O+=1){const j=r[O];if(!M(j)){y(t("tool.selectOption")),a(O);return}}const N=Nfe(c);f(!0),await b(()=>e.api.approvePermission(e.sessionId,i.id,N),"success"),f(!1)},E=()=>{if(w){if(!M(w)){y(t("tool.selectOption"));return}y(null),a(N=>Math.min(N+1,r.length-1))}},A=()=>{y(null),a(N=>Math.max(N-1,0))},T=(N,O)=>{n.selection(),u(j=>({...j,[N]:{...j[N],selected:O}}))},L=(N,O)=>{u(j=>({...j,[N]:{...j[N],userNote:O}}))},P=w?c[w.id]:null,I=w&&w.options.length===0;return g.jsxs("div",{className:"mt-3 rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] p-3",children:[g.jsx("div",{className:"flex items-start justify-between gap-3",children:g.jsx("div",{className:"min-w-0",children:g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(Ew,{variant:"default",children:t("tool.question")}),g.jsxs("span",{className:"font-mono text-xs text-[var(--app-hint)]",children:["[",_+1,"/",S,"]"]})]})})}),m?g.jsx("div",{className:"mt-2 text-xs text-red-600",children:m}):null,w?g.jsxs("div",{className:"mt-3",children:[w.question?g.jsx("div",{className:"text-sm text-[var(--app-fg)] break-words",children:w.question}):null,I?g.jsx("textarea",{value:P?.userNote??"",onChange:N=>L(w.id,N.target.value),disabled:e.disabled||h,placeholder:t("tool.requestUserInput.textPlaceholder"),className:"mt-3 w-full min-h-[88px] resize-y rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] px-3 py-2 text-sm text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent disabled:opacity-50"}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"mt-3 flex flex-col gap-1",children:w.options.map((N,O)=>{const j=P?.selected===N.label;return g.jsx(Ofe,{checked:j,disabled:e.disabled||h,title:N.label,description:N.description,onClick:()=>T(w.id,N.label)},O)})}),g.jsxs("div",{className:"mt-3",children:[g.jsx("div",{className:"text-xs text-[var(--app-hint)] mb-1",children:t("tool.requestUserInput.noteLabel")}),g.jsx("textarea",{value:P?.userNote??"",onChange:N=>L(w.id,N.target.value),disabled:e.disabled||h,placeholder:t("tool.requestUserInput.notePlaceholder"),className:"w-full min-h-[60px] resize-y rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] px-3 py-2 text-sm text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent disabled:opacity-50"})]})]})]}):null,g.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[g.jsx("div",{className:"flex items-center gap-2",children:r.length>1?g.jsx(Xn,{type:"button",variant:"outline",size:"sm",disabled:e.disabled||h||_===0,onClick:A,children:t("tool.prev")}):null}),g.jsx("div",{className:"flex items-center gap-2",children:r.length>1&&_<r.length-1?g.jsx(Xn,{type:"button",variant:"default",size:"sm",disabled:e.disabled||h,onClick:E,children:t("tool.next")}):g.jsx(Xn,{type:"button",variant:"default",size:"sm",disabled:e.disabled||h,onClick:R,"aria-busy":h,className:"gap-2",children:h?g.jsxs(g.Fragment,{children:[g.jsx(Bo,{size:"sm",label:null,className:"text-[var(--app-button-text)]"}),t("tool.submitting")]}):t("tool.submit")})})]})]})}function vr(e,t){return g.jsx("svg",{className:t.className??"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round",children:e})}function IS(e){return vr(g.jsxs(g.Fragment,{children:[g.jsx("rect",{x:"3",y:"4",width:"18",height:"16",rx:"2"}),g.jsx("path",{d:"M7 9l3 3-3 3"}),g.jsx("path",{d:"M11 15h6"})]}),e)}function MI(e){return vr(g.jsxs(g.Fragment,{children:[g.jsx("circle",{cx:"11",cy:"11",r:"6"}),g.jsx("path",{d:"M20 20l-3.5-3.5"})]}),e)}function Hm(e){return vr(g.jsxs(g.Fragment,{children:[g.jsx("path",{d:"M2.5 12s3.5-7 9.5-7 9.5 7 9.5 7-3.5 7-9.5 7-9.5-7-9.5-7z"}),g.jsx("circle",{cx:"12",cy:"12",r:"2.5"})]}),e)}function yl(e){return vr(g.jsxs(g.Fragment,{children:[g.jsx("path",{d:"M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7z"}),g.jsx("path",{d:"M14 2v5h5"}),g.jsx("path",{d:"M9 12h2"}),g.jsx("path",{d:"M9 16h6"}),g.jsx("path",{d:"M13 12h2"})]}),e)}function AI(e){return vr(g.jsxs(g.Fragment,{children:[g.jsx("circle",{cx:"12",cy:"12",r:"9"}),g.jsx("path",{d:"M3 12h18"}),g.jsx("path",{d:"M12 3a12 12 0 0 1 0 18"}),g.jsx("path",{d:"M12 3a12 12 0 0 0 0 18"})]}),e)}function PI(e){return vr(g.jsxs(g.Fragment,{children:[g.jsx("rect",{x:"8",y:"3",width:"8",height:"4",rx:"1"}),g.jsx("path",{d:"M9 7H7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2"})]}),e)}function LI(e){return vr(g.jsxs(g.Fragment,{children:[g.jsx("path",{d:"M9 18h6"}),g.jsx("path",{d:"M10 22h4"}),g.jsx("path",{d:"M8 10a4 4 0 1 1 8 0c0 1.6-.8 2.4-1.7 3.4-.6.7-1.3 1.4-1.3 2.6h-2c0-1.2-.7-1.9-1.3-2.6C8.8 12.4 8 11.6 8 10z"})]}),e)}function Bfe(e){return vr(g.jsx(g.Fragment,{children:g.jsx("path",{d:"M9 3a2 2 0 0 1 2 2v1h2V5a2 2 0 1 1 4 0v3h-3v2h1a2 2 0 1 1 0 4h-1v2h3v3H6a2 2 0 0 1-2-2v-3h3v-2H6a2 2 0 1 1 0-4h1V8H4V5a2 2 0 0 1 2-2h3z"})}),e)}function Ffe(e){return vr(g.jsxs(g.Fragment,{children:[g.jsx("path",{d:"M12 2c4 1 6 4 7 8-2 1-4 2-7 2s-5-1-7-2c1-4 3-7 7-8z"}),g.jsx("path",{d:"M9 14l-2 6 5-3"}),g.jsx("path",{d:"M15 14l2 6-5-3"}),g.jsx("circle",{cx:"12",cy:"8.5",r:"1.2"})]}),e)}function Ufe(e){return vr(g.jsx(g.Fragment,{children:g.jsx("path",{d:"M21 7a5 5 0 0 1-7 4L7 18a2 2 0 0 1-3-3l7-7a5 5 0 0 1 6-6l-3 3 4 4 3-3z"})}),e)}function Vm(e){return vr(g.jsxs(g.Fragment,{children:[g.jsx("circle",{cx:"12",cy:"12",r:"9"}),g.jsx("path",{d:"M9.5 9a2.5 2.5 0 1 1 4.1 1.9c-.9.7-1.6 1.3-1.6 2.6"}),g.jsx("path",{d:"M12 17h.01"})]}),e)}function Ys(e,t){if(!t?.path)return e;const n=t.path,i=e.toLowerCase(),s=n.toLowerCase();if(!i.startsWith(s))return e;const r=e.slice(n.length);if(r!==""&&!r.startsWith("/")&&!r.startsWith("\\"))return e;let o=r;return(o.startsWith("/")||o.startsWith("\\"))&&(o=o.slice(1)),o.length===0?"<root>":o}function w1(e){const n=e.replace(/\\/g,"/").split("/").filter(Boolean);return n.length>0?n[n.length-1]:e}const Ot="h-3.5 w-3.5";function NI(e){return e.split(`
`).length}function DS(e){return e.split("_").filter(t=>t.length>0).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" ")}function zfe(e){const t=e.replace(/^mcp__/,""),n=t.split("__");if(n.length>=2){const i=DS(n[0]),s=DS(n.slice(1).join("_"));return`MCP: ${i} ${s}`}return`MCP: ${DS(t)}`}const $fe={Task:{icon:()=>g.jsx(Ffe,{className:Ot}),title:e=>mt(e.input,["description"])??"Task",subtitle:e=>{const t=mt(e.input,["prompt"]);return t?Xs(t,120):null},minimal:e=>e.childrenCount===0},Bash:{icon:()=>g.jsx(IS,{className:Ot}),title:e=>e.description??"Terminal",subtitle:e=>mt(e.input,["command","cmd"]),minimal:!0},Glob:{icon:()=>g.jsx(MI,{className:Ot}),title:e=>mt(e.input,["pattern"])??"Search files",minimal:!0},Grep:{icon:()=>g.jsx(Hm,{className:Ot}),title:e=>{const t=mt(e.input,["pattern"]);return t?`grep(pattern: ${t})`:"Search content"},minimal:!0},LS:{icon:()=>g.jsx(MI,{className:Ot}),title:e=>{const t=mt(e.input,["path"]);return t?Ys(t,e.metadata):"List files"},minimal:!0},CodexBash:{icon:e=>{if(ye(e.input)&&Array.isArray(e.input.parsed_cmd)&&e.input.parsed_cmd.length>0){const t=e.input.parsed_cmd[0],n=ye(t)?t.type:null;if(n==="read")return g.jsx(Hm,{className:Ot});if(n==="write")return g.jsx(yl,{className:Ot})}return g.jsx(IS,{className:Ot})},title:e=>{if(ye(e.input)&&Array.isArray(e.input.parsed_cmd)&&e.input.parsed_cmd.length===1){const t=e.input.parsed_cmd[0];if(ye(t)&&t.type==="read"&&typeof t.name=="string")return Ys(t.name,e.metadata)}return e.description??"Terminal"},subtitle:e=>{const t=mt(e.input,["command","cmd"]);return t||(ye(e.input)&&Array.isArray(e.input.command)?e.input.command.filter(n=>typeof n=="string").join(" "):null)},minimal:!0},CodexPermission:{icon:()=>g.jsx(Vm,{className:Ot}),title:e=>{const t=mt(e.input,["tool"]);return t?`Permission: ${t}`:"Permission request"},subtitle:e=>mt(e.input,["message","command"])??null,minimal:!0},shell_command:{icon:()=>g.jsx(IS,{className:Ot}),title:e=>e.description??"Terminal",subtitle:e=>mt(e.input,["command","cmd"]),minimal:!0},Read:{icon:()=>g.jsx(Hm,{className:Ot}),title:e=>{const t=mt(e.input,["file_path","path","file"]);return t?Ys(t,e.metadata):"Read file"},minimal:!0},Edit:{icon:()=>g.jsx(yl,{className:Ot}),title:e=>{const t=mt(e.input,["file_path","path"]);return t?Ys(t,e.metadata):"Edit file"},minimal:!0},MultiEdit:{icon:()=>g.jsx(yl,{className:Ot}),title:e=>{const t=mt(e.input,["file_path","path"]);if(!t)return"Edit file";const n=ye(e.input)&&Array.isArray(e.input.edits)?e.input.edits:null,i=n?n.length:0,s=Ys(t,e.metadata);return i>1?`${s} (${i} edits)`:s},minimal:!0},Write:{icon:()=>g.jsx(yl,{className:Ot}),title:e=>{const t=mt(e.input,["file_path","path"]);return t?Ys(t,e.metadata):"Write file"},subtitle:e=>{const t=mt(e.input,["content","text"]);if(!t)return null;const n=NI(t);return n>1?`${n} lines`:`${t.length} chars`},minimal:!0},WebFetch:{icon:()=>g.jsx(AI,{className:Ot}),title:e=>{const t=mt(e.input,["url"]);if(!t)return"Web fetch";try{return new URL(t).hostname}catch{return t}},subtitle:e=>{const t=mt(e.input,["url"]);return t||null},minimal:!0},WebSearch:{icon:()=>g.jsx(AI,{className:Ot}),title:e=>mt(e.input,["query"])??"Web search",subtitle:e=>{const t=mt(e.input,["query"]);return t?Xs(t,80):null},minimal:!0},NotebookRead:{icon:()=>g.jsx(Hm,{className:Ot}),title:e=>{const t=mt(e.input,["notebook_path"]);return t?Ys(t,e.metadata):"Read notebook"},minimal:!0},NotebookEdit:{icon:()=>g.jsx(yl,{className:Ot}),title:e=>{const t=mt(e.input,["notebook_path"]);return t?Ys(t,e.metadata):"Edit notebook"},subtitle:e=>{const t=mt(e.input,["edit_mode"]);return t?`mode: ${t}`:null},minimal:!1},TodoWrite:{icon:()=>g.jsx(LI,{className:Ot}),title:()=>"Todo list",subtitle:e=>{const t=ye(e.input)&&Array.isArray(e.input.todos)?e.input.todos:null;if(t&&t.length>0)return`${t.length} items`;const n=ye(e.result)&&Array.isArray(e.result.newTodos)?e.result.newTodos:null;return n&&n.length>0?`${n.length} items`:null},minimal:e=>{const t=ye(e.input)&&Array.isArray(e.input.todos)?e.input.todos:null;if(t&&t.length>0)return!1;const n=ye(e.result)&&Array.isArray(e.result.newTodos)?e.result.newTodos:null;return!(n&&n.length>0)}},CodexReasoning:{icon:()=>g.jsx(LI,{className:Ot}),title:e=>mt(e.input,["title"])??"Reasoning",minimal:!0},CodexPatch:{icon:()=>g.jsx(yl,{className:Ot}),title:()=>"Apply changes",subtitle:e=>{if(ye(e.input)&&ye(e.input.changes)){const t=Object.keys(e.input.changes);if(t.length===0)return null;const n=t[0],i=Ys(n,e.metadata),s=w1(i);return t.length>1?`${s} (+${t.length-1})`:s}return null},minimal:!0},CodexDiff:{icon:()=>g.jsx(yl,{className:Ot}),title:()=>"Diff",subtitle:e=>{const t=mt(e.input,["unified_diff"]);if(!t)return null;const n=t.split(`
`);for(const i of n)if(i.startsWith("+++ b/")||i.startsWith("+++ ")){const s=i.replace(/^\+\+\+ (b\/)?/,"");return s.split("/").pop()??s}return null},minimal:e=>{const t=mt(e.input,["unified_diff"]);return t?t.length>=2e3||NI(t)>=50:!0}},ExitPlanMode:{icon:()=>g.jsx(PI,{className:Ot}),title:()=>"Plan proposal",minimal:!1},exit_plan_mode:{icon:()=>g.jsx(PI,{className:Ot}),title:()=>"Plan proposal",minimal:!1},AskUserQuestion:{icon:()=>g.jsx(Vm,{className:Ot}),title:e=>{const t=ye(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=ye(i)&&typeof i.header=="string"?i.header.trim():"";return n>1?`${n} Questions`:s.length>0?s:"Question"},subtitle:e=>{const t=ye(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=ye(i)&&typeof i.question=="string"?i.question.trim():"";return n>1&&s.length>0?Xs(s,100)+` (+${n-1} more)`:s.length>0?Xs(s,120):null},minimal:!0},ask_user_question:{icon:()=>g.jsx(Vm,{className:Ot}),title:e=>{const t=ye(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=ye(i)&&typeof i.header=="string"?i.header.trim():"";return n>1?`${n} Questions`:s.length>0?s:"Question"},subtitle:e=>{const t=ye(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=ye(i)&&typeof i.question=="string"?i.question.trim():"";return n>1&&s.length>0?Xs(s,100)+` (+${n-1} more)`:s.length>0?Xs(s,120):null},minimal:!0},request_user_input:{icon:()=>g.jsx(Vm,{className:Ot}),title:e=>{const t=ye(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=ye(i)&&typeof i.id=="string"?i.id.trim():"";return n>1?`${n} Questions`:s.length>0?s:"Question"},subtitle:e=>{const t=ye(e.input)&&Array.isArray(e.input.questions)?e.input.questions:[],n=t.length,i=t[0]??null,s=ye(i)&&typeof i.question=="string"?i.question.trim():"";return n>1&&s.length>0?Xs(s,100)+` (+${n-1} more)`:s.length>0?Xs(s,120):null},minimal:!0}};function I4(e){if(e.toolName.startsWith("mcp__"))return{icon:g.jsx(Bfe,{className:Ot}),title:zfe(e.toolName),subtitle:null,minimal:!0};const t=$fe[e.toolName];if(t){const c=typeof t.minimal=="function"?t.minimal(e):t.minimal??!1;return{icon:t.icon(e),title:t.title(e),subtitle:t.subtitle?t.subtitle(e):null,minimal:c}}const n=mt(e.input,["file_path","path","filePath","file"]),i=mt(e.input,["command","cmd"]),s=mt(e.input,["pattern"]),r=mt(e.input,["url"]),o=mt(e.input,["query"]),a=n??i??s??r??o;return{icon:g.jsx(Ufe,{className:Ot}),title:e.toolName,subtitle:a?Xs(a,80):null,minimal:!0}}function qfe(e){const t=e.split(`
`),n=[],i=[];let s,r=!1;for(const o of t){if(o.startsWith("+++ b/")||o.startsWith("+++ ")){s=o.replace(/^\+\+\+ (b\/)?/,"");continue}if(!(o.startsWith("diff --git")||o.startsWith("index ")||o.startsWith("---")||o.startsWith("new file mode")||o.startsWith("deleted file mode"))){if(o.startsWith("@@")){r=!0;continue}if(r)if(o.startsWith("+"))i.push(o.substring(1));else if(o.startsWith("-"))n.push(o.substring(1));else if(o.startsWith(" "))n.push(o.substring(1)),i.push(o.substring(1));else{if(o==="\\ No newline at end of file")continue;o===""&&(n.push(""),i.push(""))}}}return{oldText:n.join(`
`),newText:i.join(`
`),fileName:s}}function D4(e,t){const n=e.tool.input;if(!ye(n)||typeof n.unified_diff!="string")return null;const i=qfe(n.unified_diff);return g.jsx(rc,{oldString:i.oldText,newString:i.newText,filePath:t?i.fileName:void 0,variant:t?"inline":void 0})}function Hfe(e){return D4(e.block,!1)}function Vfe(e){return D4(e.block,!0)}function Wfe(e){const t=e.block.tool.input;if(!ye(t)||!ye(t.changes))return null;const n=Object.keys(t.changes);return n.length===0?null:g.jsx("div",{className:"flex flex-col gap-1",children:n.map(i=>{const s=Ys(i,e.metadata);return g.jsx("div",{className:"text-sm text-[var(--app-fg)] font-mono break-all",children:w1(s)},i)})})}function O4(e){const t=e.block.tool.input;if(!ye(t))return null;const n=typeof t.old_string=="string"?t.old_string:null,i=typeof t.new_string=="string"?t.new_string:null;return n===null||i===null?null:g.jsx(rc,{oldString:n,newString:i,variant:"inline"})}function Gfe(e){if(!e)return;const t={};for(const[n,i]of Object.entries(e))Array.isArray(i)?t[n]=i:i&&typeof i=="object"&&"answers"in i&&(t[n]=i.answers);return t}function Kfe(e,t,n){if(!e)return!1;const i=e[String(t)];return!i||!Array.isArray(i)?!1:i.some(s=>s.trim()===n.trim())}function Yfe(e,t){return e?t?"":"":t?"":""}function Xfe(e,t,n,i){const s=e[String(t)];if(!s||!Array.isArray(s))return null;const r=new Set(n.map(a=>a.label.trim())),o=s.filter(a=>!r.has(a.trim()));return o.length===0?null:g.jsx(g.Fragment,{children:o.map((a,c)=>g.jsx("div",{className:"rounded-md border border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30 px-2 py-2",children:g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx("span",{className:"shrink-0 text-sm text-emerald-600",children:i?"":""}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"text-sm text-emerald-700 dark:text-emerald-300 font-medium break-words",children:a}),g.jsx("div",{className:"mt-0.5 text-xs text-[var(--app-hint)]",children:"(custom answer)"})]})]})},`other-${c}`))})}function II(e,t){const n=e[String(t)];if(!n||!Array.isArray(n))return null;const i=n.map(s=>s.trim()).filter(s=>s.length>0);return i.length===0?null:g.jsx("div",{className:"mt-3 flex flex-col gap-1",children:i.map((s,r)=>g.jsx("div",{className:"rounded-md border border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30 px-2 py-2",children:g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx("span",{className:"shrink-0 text-sm text-emerald-600",children:""}),g.jsx("div",{className:"min-w-0 flex-1",children:g.jsx("div",{className:"text-sm text-emerald-700 dark:text-emerald-300 font-medium break-words",children:s})})]})},r))})}function Ov(e){const n=P4(e.block.tool.input).questions,i=e.block.tool.permission?.answers??void 0,s=Gfe(i),r=s&&Object.keys(s).length>0;return n.length===0?r&&s?II(s,0):null:g.jsx("div",{className:"flex flex-col gap-3",children:n.map((o,a)=>{const c=o.multiSelect;return g.jsxs("div",{className:"rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] p-3",children:[o.question?g.jsx("div",{className:"text-sm text-[var(--app-fg)] break-words",children:o.question}):null,o.options.length>0?g.jsxs("div",{className:"mt-3 flex flex-col gap-1",children:[o.options.map((u,h)=>{const f=Kfe(s,a,u.label);return g.jsx("div",{className:Ie("rounded-md border px-2 py-2",f?"border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30":"border-[var(--app-border)]"),children:g.jsxs("div",{className:"flex items-start gap-2",children:[r&&g.jsx("span",{className:Ie("shrink-0 text-sm",f?"text-emerald-600":"text-[var(--app-hint)]"),children:Yfe(c,f)}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:Ie("text-sm break-words",f?"text-emerald-700 dark:text-emerald-300 font-medium":"text-[var(--app-fg)]"),children:u.label}),u.description?g.jsx("div",{className:"mt-0.5 text-xs text-[var(--app-hint)] break-words",children:u.description}):null]})]})},h)}),r&&Xfe(s,a,o.options,c)]}):r&&s?II(s,a):null]},a)})})}function Qfe(e){return e?"":""}function Jfe(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return}return e}function j4(e){const n=N4(e.block.tool.input).questions,i=e.block.tool.permission?.answers??Jfe(e.block.tool.result)??void 0,s=i?Ife(i):null,r=s&&Object.keys(s).length>0;return n.length===0?null:g.jsx("div",{className:"flex flex-col gap-3",children:n.map(o=>{const a=s?.[o.id],c=o.options.length===0;return g.jsxs("div",{className:"rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] p-3",children:[o.question?g.jsx("div",{className:"text-sm text-[var(--app-fg)] break-words",children:o.question}):null,c?r&&a?.userNote?g.jsx("div",{className:"mt-3",children:g.jsx("div",{className:"rounded-md border border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30 px-2 py-2",children:g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx("span",{className:"shrink-0 text-sm text-emerald-600",children:""}),g.jsx("div",{className:"min-w-0 flex-1",children:g.jsx("div",{className:"text-sm text-emerald-700 dark:text-emerald-300 font-medium break-words",children:a.userNote})})]})})}):null:g.jsxs("div",{className:"mt-3 flex flex-col gap-1",children:[o.options.map((u,h)=>{const f=a?.selected===u.label;return g.jsx("div",{className:Ie("rounded-md border px-2 py-2",f?"border-emerald-500 bg-emerald-50 dark:bg-emerald-950/30":"border-[var(--app-border)]"),children:g.jsxs("div",{className:"flex items-start gap-2",children:[r&&g.jsx("span",{className:Ie("shrink-0 text-sm",f?"text-emerald-600":"text-[var(--app-hint)]"),children:Qfe(f)}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:Ie("text-sm break-words",f?"text-emerald-700 dark:text-emerald-300 font-medium":"text-[var(--app-fg)]"),children:u.label}),u.description?g.jsx("div",{className:"mt-0.5 text-xs text-[var(--app-hint)] break-words",children:u.description}):null]})]})},h)}),r&&a?.userNote?g.jsx("div",{className:"mt-2 rounded-md border border-blue-300 bg-blue-50 dark:bg-blue-950/30 px-2 py-2",children:g.jsxs("div",{className:"flex items-start gap-2",children:[g.jsx("span",{className:"shrink-0 text-xs text-blue-500",children:""}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:"Note:"}),g.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300 break-words",children:a.userNote})]})]})}):null]})]},o.id)})})}function jv(e){const t=e.block.tool.input;if(!ye(t))return null;const n=typeof t.plan=="string"?t.plan:null;return n?g.jsx(za,{content:n}):null}const OS=3;function B4(e){return!ye(e)||!Array.isArray(e.edits)?[]:e.edits.filter(ye).map(t=>({old_string:typeof t.old_string=="string"?t.old_string:"",new_string:typeof t.new_string=="string"?t.new_string:""})).filter(t=>t.old_string.length>0||t.new_string.length>0)}function Zfe(e){const t=B4(e.block.tool.input);return t.length===0?null:g.jsxs("div",{className:"flex flex-col gap-2",children:[t.slice(0,OS).map((n,i)=>g.jsx(rc,{oldString:n.old_string,newString:n.new_string},i)),t.length>OS?g.jsxs("div",{className:"text-xs text-[var(--app-hint)]",children:["(+",t.length-OS," more edits)"]}):null]})}function epe(e){const t=B4(e.block.tool.input);return t.length===0?null:g.jsx("div",{className:"flex flex-col gap-2",children:t.map((n,i)=>g.jsx(rc,{oldString:n.old_string,newString:n.new_string,variant:"inline"},i))})}function tpe(e,t){const n=ye(e)&&Array.isArray(e.todos)?e.todos.filter(ye):[];return n.length>0?n.map(s=>({id:typeof s.id=="string"?s.id:void 0,content:typeof s.content=="string"?s.content:void 0,status:s.status==="pending"||s.status==="in_progress"||s.status==="completed"?s.status:void 0,priority:s.priority==="high"||s.priority==="medium"||s.priority==="low"?s.priority:void 0})):(ye(t)&&Array.isArray(t.newTodos)?t.newTodos.filter(ye):[]).map(s=>({id:typeof s.id=="string"?s.id:void 0,content:typeof s.content=="string"?s.content:void 0,status:s.status==="pending"||s.status==="in_progress"||s.status==="completed"?s.status:void 0,priority:s.priority==="high"||s.priority==="medium"||s.priority==="low"?s.priority:void 0}))}function npe(e){return e.status==="completed"?"text-emerald-600 line-through":e.status==="in_progress"?"text-[var(--app-link)]":"text-[var(--app-hint)]"}function ipe(e){return e.status==="completed"?"":""}function spe(e){const t=tpe(e.block.tool.input,e.block.tool.result);return t.length===0?null:g.jsx("div",{className:"flex flex-col gap-1",children:t.map((n,i)=>{const s=n.content?.trim()?n.content.trim():"(empty)";return g.jsxs("div",{className:`text-sm ${npe(n)}`,children:[ipe(n)," ",s]},n.id??String(i))})})}function F4(e){const t=e.block.tool.input;if(!ye(t))return null;const n=typeof t.content=="string"?t.content:typeof t.text=="string"?t.text:null;return n===null?null:g.jsx(rc,{oldString:"",newString:n,variant:"inline"})}const rpe={Edit:O4,MultiEdit:Zfe,Write:F4,TodoWrite:spe,CodexDiff:Hfe,AskUserQuestion:Ov,ExitPlanMode:jv,ask_user_question:Ov,exit_plan_mode:jv,request_user_input:j4},ope={Edit:O4,MultiEdit:epe,Write:F4,CodexDiff:Vfe,CodexPatch:Wfe,AskUserQuestion:Ov,ExitPlanMode:jv,ask_user_question:Ov,exit_plan_mode:jv,request_user_input:j4};function ape(e){return rpe[e]??null}function lpe(e){return ope[e]??null}function U4(e){const t=/<tool_use_error>(.*?)<\/tool_use_error>/s,n=e.match(t);return n?{isToolUseError:!0,errorMessage:typeof n[1]=="string"?n[1].trim():""}:{isToolUseError:!1,errorMessage:null}}function DI(e){return typeof e=="string"?e:ye(e)&&(e.type==="text"&&typeof e.text=="string"||typeof e.text=="string")?e.text:null}function hr(e,t=0){if(t>2||e==null)return null;if(typeof e=="string"){const a=U4(e);return a.isToolUseError?a.errorMessage??"":e}if(Array.isArray(e)){const a=e.map(DI).filter(c=>typeof c=="string"&&c.length>0);return a.length>0?a.join(`
`):null}if(!ye(e))return null;if(typeof e.content=="string")return e.content;if(typeof e.text=="string")return e.text;if(typeof e.output=="string")return e.output;if(typeof e.error=="string")return e.error;if(typeof e.message=="string")return e.message;const n=Array.isArray(e.content)?e.content:null;if(n){const a=n.map(DI).filter(c=>typeof c=="string"&&c.length>0);return a.length>0?a.join(`
`):null}const i=ye(e.output)?e.output:null;if(i){if(typeof i.content=="string")return i.content;if(typeof i.text=="string")return i.text}const s=ye(e.error)?e.error:null;if(s){if(typeof s.message=="string")return s.message;if(typeof s.error=="string")return s.error}const r=ye(e.result)?e.result:null;if(r){const a=hr(r,t+1);if(a)return a}const o=ye(e.data)?e.data:null;if(o){const a=hr(o,t+1);if(a)return a}return null}function cpe(e){const t=e.match(/^Exit code:\s*(\d+)/m),n=e.match(/^Wall time:\s*(.+)$/m),i=e.match(/^Output:\n([\s\S]*)$/m);return!t&&!n&&!i?null:{exitCode:t?parseInt(t[1],10):null,wallTime:n?n[1].trim():null,output:i?i[1]:e}}function upe(e){const t=e.trimStart();return t.startsWith("<!DOCTYPE")||t.startsWith("<html")||t.startsWith("<div")||t.startsWith("<span")}function OI(e){const t=e.trim();return t.startsWith("{")&&t.endsWith("}")||t.startsWith("[")&&t.endsWith("]")}function Or(e,t={mode:"auto"}){return t.mode==="code"?g.jsx(ds,{code:e,language:t.language??"text"}):t.mode==="markdown"?g.jsx(za,{content:e}):upe(e)||OI(e)?g.jsx(ds,{code:e,language:OI(e)?"json":"html"}):g.jsx(za,{content:e})}function Qr(e){return e==="pending"?"Waiting for permission":e==="running"?"Running":"(no output)"}function nn(e){return null}function dpe(e){if(!ye(e))return null;const t=typeof e.stdout=="string"?e.stdout:null,n=typeof e.stderr=="string"?e.stderr:null;if(t!==null||n!==null)return{stdout:t,stderr:n};const i=ye(e.output)?e.output:null;if(i){const s=typeof i.stdout=="string"?i.stdout:null,r=typeof i.stderr=="string"?i.stderr:null;if(s!==null||r!==null)return{stdout:s,stderr:r}}return null}function hpe(e){if(!ye(e))return null;const t=ye(e.file)?e.file:null;if(!t)return null;const n=typeof t.content=="string"?t.content:null;return n===null?null:{filePath:typeof t.filePath=="string"?t.filePath:typeof t.file_path=="string"?t.file_path:null,content:n}}function fpe(e){return e.split(`
`).map(t=>t.trim()).filter(t=>t.length>0)}function ppe(e){const t=e.trimStart();return t.startsWith("- ")||t.startsWith("* ")||t.startsWith("1. ")}const jI=e=>{const t=e.block.tool.permission?.answers??null;return t&&Object.keys(t).length>0?null:g.jsx(uu,{...e})},mpe=e=>{const t=e.block.tool.result;if(t==null)return g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:Qr(e.block.tool.state)});if(typeof t=="string"){const s=U4(t),r=s.isToolUseError?s.errorMessage??"":t;return g.jsxs(g.Fragment,{children:[g.jsx(ds,{code:r,language:"text"}),g.jsx(nn,{value:t})]})}const n=dpe(t);if(n)return g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"flex flex-col gap-2",children:[n.stdout?g.jsx(ds,{code:n.stdout,language:"text"}):null,n.stderr?g.jsx(ds,{code:n.stderr,language:"text"}):null]}),g.jsx(nn,{value:t})]});const i=hr(t);return i?g.jsxs(g.Fragment,{children:[Or(i,{mode:"code",language:"text"}),g.jsx(nn,{value:t})]}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),g.jsx(nn,{value:t})]})},uu=e=>{const t=e.block.tool.result;if(t==null)return g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:Qr(e.block.tool.state)});const n=hr(t);return n?g.jsxs(g.Fragment,{children:[Or(n,{mode:"auto"}),g.jsx(nn,{value:t})]}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),g.jsx(nn,{value:t})]})},jS=e=>{const t=e.block.tool.result;if(t==null)return g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:Qr(e.block.tool.state)});const n=hr(t);if(!n)return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),g.jsx(nn,{value:t})]});if(ppe(n))return g.jsxs(g.Fragment,{children:[g.jsx(za,{content:n}),g.jsx(nn,{value:t})]});const i=fpe(n);return i.length===0?g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),g.jsx(nn,{value:t})]}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"flex flex-col gap-1",children:i.map(s=>g.jsx("div",{className:"text-sm font-mono text-[var(--app-fg)] break-all",children:s},s))}),g.jsx(nn,{value:t})]})},BI=e=>{const t=e.block.tool.result;if(t==null)return g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:Qr(e.block.tool.state)});const n=hpe(t);if(n){const s=n.filePath?Ys(n.filePath,e.metadata):null;return g.jsxs(g.Fragment,{children:[s?g.jsx("div",{className:"mb-2 text-xs text-[var(--app-hint)] font-mono break-all",children:w1(s)}):null,g.jsx(ds,{code:n.content,language:"text"}),g.jsx(nn,{value:t})]})}const i=hr(t);return i?g.jsxs(g.Fragment,{children:[Or(i,{mode:"code",language:"text"}),g.jsx(nn,{value:t})]}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),g.jsx(nn,{value:t})]})},Wm=e=>{const{state:t,result:n}=e.block.tool;if(n==null)return t==="completed"?g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"Done"}):g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:Qr(t)});const i=hr(n);if(typeof i=="string"&&i.trim().length>0){const s=t==="error"?"text-red-600":"text-[var(--app-fg)]";return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:`text-sm ${s}`,children:Or(i,{mode:t==="error"?"code":"auto"})}),g.jsx(nn,{value:n})]})}return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:t==="completed"?"Done":"(no output)"}),g.jsx(nn,{value:n})]})},gpe=e=>{const t=e.block.tool.result,n=hr(t);return n?g.jsxs(g.Fragment,{children:[Or(n,{mode:"auto"}),g.jsx(nn,{value:t})]}):t==null?e.block.tool.state==="completed"?g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"Done"}):g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:Qr(e.block.tool.state)}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),g.jsx(nn,{value:t})]})},vpe=e=>{const t=e.block.tool.result;if(t==null)return g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:Qr(e.block.tool.state)});const n=hr(t);return n?g.jsxs(g.Fragment,{children:[Or(n,{mode:"auto"}),g.jsx(nn,{value:t})]}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"(no output)"}),g.jsx(nn,{value:t})]})},ype=e=>{const t=e.block.tool.result;if(t==null)return e.block.tool.state==="completed"?g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"Done"}):g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:Qr(e.block.tool.state)});const n=hr(t);return n?g.jsxs(g.Fragment,{children:[Or(n,{mode:"code",language:"diff"}),g.jsx(nn,{value:t})]}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"Done"}),g.jsx(nn,{value:t})]})};function bpe(e,t){const n=ye(e)&&Array.isArray(e.todos)?e.todos.filter(ye):[];return n.length>0?n.map(s=>({id:typeof s.id=="string"?s.id:void 0,content:typeof s.content=="string"?s.content:void 0,status:s.status==="pending"||s.status==="in_progress"||s.status==="completed"?s.status:void 0,priority:s.priority==="high"||s.priority==="medium"||s.priority==="low"?s.priority:void 0})):(ye(t)&&Array.isArray(t.newTodos)?t.newTodos.filter(ye):[]).map(s=>({id:typeof s.id=="string"?s.id:void 0,content:typeof s.content=="string"?s.content:void 0,status:s.status==="pending"||s.status==="in_progress"||s.status==="completed"?s.status:void 0,priority:s.priority==="high"||s.priority==="medium"||s.priority==="low"?s.priority:void 0}))}function _pe(e){return e.status==="completed"?"text-emerald-600 line-through":e.status==="in_progress"?"text-[var(--app-link)]":"text-[var(--app-hint)]"}function Spe(e){return e.status==="completed"?"":""}const xpe=e=>{const t=bpe(e.block.tool.input,e.block.tool.result);return t.length===0?g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:Qr(e.block.tool.state)}):g.jsx("div",{className:"flex flex-col gap-1",children:t.map((n,i)=>{const s=n.content?.trim()?n.content.trim():"(empty)";return g.jsxs("div",{className:`text-sm ${_pe(n)}`,children:[Spe(n)," ",s]},n.id??String(i))})})},FI=e=>{const t=e.block.tool.result;if(t==null)return g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:Qr(e.block.tool.state)});if(typeof t=="string"){const i=cpe(t);if(i)return g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"text-xs text-[var(--app-hint)] mb-2",children:[i.exitCode!==null&&`Exit code: ${i.exitCode}`,i.exitCode!==null&&i.wallTime&&"  ",i.wallTime&&`Wall time: ${i.wallTime}`]}),Or(i.output.trim(),{mode:"code"}),g.jsx(nn,{value:t})]})}const n=hr(t);return n?g.jsxs(g.Fragment,{children:[Or(n,{mode:"auto"}),typeof t=="object"?g.jsx(nn,{value:t}):null]}):typeof t=="string"?Or(t,{mode:"auto"}):g.jsx(ds,{code:Ea(t),language:"json"})},wpe={Task:uu,Bash:mpe,Glob:jS,Grep:jS,LS:jS,Read:BI,Edit:Wm,MultiEdit:Wm,Write:Wm,WebFetch:uu,WebSearch:uu,NotebookRead:BI,NotebookEdit:Wm,TodoWrite:xpe,CodexReasoning:vpe,CodexPatch:gpe,CodexDiff:ype,AskUserQuestion:jI,ExitPlanMode:uu,ask_user_question:jI,exit_plan_mode:uu};function Cpe(e){return e.startsWith("mcp__")?FI:wpe[e]??FI}const kpe=1e3;function Tpe(e){const[t,n]=k.useState(()=>Date.now());if(k.useEffect(()=>{if(!e.active)return;const s=setInterval(()=>n(Date.now()),kpe);return()=>clearInterval(s)},[e.active]),!e.active)return null;const i=(t-e.from)/1e3;return Number.isFinite(i)?g.jsxs("span",{className:"font-mono text-xs text-[var(--app-hint)]",children:[i.toFixed(1),"s"]}):null}function Epe(e,t){const n=I4({toolName:e.tool.name,input:e.tool.input,result:e.tool.result,childrenCount:e.children.length,description:e.tool.description,metadata:t});return n.subtitle?Xs(`${n.title}: ${n.subtitle}`,140):n.title}function Rpe(e){return e.state==="completed"?g.jsx("span",{className:"text-emerald-600",children:""}):e.state==="error"?g.jsx("span",{className:"text-red-600",children:""}):e.state==="pending"?g.jsx("span",{className:"text-amber-600",children:""}):g.jsx("span",{className:"text-amber-600 animate-pulse",children:""})}function Mpe(e){if(e.tool.name!=="Task")return null;const t=e.children.filter(i=>i.kind==="tool-call").filter(i=>i.tool.state==="pending"||i.tool.state==="running"||i.tool.state==="completed"||i.tool.state==="error");if(t.length===0)return null;const n=t.slice(-3);return{visible:n,remaining:t.length-n.length}}function Ape(e,t){const n=Mpe(e);if(!n)return null;const i=n.visible,s=n.remaining;return g.jsx("div",{className:"flex flex-col gap-1 px-1",children:g.jsxs("div",{className:"flex flex-col gap-1",children:[i.map(r=>g.jsx("div",{className:"flex items-center gap-2",children:g.jsxs("div",{className:"min-w-0 flex-1 font-mono text-xs text-[var(--app-hint)]",children:[g.jsx("span",{className:"mr-2 inline-block w-4 text-center align-middle",children:g.jsx(Rpe,{state:r.tool.state})}),g.jsx("span",{className:"align-middle break-all",children:Epe(r,t)})]})},r.id)),s>0?g.jsxs("div",{className:"text-xs text-[var(--app-hint)] italic",children:["(+",s," more)"]}):null]})})}function Ppe(e){if(!ye(e))return null;const t=mt(e,["file_path","path"])??void 0,n=Fu(e,"old_string"),i=Fu(e,"new_string");return n===null||i===null?null:g.jsx(rc,{oldString:n,newString:i,filePath:t})}function Lpe(e){if(!ye(e))return null;const t=Fu(e,"plan");return t?g.jsx(za,{content:t}):null}function UI(e){const t=e.tool.name,n=e.tool.input;if(t==="Task"&&ye(n)&&typeof n.prompt=="string")return g.jsx(za,{content:n.prompt});if(t==="Edit"){const s=Ppe(n);if(s)return s}if(t==="MultiEdit"&&ye(n)){const s=mt(n,["file_path","path"])??void 0,r=Array.isArray(n.edits)?n.edits:null;if(r&&r.length>0){const o=r.slice(0,3).map((a,c)=>{if(!ye(a))return null;const u=Fu(a,"old_string"),h=Fu(a,"new_string");return u===null||h===null?null:g.jsx("div",{children:g.jsx(rc,{oldString:u,newString:h,filePath:s})},c)}).filter(Boolean);if(o.length>0)return g.jsxs("div",{className:"flex flex-col gap-2",children:[o,r.length>3?g.jsxs("div",{className:"text-xs text-[var(--app-hint)]",children:["(+",r.length-3," more edits)"]}):null]})}}if(t==="Write"&&ye(n)){const s=mt(n,["file_path","path"]),r=mt(n,["content","text"]);if(s&&r!==null)return g.jsxs("div",{className:"flex flex-col gap-2",children:[g.jsx("div",{className:"text-xs text-[var(--app-hint)] font-mono break-all",children:s}),g.jsx(ds,{code:r,language:"text"})]})}if(t==="CodexDiff"&&ye(n)&&typeof n.unified_diff=="string")return g.jsx(ds,{code:n.unified_diff,language:"diff"});if(t==="ExitPlanMode"||t==="exit_plan_mode"){const s=Lpe(n);if(s)return s}const i=ye(n)&&Array.isArray(n.command)?n.command:null;if((t==="CodexBash"||t==="Bash")&&(typeof i?.[0]=="string"||typeof n=="object")){const s=Array.isArray(i)?i.filter(r=>typeof r=="string").join(" "):mt(n,["command","cmd"]);if(s)return g.jsx(ds,{code:s,language:"bash"})}return g.jsx(ds,{code:Ea(n),language:"json"})}function Npe(e){return e.state==="completed"?g.jsxs("svg",{className:"h-3 w-3",viewBox:"0 0 16 16",fill:"none",children:[g.jsx("circle",{cx:"8",cy:"8",r:"6",stroke:"currentColor",strokeWidth:"1.5"}),g.jsx("path",{d:"M5.2 8.3l1.8 1.8 3.8-4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}):e.state==="error"?g.jsxs("svg",{className:"h-3 w-3",viewBox:"0 0 16 16",fill:"none",children:[g.jsx("circle",{cx:"8",cy:"8",r:"6",stroke:"currentColor",strokeWidth:"1.5"}),g.jsx("path",{d:"M5.6 5.6l4.8 4.8M10.4 5.6l-4.8 4.8",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}):e.state==="pending"?g.jsxs("svg",{className:"h-3 w-3",viewBox:"0 0 16 16",fill:"none",children:[g.jsx("rect",{x:"4.5",y:"7",width:"7",height:"6",rx:"1.5",stroke:"currentColor",strokeWidth:"1.5"}),g.jsx("path",{d:"M6 7V5.8a2 2 0 0 1 4 0V7",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}):g.jsxs("svg",{className:"h-3 w-3 animate-spin",viewBox:"0 0 24 24",fill:"none",children:[g.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"2.5",opacity:"0.25"}),g.jsx("path",{d:"M21 12a9 9 0 0 0-9-9",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",opacity:"0.75"})]})}function Ipe(e){return e==="completed"?"text-emerald-600":e==="error"?"text-red-600":e==="pending"?"text-amber-600":"text-[var(--app-hint)]"}function Dpe(){return g.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 16 16",fill:"none",children:g.jsx("path",{d:"M6 3l5 5-5 5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}function Ope(e){const{t}=rt(),n=k.useMemo(()=>I4({toolName:e.block.tool.name,input:e.block.tool.input,result:e.block.tool.result,childrenCount:e.block.children.length,description:e.block.tool.description,metadata:e.metadata}),[e.block.tool.name,e.block.tool.input,e.block.tool.result,e.block.children.length,e.block.tool.description,e.metadata]),i=e.block.tool.name,s=n.title,r=n.subtitle??e.block.tool.description,o=Ape(e.block,e.metadata),a=e.block.tool.startedAt??e.block.tool.createdAt,c=!n.minimal&&i!=="Task",u=c?ape(i):null,h=lpe(i),f=Cpe(i),m=e.block.tool.permission,y=A4(i),b=L4(i),S=y||b,_=!!(m&&(m.status==="pending"||(m.status==="denied"||m.status==="canceled")&&m.reason)),w=c||o!==null||_,M=Ipe(e.block.tool.state),{suppressFocusRing:R,onTriggerPointerDown:E,onTriggerKeyDown:A,onTriggerBlur:T}=M4(),L=g.jsxs("div",{className:"flex flex-col gap-1",children:[g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("div",{className:"min-w-0 flex items-center gap-2",children:[g.jsx("div",{className:"shrink-0 flex h-3.5 w-3.5 items-center justify-center text-[var(--app-hint)] leading-none",children:n.icon}),g.jsx(x1,{className:"min-w-0 text-sm font-medium leading-tight break-words",children:s})]}),g.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[g.jsx(Tpe,{from:a,active:e.block.tool.state==="running"}),g.jsx("span",{className:M,children:g.jsx(Npe,{state:e.block.tool.state})}),g.jsx("span",{className:"text-[var(--app-hint)]",children:g.jsx(Dpe,{})})]})]}),r?g.jsx(E4,{className:"font-mono text-xs break-all opacity-80",children:Xs(r,160)}):null]});return g.jsxs(_1,{className:"overflow-hidden shadow-sm",children:[g.jsx(S1,{className:"p-3 space-y-0",children:g.jsxs(ec,{children:[g.jsx(cy,{asChild:!0,children:g.jsx("button",{type:"button",className:Ie("w-full text-left focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-link)]",R&&"focus-visible:ring-0"),onPointerDown:E,onKeyDown:A,onBlur:T,children:L})}),g.jsxs(Va,{className:"max-w-2xl",children:[g.jsx(tc,{children:g.jsx(Wa,{children:s})}),(()=>{const P=S&&m?.answers&&Object.keys(m.answers).length>0;return g.jsxs("div",{className:"mt-3 flex max-h-[75vh] flex-col gap-4 overflow-auto",children:[g.jsxs("div",{children:[g.jsx("div",{className:"mb-1 text-xs font-medium text-[var(--app-hint)]",children:t(P?"tool.questionsAnswers":"tool.input")}),h?g.jsx(h,{block:e.block,metadata:e.metadata}):UI(e.block)]}),!P&&g.jsxs("div",{children:[g.jsx("div",{className:"mb-1 text-xs font-medium text-[var(--app-hint)]",children:t("tool.result")}),g.jsx(f,{block:e.block,metadata:e.metadata})]})]})})()]})]})}),w?g.jsxs(R4,{className:"px-3 pb-3 pt-0",children:[o?g.jsx("div",{className:"mt-2",children:o}):null,c?u?g.jsx("div",{className:"mt-3",children:g.jsx(u,{block:e.block,metadata:e.metadata})}):g.jsxs("div",{className:"mt-3 flex flex-col gap-3",children:[g.jsxs("div",{children:[g.jsx("div",{className:"mb-1 text-xs font-medium text-[var(--app-hint)]",children:t("tool.input")}),UI(e.block)]}),g.jsxs("div",{children:[g.jsx("div",{className:"mb-1 text-xs font-medium text-[var(--app-hint)]",children:t("tool.result")}),g.jsx(f,{block:e.block,metadata:e.metadata})]})]}):null,y&&m?.status==="pending"?g.jsx(Lfe,{api:e.api,sessionId:e.sessionId,tool:e.block.tool,disabled:e.disabled,onDone:e.onDone}):b&&m?.status==="pending"?g.jsx(jfe,{api:e.api,sessionId:e.sessionId,tool:e.block.tool,disabled:e.disabled,onDone:e.onDone}):g.jsx(Rfe,{api:e.api,sessionId:e.sessionId,metadata:e.metadata,tool:e.block.tool,disabled:e.disabled,onDone:e.onDone})]}):null]})}const z4=k.memo(Ope),jpe=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,Bpe=/\u001b\][^\u0007]*(?:\u0007|\u001b\\)/g,Fpe=/[\u0000-\u0008\u000b\u000c\u000e-\u001f\u007f]/g;function Upe(e){return e.replace(/\r\n?/g,`
`).replace(Bpe,"").replace(jpe,"").replace(Fpe,"")}const zpe="(?:local-command-[a-z-]+|command-(?:name|message|args))",$pe=`<(${zpe})>([\\s\\S]*?)<\\/\\1>`,qpe=/<br\s*\/?>/gi,BS={"command-name":"terminal.commandName","command-message":"terminal.commandMessage","command-args":"terminal.commandArgs","local-command-stdout":"terminal.stdout","local-command-stderr":"terminal.stderr"},Hpe=/<command-name>([\s\S]*?)<\/command-name>/i;function Ch(e){return Upe(e).replace(qpe,`
`)}function Vpe(e,t){const n=e.toLowerCase();return BS[n]?t?t(BS[n]):BS[n]:n.replace(/-/g," ")}function Wpe(e,t){const n=Array.from(e.matchAll(new RegExp($pe,"gi")));if(n.length===0)return Ch(e);const i=[];let s=0;for(const r of n){const o=r.index??0;if(o>s){const h=Ch(e.slice(s,o));h.trim().length>0&&i.push(h.trimEnd())}const a=r[1]??"",c=Ch(r[2]??""),u=Vpe(a,t);c.length>0?i.push(`${u}:
${c}`):i.push(`${u}:`),s=o+r[0].length}if(s<e.length){const r=Ch(e.slice(s));r.trim().length>0&&i.push(r.trimEnd())}return i.join(`

`)}function Gpe(e){const t=e.match(Hpe);if(!t)return null;const i=Ch(t[1]??"").split(`
`).find(s=>s.trim().length>0)?.trim();return i&&i.length>0?i:null}function Kpe(){return g.jsx("svg",{className:"h-4 w-4",viewBox:"0 0 16 16",fill:"none",children:g.jsx("path",{d:"M6 3l5 5-5 5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}function Ype(){return g.jsxs("svg",{className:"h-4 w-4",viewBox:"0 0 16 16",fill:"none",children:[g.jsx("path",{d:"M3 4.5l3 3-3 3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),g.jsx("path",{d:"M8.5 10.5h4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}function C1(e){const{t}=rt(),n=k.useMemo(()=>Wpe(e.text,t),[e.text,t]),i=k.useMemo(()=>Gpe(e.text),[e.text]);return g.jsx(_1,{className:"min-w-0 max-w-full overflow-hidden shadow-sm",children:g.jsx(S1,{className:"p-3 space-y-0",children:g.jsxs(ec,{children:[g.jsx(cy,{asChild:!0,children:g.jsx("button",{type:"button",className:"w-full text-left",children:g.jsx("div",{className:"flex flex-col gap-1",children:g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("div",{className:"min-w-0 flex items-center gap-2",children:[g.jsx("div",{className:"shrink-0 flex h-4 w-4 items-center justify-center text-[var(--app-hint)] leading-none",children:g.jsx(Ype,{})}),g.jsx(x1,{className:"min-w-0 text-sm font-medium leading-tight break-words",children:i??t("terminal.commandName")})]}),g.jsx("span",{className:"text-[var(--app-hint)]",children:g.jsx(Kpe,{})})]})})})}),g.jsxs(Va,{className:"max-w-2xl",children:[g.jsx(tc,{children:g.jsx(Wa,{children:t("terminal.commandName")})}),g.jsx("div",{className:"mt-3 max-h-[75vh] overflow-auto",children:g.jsx("div",{className:"min-w-0 max-w-full overflow-x-auto overflow-y-hidden",children:g.jsx("pre",{className:"m-0 w-max min-w-full bg-[var(--app-code-bg)] p-2 text-xs font-mono",children:n})})})]})]})})})}function Xpe(e){return!(!ye(e)||e.kind!=="tool-call"||typeof e.id!="string"||e.localId!==null&&typeof e.localId!="string"||typeof e.createdAt!="number"||!Array.isArray(e.children)||!ye(e.tool)||typeof e.tool.name!="string"||!("input"in e.tool)||e.tool.description!==null&&typeof e.tool.description!="string"||e.tool.state!=="pending"&&e.tool.state!=="running"&&e.tool.state!=="completed"&&e.tool.state!=="error")}function Qpe(e){return e.kind==="tool-call"&&e.tool.permission?.status==="pending"}function $4(e){const t=[],n=[];for(const i of e.children)Qpe(i)?t.push(i):n.push(i);return{pending:t,rest:n}}function Mu(e){const t=Ok();return g.jsx("div",{className:"flex flex-col gap-3",children:e.blocks.map(n=>{if(n.kind==="user-text"){const i="w-fit max-w-[92%] ml-auto rounded-xl bg-[var(--app-secondary-bg)] px-3 py-2 text-[var(--app-fg)] shadow-sm",s=n.status,o=s==="failed"&&typeof n.localId=="string"&&!!t.onRetryMessage?()=>t.onRetryMessage(n.localId):void 0;return g.jsx("div",{className:i,children:g.jsxs("div",{className:"flex items-end gap-2",children:[g.jsx("div",{className:"flex-1",children:g.jsx(k4,{text:n.text})}),s?g.jsx("div",{className:"shrink-0 self-end pb-0.5",children:g.jsx(T4,{status:s,onRetry:o})}):null]})},`user:${n.id}`)}if(n.kind==="agent-text")return g.jsx("div",{className:"px-1",children:g.jsx(za,{content:n.text})},`agent:${n.id}`);if(n.kind==="cli-output"){const i=n.source==="user"?"ml-auto w-full max-w-[92%]":"";return g.jsx("div",{className:"px-1 min-w-0 max-w-full overflow-x-hidden",children:g.jsx("div",{className:i,children:g.jsx(C1,{text:n.text})})},`cli:${n.id}`)}if(n.kind==="agent-event"){const i=b1(n.event);return g.jsx("div",{className:"py-1",children:g.jsx("div",{className:"mx-auto w-fit max-w-[92%] px-2 text-center text-xs text-[var(--app-hint)] opacity-80",children:g.jsxs("span",{className:"inline-flex items-center gap-1",children:[i.icon?g.jsx("span",{"aria-hidden":"true",children:i.icon}):null,g.jsx("span",{children:i.text})]})})},`event:${n.id}`)}if(n.kind==="tool-call"){const i=n.tool.name==="Task",s=i?$4(n):null;return g.jsxs("div",{className:"py-1",children:[g.jsx(z4,{api:t.api,sessionId:t.sessionId,metadata:t.metadata,disabled:t.disabled,onDone:t.onRefresh,block:n}),n.children.length>0?i?g.jsxs(g.Fragment,{children:[s&&s.pending.length>0?g.jsx("div",{className:"mt-2 pl-3",children:g.jsx(Mu,{blocks:s.pending})}):null,s&&s.rest.length>0?g.jsxs("details",{className:"mt-2",children:[g.jsxs("summary",{className:"cursor-pointer text-xs text-[var(--app-hint)]",children:["Task details (",s.rest.length,")"]}),g.jsx("div",{className:"mt-2 pl-3",children:g.jsx(Mu,{blocks:s.rest})})]}):null]}):g.jsx("div",{className:"mt-2 pl-3",children:g.jsx(Mu,{blocks:n.children})}):null]},`tool:${n.id}`)}return null})})}function Jpe(e){const t=Ok(),n=e.artifact;if(!Xpe(n)){const o=typeof e.argsText=="string"?e.argsText.trim():"",a=o.length>0,c=e.result!==void 0,u=c?Ea(e.result):"";return g.jsx("div",{className:"py-1 min-w-0 max-w-full overflow-x-hidden",children:g.jsxs("div",{className:"rounded-xl bg-[var(--app-secondary-bg)] p-3 shadow-sm",children:[g.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[g.jsxs("div",{className:"font-mono text-[var(--app-hint)]",children:["Tool: ",e.toolName]}),e.isError?g.jsx("span",{className:"text-red-500",children:"Error"}):null,e.status.type==="running"&&!c?g.jsx("span",{className:"text-[var(--app-hint)]",children:"Running"}):null]}),a?g.jsx("div",{className:"mt-2",children:g.jsx(ds,{code:o,language:"json"})}):null,c?g.jsx("div",{className:"mt-2",children:g.jsx(ds,{code:u,language:typeof e.result=="string"?"text":"json"})}):null]})})}const i=n,s=i.tool.name==="Task",r=s?$4(i):null;return g.jsxs("div",{className:"py-1 min-w-0 max-w-full overflow-x-hidden",children:[g.jsx(z4,{api:t.api,sessionId:t.sessionId,metadata:t.metadata,disabled:t.disabled,onDone:t.onRefresh,block:i}),i.children.length>0?s?g.jsxs(g.Fragment,{children:[r&&r.pending.length>0?g.jsx("div",{className:"mt-2 pl-3",children:g.jsx(Mu,{blocks:r.pending})}):null,r&&r.rest.length>0?g.jsxs("details",{className:"mt-2",children:[g.jsxs("summary",{className:"cursor-pointer text-xs text-[var(--app-hint)]",children:["Task details (",r.rest.length,")"]}),g.jsx("div",{className:"mt-2 pl-3",children:g.jsx(Mu,{blocks:r.rest})})]}):null]}):g.jsx("div",{className:"mt-2 pl-3",children:g.jsx(Mu,{blocks:i.children})}):null]})}const Zpe={Fallback:Jpe},eme={Text:ife,Reasoning:ofe,ReasoningGroup:afe,tools:Zpe};function tme(){const e=st(({message:s})=>s.metadata.custom?.kind==="cli-output"),t=st(({message:s})=>s.metadata.custom?.kind!=="cli-output"?"":s.content.find(o=>o.type==="text")?.text??""),i=st(({message:s})=>{if(s.role!=="assistant")return!1;const r=s.content;return r.length>0&&r.every(o=>o.type==="tool-call")})?"py-1 min-w-0 max-w-full overflow-x-hidden":"px-1 min-w-0 max-w-full overflow-x-hidden";return e?g.jsx(Sf,{className:"px-1 min-w-0 max-w-full overflow-x-hidden",children:g.jsx(C1,{text:t})}):g.jsx(Sf,{className:i,children:g.jsx(XB,{components:eme})})}const nme={ts:"#3178c6",tsx:"#3178c6",js:"#f7df1e",jsx:"#f7df1e",json:"#f59e0b",md:"#64748b",mdx:"#64748b",css:"#2563eb",scss:"#db2777",html:"#f97316",yml:"#ef4444",yaml:"#ef4444",sh:"#10b981",bash:"#10b981",py:"#3776ab",go:"#0ea5e9",rs:"#f97316"};function ime(e){const t=e.trim();if(t.startsWith(".")&&t.indexOf(".",1)===-1)return t.slice(1).toLowerCase();const n=t.split(".");return n.length<=1?"":n[n.length-1]?.toLowerCase()??""}function Gf(e){const t=e.size??20,n=k.useMemo(()=>{const i=ime(e.fileName);return nme[i]??"var(--app-hint)"},[e.fileName]);return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",style:{color:n},children:[g.jsx("path",{d:"M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z"}),g.jsx("path",{d:"M14 2v6h6"})]})}function Rw(e){return e.startsWith("image/")}function sme(e){return e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(1)} MB`}function rme(e){const{attachment:t}=e;return g.jsxs("div",{className:"relative overflow-hidden rounded-lg",children:[g.jsx("img",{src:t.previewUrl,alt:t.filename,className:"max-h-48 max-w-full object-contain"}),g.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent px-2 py-1.5",children:g.jsx("span",{className:"text-xs text-white/90 line-clamp-1",children:t.filename})})]})}function ome(e){const{attachment:t}=e;return g.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-[var(--app-bg)] px-3 py-2",children:[g.jsx(Gf,{fileName:t.filename,size:24}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"truncate text-base font-medium text-[var(--app-fg)]",children:t.filename}),g.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:sme(t.size)})]})]})}function ame(e){const{attachments:t}=e;if(!t||t.length===0)return null;const n=t.filter(s=>Rw(s.mimeType)&&s.previewUrl),i=t.filter(s=>!Rw(s.mimeType)||!s.previewUrl);return g.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[n.length>0&&g.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(s=>g.jsx(rme,{attachment:s},s.id))}),i.length>0&&g.jsx("div",{className:"flex flex-col gap-1.5",children:i.map(s=>g.jsx(ome,{attachment:s},s.id))})]})}function lme(){const e=Ok(),t=st(({message:y})=>y.role),n=st(({message:y})=>y.role!=="user"?"":y.content.find(b=>b.type==="text")?.text??""),i=st(({message:y})=>y.role!=="user"?void 0:y.metadata.custom?.status),s=st(({message:y})=>y.role!=="user"?null:y.metadata.custom?.localId??null),r=st(({message:y})=>y.role!=="user"?void 0:y.metadata.custom?.attachments),o=st(({message:y})=>y.metadata.custom?.kind==="cli-output"),a=st(({message:y})=>y.metadata.custom?.kind!=="cli-output"?"":y.content.find(S=>S.type==="text")?.text??"");if(t!=="user")return null;const u=i==="failed"&&typeof s=="string"&&!!e.onRetryMessage?()=>e.onRetryMessage(s):void 0,h="w-fit min-w-0 max-w-[92%] ml-auto rounded-xl bg-[var(--app-secondary-bg)] px-3 py-2 text-[var(--app-fg)] shadow-sm";if(o)return g.jsx(Sf,{className:"px-1 min-w-0 max-w-full overflow-x-hidden",children:g.jsx("div",{className:"ml-auto w-full max-w-[92%]",children:g.jsx(C1,{text:a})})});const f=n.length>0,m=r&&r.length>0;return g.jsx(Sf,{className:h,children:g.jsxs("div",{className:"flex items-end gap-2",children:[g.jsxs("div",{className:"flex-1 min-w-0",children:[f&&g.jsx(k4,{text:n}),m&&g.jsx(ame,{attachments:r})]}),i?g.jsx("div",{className:"shrink-0 self-end pb-0.5",children:g.jsx(T4,{status:i,onRetry:u})}):null]})})}function cme(){const e=st(({message:i})=>i.role),t=st(({message:i})=>i.role!=="system"?"":i.content[0]?.type==="text"?i.content[0].text:""),n=st(({message:i})=>{if(i.role!=="system")return null;const s=i.metadata.custom,r=s?.kind==="event"?s.event:void 0;return r?b1(r).icon:null});return e!=="system"?null:g.jsx("div",{className:"py-1",children:g.jsx("div",{className:"mx-auto w-fit max-w-[92%] px-2 text-center text-xs text-[var(--app-hint)] opacity-80",children:g.jsxs("span",{className:"inline-flex items-center gap-1",children:[n?g.jsx("span",{"aria-hidden":"true",children:n}):null,g.jsx("span",{children:t})]})})})}function ume(e){const{t}=rt();return e.count===0?null:g.jsxs("button",{onClick:e.onClick,className:"absolute bottom-20 left-1/2 -translate-x-1/2 bg-[var(--app-button)] text-[var(--app-button-text)] px-3 py-1.5 rounded-full text-sm font-medium shadow-lg animate-bounce-in z-10",children:[t("misc.newMessage",{n:e.count})," "]})}function dme(){const{t:e}=rt(),t=[{align:"end",width:"w-2/3",height:"h-10"},{align:"start",width:"w-3/4",height:"h-12"},{align:"end",width:"w-1/2",height:"h-9"},{align:"start",width:"w-5/6",height:"h-14"}];return g.jsxs("div",{role:"status","aria-live":"polite",children:[g.jsx("span",{className:"sr-only",children:e("misc.loadingMessages")}),g.jsx("div",{className:"space-y-3 animate-pulse",children:t.map((n,i)=>g.jsx("div",{className:n.align==="end"?"flex justify-end":"flex justify-start",children:g.jsx("div",{className:`${n.height} ${n.width} rounded-xl bg-[var(--app-subtle-bg)]`})},`skeleton-${i}`))})]})}const hme={UserMessage:lme,AssistantMessage:tme,SystemMessage:cme};function fme(e){const{t}=rt(),n=k.useRef(null),i=k.useRef(null),s=k.useRef(!1),r=k.useRef(null),o=k.useRef(!1),a=k.useRef(!1),c=k.useRef(e.isLoadingMoreMessages),u=k.useRef(e.hasMoreMessages),h=k.useRef(e.isLoadingMessages),f=k.useRef(e.onLoadMore),m=k.useRef(()=>{}),y=k.useRef(!0),b=k.useRef(e.onAtBottomChange),S=k.useRef(e.onFlushPending),_=k.useRef(e.forceScrollToken),[w,M]=k.useState(!0),R=k.useRef(w);k.useEffect(()=>{R.current=w},[w]),k.useEffect(()=>{b.current=e.onAtBottomChange},[e.onAtBottomChange]),k.useEffect(()=>{S.current=e.onFlushPending},[e.onFlushPending]),k.useEffect(()=>{u.current=e.hasMoreMessages},[e.hasMoreMessages]),k.useEffect(()=>{h.current=e.isLoadingMessages},[e.isLoadingMessages]),k.useEffect(()=>{f.current=e.onLoadMore},[e.onLoadMore]),k.useEffect(()=>{const L=n.current;if(!L)return;const P=120,I=()=>{const O=L.scrollHeight-L.scrollTop-L.clientHeight<P;O?R.current||M(!0):R.current&&M(!1),O!==y.current&&(y.current=O,b.current(O),O&&S.current())};return L.addEventListener("scroll",I,{passive:!0}),()=>L.removeEventListener("scroll",I)},[]);const E=k.useCallback(()=>{const L=n.current;L&&L.scrollTo({top:L.scrollHeight,behavior:"smooth"}),M(!0),y.current||(y.current=!0,b.current(!0)),S.current()},[]);k.useEffect(()=>{M(!0),y.current=!0,b.current(!0),_.current=e.forceScrollToken},[e.sessionId]),k.useEffect(()=>{_.current!==e.forceScrollToken&&(_.current=e.forceScrollToken,E())},[e.forceScrollToken,E]);const A=k.useCallback(()=>{if(h.current||!u.current||c.current||s.current)return;const L=n.current;if(!L)return;r.current={scrollTop:L.scrollTop,scrollHeight:L.scrollHeight},s.current=!0,a.current=!1;let P;try{P=f.current()}catch(I){throw r.current=null,s.current=!1,I}P.catch(I=>{r.current=null,s.current=!1,console.error("Failed to load older messages:",I)}).finally(()=>{!a.current&&!c.current&&r.current&&(r.current=null,s.current=!1)})},[]);k.useEffect(()=>{m.current=A},[A]),k.useEffect(()=>{const L=i.current,P=n.current;if(!L||!P||!e.hasMoreMessages||e.isLoadingMessages||typeof IntersectionObserver>"u")return;const I=new IntersectionObserver(N=>{for(const O of N)O.isIntersecting&&m.current()},{root:P,rootMargin:"200px 0px 0px 0px"});return I.observe(L),()=>I.disconnect()},[e.hasMoreMessages,e.isLoadingMessages]),k.useLayoutEffect(()=>{const L=r.current,P=n.current;if(!L||!P)return;const I=P.scrollHeight-L.scrollHeight;P.scrollTop=L.scrollTop+I,r.current=null,s.current=!1},[e.messagesVersion]),k.useEffect(()=>{c.current=e.isLoadingMoreMessages,e.isLoadingMoreMessages&&(a.current=!0),o.current&&!e.isLoadingMoreMessages&&r.current&&(r.current=null,s.current=!1),o.current=e.isLoadingMoreMessages},[e.isLoadingMoreMessages]);const T=e.isLoadingMessages&&e.rawMessagesCount===0&&e.pendingCount===0;return g.jsx(Yte,{value:{api:e.api,sessionId:e.sessionId,metadata:e.metadata,disabled:e.disabled,onRefresh:e.onRefresh,onRetryMessage:e.onRetryMessage},children:g.jsxs(i3,{className:"flex min-h-0 flex-1 flex-col relative",children:[g.jsx(r3,{asChild:!0,autoScroll:w,children:g.jsx("div",{ref:n,className:"min-h-0 flex-1 overflow-y-auto overflow-x-hidden",children:g.jsxs("div",{className:"mx-auto w-full max-w-content min-w-0 p-3",children:[g.jsx("div",{ref:i,className:"h-px w-full","aria-hidden":"true"}),T?g.jsx(dme,{}):g.jsxs(g.Fragment,{children:[e.messagesWarning?g.jsx("div",{className:"mb-3 rounded-md bg-amber-500/10 p-2 text-xs",children:e.messagesWarning}):null,e.hasMoreMessages&&!e.isLoadingMessages?g.jsx("div",{className:"py-1 mb-2",children:g.jsx("div",{className:"mx-auto w-fit",children:g.jsx(Xn,{variant:"outline",size:"sm",onClick:A,disabled:e.isLoadingMoreMessages||e.isLoadingMessages,"aria-busy":e.isLoadingMoreMessages,className:"gap-1.5 text-xs opacity-80 hover:opacity-100",children:e.isLoadingMoreMessages?g.jsxs(g.Fragment,{children:[g.jsx(Bo,{size:"sm",label:null,className:"text-current"}),t("misc.loading")]}):g.jsxs(g.Fragment,{children:[g.jsx("span",{"aria-hidden":"true",children:""}),t("misc.loadOlder")]})})})}):null,null]}),g.jsx("div",{className:"flex flex-col gap-3",children:g.jsx(Uee,{components:hme})})]})})}),g.jsx(ume,{count:e.pendingCount,onClick:E})]})})}function pme(e){if(e.kind==="user-text")return{role:"user",id:`user:${e.id}`,createdAt:new Date(e.createdAt),content:[{type:"text",text:e.text}],metadata:{custom:{kind:"user",status:e.status,localId:e.localId,originalText:e.originalText,attachments:e.attachments}}};if(e.kind==="agent-text")return{role:"assistant",id:`assistant:${e.id}`,createdAt:new Date(e.createdAt),content:[{type:"text",text:e.text}],metadata:{custom:{kind:"assistant"}}};if(e.kind==="agent-reasoning")return{role:"assistant",id:`assistant:${e.id}`,createdAt:new Date(e.createdAt),content:[{type:"reasoning",text:e.text}],metadata:{custom:{kind:"assistant"}}};if(e.kind==="agent-event")return{role:"system",id:`event:${e.id}`,createdAt:new Date(e.createdAt),content:[{type:"text",text:ufe(e.event)}],metadata:{custom:{kind:"event",event:e.event}}};if(e.kind==="cli-output"){const s=`cli:${e.id}`;return{role:e.source==="user"?"user":"assistant",id:s,createdAt:new Date(e.createdAt),content:[{type:"text",text:e.text}],metadata:{custom:{kind:"cli-output",source:e.source}}}}const t=e,n=`tool:${t.id}`,i=Ea(t.tool.input);return{role:"assistant",id:n,createdAt:new Date(t.createdAt),content:[{type:"tool-call",toolCallId:t.id,toolName:t.tool.name,argsText:i,result:t.tool.result,isError:t.tool.state==="error",artifact:t}],metadata:{custom:{kind:"tool",toolCallId:t.id}}}}function mme(e){return e?e.filter(t=>t.type==="text"&&typeof t.text=="string").map(t=>t.text).join(`
`).trim():""}function gme(e){try{const t=JSON.parse(e);return t&&typeof t=="object"&&"__attachmentMetadata"in t?t:null}catch{return null}}function vme(e){if(e.role!=="user")return{text:"",attachments:[]};const t=[],n=[],i=e.attachments?.flatMap(o=>o.content??[])??[];for(const o of i)if(o.type==="text"&&typeof o.text=="string"){const a=o,c=gme(a.text);c?t.push(c.__attachmentMetadata):n.push(a.text)}const s=mme(e.content);return{text:[n.join(`
`),s].filter(o=>o.length>0).join(`

`).trim(),attachments:t}}function yme(e){const t=SZ({callback:pme,messages:e.blocks,isRunning:e.session.thinking}),n=k.useCallback(async r=>{const{text:o,attachments:a}=vme(r);!o&&a.length===0||e.onSendMessage(o,a.length>0?a:void 0)},[e.onSendMessage]),i=k.useCallback(async()=>{await e.onAbort()},[e.onAbort]),s=k.useMemo(()=>({isDisabled:e.isSending||!e.session.active&&!e.allowSendWhenInactive,isRunning:e.session.thinking,messages:t,onNew:n,onCancel:i,adapters:e.attachmentAdapter?{attachments:e.attachmentAdapter}:void 0,unstable_capabilities:{copy:!0}}),[e.session.active,e.isSending,e.allowSendWhenInactive,e.session.thinking,t,n,i,e.attachmentAdapter]);return AJ(s)}const bme=50*1024*1024,_me=5*1024*1024;function Sme(e,t){const n=new Set,i=async s=>{if(s)try{await e.deleteUploadFile(t,s)}catch{}};return{accept:"*/*",async*add({file:s}){const r=crypto.randomUUID(),o=s.type||"application/octet-stream";yield{id:r,type:"file",name:s.name,contentType:o,file:s,status:{type:"running",reason:"uploading",progress:0}};try{if(n.has(r))return;if(s.size>bme){yield{id:r,type:"file",name:s.name,contentType:o,file:s,status:{type:"incomplete",reason:"error"}};return}const a=await xme(s);if(n.has(r))return;yield{id:r,type:"file",name:s.name,contentType:o,file:s,status:{type:"running",reason:"uploading",progress:50}};const c=await e.uploadFile(t,s.name,a,o);if(n.has(r)){c.success&&c.path&&await i(c.path);return}if(!c.success||!c.path){yield{id:r,type:"file",name:s.name,contentType:o,file:s,status:{type:"incomplete",reason:"error"}};return}let u;Rw(o)&&s.size<=_me&&(u=await wme(s)),yield{id:r,type:"file",name:s.name,contentType:o,file:s,status:{type:"requires-action",reason:"composer-send"},path:c.path,previewUrl:u}}catch{yield{id:r,type:"file",name:s.name,contentType:o,file:s,status:{type:"incomplete",reason:"error"}}}},async remove(s){n.add(s.id);const r=s.path;await i(r)},async send(s){const r=s,o=r.path,a=o?{id:s.id,filename:s.name,mimeType:s.contentType??"application/octet-stream",size:s.file?.size??0,path:o,previewUrl:r.previewUrl}:void 0;return{id:s.id,type:s.type,name:s.name,contentType:s.contentType,status:{type:"complete"},content:a?[{type:"text",text:JSON.stringify({__attachmentMetadata:a})}]:[]}}}}async function xme(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=()=>{const r=i.result.split(",")[1];if(!r){n(new Error("Failed to read file"));return}t(r)},i.onerror=n,i.readAsDataURL(e)})}async function wme(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=()=>{t(i.result)},i.onerror=n,i.readAsDataURL(e)})}function k1(e,t,n){const i=jo(),s=async()=>{t&&(await i.invalidateQueries({queryKey:Xt.session(t)}),await i.invalidateQueries({queryKey:Xt.sessions}))},r=wo({mutationFn:async()=>{if(!e||!t)throw new Error("Session unavailable");await e.abortSession(t)},onSuccess:()=>{s()}}),o=wo({mutationFn:async()=>{if(!e||!t)throw new Error("Session unavailable");await e.archiveSession(t)},onSuccess:()=>{s()}}),a=wo({mutationFn:async()=>{if(!e||!t)throw new Error("Session unavailable");await e.switchSession(t)},onSuccess:()=>{s()}}),c=wo({mutationFn:async m=>{if(!e||!t)throw new Error("Session unavailable");if(xte(n)&&!BD(m,n))throw new Error("Invalid permission mode for session flavor");await e.setPermissionMode(t,m)},onSuccess:()=>{s()}}),u=wo({mutationFn:async m=>{if(!e||!t)throw new Error("Session unavailable");await e.setModelMode(t,m)},onSuccess:()=>{s()}}),h=wo({mutationFn:async m=>{if(!e||!t)throw new Error("Session unavailable");await e.renameSession(t,m)},onSuccess:()=>{s()}}),f=wo({mutationFn:async()=>{if(!e||!t)throw new Error("Session unavailable");await e.deleteSession(t)},onSuccess:async()=>{t&&(i.removeQueries({queryKey:Xt.session(t)}),FC(t),await i.invalidateQueries({queryKey:Xt.sessions}))}});return{abortSession:r.mutateAsync,archiveSession:o.mutateAsync,switchSession:a.mutateAsync,setPermissionMode:c.mutateAsync,setModelMode:u.mutateAsync,renameSession:h.mutateAsync,deleteSession:f.mutateAsync,isPending:r.isPending||o.isPending||a.isPending||c.isPending||u.isPending||h.isPending||f.isPending}}function Cme(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[g.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),g.jsx("path",{d:"m15 5 4 4"})]})}function kme(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[g.jsx("rect",{width:"20",height:"5",x:"2",y:"3",rx:"1"}),g.jsx("path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"}),g.jsx("path",{d:"M10 12h4"})]})}function Tme(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[g.jsx("path",{d:"M3 6h18"}),g.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),g.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),g.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),g.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]})}function q4(e){const{t}=rt(),{isOpen:n,onClose:i,sessionActive:s,onRename:r,onArchive:o,onDelete:a,anchorPoint:c,menuId:u}=e,h=k.useRef(null),[f,m]=k.useState(null),y=k.useId(),b=u??`session-action-menu-${y}`,S=`${b}-heading`,_=()=>{i(),r()},w=()=>{i(),o()},M=()=>{i(),a()},R=k.useCallback(()=>{const T=h.current;if(!T)return;const L=T.getBoundingClientRect(),P=window.innerWidth,I=window.innerHeight,N=8,O=8,j=I-c.y,$=c.y,V=j<L.height+O&&$>j;let H=V?c.y-L.height-O:c.y+O,B=c.x-L.width/2;const W=V?"bottom center":"top center";H=Math.min(Math.max(H,N),I-L.height-N),B=Math.min(Math.max(B,N),P-L.width-N),m({top:H,left:B,transformOrigin:W})},[c]);if(k.useLayoutEffect(()=>{n&&R()},[n,R]),k.useEffect(()=>{if(!n){m(null);return}const T=I=>{const N=I.target;h.current?.contains(N)||i()},L=I=>{I.key==="Escape"&&i()},P=()=>{R()};return document.addEventListener("pointerdown",T),document.addEventListener("keydown",L),window.addEventListener("resize",P),window.addEventListener("scroll",P,!0),()=>{document.removeEventListener("pointerdown",T),document.removeEventListener("keydown",L),window.removeEventListener("resize",P),window.removeEventListener("scroll",P,!0)}},[n,i,R]),k.useEffect(()=>{if(!n)return;const T=window.requestAnimationFrame(()=>{h.current?.querySelector('[role="menuitem"]')?.focus()});return()=>window.cancelAnimationFrame(T)},[n]),!n)return null;const E=f?{top:f.top,left:f.left,transformOrigin:f.transformOrigin}:void 0,A="flex w-full items-center gap-3 rounded-md px-3 py-2 text-left text-base transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-link)]";return g.jsxs("div",{ref:h,className:"fixed z-50 min-w-[200px] rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] p-1 shadow-lg animate-menu-pop",style:E,children:[g.jsx("div",{id:S,className:"px-3 py-1.5 text-[10px] font-semibold uppercase tracking-wide text-[var(--app-hint)]",children:t("session.more")}),g.jsxs("div",{id:b,role:"menu","aria-labelledby":S,className:"flex flex-col gap-1",children:[g.jsxs("button",{type:"button",role:"menuitem",className:`${A} hover:bg-[var(--app-subtle-bg)]`,onClick:_,children:[g.jsx(Cme,{className:"text-[var(--app-hint)]"}),t("session.action.rename")]}),s?g.jsxs("button",{type:"button",role:"menuitem",className:`${A} text-red-500 hover:bg-red-500/10`,onClick:w,children:[g.jsx(kme,{className:"text-red-500"}),t("session.action.archive")]}):g.jsxs("button",{type:"button",role:"menuitem",className:`${A} text-red-500 hover:bg-red-500/10`,onClick:M,children:[g.jsx(Tme,{className:"text-red-500"}),t("session.action.delete")]})]})]})}function H4(e){const{t}=rt(),{isOpen:n,onClose:i,currentName:s,onRename:r,isPending:o}=e,[a,c]=k.useState(s),[u,h]=k.useState(null),f=k.useRef(null);k.useEffect(()=>{n&&(c(s),h(null),setTimeout(()=>{f.current?.focus(),f.current?.select()},100))},[n,s]);const m=async b=>{b.preventDefault();const S=a.trim();if(!S||S===s){i();return}h(null);try{await r(S),i()}catch{h(t("dialog.rename.error"))}},y=b=>{b.key==="Escape"&&i()};return g.jsx(ec,{open:n,onOpenChange:b=>!b&&i(),children:g.jsxs(Va,{className:"max-w-sm",children:[g.jsx(tc,{children:g.jsx(Wa,{children:t("dialog.rename.title")})}),g.jsxs("form",{onSubmit:m,className:"mt-4 flex flex-col gap-4",children:[g.jsx("input",{ref:f,type:"text",value:a,onChange:b=>c(b.target.value),onKeyDown:y,placeholder:t("dialog.rename.placeholder"),className:"w-full px-3 py-2.5 rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none focus:ring-2 focus:ring-[var(--app-button)] focus:border-transparent",disabled:o,maxLength:255}),u?g.jsx("div",{className:"rounded-md bg-red-50 p-3 text-sm text-red-600 dark:bg-red-900/20 dark:text-red-400",children:u}):null,g.jsxs("div",{className:"flex gap-2 justify-end",children:[g.jsx(Xn,{type:"button",variant:"secondary",onClick:i,disabled:o,children:t("button.cancel")}),g.jsx(Xn,{type:"submit",disabled:o||!a.trim(),children:t(o?"dialog.rename.saving":"button.save")})]})]})]})})}function Bv(e){const{t}=rt(),{isOpen:n,onClose:i,title:s,description:r,confirmLabel:o,confirmingLabel:a,onConfirm:c,isPending:u,destructive:h=!1}=e,[f,m]=k.useState(null);k.useEffect(()=>{n&&m(null)},[n]);const y=async()=>{m(null);try{await c(),i()}catch(b){const S=b instanceof Error&&b.message?b.message:t("dialog.error.default");m(S)}};return g.jsx(ec,{open:n,onOpenChange:b=>!b&&i(),children:g.jsxs(Va,{className:"max-w-sm",children:[g.jsxs(tc,{children:[g.jsx(Wa,{children:s}),g.jsx(Df,{className:"mt-2",children:r})]}),f?g.jsx("div",{className:"mt-3 rounded-md bg-red-50 p-3 text-sm text-red-600 dark:bg-red-900/20 dark:text-red-400",children:f}):null,g.jsxs("div",{className:"mt-4 flex gap-2 justify-end",children:[g.jsx(Xn,{type:"button",variant:"secondary",onClick:i,disabled:u,children:t("button.cancel")}),g.jsx(Xn,{type:"button",variant:h?"destructive":"secondary",onClick:y,disabled:u,children:u?a:o})]})]})})}const V4="hapi:sessionModelOverrides",zI=200;let os=null;function W4(){if(os)return os;if(typeof localStorage>"u")return os={},os;try{const e=localStorage.getItem(V4);if(!e)return os={},os;const t=JSON.parse(e);return!t||typeof t!="object"?(os={},os):(os=t,os)}catch{return os={},os}}function Eme(e){if(os=e,!(typeof localStorage>"u"))try{localStorage.setItem(V4,JSON.stringify(e))}catch{}}function Rme(e){const t=Object.keys(e);if(t.length<=zI)return e;const n=t.map(r=>({id:r,savedAt:e[r]?.savedAt??0})).sort((r,o)=>o.savedAt-r.savedAt),i=new Set(n.slice(0,zI).map(r=>r.id)),s={};for(const r of i){const o=e[r];o&&(s[r]=o)}return s}function Mme(e,t){const n=e.trim();if(!n)return;const i=t.model.trim();if(!i)return;const r={...W4(),[n]:{agent:t.agent,model:i,savedAt:Date.now()}};Eme(Rme(r))}function G4(e){const t=e.trim();return t?W4()[t]??null:null}function Ame(e){if(e.metadata?.name)return e.metadata.name;if(e.metadata?.summary?.text)return e.metadata.summary.text;if(e.metadata?.path){const t=e.metadata.path.split("/").filter(Boolean);return t.length>0?t[t.length-1]:e.id.slice(0,8)}return e.id.slice(0,8)}function Pme(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[g.jsx("path",{d:"M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8z"}),g.jsx("path",{d:"M14 2v6h6"})]})}function Lme(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",className:e.className,children:[g.jsx("circle",{cx:"12",cy:"5",r:"2"}),g.jsx("circle",{cx:"12",cy:"12",r:"2"}),g.jsx("circle",{cx:"12",cy:"19",r:"2"})]})}function Nme(e){const{t}=rt(),{session:n,api:i,onSessionDeleted:s}=e,r=k.useMemo(()=>Ame(n),[n]),o=n.metadata?.worktree?.branch,a=(()=>{const N=n.metadata?.flavor?.trim()??"";if(N==="claude")return{label:t("session.item.modelMode"),value:n.modelMode||"default"};const O=n.metadata?.model?.trim()||(N==="codex"||N==="gemini"?G4(n.id)?.model:void 0);return N==="codex"||N==="gemini"||O?{label:t("session.item.model"),value:O||"auto"}:null})(),[c,u]=k.useState(!1),[h,f]=k.useState({x:0,y:0}),m=k.useId(),y=k.useRef(null),[b,S]=k.useState(!1),[_,w]=k.useState(!1),[M,R]=k.useState(!1),{archiveSession:E,renameSession:A,deleteSession:T,isPending:L}=k1(i,n.id,n.metadata?.flavor??null),P=async()=>{await T(),s?.()},I=()=>{if(!c&&y.current){const N=y.current.getBoundingClientRect();f({x:N.right,y:N.bottom})}u(N=>!N)};return Xv()?null:g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:g.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center gap-2 p-3",children:[g.jsx("button",{type:"button",onClick:e.onBack,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:g.jsx("polyline",{points:"15 18 9 12 15 6"})})}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"truncate font-semibold",children:r}),g.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-0.5 text-xs text-[var(--app-hint)]",children:[g.jsxs("span",{className:"inline-flex items-center gap-1",children:[g.jsx("span",{"aria-hidden":"true",children:""}),n.metadata?.flavor?.trim()||"unknown"]}),a?g.jsxs("span",{children:[a.label,": ",a.value]}):null,o?g.jsxs("span",{children:[t("session.item.worktree"),": ",o]}):null]})]}),e.onViewFiles?g.jsx("button",{type:"button",onClick:e.onViewFiles,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",title:t("session.title"),children:g.jsx(Pme,{})}):null,g.jsx("button",{type:"button",onClick:I,onPointerDown:N=>N.stopPropagation(),ref:y,"aria-haspopup":"menu","aria-expanded":c,"aria-controls":c?m:void 0,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",title:t("session.more"),children:g.jsx(Lme,{})})]})}),g.jsx(q4,{isOpen:c,onClose:()=>u(!1),sessionActive:n.active,onRename:()=>S(!0),onArchive:()=>w(!0),onDelete:()=>R(!0),anchorPoint:h,menuId:m}),g.jsx(H4,{isOpen:b,onClose:()=>S(!1),currentName:r,onRename:A,isPending:L}),g.jsx(Bv,{isOpen:_,onClose:()=>w(!1),title:t("dialog.archive.title"),description:t("dialog.archive.description",{name:r}),confirmLabel:t("dialog.archive.confirm"),confirmingLabel:t("dialog.archive.confirming"),onConfirm:E,isPending:L,destructive:!0}),g.jsx(Bv,{isOpen:M,onClose:()=>R(!1),title:t("dialog.delete.title"),description:t("dialog.delete.description",{name:r}),confirmLabel:t("dialog.delete.confirm"),confirmingLabel:t("dialog.delete.confirming"),onConfirm:P,isPending:L,destructive:!0})]})}function Ime(e){const{haptic:t}=Yr(),n=fr(),i=!e.session.active,s=k.useRef(new Map),r=k.useRef(new Map),[o,a]=k.useState(0),c=e.session.metadata?.flavor??null,{abortSession:u,switchSession:h,setPermissionMode:f,setModelMode:m}=k1(e.api,e.session.id,c),y=nj();k.useEffect(()=>{YD({getSession:()=>e.session,sendMessage:(B,W)=>e.onSend(W),approvePermission:async(B,W)=>{await e.api.approvePermission(e.session.id,W),e.onRefresh()},denyPermission:async(B,W)=>{await e.api.denyPermission(e.session.id,W),e.onRefresh()}})},[e.session,e.api,e.onSend,e.onRefresh]),k.useEffect(()=>{aK(B=>B===e.session.id?e.session:null,B=>B===e.session.id?e.messages:[])},[e.session,e.messages]);const b=k.useRef([]);k.useEffect(()=>{const B=new Set(b.current.map(q=>q.id)),W=e.messages.filter(q=>!B.has(q.id));W.length>0&&Uh.onMessages(e.session.id,W),b.current=e.messages},[e.messages,e.session.id]);const S=k.useRef(e.session.thinking);k.useEffect(()=>{S.current&&!e.session.thinking&&Uh.onReady(e.session.id),S.current=e.session.thinking},[e.session.thinking,e.session.id]);const _=k.useRef(new Set);k.useEffect(()=>{const B=e.session.agentState?.requests??{},W=new Set(Object.keys(B));for(const[q,ne]of Object.entries(B))_.current.has(q)||Uh.onPermissionRequested(e.session.id,q,ne.tool??"unknown",ne.arguments);_.current=W},[e.session.agentState?.requests,e.session.id]);const w=k.useCallback(async()=>{y&&(y.status==="connected"||y.status==="connecting"?await y.stopVoice():await y.startVoice(e.session.id))},[y,e.session.id]),M=k.useCallback(()=>{y&&y.toggleMic()},[y]),R=k.useRef(null);k.useEffect(()=>{s.current.clear(),r.current.clear()},[e.session.id]);const E=k.useMemo(()=>{R.current!==null&&R.current!==e.session.id&&(s.current.clear(),r.current.clear()),R.current=e.session.id;const B=s.current,W=[],q=new Set;for(const ne of e.messages){q.add(ne.id);const z=B.get(ne.id);if(z&&z.source===ne){z.normalized&&W.push(z.normalized);continue}const G=FD(ne);B.set(ne.id,{source:ne,normalized:G}),G&&W.push(G)}for(const ne of B.keys())q.has(ne)||B.delete(ne);return W},[e.messages]),A=k.useMemo(()=>ste(E,e.session.agentState),[E,e.session.agentState]),T=k.useMemo(()=>mte(A.blocks,r.current),[A.blocks]);k.useEffect(()=>{r.current=T.byId},[T.byId]);const L=k.useCallback(async B=>{try{await f(B),t.notification("success"),e.onRefresh()}catch(W){t.notification("error"),console.error("Failed to set permission mode:",W)}},[f,e.onRefresh,t]),P=k.useCallback(async B=>{try{await m(B),t.notification("success"),e.onRefresh()}catch(W){t.notification("error"),console.error("Failed to set model mode:",W)}},[m,e.onRefresh,t]),I=k.useCallback(async()=>{await u(),e.onRefresh()},[u,e.onRefresh]),N=k.useCallback(async()=>{await h(),e.onRefresh()},[h,e.onRefresh]),O=k.useCallback(()=>{n({to:"/sessions/$sessionId/files",params:{sessionId:e.session.id}})},[n,e.session.id]),j=k.useCallback(()=>{n({to:"/sessions/$sessionId/terminal",params:{sessionId:e.session.id}})},[n,e.session.id]),$=k.useCallback((B,W)=>{e.onSend(B,W),a(q=>q+1)},[e.onSend]),V=k.useMemo(()=>{if(e.session.active)return Sme(e.api,e.session.id)},[e.api,e.session.id,e.session.active]),H=yme({session:e.session,blocks:T.blocks,isSending:e.isSending,onSendMessage:$,onAbort:I,attachmentAdapter:V,allowSendWhenInactive:!0});return g.jsxs("div",{className:"flex h-full flex-col",children:[g.jsx(Nme,{session:e.session,onBack:e.onBack,onViewFiles:e.session.metadata?.path?O:void 0,api:e.api,onSessionDeleted:e.onBack}),i?g.jsx("div",{className:"px-3 pt-3",children:g.jsx("div",{className:"mx-auto w-full max-w-content rounded-md bg-[var(--app-subtle-bg)] p-3 text-sm text-[var(--app-hint)]",children:"Session is inactive. Sending will resume it automatically."})}):null,g.jsx(jZ,{runtime:H,children:g.jsxs("div",{className:"relative flex min-h-0 flex-1 flex-col",children:[g.jsx(fme,{api:e.api,sessionId:e.session.id,metadata:e.session.metadata,disabled:i,onRefresh:e.onRefresh,onRetryMessage:e.onRetryMessage,onFlushPending:e.onFlushPending,onAtBottomChange:e.onAtBottomChange,isLoadingMessages:e.isLoadingMessages,messagesWarning:e.messagesWarning,hasMoreMessages:e.hasMoreMessages,isLoadingMoreMessages:e.isLoadingMoreMessages,onLoadMore:e.onLoadMore,pendingCount:e.pendingCount,rawMessagesCount:e.messages.length,normalizedMessagesCount:E.length,messagesVersion:e.messagesVersion,forceScrollToken:o},e.session.id),g.jsx(Kte,{disabled:e.isSending,permissionMode:e.session.permissionMode,modelMode:e.session.modelMode,agentFlavor:c,active:e.session.active,allowSendWhenInactive:!0,thinking:e.session.thinking,agentState:e.session.agentState,contextSize:A.latestUsage?.contextSize,controlledByUser:e.session.agentState?.controlledByUser===!0,onPermissionModeChange:L,onModelModeChange:P,onSwitchToRemote:N,onTerminal:e.session.active?j:void 0,autocompleteSuggestions:e.autocompleteSuggestions,voiceStatus:y?.status,voiceMicMuted:y?.micMuted,onVoiceToggle:y?w:void 0,onVoiceMicToggle:y?M:void 0})]})}),y&&g.jsx(QG,{api:e.api,micMuted:y.micMuted,onStatusChange:y.setStatus})]})}function K4(e){const{onLongPress:t,onClick:n,threshold:i=500,disabled:s=!1}=e,r=k.useRef(null),o=k.useRef(!1),a=k.useRef(!1),c=k.useRef({x:0,y:0}),u=k.useCallback(()=>{r.current&&(clearTimeout(r.current),r.current=null)},[]),h=k.useCallback((E,A)=>{s||(u(),o.current=!1,a.current=!1,c.current={x:E,y:A},r.current=setTimeout(()=>{o.current=!0,t(c.current)},i))},[s,u,t,i]),f=k.useCallback(E=>{u(),E&&!o.current&&!a.current&&n&&n(),o.current=!1,a.current=!1},[u,n]),m=k.useCallback(E=>{E.button===0&&h(E.clientX,E.clientY)},[h]),y=k.useCallback(()=>{f(!o.current)},[f]),b=k.useCallback(()=>{f(!1)},[f]),S=k.useCallback(E=>{const A=E.touches[0];h(A.clientX,A.clientY)},[h]),_=k.useCallback(E=>{o.current&&E.preventDefault(),f(!o.current)},[f]),w=k.useCallback(()=>{a.current=!0,u()},[u]),M=k.useCallback(E=>{s||(E.preventDefault(),u(),o.current=!0,t({x:E.clientX,y:E.clientY}))},[s,u,t]),R=k.useCallback(E=>{s||(E.key==="Enter"||E.key===" ")&&(E.preventDefault(),n?.())},[s,n]);return{onMouseDown:m,onMouseUp:y,onMouseLeave:b,onTouchStart:S,onTouchEnd:_,onTouchMove:w,onContextMenu:M,onKeyDown:R}}function Dme(e){if(e==="Other")return e;const t=e.split(/[\\/]+/).filter(Boolean);return t.length===0?e:t.length===1?t[0]:`${t[t.length-2]}/${t[t.length-1]}`}function Ome(e){const t=new Map;return e.forEach(n=>{const i=n.metadata?.worktree?.basePath??n.metadata?.path??"Other";t.has(i)||t.set(i,[]),t.get(i).push(n)}),Array.from(t.entries()).map(([n,i])=>{const s=[...i].sort((c,u)=>{const h=c.active?c.pendingRequestsCount>0?0:1:2,f=u.active?u.pendingRequestsCount>0?0:1:2;return h!==f?h-f:u.updatedAt-c.updatedAt}),r=i.reduce((c,u)=>u.updatedAt>c?u.updatedAt:c,-1/0),o=i.some(c=>c.active),a=Dme(n);return{directory:n,displayName:a,sessions:s,latestUpdatedAt:r,hasActiveSession:o}}).sort((n,i)=>n.hasActiveSession!==i.hasActiveSession?n.hasActiveSession?-1:1:i.latestUpdatedAt-n.latestUpdatedAt)}function jme(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[g.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),g.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}function Bme(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[g.jsx("path",{d:"M9 18h6"}),g.jsx("path",{d:"M10 22h4"}),g.jsx("path",{d:"M12 2a7 7 0 0 0-4 12c.6.6 1 1.2 1 2h6c0-.8.4-1.4 1-2a7 7 0 0 0-4-12Z"})]})}function Fme(e){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`${e.className??""} transition-transform duration-200 ${e.collapsed?"":"rotate-90"}`,children:g.jsx("polyline",{points:"9 18 15 12 9 6"})})}function Ume(e){if(e.metadata?.name)return e.metadata.name;if(e.metadata?.summary?.text)return e.metadata.summary.text;if(e.metadata?.path){const t=e.metadata.path.split("/").filter(Boolean);return t.length>0?t[t.length-1]:e.id.slice(0,8)}return e.id.slice(0,8)}function zme(e){return!e.todoProgress||e.todoProgress.completed===e.todoProgress.total?null:e.todoProgress}function $me(e){const t=e.metadata?.flavor?.trim();return t||"unknown"}function qme(e,t){const n=e<1e12?e*1e3:e;if(!Number.isFinite(n))return null;const i=Date.now()-n;if(i<6e4)return t("session.time.justNow");const s=Math.floor(i/6e4);if(s<60)return t("session.time.minutesAgo",{n:s});const r=Math.floor(s/60);if(r<24)return t("session.time.hoursAgo",{n:r});const o=Math.floor(r/24);return o<7?t("session.time.daysAgo",{n:o}):new Date(n).toLocaleDateString()}function Hme(e){const{t}=rt(),{session:n,onSelect:i,showPath:s=!0,api:r,selected:o=!1}=e,{haptic:a}=Yr(),c=(()=>{const N=n.metadata?.flavor?.trim()??"";if(N==="claude")return{label:t("session.item.modelMode"),value:n.modelMode||"default"};const O=n.metadata?.model?.trim()||(N==="codex"||N==="gemini"?G4(n.id)?.model:void 0);return N==="codex"||N==="gemini"||O?{label:t("session.item.model"),value:O||"auto"}:null})(),[u,h]=k.useState(!1),[f,m]=k.useState({x:0,y:0}),[y,b]=k.useState(!1),[S,_]=k.useState(!1),[w,M]=k.useState(!1),{archiveSession:R,renameSession:E,deleteSession:A,isPending:T}=k1(r,n.id,n.metadata?.flavor??null),L=K4({onLongPress:N=>{a.impact("medium"),m(N),h(!0)},onClick:()=>{u||i(n.id)},threshold:500}),P=Ume(n),I=n.active?n.thinking?"bg-[#007AFF]":"bg-[var(--app-badge-success-text)]":"bg-[var(--app-hint)]";return g.jsxs(g.Fragment,{children:[g.jsxs("button",{type:"button",...L,className:`session-list-item flex w-full flex-col gap-1.5 px-3 py-3 text-left transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-link)] select-none ${o?"bg-[var(--app-secondary-bg)]":""}`,style:{WebkitTouchCallout:"none"},"aria-current":o?"page":void 0,children:[g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[g.jsx("span",{className:"flex h-4 w-4 items-center justify-center","aria-hidden":"true",children:g.jsx("span",{className:`h-2 w-2 rounded-full ${I}`})}),g.jsx("div",{className:"truncate text-base font-medium",children:P})]}),g.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs",children:[n.thinking?g.jsx("span",{className:"text-[#007AFF] animate-pulse",children:t("session.item.thinking")}):null,(()=>{const N=zme(n);return N?g.jsxs("span",{className:"flex items-center gap-1 text-[var(--app-hint)]",children:[g.jsx(Bme,{className:"h-3 w-3"}),N.completed,"/",N.total]}):null})(),n.pendingRequestsCount>0?g.jsxs("span",{className:"text-[var(--app-badge-warning-text)]",children:[t("session.item.pending")," ",n.pendingRequestsCount]}):null,g.jsx("span",{className:"text-[var(--app-hint)]",children:qme(n.updatedAt,t)})]})]}),s?g.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:n.metadata?.path??n.id}):null,g.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-[var(--app-hint)]",children:[g.jsxs("span",{className:"inline-flex items-center gap-2",children:[g.jsx("span",{className:"flex h-4 w-4 items-center justify-center","aria-hidden":"true",children:""}),$me(n)]}),c?g.jsxs("span",{children:[c.label,": ",c.value]}):null,n.metadata?.worktree?.branch?g.jsxs("span",{children:[t("session.item.worktree"),": ",n.metadata.worktree.branch]}):null]})]}),g.jsx(q4,{isOpen:u,onClose:()=>h(!1),sessionActive:n.active,onRename:()=>b(!0),onArchive:()=>_(!0),onDelete:()=>M(!0),anchorPoint:f}),g.jsx(H4,{isOpen:y,onClose:()=>b(!1),currentName:P,onRename:E,isPending:T}),g.jsx(Bv,{isOpen:S,onClose:()=>_(!1),title:t("dialog.archive.title"),description:t("dialog.archive.description",{name:P}),confirmLabel:t("dialog.archive.confirm"),confirmingLabel:t("dialog.archive.confirming"),onConfirm:R,isPending:T,destructive:!0}),g.jsx(Bv,{isOpen:w,onClose:()=>M(!1),title:t("dialog.delete.title"),description:t("dialog.delete.description",{name:P}),confirmLabel:t("dialog.delete.confirm"),confirmingLabel:t("dialog.delete.confirming"),onConfirm:A,isPending:T,destructive:!0})]})}function Vme(e){const{t}=rt(),{renderHeader:n=!0,api:i,selectedSessionId:s}=e,r=k.useMemo(()=>Ome(e.sessions),[e.sessions]),[o,a]=k.useState(()=>new Map),c=h=>{const f=o.get(h.directory);return f!==void 0?f:!h.hasActiveSession},u=(h,f)=>{a(m=>{const y=new Map(m);return y.set(h,!f),y})};return k.useEffect(()=>{a(h=>{if(h.size===0)return h;const f=new Map(h),m=new Set(r.map(b=>b.directory));let y=!1;for(const b of f.keys())m.has(b)||(f.delete(b),y=!0);return y?f:h})},[r]),g.jsxs("div",{className:"mx-auto w-full max-w-content flex flex-col",children:[n?g.jsxs("div",{className:"flex items-center justify-between px-3 py-1",children:[g.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:t("sessions.count",{n:e.sessions.length,m:r.length})}),g.jsx("button",{type:"button",onClick:e.onNewSession,className:"session-list-new-button p-1.5 rounded-full text-[var(--app-link)] transition-colors",title:t("sessions.new"),children:g.jsx(jme,{className:"h-5 w-5"})})]}):null,g.jsx("div",{className:"flex flex-col",children:r.map(h=>{const f=c(h);return g.jsxs("div",{children:[g.jsxs("button",{type:"button",onClick:()=>u(h.directory,f),className:"sticky top-0 z-10 flex w-full items-center gap-2 px-3 py-2 text-left bg-[var(--app-bg)] border-b border-[var(--app-divider)] transition-colors hover:bg-[var(--app-secondary-bg)]",children:[g.jsx(Fme,{className:"h-4 w-4 text-[var(--app-hint)]",collapsed:f}),g.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[g.jsx("span",{className:"font-medium text-base break-words",title:h.directory,children:h.displayName}),g.jsxs("span",{className:"shrink-0 text-xs text-[var(--app-hint)]",children:["(",h.sessions.length,")"]})]})]}),f?null:g.jsx("div",{className:"flex flex-col divide-y divide-[var(--app-divider)] border-b border-[var(--app-divider)]",children:h.sessions.map(m=>g.jsx(Hme,{session:m,onSelect:e.onSelect,showPath:!1,api:i,selected:m.id===s},m.id))})]},h.directory)})})]})}function Wme(e){const t=jo(),n=wo({mutationFn:async i=>{if(!e)throw new Error("API unavailable");return await e.spawnSession(i.machineId,i.directory,i.agent,i.model,i.yolo,i.sessionType,i.worktreeName)},onSuccess:()=>{t.invalidateQueries({queryKey:Xt.sessions})}});return{spawnSession:n.mutateAsync,isPending:n.isPending,error:n.error instanceof Error?n.error.message:n.error?"Failed to spawn session":null}}function Y4(e){const t=Fr({queryKey:Xt.sessions,queryFn:async()=>{if(!e)throw new Error("API unavailable");return await e.getSessions()},enabled:!!e});return{sessions:t.data?.sessions??[],isLoading:t.isLoading,error:t.error instanceof Error?t.error.message:t.error?"Failed to load sessions":null,refetch:t.refetch}}function Gme(e,t,n){return k.useMemo(()=>{const i=e?t.filter(u=>u.metadata?.machineId===e):t,s=i.map(u=>u.metadata?.path).filter(u=>!!u),r=i.map(u=>u.metadata?.worktree?.basePath).filter(u=>!!u),o=[...new Set(n)],a=new Set(o),c=[...new Set([...s,...r])].filter(u=>!a.has(u)).sort((u,h)=>u.localeCompare(h));return[...o,...c]},[e,t,n])}const X4="hapi:recentPaths",Kme=5;function Yme(){try{const e=localStorage.getItem(X4);return e?JSON.parse(e):{}}catch{return{}}}function Xme(e){try{localStorage.setItem(X4,JSON.stringify(e))}catch{}}function Qme(){const[e,t]=k.useState(Yme),n=k.useCallback(o=>o?e[o]??[]:[],[e]),i=k.useCallback((o,a)=>{const c=a.trim();c&&t(u=>{const f=(u[o]??[]).filter(b=>b!==c),m=[c,...f].slice(0,Kme),y={...u,[o]:m};return Xme(y),y})},[]),s=k.useCallback(()=>{try{return localStorage.getItem("hapi:lastMachineId")}catch{return null}},[]),r=k.useCallback(o=>{try{localStorage.setItem("hapi:lastMachineId",o)}catch{}},[]);return k.useMemo(()=>({getRecentPaths:n,addRecentPath:i,getLastUsedMachineId:s,setLastUsedMachineId:r}),[n,i,s,r])}function Jme(e){const{t}=rt();return g.jsxs("div",{className:"flex gap-2 px-3 py-3",children:[g.jsx(Xn,{variant:"secondary",onClick:e.onCancel,disabled:e.isDisabled,children:t("button.cancel")}),g.jsx(Xn,{onClick:e.onCreate,disabled:!e.canCreate,"aria-busy":e.isPending,className:"gap-2",children:e.isPending?g.jsxs(g.Fragment,{children:[g.jsx(Bo,{size:"sm",label:null,className:"text-[var(--app-button-text)]"}),t("newSession.creating")]}):t("newSession.create")})]})}function Zme(e){const{t}=rt();return g.jsxs("div",{className:"flex flex-col gap-1.5 px-3 py-3",children:[g.jsx("label",{className:"text-xs font-medium text-[var(--app-hint)]",children:t("newSession.agent")}),g.jsx("div",{className:"flex gap-3",children:["claude","codex","gemini","opencode"].map(n=>g.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[g.jsx("input",{type:"radio",name:"agent",value:n,checked:e.agent===n,onChange:()=>e.onAgentChange(n),disabled:e.isDisabled,className:"accent-[var(--app-link)]"}),g.jsx("span",{className:"text-sm capitalize",children:n})]},n))})]})}function ege(e){const{t}=rt();return g.jsxs("div",{className:"flex flex-col gap-1.5 px-3 py-3",children:[g.jsx("label",{className:"text-xs font-medium text-[var(--app-hint)]",children:t("newSession.directory")}),g.jsxs("div",{className:"relative",children:[g.jsx("input",{type:"text",placeholder:t("newSession.placeholder"),value:e.directory,onChange:n=>e.onDirectoryChange(n.target.value),onKeyDown:e.onDirectoryKeyDown,onFocus:e.onDirectoryFocus,onBlur:e.onDirectoryBlur,disabled:e.isDisabled,className:"w-full rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] p-2 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--app-link)] disabled:opacity-50"}),e.suggestions.length>0&&g.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1",children:g.jsx(ew,{maxHeight:200,children:g.jsx(S3,{suggestions:e.suggestions,selectedIndex:e.selectedIndex,onSelect:e.onSuggestionSelect})})})]}),e.recentPaths.length>0&&g.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[g.jsxs("span",{className:"text-xs text-[var(--app-hint)]",children:[t("newSession.recent"),":"]}),g.jsx("div",{className:"flex flex-wrap gap-1",children:e.recentPaths.map(n=>g.jsx("button",{type:"button",onClick:()=>e.onPathClick(n),disabled:e.isDisabled,className:"rounded bg-[var(--app-subtle-bg)] px-2 py-1 text-xs text-[var(--app-fg)] hover:bg-[var(--app-secondary-bg)] transition-colors truncate max-w-[200px] disabled:opacity-50",title:n,children:n},n))})]})]})}function tge(e){return e.metadata?.displayName?e.metadata.displayName:e.metadata?.host?e.metadata.host:e.id.slice(0,8)}function nge(e){const{t}=rt();return g.jsxs("div",{className:"flex flex-col gap-1.5 px-3 py-3",children:[g.jsx("label",{className:"text-xs font-medium text-[var(--app-hint)]",children:t("newSession.machine")}),g.jsxs("select",{value:e.machineId??"",onChange:n=>e.onChange(n.target.value),disabled:e.isDisabled,className:"w-full rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] p-2 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--app-link)] disabled:opacity-50",children:[e.isLoading&&g.jsx("option",{value:"",children:t("loading.machines")}),!e.isLoading&&e.machines.length===0&&g.jsx("option",{value:"",children:t("misc.noMachines")}),e.machines.map(n=>g.jsxs("option",{value:n.id,children:[tge(n),n.metadata?.platform?` (${n.metadata.platform})`:""]},n.id))]})]})}const ige={claude:[{value:"auto",label:"Auto"},{value:"opus",label:"Opus"},{value:"sonnet",label:"Sonnet"}],codex:[{value:"auto",label:"Auto"},{value:"gpt-5.2-codex",label:"GPT-5.2 Codex"},{value:"gpt-5.2",label:"GPT-5.2"},{value:"gpt-5.1-codex-max",label:"GPT-5.1 Codex Max"},{value:"gpt-5.1-codex-mini",label:"GPT-5.1 Codex Mini"}],gemini:[{value:"auto",label:"Auto"},{value:"gemini-3.1-pro-preview",label:"Gemini 3.1 Pro Preview"},{value:"gemini-2.5-pro",label:"Gemini 2.5 Pro"},{value:"gemini-2.5-flash",label:"Gemini 2.5 Flash"}],opencode:[]};function sge(e){const{t}=rt(),n=ige[e.agent];return n.length===0?null:g.jsxs("div",{className:"flex flex-col gap-1.5 px-3 py-3",children:[g.jsxs("label",{className:"text-xs font-medium text-[var(--app-hint)]",children:[t("newSession.model")," ",g.jsxs("span",{className:"font-normal",children:["(",t("newSession.model.optional"),")"]})]}),g.jsx("select",{value:e.model,onChange:i=>e.onModelChange(i.target.value),disabled:e.isDisabled,className:"w-full px-3 py-2 text-sm rounded-lg border border-[var(--app-divider)] bg-[var(--app-bg)] text-[var(--app-text)] focus:outline-none focus:ring-2 focus:ring-[var(--app-link)] disabled:opacity-50",children:n.map(i=>g.jsx("option",{value:i.value,children:i.label},i.value))})]})}const Q4="hapi:newSession:agent",J4="hapi:newSession:yolo",rge=["claude","codex","gemini","opencode"];function oge(){try{const e=localStorage.getItem(Q4);if(e&&rge.includes(e))return e}catch{}return"claude"}function age(e){try{localStorage.setItem(Q4,e)}catch{}}function lge(){try{return localStorage.getItem(J4)==="true"}catch{return!1}}function cge(e){try{localStorage.setItem(J4,e?"true":"false")}catch{}}function uge(e){const{t}=rt();return g.jsxs("div",{className:"flex flex-col gap-1.5 px-3 py-3",children:[g.jsx("label",{className:"text-xs font-medium text-[var(--app-hint)]",children:t("newSession.type")}),g.jsx("div",{className:"flex flex-col gap-1.5",children:["simple","worktree"].map(n=>g.jsx("div",{className:"flex flex-col gap-2",children:n==="worktree"?g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("input",{id:"session-type-worktree",type:"radio",name:"sessionType",value:"worktree",checked:e.sessionType==="worktree",onChange:()=>e.onSessionTypeChange("worktree"),disabled:e.isDisabled,className:"accent-[var(--app-link)]"}),g.jsx("div",{className:"flex-1",children:g.jsx("div",{className:"min-h-[34px] flex items-center",children:e.sessionType==="worktree"?g.jsx("input",{ref:e.worktreeInputRef,type:"text",placeholder:t("newSession.type.worktree.placeholder"),value:e.worktreeName,onChange:i=>e.onWorktreeNameChange(i.target.value),disabled:e.isDisabled,className:"w-full rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--app-link)] disabled:opacity-60"}):g.jsxs(g.Fragment,{children:[g.jsx("label",{htmlFor:"session-type-worktree",className:"text-sm capitalize cursor-pointer",children:t("newSession.type.worktree")}),g.jsx("span",{className:"ml-2 text-xs text-[var(--app-hint)]",children:t("newSession.type.worktree.desc")})]})})})]}):g.jsxs("label",{className:"flex items-center gap-2 cursor-pointer min-h-[34px]",children:[g.jsx("input",{id:"session-type-simple",type:"radio",name:"sessionType",value:"simple",checked:e.sessionType==="simple",onChange:()=>e.onSessionTypeChange("simple"),disabled:e.isDisabled,className:"accent-[var(--app-link)]"}),g.jsx("span",{className:"text-sm capitalize",children:t("newSession.type.simple")}),g.jsx("span",{className:"text-xs text-[var(--app-hint)]",children:t("newSession.type.simple.desc")})]})},n))})]})}function dge(e){const{t}=rt();return g.jsxs("div",{className:"flex flex-col gap-1.5 px-3 py-3",children:[g.jsx("label",{className:"text-xs font-medium text-[var(--app-hint)]",children:t("newSession.yolo")}),g.jsxs("div",{className:"flex items-center justify-between gap-3",children:[g.jsxs("div",{className:"flex flex-col",children:[g.jsx("span",{className:"text-sm text-[var(--app-fg)]",children:t("newSession.yolo.title")}),g.jsx("span",{className:"text-xs text-[var(--app-hint)]",children:t("newSession.yolo.desc")})]}),g.jsxs("label",{className:"relative inline-flex h-5 w-9 items-center",children:[g.jsx("input",{type:"checkbox",checked:e.yoloMode,onChange:n=>e.onToggle(n.target.checked),disabled:e.isDisabled,className:"peer sr-only"}),g.jsx("span",{className:"absolute inset-0 rounded-full bg-[var(--app-border)] transition-colors peer-checked:bg-[var(--app-link)] peer-disabled:opacity-50"}),g.jsx("span",{className:"absolute left-0.5 h-4 w-4 rounded-full bg-[var(--app-bg)] transition-transform peer-checked:translate-x-4 peer-disabled:opacity-50"})]})]})]})}function hge(e){const{haptic:t}=Yr(),{spawnSession:n,isPending:i,error:s}=Wme(e.api),{sessions:r}=Y4(e.api),o=!!(i||e.isLoading),{getRecentPaths:a,addRecentPath:c,getLastUsedMachineId:u,setLastUsedMachineId:h}=Qme(),[f,m]=k.useState(null),[y,b]=k.useState(""),[S,_]=k.useState(!1),[w,M]=k.useState(!1),[R,E]=k.useState({}),[A,T]=k.useState(oge),[L,P]=k.useState("auto"),[I,N]=k.useState(lge),[O,j]=k.useState("simple"),[$,V]=k.useState(""),[H,B]=k.useState(null),W=k.useRef(null);k.useEffect(()=>{O==="worktree"&&W.current?.focus()},[O]),k.useEffect(()=>{P("auto")},[A]),k.useEffect(()=>{age(A)},[A]),k.useEffect(()=>{cge(I)},[I]),k.useEffect(()=>{if(e.machines.length===0||f&&e.machines.find(De=>De.id===f))return;const Be=u(),ot=Be?e.machines.find(De=>De.id===Be):null;if(ot){m(ot.id);const De=a(ot.id);De[0]&&b(De[0])}else e.machines[0]&&m(e.machines[0].id)},[e.machines,f,u,a]);const q=k.useMemo(()=>a(f),[a,f]),ne=Gme(f,r,q),z=k.useMemo(()=>Array.from(new Set(ne)).slice(0,1e3),[ne]);k.useEffect(()=>{let Be=!1;return!f||z.length===0?(E({}),()=>{Be=!0}):(e.api.checkMachinePathsExists(f,z).then(ot=>{Be||E(ot.exists??{})}).catch(()=>{Be||E({})}),()=>{Be=!0})},[f,z,e.api]);const G=k.useMemo(()=>ne.filter(Be=>R[Be]),[ne,R]),J=k.useCallback(async Be=>{const ot=Be.toLowerCase();return G.filter(De=>De.toLowerCase().includes(ot)).slice(0,8).map(De=>({key:De,text:De,label:De}))},[G]),U=!w||S?null:y,[re,de,ce,ae,be]=y3(U,J,{allowEmptyQuery:!0,autoSelectFirst:!1}),Ce=k.useCallback(Be=>{m(Be);const ot=a(Be);ot[0]?b(ot[0]):b("")},[a]),qe=k.useCallback(Be=>{b(Be)},[]),dt=k.useCallback(Be=>{const ot=re[Be];ot&&(b(ot.text),be(),_(!0))},[re,be]),yt=k.useCallback(Be=>{_(!1),b(Be)},[]),He=k.useCallback(()=>{_(!1),M(!0)},[]),We=k.useCallback(()=>{M(!1)},[]),Jn=k.useCallback(Be=>{re.length!==0&&(Be.key==="ArrowUp"&&(Be.preventDefault(),ce()),Be.key==="ArrowDown"&&(Be.preventDefault(),ae()),(Be.key==="Enter"||Be.key==="Tab")&&de>=0&&(Be.preventDefault(),dt(de)),Be.key==="Escape"&&be())},[re,de,ce,ae,be,dt]);async function Fn(){if(!(!f||!y.trim())){B(null);try{const Be=L!=="auto"&&A!=="opencode"?L:void 0,ot=await n({machineId:f,directory:y.trim(),agent:A,model:Be,yolo:I,sessionType:O,worktreeName:O==="worktree"&&$.trim()||void 0});if(ot.type==="success"){t.notification("success"),h(f),c(f,y.trim()),Mme(ot.sessionId,{agent:A,model:L}),e.onSuccess(ot.sessionId);return}t.notification("error"),B(ot.message)}catch(Be){t.notification("error"),B(Be instanceof Error?Be.message:"Failed to create session")}}}const li=!!(f&&y.trim()&&!o);return g.jsxs("div",{className:"flex flex-col divide-y divide-[var(--app-divider)]",children:[g.jsx(nge,{machines:e.machines,machineId:f,isLoading:e.isLoading,isDisabled:o,onChange:Ce}),g.jsx(ege,{directory:y,suggestions:re,selectedIndex:de,isDisabled:o,recentPaths:q,onDirectoryChange:yt,onDirectoryFocus:He,onDirectoryBlur:We,onDirectoryKeyDown:Jn,onSuggestionSelect:dt,onPathClick:qe}),g.jsx(uge,{sessionType:O,worktreeName:$,worktreeInputRef:W,isDisabled:o,onSessionTypeChange:j,onWorktreeNameChange:V}),g.jsx(Zme,{agent:A,isDisabled:o,onAgentChange:T}),g.jsx(sge,{agent:A,model:L,isDisabled:o,onModelChange:P}),g.jsx(dge,{yoloMode:I,isDisabled:o,onToggle:N}),H??s?g.jsx("div",{className:"px-3 py-2 text-sm text-red-600",children:H??s}):null,g.jsx(Jme,{isPending:i,canCreate:li,isDisabled:o,onCancel:e.onCancel,onCreate:Fn})]})}const $I={sessionId:"unknown",messages:[],pending:[],pendingCount:0,hasMore:!1,oldestSeq:null,newestSeq:null,isLoading:!1,isLoadingMore:!1,warning:null,atBottom:!0,messagesVersion:0};function fge(e,t){const n=k.useSyncExternalStore(k.useCallback(a=>t?HH(t,a):()=>{},[t]),k.useCallback(()=>t?HD(t):$I,[t]),()=>$I);k.useEffect(()=>{!e||!t||Nh(e,t)},[e,t]),k.useEffect(()=>{if(t)return()=>{FC(t)}},[t]);const i=k.useCallback(async()=>{!e||!t||!n.hasMore||n.isLoadingMore||await WH(e,t)},[e,t,n.hasMore,n.isLoadingMore]),s=k.useCallback(async()=>{!e||!t||await Nh(e,t)},[e,t]),r=k.useCallback(async()=>{if(!t)return;KH(t)&&e&&await Nh(e,t)},[e,t]),o=k.useCallback(a=>{t&&YH(t,a)},[t]);return{messages:n.messages,warning:n.warning,isLoading:n.isLoading,isLoadingMore:n.isLoadingMore,hasMore:n.hasMore,pendingCount:n.pendingCount,messagesVersion:n.messagesVersion,loadMore:i,refetch:s,flushPending:r,setAtBottom:o}}function pge(e,t){const n=Fr({queryKey:Xt.machines,queryFn:async()=>{if(!e)throw new Error("API unavailable");return await e.getMachines()},enabled:!!(e&&t)});return{machines:n.data?.machines??[],isLoading:n.isLoading,error:n.error instanceof Error?n.error.message:n.error?"Failed to load machines":null,refetch:n.refetch}}function T1(e,t){const n=t??"unknown",i=Fr({queryKey:Xt.session(n),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");return await e.getSession(t)},enabled:!!(e&&t)});return{session:i.data?.session??null,isLoading:i.isLoading,error:i.error instanceof Error?i.error.message:i.error?"Failed to load session":null,refetch:i.refetch}}function mge(e,t){if(e.length===0)return t.length;if(t.length===0)return e.length;const n=[];for(let i=0;i<=t.length;i++)n[i]=[i];for(let i=0;i<=e.length;i++)n[0][i]=i;for(let i=1;i<=t.length;i++)for(let s=1;s<=e.length;s++)n[i][s]=t[i-1]===e[s-1]?n[i-1][s-1]:Math.min(n[i-1][s-1]+1,n[i][s-1]+1,n[i-1][s]+1);return n[t.length][e.length]}const qI={claude:[{name:"clear",description:"Clear conversation history and free up context",source:"builtin"},{name:"compact",description:"Clear conversation history but keep a summary in context",source:"builtin"},{name:"context",description:"Visualize current context usage as a colored grid",source:"builtin"},{name:"cost",description:"Show the total cost and duration of the current session",source:"builtin"},{name:"doctor",description:"Diagnose and verify your Claude Code installation and settings",source:"builtin"},{name:"plan",description:"View or open the current session plan",source:"builtin"},{name:"stats",description:"Show your Claude Code usage statistics and activity",source:"builtin"},{name:"status",description:"Show Claude Code status including version, model, account, and API connectivity",source:"builtin"}],codex:[{name:"review",description:"Review current changes and find issues",source:"builtin"},{name:"new",description:"Start a new chat during a conversation",source:"builtin"},{name:"compat",description:"Summarize conversation to prevent hitting the context limit",source:"builtin"},{name:"undo",description:"Ask Codex to undo a turn",source:"builtin"},{name:"diff",description:"Show git diff including untracked files",source:"builtin"},{name:"status",description:"Show current session configuration and token usage",source:"builtin"}],gemini:[{name:"about",description:"Show version info",source:"builtin"},{name:"clear",description:"Clear the screen and conversation history",source:"builtin"},{name:"compress",description:"Compress the context by replacing it with a summary",source:"builtin"},{name:"stats",description:"Check session stats",source:"builtin"}],opencode:[]};function gge(e,t,n="claude"){const i=t??"unknown",s=Fr({queryKey:Xt.slashCommands(i),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");return await e.getSlashCommands(t)},enabled:!!(e&&t),staleTime:1/0,gcTime:1800*1e3,retry:!1}),r=k.useMemo(()=>{const a=qI[n]??qI.claude??[];if(s.data?.success&&s.data.commands){const c=s.data.commands.filter(u=>u.source==="user"||u.source==="plugin");return[...a,...c]}return a},[n,s.data]),o=k.useCallback(async a=>{const c=a.startsWith("/")?a.slice(1).toLowerCase():a.toLowerCase();if(!c)return r.map(h=>({key:`/${h.name}`,text:`/${h.name}`,label:`/${h.name}`,description:h.description??(h.source==="user"?"Custom command":void 0),content:h.content,source:h.source}));const u=Math.max(2,Math.floor(c.length/2));return r.map(h=>{const f=h.name.toLowerCase();let m;if(f===c)m=0;else if(f.startsWith(c))m=1;else if(f.includes(c))m=2;else{const y=mge(c,f);m=y<=u?3+y:1/0}return{cmd:h,score:m}}).filter(h=>h.score<1/0).sort((h,f)=>h.score-f.score).map(({cmd:h})=>({key:`/${h.name}`,text:`/${h.name}`,label:`/${h.name}`,description:h.description??(h.source==="user"?"Custom command":void 0),content:h.content,source:h.source}))},[r]);return{commands:r,isLoading:s.isLoading,error:s.error instanceof Error?s.error.message:s.error?"Failed to load commands":null,getSuggestions:o}}function vge(e,t){if(e.length===0)return t.length;if(t.length===0)return e.length;const n=[];for(let i=0;i<=t.length;i++)n[i]=[i];for(let i=0;i<=e.length;i++)n[0][i]=i;for(let i=1;i<=t.length;i++)for(let s=1;s<=e.length;s++)n[i][s]=t[i-1]===e[s-1]?n[i-1][s-1]:Math.min(n[i-1][s-1]+1,n[i][s-1]+1,n[i-1][s]+1);return n[t.length][e.length]}function yge(e,t){const n=t??"unknown",i=Fr({queryKey:Xt.skills(n),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");return await e.getSkills(t)},enabled:!!(e&&t),staleTime:1/0,gcTime:1800*1e3,retry:!1}),s=k.useMemo(()=>i.data?.success&&i.data.skills?i.data.skills:[],[i.data]),r=k.useCallback(async o=>{const a=_3(),c=f=>a[f]??0,u=o.startsWith("$")?o.slice(1).toLowerCase():o.toLowerCase();if(!u)return[...s].sort((f,m)=>c(m.name)-c(f.name)||f.name.localeCompare(m.name)).map(f=>({key:`$${f.name}`,text:`$${f.name}`,label:`$${f.name}`,description:f.description,source:"builtin"}));const h=Math.max(2,Math.floor(u.length/2));return s.map(f=>{const m=f.name.toLowerCase();let y;if(m===u)y=0;else if(m.startsWith(u))y=1;else if(m.includes(u))y=2;else{const b=vge(u,m);y=b<=h?3+b:1/0}return{skill:f,score:y,recency:c(f.name)}}).filter(f=>f.score<1/0).sort((f,m)=>f.score-m.score||m.recency-f.recency||f.skill.name.localeCompare(m.skill.name)).map(({skill:f})=>({key:`$${f.name}`,text:`$${f.name}`,label:`$${f.name}`,description:f.description,source:"builtin"}))},[s]);return{skills:s,isLoading:i.isLoading,error:i.error instanceof Error?i.error.message:i.error?"Failed to load skills":null,getSuggestions:r}}function bge(e,t){const n=HD(e);for(const i of n.messages)if(i.localId===t)return i;for(const i of n.pending)if(i.localId===t)return i;return null}function _ge(e,t,n){const{haptic:i}=Yr(),[s,r]=k.useState(!1),o=k.useRef(!1),a=wo({mutationFn:async h=>{if(!e)throw new Error("API unavailable");await e.sendMessage(h.sessionId,h.text,h.localId,h.attachments)},onMutate:async h=>{const f={id:h.localId,seq:null,localId:h.localId,content:{role:"user",content:{type:"text",text:h.text,attachments:h.attachments}},createdAt:h.createdAt,status:"sending",originalText:h.text};XH(h.sessionId,f)},onSuccess:(h,f)=>{p0(f.sessionId,f.localId,"sent"),i.notification("success")},onError:(h,f)=>{p0(f.sessionId,f.localId,"failed"),i.notification("error")}});return{sendMessage:(h,f)=>{if(!e){n?.onBlocked?.("no-api"),i.notification("error");return}if(!t){n?.onBlocked?.("no-session"),i.notification("error");return}if(a.isPending||o.current){n?.onBlocked?.("pending");return}const m=DH("local"),y=Date.now();(async()=>{let b=t;if(n?.resolveSessionId){o.current=!0,r(!0);try{const S=await n.resolveSessionId(t);S&&S!==t&&(n.onSessionResolved?.(S),b=S)}catch(S){i.notification("error"),console.error("Failed to resolve session before send:",S);return}finally{o.current=!1,r(!1)}}a.mutate({sessionId:b,text:h,localId:m,createdAt:y,attachments:f})})()},retryMessage:h=>{if(!e){n?.onBlocked?.("no-api"),i.notification("error");return}if(!t){n?.onBlocked?.("no-session"),i.notification("error");return}if(a.isPending||o.current){n?.onBlocked?.("pending");return}const f=bge(t,h);f?.originalText&&(p0(t,h,"sending"),a.mutate({sessionId:t,text:f.originalText,localId:h,createdAt:f.createdAt}))},isSending:a.isPending||s}}function Sge(e,t,n,i){const s=t??"unknown",r=!!(e&&t)&&(i?.enabled??!0),o=Fr({queryKey:Xt.sessionDirectory(s,n),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");const c=await e.listSessionDirectory(t,n);return c.success?{entries:c.entries??[],error:null}:{entries:[],error:c.error??"Failed to list directory"}},enabled:r}),a=o.error instanceof Error?o.error.message:o.error?"Failed to list directory":null;return{entries:o.data?.entries??[],error:a??o.data?.error??null,isLoading:o.isLoading,refetch:o.refetch}}function xge(e){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`${e.className??""} transition-transform duration-200 ${e.collapsed?"":"rotate-90"}`,children:g.jsx("polyline",{points:"9 18 15 12 9 6"})})}function wge(e){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:g.jsx("path",{d:"M3 7a2 2 0 0 1 2-2h4l2 2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"})})}function Cge(e){const t=e.rows??4,n=12+e.depth*14;return g.jsx("div",{className:"animate-pulse",children:Array.from({length:t}).map((i,s)=>g.jsxs("div",{className:"flex items-center gap-3 px-3 py-2",style:{paddingLeft:n},children:[g.jsx("div",{className:"h-5 w-5 rounded bg-[var(--app-subtle-bg)]"}),g.jsx("div",{className:"h-3 w-40 rounded bg-[var(--app-subtle-bg)]"})]},`dir-skel-${e.depth}-${s}`))})}function kge(e){const t=12+e.depth*14;return g.jsx("div",{className:"px-3 py-2 text-xs text-[var(--app-hint)] bg-amber-500/10",style:{paddingLeft:t},children:e.message})}function Z4(e){const t=e.expanded.has(e.path),{entries:n,error:i,isLoading:s}=Sge(e.api,e.sessionId,e.path,{enabled:t}),r=k.useMemo(()=>n.filter(h=>h.type==="directory"),[n]),o=k.useMemo(()=>n.filter(h=>h.type==="file"),[n]),a=e.depth+1,c=12+e.depth*14,u=12+a*14;return g.jsxs("div",{children:[g.jsxs("button",{type:"button",onClick:()=>e.onToggle(e.path),className:"flex w-full items-center gap-3 px-3 py-2 text-left hover:bg-[var(--app-subtle-bg)] transition-colors",style:{paddingLeft:c},children:[g.jsx(xge,{collapsed:!t,className:"text-[var(--app-hint)]"}),g.jsx(wge,{className:"text-[var(--app-link)]"}),g.jsx("div",{className:"min-w-0 flex-1",children:g.jsx("div",{className:"truncate font-medium",children:e.label})})]}),t?s?g.jsx(Cge,{depth:a}):i?g.jsx(kge,{depth:a,message:i}):g.jsxs("div",{children:[r.map(h=>{const f=e.path?`${e.path}/${h.name}`:h.name;return g.jsx(Z4,{api:e.api,sessionId:e.sessionId,path:f,label:h.name,depth:a,onOpenFile:e.onOpenFile,expanded:e.expanded,onToggle:e.onToggle},f)}),o.map(h=>{const f=e.path?`${e.path}/${h.name}`:h.name;return g.jsxs("button",{type:"button",onClick:()=>e.onOpenFile(f),className:"flex w-full items-center gap-3 px-3 py-2 text-left hover:bg-[var(--app-subtle-bg)] transition-colors",style:{paddingLeft:u},children:[g.jsx("span",{className:"h-4 w-4"}),g.jsx(Gf,{fileName:h.name,size:22}),g.jsx("div",{className:"min-w-0 flex-1",children:g.jsx("div",{className:"truncate font-medium",children:h.name})})]},f)}),r.length===0&&o.length===0?g.jsx("div",{className:"px-3 py-2 text-sm text-[var(--app-hint)]",style:{paddingLeft:u},children:"Empty directory."}):null]}):null]})}function Tge(e){const[t,n]=k.useState(()=>new Set([""])),i=k.useCallback(s=>{n(r=>{const o=new Set(r);return o.has(s)?o.delete(s):o.add(s),o})},[]);return g.jsx("div",{className:"border-t border-[var(--app-divider)]",children:g.jsx(Z4,{api:e.api,sessionId:e.sessionId,path:"",label:e.rootLabel,depth:0,onOpenFile:e.onOpenFile,expanded:t,onToggle:i})})}const Ege=/^# branch\.oid (.+)$/,Rge=/^# branch\.head (.+)$/,Mge=/^# branch\.upstream (.+)$/,Age=/^# branch\.ab \+(\d+) -(\d+)$/,Pge=/^1 (.)(.) (.{4}) (\d{6}) (\d{6}) (\d{6}) ([0-9a-f]+) ([0-9a-f]+) (.+)$/,Lge=/^2 (.)(.) (.{4}) (\d{6}) (\d{6}) (\d{6}) ([0-9a-f]+) ([0-9a-f]+) ([RC])(\d{1,3}) (.+)\t(.+)$/,Nge=/^u (.)(.) (.{4}) (\d{6}) (\d{6}) (\d{6}) (\d{6}) ([0-9a-f]+) ([0-9a-f]+) ([0-9a-f]+) (.+)$/,Ige=/^\? (.+)$/,Dge=/^! (.+)$/,Oge=/^(\d+|-)\t(\d+|-)\t(.*)$/;function jge(e){const t=e.trim().split(`
`).filter(i=>i.length>0),n={files:[],notAdded:[],ignored:[],branch:{}};for(const i of t){if(i.startsWith("# branch.oid ")){const s=Ege.exec(i);s&&(n.branch.oid=s[1]);continue}if(i.startsWith("# branch.head ")){const s=Rge.exec(i);s&&(n.branch.head=s[1]);continue}if(i.startsWith("# branch.upstream ")){const s=Mge.exec(i);s&&(n.branch.upstream=s[1]);continue}if(i.startsWith("# branch.ab ")){const s=Age.exec(i);s&&(n.branch.ahead=parseInt(s[1],10),n.branch.behind=parseInt(s[2],10));continue}if(i.startsWith("1 ")){const s=Pge.exec(i);if(s){const r=Uge(s);r&&n.files.push(r)}continue}if(i.startsWith("2 ")){const s=Lge.exec(i);if(s){const r=zge(s);r&&n.files.push(r)}continue}if(i.startsWith("u ")){const s=Nge.exec(i);if(s){const r=$ge(s);r&&n.files.push(r)}continue}if(i.startsWith("? ")){const s=Ige.exec(i);s&&n.notAdded.push(s[1]);continue}if(i.startsWith("! ")){const s=Dge.exec(i);s&&n.ignored.push(s[1])}}return n}function HI(e){const t=e.trim().split(`
`).filter(i=>i.length>0),n={files:[],insertions:0,deletions:0,changes:0,changed:0};for(const i of t){const s=Oge.exec(i);if(!s)continue;const r=s[1],o=s[2],a=s[3],c=r==="-"||o==="-",u=c?0:parseInt(r,10),h=c?0:parseInt(o,10),f=u+h;n.files.push({file:a,changes:f,insertions:u,deletions:h,binary:c}),n.insertions+=u,n.deletions+=h,n.changes+=f,n.changed+=1}return n}function VI(e){const t={};for(const n of e.files){const i=qge(n.file),s={added:n.insertions,removed:n.deletions,binary:n.binary};t[n.file]=s,i.newPath&&i.newPath!==n.file&&(t[i.newPath]=s),i.oldPath&&i.oldPath!==n.file&&i.oldPath!==i.newPath&&(t[i.oldPath]=s)}return t}function Bge(e){const t=e.branch.head;return!t||t==="(detached)"||t==="(initial)"?null:t}function Fge(e,t,n){const i=jge(e),s=Bge(i),r=HI(t),o=HI(n),a=VI(r),c=VI(o),u=[],h=[];for(const f of i.files){const m=f.path.split("/"),y=m[m.length-1]||f.path,b=m.slice(0,-1).join("/");if(f.index!==" "&&f.index!=="."&&f.index!=="?"){const S=WI(f.index),_=c[f.path]??{added:0,removed:0};u.push({fileName:y,filePath:b,fullPath:f.path,status:S,isStaged:!0,linesAdded:_.added,linesRemoved:_.removed,oldPath:f.from})}if(f.workingDir!==" "&&f.workingDir!=="."){const S=WI(f.workingDir),_=a[f.path]??{added:0,removed:0};h.push({fileName:y,filePath:b,fullPath:f.path,status:S,isStaged:!1,linesAdded:_.added,linesRemoved:_.removed,oldPath:f.from})}}for(const f of i.notAdded){const m=f.endsWith("/")?f.slice(0,-1):f,y=m.split("/"),b=y[y.length-1]||m,S=y.slice(0,-1).join("/");f.endsWith("/")||h.push({fileName:b,filePath:S,fullPath:m,status:"untracked",isStaged:!1,linesAdded:0,linesRemoved:0})}return{stagedFiles:u,unstagedFiles:h,branch:s,totalStaged:u.length,totalUnstaged:h.length}}function Uge(e){return!e[1]||!e[2]||!e[9]?null:{index:e[1],workingDir:e[2],path:e[9]}}function zge(e){return!e[1]||!e[2]||!e[11]||!e[12]?null:{index:e[1],workingDir:e[2],from:e[11],path:e[12]}}function $ge(e){return!e[1]||!e[2]||!e[11]?null:{index:e[1],workingDir:e[2],path:e[11]}}function WI(e){switch(e){case"M":return"modified";case"A":return"added";case"D":return"deleted";case"R":case"C":return"renamed";case"?":return"untracked";case"U":return"conflicted";default:return"modified"}}function qge(e){const t=e.trim();if(t.includes("{")&&t.includes("=>")&&t.includes("}")){const n=t.replace(/\{([^{}]+?)\s*=>\s*([^{}]+?)\}/g,(s,r,o)=>o.trim()),i=t.replace(/\{([^{}]+?)\s*=>\s*([^{}]+?)\}/g,(s,r)=>r.trim());return{newPath:n,oldPath:i}}if(t.includes("=>")){const n=t.split(/\s*=>\s*/),i=n[0]?.trim(),s=n[n.length-1]?.trim();if(s)return{newPath:s,oldPath:i}}return{newPath:t}}function Hge(e,t){const n=t??"unknown",i=Fr({queryKey:Xt.gitStatus(n),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");const r=await e.getGitStatus(t);if(!r.success)return{status:null,error:r.error??r.stderr??"Git status unavailable"};const[o,a]=await Promise.all([e.getGitDiffNumstat(t,!1),e.getGitDiffNumstat(t,!0)]),c=Fge(r.stdout??"",o.success?o.stdout??"":"",a.success?a.stdout??"":""),u=[];return o.success||u.push(`Unstaged diff unavailable: ${o.error??o.stderr??"unknown error"}`),a.success||u.push(`Staged diff unavailable: ${a.error??a.stderr??"unknown error"}`),{status:c,error:u.length?u.join(" "):null}},enabled:!!(e&&t)}),s=i.error instanceof Error?i.error.message:i.error?"Git status unavailable":null;return{status:i.data?.status??null,error:s??i.data?.error??null,isLoading:i.isLoading,refetch:i.refetch}}function Vge(e,t,n,i){const s=t??"unknown",r=i?.limit??200,o=i?.enabled??!!(e&&t),a=Fr({queryKey:Xt.sessionFiles(s,n),queryFn:async()=>{if(!e||!t)throw new Error("Session unavailable");const u=await e.searchSessionFiles(t,n,r);return u.success?{files:u.files??[],error:null}:{files:[],error:u.error??"Failed to search files"}},enabled:o}),c=a.error instanceof Error?a.error.message:a.error?"Failed to search files":null;return{files:a.data?.files??[],error:c??a.data?.error??null,isLoading:a.isLoading,refetch:a.refetch}}function Wge(e){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:g.jsx("polyline",{points:"15 18 9 12 15 6"})})}function Gge(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[g.jsx("path",{d:"M21 12a9 9 0 1 1-3-6.7"}),g.jsx("polyline",{points:"21 3 21 9 15 9"})]})}function Kge(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[g.jsx("circle",{cx:"11",cy:"11",r:"8"}),g.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}function Yge(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[g.jsx("line",{x1:"6",y1:"3",x2:"6",y2:"15"}),g.jsx("circle",{cx:"6",cy:"18",r:"3"}),g.jsx("circle",{cx:"18",cy:"6",r:"3"}),g.jsx("path",{d:"M18 9a9 9 0 0 1-9 9"})]})}function Xge(e){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:g.jsx("path",{d:"M3 7a2 2 0 0 1 2-2h4l2 2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"})})}function Qge(e){const{label:t,color:n}=k.useMemo(()=>{switch(e.status){case"added":return{label:"A",color:"var(--app-git-staged-color)"};case"deleted":return{label:"D",color:"var(--app-git-deleted-color)"};case"renamed":return{label:"R",color:"var(--app-git-renamed-color)"};case"untracked":return{label:"?",color:"var(--app-git-untracked-color)"};case"conflicted":return{label:"U",color:"var(--app-git-deleted-color)"};default:return{label:"M",color:"var(--app-git-unstaged-color)"}}},[e.status]);return g.jsx("span",{className:"inline-flex items-center justify-center rounded border px-1.5 py-0.5 text-[10px] font-semibold",style:{color:n,borderColor:n},children:t})}function Jge(e){return!e.added&&!e.removed?null:g.jsxs("span",{className:"flex items-center gap-1 text-[11px] font-mono",children:[e.added?g.jsxs("span",{className:"text-[var(--app-diff-added-text)]",children:["+",e.added]}):null,e.removed?g.jsxs("span",{className:"text-[var(--app-diff-removed-text)]",children:["-",e.removed]}):null]})}function GI(e){const t=e.file.filePath||"project root";return g.jsxs("button",{type:"button",onClick:e.onOpen,className:`flex w-full items-center gap-3 px-3 py-2 text-left hover:bg-[var(--app-subtle-bg)] transition-colors ${e.showDivider?"border-b border-[var(--app-divider)]":""}`,children:[g.jsx(Gf,{fileName:e.file.fileName,size:22}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"truncate font-medium",children:e.file.fileName}),g.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:t})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(Jge,{added:e.file.linesAdded,removed:e.file.linesRemoved}),g.jsx(Qge,{status:e.file.status})]})]})}function Zge(e){const t=e.file.filePath||"project root",n=e.file.fileType==="file"?g.jsx(Gf,{fileName:e.file.fileName,size:22}):g.jsx(Xge,{className:"text-[var(--app-link)]"});return g.jsxs("button",{type:"button",onClick:e.onOpen,className:`flex w-full items-center gap-3 px-3 py-2 text-left hover:bg-[var(--app-subtle-bg)] transition-colors ${e.showDivider?"border-b border-[var(--app-divider)]":""}`,children:[n,g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"truncate font-medium",children:e.file.fileName}),g.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:t})]})]})}function KI(e){const t=["w-1/3","w-1/2","w-2/3","w-2/5","w-3/5"],n=["w-1/2","w-2/3","w-3/4","w-1/3"],i=e.rows??6;return g.jsxs("div",{className:"p-3 animate-pulse space-y-3",role:"status","aria-live":"polite",children:[g.jsx("span",{className:"sr-only",children:e.label}),Array.from({length:i}).map((s,r)=>g.jsxs("div",{className:"flex items-center gap-3",children:[g.jsx("div",{className:"h-6 w-6 rounded bg-[var(--app-subtle-bg)]"}),g.jsxs("div",{className:"flex-1 space-y-2",children:[g.jsx("div",{className:`h-3 ${t[r%t.length]} rounded bg-[var(--app-subtle-bg)]`}),g.jsx("div",{className:`h-2 ${n[r%n.length]} rounded bg-[var(--app-subtle-bg)]`})]})]},`skeleton-row-${r}`))]})}function eve(){const{api:e}=Vu(),t=fr(),n=jo(),i=Jl(),{sessionId:s}=$a({from:"/sessions/$sessionId/files"}),r=Nf({from:"/sessions/$sessionId/files"}),{session:o}=T1(e,s),[a,c]=k.useState(""),u=r.tab==="directories"?"directories":"changes",[h,f]=k.useState(u),{status:m,error:y,isLoading:b,refetch:S}=Hge(e,s),_=!!a,w=Vge(e,s,a,{enabled:_}),M=k.useCallback((I,N)=>{const O=N===void 0?h==="directories"?{path:km(I),tab:"directories"}:{path:km(I)}:h==="directories"?{path:km(I),staged:N,tab:"directories"}:{path:km(I),staged:N};t({to:"/sessions/$sessionId/file",params:{sessionId:s},search:O})},[h,t,s]),R=m?.branch??"detached",E=o?.metadata?.path??s,A=!!y,T=k.useMemo(()=>{const I=o?.metadata?.path??s,N=I.split(/[/\\]/).filter(Boolean);return N.length?N[N.length-1]:I},[o?.metadata?.path,s]),L=k.useCallback(()=>{if(a){n.invalidateQueries({queryKey:Xt.sessionFiles(s,a)});return}if(h==="directories"){n.invalidateQueries({queryKey:["session-directory",s]});return}S()},[h,n,S,a,s]),P=k.useCallback(I=>{f(I),t({to:"/sessions/$sessionId/files",params:{sessionId:s},search:I==="changes"?{}:{tab:I},replace:!0})},[t,s]);return g.jsxs("div",{className:"flex h-full flex-col",children:[g.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:g.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center gap-2 p-3 border-b border-[var(--app-border)]",children:[g.jsx("button",{type:"button",onClick:i,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:g.jsx(Wge,{})}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"truncate font-semibold",children:"Files"}),g.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:E})]}),g.jsx("button",{type:"button",onClick:L,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",title:"Refresh",children:g.jsx(Gge,{})})]})}),g.jsx("div",{className:"bg-[var(--app-bg)]",children:g.jsx("div",{className:"mx-auto w-full max-w-content p-3 border-b border-[var(--app-border)]",children:g.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-[var(--app-subtle-bg)] px-3 py-2",children:[g.jsx(Kge,{className:"text-[var(--app-hint)]"}),g.jsx("input",{value:a,onChange:I=>c(I.target.value),placeholder:"Search files",className:"w-full bg-transparent text-sm text-[var(--app-fg)] placeholder:text-[var(--app-hint)] focus:outline-none",autoCapitalize:"none",autoCorrect:"off"})]})})}),g.jsx("div",{className:"bg-[var(--app-bg)] border-b border-[var(--app-divider)]",role:"tablist",children:g.jsxs("div",{className:"mx-auto w-full max-w-content grid grid-cols-2",children:[g.jsxs("button",{type:"button",role:"tab","aria-selected":h==="changes",onClick:()=>P("changes"),className:`relative py-3 text-center text-sm font-semibold transition-colors hover:bg-[var(--app-subtle-bg)] ${h==="changes"?"text-[var(--app-fg)]":"text-[var(--app-hint)]"}`,children:["Changes",g.jsx("span",{className:`absolute bottom-0 left-1/2 h-0.5 w-10 -translate-x-1/2 rounded-full ${h==="changes"?"bg-[var(--app-link)]":"bg-transparent"}`})]}),g.jsxs("button",{type:"button",role:"tab","aria-selected":h==="directories",onClick:()=>P("directories"),className:`relative py-3 text-center text-sm font-semibold transition-colors hover:bg-[var(--app-subtle-bg)] ${h==="directories"?"text-[var(--app-fg)]":"text-[var(--app-hint)]"}`,children:["Directories",g.jsx("span",{className:`absolute bottom-0 left-1/2 h-0.5 w-10 -translate-x-1/2 rounded-full ${h==="directories"?"bg-[var(--app-link)]":"bg-transparent"}`})]})]})}),!b&&m&&!a&&h==="changes"?g.jsx("div",{className:"bg-[var(--app-bg)]",children:g.jsxs("div",{className:"mx-auto w-full max-w-content px-3 py-2 border-b border-[var(--app-divider)]",children:[g.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[g.jsx(Yge,{className:"text-[var(--app-hint)]"}),g.jsx("span",{className:"font-semibold",children:R})]}),g.jsxs("div",{className:"text-xs text-[var(--app-hint)]",children:[m.totalStaged," staged, ",m.totalUnstaged," unstaged"]})]})}):null,g.jsx("div",{className:"flex-1 overflow-y-auto",children:g.jsxs("div",{className:"mx-auto w-full max-w-content",children:[A&&h==="changes"?g.jsx("div",{className:"border-b border-[var(--app-divider)] bg-amber-500/10 px-3 py-2 text-xs text-[var(--app-hint)]",children:y}):null,_?w.isLoading?g.jsx(KI,{label:"Loading files"}):w.error?g.jsx("div",{className:"p-6 text-sm text-[var(--app-hint)]",children:w.error}):w.files.length===0?g.jsx("div",{className:"p-6 text-sm text-[var(--app-hint)]",children:a?"No files match your search.":"No files found in this project."}):g.jsx("div",{className:"border-t border-[var(--app-divider)]",children:w.files.map((I,N)=>g.jsx(Zge,{file:I,onOpen:()=>M(I.fullPath),showDivider:N<w.files.length-1},`${I.fullPath}-${N}`))}):h==="directories"?g.jsx(Tge,{api:e,sessionId:s,rootLabel:T,onOpenFile:I=>M(I)}):b?g.jsx(KI,{label:"Loading Git status"}):g.jsxs("div",{children:[m?.stagedFiles.length?g.jsxs("div",{children:[g.jsxs("div",{className:"border-b border-[var(--app-divider)] bg-[var(--app-bg)] px-3 py-2 text-xs font-semibold text-[var(--app-git-staged-color)]",children:["Staged Changes (",m.stagedFiles.length,")"]}),m.stagedFiles.map((I,N)=>g.jsx(GI,{file:I,onOpen:()=>M(I.fullPath,I.isStaged),showDivider:N<m.stagedFiles.length-1||m.unstagedFiles.length>0},`staged-${I.fullPath}-${N}`))]}):null,m?.unstagedFiles.length?g.jsxs("div",{children:[g.jsxs("div",{className:"border-b border-[var(--app-divider)] bg-[var(--app-bg)] px-3 py-2 text-xs font-semibold text-[var(--app-git-unstaged-color)]",children:["Unstaged Changes (",m.unstagedFiles.length,")"]}),m.unstagedFiles.map((I,N)=>g.jsx(GI,{file:I,onOpen:()=>M(I.fullPath,I.isStaged),showDivider:N<m.unstagedFiles.length-1},`unstaged-${I.fullPath}-${N}`))]}):null,m?null:g.jsx("div",{className:"p-6 text-sm text-[var(--app-hint)]",children:"Git status unavailable. Use Directories to browse all files, or search."}),m&&m.stagedFiles.length===0&&m.unstagedFiles.length===0?g.jsx("div",{className:"p-6 text-sm text-[var(--app-hint)]",children:"No changes detected. Use Directories to browse all files, or search."}):null]})]})})]})}const tve=1e6;function nve(e){if(!e)return"";const t=vj(e);return t.ok?t.text:e}function ive(e){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:g.jsx("polyline",{points:"15 18 9 12 15 6"})})}function sve(e){const t=e.diffContent.split(`
`);return g.jsx("div",{className:"overflow-hidden rounded-md border border-[var(--app-border)] bg-[var(--app-bg)]",children:t.map((n,i)=>{const s=n.startsWith("+")&&!n.startsWith("+++"),r=n.startsWith("-")&&!n.startsWith("---"),o=n.startsWith("@@"),a=n.startsWith("+++")||n.startsWith("---"),c=["whitespace-pre-wrap px-3 py-0.5 text-xs font-mono",s?"bg-[var(--app-diff-added-bg)] text-[var(--app-diff-added-text)]":"",r?"bg-[var(--app-diff-removed-bg)] text-[var(--app-diff-removed-text)]":"",o?"bg-[var(--app-subtle-bg)] text-[var(--app-hint)] font-semibold":"",a?"text-[var(--app-hint)] font-semibold":""].filter(Boolean).join(" "),u=s?{borderLeft:"2px solid var(--app-git-staged-color)"}:r?{borderLeft:"2px solid var(--app-git-deleted-color)"}:void 0;return g.jsx("div",{className:c,style:u,children:n||" "},`${i}-${n}`)})})}function rve(){const e=["w-full","w-11/12","w-5/6","w-3/4","w-2/3","w-4/5"];return g.jsxs("div",{role:"status","aria-live":"polite",children:[g.jsx("span",{className:"sr-only",children:"Loading file"}),g.jsx("div",{className:"animate-pulse space-y-2 rounded-md border border-[var(--app-border)] bg-[var(--app-code-bg)] p-3",children:Array.from({length:12}).map((t,n)=>g.jsx("div",{className:`h-3 ${e[n%e.length]} rounded bg-[var(--app-subtle-bg)]`},`file-skeleton-${n}`))})]})}function ove(e){const t=e.split(".");if(t.length<=1)return;const n=t[t.length-1]?.toLowerCase();if(n)return c4[n]??n}function ave(e){return new TextEncoder().encode(e).length}function lve(e){return e?e.includes("\0")?!0:e.split("").filter(n=>{const i=n.charCodeAt(0);return i<32&&i!==9&&i!==10&&i!==13}).length/e.length>.1:!1}function cve(e){return!e||e.success?null:e.error??e.stderr??"Failed to load diff"}function uve(){const{api:e}=Vu(),{copied:t,copy:n}=Nv(),{copied:i,copy:s}=Nv(),r=Jl(),{sessionId:o}=$a({from:"/sessions/$sessionId/file"}),a=Nf({from:"/sessions/$sessionId/file"}),c=typeof a.path=="string"?a.path:"",u=a.staged,h=k.useMemo(()=>nve(c),[c]),f=h.split("/").pop()||h||"File",m=Fr({queryKey:Xt.gitFileDiff(o,h,u),queryFn:async()=>{if(!e||!o||!h)throw new Error("Missing session or path");return await e.getGitDiffFile(o,h,u)},enabled:!!(e&&o&&h)}),y=Fr({queryKey:Xt.sessionFile(o,h),queryFn:async()=>{if(!e||!o||!h)throw new Error("Missing session or path");return await e.readSessionFile(o,h)},enabled:!!(e&&o&&h)}),b=m.data?.success?m.data.stdout??"":"",S=cve(m.data),_=m.data?.success===!0,w=m.data?.success===!1,M=y.data,R=M?.success&&M.content?vj(M.content):{text:"",ok:!0},E=R.text,A=M?.success?!R.ok||lve(E):!1,T=k.useMemo(()=>ove(h),[h]),L=m1(E,T),P=k.useMemo(()=>E?ave(E):0,[E]),I=M?.success===!0&&!A&&E.length>0&&P<=tve,[N,O]=k.useState("diff");k.useEffect(()=>{if(_&&!b){O("file");return}w&&O("file")},[_,w,b]);const j=m.isLoading||y.isLoading,$=M&&!M.success?M.error??"Failed to read file":null,V=!h,H=S?`Diff unavailable: ${S}`:null;return g.jsxs("div",{className:"flex h-full flex-col",children:[g.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:g.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center gap-2 p-3 border-b border-[var(--app-border)]",children:[g.jsx("button",{type:"button",onClick:r,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:g.jsx(ive,{})}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"truncate font-semibold",children:f}),g.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:h||"Unknown path"})]})]})}),g.jsx("div",{className:"bg-[var(--app-bg)]",children:g.jsxs("div",{className:"mx-auto w-full max-w-content px-3 py-2 flex items-center gap-2 border-b border-[var(--app-divider)]",children:[g.jsx(Gf,{fileName:f,size:20}),g.jsx("span",{className:"min-w-0 flex-1 truncate text-xs text-[var(--app-hint)]",children:h}),g.jsx("button",{type:"button",onClick:()=>n(h),className:"shrink-0 rounded p-1 text-[var(--app-hint)] hover:bg-[var(--app-subtle-bg)] hover:text-[var(--app-fg)] transition-colors",title:"Copy path",children:t?g.jsx(pv,{className:"h-3.5 w-3.5"}):g.jsx(fv,{className:"h-3.5 w-3.5"})})]})}),b?g.jsx("div",{className:"bg-[var(--app-bg)]",children:g.jsxs("div",{className:"mx-auto w-full max-w-content px-3 py-2 flex items-center gap-2 border-b border-[var(--app-divider)]",children:[g.jsx("button",{type:"button",onClick:()=>O("diff"),className:`rounded px-3 py-1 text-xs font-semibold ${N==="diff"?"bg-[var(--app-button)] text-[var(--app-button-text)] opacity-80":"bg-[var(--app-subtle-bg)] text-[var(--app-hint)]"}`,children:"Diff"}),g.jsx("button",{type:"button",onClick:()=>O("file"),className:`rounded px-3 py-1 text-xs font-semibold ${N==="file"?"bg-[var(--app-button)] text-[var(--app-button-text)] opacity-80":"bg-[var(--app-subtle-bg)] text-[var(--app-hint)]"}`,children:"File"})]})}):null,g.jsx("div",{className:"flex-1 overflow-y-auto",children:g.jsxs("div",{className:"mx-auto w-full max-w-content p-4",children:[H?g.jsx("div",{className:"mb-3 rounded-md bg-amber-500/10 p-2 text-xs text-[var(--app-hint)]",children:H}):null,V?g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"No file path provided."}):j?g.jsx(rve,{}):$?g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:$}):A?g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"This looks like a binary file. It cannot be displayed."}):N==="diff"&&b?g.jsx(sve,{diffContent:b}):N==="diff"&&S?g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:S}):N==="file"?E?g.jsxs("div",{className:"relative",children:[I?g.jsx("button",{type:"button",onClick:()=>s(E),className:"absolute right-2 top-2 z-10 rounded p-1 text-[var(--app-hint)] hover:bg-[var(--app-subtle-bg)] hover:text-[var(--app-fg)] transition-colors",title:"Copy file content",children:i?g.jsx(pv,{className:"h-3.5 w-3.5"}):g.jsx(fv,{className:"h-3.5 w-3.5"})}):null,g.jsx("pre",{className:"shiki overflow-auto rounded-md bg-[var(--app-code-bg)] p-3 pr-8 text-xs font-mono",children:g.jsx("code",{children:L??E})})]}):g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"File is empty."}):g.jsx("div",{className:"text-sm text-[var(--app-hint)]",children:"No changes to display."})]})})]})}const Hr=Object.create(null);Hr.open="0";Hr.close="1";Hr.ping="2";Hr.pong="3";Hr.message="4";Hr.upgrade="5";Hr.noop="6";const Mg=Object.create(null);Object.keys(Hr).forEach(e=>{Mg[Hr[e]]=e});const Mw={type:"error",data:"parser error"},e6=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",t6=typeof ArrayBuffer=="function",n6=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,E1=({type:e,data:t},n,i)=>e6&&t instanceof Blob?n?i(t):YI(t,i):t6&&(t instanceof ArrayBuffer||n6(t))?n?i(t):YI(new Blob([t]),i):i(Hr[e]+(t||"")),YI=(e,t)=>{const n=new FileReader;return n.onload=function(){const i=n.result.split(",")[1];t("b"+(i||""))},n.readAsDataURL(e)};function XI(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let FS;function dve(e,t){if(e6&&e.data instanceof Blob)return e.data.arrayBuffer().then(XI).then(t);if(t6&&(e.data instanceof ArrayBuffer||n6(e.data)))return t(XI(e.data));E1(e,!1,n=>{FS||(FS=new TextEncoder),t(FS.encode(n))})}const QI="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",kh=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<QI.length;e++)kh[QI.charCodeAt(e)]=e;const hve=e=>{let t=e.length*.75,n=e.length,i,s=0,r,o,a,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const u=new ArrayBuffer(t),h=new Uint8Array(u);for(i=0;i<n;i+=4)r=kh[e.charCodeAt(i)],o=kh[e.charCodeAt(i+1)],a=kh[e.charCodeAt(i+2)],c=kh[e.charCodeAt(i+3)],h[s++]=r<<2|o>>4,h[s++]=(o&15)<<4|a>>2,h[s++]=(a&3)<<6|c&63;return u},fve=typeof ArrayBuffer=="function",R1=(e,t)=>{if(typeof e!="string")return{type:"message",data:i6(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:pve(e.substring(1),t)}:Mg[n]?e.length>1?{type:Mg[n],data:e.substring(1)}:{type:Mg[n]}:Mw},pve=(e,t)=>{if(fve){const n=hve(e);return i6(n,t)}else return{base64:!0,data:e}},i6=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},s6="",mve=(e,t)=>{const n=e.length,i=new Array(n);let s=0;e.forEach((r,o)=>{E1(r,!1,a=>{i[o]=a,++s===n&&t(i.join(s6))})})},gve=(e,t)=>{const n=e.split(s6),i=[];for(let s=0;s<n.length;s++){const r=R1(n[s],t);if(i.push(r),r.type==="error")break}return i};function vve(){return new TransformStream({transform(e,t){dve(e,n=>{const i=n.length;let s;if(i<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,i);else if(i<65536){s=new Uint8Array(3);const r=new DataView(s.buffer);r.setUint8(0,126),r.setUint16(1,i)}else{s=new Uint8Array(9);const r=new DataView(s.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(i))}e.data&&typeof e.data!="string"&&(s[0]|=128),t.enqueue(s),t.enqueue(n)})}})}let US;function Gm(e){return e.reduce((t,n)=>t+n.length,0)}function Km(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let i=0;for(let s=0;s<t;s++)n[s]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),n}function yve(e,t){US||(US=new TextDecoder);const n=[];let i=0,s=-1,r=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(i===0){if(Gm(n)<1)break;const c=Km(n,1);r=(c[0]&128)===128,s=c[0]&127,s<126?i=3:s===126?i=1:i=2}else if(i===1){if(Gm(n)<2)break;const c=Km(n,2);s=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),i=3}else if(i===2){if(Gm(n)<8)break;const c=Km(n,8),u=new DataView(c.buffer,c.byteOffset,c.length),h=u.getUint32(0);if(h>Math.pow(2,21)-1){a.enqueue(Mw);break}s=h*Math.pow(2,32)+u.getUint32(4),i=3}else{if(Gm(n)<s)break;const c=Km(n,s);a.enqueue(R1(r?c:US.decode(c),t)),i=0}if(s===0||s>e){a.enqueue(Mw);break}}}})}const r6=4;function Mn(e){if(e)return bve(e)}function bve(e){for(var t in Mn.prototype)e[t]=Mn.prototype[t];return e}Mn.prototype.on=Mn.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};Mn.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};Mn.prototype.off=Mn.prototype.removeListener=Mn.prototype.removeAllListeners=Mn.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var i,s=0;s<n.length;s++)if(i=n[s],i===t||i.fn===t){n.splice(s,1);break}return n.length===0&&delete this._callbacks["$"+e],this};Mn.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(n){n=n.slice(0);for(var i=0,s=n.length;i<s;++i)n[i].apply(this,t)}return this};Mn.prototype.emitReserved=Mn.prototype.emit;Mn.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};Mn.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Ty=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0),Is=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),_ve="arraybuffer";function o6(e,...t){return t.reduce((n,i)=>(e.hasOwnProperty(i)&&(n[i]=e[i]),n),{})}const Sve=Is.setTimeout,xve=Is.clearTimeout;function Ey(e,t){t.useNativeTimers?(e.setTimeoutFn=Sve.bind(Is),e.clearTimeoutFn=xve.bind(Is)):(e.setTimeoutFn=Is.setTimeout.bind(Is),e.clearTimeoutFn=Is.clearTimeout.bind(Is))}const wve=1.33;function Cve(e){return typeof e=="string"?kve(e):Math.ceil((e.byteLength||e.size)*wve)}function kve(e){let t=0,n=0;for(let i=0,s=e.length;i<s;i++)t=e.charCodeAt(i),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}function a6(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Tve(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function Eve(e){let t={},n=e.split("&");for(let i=0,s=n.length;i<s;i++){let r=n[i].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}class Rve extends Error{constructor(t,n,i){super(t),this.description=n,this.context=i,this.type="TransportError"}}class M1 extends Mn{constructor(t){super(),this.writable=!1,Ey(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,i){return super.emitReserved("error",new Rve(t,n,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=R1(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=Tve(t);return n.length?"?"+n:""}}class Mve extends M1{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||n()})),this.writable||(i++,this.once("drain",function(){--i||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};gve(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,mve(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=a6()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let l6=!1;try{l6=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Ave=l6;function Pve(){}class Lve extends Mve{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port}}doWrite(t,n){const i=this.request({method:"POST",data:t});i.on("success",n),i.on("error",(s,r)=>{this.onError("xhr post error",s,r)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,i)=>{this.onError("xhr poll error",n,i)}),this.pollXhr=t}}class jr extends Mn{constructor(t,n,i){super(),this.createRequest=t,Ey(this,i),this._opts=i,this._method=i.method||"GET",this._uri=n,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var t;const n=o6(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(n);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let s in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(s)&&i.setRequestHeader(s,this._opts.extraHeaders[s])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var s;i.readyState===3&&((s=this._opts.cookieJar)===null||s===void 0||s.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(s){this.setTimeoutFn(()=>{this._onError(s)},0);return}typeof document<"u"&&(this._index=jr.requestsCount++,jr.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Pve,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete jr.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}jr.requestsCount=0;jr.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",JI);else if(typeof addEventListener=="function"){const e="onpagehide"in Is?"pagehide":"unload";addEventListener(e,JI,!1)}}function JI(){for(let e in jr.requests)jr.requests.hasOwnProperty(e)&&jr.requests[e].abort()}const Nve=(function(){const e=c6({xdomain:!1});return e&&e.responseType!==null})();class Ive extends Lve{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=Nve&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new jr(c6,this.uri(),t)}}function c6(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Ave))return new XMLHttpRequest}catch{}if(!t)try{return new Is[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const u6=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Dve extends M1{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,i=u6?{}:o6(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,i)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const i=t[n],s=n===t.length-1;E1(i,this.supportsBinary,r=>{try{this.doWrite(i,r)}catch{}s&&Ty(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=a6()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const zS=Is.WebSocket||Is.MozWebSocket;class Ove extends Dve{createSocket(t,n,i){return u6?new zS(t,n,i):n?new zS(t,n):new zS(t)}doWrite(t,n){this.ws.send(n)}}class jve extends M1{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=yve(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=t.readable.pipeThrough(n).getReader(),s=vve();s.readable.pipeTo(t.writable),this._writer=s.writable.getWriter();const r=()=>{i.read().then(({done:a,value:c})=>{a||(this.onPacket(c),r())}).catch(a=>{})};r();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const i=t[n],s=n===t.length-1;this._writer.write(i).then(()=>{s&&Ty(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const Bve={websocket:Ove,webtransport:jve,polling:Ive},Fve=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Uve=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Aw(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),i=e.indexOf("]");n!=-1&&i!=-1&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));let s=Fve.exec(e||""),r={},o=14;for(;o--;)r[Uve[o]]=s[o]||"";return n!=-1&&i!=-1&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=zve(r,r.path),r.queryKey=$ve(r,r.query),r}function zve(e,t){const n=/\/{2,9}/g,i=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&i.splice(0,1),t.slice(-1)=="/"&&i.splice(i.length-1,1),i}function $ve(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,s,r){s&&(n[s]=r)}),n}const Pw=typeof addEventListener=="function"&&typeof removeEventListener=="function",Ag=[];Pw&&addEventListener("offline",()=>{Ag.forEach(e=>e())},!1);class ja extends Mn{constructor(t,n){if(super(),this.binaryType=_ve,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const i=Aw(t);n.hostname=i.host,n.secure=i.protocol==="https"||i.protocol==="wss",n.port=i.port,i.query&&(n.query=i.query)}else n.host&&(n.hostname=Aw(n.host).host);Ey(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(i=>{const s=i.prototype.name;this.transports.push(s),this._transportsByName[s]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Eve(this.opts.query)),Pw&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Ag.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=r6,n.transport=t,this.id&&(n.sid=this.id);const i=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&ja.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",ja.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let i=0;i<this.writeBuffer.length;i++){const s=this.writeBuffer[i].data;if(s&&(n+=Cve(s)),i>0&&n>this._maxPayload)return this.writeBuffer.slice(0,i);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,Ty(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,i){return this._sendPacket("message",t,n,i),this}send(t,n,i){return this._sendPacket("message",t,n,i),this}_sendPacket(t,n,i,s){if(typeof n=="function"&&(s=n,n=void 0),typeof i=="function"&&(s=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const r={type:t,data:n,options:i};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),s&&this.once("flush",s),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},i=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():t()}):this.upgrading?i():t()),this}_onError(t){if(ja.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Pw&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=Ag.indexOf(this._offlineEventListener);i!==-1&&Ag.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}ja.protocol=r6;class qve extends ja{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),i=!1;ja.priorWebsocketSuccess=!1;const s=()=>{i||(n.send([{type:"ping",data:"probe"}]),n.once("packet",f=>{if(!i)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;ja.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(h(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const m=new Error("probe error");m.transport=n.name,this.emitReserved("upgradeError",m)}}))};function r(){i||(i=!0,h(),n.close(),n=null)}const o=f=>{const m=new Error("probe error: "+f);m.transport=n.name,r(),this.emitReserved("upgradeError",m)};function a(){o("transport closed")}function c(){o("socket closed")}function u(f){n&&f.name!==n.name&&r()}const h=()=>{n.removeListener("open",s),n.removeListener("error",o),n.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};n.once("open",s),n.once("error",o),n.once("close",a),this.once("close",c),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{i||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let i=0;i<t.length;i++)~this.transports.indexOf(t[i])&&n.push(t[i]);return n}}let Hve=class extends qve{constructor(t,n={}){const i=typeof t=="object"?t:n;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(s=>Bve[s]).filter(s=>!!s)),super(t,i)}};function Vve(e,t="",n){let i=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),i=Aw(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const r=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+r+":"+i.port+t,i.href=i.protocol+"://"+r+(n&&n.port===i.port?"":":"+i.port),i}const Wve=typeof ArrayBuffer=="function",Gve=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,d6=Object.prototype.toString,Kve=typeof Blob=="function"||typeof Blob<"u"&&d6.call(Blob)==="[object BlobConstructor]",Yve=typeof File=="function"||typeof File<"u"&&d6.call(File)==="[object FileConstructor]";function A1(e){return Wve&&(e instanceof ArrayBuffer||Gve(e))||Kve&&e instanceof Blob||Yve&&e instanceof File}function Pg(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,i=e.length;n<i;n++)if(Pg(e[n]))return!0;return!1}if(A1(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return Pg(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&Pg(e[n]))return!0;return!1}function Xve(e){const t=[],n=e.data,i=e;return i.data=Lw(n,t),i.attachments=t.length,{packet:i,buffers:t}}function Lw(e,t){if(!e)return e;if(A1(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=Lw(e[i],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=Lw(e[i],t));return n}return e}function Qve(e,t){return e.data=Nw(e.data,t),delete e.attachments,e}function Nw(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=Nw(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=Nw(e[n],t));return e}const Jve=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Zve=5;var wt;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(wt||(wt={}));class eye{constructor(t){this.replacer=t}encode(t){return(t.type===wt.EVENT||t.type===wt.ACK)&&Pg(t)?this.encodeAsBinary({type:t.type===wt.EVENT?wt.BINARY_EVENT:wt.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===wt.BINARY_EVENT||t.type===wt.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=Xve(t),i=this.encodeAsString(n.packet),s=n.buffers;return s.unshift(i),s}}function ZI(e){return Object.prototype.toString.call(e)==="[object Object]"}class P1 extends Mn{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const i=n.type===wt.BINARY_EVENT;i||n.type===wt.BINARY_ACK?(n.type=i?wt.EVENT:wt.ACK,this.reconstructor=new tye(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(A1(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const i={type:Number(t.charAt(0))};if(wt[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===wt.BINARY_EVENT||i.type===wt.BINARY_ACK){const r=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const o=t.substring(r,n);if(o!=Number(o)||t.charAt(n)!=="-")throw new Error("Illegal attachments");i.attachments=Number(o)}if(t.charAt(n+1)==="/"){const r=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););i.nsp=t.substring(r,n)}else i.nsp="/";const s=t.charAt(n+1);if(s!==""&&Number(s)==s){const r=n+1;for(;++n;){const o=t.charAt(n);if(o==null||Number(o)!=o){--n;break}if(n===t.length)break}i.id=Number(t.substring(r,n+1))}if(t.charAt(++n)){const r=this.tryParse(t.substr(n));if(P1.isPayloadValid(i.type,r))i.data=r;else throw new Error("invalid payload")}return i}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case wt.CONNECT:return ZI(n);case wt.DISCONNECT:return n===void 0;case wt.CONNECT_ERROR:return typeof n=="string"||ZI(n);case wt.EVENT:case wt.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&Jve.indexOf(n[0])===-1);case wt.ACK:case wt.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class tye{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=Qve(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const nye=Object.freeze(Object.defineProperty({__proto__:null,Decoder:P1,Encoder:eye,get PacketType(){return wt},protocol:Zve},Symbol.toStringTag,{value:"Module"}));function Js(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const iye=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class h6 extends Mn{constructor(t,n,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Js(t,"open",this.onopen.bind(this)),Js(t,"packet",this.onpacket.bind(this)),Js(t,"error",this.onerror.bind(this)),Js(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var i,s,r;if(iye.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const o={type:wt.EVENT,data:n};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const h=this.ids++,f=n.pop();this._registerAckCallback(h,f),o.id=h}const a=(s=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||s===void 0?void 0:s.writable,c=this.connected&&!(!((r=this.io.engine)===null||r===void 0)&&r._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(t,n){var i;const s=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(s===void 0){this.acks[t]=n;return}const r=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===t&&this.sendBuffer.splice(a,1);n.call(this,new Error("operation has timed out"))},s),o=(...a)=>{this.io.clearTimeoutFn(r),n.apply(this,a)};o.withError=!0,this.acks[t]=o}emitWithAck(t,...n){return new Promise((i,s)=>{const r=(o,a)=>o?s(o):i(a);r.withError=!0,n.push(r),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((s,...r)=>(this._queue[0],s!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(s)):(this._queue.shift(),n&&n(null,...r)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:wt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(i=>String(i.id)===t)){const i=this.acks[t];delete this.acks[t],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case wt.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case wt.EVENT:case wt.BINARY_EVENT:this.onevent(t);break;case wt.ACK:case wt.BINARY_ACK:this.onack(t);break;case wt.DISCONNECT:this.ondisconnect();break;case wt.CONNECT_ERROR:this.destroy();const i=new Error(t.data.message);i.data=t.data.data,this.emitReserved("connect_error",i);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const i of n)i.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let i=!1;return function(...s){i||(i=!0,n.packet({type:wt.ACK,id:t,data:s}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:wt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let i=0;i<n.length;i++)if(t===n[i])return n.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let i=0;i<n.length;i++)if(t===n[i])return n.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const i of n)i.apply(this,t.data)}}}function ed(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}ed.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-n:e+n}return Math.min(e,this.max)|0};ed.prototype.reset=function(){this.attempts=0};ed.prototype.setMin=function(e){this.ms=e};ed.prototype.setMax=function(e){this.max=e};ed.prototype.setJitter=function(e){this.jitter=e};class Iw extends Mn{constructor(t,n){var i;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Ey(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((i=n.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new ed({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const s=n.parser||nye;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Hve(this.uri,this.opts);const n=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const s=Js(n,"open",function(){i.onopen(),t&&t()}),r=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),t?t(a):this.maybeReconnectOnOpen()},o=Js(n,"error",r);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{s(),r(new Error("timeout")),n.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(s),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(Js(t,"ping",this.onping.bind(this)),Js(t,"data",this.ondata.bind(this)),Js(t,"error",this.onerror.bind(this)),Js(t,"close",this.onclose.bind(this)),Js(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){Ty(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let i=this.nsps[t];return i?this._autoConnect&&!i.active&&i.connect():(i=new h6(this,t,n),this.nsps[t]=i),i}_destroy(t){const n=Object.keys(this.nsps);for(const i of n)if(this.nsps[i].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let i=0;i<n.length;i++)this.engine.write(n[i],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(s=>{s?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",s)):t.onreconnect()}))},n);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const uh={};function Lg(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=Vve(e,t.path||"/socket.io"),i=n.source,s=n.id,r=n.path,o=uh[s]&&r in uh[s].nsps,a=t.forceNew||t["force new connection"]||t.multiplex===!1||o;let c;return a?c=new Iw(i,t):(uh[s]||(uh[s]=new Iw(i,t)),c=uh[s]),n.query&&!t.query&&(t.query=n.queryKey),c.socket(n.path,t)}Object.assign(Lg,{Manager:Iw,Socket:h6,io:Lg,connect:Lg});function sye(e){const[t,n]=k.useState({status:"idle"}),i=k.useRef(null),s=k.useRef(()=>{}),r=k.useRef(()=>{}),o=k.useRef(e.sessionId),a=k.useRef(e.terminalId),c=k.useRef(e.token),u=k.useRef(e.baseUrl),h=k.useRef(null);k.useEffect(()=>{o.current=e.sessionId,a.current=e.terminalId,u.current=e.baseUrl},[e.sessionId,e.terminalId,e.baseUrl]),k.useEffect(()=>{c.current=e.token;const E=i.current;if(E){if(!e.token){E.connected&&E.disconnect();return}E.auth={token:e.token},E.connected&&(E.disconnect(),E.connect())}},[e.token]);const f=k.useCallback(E=>E===a.current,[]),m=k.useCallback((E,A)=>{E.emit("terminal:create",{sessionId:o.current,terminalId:a.current,cols:A.cols,rows:A.rows})},[]),y=k.useCallback(E=>{n({status:"error",error:E})},[]),b=k.useCallback((E,A)=>{h.current={cols:E,rows:A};const T=c.current,L=o.current,P=a.current;if(!T||!L||!P){y("Missing terminal credentials.");return}if(i.current){const N=i.current;N.auth={token:T},N.connected?m(N,{cols:E,rows:A}):N.connect(),n({status:"connecting"});return}const I=Lg(`${u.current}/terminal`,{auth:{token:T},path:"/socket.io/",reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,transports:["polling","websocket"],autoConnect:!1});i.current=I,n({status:"connecting"}),I.on("connect",()=>{const N=h.current??{cols:E,rows:A};n({status:"connecting"}),m(I,N)}),I.on("terminal:ready",N=>{f(N.terminalId)&&n({status:"connected"})}),I.on("terminal:output",N=>{f(N.terminalId)&&s.current(N.data)}),I.on("terminal:exit",N=>{f(N.terminalId)&&(r.current(N.code,N.signal),y("Terminal exited."))}),I.on("terminal:error",N=>{f(N.terminalId)&&y(N.message)}),I.on("connect_error",N=>{const O=N instanceof Error?N.message:"Connection error";y(O)}),I.on("disconnect",N=>{if(N==="io client disconnect"){n({status:"idle"});return}y(`Disconnected: ${N}`)}),I.connect()},[m,y,f]),S=k.useCallback(E=>{const A=i.current;!A||!A.connected||A.emit("terminal:write",{terminalId:a.current,data:E})},[]),_=k.useCallback((E,A)=>{h.current={cols:E,rows:A};const T=i.current;!T||!T.connected||T.emit("terminal:resize",{terminalId:a.current,cols:E,rows:A})},[]),w=k.useCallback(()=>{const E=i.current;E&&(E.removeAllListeners(),E.disconnect(),i.current=null,n({status:"idle"}))},[]),M=k.useCallback(E=>{s.current=E},[]),R=k.useCallback(E=>{r.current=E},[]);return{state:t,connect:b,write:S,resize:_,disconnect:w,onOutput:M,onExit:R}}var f6=Object.defineProperty,rye=Object.getOwnPropertyDescriptor,oye=(e,t)=>{for(var n in t)f6(e,n,{get:t[n],enumerable:!0})},dn=(e,t,n,i)=>{for(var s=i>1?void 0:i?rye(t,n):t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(s=(i?o(t,n,s):o(s))||s);return i&&s&&f6(t,n,s),s},Re=(e,t)=>(n,i)=>t(n,i,e),e2="Terminal input",Dw={get:()=>e2,set:e=>e2=e},t2="Too much output to announce, navigate to rows manually to read",Ow={get:()=>t2,set:e=>t2=e};function aye(e){return e.replace(/\r?\n/g,"\r")}function lye(e,t){return t?"\x1B[200~"+e+"\x1B[201~":e}function cye(e,t){e.clipboardData&&e.clipboardData.setData("text/plain",t.selectionText),e.preventDefault()}function uye(e,t,n,i){if(e.stopPropagation(),e.clipboardData){let s=e.clipboardData.getData("text/plain");p6(s,t,n,i)}}function p6(e,t,n,i){e=aye(e),e=lye(e,n.decPrivateModes.bracketedPasteMode&&i.rawOptions.ignoreBracketedPasteMode!==!0),n.triggerDataEvent(e,!0),t.value=""}function m6(e,t,n){let i=n.getBoundingClientRect(),s=e.clientX-i.left-10,r=e.clientY-i.top-10;t.style.width="20px",t.style.height="20px",t.style.left=`${s}px`,t.style.top=`${r}px`,t.style.zIndex="1000",t.focus()}function n2(e,t,n,i,s){m6(e,t,n),s&&i.rightClickSelect(e),t.value=i.selectionText,t.select()}function wa(e){return e>65535?(e-=65536,String.fromCharCode((e>>10)+55296)+String.fromCharCode(e%1024+56320)):String.fromCharCode(e)}function Ry(e,t=0,n=e.length){let i="";for(let s=t;s<n;++s){let r=e[s];r>65535?(r-=65536,i+=String.fromCharCode((r>>10)+55296)+String.fromCharCode(r%1024+56320)):i+=String.fromCharCode(r)}return i}var dye=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,t){let n=e.length;if(!n)return 0;let i=0,s=0;if(this._interim){let r=e.charCodeAt(s++);56320<=r&&r<=57343?t[i++]=(this._interim-55296)*1024+r-56320+65536:(t[i++]=this._interim,t[i++]=r),this._interim=0}for(let r=s;r<n;++r){let o=e.charCodeAt(r);if(55296<=o&&o<=56319){if(++r>=n)return this._interim=o,i;let a=e.charCodeAt(r);56320<=a&&a<=57343?t[i++]=(o-55296)*1024+a-56320+65536:(t[i++]=o,t[i++]=a);continue}o!==65279&&(t[i++]=o)}return i}},hye=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,t){let n=e.length;if(!n)return 0;let i=0,s,r,o,a,c=0,u=0;if(this.interim[0]){let m=!1,y=this.interim[0];y&=(y&224)===192?31:(y&240)===224?15:7;let b=0,S;for(;(S=this.interim[++b]&63)&&b<4;)y<<=6,y|=S;let _=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,w=_-b;for(;u<w;){if(u>=n)return 0;if(S=e[u++],(S&192)!==128){u--,m=!0;break}else this.interim[b++]=S,y<<=6,y|=S&63}m||(_===2?y<128?u--:t[i++]=y:_===3?y<2048||y>=55296&&y<=57343||y===65279||(t[i++]=y):y<65536||y>1114111||(t[i++]=y)),this.interim.fill(0)}let h=n-4,f=u;for(;f<n;){for(;f<h&&!((s=e[f])&128)&&!((r=e[f+1])&128)&&!((o=e[f+2])&128)&&!((a=e[f+3])&128);)t[i++]=s,t[i++]=r,t[i++]=o,t[i++]=a,f+=4;if(s=e[f++],s<128)t[i++]=s;else if((s&224)===192){if(f>=n)return this.interim[0]=s,i;if(r=e[f++],(r&192)!==128){f--;continue}if(c=(s&31)<<6|r&63,c<128){f--;continue}t[i++]=c}else if((s&240)===224){if(f>=n)return this.interim[0]=s,i;if(r=e[f++],(r&192)!==128){f--;continue}if(f>=n)return this.interim[0]=s,this.interim[1]=r,i;if(o=e[f++],(o&192)!==128){f--;continue}if(c=(s&15)<<12|(r&63)<<6|o&63,c<2048||c>=55296&&c<=57343||c===65279)continue;t[i++]=c}else if((s&248)===240){if(f>=n)return this.interim[0]=s,i;if(r=e[f++],(r&192)!==128){f--;continue}if(f>=n)return this.interim[0]=s,this.interim[1]=r,i;if(o=e[f++],(o&192)!==128){f--;continue}if(f>=n)return this.interim[0]=s,this.interim[1]=r,this.interim[2]=o,i;if(a=e[f++],(a&192)!==128){f--;continue}if(c=(s&7)<<18|(r&63)<<12|(o&63)<<6|a&63,c<65536||c>1114111)continue;t[i++]=c}}return i}},g6="",Ma=" ",Kf=class v6{constructor(){this.fg=0,this.bg=0,this.extended=new Fv}static toColorRGB(t){return[t>>>16&255,t>>>8&255,t&255]}static fromColorRGB(t){return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255}clone(){let t=new v6;return t.fg=this.fg,t.bg=this.bg,t.extended=this.extended.clone(),t}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},Fv=class y6{constructor(t=0,n=0){this._ext=0,this._urlId=0,this._ext=t,this._urlId=n}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(t){this._ext&=-67108864,this._ext|=t&67108863}get urlId(){return this._urlId}set urlId(t){this._urlId=t}get underlineVariantOffset(){let t=(this._ext&3758096384)>>29;return t<0?t^4294967288:t}set underlineVariantOffset(t){this._ext&=536870911,this._ext|=t<<29&3758096384}clone(){return new y6(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},zs=class b6 extends Kf{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new Fv,this.combinedData=""}static fromCharData(t){let n=new b6;return n.setFromCharData(t),n}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?wa(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(t){this.fg=t[0],this.bg=0;let n=!1;if(t[1].length>2)n=!0;else if(t[1].length===2){let i=t[1].charCodeAt(0);if(55296<=i&&i<=56319){let s=t[1].charCodeAt(1);56320<=s&&s<=57343?this.content=(i-55296)*1024+s-56320+65536|t[2]<<22:n=!0}else n=!0}else this.content=t[1].charCodeAt(0)|t[2]<<22;n&&(this.combinedData=t[1],this.content=2097152|t[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},i2="di$target",jw="di$dependencies",$S=new Map;function fye(e){return e[jw]||[]}function Qn(e){if($S.has(e))return $S.get(e);let t=function(n,i,s){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");pye(t,n,s)};return t._id=e,$S.set(e,t),t}function pye(e,t,n){t[i2]===t?t[jw].push({id:e,index:n}):(t[jw]=[{id:e,index:n}],t[i2]=t)}var Ai=Qn("BufferService"),_6=Qn("CoreMouseService"),oc=Qn("CoreService"),mye=Qn("CharsetService"),L1=Qn("InstantiationService"),S6=Qn("LogService"),Pi=Qn("OptionsService"),x6=Qn("OscLinkService"),gye=Qn("UnicodeService"),Yf=Qn("DecorationService"),Bw=class{constructor(e,t,n){this._bufferService=e,this._optionsService=t,this._oscLinkService=n}provideLinks(e,t){let n=this._bufferService.buffer.lines.get(e-1);if(!n){t(void 0);return}let i=[],s=this._optionsService.rawOptions.linkHandler,r=new zs,o=n.getTrimmedLength(),a=-1,c=-1,u=!1;for(let h=0;h<o;h++)if(!(c===-1&&!n.hasContent(h))){if(n.loadCell(h,r),r.hasExtendedAttrs()&&r.extended.urlId)if(c===-1){c=h,a=r.extended.urlId;continue}else u=r.extended.urlId!==a;else c!==-1&&(u=!0);if(u||c!==-1&&h===o-1){let f=this._oscLinkService.getLinkData(a)?.uri;if(f){let m={start:{x:c+1,y:e},end:{x:h+(!u&&h===o-1?1:0),y:e}},y=!1;if(!s?.allowNonHttpProtocols)try{let b=new URL(f);["http:","https:"].includes(b.protocol)||(y=!0)}catch{y=!0}y||i.push({text:f,range:m,activate:(b,S)=>s?s.activate(b,S,m):vye(b,S),hover:(b,S)=>s?.hover?.(b,S,m),leave:(b,S)=>s?.leave?.(b,S,m)})}u=!1,r.hasExtendedAttrs()&&r.extended.urlId?(c=h,a=r.extended.urlId):(c=-1,a=-1)}}t(i)}};Bw=dn([Re(0,Ai),Re(1,Pi),Re(2,x6)],Bw);function vye(e,t){if(confirm(`Do you want to navigate to ${t}?

WARNING: This link could potentially be dangerous`)){let n=window.open();if(n){try{n.opener=null}catch{}n.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}}var My=Qn("CharSizeService"),Uo=Qn("CoreBrowserService"),N1=Qn("MouseService"),zo=Qn("RenderService"),yye=Qn("SelectionService"),w6=Qn("CharacterJoinerService"),td=Qn("ThemeService"),C6=Qn("LinkProviderService"),bye=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?s2.isErrorNoTelemetry(e)?new s2(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},_ye=new bye;function Ng(e){Sye(e)||_ye.onUnexpectedError(e)}var Fw="Canceled";function Sye(e){return e instanceof xye?!0:e instanceof Error&&e.name===Fw&&e.message===Fw}var xye=class extends Error{constructor(){super(Fw),this.name=this.message}};function wye(e){return new Error(`Illegal argument: ${e}`)}var s2=class Uw extends Error{constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof Uw)return t;let n=new Uw;return n.message=t.message,n.stack=t.stack,n}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}},zw=class k6 extends Error{constructor(t){super(t||"An unexpected bug occurred."),Object.setPrototypeOf(this,k6.prototype)}};function is(e,t=0){return e[e.length-(1+t)]}var Cye;(e=>{function t(r){return r<0}e.isLessThan=t;function n(r){return r<=0}e.isLessThanOrEqual=n;function i(r){return r>0}e.isGreaterThan=i;function s(r){return r===0}e.isNeitherLessOrGreaterThan=s,e.greaterThan=1,e.lessThan=-1,e.neitherLessOrGreaterThan=0})(Cye||={});function kye(e,t){let n=this,i=!1,s;return function(){return i||(i=!0,t||(s=e.apply(n,arguments))),s}}var T6;(e=>{function t(E){return E&&typeof E=="object"&&typeof E[Symbol.iterator]=="function"}e.is=t;let n=Object.freeze([]);function i(){return n}e.empty=i;function*s(E){yield E}e.single=s;function r(E){return t(E)?E:s(E)}e.wrap=r;function o(E){return E||n}e.from=o;function*a(E){for(let A=E.length-1;A>=0;A--)yield E[A]}e.reverse=a;function c(E){return!E||E[Symbol.iterator]().next().done===!0}e.isEmpty=c;function u(E){return E[Symbol.iterator]().next().value}e.first=u;function h(E,A){let T=0;for(let L of E)if(A(L,T++))return!0;return!1}e.some=h;function f(E,A){for(let T of E)if(A(T))return T}e.find=f;function*m(E,A){for(let T of E)A(T)&&(yield T)}e.filter=m;function*y(E,A){let T=0;for(let L of E)yield A(L,T++)}e.map=y;function*b(E,A){let T=0;for(let L of E)yield*A(L,T++)}e.flatMap=b;function*S(...E){for(let A of E)yield*A}e.concat=S;function _(E,A,T){let L=T;for(let P of E)L=A(L,P);return L}e.reduce=_;function*w(E,A,T=E.length){for(A<0&&(A+=E.length),T<0?T+=E.length:T>E.length&&(T=E.length);A<T;A++)yield E[A]}e.slice=w;function M(E,A=Number.POSITIVE_INFINITY){let T=[];if(A===0)return[T,E];let L=E[Symbol.iterator]();for(let P=0;P<A;P++){let I=L.next();if(I.done)return[T,e.empty()];T.push(I.value)}return[T,{[Symbol.iterator](){return L}}]}e.consume=M;async function R(E){let A=[];for await(let T of E)A.push(T);return Promise.resolve(A)}e.asyncToArray=R})(T6||={});function Yl(e){if(T6.is(e)){let t=[];for(let n of e)if(n)try{n.dispose()}catch(i){t.push(i)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function Tye(...e){return Zt(()=>Yl(e))}function Zt(e){return{dispose:kye(()=>{e()})}}var E6=class R6{constructor(){this._toDispose=new Set,this._isDisposed=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Yl(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?R6.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),void 0)}};E6.DISABLE_DISPOSED_WARNING=!1;var Ba=E6,ct=class{constructor(){this._store=new Ba,this._store}dispose(){this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}};ct.None=Object.freeze({dispose(){}});var Uu=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e}},No=typeof window=="object"?window:globalThis,$w=class qw{constructor(t){this.element=t,this.next=qw.Undefined,this.prev=qw.Undefined}};$w.Undefined=new $w(void 0);var en=$w,r2=class{constructor(){this._first=en.Undefined,this._last=en.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===en.Undefined}clear(){let e=this._first;for(;e!==en.Undefined;){let t=e.next;e.prev=en.Undefined,e.next=en.Undefined,e=t}this._first=en.Undefined,this._last=en.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){let n=new en(e);if(this._first===en.Undefined)this._first=n,this._last=n;else if(t){let s=this._last;this._last=n,n.prev=s,s.next=n}else{let s=this._first;this._first=n,n.next=s,s.prev=n}this._size+=1;let i=!1;return()=>{i||(i=!0,this._remove(n))}}shift(){if(this._first!==en.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==en.Undefined){let e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==en.Undefined&&e.next!==en.Undefined){let t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===en.Undefined&&e.next===en.Undefined?(this._first=en.Undefined,this._last=en.Undefined):e.next===en.Undefined?(this._last=this._last.prev,this._last.next=en.Undefined):e.prev===en.Undefined&&(this._first=this._first.next,this._first.prev=en.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==en.Undefined;)yield e.element,e=e.next}},Eye=globalThis.performance&&typeof globalThis.performance.now=="function",Rye=class M6{static create(t){return new M6(t)}constructor(t){this._now=Eye&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},si;(e=>{e.None=()=>ct.None;function t(j,$){return f(j,()=>{},0,void 0,!0,void 0,$)}e.defer=t;function n(j){return($,V=null,H)=>{let B=!1,W;return W=j(q=>{if(!B)return W?W.dispose():B=!0,$.call(V,q)},null,H),B&&W.dispose(),W}}e.once=n;function i(j,$,V){return u((H,B=null,W)=>j(q=>H.call(B,$(q)),null,W),V)}e.map=i;function s(j,$,V){return u((H,B=null,W)=>j(q=>{$(q),H.call(B,q)},null,W),V)}e.forEach=s;function r(j,$,V){return u((H,B=null,W)=>j(q=>$(q)&&H.call(B,q),null,W),V)}e.filter=r;function o(j){return j}e.signal=o;function a(...j){return($,V=null,H)=>{let B=Tye(...j.map(W=>W(q=>$.call(V,q))));return h(B,H)}}e.any=a;function c(j,$,V,H){let B=V;return i(j,W=>(B=$(B,W),B),H)}e.reduce=c;function u(j,$){let V,H={onWillAddFirstListener(){V=j(B.fire,B)},onDidRemoveLastListener(){V?.dispose()}},B=new we(H);return $?.add(B),B.event}function h(j,$){return $ instanceof Array?$.push(j):$&&$.add(j),j}function f(j,$,V=100,H=!1,B=!1,W,q){let ne,z,G,J=0,U,re={leakWarningThreshold:W,onWillAddFirstListener(){ne=j(ce=>{J++,z=$(z,ce),H&&!G&&(de.fire(z),z=void 0),U=()=>{let ae=z;z=void 0,G=void 0,(!H||J>1)&&de.fire(ae),J=0},typeof V=="number"?(clearTimeout(G),G=setTimeout(U,V)):G===void 0&&(G=0,queueMicrotask(U))})},onWillRemoveListener(){B&&J>0&&U?.()},onDidRemoveLastListener(){U=void 0,ne.dispose()}},de=new we(re);return q?.add(de),de.event}e.debounce=f;function m(j,$=0,V){return e.debounce(j,(H,B)=>H?(H.push(B),H):[B],$,void 0,!0,void 0,V)}e.accumulate=m;function y(j,$=(H,B)=>H===B,V){let H=!0,B;return r(j,W=>{let q=H||!$(W,B);return H=!1,B=W,q},V)}e.latch=y;function b(j,$,V){return[e.filter(j,$,V),e.filter(j,H=>!$(H),V)]}e.split=b;function S(j,$=!1,V=[],H){let B=V.slice(),W=j(z=>{B?B.push(z):ne.fire(z)});H&&H.add(W);let q=()=>{B?.forEach(z=>ne.fire(z)),B=null},ne=new we({onWillAddFirstListener(){W||(W=j(z=>ne.fire(z)),H&&H.add(W))},onDidAddFirstListener(){B&&($?setTimeout(q):q())},onDidRemoveLastListener(){W&&W.dispose(),W=null}});return H&&H.add(ne),ne.event}e.buffer=S;function _(j,$){return(V,H,B)=>{let W=$(new M);return j(function(q){let ne=W.evaluate(q);ne!==w&&V.call(H,ne)},void 0,B)}}e.chain=_;let w=Symbol("HaltChainable");class M{constructor(){this.steps=[]}map($){return this.steps.push($),this}forEach($){return this.steps.push(V=>($(V),V)),this}filter($){return this.steps.push(V=>$(V)?V:w),this}reduce($,V){let H=V;return this.steps.push(B=>(H=$(H,B),H)),this}latch($=(V,H)=>V===H){let V=!0,H;return this.steps.push(B=>{let W=V||!$(B,H);return V=!1,H=B,W?B:w}),this}evaluate($){for(let V of this.steps)if($=V($),$===w)break;return $}}function R(j,$,V=H=>H){let H=(...ne)=>q.fire(V(...ne)),B=()=>j.on($,H),W=()=>j.removeListener($,H),q=new we({onWillAddFirstListener:B,onDidRemoveLastListener:W});return q.event}e.fromNodeEventEmitter=R;function E(j,$,V=H=>H){let H=(...ne)=>q.fire(V(...ne)),B=()=>j.addEventListener($,H),W=()=>j.removeEventListener($,H),q=new we({onWillAddFirstListener:B,onDidRemoveLastListener:W});return q.event}e.fromDOMEventEmitter=E;function A(j){return new Promise($=>n(j)($))}e.toPromise=A;function T(j){let $=new we;return j.then(V=>{$.fire(V)},()=>{$.fire(void 0)}).finally(()=>{$.dispose()}),$.event}e.fromPromise=T;function L(j,$){return j(V=>$.fire(V))}e.forward=L;function P(j,$,V){return $(V),j(H=>$(H))}e.runAndSubscribe=P;class I{constructor($,V){this._observable=$,this._counter=0,this._hasChanged=!1;let H={onWillAddFirstListener:()=>{$.addObserver(this)},onDidRemoveLastListener:()=>{$.removeObserver(this)}};this.emitter=new we(H),V&&V.add(this.emitter)}beginUpdate($){this._counter++}handlePossibleChange($){}handleChange($,V){this._hasChanged=!0}endUpdate($){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function N(j,$){return new I(j,$).emitter.event}e.fromObservable=N;function O(j){return($,V,H)=>{let B=0,W=!1,q={beginUpdate(){B++},endUpdate(){B--,B===0&&(j.reportChanges(),W&&(W=!1,$.call(V)))},handlePossibleChange(){},handleChange(){W=!0}};j.addObserver(q),j.reportChanges();let ne={dispose(){j.removeObserver(q)}};return H instanceof Ba?H.add(ne):Array.isArray(H)&&H.push(ne),ne}}e.fromObservableLight=O})(si||={});var Hw=class Vw{constructor(t){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${t}_${Vw._idPool++}`,Vw.all.add(this)}start(t){this._stopWatch=new Rye,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}};Hw.all=new Set,Hw._idPool=0;var Mye=Hw,Aye=-1,A6=class P6{constructor(t,n,i=(P6._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t,this.threshold=n,this.name=i,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(t,n){let i=this.threshold;if(i<=0||n<i)return;this._stacks||(this._stacks=new Map);let s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=i*.5;let[r,o]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${n} listeners already. MOST frequent listener (${o}):`;console.warn(a),console.warn(r);let c=new Nye(a,r);this._errorHandler(c)}return()=>{let r=this._stacks.get(t.value)||0;this._stacks.set(t.value,r-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,n=0;for(let[i,s]of this._stacks)(!t||n<s)&&(t=[i,s],n=s);return t}};A6._idPool=1;var Pye=A6,Lye=class L6{constructor(t){this.value=t}static create(){let t=new Error;return new L6(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},Nye=class extends Error{constructor(e,t){super(e),this.name="ListenerLeakError",this.stack=t}},Iye=class extends Error{constructor(e,t){super(e),this.name="ListenerRefusalError",this.stack=t}},Dye=0,qS=class{constructor(e){this.value=e,this.id=Dye++}},Oye=2,jye,we=class{constructor(t){this._size=0,this._options=t,this._leakageMon=this._options?.leakWarningThreshold?new Pye(t?.onListenerError??Ng,this._options?.leakWarningThreshold??Aye):void 0,this._perfMon=this._options?._profName?new Mye(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){this._disposed||(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners&&(this._listeners=void 0,this._size=0),this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose())}get event(){return this._event??=(t,n,i)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let a=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(a);let c=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],u=new Iye(`${a}. HINT: Stack shows most frequent listener (${c[1]}-times)`,c[0]);return(this._options?.onListenerError||Ng)(u),ct.None}if(this._disposed)return ct.None;n&&(t=t.bind(n));let s=new qS(t),r;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(s.stack=Lye.create(),r=this._leakageMon.check(s.stack,this._size+1)),this._listeners?this._listeners instanceof qS?(this._deliveryQueue??=new Bye,this._listeners=[this._listeners,s]):this._listeners.push(s):(this._options?.onWillAddFirstListener?.(this),this._listeners=s,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=Zt(()=>{r?.(),this._removeListener(s)});return i instanceof Ba?i.add(o):Array.isArray(i)&&i.push(o),o},this._event}_removeListener(t){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let n=this._listeners,i=n.indexOf(t);if(i===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,n[i]=void 0;let s=this._deliveryQueue.current===this;if(this._size*Oye<=n.length){let r=0;for(let o=0;o<n.length;o++)n[o]?n[r++]=n[o]:s&&(this._deliveryQueue.end--,r<this._deliveryQueue.i&&this._deliveryQueue.i--);n.length=r}}_deliver(t,n){if(!t)return;let i=this._options?.onListenerError||Ng;if(!i){t.value(n);return}try{t.value(n)}catch(s){i(s)}}_deliverQueue(t){let n=t.current._listeners;for(;t.i<t.end;)this._deliver(n[t.i++],t.value);t.reset()}fire(t){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof qS)this._deliver(this._listeners,t);else{let n=this._deliveryQueue;n.enqueue(this,t,this._listeners.length),this._deliverQueue(n)}this._perfMon?.stop()}hasListeners(){return this._size>0}},Bye=class{constructor(){this.i=-1,this.end=0}enqueue(e,t,n){this.i=0,this.end=n,this.current=e,this.value=t}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},Ww=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new we,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new we,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(t){return this.mapWindowIdToZoomLevel.get(this.getWindowId(t))??0}setZoomLevel(t,n){if(this.getZoomLevel(n)===t)return;let i=this.getWindowId(n);this.mapWindowIdToZoomLevel.set(i,t),this._onDidChangeZoomLevel.fire(i)}getZoomFactor(t){return this.mapWindowIdToZoomFactor.get(this.getWindowId(t))??1}setZoomFactor(t,n){this.mapWindowIdToZoomFactor.set(this.getWindowId(n),t)}setFullscreen(t,n){if(this.isFullscreen(n)===t)return;let i=this.getWindowId(n);this.mapWindowIdToFullScreen.set(i,t),this._onDidChangeFullscreen.fire(i)}isFullscreen(t){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(t))}getWindowId(t){return t.vscodeWindowId}};Ww.INSTANCE=new Ww;var I1=Ww;function Fye(e,t,n){typeof t=="string"&&(t=e.matchMedia(t)),t.addEventListener("change",n)}I1.INSTANCE.onDidChangeZoomLevel;function Uye(e){return I1.INSTANCE.getZoomFactor(e)}I1.INSTANCE.onDidChangeFullscreen;var nd=typeof navigator=="object"?navigator.userAgent:"",Gw=nd.indexOf("Firefox")>=0,zye=nd.indexOf("AppleWebKit")>=0,D1=nd.indexOf("Chrome")>=0,$ye=!D1&&nd.indexOf("Safari")>=0;nd.indexOf("Electron/")>=0;nd.indexOf("Android")>=0;var HS=!1;if(typeof No.matchMedia=="function"){let e=No.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),t=No.matchMedia("(display-mode: fullscreen)");HS=e.matches,Fye(No,e,({matches:n})=>{HS&&t.matches||(HS=n)})}var gu="en",Kw=!1,Yw=!1,Ig=!1,N6=!1,Ym,Dg=gu,o2=gu,qye,xo,Bl=globalThis,as;typeof Bl.vscode<"u"&&typeof Bl.vscode.process<"u"?as=Bl.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(as=process);var Hye=typeof as?.versions?.electron=="string",Vye=Hye&&as?.type==="renderer";if(typeof as=="object"){Kw=as.platform==="win32",Yw=as.platform==="darwin",Ig=as.platform==="linux",Ig&&as.env.SNAP&&as.env.SNAP_REVISION,as.env.CI||as.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Ym=gu,Dg=gu;let e=as.env.VSCODE_NLS_CONFIG;if(e)try{let t=JSON.parse(e);Ym=t.userLocale,o2=t.osLocale,Dg=t.resolvedLanguage||gu,qye=t.languagePack?.translationsConfigFile}catch{}N6=!0}else typeof navigator=="object"&&!Vye?(xo=navigator.userAgent,Kw=xo.indexOf("Windows")>=0,Yw=xo.indexOf("Macintosh")>=0,(xo.indexOf("Macintosh")>=0||xo.indexOf("iPad")>=0||xo.indexOf("iPhone")>=0)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0,Ig=xo.indexOf("Linux")>=0,xo?.indexOf("Mobi")>=0,Dg=globalThis._VSCODE_NLS_LANGUAGE||gu,Ym=navigator.language.toLowerCase(),o2=Ym):console.error("Unable to resolve platform.");var I6=Kw,Br=Yw,Wye=Ig,a2=N6,Vr=xo,ga=Dg,Gye;(e=>{function t(){return ga}e.value=t;function n(){return ga.length===2?ga==="en":ga.length>=3?ga[0]==="e"&&ga[1]==="n"&&ga[2]==="-":!1}e.isDefaultVariant=n;function i(){return ga==="en"}e.isDefault=i})(Gye||={});var Kye=typeof Bl.postMessage=="function"&&!Bl.importScripts;(()=>{if(Kye){let e=[];Bl.addEventListener("message",n=>{if(n.data&&n.data.vscodeScheduleAsyncWork)for(let i=0,s=e.length;i<s;i++){let r=e[i];if(r.id===n.data.vscodeScheduleAsyncWork){e.splice(i,1),r.callback();return}}});let t=0;return n=>{let i=++t;e.push({id:i,callback:n}),Bl.postMessage({vscodeScheduleAsyncWork:i},"*")}}return e=>setTimeout(e)})();var Yye=!!(Vr&&Vr.indexOf("Chrome")>=0);Vr&&Vr.indexOf("Firefox")>=0;!Yye&&Vr&&Vr.indexOf("Safari")>=0;Vr&&Vr.indexOf("Edg/")>=0;Vr&&Vr.indexOf("Android")>=0;var su=typeof navigator=="object"?navigator:{};a2||document.queryCommandSupported&&document.queryCommandSupported("copy")||su&&su.clipboard&&su.clipboard.writeText,a2||su&&su.clipboard&&su.clipboard.readText;var O1=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,t){this._keyCodeToStr[e]=t,this._strToKeyCode[t.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}},VS=new O1,l2=new O1,c2=new O1,Xye=new Array(230),D6;(e=>{function t(a){return VS.keyCodeToStr(a)}e.toString=t;function n(a){return VS.strToKeyCode(a)}e.fromString=n;function i(a){return l2.keyCodeToStr(a)}e.toUserSettingsUS=i;function s(a){return c2.keyCodeToStr(a)}e.toUserSettingsGeneral=s;function r(a){return l2.strToKeyCode(a)||c2.strToKeyCode(a)}e.fromUserSettings=r;function o(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return VS.keyCodeToStr(a)}e.toElectronAccelerator=o})(D6||={});var Qye=class O6{constructor(t,n,i,s,r){this.ctrlKey=t,this.shiftKey=n,this.altKey=i,this.metaKey=s,this.keyCode=r}equals(t){return t instanceof O6&&this.ctrlKey===t.ctrlKey&&this.shiftKey===t.shiftKey&&this.altKey===t.altKey&&this.metaKey===t.metaKey&&this.keyCode===t.keyCode}getHashCode(){let t=this.ctrlKey?"1":"0",n=this.shiftKey?"1":"0",i=this.altKey?"1":"0",s=this.metaKey?"1":"0";return`K${t}${n}${i}${s}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new Jye([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},Jye=class{constructor(e){if(e.length===0)throw wye("chords");this.chords=e}getHashCode(){let e="";for(let t=0,n=this.chords.length;t<n;t++)t!==0&&(e+=";"),e+=this.chords[t].getHashCode();return e}equals(e){if(e===null||this.chords.length!==e.chords.length)return!1;for(let t=0;t<this.chords.length;t++)if(!this.chords[t].equals(e.chords[t]))return!1;return!0}};function Zye(e){if(e.charCode){let n=String.fromCharCode(e.charCode).toUpperCase();return D6.fromString(n)}let t=e.keyCode;if(t===3)return 7;if(Gw)switch(t){case 59:return 85;case 60:if(Wye)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(Br)return 57;break}else if(zye&&(Br&&t===93||!Br&&t===92))return 57;return Xye[t]||0}var ebe=Br?256:2048,tbe=512,nbe=1024,ibe=Br?2048:256,u2=class{constructor(e){this._standardKeyboardEventBrand=!0;let t=e;this.browserEvent=t,this.target=t.target,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.altGraphKey=t.getModifierState?.("AltGraph"),this.keyCode=Zye(t),this.code=t.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(e){return this._asKeybinding===e}_computeKeybinding(){let e=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode);let t=0;return this.ctrlKey&&(t|=ebe),this.altKey&&(t|=tbe),this.shiftKey&&(t|=nbe),this.metaKey&&(t|=ibe),t|=e,t}_computeKeyCodeChord(){let e=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(e=this.keyCode),new Qye(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,e)}},d2=new WeakMap;function sbe(e){if(!e.parent||e.parent===e)return null;try{let t=e.location,n=e.parent.location;if(t.origin!=="null"&&n.origin!=="null"&&t.origin!==n.origin)return null}catch{return null}return e.parent}var rbe=class{static getSameOriginWindowChain(e){let t=d2.get(e);if(!t){t=[],d2.set(e,t);let n=e,i;do i=sbe(n),i?t.push({window:new WeakRef(n),iframeElement:n.frameElement||null}):t.push({window:new WeakRef(n),iframeElement:null}),n=i;while(n)}return t.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(e,t){if(!t||e===t)return{top:0,left:0};let n=0,i=0,s=this.getSameOriginWindowChain(e);for(let r of s){let o=r.window.deref();if(n+=o?.scrollY??0,i+=o?.scrollX??0,o===t||!r.iframeElement)break;let a=r.iframeElement.getBoundingClientRect();n+=a.top,i+=a.left}return{top:n,left:i}}},Xm=class{constructor(e,t){this.timestamp=Date.now(),this.browserEvent=t,this.leftButton=t.button===0,this.middleButton=t.button===1,this.rightButton=t.button===2,this.buttons=t.buttons,this.target=t.target,this.detail=t.detail||1,t.type==="dblclick"&&(this.detail=2),this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,typeof t.pageX=="number"?(this.posx=t.pageX,this.posy=t.pageY):(this.posx=t.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=t.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let n=rbe.getPositionOfChildWindowRelativeToAncestorWindow(e,t.view);this.posx-=n.left,this.posy-=n.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},h2=class{constructor(e,t=0,n=0){this.browserEvent=e||null,this.target=e?e.target||e.targetNode||e.srcElement:null,this.deltaY=n,this.deltaX=t;let i=!1;if(D1){let s=navigator.userAgent.match(/Chrome\/(\d+)/);i=(s?parseInt(s[1]):123)<=122}if(e){let s=e,r=e,o=e.view?.devicePixelRatio||1;if(typeof s.wheelDeltaY<"u")i?this.deltaY=s.wheelDeltaY/(120*o):this.deltaY=s.wheelDeltaY/120;else if(typeof r.VERTICAL_AXIS<"u"&&r.axis===r.VERTICAL_AXIS)this.deltaY=-r.detail/3;else if(e.type==="wheel"){let a=e;a.deltaMode===a.DOM_DELTA_LINE?Gw&&!Br?this.deltaY=-e.deltaY/3:this.deltaY=-e.deltaY:this.deltaY=-e.deltaY/40}if(typeof s.wheelDeltaX<"u")$ye&&I6?this.deltaX=-(s.wheelDeltaX/120):i?this.deltaX=s.wheelDeltaX/(120*o):this.deltaX=s.wheelDeltaX/120;else if(typeof r.HORIZONTAL_AXIS<"u"&&r.axis===r.HORIZONTAL_AXIS)this.deltaX=-e.detail/3;else if(e.type==="wheel"){let a=e;a.deltaMode===a.DOM_DELTA_LINE?Gw&&!Br?this.deltaX=-e.deltaX/3:this.deltaX=-e.deltaX:this.deltaX=-e.deltaX/40}this.deltaY===0&&this.deltaX===0&&e.wheelDelta&&(i?this.deltaY=e.wheelDelta/(120*o):this.deltaY=e.wheelDelta/120)}}preventDefault(){this.browserEvent?.preventDefault()}stopPropagation(){this.browserEvent?.stopPropagation()}},j6=Object.freeze(function(e,t){let n=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(n)}}}),obe;(e=>{function t(n){return n===e.None||n===e.Cancelled||n instanceof abe?!0:!n||typeof n!="object"?!1:typeof n.isCancellationRequested=="boolean"&&typeof n.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:si.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:j6})})(obe||={});var abe=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?j6:(this._emitter||(this._emitter=new we),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},j1=class{constructor(e,t){this._isDisposed=!1,this._token=-1,typeof e=="function"&&typeof t=="number"&&this.setIfNotSet(e,t)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(e,t){if(this._isDisposed)throw new zw("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,e()},t)}setIfNotSet(e,t){if(this._isDisposed)throw new zw("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,e()},t))}},lbe=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){this.disposable?.dispose(),this.disposable=void 0}cancelAndSet(e,t,n=globalThis){if(this.isDisposed)throw new zw("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let i=n.setInterval(()=>{e()},t);this.disposable=Zt(()=>{n.clearInterval(i),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},cbe;(e=>{async function t(i){let s,r=await Promise.all(i.map(o=>o.then(a=>a,a=>{s||(s=a)})));if(typeof s<"u")throw s;return r}e.settled=t;function n(i){return new Promise(async(s,r)=>{try{await i(s,r)}catch(o){r(o)}})}e.withAsyncBody=n})(cbe||={});var f2=class Es{static fromArray(t){return new Es(n=>{n.emitMany(t)})}static fromPromise(t){return new Es(async n=>{n.emitMany(await t)})}static fromPromises(t){return new Es(async n=>{await Promise.all(t.map(async i=>n.emitOne(await i)))})}static merge(t){return new Es(async n=>{await Promise.all(t.map(async i=>{for await(let s of i)n.emitOne(s)}))})}constructor(t,n){this._state=0,this._results=[],this._error=null,this._onReturn=n,this._onStateChanged=new we,queueMicrotask(async()=>{let i={emitOne:s=>this.emitOne(s),emitMany:s=>this.emitMany(s),reject:s=>this.reject(s)};try{await Promise.resolve(t(i)),this.resolve()}catch(s){this.reject(s)}finally{i.emitOne=void 0,i.emitMany=void 0,i.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await si.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(t,n){return new Es(async i=>{for await(let s of t)i.emitOne(n(s))})}map(t){return Es.map(this,t)}static filter(t,n){return new Es(async i=>{for await(let s of t)n(s)&&i.emitOne(s)})}filter(t){return Es.filter(this,t)}static coalesce(t){return Es.filter(t,n=>!!n)}coalesce(){return Es.coalesce(this)}static async toPromise(t){let n=[];for await(let i of t)n.push(i);return n}toPromise(){return Es.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};f2.EMPTY=f2.fromArray([]);var{getWindow:Nr,getWindowId:ube,onDidRegisterWindow:dbe}=(function(){let e=new Map,t={window:No,disposables:new Ba};e.set(No.vscodeWindowId,t);let n=new we,i=new we,s=new we;function r(o,a){return(typeof o=="number"?e.get(o):void 0)??(a?t:void 0)}return{onDidRegisterWindow:n.event,onWillUnregisterWindow:s.event,onDidUnregisterWindow:i.event,registerWindow(o){if(e.has(o.vscodeWindowId))return ct.None;let a=new Ba,c={window:o,disposables:a.add(new Ba)};return e.set(o.vscodeWindowId,c),a.add(Zt(()=>{e.delete(o.vscodeWindowId),i.fire(o)})),a.add(Ve(o,$n.BEFORE_UNLOAD,()=>{s.fire(o)})),n.fire(c),a},getWindows(){return e.values()},getWindowsCount(){return e.size},getWindowId(o){return o.vscodeWindowId},hasWindow(o){return e.has(o)},getWindowById:r,getWindow(o){let a=o;if(a?.ownerDocument?.defaultView)return a.ownerDocument.defaultView.window;let c=o;return c?.view?c.view.window:No},getDocument(o){return Nr(o).document}}})(),hbe=class{constructor(e,t,n,i){this._node=e,this._type=t,this._handler=n,this._options=i||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function Ve(e,t,n,i){return new hbe(e,t,n,i)}var p2=function(e,t,n,i){return Ve(e,t,n,i)},B1,fbe=class extends lbe{constructor(e){super(),this.defaultTarget=e&&Nr(e)}cancelAndSet(e,t,n){return super.cancelAndSet(e,t,n??this.defaultTarget)}},m2=class{constructor(e,t=0){this._runner=e,this.priority=t,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(e){Ng(e)}}static sort(e,t){return t.priority-e.priority}};(function(){let e=new Map,t=new Map,n=new Map,i=new Map,s=r=>{n.set(r,!1);let o=e.get(r)??[];for(t.set(r,o),e.set(r,[]),i.set(r,!0);o.length>0;)o.sort(m2.sort),o.shift().execute();i.set(r,!1)};B1=(r,o,a=0)=>{let c=ube(r),u=new m2(o,a),h=e.get(c);return h||(h=[],e.set(c,h)),h.push(u),n.get(c)||(n.set(c,!0),r.requestAnimationFrame(()=>s(c))),u}})();function pbe(e){let t=e.getBoundingClientRect(),n=Nr(e);return{left:t.left+n.scrollX,top:t.top+n.scrollY,width:t.width,height:t.height}}var $n={CLICK:"click",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",KEY_DOWN:"keydown",KEY_UP:"keyup",BEFORE_UNLOAD:"beforeunload",CHANGE:"change",FOCUS:"focus",BLUR:"blur",INPUT:"input"},mbe=class{constructor(e){this.domNode=e,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(e){let t=Fi(e);this._maxWidth!==t&&(this._maxWidth=t,this.domNode.style.maxWidth=this._maxWidth)}setWidth(e){let t=Fi(e);this._width!==t&&(this._width=t,this.domNode.style.width=this._width)}setHeight(e){let t=Fi(e);this._height!==t&&(this._height=t,this.domNode.style.height=this._height)}setTop(e){let t=Fi(e);this._top!==t&&(this._top=t,this.domNode.style.top=this._top)}setLeft(e){let t=Fi(e);this._left!==t&&(this._left=t,this.domNode.style.left=this._left)}setBottom(e){let t=Fi(e);this._bottom!==t&&(this._bottom=t,this.domNode.style.bottom=this._bottom)}setRight(e){let t=Fi(e);this._right!==t&&(this._right=t,this.domNode.style.right=this._right)}setPaddingTop(e){let t=Fi(e);this._paddingTop!==t&&(this._paddingTop=t,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft(e){let t=Fi(e);this._paddingLeft!==t&&(this._paddingLeft=t,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom(e){let t=Fi(e);this._paddingBottom!==t&&(this._paddingBottom=t,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight(e){let t=Fi(e);this._paddingRight!==t&&(this._paddingRight=t,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(e){let t=Fi(e);this._fontSize!==t&&(this._fontSize=t,this.domNode.style.fontSize=this._fontSize)}setFontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(e){this._fontFeatureSettings!==e&&(this._fontFeatureSettings=e,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(e){this._fontVariationSettings!==e&&(this._fontVariationSettings=e,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(e){this._textDecoration!==e&&(this._textDecoration=e,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(e){let t=Fi(e);this._lineHeight!==t&&(this._lineHeight=t,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(e){let t=Fi(e);this._letterSpacing!==t&&(this._letterSpacing=t,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(e){this._className!==e&&(this._className=e,this.domNode.className=this._className)}toggleClassName(e,t){this.domNode.classList.toggle(e,t),this._className=this.domNode.className}setDisplay(e){this._display!==e&&(this._display=e,this.domNode.style.display=this._display)}setPosition(e){this._position!==e&&(this._position=e,this.domNode.style.position=this._position)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this.domNode.style.visibility=this._visibility)}setColor(e){this._color!==e&&(this._color=e,this.domNode.style.color=this._color)}setBackgroundColor(e){this._backgroundColor!==e&&(this._backgroundColor=e,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(e){this._layerHint!==e&&(this._layerHint=e,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(e){this._boxShadow!==e&&(this._boxShadow=e,this.domNode.style.boxShadow=e)}setContain(e){this._contain!==e&&(this._contain=e,this.domNode.style.contain=this._contain)}setAttribute(e,t){this.domNode.setAttribute(e,t)}removeAttribute(e){this.domNode.removeAttribute(e)}appendChild(e){this.domNode.appendChild(e.domNode)}removeChild(e){this.domNode.removeChild(e.domNode)}};function Fi(e){return typeof e=="number"?`${e}px`:e}function Xh(e){return new mbe(e)}var B6=class{constructor(){this._hooks=new Ba,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(e,t){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let n=this._onStopCallback;this._onStopCallback=null,e&&n&&n(t)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(e,t,n,i,s){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=i,this._onStopCallback=s;let r=e;try{e.setPointerCapture(t),this._hooks.add(Zt(()=>{try{e.releasePointerCapture(t)}catch{}}))}catch{r=Nr(e)}this._hooks.add(Ve(r,$n.POINTER_MOVE,o=>{if(o.buttons!==n){this.stopMonitoring(!0);return}o.preventDefault(),this._pointerMoveCallback(o)})),this._hooks.add(Ve(r,$n.POINTER_UP,o=>this.stopMonitoring(!0)))}};function gbe(e,t,n){let i=null,s=null;if(typeof n.value=="function"?(i="value",s=n.value,s.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof n.get=="function"&&(i="get",s=n.get),!s)throw new Error("not supported");let r=`$memoize$${t}`;n[i]=function(...o){return this.hasOwnProperty(r)||Object.defineProperty(this,r,{configurable:!1,enumerable:!1,writable:!1,value:s.apply(this,o)}),this[r]}}var Tr;(e=>(e.Tap="-xterm-gesturetap",e.Change="-xterm-gesturechange",e.Start="-xterm-gesturestart",e.End="-xterm-gesturesend",e.Contextmenu="-xterm-gesturecontextmenu"))(Tr||={});var Th=class di extends ct{constructor(){super(),this.dispatched=!1,this.targets=new r2,this.ignoreTargets=new r2,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(si.runAndSubscribe(dbe,({window:t,disposables:n})=>{n.add(Ve(t.document,"touchstart",i=>this.onTouchStart(i),{passive:!1})),n.add(Ve(t.document,"touchend",i=>this.onTouchEnd(t,i))),n.add(Ve(t.document,"touchmove",i=>this.onTouchMove(i),{passive:!1}))},{window:No,disposables:this._store}))}static addTarget(t){if(!di.isTouchDevice())return ct.None;di.INSTANCE||(di.INSTANCE=new di);let n=di.INSTANCE.targets.push(t);return Zt(n)}static ignoreTarget(t){if(!di.isTouchDevice())return ct.None;di.INSTANCE||(di.INSTANCE=new di);let n=di.INSTANCE.ignoreTargets.push(t);return Zt(n)}static isTouchDevice(){return"ontouchstart"in No||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(t){let n=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let i=0,s=t.targetTouches.length;i<s;i++){let r=t.targetTouches.item(i);this.activeTouches[r.identifier]={id:r.identifier,initialTarget:r.target,initialTimeStamp:n,initialPageX:r.pageX,initialPageY:r.pageY,rollingTimestamps:[n],rollingPageX:[r.pageX],rollingPageY:[r.pageY]};let o=this.newGestureEvent(Tr.Start,r.target);o.pageX=r.pageX,o.pageY=r.pageY,this.dispatchEvent(o)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}onTouchEnd(t,n){let i=Date.now(),s=Object.keys(this.activeTouches).length;for(let r=0,o=n.changedTouches.length;r<o;r++){let a=n.changedTouches.item(r);if(!this.activeTouches.hasOwnProperty(String(a.identifier))){console.warn("move of an UNKNOWN touch",a);continue}let c=this.activeTouches[a.identifier],u=Date.now()-c.initialTimeStamp;if(u<di.HOLD_DELAY&&Math.abs(c.initialPageX-is(c.rollingPageX))<30&&Math.abs(c.initialPageY-is(c.rollingPageY))<30){let h=this.newGestureEvent(Tr.Tap,c.initialTarget);h.pageX=is(c.rollingPageX),h.pageY=is(c.rollingPageY),this.dispatchEvent(h)}else if(u>=di.HOLD_DELAY&&Math.abs(c.initialPageX-is(c.rollingPageX))<30&&Math.abs(c.initialPageY-is(c.rollingPageY))<30){let h=this.newGestureEvent(Tr.Contextmenu,c.initialTarget);h.pageX=is(c.rollingPageX),h.pageY=is(c.rollingPageY),this.dispatchEvent(h)}else if(s===1){let h=is(c.rollingPageX),f=is(c.rollingPageY),m=is(c.rollingTimestamps)-c.rollingTimestamps[0],y=h-c.rollingPageX[0],b=f-c.rollingPageY[0],S=[...this.targets].filter(_=>c.initialTarget instanceof Node&&_.contains(c.initialTarget));this.inertia(t,S,i,Math.abs(y)/m,y>0?1:-1,h,Math.abs(b)/m,b>0?1:-1,f)}this.dispatchEvent(this.newGestureEvent(Tr.End,c.initialTarget)),delete this.activeTouches[a.identifier]}this.dispatched&&(n.preventDefault(),n.stopPropagation(),this.dispatched=!1)}newGestureEvent(t,n){let i=document.createEvent("CustomEvent");return i.initEvent(t,!1,!0),i.initialTarget=n,i.tapCount=0,i}dispatchEvent(t){if(t.type===Tr.Tap){let n=new Date().getTime(),i=0;n-this._lastSetTapCountTime>di.CLEAR_TAP_COUNT_TIME?i=1:i=2,this._lastSetTapCountTime=n,t.tapCount=i}else(t.type===Tr.Change||t.type===Tr.Contextmenu)&&(this._lastSetTapCountTime=0);if(t.initialTarget instanceof Node){for(let i of this.ignoreTargets)if(i.contains(t.initialTarget))return;let n=[];for(let i of this.targets)if(i.contains(t.initialTarget)){let s=0,r=t.initialTarget;for(;r&&r!==i;)s++,r=r.parentElement;n.push([s,i])}n.sort((i,s)=>i[0]-s[0]);for(let[i,s]of n)s.dispatchEvent(t),this.dispatched=!0}}inertia(t,n,i,s,r,o,a,c,u){this.handle=B1(t,()=>{let h=Date.now(),f=h-i,m=0,y=0,b=!0;s+=di.SCROLL_FRICTION*f,a+=di.SCROLL_FRICTION*f,s>0&&(b=!1,m=r*s*f),a>0&&(b=!1,y=c*a*f);let S=this.newGestureEvent(Tr.Change);S.translationX=m,S.translationY=y,n.forEach(_=>_.dispatchEvent(S)),b||this.inertia(t,n,h,s,r,o+m,a,c,u+y)})}onTouchMove(t){let n=Date.now();for(let i=0,s=t.changedTouches.length;i<s;i++){let r=t.changedTouches.item(i);if(!this.activeTouches.hasOwnProperty(String(r.identifier))){console.warn("end of an UNKNOWN touch",r);continue}let o=this.activeTouches[r.identifier],a=this.newGestureEvent(Tr.Change,o.initialTarget);a.translationX=r.pageX-is(o.rollingPageX),a.translationY=r.pageY-is(o.rollingPageY),a.pageX=r.pageX,a.pageY=r.pageY,this.dispatchEvent(a),o.rollingPageX.length>3&&(o.rollingPageX.shift(),o.rollingPageY.shift(),o.rollingTimestamps.shift()),o.rollingPageX.push(r.pageX),o.rollingPageY.push(r.pageY),o.rollingTimestamps.push(n)}this.dispatched&&(t.preventDefault(),t.stopPropagation(),this.dispatched=!1)}};Th.SCROLL_FRICTION=-.005,Th.HOLD_DELAY=700,Th.CLEAR_TAP_COUNT_TIME=400,dn([gbe],Th,"isTouchDevice",1);var vbe=Th,F1=class extends ct{onclick(e,t){this._register(Ve(e,$n.CLICK,n=>t(new Xm(Nr(e),n))))}onmousedown(e,t){this._register(Ve(e,$n.MOUSE_DOWN,n=>t(new Xm(Nr(e),n))))}onmouseover(e,t){this._register(Ve(e,$n.MOUSE_OVER,n=>t(new Xm(Nr(e),n))))}onmouseleave(e,t){this._register(Ve(e,$n.MOUSE_LEAVE,n=>t(new Xm(Nr(e),n))))}onkeydown(e,t){this._register(Ve(e,$n.KEY_DOWN,n=>t(new u2(n))))}onkeyup(e,t){this._register(Ve(e,$n.KEY_UP,n=>t(new u2(n))))}oninput(e,t){this._register(Ve(e,$n.INPUT,t))}onblur(e,t){this._register(Ve(e,$n.BLUR,t))}onfocus(e,t){this._register(Ve(e,$n.FOCUS,t))}onchange(e,t){this._register(Ve(e,$n.CHANGE,t))}ignoreGesture(e){return vbe.ignoreTarget(e)}},g2=11,ybe=class extends F1{constructor(e){super(),this._onActivate=e.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=e.bgWidth+"px",this.bgDomNode.style.height=e.bgHeight+"px",typeof e.top<"u"&&(this.bgDomNode.style.top="0px"),typeof e.left<"u"&&(this.bgDomNode.style.left="0px"),typeof e.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof e.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=e.className,this.domNode.style.position="absolute",this.domNode.style.width=g2+"px",this.domNode.style.height=g2+"px",typeof e.top<"u"&&(this.domNode.style.top=e.top+"px"),typeof e.left<"u"&&(this.domNode.style.left=e.left+"px"),typeof e.bottom<"u"&&(this.domNode.style.bottom=e.bottom+"px"),typeof e.right<"u"&&(this.domNode.style.right=e.right+"px"),this._pointerMoveMonitor=this._register(new B6),this._register(p2(this.bgDomNode,$n.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._register(p2(this.domNode,$n.POINTER_DOWN,t=>this._arrowPointerDown(t))),this._pointerdownRepeatTimer=this._register(new fbe),this._pointerdownScheduleRepeatTimer=this._register(new j1)}_arrowPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),1e3/24,Nr(e))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(t,200),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,n=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),e.preventDefault()}},bbe=class Xw{constructor(t,n,i,s,r,o,a){this._forceIntegerValues=t,this._scrollStateBrand=void 0,this._forceIntegerValues&&(n=n|0,i=i|0,s=s|0,r=r|0,o=o|0,a=a|0),this.rawScrollLeft=s,this.rawScrollTop=a,n<0&&(n=0),s+n>i&&(s=i-n),s<0&&(s=0),r<0&&(r=0),a+r>o&&(a=o-r),a<0&&(a=0),this.width=n,this.scrollWidth=i,this.scrollLeft=s,this.height=r,this.scrollHeight=o,this.scrollTop=a}equals(t){return this.rawScrollLeft===t.rawScrollLeft&&this.rawScrollTop===t.rawScrollTop&&this.width===t.width&&this.scrollWidth===t.scrollWidth&&this.scrollLeft===t.scrollLeft&&this.height===t.height&&this.scrollHeight===t.scrollHeight&&this.scrollTop===t.scrollTop}withScrollDimensions(t,n){return new Xw(this._forceIntegerValues,typeof t.width<"u"?t.width:this.width,typeof t.scrollWidth<"u"?t.scrollWidth:this.scrollWidth,n?this.rawScrollLeft:this.scrollLeft,typeof t.height<"u"?t.height:this.height,typeof t.scrollHeight<"u"?t.scrollHeight:this.scrollHeight,n?this.rawScrollTop:this.scrollTop)}withScrollPosition(t){return new Xw(this._forceIntegerValues,this.width,this.scrollWidth,typeof t.scrollLeft<"u"?t.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof t.scrollTop<"u"?t.scrollTop:this.rawScrollTop)}createScrollEvent(t,n){let i=this.width!==t.width,s=this.scrollWidth!==t.scrollWidth,r=this.scrollLeft!==t.scrollLeft,o=this.height!==t.height,a=this.scrollHeight!==t.scrollHeight,c=this.scrollTop!==t.scrollTop;return{inSmoothScrolling:n,oldWidth:t.width,oldScrollWidth:t.scrollWidth,oldScrollLeft:t.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:t.height,oldScrollHeight:t.scrollHeight,oldScrollTop:t.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:i,scrollWidthChanged:s,scrollLeftChanged:r,heightChanged:o,scrollHeightChanged:a,scrollTopChanged:c}}},_be=class extends ct{constructor(e){super(),this._scrollableBrand=void 0,this._onScroll=this._register(new we),this.onScroll=this._onScroll.event,this._smoothScrollDuration=e.smoothScrollDuration,this._scheduleAtNextAnimationFrame=e.scheduleAtNextAnimationFrame,this._state=new bbe(e.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(e){this._smoothScrollDuration=e}validateScrollPosition(e){return this._state.withScrollPosition(e)}getScrollDimensions(){return this._state}setScrollDimensions(e,t){let n=this._state.withScrollDimensions(e,t);this._setState(n,!!this._smoothScrolling),this._smoothScrolling?.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(e){let t=this._state.withScrollPosition(e);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(t,!1)}setScrollPositionSmooth(e,t){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(e);if(this._smoothScrolling){e={scrollLeft:typeof e.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:e.scrollLeft,scrollTop:typeof e.scrollTop>"u"?this._smoothScrolling.to.scrollTop:e.scrollTop};let n=this._state.withScrollPosition(e);if(this._smoothScrolling.to.scrollLeft===n.scrollLeft&&this._smoothScrolling.to.scrollTop===n.scrollTop)return;let i;t?i=new y2(this._smoothScrolling.from,n,this._smoothScrolling.startTime,this._smoothScrolling.duration):i=this._smoothScrolling.combine(this._state,n,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=i}else{let n=this._state.withScrollPosition(e);this._smoothScrolling=y2.start(this._state,n,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let e=this._smoothScrolling.tick(),t=this._state.withScrollPosition(e);if(this._setState(t,!0),!!this._smoothScrolling){if(e.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(e,t){let n=this._state;n.equals(e)||(this._state=e,this._onScroll.fire(this._state.createScrollEvent(n,t)))}},v2=class{constructor(e,t,n){this.scrollLeft=e,this.scrollTop=t,this.isDone=n}};function WS(e,t){let n=t-e;return function(i){return e+n*wbe(i)}}function Sbe(e,t,n){return function(i){return i<n?e(i/n):t((i-n)/(1-n))}}var y2=class Qw{constructor(t,n,i,s){this.from=t,this.to=n,this.duration=s,this.startTime=i,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(t,n,i){if(Math.abs(t-n)>2.5*i){let s,r;return t<n?(s=t+.75*i,r=n-.75*i):(s=t-.75*i,r=n+.75*i),Sbe(WS(t,s),WS(r,n),.33)}return WS(t,n)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(t){this.to=t.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(t){let n=(t-this.startTime)/this.duration;if(n<1){let i=this.scrollLeft(n),s=this.scrollTop(n);return new v2(i,s,!1)}return new v2(this.to.scrollLeft,this.to.scrollTop,!0)}combine(t,n,i){return Qw.start(t,n,i)}static start(t,n,i){i=i+10;let s=Date.now()-10;return new Qw(t,n,s,i)}};function xbe(e){return Math.pow(e,3)}function wbe(e){return 1-xbe(1-e)}var Cbe=class extends ct{constructor(e,t,n){super(),this._visibility=e,this._visibleClassName=t,this._invisibleClassName=n,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new j1)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this._updateShouldBeVisible())}setShouldBeVisible(e){this._rawShouldBeVisible=e,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let e=this._applyVisibilitySetting();this._shouldBeVisible!==e&&(this._shouldBeVisible=e,this.ensureVisibility())}setIsNeeded(e){this._isNeeded!==e&&(this._isNeeded=e,this.ensureVisibility())}setDomNode(e){this._domNode=e,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{this._domNode?.setClassName(this._visibleClassName)},0))}_hide(e){this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,this._domNode?.setClassName(this._invisibleClassName+(e?" fade":"")))}},kbe=140,F6=class extends F1{constructor(e){super(),this._lazyRender=e.lazyRender,this._host=e.host,this._scrollable=e.scrollable,this._scrollByPage=e.scrollByPage,this._scrollbarState=e.scrollbarState,this._visibilityController=this._register(new Cbe(e.visibility,"visible scrollbar "+e.extraScrollbarClassName,"invisible scrollbar "+e.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new B6),this._shouldRender=!0,this.domNode=Xh(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(Ve(this.domNode.domNode,$n.POINTER_DOWN,t=>this._domNodePointerDown(t)))}_createArrow(e){let t=this._register(new ybe(e));this.domNode.domNode.appendChild(t.bgDomNode),this.domNode.domNode.appendChild(t.domNode)}_createSlider(e,t,n,i){this.slider=Xh(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(e),this.slider.setLeft(t),typeof n=="number"&&this.slider.setWidth(n),typeof i=="number"&&this.slider.setHeight(i),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(Ve(this.slider.domNode,$n.POINTER_DOWN,s=>{s.button===0&&(s.preventDefault(),this._sliderPointerDown(s))})),this.onclick(this.slider.domNode,s=>{s.leftButton&&s.stopPropagation()})}_onElementSize(e){return this._scrollbarState.setVisibleSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(e){return this._scrollbarState.setScrollSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(e){return this._scrollbarState.setScrollPosition(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(e){e.target===this.domNode.domNode&&this._onPointerDown(e)}delegatePointerDown(e){let t=this.domNode.domNode.getClientRects()[0].top,n=t+this._scrollbarState.getSliderPosition(),i=t+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),s=this._sliderPointerPosition(e);n<=s&&s<=i?e.button===0&&(e.preventDefault(),this._sliderPointerDown(e)):this._onPointerDown(e)}_onPointerDown(e){let t,n;if(e.target===this.domNode.domNode&&typeof e.offsetX=="number"&&typeof e.offsetY=="number")t=e.offsetX,n=e.offsetY;else{let s=pbe(this.domNode.domNode);t=e.pageX-s.left,n=e.pageY-s.top}let i=this._pointerDownRelativePosition(t,n);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(i):this._scrollbarState.getDesiredScrollPositionFromOffset(i)),e.button===0&&(e.preventDefault(),this._sliderPointerDown(e))}_sliderPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let t=this._sliderPointerPosition(e),n=this._sliderOrthogonalPointerPosition(e),i=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,s=>{let r=this._sliderOrthogonalPointerPosition(s),o=Math.abs(r-n);if(I6&&o>kbe){this._setDesiredScrollPositionNow(i.getScrollPosition());return}let a=this._sliderPointerPosition(s)-t;this._setDesiredScrollPositionNow(i.getDesiredScrollPositionFromDelta(a))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(e){let t={};this.writeScrollPosition(t,e),this._scrollable.setScrollPositionNow(t)}updateScrollbarSize(e){this._updateScrollbarSize(e),this._scrollbarState.setScrollbarSize(e),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},U6=class Jw{constructor(t,n,i,s,r,o){this._scrollbarSize=Math.round(n),this._oppositeScrollbarSize=Math.round(i),this._arrowSize=Math.round(t),this._visibleSize=s,this._scrollSize=r,this._scrollPosition=o,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new Jw(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(t){let n=Math.round(t);return this._visibleSize!==n?(this._visibleSize=n,this._refreshComputedValues(),!0):!1}setScrollSize(t){let n=Math.round(t);return this._scrollSize!==n?(this._scrollSize=n,this._refreshComputedValues(),!0):!1}setScrollPosition(t){let n=Math.round(t);return this._scrollPosition!==n?(this._scrollPosition=n,this._refreshComputedValues(),!0):!1}setScrollbarSize(t){this._scrollbarSize=Math.round(t)}setOppositeScrollbarSize(t){this._oppositeScrollbarSize=Math.round(t)}static _computeValues(t,n,i,s,r){let o=Math.max(0,i-t),a=Math.max(0,o-2*n),c=s>0&&s>i;if(!c)return{computedAvailableSize:Math.round(o),computedIsNeeded:c,computedSliderSize:Math.round(a),computedSliderRatio:0,computedSliderPosition:0};let u=Math.round(Math.max(20,Math.floor(i*a/s))),h=(a-u)/(s-i),f=r*h;return{computedAvailableSize:Math.round(o),computedIsNeeded:c,computedSliderSize:Math.round(u),computedSliderRatio:h,computedSliderPosition:Math.round(f)}}_refreshComputedValues(){let t=Jw._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=t.computedAvailableSize,this._computedIsNeeded=t.computedIsNeeded,this._computedSliderSize=t.computedSliderSize,this._computedSliderRatio=t.computedSliderRatio,this._computedSliderPosition=t.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(t){if(!this._computedIsNeeded)return 0;let n=t-this._arrowSize-this._computedSliderSize/2;return Math.round(n/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(t){if(!this._computedIsNeeded)return 0;let n=t-this._arrowSize,i=this._scrollPosition;return n<this._computedSliderPosition?i-=this._visibleSize:i+=this._visibleSize,i}getDesiredScrollPositionFromDelta(t){if(!this._computedIsNeeded)return 0;let n=this._computedSliderPosition+t;return Math.round(n/this._computedSliderRatio)}},Tbe=class extends F6{constructor(e,t,n){let i=e.getScrollDimensions(),s=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:n,scrollbarState:new U6(t.horizontalHasArrows?t.arrowSize:0,t.horizontal===2?0:t.horizontalScrollbarSize,t.vertical===2?0:t.verticalScrollbarSize,i.width,i.scrollWidth,s.scrollLeft),visibility:t.horizontal,extraScrollbarClassName:"horizontal",scrollable:e,scrollByPage:t.scrollByPage}),t.horizontalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((t.horizontalScrollbarSize-t.horizontalSliderSize)/2),0,void 0,t.horizontalSliderSize)}_updateSlider(e,t){this.slider.setWidth(e),this.slider.setLeft(t)}_renderDomNode(e,t){this.domNode.setWidth(e),this.domNode.setHeight(t),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(e.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return e}_sliderPointerPosition(e){return e.pageX}_sliderOrthogonalPointerPosition(e){return e.pageY}_updateScrollbarSize(e){this.slider.setHeight(e)}writeScrollPosition(e,t){e.scrollLeft=t}updateOptions(e){this.updateScrollbarSize(e.horizontal===2?0:e.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._visibilityController.setVisibility(e.horizontal),this._scrollByPage=e.scrollByPage}},Ebe=class extends F6{constructor(e,t,n){let i=e.getScrollDimensions(),s=e.getCurrentScrollPosition();if(super({lazyRender:t.lazyRender,host:n,scrollbarState:new U6(t.verticalHasArrows?t.arrowSize:0,t.vertical===2?0:t.verticalScrollbarSize,0,i.height,i.scrollHeight,s.scrollTop),visibility:t.vertical,extraScrollbarClassName:"vertical",scrollable:e,scrollByPage:t.scrollByPage}),t.verticalHasArrows)throw new Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((t.verticalScrollbarSize-t.verticalSliderSize)/2),t.verticalSliderSize,void 0)}_updateSlider(e,t){this.slider.setHeight(e),this.slider.setTop(t)}_renderDomNode(e,t){this.domNode.setWidth(t),this.domNode.setHeight(e),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(e.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,t){return t}_sliderPointerPosition(e){return e.pageY}_sliderOrthogonalPointerPosition(e){return e.pageX}_updateScrollbarSize(e){this.slider.setWidth(e)}writeScrollPosition(e,t){e.scrollTop=t}updateOptions(e){this.updateScrollbarSize(e.vertical===2?0:e.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(e.vertical),this._scrollByPage=e.scrollByPage}},Rbe=500,b2=50,Mbe=class{constructor(e,t,n){this.timestamp=e,this.deltaX=t,this.deltaY=n,this.score=0}},Zw=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let t=1,n=0,i=1,s=this._rear;do{let r=s===this._front?t:Math.pow(2,-i);if(t-=r,n+=this._memory[s].score*r,s===this._front)break;s=(this._capacity+s-1)%this._capacity,i++}while(!0);return n<=.5}acceptStandardWheelEvent(t){if(D1){let n=Nr(t.browserEvent),i=Uye(n);this.accept(Date.now(),t.deltaX*i,t.deltaY*i)}else this.accept(Date.now(),t.deltaX,t.deltaY)}accept(t,n,i){let s=null,r=new Mbe(t,n,i);this._front===-1&&this._rear===-1?(this._memory[0]=r,this._front=0,this._rear=0):(s=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=r),r.score=this._computeScore(r,s)}_computeScore(t,n){if(Math.abs(t.deltaX)>0&&Math.abs(t.deltaY)>0)return 1;let i=.5;if((!this._isAlmostInt(t.deltaX)||!this._isAlmostInt(t.deltaY))&&(i+=.25),n){let s=Math.abs(t.deltaX),r=Math.abs(t.deltaY),o=Math.abs(n.deltaX),a=Math.abs(n.deltaY),c=Math.max(Math.min(s,o),1),u=Math.max(Math.min(r,a),1),h=Math.max(s,o),f=Math.max(r,a);h%c===0&&f%u===0&&(i-=.5)}return Math.min(Math.max(i,0),1)}_isAlmostInt(t){return Math.abs(Math.round(t)-t)<.01}};Zw.INSTANCE=new Zw;var Abe=Zw,Pbe=class extends F1{constructor(e,t,n){super(),this._onScroll=this._register(new we),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new we),this.onWillScroll=this._onWillScroll.event,this._options=Nbe(t),this._scrollable=n,this._register(this._scrollable.onScroll(s=>{this._onWillScroll.fire(s),this._onDidScroll(s),this._onScroll.fire(s)}));let i={onMouseWheel:s=>this._onMouseWheel(s),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new Ebe(this._scrollable,this._options,i)),this._horizontalScrollbar=this._register(new Tbe(this._scrollable,this._options,i)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild(e),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=Xh(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=Xh(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=Xh(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,s=>this._onMouseOver(s)),this.onmouseleave(this._listenOnDomNode,s=>this._onMouseLeave(s)),this._hideTimeout=this._register(new j1),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=Yl(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(e){this._verticalScrollbar.delegatePointerDown(e)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(e){this._scrollable.setScrollDimensions(e,!1)}updateClassName(e){this._options.className=e,Br&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions(e){typeof e.handleMouseWheel<"u"&&(this._options.handleMouseWheel=e.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof e.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=e.mouseWheelScrollSensitivity),typeof e.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=e.fastScrollSensitivity),typeof e.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=e.scrollPredominantAxis),typeof e.horizontal<"u"&&(this._options.horizontal=e.horizontal),typeof e.vertical<"u"&&(this._options.vertical=e.vertical),typeof e.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=e.horizontalScrollbarSize),typeof e.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=e.verticalScrollbarSize),typeof e.scrollByPage<"u"&&(this._options.scrollByPage=e.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll(e){this._revealOnScroll=e}delegateScrollFromMouseWheelEvent(e){this._onMouseWheel(new h2(e))}_setListeningToMouseWheel(e){if(this._mouseWheelToDispose.length>0!==e&&(this._mouseWheelToDispose=Yl(this._mouseWheelToDispose),e)){let t=n=>{this._onMouseWheel(new h2(n))};this._mouseWheelToDispose.push(Ve(this._listenOnDomNode,$n.MOUSE_WHEEL,t,{passive:!1}))}}_onMouseWheel(e){if(e.browserEvent?.defaultPrevented)return;let t=Abe.INSTANCE;t.acceptStandardWheelEvent(e);let n=!1;if(e.deltaY||e.deltaX){let s=e.deltaY*this._options.mouseWheelScrollSensitivity,r=e.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&r+s===0?r=s=0:Math.abs(s)>=Math.abs(r)?r=0:s=0),this._options.flipAxes&&([s,r]=[r,s]);let o=!Br&&e.browserEvent&&e.browserEvent.shiftKey;(this._options.scrollYToX||o)&&!r&&(r=s,s=0),e.browserEvent&&e.browserEvent.altKey&&(r=r*this._options.fastScrollSensitivity,s=s*this._options.fastScrollSensitivity);let a=this._scrollable.getFutureScrollPosition(),c={};if(s){let u=b2*s,h=a.scrollTop-(u<0?Math.floor(u):Math.ceil(u));this._verticalScrollbar.writeScrollPosition(c,h)}if(r){let u=b2*r,h=a.scrollLeft-(u<0?Math.floor(u):Math.ceil(u));this._horizontalScrollbar.writeScrollPosition(c,h)}c=this._scrollable.validateScrollPosition(c),(a.scrollLeft!==c.scrollLeft||a.scrollTop!==c.scrollTop)&&(this._options.mouseWheelSmoothScroll&&t.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(c):this._scrollable.setScrollPositionNow(c),n=!0)}let i=n;!i&&this._options.alwaysConsumeMouseWheel&&(i=!0),!i&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(i=!0),i&&(e.preventDefault(),e.stopPropagation())}_onDidScroll(e){this._shouldRender=this._horizontalScrollbar.onDidScroll(e)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(e)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw new Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let e=this._scrollable.getCurrentScrollPosition(),t=e.scrollTop>0,n=e.scrollLeft>0,i=n?" left":"",s=t?" top":"",r=n||t?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${i}`),this._topShadowDomNode.setClassName(`shadow${s}`),this._topLeftShadowDomNode.setClassName(`shadow${r}${s}${i}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(e){this._mouseIsOver=!1,this._hide()}_onMouseOver(e){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),Rbe)}},Lbe=class extends Pbe{constructor(e,t,n){super(e,t,n)}setScrollPosition(e){e.reuseAnimation?this._scrollable.setScrollPositionSmooth(e,e.reuseAnimation):this._scrollable.setScrollPositionNow(e)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function Nbe(e){let t={lazyRender:typeof e.lazyRender<"u"?e.lazyRender:!1,className:typeof e.className<"u"?e.className:"",useShadows:typeof e.useShadows<"u"?e.useShadows:!0,handleMouseWheel:typeof e.handleMouseWheel<"u"?e.handleMouseWheel:!0,flipAxes:typeof e.flipAxes<"u"?e.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof e.consumeMouseWheelIfScrollbarIsNeeded<"u"?e.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof e.alwaysConsumeMouseWheel<"u"?e.alwaysConsumeMouseWheel:!1,scrollYToX:typeof e.scrollYToX<"u"?e.scrollYToX:!1,mouseWheelScrollSensitivity:typeof e.mouseWheelScrollSensitivity<"u"?e.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof e.fastScrollSensitivity<"u"?e.fastScrollSensitivity:5,scrollPredominantAxis:typeof e.scrollPredominantAxis<"u"?e.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof e.mouseWheelSmoothScroll<"u"?e.mouseWheelSmoothScroll:!0,arrowSize:typeof e.arrowSize<"u"?e.arrowSize:11,listenOnDomNode:typeof e.listenOnDomNode<"u"?e.listenOnDomNode:null,horizontal:typeof e.horizontal<"u"?e.horizontal:1,horizontalScrollbarSize:typeof e.horizontalScrollbarSize<"u"?e.horizontalScrollbarSize:10,horizontalSliderSize:typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:0,horizontalHasArrows:typeof e.horizontalHasArrows<"u"?e.horizontalHasArrows:!1,vertical:typeof e.vertical<"u"?e.vertical:1,verticalScrollbarSize:typeof e.verticalScrollbarSize<"u"?e.verticalScrollbarSize:10,verticalHasArrows:typeof e.verticalHasArrows<"u"?e.verticalHasArrows:!1,verticalSliderSize:typeof e.verticalSliderSize<"u"?e.verticalSliderSize:0,scrollByPage:typeof e.scrollByPage<"u"?e.scrollByPage:!1};return t.horizontalSliderSize=typeof e.horizontalSliderSize<"u"?e.horizontalSliderSize:t.horizontalScrollbarSize,t.verticalSliderSize=typeof e.verticalSliderSize<"u"?e.verticalSliderSize:t.verticalScrollbarSize,Br&&(t.className+=" mac"),t}var eC=class extends ct{constructor(e,t,n,i,s,r,o,a){super(),this._bufferService=n,this._optionsService=o,this._renderService=a,this._onRequestScrollLines=this._register(new we),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let c=this._register(new _be({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:u=>B1(i.window,u)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{c.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new Lbe(t,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},c)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(s.onProtocolChange(u=>{this._scrollableElement.updateOptions({handleMouseWheel:!(u&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(si.runAndSubscribe(r.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=r.colors.background.css})),e.appendChild(this._scrollableElement.getDomNode()),this._register(Zt(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=i.mainDocument.createElement("style"),t.appendChild(this._styleElement),this._register(Zt(()=>this._styleElement.remove())),this._register(si.runAndSubscribe(r.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${r.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${r.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${r.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll(u=>this._handleScroll(u)))}scrollLines(e){let t=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:t.scrollTop+e*this._renderService.dimensions.css.cell.height})}scrollToLine(e,t){t&&(this._latestYDisp=e),this._scrollableElement.setScrollPosition({reuseAnimation:!t,scrollTop:e*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:this._optionsService.rawOptions.overviewRuler?.width||14}}queueSync(e){e!==void 0&&(this._latestYDisp=e),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync(e=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,e!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:e*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll(e){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let t=Math.round(e.scrollTop/this._renderService.dimensions.css.cell.height),n=t-this._bufferService.buffer.ydisp;n!==0&&(this._latestYDisp=t,this._onRequestScrollLines.fire(n)),this._isHandlingScroll=!1}};eC=dn([Re(2,Ai),Re(3,Uo),Re(4,_6),Re(5,td),Re(6,Pi),Re(7,zo)],eC);var tC=class extends ct{constructor(e,t,n,i,s){super(),this._screenElement=e,this._bufferService=t,this._coreBrowserService=n,this._decorationService=i,this._renderService=s,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved(r=>this._removeDecoration(r))),this._register(Zt(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){let t=this._coreBrowserService.mainDocument.createElement("div");t.classList.add("xterm-decoration"),t.classList.toggle("xterm-decoration-top-layer",e?.options?.layer==="top"),t.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,t.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,t.style.top=`${(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,t.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let n=e.options.x??0;return n&&n>this._bufferService.cols&&(t.style.display="none"),this._refreshXPosition(e,t),t}_refreshStyle(e){let t=e.marker.line-this._bufferService.buffers.active.ydisp;if(t<0||t>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let n=this._decorationElements.get(e);n||(n=this._createElement(e),e.element=n,this._decorationElements.set(e,n),this._container.appendChild(n),e.onDispose(()=>{this._decorationElements.delete(e),n.remove()})),n.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(n.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,n.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,n.style.top=`${t*this._renderService.dimensions.css.cell.height}px`,n.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),e.onRenderEmitter.fire(n)}}_refreshXPosition(e,t=e.element){if(!t)return;let n=e.options.x??0;(e.options.anchor||"left")==="right"?t.style.right=n?`${n*this._renderService.dimensions.css.cell.width}px`:"":t.style.left=n?`${n*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration(e){this._decorationElements.get(e)?.remove(),this._decorationElements.delete(e),e.dispose()}};tC=dn([Re(1,Ai),Re(2,Uo),Re(3,Yf),Re(4,zo)],tC);var Ibe=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(let t of this._zones)if(t.color===e.options.overviewRulerOptions.color&&t.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(t,e.marker.line))return;if(this._lineAdjacentToZone(t,e.marker.line,e.options.overviewRulerOptions.position)){this._addLineToZone(t,e.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,t){return t>=e.startBufferLine&&t<=e.endBufferLine}_lineAdjacentToZone(e,t,n){return t>=e.startBufferLine-this._linePadding[n||"full"]&&t<=e.endBufferLine+this._linePadding[n||"full"]}_addLineToZone(e,t){e.startBufferLine=Math.min(e.startBufferLine,t),e.endBufferLine=Math.max(e.endBufferLine,t)}},xr={full:0,left:0,center:0,right:0},va={full:0,left:0,center:0,right:0},dh={full:0,left:0,center:0,right:0},Uv=class extends ct{constructor(e,t,n,i,s,r,o,a){super(),this._viewportElement=e,this._screenElement=t,this._bufferService=n,this._decorationService=i,this._renderService=s,this._optionsService=r,this._themeService=o,this._coreBrowserService=a,this._colorZoneStore=new Ibe,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement),this._register(Zt(()=>this._canvas?.remove()));let c=this._canvas.getContext("2d");if(c)this._ctx=c;else throw new Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){return this._optionsService.options.overviewRuler?.width||0}_refreshDrawConstants(){let e=Math.floor((this._canvas.width-1)/3),t=Math.ceil((this._canvas.width-1)/3);va.full=this._canvas.width,va.left=e,va.center=t,va.right=e,this._refreshDrawHeightConstants(),dh.full=1,dh.left=1,dh.center=1+va.left,dh.right=1+va.left+va.center}_refreshDrawHeightConstants(){xr.full=Math.round(2*this._coreBrowserService.dpr);let e=this._canvas.height/this._bufferService.buffer.lines.length,t=Math.round(Math.max(Math.min(e,12),6)*this._coreBrowserService.dpr);xr.left=t,xr.center=t,xr.right=t}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*xr.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*xr.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*xr.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*xr.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let t of this._decorationService.decorations)this._colorZoneStore.addDecoration(t);this._ctx.lineWidth=1,this._renderRulerOutline();let e=this._colorZoneStore.zones;for(let t of e)t.position!=="full"&&this._renderColorZone(t);for(let t of e)t.position==="full"&&this._renderColorZone(t);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(dh[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-xr[e.position||"full"]/2),va[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+xr[e.position||"full"]))}_queueRefresh(e,t){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=t||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};Uv=dn([Re(2,Ai),Re(3,Yf),Re(4,zo),Re(5,Pi),Re(6,td),Re(7,Uo)],Uv);var fe;(e=>(e.NUL="\0",e.SOH="",e.STX="",e.ETX="",e.EOT="",e.ENQ="",e.ACK="",e.BEL="\x07",e.BS="\b",e.HT="	",e.LF=`
`,e.VT="\v",e.FF="\f",e.CR="\r",e.SO="",e.SI="",e.DLE="",e.DC1="",e.DC2="",e.DC3="",e.DC4="",e.NAK="",e.SYN="",e.ETB="",e.CAN="",e.EM="",e.SUB="",e.ESC="\x1B",e.FS="",e.GS="",e.RS="",e.US="",e.SP=" ",e.DEL=""))(fe||={});var Og;(e=>(e.PAD="",e.HOP="",e.BPH="",e.NBH="",e.IND="",e.NEL="",e.SSA="",e.ESA="",e.HTS="",e.HTJ="",e.VTS="",e.PLD="",e.PLU="",e.RI="",e.SS2="",e.SS3="",e.DCS="",e.PU1="",e.PU2="",e.STS="",e.CCH="",e.MW="",e.SPA="",e.EPA="",e.SOS="",e.SGCI="",e.SCI="",e.CSI="",e.ST="",e.OSC="",e.PM="",e.APC=""))(Og||={});var z6;(e=>e.ST=`${fe.ESC}\\`)(z6||={});var nC=class{constructor(e,t,n,i,s,r){this._textarea=e,this._compositionView=t,this._bufferService=n,this._optionsService=i,this._coreService=s,this._renderService=r,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(e.keyCode===20||e.keyCode===229||e.keyCode===16||e.keyCode===17||e.keyCode===18)return!1;this._finalizeComposition(!1)}return e.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){let t={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let n;t.start+=this._dataAlreadySent.length,this._isComposing?n=this._textarea.value.substring(t.start,this._compositionPosition.start):n=this._textarea.value.substring(t.start),n.length>0&&this._coreService.triggerDataEvent(n,!0)}},0)}else{this._isSendingComposition=!1;let t=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(t,!0)}}_handleAnyTextareaChanges(){let e=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let t=this._textarea.value,n=t.replace(e,"");this._dataAlreadySent=n,t.length>e.length?this._coreService.triggerDataEvent(n,!0):t.length<e.length?this._coreService.triggerDataEvent(`${fe.DEL}`,!0):t.length===e.length&&t!==e&&this._coreService.triggerDataEvent(t,!0)}},0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let t=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),n=this._renderService.dimensions.css.cell.height,i=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,s=t*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=s+"px",this._compositionView.style.top=i+"px",this._compositionView.style.height=n+"px",this._compositionView.style.lineHeight=n+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let r=this._compositionView.getBoundingClientRect();this._textarea.style.left=s+"px",this._textarea.style.top=i+"px",this._textarea.style.width=Math.max(r.width,1)+"px",this._textarea.style.height=Math.max(r.height,1)+"px",this._textarea.style.lineHeight=r.height+"px"}e||setTimeout(()=>this.updateCompositionElements(!0),0)}}};nC=dn([Re(2,Ai),Re(3,Pi),Re(4,oc),Re(5,zo)],nC);var qn=0,Hn=0,Vn=0,ln=0,_2={css:"#00000000",rgba:0},Rn;(e=>{function t(s,r,o,a){return a!==void 0?`#${bl(s)}${bl(r)}${bl(o)}${bl(a)}`:`#${bl(s)}${bl(r)}${bl(o)}`}e.toCss=t;function n(s,r,o,a=255){return(s<<24|r<<16|o<<8|a)>>>0}e.toRgba=n;function i(s,r,o,a){return{css:e.toCss(s,r,o,a),rgba:e.toRgba(s,r,o,a)}}e.toColor=i})(Rn||={});var Yt;(e=>{function t(c,u){if(ln=(u.rgba&255)/255,ln===1)return{css:u.css,rgba:u.rgba};let h=u.rgba>>24&255,f=u.rgba>>16&255,m=u.rgba>>8&255,y=c.rgba>>24&255,b=c.rgba>>16&255,S=c.rgba>>8&255;qn=y+Math.round((h-y)*ln),Hn=b+Math.round((f-b)*ln),Vn=S+Math.round((m-S)*ln);let _=Rn.toCss(qn,Hn,Vn),w=Rn.toRgba(qn,Hn,Vn);return{css:_,rgba:w}}e.blend=t;function n(c){return(c.rgba&255)===255}e.isOpaque=n;function i(c,u,h){let f=jg.ensureContrastRatio(c.rgba,u.rgba,h);if(f)return Rn.toColor(f>>24&255,f>>16&255,f>>8&255)}e.ensureContrastRatio=i;function s(c){let u=(c.rgba|255)>>>0;return[qn,Hn,Vn]=jg.toChannels(u),{css:Rn.toCss(qn,Hn,Vn),rgba:u}}e.opaque=s;function r(c,u){return ln=Math.round(u*255),[qn,Hn,Vn]=jg.toChannels(c.rgba),{css:Rn.toCss(qn,Hn,Vn,ln),rgba:Rn.toRgba(qn,Hn,Vn,ln)}}e.opacity=r;function o(c,u){return ln=c.rgba&255,r(c,ln*u/255)}e.multiplyOpacity=o;function a(c){return[c.rgba>>24&255,c.rgba>>16&255,c.rgba>>8&255]}e.toColorRGB=a})(Yt||={});var tn;(e=>{let t,n;try{let s=document.createElement("canvas");s.width=1,s.height=1;let r=s.getContext("2d",{willReadFrequently:!0});r&&(t=r,t.globalCompositeOperation="copy",n=t.createLinearGradient(0,0,1,1))}catch{}function i(s){if(s.match(/#[\da-f]{3,8}/i))switch(s.length){case 4:return qn=parseInt(s.slice(1,2).repeat(2),16),Hn=parseInt(s.slice(2,3).repeat(2),16),Vn=parseInt(s.slice(3,4).repeat(2),16),Rn.toColor(qn,Hn,Vn);case 5:return qn=parseInt(s.slice(1,2).repeat(2),16),Hn=parseInt(s.slice(2,3).repeat(2),16),Vn=parseInt(s.slice(3,4).repeat(2),16),ln=parseInt(s.slice(4,5).repeat(2),16),Rn.toColor(qn,Hn,Vn,ln);case 7:return{css:s,rgba:(parseInt(s.slice(1),16)<<8|255)>>>0};case 9:return{css:s,rgba:parseInt(s.slice(1),16)>>>0}}let r=s.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(r)return qn=parseInt(r[1]),Hn=parseInt(r[2]),Vn=parseInt(r[3]),ln=Math.round((r[5]===void 0?1:parseFloat(r[5]))*255),Rn.toColor(qn,Hn,Vn,ln);if(!t||!n)throw new Error("css.toColor: Unsupported css format");if(t.fillStyle=n,t.fillStyle=s,typeof t.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(t.fillRect(0,0,1,1),[qn,Hn,Vn,ln]=t.getImageData(0,0,1,1).data,ln!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:Rn.toRgba(qn,Hn,Vn,ln),css:s}}e.toColor=i})(tn||={});var wi;(e=>{function t(i){return n(i>>16&255,i>>8&255,i&255)}e.relativeLuminance=t;function n(i,s,r){let o=i/255,a=s/255,c=r/255,u=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),h=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),f=c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4);return u*.2126+h*.7152+f*.0722}e.relativeLuminance2=n})(wi||={});var jg;(e=>{function t(o,a){if(ln=(a&255)/255,ln===1)return a;let c=a>>24&255,u=a>>16&255,h=a>>8&255,f=o>>24&255,m=o>>16&255,y=o>>8&255;return qn=f+Math.round((c-f)*ln),Hn=m+Math.round((u-m)*ln),Vn=y+Math.round((h-y)*ln),Rn.toRgba(qn,Hn,Vn)}e.blend=t;function n(o,a,c){let u=wi.relativeLuminance(o>>8),h=wi.relativeLuminance(a>>8);if(_o(u,h)<c){if(h<u){let y=i(o,a,c),b=_o(u,wi.relativeLuminance(y>>8));if(b<c){let S=s(o,a,c),_=_o(u,wi.relativeLuminance(S>>8));return b>_?y:S}return y}let f=s(o,a,c),m=_o(u,wi.relativeLuminance(f>>8));if(m<c){let y=i(o,a,c),b=_o(u,wi.relativeLuminance(y>>8));return m>b?f:y}return f}}e.ensureContrastRatio=n;function i(o,a,c){let u=o>>24&255,h=o>>16&255,f=o>>8&255,m=a>>24&255,y=a>>16&255,b=a>>8&255,S=_o(wi.relativeLuminance2(m,y,b),wi.relativeLuminance2(u,h,f));for(;S<c&&(m>0||y>0||b>0);)m-=Math.max(0,Math.ceil(m*.1)),y-=Math.max(0,Math.ceil(y*.1)),b-=Math.max(0,Math.ceil(b*.1)),S=_o(wi.relativeLuminance2(m,y,b),wi.relativeLuminance2(u,h,f));return(m<<24|y<<16|b<<8|255)>>>0}e.reduceLuminance=i;function s(o,a,c){let u=o>>24&255,h=o>>16&255,f=o>>8&255,m=a>>24&255,y=a>>16&255,b=a>>8&255,S=_o(wi.relativeLuminance2(m,y,b),wi.relativeLuminance2(u,h,f));for(;S<c&&(m<255||y<255||b<255);)m=Math.min(255,m+Math.ceil((255-m)*.1)),y=Math.min(255,y+Math.ceil((255-y)*.1)),b=Math.min(255,b+Math.ceil((255-b)*.1)),S=_o(wi.relativeLuminance2(m,y,b),wi.relativeLuminance2(u,h,f));return(m<<24|y<<16|b<<8|255)>>>0}e.increaseLuminance=s;function r(o){return[o>>24&255,o>>16&255,o>>8&255,o&255]}e.toChannels=r})(jg||={});function bl(e){let t=e.toString(16);return t.length<2?"0"+t:t}function _o(e,t){return e<t?(t+.05)/(e+.05):(e+.05)/(t+.05)}var Dbe=class extends Kf{constructor(e,t,n){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=n}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},zv=class{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new zs}register(e){let t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];let t=this._bufferService.buffer.lines.get(e);if(!t||t.length===0)return[];let n=[],i=t.translateToString(!0),s=0,r=0,o=0,a=t.getFg(0),c=t.getBg(0);for(let u=0;u<t.getTrimmedLength();u++)if(t.loadCell(u,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==a||this._workCell.bg!==c){if(u-s>1){let h=this._getJoinedRanges(i,o,r,t,s);for(let f=0;f<h.length;f++)n.push(h[f])}s=u,o=r,a=this._workCell.fg,c=this._workCell.bg}r+=this._workCell.getChars().length||Ma.length}if(this._bufferService.cols-s>1){let u=this._getJoinedRanges(i,o,r,t,s);for(let h=0;h<u.length;h++)n.push(u[h])}return n}_getJoinedRanges(e,t,n,i,s){let r=e.substring(t,n),o=[];try{o=this._characterJoiners[0].handler(r)}catch(a){console.error(a)}for(let a=1;a<this._characterJoiners.length;a++)try{let c=this._characterJoiners[a].handler(r);for(let u=0;u<c.length;u++)zv._mergeRanges(o,c[u])}catch(c){console.error(c)}return this._stringRangesToCellRanges(o,i,s),o}_stringRangesToCellRanges(e,t,n){let i=0,s=!1,r=0,o=e[i];if(o){for(let a=n;a<this._bufferService.cols;a++){let c=t.getWidth(a),u=t.getString(a).length||Ma.length;if(c!==0){if(!s&&o[0]<=r&&(o[0]=a,s=!0),o[1]<=r){if(o[1]=a,o=e[++i],!o)break;o[0]<=r?(o[0]=a,s=!0):s=!1}r+=u}}o&&(o[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(n){if(t[1]<=s[0])return e[i-1][1]=t[1],e;if(t[1]<=s[1])return e[i-1][1]=Math.max(t[1],s[1]),e.splice(i,1),e;e.splice(i,1),i--}else{if(t[1]<=s[0])return e.splice(i,0,t),e;if(t[1]<=s[1])return s[0]=Math.min(t[0],s[0]),e;t[0]<s[1]&&(s[0]=Math.min(t[0],s[0]),n=!0);continue}}return n?e[e.length-1][1]=t[1]:e.push(t),e}};zv=dn([Re(0,Ai)],zv);function Obe(e){return 57508<=e&&e<=57558}function jbe(e){return 9472<=e&&e<=9631}function Bbe(e){return Obe(e)||jbe(e)}function Fbe(){return{css:{canvas:Qm(),cell:Qm()},device:{canvas:Qm(),cell:Qm(),char:{width:0,height:0,left:0,top:0}}}}function Qm(){return{width:0,height:0}}var iC=class{constructor(e,t,n,i,s,r,o){this._document=e,this._characterJoinerService=t,this._optionsService=n,this._coreBrowserService=i,this._coreService=s,this._decorationService=r,this._themeService=o,this._workCell=new zs,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(e,t,n){this._selectionStart=e,this._selectionEnd=t,this._columnSelectMode=n}createRow(e,t,n,i,s,r,o,a,c,u,h){let f=[],m=this._characterJoinerService.getJoinedCharacters(t),y=this._themeService.colors,b=e.getNoBgTrimmedLength();n&&b<r+1&&(b=r+1);let S,_=0,w="",M=0,R=0,E=0,A=0,T=!1,L=0,P=!1,I=0,N=0,O=[],j=u!==-1&&h!==-1;for(let $=0;$<b;$++){e.loadCell($,this._workCell);let V=this._workCell.getWidth();if(V===0)continue;let H=!1,B=$>=N,W=$,q=this._workCell;if(m.length>0&&$===m[0][0]&&B){let He=m.shift(),We=this._isCellInSelection(He[0],t);for(M=He[0]+1;M<He[1];M++)B&&=We===this._isCellInSelection(M,t);B&&=!n||r<He[0]||r>=He[1],B?(H=!0,q=new Dbe(this._workCell,e.translateToString(!0,He[0],He[1]),He[1]-He[0]),W=He[1]-1,V=q.getWidth()):N=He[1]}let ne=this._isCellInSelection($,t),z=n&&$===r,G=j&&$>=u&&$<=h,J=!1;this._decorationService.forEachDecorationAtCell($,t,void 0,He=>{J=!0});let U=q.getChars()||Ma;if(U===" "&&(q.isUnderline()||q.isOverline())&&(U=""),I=V*a-c.get(U,q.isBold(),q.isItalic()),!S)S=this._document.createElement("span");else if(_&&(ne&&P||!ne&&!P&&q.bg===R)&&(ne&&P&&y.selectionForeground||q.fg===E)&&q.extended.ext===A&&G===T&&I===L&&!z&&!H&&!J&&B){q.isInvisible()?w+=Ma:w+=U,_++;continue}else _&&(S.textContent=w),S=this._document.createElement("span"),_=0,w="";if(R=q.bg,E=q.fg,A=q.extended.ext,T=G,L=I,P=ne,H&&r>=$&&r<=W&&(r=$),!this._coreService.isCursorHidden&&z&&this._coreService.isCursorInitialized){if(O.push("xterm-cursor"),this._coreBrowserService.isFocused)o&&O.push("xterm-cursor-blink"),O.push(i==="bar"?"xterm-cursor-bar":i==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(s)switch(s){case"outline":O.push("xterm-cursor-outline");break;case"block":O.push("xterm-cursor-block");break;case"bar":O.push("xterm-cursor-bar");break;case"underline":O.push("xterm-cursor-underline");break}}if(q.isBold()&&O.push("xterm-bold"),q.isItalic()&&O.push("xterm-italic"),q.isDim()&&O.push("xterm-dim"),q.isInvisible()?w=Ma:w=q.getChars()||Ma,q.isUnderline()&&(O.push(`xterm-underline-${q.extended.underlineStyle}`),w===" "&&(w=""),!q.isUnderlineColorDefault()))if(q.isUnderlineColorRGB())S.style.textDecorationColor=`rgb(${Kf.toColorRGB(q.getUnderlineColor()).join(",")})`;else{let He=q.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&q.isBold()&&He<8&&(He+=8),S.style.textDecorationColor=y.ansi[He].css}q.isOverline()&&(O.push("xterm-overline"),w===" "&&(w="")),q.isStrikethrough()&&O.push("xterm-strikethrough"),G&&(S.style.textDecoration="underline");let re=q.getFgColor(),de=q.getFgColorMode(),ce=q.getBgColor(),ae=q.getBgColorMode(),be=!!q.isInverse();if(be){let He=re;re=ce,ce=He;let We=de;de=ae,ae=We}let Ce,qe,dt=!1;this._decorationService.forEachDecorationAtCell($,t,void 0,He=>{He.options.layer!=="top"&&dt||(He.backgroundColorRGB&&(ae=50331648,ce=He.backgroundColorRGB.rgba>>8&16777215,Ce=He.backgroundColorRGB),He.foregroundColorRGB&&(de=50331648,re=He.foregroundColorRGB.rgba>>8&16777215,qe=He.foregroundColorRGB),dt=He.options.layer==="top")}),!dt&&ne&&(Ce=this._coreBrowserService.isFocused?y.selectionBackgroundOpaque:y.selectionInactiveBackgroundOpaque,ce=Ce.rgba>>8&16777215,ae=50331648,dt=!0,y.selectionForeground&&(de=50331648,re=y.selectionForeground.rgba>>8&16777215,qe=y.selectionForeground)),dt&&O.push("xterm-decoration-top");let yt;switch(ae){case 16777216:case 33554432:yt=y.ansi[ce],O.push(`xterm-bg-${ce}`);break;case 50331648:yt=Rn.toColor(ce>>16,ce>>8&255,ce&255),this._addStyle(S,`background-color:#${S2((ce>>>0).toString(16),"0",6)}`);break;case 0:default:be?(yt=y.foreground,O.push("xterm-bg-257")):yt=y.background}switch(Ce||q.isDim()&&(Ce=Yt.multiplyOpacity(yt,.5)),de){case 16777216:case 33554432:q.isBold()&&re<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(re+=8),this._applyMinimumContrast(S,yt,y.ansi[re],q,Ce,void 0)||O.push(`xterm-fg-${re}`);break;case 50331648:let He=Rn.toColor(re>>16&255,re>>8&255,re&255);this._applyMinimumContrast(S,yt,He,q,Ce,qe)||this._addStyle(S,`color:#${S2(re.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(S,yt,y.foreground,q,Ce,qe)||be&&O.push("xterm-fg-257")}O.length&&(S.className=O.join(" "),O.length=0),!z&&!H&&!J&&B?_++:S.textContent=w,I!==this.defaultSpacing&&(S.style.letterSpacing=`${I}px`),f.push(S),$=W}return S&&_&&(S.textContent=w),f}_applyMinimumContrast(e,t,n,i,s,r){if(this._optionsService.rawOptions.minimumContrastRatio===1||Bbe(i.getCode()))return!1;let o=this._getContrastCache(i),a;if(!s&&!r&&(a=o.getColor(t.rgba,n.rgba)),a===void 0){let c=this._optionsService.rawOptions.minimumContrastRatio/(i.isDim()?2:1);a=Yt.ensureContrastRatio(s||t,r||n,c),o.setColor((s||t).rgba,(r||n).rgba,a??null)}return a?(this._addStyle(e,`color:${a.css}`),!0):!1}_getContrastCache(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(e,t){e.setAttribute("style",`${e.getAttribute("style")||""}${t};`)}_isCellInSelection(e,t){let n=this._selectionStart,i=this._selectionEnd;return!n||!i?!1:this._columnSelectMode?n[0]<=i[0]?e>=n[0]&&t>=n[1]&&e<i[0]&&t<=i[1]:e<n[0]&&t>=n[1]&&e>=i[0]&&t<=i[1]:t>n[1]&&t<i[1]||n[1]===i[1]&&t===n[1]&&e>=n[0]&&e<i[0]||n[1]<i[1]&&t===i[1]&&e<i[0]||n[1]<i[1]&&t===n[1]&&e>=n[0]}};iC=dn([Re(1,w6),Re(2,Pi),Re(3,Uo),Re(4,oc),Re(5,Yf),Re(6,td)],iC);function S2(e,t,n){for(;e.length<n;)e=t+e;return e}var Ube=class{constructor(e,t){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=e.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let n=e.createElement("span");n.classList.add("xterm-char-measure-element");let i=e.createElement("span");i.classList.add("xterm-char-measure-element"),i.style.fontWeight="bold";let s=e.createElement("span");s.classList.add("xterm-char-measure-element"),s.style.fontStyle="italic";let r=e.createElement("span");r.classList.add("xterm-char-measure-element"),r.style.fontWeight="bold",r.style.fontStyle="italic",this._measureElements=[n,i,s,r],this._container.appendChild(n),this._container.appendChild(i),this._container.appendChild(s),this._container.appendChild(r),t.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(e,t,n,i){e===this._font&&t===this._fontSize&&n===this._weight&&i===this._weightBold||(this._font=e,this._fontSize=t,this._weight=n,this._weightBold=i,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${n}`,this._measureElements[1].style.fontWeight=`${i}`,this._measureElements[2].style.fontWeight=`${n}`,this._measureElements[3].style.fontWeight=`${i}`,this.clear())}get(e,t,n){let i=0;if(!t&&!n&&e.length===1&&(i=e.charCodeAt(0))<256){if(this._flat[i]!==-9999)return this._flat[i];let o=this._measure(e,0);return o>0&&(this._flat[i]=o),o}let s=e;t&&(s+="B"),n&&(s+="I");let r=this._holey.get(s);if(r===void 0){let o=0;t&&(o|=1),n&&(o|=2),r=this._measure(e,o),r>0&&this._holey.set(s,r)}return r}_measure(e,t){let n=this._measureElements[t];return n.textContent=e.repeat(32),n.offsetWidth/32}},zbe=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,t,n,i=!1){if(this.selectionStart=t,this.selectionEnd=n,!t||!n||t[0]===n[0]&&t[1]===n[1]){this.clear();return}let s=e.buffers.active.ydisp,r=t[1]-s,o=n[1]-s,a=Math.max(r,0),c=Math.min(o,e.rows-1);if(a>=e.rows||c<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=i,this.viewportStartRow=r,this.viewportEndRow=o,this.viewportCappedStartRow=a,this.viewportCappedEndRow=c,this.startCol=t[0],this.endCol=n[0]}isCellSelected(e,t,n){return this.hasSelection?(n-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?t>=this.startCol&&n>=this.viewportCappedStartRow&&t<this.endCol&&n<=this.viewportCappedEndRow:t<this.startCol&&n>=this.viewportCappedStartRow&&t>=this.endCol&&n<=this.viewportCappedEndRow:n>this.viewportStartRow&&n<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&n===this.viewportStartRow&&t>=this.startCol&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&n===this.viewportEndRow&&t<this.endCol||this.viewportStartRow<this.viewportEndRow&&n===this.viewportStartRow&&t>=this.startCol):!1}};function $be(){return new zbe}var GS="xterm-dom-renderer-owner-",ks="xterm-rows",Jm="xterm-fg-",x2="xterm-bg-",hh="xterm-focus",Zm="xterm-selection",qbe=1,sC=class extends ct{constructor(e,t,n,i,s,r,o,a,c,u,h,f,m,y){super(),this._terminal=e,this._document=t,this._element=n,this._screenElement=i,this._viewportElement=s,this._helperContainer=r,this._linkifier2=o,this._charSizeService=c,this._optionsService=u,this._bufferService=h,this._coreService=f,this._coreBrowserService=m,this._themeService=y,this._terminalClass=qbe++,this._rowElements=[],this._selectionRenderModel=$be(),this.onRequestRedraw=this._register(new we).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(ks),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(Zm),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=Fbe(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors(b=>this._injectCss(b))),this._injectCss(this._themeService.colors),this._rowFactory=a.createInstance(iC,document),this._element.classList.add(GS+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline(b=>this._handleLinkHover(b))),this._register(this._linkifier2.onHideLinkUnderline(b=>this._handleLinkLeave(b))),this._register(Zt(()=>{this._element.classList.remove(GS+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new Ube(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let e=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let n of this._rowElements)n.style.width=`${this.dimensions.css.canvas.width}px`,n.style.height=`${this.dimensions.css.cell.height}px`,n.style.lineHeight=`${this.dimensions.css.cell.height}px`,n.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let t=`${this._terminalSelector} .${ks} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=t,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let t=`${this._terminalSelector} .${ks} { pointer-events: none; color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;t+=`${this._terminalSelector} .${ks} .xterm-dim { color: ${Yt.multiplyOpacity(e.foreground,.5).css};}`,t+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let n=`blink_underline_${this._terminalClass}`,i=`blink_bar_${this._terminalClass}`,s=`blink_block_${this._terminalClass}`;t+=`@keyframes ${n} { 50% {  border-bottom-style: hidden; }}`,t+=`@keyframes ${i} { 50% {  box-shadow: none; }}`,t+=`@keyframes ${s} { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}`,t+=`${this._terminalSelector} .${ks}.${hh} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${n} 1s step-end infinite;}${this._terminalSelector} .${ks}.${hh} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${i} 1s step-end infinite;}${this._terminalSelector} .${ks}.${hh} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${s} 1s step-end infinite;}${this._terminalSelector} .${ks} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${ks} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${e.cursor.css} !important; color: ${e.cursorAccent.css} !important;}${this._terminalSelector} .${ks} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${ks} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${ks} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,t+=`${this._terminalSelector} .${Zm} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${Zm} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${Zm} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`;for(let[r,o]of e.ansi.entries())t+=`${this._terminalSelector} .${Jm}${r} { color: ${o.css}; }${this._terminalSelector} .${Jm}${r}.xterm-dim { color: ${Yt.multiplyOpacity(o,.5).css}; }${this._terminalSelector} .${x2}${r} { background-color: ${o.css}; }`;t+=`${this._terminalSelector} .${Jm}257 { color: ${Yt.opaque(e.background).css}; }${this._terminalSelector} .${Jm}257.xterm-dim { color: ${Yt.multiplyOpacity(Yt.opaque(e.background),.5).css}; }${this._terminalSelector} .${x2}257 { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=t}_setDefaultSpacing(){let e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,t){for(let n=this._rowElements.length;n<=t;n++){let i=this._document.createElement("div");this._rowContainer.appendChild(i),this._rowElements.push(i)}for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,t){this._refreshRowElements(e,t),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(hh),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(hh),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,t,n){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,t,n),this.renderRows(0,this._bufferService.rows-1),!e||!t||(this._selectionRenderModel.update(this._terminal,e,t,n),!this._selectionRenderModel.hasSelection))return;let i=this._selectionRenderModel.viewportStartRow,s=this._selectionRenderModel.viewportEndRow,r=this._selectionRenderModel.viewportCappedStartRow,o=this._selectionRenderModel.viewportCappedEndRow,a=this._document.createDocumentFragment();if(n){let c=e[0]>t[0];a.appendChild(this._createSelectionElement(r,c?t[0]:e[0],c?e[0]:t[0],o-r+1))}else{let c=i===r?e[0]:0,u=r===s?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(r,c,u));let h=o-r-1;if(a.appendChild(this._createSelectionElement(r+1,0,this._bufferService.cols,h)),r!==o){let f=s===o?t[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(o,0,f))}}this._selectionContainer.appendChild(a)}_createSelectionElement(e,t,n,i=1){let s=this._document.createElement("div"),r=t*this.dimensions.css.cell.width,o=this.dimensions.css.cell.width*(n-t);return r+o>this.dimensions.css.canvas.width&&(o=this.dimensions.css.canvas.width-r),s.style.height=`${i*this.dimensions.css.cell.height}px`,s.style.top=`${e*this.dimensions.css.cell.height}px`,s.style.left=`${r}px`,s.style.width=`${o}px`,s}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let e of this._rowElements)e.replaceChildren()}renderRows(e,t){let n=this._bufferService.buffer,i=n.ybase+n.y,s=Math.min(n.x,this._bufferService.cols-1),r=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,o=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,a=this._optionsService.rawOptions.cursorInactiveStyle;for(let c=e;c<=t;c++){let u=c+n.ydisp,h=this._rowElements[c],f=n.lines.get(u);if(!h||!f)break;h.replaceChildren(...this._rowFactory.createRow(f,u,u===i,o,a,s,r,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${GS}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,t,n,i,s,r){n<0&&(e=0),i<0&&(t=0);let o=this._bufferService.rows-1;n=Math.max(Math.min(n,o),0),i=Math.max(Math.min(i,o),0),s=Math.min(s,this._bufferService.cols);let a=this._bufferService.buffer,c=a.ybase+a.y,u=Math.min(a.x,s-1),h=this._optionsService.rawOptions.cursorBlink,f=this._optionsService.rawOptions.cursorStyle,m=this._optionsService.rawOptions.cursorInactiveStyle;for(let y=n;y<=i;++y){let b=y+a.ydisp,S=this._rowElements[y],_=a.lines.get(b);if(!S||!_)break;S.replaceChildren(...this._rowFactory.createRow(_,b,b===c,f,m,u,h,this.dimensions.css.cell.width,this._widthCache,r?y===n?e:0:-1,r?(y===i?t:s)-1:-1))}}};sC=dn([Re(7,L1),Re(8,My),Re(9,Pi),Re(10,Ai),Re(11,oc),Re(12,Uo),Re(13,td)],sC);var rC=class extends ct{constructor(e,t,n){super(),this._optionsService=n,this.width=0,this.height=0,this._onCharSizeChange=this._register(new we),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new Vbe(this._optionsService))}catch{this._measureStrategy=this._register(new Hbe(e,t,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let e=this._measureStrategy.measure();(e.width!==this.width||e.height!==this.height)&&(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};rC=dn([Re(2,Pi)],rC);var $6=class extends ct{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(e,t){e!==void 0&&e>0&&t!==void 0&&t>0&&(this._result.width=e,this._result.height=t)}},Hbe=class extends $6{constructor(e,t,n){super(),this._document=e,this._parentElement=t,this._optionsService=n,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},Vbe=class extends $6{constructor(e){super(),this._optionsService=e,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let t=this._ctx.measureText("W");if(!("width"in t&&"fontBoundingBoxAscent"in t&&"fontBoundingBoxDescent"in t))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}},Wbe=class extends ct{constructor(e,t,n){super(),this._textarea=e,this._window=t,this.mainDocument=n,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new Gbe(this._window)),this._onDprChange=this._register(new we),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new we),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange(i=>this._screenDprMonitor.setWindow(i))),this._register(si.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(Ve(this._textarea,"focus",()=>this._isFocused=!0)),this._register(Ve(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},Gbe=class extends ct{constructor(e){super(),this._parentWindow=e,this._windowResizeListener=this._register(new Uu),this._onDprChange=this._register(new we),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(Zt(()=>this.clearListener()))}setWindow(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=Ve(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},Kbe=class extends ct{constructor(){super(),this.linkProviders=[],this._register(Zt(()=>this.linkProviders.length=0))}registerLinkProvider(e){return this.linkProviders.push(e),{dispose:()=>{let t=this.linkProviders.indexOf(e);t!==-1&&this.linkProviders.splice(t,1)}}}};function U1(e,t,n){let i=n.getBoundingClientRect(),s=e.getComputedStyle(n),r=parseInt(s.getPropertyValue("padding-left")),o=parseInt(s.getPropertyValue("padding-top"));return[t.clientX-i.left-r,t.clientY-i.top-o]}function Ybe(e,t,n,i,s,r,o,a,c){if(!r)return;let u=U1(e,t,n);if(u)return u[0]=Math.ceil((u[0]+(c?o/2:0))/o),u[1]=Math.ceil(u[1]/a),u[0]=Math.min(Math.max(u[0],1),i+(c?1:0)),u[1]=Math.min(Math.max(u[1],1),s),u}var oC=class{constructor(e,t){this._renderService=e,this._charSizeService=t}getCoords(e,t,n,i,s){return Ybe(window,e,t,n,i,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,s)}getMouseReportCoords(e,t){let n=U1(window,e,t);if(this._charSizeService.hasValidSize)return n[0]=Math.min(Math.max(n[0],0),this._renderService.dimensions.css.canvas.width-1),n[1]=Math.min(Math.max(n[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(n[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(n[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(n[0]),y:Math.floor(n[1])}}};oC=dn([Re(0,zo),Re(1,My)],oC);var Xbe=class{constructor(e,t){this._renderCallback=e,this._coreBrowserService=t,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(e,t,n){this._rowCount=n,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}},q6={};oye(q6,{getSafariVersion:()=>Jbe,isChromeOS:()=>G6,isFirefox:()=>H6,isIpad:()=>Zbe,isIphone:()=>e_e,isLegacyEdge:()=>Qbe,isLinux:()=>z1,isMac:()=>$v,isNode:()=>Ay,isSafari:()=>V6,isWindows:()=>W6});var Ay=typeof process<"u"&&"title"in process,Xf=Ay?"node":navigator.userAgent,Qf=Ay?"node":navigator.platform,H6=Xf.includes("Firefox"),Qbe=Xf.includes("Edge"),V6=/^((?!chrome|android).)*safari/i.test(Xf);function Jbe(){if(!V6)return 0;let e=Xf.match(/Version\/(\d+)/);return e===null||e.length<2?0:parseInt(e[1])}var $v=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(Qf),Zbe=Qf==="iPad",e_e=Qf==="iPhone",W6=["Windows","Win16","Win32","WinCE"].includes(Qf),z1=Qf.indexOf("Linux")>=0,G6=/\bCrOS\b/.test(Xf),K6=class{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,n=0,i=e.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(t=performance.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,performance.now()-t),n=Math.max(t,n),s=e.timeRemaining(),n*1.5>s){i-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(i-t))}ms`),this._start();return}i=s}this.clear()}},t_e=class extends K6{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){let t=performance.now()+e;return{timeRemaining:()=>Math.max(0,t-performance.now())}}},n_e=class extends K6{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}},qv=!Ay&&"requestIdleCallback"in window?n_e:t_e,i_e=class{constructor(){this._queue=new qv}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}},aC=class extends ct{constructor(e,t,n,i,s,r,o,a,c){super(),this._rowCount=e,this._optionsService=n,this._charSizeService=i,this._coreService=s,this._coreBrowserService=a,this._renderer=this._register(new Uu),this._pausedResizeTask=new i_e,this._observerDisposable=this._register(new Uu),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new we),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new we),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new we),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new we),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new Xbe((u,h)=>this._renderRows(u,h),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new s_e(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(Zt(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(o.onResize(()=>this._fullRefresh())),this._register(o.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(r.onDecorationRegistered(()=>this._fullRefresh())),this._register(r.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(o.cols,o.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(o.buffer.y,o.buffer.y,!0))),this._register(c.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,t),this._register(this._coreBrowserService.onWindowChange(u=>this._registerIntersectionObserver(u,t)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver(e,t){if("IntersectionObserver"in e){let n=new e.IntersectionObserver(i=>this._handleIntersectionChange(i[i.length-1]),{threshold:0});n.observe(t),this._observerDisposable.value=Zt(()=>n.disconnect())}}_handleIntersectionChange(e){this._isPaused=e.isIntersecting===void 0?e.intersectionRatio===0:!e.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,n=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}let i=this._syncOutputHandler.flush();i&&(e=Math.min(e,i.start),t=Math.max(t,i.end)),n||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount)}_renderRows(e,t){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(e,t);return}e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0}}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(t=>this.refreshRows(t.start,t.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize(e,t)):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(e,t,n){this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=n,this._renderer.value?.handleSelectionChanged(e,t,n)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};aC=dn([Re(2,Pi),Re(3,My),Re(4,oc),Re(5,Yf),Re(6,Ai),Re(7,Uo),Re(8,td)],aC);var s_e=class{constructor(e,t,n){this._coreBrowserService=e,this._coreService=t,this._onTimeout=n,this._start=0,this._end=0,this._isBuffering=!1}bufferRows(e,t){this._isBuffering?(this._start=Math.min(this._start,e),this._end=Math.max(this._end,t)):(this._start=e,this._end=t,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1e3))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let e={start:this._start,end:this._end};return this._isBuffering=!1,e}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function r_e(e,t,n,i){let s=n.buffer.x,r=n.buffer.y;if(!n.buffer.hasScrollback)return l_e(s,r,e,t,n,i)+Py(r,t,n,i)+c_e(s,r,e,t,n,i);let o;if(r===t)return o=s>e?"D":"C",Af(Math.abs(s-e),Mf(o,i));o=r>t?"D":"C";let a=Math.abs(r-t),c=a_e(r>t?e:s,n)+(a-1)*n.cols+1+o_e(r>t?s:e);return Af(c,Mf(o,i))}function o_e(e,t){return e-1}function a_e(e,t){return t.cols-e}function l_e(e,t,n,i,s,r){return Py(t,i,s,r).length===0?"":Af(X6(e,t,e,t-Xl(t,s),!1,s).length,Mf("D",r))}function Py(e,t,n,i){let s=e-Xl(e,n),r=t-Xl(t,n),o=Math.abs(s-r)-u_e(e,t,n);return Af(o,Mf(Y6(e,t),i))}function c_e(e,t,n,i,s,r){let o;Py(t,i,s,r).length>0?o=i-Xl(i,s):o=t;let a=i,c=d_e(e,t,n,i,s,r);return Af(X6(e,o,n,a,c==="C",s).length,Mf(c,r))}function u_e(e,t,n){let i=0,s=e-Xl(e,n),r=t-Xl(t,n);for(let o=0;o<Math.abs(s-r);o++){let a=Y6(e,t)==="A"?-1:1;n.buffer.lines.get(s+a*o)?.isWrapped&&i++}return i}function Xl(e,t){let n=0,i=t.buffer.lines.get(e),s=i?.isWrapped;for(;s&&e>=0&&e<t.rows;)n++,i=t.buffer.lines.get(--e),s=i?.isWrapped;return n}function d_e(e,t,n,i,s,r){let o;return Py(n,i,s,r).length>0?o=i-Xl(i,s):o=t,e<n&&o<=i||e>=n&&o<i?"C":"D"}function Y6(e,t){return e>t?"A":"B"}function X6(e,t,n,i,s,r){let o=e,a=t,c="";for(;(o!==n||a!==i)&&a>=0&&a<r.buffer.lines.length;)o+=s?1:-1,s&&o>r.cols-1?(c+=r.buffer.translateBufferLineToString(a,!1,e,o),o=0,e=0,a++):!s&&o<0&&(c+=r.buffer.translateBufferLineToString(a,!1,0,e+1),o=r.cols-1,e=o,a--);return c+r.buffer.translateBufferLineToString(a,!1,e,o)}function Mf(e,t){let n=t?"O":"[";return fe.ESC+n+e}function Af(e,t){e=Math.floor(e);let n="";for(let i=0;i<e;i++)n+=t;return n}var h_e=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let e=this.selectionStart,t=this.selectionEnd;return!e||!t?!1:e[1]>t[1]||e[1]===t[1]&&e[0]>t[0]}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function w2(e,t){if(e.start.y>e.end.y)throw new Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return t*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}var KS=50,f_e=15,p_e=50,m_e=500,g_e="",v_e=new RegExp(g_e,"g"),lC=class extends ct{constructor(e,t,n,i,s,r,o,a,c){super(),this._element=e,this._screenElement=t,this._linkifier=n,this._bufferService=i,this._coreService=s,this._mouseService=r,this._optionsService=o,this._renderService=a,this._coreBrowserService=c,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new zs,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new we),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new we),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new we),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new we),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=u=>this._handleMouseMove(u),this._mouseUpListener=u=>this._handleMouseUp(u),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(u=>this._handleTrim(u)),this._register(this._bufferService.buffers.onBufferActivate(u=>this._handleBufferActivate(u))),this.enable(),this._model=new h_e(this._bufferService),this._activeSelectionMode=0,this._register(Zt(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize(u=>{u.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;return!e||!t?!1:e[0]!==t[0]||e[1]!==t[1]}get selectionText(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd;if(!e||!t)return"";let n=this._bufferService.buffer,i=[];if(this._activeSelectionMode===3){if(e[0]===t[0])return"";let s=e[0]<t[0]?e[0]:t[0],r=e[0]<t[0]?t[0]:e[0];for(let o=e[1];o<=t[1];o++){let a=n.translateBufferLineToString(o,!0,s,r);i.push(a)}}else{let s=e[1]===t[1]?t[0]:void 0;i.push(n.translateBufferLineToString(e[1],!0,e[0],s));for(let r=e[1]+1;r<=t[1]-1;r++){let o=n.lines.get(r),a=n.translateBufferLineToString(r,!0);o?.isWrapped?i[i.length-1]+=a:i.push(a)}if(e[1]!==t[1]){let r=n.lines.get(t[1]),o=n.translateBufferLineToString(t[1],!0,0,t[0]);r&&r.isWrapped?i[i.length-1]+=o:i.push(o)}}return i.map(s=>s.replace(v_e," ")).join(W6?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),z1&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(e){let t=this._getMouseBufferCoords(e),n=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!n||!i||!t?!1:this._areCoordsInSelection(t,n,i)}isCellInSelection(e,t){let n=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!n||!i?!1:this._areCoordsInSelection([e,t],n,i)}_areCoordsInSelection(e,t,n){return e[1]>t[1]&&e[1]<n[1]||t[1]===n[1]&&e[1]===t[1]&&e[0]>=t[0]&&e[0]<n[0]||t[1]<n[1]&&e[1]===n[1]&&e[0]<n[0]||t[1]<n[1]&&e[1]===t[1]&&e[0]>=t[0]}_selectWordAtCursor(e,t){let n=this._linkifier.currentLink?.link?.range;if(n)return this._model.selectionStart=[n.start.x-1,n.start.y-1],this._model.selectionStartLength=w2(n,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let i=this._getMouseBufferCoords(e);return i?(this._selectWordAt(i,t),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,t){this._model.clearSelection(),e=Math.max(e,0),t=Math.min(t,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,t],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){let t=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(t)return t[0]--,t[1]--,t[1]+=this._bufferService.buffer.ydisp,t}_getMouseEventScrollAmount(e){let t=U1(this._coreBrowserService.window,e,this._screenElement)[1],n=this._renderService.dimensions.css.canvas.height;return t>=0&&t<=n?0:(t>n&&(t-=n),t=Math.min(Math.max(t,-KS),KS),t/=KS,t/Math.abs(t)+Math.round(t*(f_e-1)))}shouldForceSelection(e){return $v?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,!(e.button===2&&this.hasSelection)&&e.button===0){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):e.detail===1?this._handleSingleClick(e):e.detail===2?this._handleDoubleClick(e):e.detail===3&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),p_e)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(e)?3:0,this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let t=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);t&&t.length!==this._model.selectionStart[0]&&t.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){let t=this._getMouseBufferCoords(e);t&&(this._activeSelectionMode=2,this._selectLineAt(t[1]))}shouldColumnSelect(e){return e.altKey&&!($v&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;let t=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let n=this._bufferService.buffer;if(this._model.selectionEnd[1]<n.lines.length){let i=n.lines.get(this._model.selectionEnd[1]);i&&i.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!t||t[0]!==this._model.selectionEnd[0]||t[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let e=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){let t=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&t<m_e&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let n=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(n&&n[0]!==void 0&&n[1]!==void 0){let i=r_e(n[0]-1,n[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(i,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let e=this._model.finalSelectionStart,t=this._model.finalSelectionEnd,n=!!e&&!!t&&(e[0]!==t[0]||e[1]!==t[1]);if(!n){this._oldHasSelection&&this._fireOnSelectionChange(e,t,n);return}!e||!t||(!this._oldSelectionStart||!this._oldSelectionEnd||e[0]!==this._oldSelectionStart[0]||e[1]!==this._oldSelectionStart[1]||t[0]!==this._oldSelectionEnd[0]||t[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange(e,t,n)}_fireOnSelectionChange(e,t,n){this._oldSelectionStart=e,this._oldSelectionEnd=t,this._oldHasSelection=n,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(t=>this._handleTrim(t))}_convertViewportColToCharacterIndex(e,t){let n=t;for(let i=0;t>=i;i++){let s=e.loadCell(i,this._workCell).getChars().length;this._workCell.getWidth()===0?n--:s>1&&t!==i&&(n+=s-1)}return n}setSelection(e,t,n){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,t],this._model.selectionStartLength=n,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,t,n=!0,i=!0){if(e[0]>=this._bufferService.cols)return;let s=this._bufferService.buffer,r=s.lines.get(e[1]);if(!r)return;let o=s.translateBufferLineToString(e[1],!1),a=this._convertViewportColToCharacterIndex(r,e[0]),c=a,u=e[0]-a,h=0,f=0,m=0,y=0;if(o.charAt(a)===" "){for(;a>0&&o.charAt(a-1)===" ";)a--;for(;c<o.length&&o.charAt(c+1)===" ";)c++}else{let _=e[0],w=e[0];r.getWidth(_)===0&&(h++,_--),r.getWidth(w)===2&&(f++,w++);let M=r.getString(w).length;for(M>1&&(y+=M-1,c+=M-1);_>0&&a>0&&!this._isCharWordSeparator(r.loadCell(_-1,this._workCell));){r.loadCell(_-1,this._workCell);let R=this._workCell.getChars().length;this._workCell.getWidth()===0?(h++,_--):R>1&&(m+=R-1,a-=R-1),a--,_--}for(;w<r.length&&c+1<o.length&&!this._isCharWordSeparator(r.loadCell(w+1,this._workCell));){r.loadCell(w+1,this._workCell);let R=this._workCell.getChars().length;this._workCell.getWidth()===2?(f++,w++):R>1&&(y+=R-1,c+=R-1),c++,w++}}c++;let b=a+u-h+m,S=Math.min(this._bufferService.cols,c-a+h+f-m-y);if(!(!t&&o.slice(a,c).trim()==="")){if(n&&b===0&&r.getCodePoint(0)!==32){let _=s.lines.get(e[1]-1);if(_&&r.isWrapped&&_.getCodePoint(this._bufferService.cols-1)!==32){let w=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(w){let M=this._bufferService.cols-w.start;b-=M,S+=M}}}if(i&&b+S===this._bufferService.cols&&r.getCodePoint(this._bufferService.cols-1)!==32){let _=s.lines.get(e[1]+1);if(_?.isWrapped&&_.getCodePoint(0)!==32){let w=this._getWordAt([0,e[1]+1],!1,!1,!0);w&&(S+=w.length)}}return{start:b,length:S}}}_selectWordAt(e,t){let n=this._getWordAt(e,t);if(n){for(;n.start<0;)n.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[n.start,e[1]],this._model.selectionStartLength=n.length}}_selectToWordAt(e){let t=this._getWordAt(e,!0);if(t){let n=e[1];for(;t.start<0;)t.start+=this._bufferService.cols,n--;if(!this._model.areSelectionValuesReversed())for(;t.start+t.length>this._bufferService.cols;)t.length-=this._bufferService.cols,n++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?t.start:t.start+t.length,n]}}_isCharWordSeparator(e){return e.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){let t=this._bufferService.buffer.getWrappedRangeForLine(e),n={start:{x:0,y:t.first},end:{x:this._bufferService.cols-1,y:t.last}};this._model.selectionStart=[0,t.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=w2(n,this._bufferService.cols)}};lC=dn([Re(3,Ai),Re(4,oc),Re(5,N1),Re(6,Pi),Re(7,zo),Re(8,Uo)],lC);var C2=class{constructor(){this._data={}}set(e,t,n){this._data[e]||(this._data[e]={}),this._data[e][t]=n}get(e,t){return this._data[e]?this._data[e][t]:void 0}clear(){this._data={}}},k2=class{constructor(){this._color=new C2,this._css=new C2}setCss(e,t,n){this._css.set(e,t,n)}getCss(e,t){return this._css.get(e,t)}setColor(e,t,n){this._color.set(e,t,n)}getColor(e,t){return this._color.get(e,t)}clear(){this._color.clear(),this._css.clear()}},Ln=Object.freeze((()=>{let e=[tn.toColor("#2e3436"),tn.toColor("#cc0000"),tn.toColor("#4e9a06"),tn.toColor("#c4a000"),tn.toColor("#3465a4"),tn.toColor("#75507b"),tn.toColor("#06989a"),tn.toColor("#d3d7cf"),tn.toColor("#555753"),tn.toColor("#ef2929"),tn.toColor("#8ae234"),tn.toColor("#fce94f"),tn.toColor("#729fcf"),tn.toColor("#ad7fa8"),tn.toColor("#34e2e2"),tn.toColor("#eeeeec")],t=[0,95,135,175,215,255];for(let n=0;n<216;n++){let i=t[n/36%6|0],s=t[n/6%6|0],r=t[n%6];e.push({css:Rn.toCss(i,s,r),rgba:Rn.toRgba(i,s,r)})}for(let n=0;n<24;n++){let i=8+n*10;e.push({css:Rn.toCss(i,i,i),rgba:Rn.toRgba(i,i,i)})}return e})()),kl=tn.toColor("#ffffff"),Eh=tn.toColor("#000000"),T2=tn.toColor("#ffffff"),E2=Eh,fh={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},y_e=kl,cC=class extends ct{constructor(e){super(),this._optionsService=e,this._contrastCache=new k2,this._halfContrastCache=new k2,this._onChangeColors=this._register(new we),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:kl,background:Eh,cursor:T2,cursorAccent:E2,selectionForeground:void 0,selectionBackgroundTransparent:fh,selectionBackgroundOpaque:Yt.blend(Eh,fh),selectionInactiveBackgroundTransparent:fh,selectionInactiveBackgroundOpaque:Yt.blend(Eh,fh),scrollbarSliderBackground:Yt.opacity(kl,.2),scrollbarSliderHoverBackground:Yt.opacity(kl,.4),scrollbarSliderActiveBackground:Yt.opacity(kl,.5),overviewRulerBorder:kl,ansi:Ln.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(e={}){let t=this._colors;if(t.foreground=Ut(e.foreground,kl),t.background=Ut(e.background,Eh),t.cursor=Yt.blend(t.background,Ut(e.cursor,T2)),t.cursorAccent=Yt.blend(t.background,Ut(e.cursorAccent,E2)),t.selectionBackgroundTransparent=Ut(e.selectionBackground,fh),t.selectionBackgroundOpaque=Yt.blend(t.background,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundTransparent=Ut(e.selectionInactiveBackground,t.selectionBackgroundTransparent),t.selectionInactiveBackgroundOpaque=Yt.blend(t.background,t.selectionInactiveBackgroundTransparent),t.selectionForeground=e.selectionForeground?Ut(e.selectionForeground,_2):void 0,t.selectionForeground===_2&&(t.selectionForeground=void 0),Yt.isOpaque(t.selectionBackgroundTransparent)&&(t.selectionBackgroundTransparent=Yt.opacity(t.selectionBackgroundTransparent,.3)),Yt.isOpaque(t.selectionInactiveBackgroundTransparent)&&(t.selectionInactiveBackgroundTransparent=Yt.opacity(t.selectionInactiveBackgroundTransparent,.3)),t.scrollbarSliderBackground=Ut(e.scrollbarSliderBackground,Yt.opacity(t.foreground,.2)),t.scrollbarSliderHoverBackground=Ut(e.scrollbarSliderHoverBackground,Yt.opacity(t.foreground,.4)),t.scrollbarSliderActiveBackground=Ut(e.scrollbarSliderActiveBackground,Yt.opacity(t.foreground,.5)),t.overviewRulerBorder=Ut(e.overviewRulerBorder,y_e),t.ansi=Ln.slice(),t.ansi[0]=Ut(e.black,Ln[0]),t.ansi[1]=Ut(e.red,Ln[1]),t.ansi[2]=Ut(e.green,Ln[2]),t.ansi[3]=Ut(e.yellow,Ln[3]),t.ansi[4]=Ut(e.blue,Ln[4]),t.ansi[5]=Ut(e.magenta,Ln[5]),t.ansi[6]=Ut(e.cyan,Ln[6]),t.ansi[7]=Ut(e.white,Ln[7]),t.ansi[8]=Ut(e.brightBlack,Ln[8]),t.ansi[9]=Ut(e.brightRed,Ln[9]),t.ansi[10]=Ut(e.brightGreen,Ln[10]),t.ansi[11]=Ut(e.brightYellow,Ln[11]),t.ansi[12]=Ut(e.brightBlue,Ln[12]),t.ansi[13]=Ut(e.brightMagenta,Ln[13]),t.ansi[14]=Ut(e.brightCyan,Ln[14]),t.ansi[15]=Ut(e.brightWhite,Ln[15]),e.extendedAnsi){let n=Math.min(t.ansi.length-16,e.extendedAnsi.length);for(let i=0;i<n;i++)t.ansi[i+16]=Ut(e.extendedAnsi[i],Ln[i+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(e===void 0){for(let t=0;t<this._restoreColors.ansi.length;++t)this._colors.ansi[t]=this._restoreColors.ansi[t];return}switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};cC=dn([Re(0,Pi)],cC);function Ut(e,t){if(e!==void 0)try{return tn.toColor(e)}catch{}return t}var b_e=class{constructor(...e){this._entries=new Map;for(let[t,n]of e)this.set(t,n)}set(e,t){let n=this._entries.get(e);return this._entries.set(e,t),n}forEach(e){for(let[t,n]of this._entries.entries())e(t,n)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}},__e=class{constructor(){this._services=new b_e,this._services.set(L1,this)}setService(e,t){this._services.set(e,t)}getService(e){return this._services.get(e)}createInstance(e,...t){let n=fye(e).sort((r,o)=>r.index-o.index),i=[];for(let r of n){let o=this._services.get(r.id);if(!o)throw new Error(`[createInstance] ${e.name} depends on UNKNOWN service ${r.id._id}.`);i.push(o)}let s=n.length>0?n[0].index:t.length;if(t.length!==s)throw new Error(`[createInstance] First service dependency of ${e.name} at position ${s+1} conflicts with ${t.length} static arguments`);return new e(...t,...i)}},S_e={trace:0,debug:1,info:2,warn:3,error:4,off:5},x_e="xterm.js: ",uC=class extends ct{constructor(e){super(),this._optionsService=e,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=S_e[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let t=0;t<e.length;t++)typeof e[t]=="function"&&(e[t]=e[t]())}_log(e,t,n){this._evalLazyOptionalParams(n),e.call(console,(this._optionsService.options.logger?"":x_e)+t,...n)}trace(e,...t){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,t)}debug(e,...t){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,t)}info(e,...t){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,t)}warn(e,...t){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,t)}error(e,...t){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,t)}};uC=dn([Re(0,Pi)],uC);var R2=class extends ct{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this._register(new we),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new we),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new we),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;let t=new Array(e);for(let n=0;n<Math.min(e,this.length);n++)t[n]=this._array[this._getCyclicIndex(n)];this._array=t,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let t=this._length;t<e;t++)this._array[t]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,t){this._array[this._getCyclicIndex(e)]=t}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,t,...n){if(t){for(let i=e;i<this._length-t;i++)this._array[this._getCyclicIndex(i)]=this._array[this._getCyclicIndex(i+t)];this._length-=t,this.onDeleteEmitter.fire({index:e,amount:t})}for(let i=this._length-1;i>=e;i--)this._array[this._getCyclicIndex(i+n.length)]=this._array[this._getCyclicIndex(i)];for(let i=0;i<n.length;i++)this._array[this._getCyclicIndex(e+i)]=n[i];if(n.length&&this.onInsertEmitter.fire({index:e,amount:n.length}),this._length+n.length>this._maxLength){let i=this._length+n.length-this._maxLength;this._startIndex+=i,this._length=this._maxLength,this.onTrimEmitter.fire(i)}else this._length+=n.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,t,n){if(!(t<=0)){if(e<0||e>=this._length)throw new Error("start argument out of range");if(e+n<0)throw new Error("Cannot shift elements in list beyond index 0");if(n>0){for(let s=t-1;s>=0;s--)this.set(e+s+n,this.get(e+s));let i=e+t+n-this._length;if(i>0)for(this._length+=i;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let i=0;i<t;i++)this.set(e+i+n,this.get(e+i))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}},at=3,Tn=Object.freeze(new Kf),eg=0,YS=2,Rh=class Q6{constructor(t,n,i=!1){this.isWrapped=i,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(t*at);let s=n||zs.fromCharData([0,g6,1,0]);for(let r=0;r<t;++r)this.setCell(r,s);this.length=t}get(t){let n=this._data[t*at+0],i=n&2097151;return[this._data[t*at+1],n&2097152?this._combined[t]:i?wa(i):"",n>>22,n&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):i]}set(t,n){this._data[t*at+1]=n[0],n[1].length>1?(this._combined[t]=n[1],this._data[t*at+0]=t|2097152|n[2]<<22):this._data[t*at+0]=n[1].charCodeAt(0)|n[2]<<22}getWidth(t){return this._data[t*at+0]>>22}hasWidth(t){return this._data[t*at+0]&12582912}getFg(t){return this._data[t*at+1]}getBg(t){return this._data[t*at+2]}hasContent(t){return this._data[t*at+0]&4194303}getCodePoint(t){let n=this._data[t*at+0];return n&2097152?this._combined[t].charCodeAt(this._combined[t].length-1):n&2097151}isCombined(t){return this._data[t*at+0]&2097152}getString(t){let n=this._data[t*at+0];return n&2097152?this._combined[t]:n&2097151?wa(n&2097151):""}isProtected(t){return this._data[t*at+2]&536870912}loadCell(t,n){return eg=t*at,n.content=this._data[eg+0],n.fg=this._data[eg+1],n.bg=this._data[eg+2],n.content&2097152&&(n.combinedData=this._combined[t]),n.bg&268435456&&(n.extended=this._extendedAttrs[t]),n}setCell(t,n){n.content&2097152&&(this._combined[t]=n.combinedData),n.bg&268435456&&(this._extendedAttrs[t]=n.extended),this._data[t*at+0]=n.content,this._data[t*at+1]=n.fg,this._data[t*at+2]=n.bg}setCellFromCodepoint(t,n,i,s){s.bg&268435456&&(this._extendedAttrs[t]=s.extended),this._data[t*at+0]=n|i<<22,this._data[t*at+1]=s.fg,this._data[t*at+2]=s.bg}addCodepointToCell(t,n,i){let s=this._data[t*at+0];s&2097152?this._combined[t]+=wa(n):s&2097151?(this._combined[t]=wa(s&2097151)+wa(n),s&=-2097152,s|=2097152):s=n|1<<22,i&&(s&=-12582913,s|=i<<22),this._data[t*at+0]=s}insertCells(t,n,i){if(t%=this.length,t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),n<this.length-t){let s=new zs;for(let r=this.length-t-n-1;r>=0;--r)this.setCell(t+n+r,this.loadCell(t+r,s));for(let r=0;r<n;++r)this.setCell(t+r,i)}else for(let s=t;s<this.length;++s)this.setCell(s,i);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,i)}deleteCells(t,n,i){if(t%=this.length,n<this.length-t){let s=new zs;for(let r=0;r<this.length-t-n;++r)this.setCell(t+r,this.loadCell(t+n+r,s));for(let r=this.length-n;r<this.length;++r)this.setCell(r,i)}else for(let s=t;s<this.length;++s)this.setCell(s,i);t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),this.getWidth(t)===0&&!this.hasContent(t)&&this.setCellFromCodepoint(t,0,1,i)}replaceCells(t,n,i,s=!1){if(s){for(t&&this.getWidth(t-1)===2&&!this.isProtected(t-1)&&this.setCellFromCodepoint(t-1,0,1,i),n<this.length&&this.getWidth(n-1)===2&&!this.isProtected(n)&&this.setCellFromCodepoint(n,0,1,i);t<n&&t<this.length;)this.isProtected(t)||this.setCell(t,i),t++;return}for(t&&this.getWidth(t-1)===2&&this.setCellFromCodepoint(t-1,0,1,i),n<this.length&&this.getWidth(n-1)===2&&this.setCellFromCodepoint(n,0,1,i);t<n&&t<this.length;)this.setCell(t++,i)}resize(t,n){if(t===this.length)return this._data.length*4*YS<this._data.buffer.byteLength;let i=t*at;if(t>this.length){if(this._data.buffer.byteLength>=i*4)this._data=new Uint32Array(this._data.buffer,0,i);else{let s=new Uint32Array(i);s.set(this._data),this._data=s}for(let s=this.length;s<t;++s)this.setCell(s,n)}else{this._data=this._data.subarray(0,i);let s=Object.keys(this._combined);for(let o=0;o<s.length;o++){let a=parseInt(s[o],10);a>=t&&delete this._combined[a]}let r=Object.keys(this._extendedAttrs);for(let o=0;o<r.length;o++){let a=parseInt(r[o],10);a>=t&&delete this._extendedAttrs[a]}}return this.length=t,i*4*YS<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*YS<this._data.buffer.byteLength){let t=new Uint32Array(this._data.length);return t.set(this._data),this._data=t,1}return 0}fill(t,n=!1){if(n){for(let i=0;i<this.length;++i)this.isProtected(i)||this.setCell(i,t);return}this._combined={},this._extendedAttrs={};for(let i=0;i<this.length;++i)this.setCell(i,t)}copyFrom(t){this.length!==t.length?this._data=new Uint32Array(t._data):this._data.set(t._data),this.length=t.length,this._combined={};for(let n in t._combined)this._combined[n]=t._combined[n];this._extendedAttrs={};for(let n in t._extendedAttrs)this._extendedAttrs[n]=t._extendedAttrs[n];this.isWrapped=t.isWrapped}clone(){let t=new Q6(0);t._data=new Uint32Array(this._data),t.length=this.length;for(let n in this._combined)t._combined[n]=this._combined[n];for(let n in this._extendedAttrs)t._extendedAttrs[n]=this._extendedAttrs[n];return t.isWrapped=this.isWrapped,t}getTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*at+0]&4194303)return t+(this._data[t*at+0]>>22);return 0}getNoBgTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(this._data[t*at+0]&4194303||this._data[t*at+2]&50331648)return t+(this._data[t*at+0]>>22);return 0}copyCellsFrom(t,n,i,s,r){let o=t._data;if(r)for(let c=s-1;c>=0;c--){for(let u=0;u<at;u++)this._data[(i+c)*at+u]=o[(n+c)*at+u];o[(n+c)*at+2]&268435456&&(this._extendedAttrs[i+c]=t._extendedAttrs[n+c])}else for(let c=0;c<s;c++){for(let u=0;u<at;u++)this._data[(i+c)*at+u]=o[(n+c)*at+u];o[(n+c)*at+2]&268435456&&(this._extendedAttrs[i+c]=t._extendedAttrs[n+c])}let a=Object.keys(t._combined);for(let c=0;c<a.length;c++){let u=parseInt(a[c],10);u>=n&&(this._combined[u-n+i]=t._combined[u])}}translateToString(t,n,i,s){n=n??0,i=i??this.length,t&&(i=Math.min(i,this.getTrimmedLength())),s&&(s.length=0);let r="";for(;n<i;){let o=this._data[n*at+0],a=o&2097151,c=o&2097152?this._combined[n]:a?wa(a):Ma;if(r+=c,s)for(let u=0;u<c.length;++u)s.push(n);n+=o>>22||1}return s&&s.push(n),r}};function w_e(e,t,n,i,s,r){let o=[];for(let a=0;a<e.length-1;a++){let c=a,u=e.get(++c);if(!u.isWrapped)continue;let h=[e.get(a)];for(;c<e.length&&u.isWrapped;)h.push(u),u=e.get(++c);if(!r&&i>=a&&i<c){a+=h.length-1;continue}let f=0,m=Pf(h,f,t),y=1,b=0;for(;y<h.length;){let _=Pf(h,y,t),w=_-b,M=n-m,R=Math.min(w,M);h[f].copyCellsFrom(h[y],b,m,R,!1),m+=R,m===n&&(f++,m=0),b+=R,b===_&&(y++,b=0),m===0&&f!==0&&h[f-1].getWidth(n-1)===2&&(h[f].copyCellsFrom(h[f-1],n-1,m++,1,!1),h[f-1].setCell(n-1,s))}h[f].replaceCells(m,n,s);let S=0;for(let _=h.length-1;_>0&&(_>f||h[_].getTrimmedLength()===0);_--)S++;S>0&&(o.push(a+h.length-S),o.push(S)),a+=h.length-1}return o}function C_e(e,t){let n=[],i=0,s=t[i],r=0;for(let o=0;o<e.length;o++)if(s===o){let a=t[++i];e.onDeleteEmitter.fire({index:o-r,amount:a}),o+=a-1,r+=a,s=t[++i]}else n.push(o);return{layout:n,countRemoved:r}}function k_e(e,t){let n=[];for(let i=0;i<t.length;i++)n.push(e.get(t[i]));for(let i=0;i<n.length;i++)e.set(i,n[i]);e.length=t.length}function T_e(e,t,n){let i=[],s=e.map((c,u)=>Pf(e,u,t)).reduce((c,u)=>c+u),r=0,o=0,a=0;for(;a<s;){if(s-a<n){i.push(s-a);break}r+=n;let c=Pf(e,o,t);r>c&&(r-=c,o++);let u=e[o].getWidth(r-1)===2;u&&r--;let h=u?n-1:n;i.push(h),a+=h}return i}function Pf(e,t,n){if(t===e.length-1)return e[t].getTrimmedLength();let i=!e[t].hasContent(n-1)&&e[t].getWidth(n-1)===1,s=e[t+1].getWidth(0)===2;return i&&s?n-1:n}var J6=class Z6{constructor(t){this.line=t,this.isDisposed=!1,this._disposables=[],this._id=Z6._nextId++,this._onDispose=this.register(new we),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),Yl(this._disposables),this._disposables.length=0)}register(t){return this._disposables.push(t),t}};J6._nextId=1;var E_e=J6,jn={},Tl=jn.B;jn[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""};jn.A={"#":""};jn.B=void 0;jn[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""};jn.C=jn[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};jn.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};jn.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};jn.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};jn.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""};jn.E=jn[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};jn.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""};jn.H=jn[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};jn["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""};var M2=4294967295,A2=class{constructor(e,t,n){this._hasScrollback=e,this._optionsService=t,this._bufferService=n,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=Tn.clone(),this.savedCharset=Tl,this.markers=[],this._nullCell=zs.fromCharData([0,g6,1,0]),this._whitespaceCell=zs.fromCharData([0,Ma,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new qv,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new R2(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new Fv),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new Fv),this._whitespaceCell}getBlankLine(e,t){return new Rh(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;let t=e+this._optionsService.rawOptions.scrollback;return t>M2?M2:t}fillViewportRows(e){if(this.lines.length===0){e===void 0&&(e=Tn);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new R2(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){let n=this.getNullCell(Tn),i=0,s=this._getCorrectBufferLength(t);if(s>this.lines.maxLength&&(this.lines.maxLength=s),this.lines.length>0){if(this._cols<e)for(let o=0;o<this.lines.length;o++)i+=+this.lines.get(o).resize(e,n);let r=0;if(this._rows<t)for(let o=this._rows;o<t;o++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new Rh(e,n)):this.ybase>0&&this.lines.length<=this.ybase+this.y+r+1?(this.ybase--,r++,this.ydisp>0&&this.ydisp--):this.lines.push(new Rh(e,n)));else for(let o=this._rows;o>t;o--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(s<this.lines.maxLength){let o=this.lines.length-s;o>0&&(this.lines.trimStart(o),this.ybase=Math.max(this.ybase-o,0),this.ydisp=Math.max(this.ydisp-o,0),this.savedY=Math.max(this.savedY-o,0)),this.lines.maxLength=s}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),r&&(this.y+=r),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let r=0;r<this.lines.length;r++)i+=+this.lines.get(r).resize(e,n);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),i>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){let e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&e.backend==="conpty"&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){let n=this._optionsService.rawOptions.reflowCursorLine,i=w_e(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(Tn),n);if(i.length>0){let s=C_e(this.lines,i);k_e(this.lines,s.layout),this._reflowLargerAdjustViewport(e,t,s.countRemoved)}}_reflowLargerAdjustViewport(e,t,n){let i=this.getNullCell(Tn),s=n;for(;s-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new Rh(e,i))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-n,0)}_reflowSmaller(e,t){let n=this._optionsService.rawOptions.reflowCursorLine,i=this.getNullCell(Tn),s=[],r=0;for(let o=this.lines.length-1;o>=0;o--){let a=this.lines.get(o);if(!a||!a.isWrapped&&a.getTrimmedLength()<=e)continue;let c=[a];for(;a.isWrapped&&o>0;)a=this.lines.get(--o),c.unshift(a);if(!n){let R=this.ybase+this.y;if(R>=o&&R<o+c.length)continue}let u=c[c.length-1].getTrimmedLength(),h=T_e(c,this._cols,e),f=h.length-c.length,m;this.ybase===0&&this.y!==this.lines.length-1?m=Math.max(0,this.y-this.lines.maxLength+f):m=Math.max(0,this.lines.length-this.lines.maxLength+f);let y=[];for(let R=0;R<f;R++){let E=this.getBlankLine(Tn,!0);y.push(E)}y.length>0&&(s.push({start:o+c.length+r,newLines:y}),r+=y.length),c.push(...y);let b=h.length-1,S=h[b];S===0&&(b--,S=h[b]);let _=c.length-f-1,w=u;for(;_>=0;){let R=Math.min(w,S);if(c[b]===void 0)break;if(c[b].copyCellsFrom(c[_],w-R,S-R,R,!0),S-=R,S===0&&(b--,S=h[b]),w-=R,w===0){_--;let E=Math.max(_,0);w=Pf(c,E,this._cols)}}for(let R=0;R<c.length;R++)h[R]<e&&c[R].setCell(h[R],i);let M=f-m;for(;M-- >0;)this.ybase===0?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+r)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+f,this.ybase+t-1)}if(s.length>0){let o=[],a=[];for(let S=0;S<this.lines.length;S++)a.push(this.lines.get(S));let c=this.lines.length,u=c-1,h=0,f=s[h];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+r);let m=0;for(let S=Math.min(this.lines.maxLength-1,c+r-1);S>=0;S--)if(f&&f.start>u+m){for(let _=f.newLines.length-1;_>=0;_--)this.lines.set(S--,f.newLines[_]);S++,o.push({index:u+1,amount:f.newLines.length}),m+=f.newLines.length,f=s[++h]}else this.lines.set(S,a[u--]);let y=0;for(let S=o.length-1;S>=0;S--)o[S].index+=y,this.lines.onInsertEmitter.fire(o[S]),y+=o[S].amount;let b=Math.max(0,c+r-this.lines.maxLength);b>0&&this.lines.onTrimEmitter.fire(b)}}translateBufferLineToString(e,t,n=0,i){let s=this.lines.get(e);return s?s.translateToString(t,n,i):""}getWrappedRangeForLine(e){let t=e,n=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;n+1<this.lines.length&&this.lines.get(n+1).isWrapped;)n++;return{first:t,last:n}}setupTabStops(e){for(e!=null?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(e==null&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(e==null&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose();this.markers.length=0,this._isClearing=!1}addMarker(e){let t=new E_e(e);return this.markers.push(t),t.register(this.lines.onTrim(n=>{t.line-=n,t.line<0&&t.dispose()})),t.register(this.lines.onInsert(n=>{t.line>=n.index&&(t.line+=n.amount)})),t.register(this.lines.onDelete(n=>{t.line>=n.index&&t.line<n.index+n.amount&&t.dispose(),t.line>n.index&&(t.line-=n.amount)})),t.register(t.onDispose(()=>this._removeMarker(t))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}},R_e=class extends ct{constructor(e,t){super(),this._optionsService=e,this._bufferService=t,this._onBufferActivate=this._register(new we),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new A2(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new A2(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,t){this._normal.resize(e,t),this._alt.resize(e,t),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}},eU=2,tU=1,dC=class extends ct{constructor(e){super(),this.isUserScrolling=!1,this._onResize=this._register(new we),this.onResize=this._onResize.event,this._onScroll=this._register(new we),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,eU),this.rows=Math.max(e.rawOptions.rows||0,tU),this.buffers=this._register(new R_e(e,this)),this._register(this.buffers.onBufferActivate(t=>{this._onScroll.fire(t.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize(e,t){let n=this.cols!==e,i=this.rows!==t;this.cols=e,this.rows=t,this.buffers.resize(e,t),this._onResize.fire({cols:e,rows:t,colsChanged:n,rowsChanged:i})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,t=!1){let n=this.buffer,i;i=this._cachedBlankLine,(!i||i.length!==this.cols||i.getFg(0)!==e.fg||i.getBg(0)!==e.bg)&&(i=n.getBlankLine(e,t),this._cachedBlankLine=i),i.isWrapped=t;let s=n.ybase+n.scrollTop,r=n.ybase+n.scrollBottom;if(n.scrollTop===0){let o=n.lines.isFull;r===n.lines.length-1?o?n.lines.recycle().copyFrom(i):n.lines.push(i.clone()):n.lines.splice(r+1,0,i.clone()),o?this.isUserScrolling&&(n.ydisp=Math.max(n.ydisp-1,0)):(n.ybase++,this.isUserScrolling||n.ydisp++)}else{let o=r-s+1;n.lines.shiftElements(s+1,o-1,-1),n.lines.set(r,i.clone())}this.isUserScrolling||(n.ydisp=n.ybase),this._onScroll.fire(n.ydisp)}scrollLines(e,t){let n=this.buffer;if(e<0){if(n.ydisp===0)return;this.isUserScrolling=!0}else e+n.ydisp>=n.ybase&&(this.isUserScrolling=!1);let i=n.ydisp;n.ydisp=Math.max(Math.min(n.ydisp+e,n.ybase),0),i!==n.ydisp&&(t||this._onScroll.fire(n.ydisp))}};dC=dn([Re(0,Pi)],dC);var ru={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:$v,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},M_e=["normal","bold","100","200","300","400","500","600","700","800","900"],A_e=class extends ct{constructor(e){super(),this._onOptionChange=this._register(new we),this.onOptionChange=this._onOptionChange.event;let t={...ru};for(let n in e)if(n in t)try{let i=e[n];t[n]=this._sanitizeAndValidateOption(n,i)}catch(i){console.error(i)}this.rawOptions=t,this.options={...t},this._setupOptions(),this._register(Zt(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(e,t){return this.onOptionChange(n=>{n===e&&t(this.rawOptions[e])})}onMultipleOptionChange(e,t){return this.onOptionChange(n=>{e.indexOf(n)!==-1&&t()})}_setupOptions(){let e=n=>{if(!(n in ru))throw new Error(`No option with key "${n}"`);return this.rawOptions[n]},t=(n,i)=>{if(!(n in ru))throw new Error(`No option with key "${n}"`);i=this._sanitizeAndValidateOption(n,i),this.rawOptions[n]!==i&&(this.rawOptions[n]=i,this._onOptionChange.fire(n))};for(let n in this.rawOptions){let i={get:e.bind(this,n),set:t.bind(this,n)};Object.defineProperty(this.options,n,i)}}_sanitizeAndValidateOption(e,t){switch(e){case"cursorStyle":if(t||(t=ru[e]),!P_e(t))throw new Error(`"${t}" is not a valid value for ${e}`);break;case"wordSeparator":t||(t=ru[e]);break;case"fontWeight":case"fontWeightBold":if(typeof t=="number"&&1<=t&&t<=1e3)break;t=M_e.includes(t)?t:ru[e];break;case"cursorWidth":t=Math.floor(t);case"lineHeight":case"tabStopWidth":if(t<1)throw new Error(`${e} cannot be less than 1, value: ${t}`);break;case"minimumContrastRatio":t=Math.max(1,Math.min(21,Math.round(t*10)/10));break;case"scrollback":if(t=Math.min(t,4294967295),t<0)throw new Error(`${e} cannot be less than 0, value: ${t}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(t<=0)throw new Error(`${e} cannot be less than or equal to 0, value: ${t}`);break;case"rows":case"cols":if(!t&&t!==0)throw new Error(`${e} must be numeric, value: ${t}`);break;case"windowsPty":t=t??{};break}return t}};function P_e(e){return e==="block"||e==="underline"||e==="bar"}function Mh(e,t=5){if(typeof e!="object")return e;let n=Array.isArray(e)?[]:{};for(let i in e)n[i]=t<=1?e[i]:e[i]&&Mh(e[i],t-1);return n}var P2=Object.freeze({insertMode:!1}),L2=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),hC=class extends ct{constructor(e,t,n){super(),this._bufferService=e,this._logService=t,this._optionsService=n,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new we),this.onData=this._onData.event,this._onUserInput=this._register(new we),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new we),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new we),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=Mh(P2),this.decPrivateModes=Mh(L2)}reset(){this.modes=Mh(P2),this.decPrivateModes=Mh(L2)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;let n=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&n.ybase!==n.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`),this._logService.trace("sending data (codes)",()=>e.split("").map(i=>i.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`),this._logService.trace("sending binary (codes)",()=>e.split("").map(t=>t.charCodeAt(0))),this._onBinary.fire(e))}};hC=dn([Re(0,Ai),Re(1,S6),Re(2,Pi)],hC);var N2={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>e.button===4||e.action!==1?!1:(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>e.action!==32},DRAG:{events:23,restrict:e=>!(e.action===32&&e.button===3)},ANY:{events:31,restrict:e=>!0}};function XS(e,t){let n=(e.ctrl?16:0)|(e.shift?4:0)|(e.alt?8:0);return e.button===4?(n|=64,n|=e.action):(n|=e.button&3,e.button&4&&(n|=64),e.button&8&&(n|=128),e.action===32?n|=32:e.action===0&&!t&&(n|=3)),n}var QS=String.fromCharCode,I2={DEFAULT:e=>{let t=[XS(e,!1)+32,e.col+32,e.row+32];return t[0]>255||t[1]>255||t[2]>255?"":`\x1B[M${QS(t[0])}${QS(t[1])}${QS(t[2])}`},SGR:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${XS(e,!0)};${e.col};${e.row}${t}`},SGR_PIXELS:e=>{let t=e.action===0&&e.button!==4?"m":"M";return`\x1B[<${XS(e,!0)};${e.x};${e.y}${t}`}},fC=class extends ct{constructor(e,t,n){super(),this._bufferService=e,this._coreService=t,this._optionsService=n,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new we),this.onProtocolChange=this._onProtocolChange.event;for(let i of Object.keys(N2))this.addProtocol(i,N2[i]);for(let i of Object.keys(I2))this.addEncoding(i,I2[i]);this.reset()}addProtocol(e,t){this._protocols[e]=t}addEncoding(e,t){this._encodings[e]=t}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(e){if(!this._protocols[e])throw new Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw new Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent(e,t,n){if(e.deltaY===0||e.shiftKey||t===void 0||n===void 0)return 0;let i=t/n,s=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(s/=i+0,Math.abs(e.deltaY)<50&&(s*=.3),this._wheelPartialScroll+=s,s=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(s*=this._bufferService.rows),s}_applyScrollModifier(e,t){return t.altKey||t.ctrlKey||t.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows||e.button===4&&e.action===32||e.button===3&&e.action!==32||e.button!==4&&(e.action===2||e.action===3)||(e.col++,e.row++,e.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,e,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(e))return!1;let t=this._encodings[this._activeEncoding](e);return t&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(t):this._coreService.triggerDataEvent(t,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(e&1),up:!!(e&2),drag:!!(e&4),move:!!(e&8),wheel:!!(e&16)}}_equalEvents(e,t,n){if(n){if(e.x!==t.x||e.y!==t.y)return!1}else if(e.col!==t.col||e.row!==t.row)return!1;return!(e.button!==t.button||e.action!==t.action||e.ctrl!==t.ctrl||e.alt!==t.alt||e.shift!==t.shift)}};fC=dn([Re(0,Ai),Re(1,oc),Re(2,Pi)],fC);var JS=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],L_e=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],Nn;function N_e(e,t){let n=0,i=t.length-1,s;if(e<t[0][0]||e>t[i][1])return!1;for(;i>=n;)if(s=n+i>>1,e>t[s][1])n=s+1;else if(e<t[s][0])i=s-1;else return!0;return!1}var I_e=class{constructor(){if(this.version="6",!Nn){Nn=new Uint8Array(65536),Nn.fill(1),Nn[0]=0,Nn.fill(0,1,32),Nn.fill(0,127,160),Nn.fill(2,4352,4448),Nn[9001]=2,Nn[9002]=2,Nn.fill(2,11904,42192),Nn[12351]=1,Nn.fill(2,44032,55204),Nn.fill(2,63744,64256),Nn.fill(2,65040,65050),Nn.fill(2,65072,65136),Nn.fill(2,65280,65377),Nn.fill(2,65504,65511);for(let e=0;e<JS.length;++e)Nn.fill(0,JS[e][0],JS[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?Nn[e]:N_e(e,L_e)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1}charProperties(e,t){let n=this.wcwidth(e),i=n===0&&t!==0;if(i){let s=Il.extractWidth(t);s===0?i=!1:s>n&&(n=s)}return Il.createPropertyValue(0,n,i)}},Il=class Bg{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new we,this.onChange=this._onChange.event;let t=new I_e;this.register(t),this._active=t.version,this._activeProvider=t}static extractShouldJoin(t){return(t&1)!==0}static extractWidth(t){return t>>1&3}static extractCharKind(t){return t>>3}static createPropertyValue(t,n,i=!1){return(t&16777215)<<3|(n&3)<<1|(i?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(t){if(!this._providers[t])throw new Error(`unknown Unicode version "${t}"`);this._active=t,this._activeProvider=this._providers[t],this._onChange.fire(t)}register(t){this._providers[t.version]=t}wcwidth(t){return this._activeProvider.wcwidth(t)}getStringCellWidth(t){let n=0,i=0,s=t.length;for(let r=0;r<s;++r){let o=t.charCodeAt(r);if(55296<=o&&o<=56319){if(++r>=s)return n+this.wcwidth(o);let u=t.charCodeAt(r);56320<=u&&u<=57343?o=(o-55296)*1024+u-56320+65536:n+=this.wcwidth(u)}let a=this.charProperties(o,i),c=Bg.extractWidth(a);Bg.extractShouldJoin(a)&&(c-=Bg.extractWidth(i)),n+=c,i=a}return n}charProperties(t,n){return this._activeProvider.charProperties(t,n)}},D_e=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,t){this._charsets[e]=t,this.glevel===e&&(this.charset=t)}};function D2(e){let t=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1)?.get(e.cols-1),n=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);n&&t&&(n.isWrapped=t[3]!==0&&t[3]!==32)}var ph=2147483647,O_e=256,nU=class pC{constructor(t=32,n=32){if(this.maxLength=t,this.maxSubParamsLength=n,n>O_e)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(t),this.length=0,this._subParams=new Int32Array(n),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(t),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(t){let n=new pC;if(!t.length)return n;for(let i=Array.isArray(t[0])?1:0;i<t.length;++i){let s=t[i];if(Array.isArray(s))for(let r=0;r<s.length;++r)n.addSubParam(s[r]);else n.addParam(s)}return n}clone(){let t=new pC(this.maxLength,this.maxSubParamsLength);return t.params.set(this.params),t.length=this.length,t._subParams.set(this._subParams),t._subParamsLength=this._subParamsLength,t._subParamsIdx.set(this._subParamsIdx),t._rejectDigits=this._rejectDigits,t._rejectSubDigits=this._rejectSubDigits,t._digitIsSub=this._digitIsSub,t}toArray(){let t=[];for(let n=0;n<this.length;++n){t.push(this.params[n]);let i=this._subParamsIdx[n]>>8,s=this._subParamsIdx[n]&255;s-i>0&&t.push(Array.prototype.slice.call(this._subParams,i,s))}return t}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(t){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=t>ph?ph:t}addSubParam(t){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=t>ph?ph:t,this._subParamsIdx[this.length-1]++}}hasSubParams(t){return(this._subParamsIdx[t]&255)-(this._subParamsIdx[t]>>8)>0}getSubParams(t){let n=this._subParamsIdx[t]>>8,i=this._subParamsIdx[t]&255;return i-n>0?this._subParams.subarray(n,i):null}getSubParamsAll(){let t={};for(let n=0;n<this.length;++n){let i=this._subParamsIdx[n]>>8,s=this._subParamsIdx[n]&255;s-i>0&&(t[n]=this._subParams.slice(i,s))}return t}addDigit(t){let n;if(this._rejectDigits||!(n=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let i=this._digitIsSub?this._subParams:this.params,s=i[n-1];i[n-1]=~s?Math.min(s*10+t,ph):t}},mh=[],j_e=class{constructor(){this._state=0,this._active=mh,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let n=this._handlers[e];return n.push(t),{dispose:()=>{let i=n.indexOf(t);i!==-1&&n.splice(i,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=mh}reset(){if(this._state===2)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=mh,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||mh,!this._active.length)this._handlerFb(this._id,"START");else for(let e=this._active.length-1;e>=0;e--)this._active[e].start()}_put(e,t,n){if(!this._active.length)this._handlerFb(this._id,"PUT",Ry(e,t,n));else for(let i=this._active.length-1;i>=0;i--)this._active[i].put(e,t,n)}start(){this.reset(),this._state=1}put(e,t,n){if(this._state!==3){if(this._state===1)for(;t<n;){let i=e[t++];if(i===59){this._state=2,this._start();break}if(i<48||57<i){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+i-48}this._state===2&&n-t>0&&this._put(e,t,n)}}end(e,t=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",e);else{let n=!1,i=this._active.length-1,s=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,n=t,s=this._stack.fallThrough,this._stack.paused=!1),!s&&n===!1){for(;i>=0&&(n=this._active[i].end(e),n!==!0);i--)if(n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,n;i--}for(;i>=0;i--)if(n=this._active[i].end(!1),n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,n}this._active=mh,this._id=-1,this._state=0}}},ss=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,t,n){this._hitLimit||(this._data+=Ry(e,t,n),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data),t instanceof Promise))return t.then(n=>(this._data="",this._hitLimit=!1,n));return this._data="",this._hitLimit=!1,t}},gh=[],B_e=class{constructor(){this._handlers=Object.create(null),this._active=gh,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=gh}registerHandler(e,t){this._handlers[e]===void 0&&(this._handlers[e]=[]);let n=this._handlers[e];return n.push(t),{dispose:()=>{let i=n.indexOf(t);i!==-1&&n.splice(i,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=gh,this._ident=0}hook(e,t){if(this.reset(),this._ident=e,this._active=this._handlers[e]||gh,!this._active.length)this._handlerFb(this._ident,"HOOK",t);else for(let n=this._active.length-1;n>=0;n--)this._active[n].hook(t)}put(e,t,n){if(!this._active.length)this._handlerFb(this._ident,"PUT",Ry(e,t,n));else for(let i=this._active.length-1;i>=0;i--)this._active[i].put(e,t,n)}unhook(e,t=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",e);else{let n=!1,i=this._active.length-1,s=!1;if(this._stack.paused&&(i=this._stack.loopPosition-1,n=t,s=this._stack.fallThrough,this._stack.paused=!1),!s&&n===!1){for(;i>=0&&(n=this._active[i].unhook(e),n!==!0);i--)if(n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!1,n;i--}for(;i>=0;i--)if(n=this._active[i].unhook(!1),n instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=i,this._stack.fallThrough=!0,n}this._active=gh,this._ident=0}},Ah=new nU;Ah.addParam(0);var O2=class{constructor(e){this._handler=e,this._data="",this._params=Ah,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():Ah,this._data="",this._hitLimit=!1}put(e,t,n){this._hitLimit||(this._data+=Ry(e,t,n),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook(e){let t=!1;if(this._hitLimit)t=!1;else if(e&&(t=this._handler(this._data,this._params),t instanceof Promise))return t.then(n=>(this._params=Ah,this._data="",this._hitLimit=!1,n));return this._params=Ah,this._data="",this._hitLimit=!1,t}},F_e=class{constructor(e){this.table=new Uint8Array(e)}setDefault(e,t){this.table.fill(e<<4|t)}add(e,t,n,i){this.table[t<<8|e]=n<<4|i}addMany(e,t,n,i){for(let s=0;s<e.length;s++)this.table[t<<8|e[s]]=n<<4|i}},Ls=160,U_e=(function(){let e=new F_e(4095),t=Array.apply(null,Array(256)).map((a,c)=>c),n=(a,c)=>t.slice(a,c),i=n(32,127),s=n(0,24);s.push(25),s.push.apply(s,n(28,32));let r=n(0,14),o;e.setDefault(1,0),e.addMany(i,0,2,0);for(o in r)e.addMany([24,26,153,154],o,3,0),e.addMany(n(128,144),o,3,0),e.addMany(n(144,152),o,3,0),e.add(156,o,0,0),e.add(27,o,11,1),e.add(157,o,4,8),e.addMany([152,158,159],o,0,7),e.add(155,o,11,3),e.add(144,o,11,9);return e.addMany(s,0,3,0),e.addMany(s,1,3,1),e.add(127,1,0,1),e.addMany(s,8,0,8),e.addMany(s,3,3,3),e.add(127,3,0,3),e.addMany(s,4,3,4),e.add(127,4,0,4),e.addMany(s,6,3,6),e.addMany(s,5,3,5),e.add(127,5,0,5),e.addMany(s,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(i,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(n(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(i,7,0,7),e.addMany(s,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(n(64,127),3,7,0),e.addMany(n(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(n(48,60),4,8,4),e.addMany(n(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(n(32,64),6,0,6),e.add(127,6,0,6),e.addMany(n(64,127),6,0,0),e.addMany(n(32,48),3,9,5),e.addMany(n(32,48),5,9,5),e.addMany(n(48,64),5,0,6),e.addMany(n(64,127),5,7,0),e.addMany(n(32,48),4,9,5),e.addMany(n(32,48),1,9,2),e.addMany(n(32,48),2,9,2),e.addMany(n(48,127),2,10,0),e.addMany(n(48,80),1,10,0),e.addMany(n(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(n(96,127),1,10,0),e.add(80,1,11,9),e.addMany(s,9,0,9),e.add(127,9,0,9),e.addMany(n(28,32),9,0,9),e.addMany(n(32,48),9,9,12),e.addMany(n(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(s,11,0,11),e.addMany(n(32,128),11,0,11),e.addMany(n(28,32),11,0,11),e.addMany(s,10,0,10),e.add(127,10,0,10),e.addMany(n(28,32),10,0,10),e.addMany(n(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(n(32,48),10,9,12),e.addMany(s,12,0,12),e.add(127,12,0,12),e.addMany(n(28,32),12,0,12),e.addMany(n(32,48),12,9,12),e.addMany(n(48,64),12,0,11),e.addMany(n(64,127),12,12,13),e.addMany(n(64,127),10,12,13),e.addMany(n(64,127),9,12,13),e.addMany(s,13,13,13),e.addMany(i,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(Ls,0,2,0),e.add(Ls,8,5,8),e.add(Ls,6,0,6),e.add(Ls,11,0,11),e.add(Ls,13,13,13),e})(),z_e=class extends ct{constructor(e=U_e){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new nU,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(t,n,i)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,n)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(Zt(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new j_e),this._dcsParser=this._register(new B_e),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(e,t=[64,126]){let n=0;if(e.prefix){if(e.prefix.length>1)throw new Error("only one byte as prefix supported");if(n=e.prefix.charCodeAt(0),n&&60>n||n>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let s=0;s<e.intermediates.length;++s){let r=e.intermediates.charCodeAt(s);if(32>r||r>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");n<<=8,n|=r}}if(e.final.length!==1)throw new Error("final must be a single byte");let i=e.final.charCodeAt(0);if(t[0]>i||i>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return n<<=8,n|=i,n}identToString(e){let t=[];for(;e;)t.push(String.fromCharCode(e&255)),e>>=8;return t.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,t){let n=this._identifier(e,[48,126]);this._escHandlers[n]===void 0&&(this._escHandlers[n]=[]);let i=this._escHandlers[n];return i.push(t),{dispose:()=>{let s=i.indexOf(t);s!==-1&&i.splice(s,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,t){this._executeHandlers[e.charCodeAt(0)]=t}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,t){let n=this._identifier(e);this._csiHandlers[n]===void 0&&(this._csiHandlers[n]=[]);let i=this._csiHandlers[n];return i.push(t),{dispose:()=>{let s=i.indexOf(t);s!==-1&&i.splice(s,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,t){return this._dcsParser.registerHandler(this._identifier(e),t)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,t){return this._oscParser.registerHandler(e,t)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,t,n,i,s){this._parseStack.state=e,this._parseStack.handlers=t,this._parseStack.handlerPos=n,this._parseStack.transition=i,this._parseStack.chunkPos=s}parse(e,t,n){let i=0,s=0,r=0,o;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,r=this._parseStack.chunkPos+1;else{if(n===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");let a=this._parseStack.handlers,c=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(n===!1&&c>-1){for(;c>=0&&(o=a[c](this._params),o!==!0);c--)if(o instanceof Promise)return this._parseStack.handlerPos=c,o}this._parseStack.handlers=[];break;case 4:if(n===!1&&c>-1){for(;c>=0&&(o=a[c](),o!==!0);c--)if(o instanceof Promise)return this._parseStack.handlerPos=c,o}this._parseStack.handlers=[];break;case 6:if(i=e[this._parseStack.chunkPos],o=this._dcsParser.unhook(i!==24&&i!==26,n),o)return o;i===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(i=e[this._parseStack.chunkPos],o=this._oscParser.end(i!==24&&i!==26,n),o)return o;i===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,r=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let a=r;a<t;++a){switch(i=e[a],s=this._transitions.table[this.currentState<<8|(i<160?i:Ls)],s>>4){case 2:for(let m=a+1;;++m){if(m>=t||(i=e[m])<32||i>126&&i<Ls){this._printHandler(e,a,m),a=m-1;break}if(++m>=t||(i=e[m])<32||i>126&&i<Ls){this._printHandler(e,a,m),a=m-1;break}if(++m>=t||(i=e[m])<32||i>126&&i<Ls){this._printHandler(e,a,m),a=m-1;break}if(++m>=t||(i=e[m])<32||i>126&&i<Ls){this._printHandler(e,a,m),a=m-1;break}}break;case 3:this._executeHandlers[i]?this._executeHandlers[i]():this._executeHandlerFb(i),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:a,code:i,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let c=this._csiHandlers[this._collect<<8|i],u=c?c.length-1:-1;for(;u>=0&&(o=c[u](this._params),o!==!0);u--)if(o instanceof Promise)return this._preserveStack(3,c,u,s,a),o;u<0&&this._csiHandlerFb(this._collect<<8|i,this._params),this.precedingJoinState=0;break;case 8:do switch(i){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(i-48)}while(++a<t&&(i=e[a])>47&&i<60);a--;break;case 9:this._collect<<=8,this._collect|=i;break;case 10:let h=this._escHandlers[this._collect<<8|i],f=h?h.length-1:-1;for(;f>=0&&(o=h[f](),o!==!0);f--)if(o instanceof Promise)return this._preserveStack(4,h,f,s,a),o;f<0&&this._escHandlerFb(this._collect<<8|i),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|i,this._params);break;case 13:for(let m=a+1;;++m)if(m>=t||(i=e[m])===24||i===26||i===27||i>127&&i<Ls){this._dcsParser.put(e,a,m),a=m-1;break}break;case 14:if(o=this._dcsParser.unhook(i!==24&&i!==26),o)return this._preserveStack(6,[],0,s,a),o;i===27&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let m=a+1;;m++)if(m>=t||(i=e[m])<32||i>127&&i<Ls){this._oscParser.put(e,a,m),a=m-1;break}break;case 6:if(o=this._oscParser.end(i!==24&&i!==26),o)return this._preserveStack(5,[],0,s,a),o;i===27&&(s|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=s&15}}},$_e=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,q_e=/^[\da-f]+$/;function j2(e){if(!e)return;let t=e.toLowerCase();if(t.indexOf("rgb:")===0){t=t.slice(4);let n=$_e.exec(t);if(n){let i=n[1]?15:n[4]?255:n[7]?4095:65535;return[Math.round(parseInt(n[1]||n[4]||n[7]||n[10],16)/i*255),Math.round(parseInt(n[2]||n[5]||n[8]||n[11],16)/i*255),Math.round(parseInt(n[3]||n[6]||n[9]||n[12],16)/i*255)]}}else if(t.indexOf("#")===0&&(t=t.slice(1),q_e.exec(t)&&[3,6,9,12].includes(t.length))){let n=t.length/3,i=[0,0,0];for(let s=0;s<3;++s){let r=parseInt(t.slice(n*s,n*s+n),16);i[s]=n===1?r<<4:n===2?r:n===3?r>>4:r>>8}return i}}function ZS(e,t){let n=e.toString(16),i=n.length<2?"0"+n:n;switch(t){case 4:return n[0];case 8:return i;case 12:return(i+i).slice(0,3);default:return i+i}}function H_e(e,t=16){let[n,i,s]=e;return`rgb:${ZS(n,t)}/${ZS(i,t)}/${ZS(s,t)}`}var V_e={"(":0,")":1,"*":2,"+":3,"-":1,".":2},ya=131072,B2=10;function F2(e,t){if(e>24)return t.setWinLines||!1;switch(e){case 1:return!!t.restoreWin;case 2:return!!t.minimizeWin;case 3:return!!t.setWinPosition;case 4:return!!t.setWinSizePixels;case 5:return!!t.raiseWin;case 6:return!!t.lowerWin;case 7:return!!t.refreshWin;case 8:return!!t.setWinSizeChars;case 9:return!!t.maximizeWin;case 10:return!!t.fullscreenWin;case 11:return!!t.getWinState;case 13:return!!t.getWinPosition;case 14:return!!t.getWinSizePixels;case 15:return!!t.getScreenSizePixels;case 16:return!!t.getCellSizePixels;case 18:return!!t.getWinSizeChars;case 19:return!!t.getScreenSizeChars;case 20:return!!t.getIconTitle;case 21:return!!t.getWinTitle;case 22:return!!t.pushTitle;case 23:return!!t.popTitle;case 24:return!!t.setWinLines}return!1}var U2=5e3,z2=0,W_e=class extends ct{constructor(e,t,n,i,s,r,o,a,c=new z_e){super(),this._bufferService=e,this._charsetService=t,this._coreService=n,this._logService=i,this._optionsService=s,this._oscLinkService=r,this._coreMouseService=o,this._unicodeService=a,this._parser=c,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new dye,this._utf8Decoder=new hye,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=Tn.clone(),this._eraseAttrDataInternal=Tn.clone(),this._onRequestBell=this._register(new we),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new we),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new we),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new we),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new we),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new we),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new we),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new we),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new we),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new we),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new we),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new we),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new we),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new mC(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate(u=>this._activeBuffer=u.activeBuffer)),this._parser.setCsiHandlerFallback((u,h)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(u),params:h.toArray()})}),this._parser.setEscHandlerFallback(u=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(u)})}),this._parser.setExecuteHandlerFallback(u=>{this._logService.debug("Unknown EXECUTE code: ",{code:u})}),this._parser.setOscHandlerFallback((u,h,f)=>{this._logService.debug("Unknown OSC code: ",{identifier:u,action:h,data:f})}),this._parser.setDcsHandlerFallback((u,h,f)=>{h==="HOOK"&&(f=f.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(u),action:h,payload:f})}),this._parser.setPrintHandler((u,h,f)=>this.print(u,h,f)),this._parser.registerCsiHandler({final:"@"},u=>this.insertChars(u)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},u=>this.scrollLeft(u)),this._parser.registerCsiHandler({final:"A"},u=>this.cursorUp(u)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},u=>this.scrollRight(u)),this._parser.registerCsiHandler({final:"B"},u=>this.cursorDown(u)),this._parser.registerCsiHandler({final:"C"},u=>this.cursorForward(u)),this._parser.registerCsiHandler({final:"D"},u=>this.cursorBackward(u)),this._parser.registerCsiHandler({final:"E"},u=>this.cursorNextLine(u)),this._parser.registerCsiHandler({final:"F"},u=>this.cursorPrecedingLine(u)),this._parser.registerCsiHandler({final:"G"},u=>this.cursorCharAbsolute(u)),this._parser.registerCsiHandler({final:"H"},u=>this.cursorPosition(u)),this._parser.registerCsiHandler({final:"I"},u=>this.cursorForwardTab(u)),this._parser.registerCsiHandler({final:"J"},u=>this.eraseInDisplay(u,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},u=>this.eraseInDisplay(u,!0)),this._parser.registerCsiHandler({final:"K"},u=>this.eraseInLine(u,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},u=>this.eraseInLine(u,!0)),this._parser.registerCsiHandler({final:"L"},u=>this.insertLines(u)),this._parser.registerCsiHandler({final:"M"},u=>this.deleteLines(u)),this._parser.registerCsiHandler({final:"P"},u=>this.deleteChars(u)),this._parser.registerCsiHandler({final:"S"},u=>this.scrollUp(u)),this._parser.registerCsiHandler({final:"T"},u=>this.scrollDown(u)),this._parser.registerCsiHandler({final:"X"},u=>this.eraseChars(u)),this._parser.registerCsiHandler({final:"Z"},u=>this.cursorBackwardTab(u)),this._parser.registerCsiHandler({final:"`"},u=>this.charPosAbsolute(u)),this._parser.registerCsiHandler({final:"a"},u=>this.hPositionRelative(u)),this._parser.registerCsiHandler({final:"b"},u=>this.repeatPrecedingCharacter(u)),this._parser.registerCsiHandler({final:"c"},u=>this.sendDeviceAttributesPrimary(u)),this._parser.registerCsiHandler({prefix:">",final:"c"},u=>this.sendDeviceAttributesSecondary(u)),this._parser.registerCsiHandler({final:"d"},u=>this.linePosAbsolute(u)),this._parser.registerCsiHandler({final:"e"},u=>this.vPositionRelative(u)),this._parser.registerCsiHandler({final:"f"},u=>this.hVPosition(u)),this._parser.registerCsiHandler({final:"g"},u=>this.tabClear(u)),this._parser.registerCsiHandler({final:"h"},u=>this.setMode(u)),this._parser.registerCsiHandler({prefix:"?",final:"h"},u=>this.setModePrivate(u)),this._parser.registerCsiHandler({final:"l"},u=>this.resetMode(u)),this._parser.registerCsiHandler({prefix:"?",final:"l"},u=>this.resetModePrivate(u)),this._parser.registerCsiHandler({final:"m"},u=>this.charAttributes(u)),this._parser.registerCsiHandler({final:"n"},u=>this.deviceStatus(u)),this._parser.registerCsiHandler({prefix:"?",final:"n"},u=>this.deviceStatusPrivate(u)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},u=>this.softReset(u)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},u=>this.setCursorStyle(u)),this._parser.registerCsiHandler({final:"r"},u=>this.setScrollRegion(u)),this._parser.registerCsiHandler({final:"s"},u=>this.saveCursor(u)),this._parser.registerCsiHandler({final:"t"},u=>this.windowOptions(u)),this._parser.registerCsiHandler({final:"u"},u=>this.restoreCursor(u)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},u=>this.insertColumns(u)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},u=>this.deleteColumns(u)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},u=>this.selectProtected(u)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},u=>this.requestMode(u,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},u=>this.requestMode(u,!1)),this._parser.setExecuteHandler(fe.BEL,()=>this.bell()),this._parser.setExecuteHandler(fe.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(fe.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(fe.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(fe.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(fe.BS,()=>this.backspace()),this._parser.setExecuteHandler(fe.HT,()=>this.tab()),this._parser.setExecuteHandler(fe.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(fe.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(Og.IND,()=>this.index()),this._parser.setExecuteHandler(Og.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(Og.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new ss(u=>(this.setTitle(u),this.setIconName(u),!0))),this._parser.registerOscHandler(1,new ss(u=>this.setIconName(u))),this._parser.registerOscHandler(2,new ss(u=>this.setTitle(u))),this._parser.registerOscHandler(4,new ss(u=>this.setOrReportIndexedColor(u))),this._parser.registerOscHandler(8,new ss(u=>this.setHyperlink(u))),this._parser.registerOscHandler(10,new ss(u=>this.setOrReportFgColor(u))),this._parser.registerOscHandler(11,new ss(u=>this.setOrReportBgColor(u))),this._parser.registerOscHandler(12,new ss(u=>this.setOrReportCursorColor(u))),this._parser.registerOscHandler(104,new ss(u=>this.restoreIndexedColor(u))),this._parser.registerOscHandler(110,new ss(u=>this.restoreFgColor(u))),this._parser.registerOscHandler(111,new ss(u=>this.restoreBgColor(u))),this._parser.registerOscHandler(112,new ss(u=>this.restoreCursorColor(u))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let u in jn)this._parser.registerEscHandler({intermediates:"(",final:u},()=>this.selectCharset("("+u)),this._parser.registerEscHandler({intermediates:")",final:u},()=>this.selectCharset(")"+u)),this._parser.registerEscHandler({intermediates:"*",final:u},()=>this.selectCharset("*"+u)),this._parser.registerEscHandler({intermediates:"+",final:u},()=>this.selectCharset("+"+u)),this._parser.registerEscHandler({intermediates:"-",final:u},()=>this.selectCharset("-"+u)),this._parser.registerEscHandler({intermediates:".",final:u},()=>this.selectCharset("."+u)),this._parser.registerEscHandler({intermediates:"/",final:u},()=>this.selectCharset("/"+u));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(u=>(this._logService.error("Parsing error: ",u),u)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new O2((u,h)=>this.requestStatusString(u,h)))}getAttrData(){return this._curAttrData}_preserveStack(e,t,n,i){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=t,this._parseStack.decodedLength=n,this._parseStack.position=i}_logSlowResolvingAsync(e){this._logService.logLevel<=3&&Promise.race([e,new Promise((t,n)=>setTimeout(()=>n("#SLOW_TIMEOUT"),U2))]).catch(t=>{if(t!=="#SLOW_TIMEOUT")throw t;console.warn(`async parser handler taking longer than ${U2} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,t){let n,i=this._activeBuffer.x,s=this._activeBuffer.y,r=0,o=this._parseStack.paused;if(o){if(n=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,t))return this._logSlowResolvingAsync(n),n;i=this._parseStack.cursorStartX,s=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>ya&&(r=this._parseStack.position+ya)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof e=="string"?` "${e}"`:` "${Array.prototype.map.call(e,u=>String.fromCharCode(u)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof e=="string"?e.split("").map(u=>u.charCodeAt(0)):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<ya&&(this._parseBuffer=new Uint32Array(Math.min(e.length,ya))),o||this._dirtyRowTracker.clearRange(),e.length>ya)for(let u=r;u<e.length;u+=ya){let h=u+ya<e.length?u+ya:e.length,f=typeof e=="string"?this._stringDecoder.decode(e.substring(u,h),this._parseBuffer):this._utf8Decoder.decode(e.subarray(u,h),this._parseBuffer);if(n=this._parser.parse(this._parseBuffer,f))return this._preserveStack(i,s,f,u),this._logSlowResolvingAsync(n),n}else if(!o){let u=typeof e=="string"?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(n=this._parser.parse(this._parseBuffer,u))return this._preserveStack(i,s,u,0),this._logSlowResolvingAsync(n),n}(this._activeBuffer.x!==i||this._activeBuffer.y!==s)&&this._onCursorMove.fire();let a=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),c=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);c<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(c,this._bufferService.rows-1),end:Math.min(a,this._bufferService.rows-1)})}print(e,t,n){let i,s,r=this._charsetService.charset,o=this._optionsService.rawOptions.screenReaderMode,a=this._bufferService.cols,c=this._coreService.decPrivateModes.wraparound,u=this._coreService.modes.insertMode,h=this._curAttrData,f=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&n-t>0&&f.getWidth(this._activeBuffer.x-1)===2&&f.setCellFromCodepoint(this._activeBuffer.x-1,0,1,h);let m=this._parser.precedingJoinState;for(let y=t;y<n;++y){if(i=e[y],i<127&&r){let w=r[String.fromCharCode(i)];w&&(i=w.charCodeAt(0))}let b=this._unicodeService.charProperties(i,m);s=Il.extractWidth(b);let S=Il.extractShouldJoin(b),_=S?Il.extractWidth(m):0;if(m=b,o&&this._onA11yChar.fire(wa(i)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+s-_>a){if(c){let w=f,M=this._activeBuffer.x-_;for(this._activeBuffer.x=_,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),f=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),_>0&&f instanceof Rh&&f.copyCellsFrom(w,M,0,_,!1);M<a;)w.setCellFromCodepoint(M++,0,1,h)}else if(this._activeBuffer.x=a-1,s===2)continue}if(S&&this._activeBuffer.x){let w=f.getWidth(this._activeBuffer.x-1)?1:2;f.addCodepointToCell(this._activeBuffer.x-w,i,s);for(let M=s-_;--M>=0;)f.setCellFromCodepoint(this._activeBuffer.x++,0,0,h);continue}if(u&&(f.insertCells(this._activeBuffer.x,s-_,this._activeBuffer.getNullCell(h)),f.getWidth(a-1)===2&&f.setCellFromCodepoint(a-1,0,1,h)),f.setCellFromCodepoint(this._activeBuffer.x++,i,s,h),s>0)for(;--s;)f.setCellFromCodepoint(this._activeBuffer.x++,0,0,h)}this._parser.precedingJoinState=m,this._activeBuffer.x<a&&n-t>0&&f.getWidth(this._activeBuffer.x)===0&&!f.hasContent(this._activeBuffer.x)&&f.setCellFromCodepoint(this._activeBuffer.x,0,1,h),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,t){return e.final==="t"&&!e.prefix&&!e.intermediates?this._parser.registerCsiHandler(e,n=>F2(n.params[0],this._optionsService.rawOptions.windowOptions)?t(n):!0):this._parser.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._parser.registerDcsHandler(e,new O2(t))}registerEscHandler(e,t){return this._parser.registerEscHandler(e,t)}registerOscHandler(e,t){return this._parser.registerOscHandler(e,new ss(t))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);e.hasWidth(this._activeBuffer.x)&&!e.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,t){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+t):(this._activeBuffer.x=e,this._activeBuffer.y=t),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,t){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+t)}cursorUp(e){let t=this._activeBuffer.y-this._activeBuffer.scrollTop;return t>=0?this._moveCursor(0,-Math.min(t,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){let t=this._activeBuffer.scrollBottom-this._activeBuffer.y;return t>=0?this._moveCursor(0,Math.min(t,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){let t=e.params[0];return t===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:t===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let t=e.params[0]||1;for(;t--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){let t=e.params[0];return t===1&&(this._curAttrData.bg|=536870912),(t===2||t===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(e,t,n,i=!1,s=!1){let r=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);r.replaceCells(t,n,this._activeBuffer.getNullCell(this._eraseAttrData()),s),i&&(r.isWrapped=!1)}_resetBufferLine(e,t=!1){let n=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);n&&(n.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),t),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),n.isWrapped=!1)}eraseInDisplay(e,t=!1){this._restrictCursor(this._bufferService.cols);let n;switch(e.params[0]){case 0:for(n=this._activeBuffer.y,this._dirtyRowTracker.markDirty(n),this._eraseInBufferLine(n++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);n<this._bufferService.rows;n++)this._resetBufferLine(n,t);this._dirtyRowTracker.markDirty(n);break;case 1:for(n=this._activeBuffer.y,this._dirtyRowTracker.markDirty(n),this._eraseInBufferLine(n,0,this._activeBuffer.x+1,!0,t),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(n+1).isWrapped=!1);n--;)this._resetBufferLine(n,t);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(n=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,n-1);n--&&!this._activeBuffer.lines.get(this._activeBuffer.ybase+n)?.getTrimmedLength(););for(;n>=0;n--)this._bufferService.scroll(this._eraseAttrData())}else{for(n=this._bufferService.rows,this._dirtyRowTracker.markDirty(n-1);n--;)this._resetBufferLine(n,t);this._dirtyRowTracker.markDirty(0)}break;case 3:let i=this._activeBuffer.lines.length-this._bufferService.rows;i>0&&(this._activeBuffer.lines.trimStart(i),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-i,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-i,0),this._onScroll.fire(0));break}return!0}eraseInLine(e,t=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,t);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,t);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,t);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let n=this._activeBuffer.ybase+this._activeBuffer.y,i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,s=this._bufferService.rows-1+this._activeBuffer.ybase-i+1;for(;t--;)this._activeBuffer.lines.splice(s-1,1),this._activeBuffer.lines.splice(n,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let t=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let n=this._activeBuffer.ybase+this._activeBuffer.y,i;for(i=this._bufferService.rows-1-this._activeBuffer.scrollBottom,i=this._bufferService.rows-1+this._activeBuffer.ybase-i;t--;)this._activeBuffer.lines.splice(n,1),this._activeBuffer.lines.splice(i,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let t=e.params[0]||1;for(;t--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(Tn));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let n=this._activeBuffer.scrollTop;n<=this._activeBuffer.scrollBottom;++n){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+n);i.deleteCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let n=this._activeBuffer.scrollTop;n<=this._activeBuffer.scrollBottom;++n){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+n);i.insertCells(0,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let n=this._activeBuffer.scrollTop;n<=this._activeBuffer.scrollBottom;++n){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+n);i.insertCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let t=e.params[0]||1;for(let n=this._activeBuffer.scrollTop;n<=this._activeBuffer.scrollBottom;++n){let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+n);i.deleteCells(this._activeBuffer.x,t,this._activeBuffer.getNullCell(this._eraseAttrData())),i.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();let t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return t&&(t.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){let t=this._parser.precedingJoinState;if(!t)return!0;let n=e.params[0]||1,i=Il.extractWidth(t),s=this._activeBuffer.x-i,r=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(s),o=new Uint32Array(r.length*n),a=0;for(let u=0;u<r.length;){let h=r.codePointAt(u)||0;o[a++]=h,u+=h>65535?2:1}let c=a;for(let u=1;u<n;++u)o.copyWithin(c,0,a),c+=a;return this.print(o,0,c),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(fe.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(fe.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(fe.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(fe.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(fe.ESC+"[>83;40003;0c")),!0}_is(e){return(this._optionsService.rawOptions.termName+"").indexOf(e)===0}setMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,Tl),this._charsetService.setgCharset(1,Tl),this._charsetService.setgCharset(2,Tl),this._charsetService.setgCharset(3,Tl);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate(e){for(let t=0;t<e.length;t++)switch(e.params[t]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),e.params[t]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode(e,t){let n;(S=>(S[S.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",S[S.SET=1]="SET",S[S.RESET=2]="RESET",S[S.PERMANENTLY_SET=3]="PERMANENTLY_SET",S[S.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(n||={});let i=this._coreService.decPrivateModes,{activeProtocol:s,activeEncoding:r}=this._coreMouseService,o=this._coreService,{buffers:a,cols:c}=this._bufferService,{active:u,alt:h}=a,f=this._optionsService.rawOptions,m=(S,_)=>(o.triggerDataEvent(`${fe.ESC}[${t?"":"?"}${S};${_}$y`),!0),y=S=>S?1:2,b=e.params[0];return t?b===2?m(b,4):b===4?m(b,y(o.modes.insertMode)):b===12?m(b,3):b===20?m(b,y(f.convertEol)):m(b,0):b===1?m(b,y(i.applicationCursorKeys)):b===3?m(b,f.windowOptions.setWinLines?c===80?2:c===132?1:0:0):b===6?m(b,y(i.origin)):b===7?m(b,y(i.wraparound)):b===8?m(b,3):b===9?m(b,y(s==="X10")):b===12?m(b,y(f.cursorBlink)):b===25?m(b,y(!o.isCursorHidden)):b===45?m(b,y(i.reverseWraparound)):b===66?m(b,y(i.applicationKeypad)):b===67?m(b,4):b===1e3?m(b,y(s==="VT200")):b===1002?m(b,y(s==="DRAG")):b===1003?m(b,y(s==="ANY")):b===1004?m(b,y(i.sendFocus)):b===1005?m(b,4):b===1006?m(b,y(r==="SGR")):b===1015?m(b,4):b===1016?m(b,y(r==="SGR_PIXELS")):b===1048?m(b,1):b===47||b===1047||b===1049?m(b,y(u===h)):b===2004?m(b,y(i.bracketedPasteMode)):b===2026?m(b,y(i.synchronizedOutput)):m(b,0)}_updateAttrColor(e,t,n,i,s){return t===2?(e|=50331648,e&=-16777216,e|=Kf.fromColorRGB([n,i,s])):t===5&&(e&=-50331904,e|=33554432|n&255),e}_extractColor(e,t,n){let i=[0,0,-1,0,0,0],s=0,r=0;do{if(i[r+s]=e.params[t+r],e.hasSubParams(t+r)){let o=e.getSubParams(t+r),a=0;do i[1]===5&&(s=1),i[r+a+1+s]=o[a];while(++a<o.length&&a+r+1+s<i.length);break}if(i[1]===5&&r+s>=2||i[1]===2&&r+s>=5)break;i[1]&&(s=1)}while(++r+t<e.length&&r+s<i.length);for(let o=2;o<i.length;++o)i[o]===-1&&(i[o]=0);switch(i[0]){case 38:n.fg=this._updateAttrColor(n.fg,i[1],i[3],i[4],i[5]);break;case 48:n.bg=this._updateAttrColor(n.bg,i[1],i[3],i[4],i[5]);break;case 58:n.extended=n.extended.clone(),n.extended.underlineColor=this._updateAttrColor(n.extended.underlineColor,i[1],i[3],i[4],i[5])}return r}_processUnderline(e,t){t.extended=t.extended.clone(),(!~e||e>5)&&(e=1),t.extended.underlineStyle=e,t.fg|=268435456,e===0&&(t.fg&=-268435457),t.updateExtended()}_processSGR0(e){e.fg=Tn.fg,e.bg=Tn.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-67108864,e.updateExtended()}charAttributes(e){if(e.length===1&&e.params[0]===0)return this._processSGR0(this._curAttrData),!0;let t=e.length,n,i=this._curAttrData;for(let s=0;s<t;s++)n=e.params[s],n>=30&&n<=37?(i.fg&=-50331904,i.fg|=16777216|n-30):n>=40&&n<=47?(i.bg&=-50331904,i.bg|=16777216|n-40):n>=90&&n<=97?(i.fg&=-50331904,i.fg|=16777216|n-90|8):n>=100&&n<=107?(i.bg&=-50331904,i.bg|=16777216|n-100|8):n===0?this._processSGR0(i):n===1?i.fg|=134217728:n===3?i.bg|=67108864:n===4?(i.fg|=268435456,this._processUnderline(e.hasSubParams(s)?e.getSubParams(s)[0]:1,i)):n===5?i.fg|=536870912:n===7?i.fg|=67108864:n===8?i.fg|=1073741824:n===9?i.fg|=2147483648:n===2?i.bg|=134217728:n===21?this._processUnderline(2,i):n===22?(i.fg&=-134217729,i.bg&=-134217729):n===23?i.bg&=-67108865:n===24?(i.fg&=-268435457,this._processUnderline(0,i)):n===25?i.fg&=-536870913:n===27?i.fg&=-67108865:n===28?i.fg&=-1073741825:n===29?i.fg&=2147483647:n===39?(i.fg&=-67108864,i.fg|=Tn.fg&16777215):n===49?(i.bg&=-67108864,i.bg|=Tn.bg&16777215):n===38||n===48||n===58?s+=this._extractColor(e,s,i):n===53?i.bg|=1073741824:n===55?i.bg&=-1073741825:n===59?(i.extended=i.extended.clone(),i.extended.underlineColor=-1,i.updateExtended()):n===100?(i.fg&=-67108864,i.fg|=Tn.fg&16777215,i.bg&=-67108864,i.bg|=Tn.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",n);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${fe.ESC}[0n`);break;case 6:let t=this._activeBuffer.y+1,n=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${fe.ESC}[${t};${n}R`);break}return!0}deviceStatusPrivate(e){switch(e.params[0]){case 6:let t=this._activeBuffer.y+1,n=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${fe.ESC}[?${t};${n}R`);break}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=Tn.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){let t=e.length===0?1:e.params[0];if(t===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(t){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let n=t%2===1;this._coreService.decPrivateModes.cursorBlink=n}return!0}setScrollRegion(e){let t=e.params[0]||1,n;return(e.length<2||(n=e.params[1])>this._bufferService.rows||n===0)&&(n=this._bufferService.rows),n>t&&(this._activeBuffer.scrollTop=t-1,this._activeBuffer.scrollBottom=n-1,this._setCursor(0,0)),!0}windowOptions(e){if(!F2(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;let t=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:t!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${fe.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(t===0||t===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>B2&&this._windowTitleStack.shift()),(t===0||t===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>B2&&this._iconNameStack.shift());break;case 23:(t===0||t===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(t===0||t===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){let t=[],n=e.split(";");for(;n.length>1;){let i=n.shift(),s=n.shift();if(/^\d+$/.exec(i)){let r=parseInt(i);if($2(r))if(s==="?")t.push({type:0,index:r});else{let o=j2(s);o&&t.push({type:1,index:r,color:o})}}}return t.length&&this._onColor.fire(t),!0}setHyperlink(e){let t=e.indexOf(";");if(t===-1)return!0;let n=e.slice(0,t).trim(),i=e.slice(t+1);return i?this._createHyperlink(n,i):n.trim()?!1:this._finishHyperlink()}_createHyperlink(e,t){this._getCurrentLinkId()&&this._finishHyperlink();let n=e.split(":"),i,s=n.findIndex(r=>r.startsWith("id="));return s!==-1&&(i=n[s].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:i,uri:t}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,t){let n=e.split(";");for(let i=0;i<n.length&&!(t>=this._specialColors.length);++i,++t)if(n[i]==="?")this._onColor.fire([{type:0,index:this._specialColors[t]}]);else{let s=j2(n[i]);s&&this._onColor.fire([{type:1,index:this._specialColors[t],color:s}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;let t=[],n=e.split(";");for(let i=0;i<n.length;++i)if(/^\d+$/.exec(n[i])){let s=parseInt(n[i]);$2(s)&&t.push({type:2,index:s})}return t.length&&this._onColor.fire(t),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,Tl),!0}selectCharset(e){return e.length!==2?(this.selectDefaultCharset(),!0):(e[0]==="/"||this._charsetService.setgCharset(V_e[e[0]],jn[e[1]]||Tl),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=Tn.clone(),this._eraseAttrDataInternal=Tn.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){let e=new zs;e.content=1<<22|69,e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let t=0;t<this._bufferService.rows;++t){let n=this._activeBuffer.ybase+this._activeBuffer.y+t,i=this._activeBuffer.lines.get(n);i&&(i.fill(e),i.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,t){let n=o=>(this._coreService.triggerDataEvent(`${fe.ESC}${o}${fe.ESC}\\`),!0),i=this._bufferService.buffer,s=this._optionsService.rawOptions;return n(e==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:e==='"p'?'P1$r61;1"p':e==="r"?`P1$r${i.scrollTop+1};${i.scrollBottom+1}r`:e==="m"?"P1$r0m":e===" q"?`P1$r${{block:2,underline:4,bar:6}[s.cursorStyle]-(s.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(e,t){this._dirtyRowTracker.markRangeDirty(e,t)}},mC=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,t){e>t&&(z2=e,e=t,t=z2),e<this.start&&(this.start=e),t>this.end&&(this.end=t)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};mC=dn([Re(0,Ai)],mC);function $2(e){return 0<=e&&e<256}var G_e=5e7,q2=12,K_e=50,Y_e=class extends ct{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new we),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,t){if(t!==void 0&&this._syncCalls>t){this._syncCalls=0;return}if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let n;for(;n=this._writeBuffer.shift();){this._action(n);let i=this._callbacks.shift();i&&i()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(e,t){if(this._pendingData>G_e)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(t)}_innerWrite(e=0,t=!0){let n=e||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let i=this._writeBuffer[this._bufferOffset],s=this._action(i,t);if(s){let o=a=>performance.now()-n>=q2?setTimeout(()=>this._innerWrite(0,a)):this._innerWrite(n,a);s.catch(a=>(queueMicrotask(()=>{throw a}),Promise.resolve(!1))).then(o);return}let r=this._callbacks[this._bufferOffset];if(r&&r(),this._bufferOffset++,this._pendingData-=i.length,performance.now()-n>=q2)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>K_e&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},gC=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(e){let t=this._bufferService.buffer;if(e.id===void 0){let a=t.addMarker(t.ybase+t.y),c={data:e,id:this._nextId++,lines:[a]};return a.onDispose(()=>this._removeMarkerFromLink(c,a)),this._dataByLinkId.set(c.id,c),c.id}let n=e,i=this._getEntryIdKey(n),s=this._entriesWithId.get(i);if(s)return this.addLineToLink(s.id,t.ybase+t.y),s.id;let r=t.addMarker(t.ybase+t.y),o={id:this._nextId++,key:this._getEntryIdKey(n),data:n,lines:[r]};return r.onDispose(()=>this._removeMarkerFromLink(o,r)),this._entriesWithId.set(o.key,o),this._dataByLinkId.set(o.id,o),o.id}addLineToLink(e,t){let n=this._dataByLinkId.get(e);if(n&&n.lines.every(i=>i.line!==t)){let i=this._bufferService.buffer.addMarker(t);n.lines.push(i),i.onDispose(()=>this._removeMarkerFromLink(n,i))}}getLinkData(e){return this._dataByLinkId.get(e)?.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,t){let n=e.lines.indexOf(t);n!==-1&&(e.lines.splice(n,1),e.lines.length===0&&(e.data.id!==void 0&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};gC=dn([Re(0,Ai)],gC);var H2=!1,X_e=class extends ct{constructor(e){super(),this._windowsWrappingHeuristics=this._register(new Uu),this._onBinary=this._register(new we),this.onBinary=this._onBinary.event,this._onData=this._register(new we),this.onData=this._onData.event,this._onLineFeed=this._register(new we),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new we),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new we),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new we),this._instantiationService=new __e,this.optionsService=this._register(new A_e(e)),this._instantiationService.setService(Pi,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(dC)),this._instantiationService.setService(Ai,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(uC)),this._instantiationService.setService(S6,this._logService),this.coreService=this._register(this._instantiationService.createInstance(hC)),this._instantiationService.setService(oc,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(fC)),this._instantiationService.setService(_6,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(Il)),this._instantiationService.setService(gye,this.unicodeService),this._charsetService=this._instantiationService.createInstance(D_e),this._instantiationService.setService(mye,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(gC),this._instantiationService.setService(x6,this._oscLinkService),this._inputHandler=this._register(new W_e(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(si.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(si.forward(this._bufferService.onResize,this._onResize)),this._register(si.forward(this.coreService.onData,this._onData)),this._register(si.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new Y_e((t,n)=>this._inputHandler.parse(t,n))),this._register(si.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new we),this._onScroll.event(e=>{this._onScrollApi?.fire(e.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(let t in e)this.optionsService.options[t]=e[t]}write(e,t){this._writeBuffer.write(e,t)}writeSync(e,t){this._logService.logLevel<=3&&!H2&&(this._logService.warn("writeSync is unreliable and will be removed soon."),H2=!0),this._writeBuffer.writeSync(e,t)}input(e,t=!0){this.coreService.triggerDataEvent(e,t)}resize(e,t){isNaN(e)||isNaN(t)||(e=Math.max(e,eU),t=Math.max(t,tU),this._bufferService.resize(e,t))}scroll(e,t=!1){this._bufferService.scroll(e,t)}scrollLines(e,t){this._bufferService.scrollLines(e,t)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}registerEscHandler(e,t){return this._inputHandler.registerEscHandler(e,t)}registerDcsHandler(e,t){return this._inputHandler.registerDcsHandler(e,t)}registerCsiHandler(e,t){return this._inputHandler.registerCsiHandler(e,t)}registerOscHandler(e,t){return this._inputHandler.registerOscHandler(e,t)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let e=!1,t=this.optionsService.rawOptions.windowsPty;t&&t.buildNumber!==void 0&&t.buildNumber!==void 0?e=t.backend==="conpty"&&t.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let e=[];e.push(this.onLineFeed(D2.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},()=>(D2(this._bufferService),!1))),this._windowsWrappingHeuristics.value=Zt(()=>{for(let t of e)t.dispose()})}}},Q_e={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function J_e(e,t,n,i){let s={type:0,cancel:!1,key:void 0},r=(e.shiftKey?1:0)|(e.altKey?2:0)|(e.ctrlKey?4:0)|(e.metaKey?8:0);switch(e.keyCode){case 0:e.key==="UIKeyInputUpArrow"?t?s.key=fe.ESC+"OA":s.key=fe.ESC+"[A":e.key==="UIKeyInputLeftArrow"?t?s.key=fe.ESC+"OD":s.key=fe.ESC+"[D":e.key==="UIKeyInputRightArrow"?t?s.key=fe.ESC+"OC":s.key=fe.ESC+"[C":e.key==="UIKeyInputDownArrow"&&(t?s.key=fe.ESC+"OB":s.key=fe.ESC+"[B");break;case 8:s.key=e.ctrlKey?"\b":fe.DEL,e.altKey&&(s.key=fe.ESC+s.key);break;case 9:if(e.shiftKey){s.key=fe.ESC+"[Z";break}s.key=fe.HT,s.cancel=!0;break;case 13:s.key=e.altKey?fe.ESC+fe.CR:fe.CR,s.cancel=!0;break;case 27:s.key=fe.ESC,e.altKey&&(s.key=fe.ESC+fe.ESC),s.cancel=!0;break;case 37:if(e.metaKey)break;r?s.key=fe.ESC+"[1;"+(r+1)+"D":t?s.key=fe.ESC+"OD":s.key=fe.ESC+"[D";break;case 39:if(e.metaKey)break;r?s.key=fe.ESC+"[1;"+(r+1)+"C":t?s.key=fe.ESC+"OC":s.key=fe.ESC+"[C";break;case 38:if(e.metaKey)break;r?s.key=fe.ESC+"[1;"+(r+1)+"A":t?s.key=fe.ESC+"OA":s.key=fe.ESC+"[A";break;case 40:if(e.metaKey)break;r?s.key=fe.ESC+"[1;"+(r+1)+"B":t?s.key=fe.ESC+"OB":s.key=fe.ESC+"[B";break;case 45:!e.shiftKey&&!e.ctrlKey&&(s.key=fe.ESC+"[2~");break;case 46:r?s.key=fe.ESC+"[3;"+(r+1)+"~":s.key=fe.ESC+"[3~";break;case 36:r?s.key=fe.ESC+"[1;"+(r+1)+"H":t?s.key=fe.ESC+"OH":s.key=fe.ESC+"[H";break;case 35:r?s.key=fe.ESC+"[1;"+(r+1)+"F":t?s.key=fe.ESC+"OF":s.key=fe.ESC+"[F";break;case 33:e.shiftKey?s.type=2:e.ctrlKey?s.key=fe.ESC+"[5;"+(r+1)+"~":s.key=fe.ESC+"[5~";break;case 34:e.shiftKey?s.type=3:e.ctrlKey?s.key=fe.ESC+"[6;"+(r+1)+"~":s.key=fe.ESC+"[6~";break;case 112:r?s.key=fe.ESC+"[1;"+(r+1)+"P":s.key=fe.ESC+"OP";break;case 113:r?s.key=fe.ESC+"[1;"+(r+1)+"Q":s.key=fe.ESC+"OQ";break;case 114:r?s.key=fe.ESC+"[1;"+(r+1)+"R":s.key=fe.ESC+"OR";break;case 115:r?s.key=fe.ESC+"[1;"+(r+1)+"S":s.key=fe.ESC+"OS";break;case 116:r?s.key=fe.ESC+"[15;"+(r+1)+"~":s.key=fe.ESC+"[15~";break;case 117:r?s.key=fe.ESC+"[17;"+(r+1)+"~":s.key=fe.ESC+"[17~";break;case 118:r?s.key=fe.ESC+"[18;"+(r+1)+"~":s.key=fe.ESC+"[18~";break;case 119:r?s.key=fe.ESC+"[19;"+(r+1)+"~":s.key=fe.ESC+"[19~";break;case 120:r?s.key=fe.ESC+"[20;"+(r+1)+"~":s.key=fe.ESC+"[20~";break;case 121:r?s.key=fe.ESC+"[21;"+(r+1)+"~":s.key=fe.ESC+"[21~";break;case 122:r?s.key=fe.ESC+"[23;"+(r+1)+"~":s.key=fe.ESC+"[23~";break;case 123:r?s.key=fe.ESC+"[24;"+(r+1)+"~":s.key=fe.ESC+"[24~";break;default:if(e.ctrlKey&&!e.shiftKey&&!e.altKey&&!e.metaKey)e.keyCode>=65&&e.keyCode<=90?s.key=String.fromCharCode(e.keyCode-64):e.keyCode===32?s.key=fe.NUL:e.keyCode>=51&&e.keyCode<=55?s.key=String.fromCharCode(e.keyCode-51+27):e.keyCode===56?s.key=fe.DEL:e.keyCode===219?s.key=fe.ESC:e.keyCode===220?s.key=fe.FS:e.keyCode===221&&(s.key=fe.GS);else if((!n||i)&&e.altKey&&!e.metaKey){let o=Q_e[e.keyCode]?.[e.shiftKey?1:0];if(o)s.key=fe.ESC+o;else if(e.keyCode>=65&&e.keyCode<=90){let a=e.ctrlKey?e.keyCode-64:e.keyCode+32,c=String.fromCharCode(a);e.shiftKey&&(c=c.toUpperCase()),s.key=fe.ESC+c}else if(e.keyCode===32)s.key=fe.ESC+(e.ctrlKey?fe.NUL:" ");else if(e.key==="Dead"&&e.code.startsWith("Key")){let a=e.code.slice(3,4);e.shiftKey||(a=a.toLowerCase()),s.key=fe.ESC+a,s.cancel=!0}}else n&&!e.altKey&&!e.ctrlKey&&!e.shiftKey&&e.metaKey?e.keyCode===65&&(s.type=1):e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.keyCode>=48&&e.key.length===1?s.key=e.key:e.key&&e.ctrlKey&&(e.key==="_"&&(s.key=fe.US),e.key==="@"&&(s.key=fe.NUL));break}return s}var gn=0,Z_e=class{constructor(e){this._getKey=e,this._array=[],this._insertedValues=[],this._flushInsertedTask=new qv,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new qv,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert(e){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push(e)}_flushInserted(){let e=this._insertedValues.sort((s,r)=>this._getKey(s)-this._getKey(r)),t=0,n=0,i=new Array(this._array.length+this._insertedValues.length);for(let s=0;s<i.length;s++)n>=this._array.length||this._getKey(e[t])<=this._getKey(this._array[n])?(i[s]=e[t],t++):i[s]=this._array[n++];this._array=i,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete(e){if(this._flushCleanupInserted(),this._array.length===0)return!1;let t=this._getKey(e);if(t===void 0||(gn=this._search(t),gn===-1)||this._getKey(this._array[gn])!==t)return!1;do if(this._array[gn]===e)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(gn),!0;while(++gn<this._array.length&&this._getKey(this._array[gn])===t);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let e=this._deletedIndices.sort((s,r)=>s-r),t=0,n=new Array(this._array.length-e.length),i=0;for(let s=0;s<this._array.length;s++)e[t]===s?t++:n[i++]=this._array[s];this._array=n,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator(e){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(gn=this._search(e),!(gn<0||gn>=this._array.length)&&this._getKey(this._array[gn])===e))do yield this._array[gn];while(++gn<this._array.length&&this._getKey(this._array[gn])===e)}forEachByKey(e,t){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(gn=this._search(e),!(gn<0||gn>=this._array.length)&&this._getKey(this._array[gn])===e))do t(this._array[gn]);while(++gn<this._array.length&&this._getKey(this._array[gn])===e)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search(e){let t=0,n=this._array.length-1;for(;n>=t;){let i=t+n>>1,s=this._getKey(this._array[i]);if(s>e)n=i-1;else if(s<e)t=i+1;else{for(;i>0&&this._getKey(this._array[i-1])===e;)i--;return i}}return t}},ex=0,V2=0,e0e=class extends ct{constructor(){super(),this._decorations=new Z_e(e=>e?.marker.line),this._onDecorationRegistered=this._register(new we),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new we),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(Zt(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration(e){if(e.marker.isDisposed)return;let t=new t0e(e);if(t){let n=t.marker.onDispose(()=>t.dispose()),i=t.onDispose(()=>{i.dispose(),t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),n.dispose())});this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(let e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,n){let i=0,s=0;for(let r of this._decorations.getKeyIterator(t))i=r.options.x??0,s=i+(r.options.width??1),e>=i&&e<s&&(!n||(r.options.layer??"bottom")===n)&&(yield r)}forEachDecorationAtCell(e,t,n,i){this._decorations.forEachByKey(t,s=>{ex=s.options.x??0,V2=ex+(s.options.width??1),e>=ex&&e<V2&&(!n||(s.options.layer??"bottom")===n)&&i(s)})}},t0e=class extends Ba{constructor(e){super(),this.options=e,this.onRenderEmitter=this.add(new we),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new we),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=tn.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=tn.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},n0e=1e3,i0e=class{constructor(e,t=n0e){this._renderCallback=e,this._debounceThresholdMS=t,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,t,n){this._rowCount=n,e=e!==void 0?e:0,t=t!==void 0?t:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,e):e,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,t):t;let i=performance.now();if(i-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=i,this._innerRefresh();else if(!this._additionalRefreshRequested){let s=i-this._lastRefreshMs,r=this._debounceThresholdMS-s;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},r)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let e=Math.max(this._rowStart,0),t=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,t)}},W2=20,Hv=class extends ct{constructor(e,t,n,i){super(),this._terminal=e,this._coreBrowserService=n,this._renderService=i,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let s=this._coreBrowserService.mainDocument;this._accessibilityContainer=s.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=s.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let r=0;r<this._terminal.rows;r++)this._rowElements[r]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[r]);if(this._topBoundaryFocusListener=r=>this._handleBoundaryFocus(r,0),this._bottomBoundaryFocusListener=r=>this._handleBoundaryFocus(r,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=s.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new i0e(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize(r=>this._handleResize(r.rows))),this._register(this._terminal.onRender(r=>this._refreshRows(r.start,r.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar(r=>this._handleChar(r))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab(r=>this._handleTab(r))),this._register(this._terminal.onKey(r=>this._handleKey(r.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(Ve(s,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(Zt(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<W2+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===W2+1&&(this._liveRegion.textContent+=Ow.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){let n=this._terminal.buffer,i=n.lines.length.toString();for(let s=e;s<=t;s++){let r=n.lines.get(n.ydisp+s),o=[],a=r?.translateToString(!0,void 0,void 0,o)||"",c=(n.ydisp+s+1).toString(),u=this._rowElements[s];u&&(a.length===0?(u.textContent="",this._rowColumns.set(u,[0,1])):(u.textContent=a,this._rowColumns.set(u,o)),u.setAttribute("aria-posinset",c),u.setAttribute("aria-setsize",i),this._alignRowWidth(u))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){let n=e.target,i=this._rowElements[t===0?1:this._rowElements.length-2],s=n.getAttribute("aria-posinset"),r=t===0?"1":`${this._terminal.buffer.lines.length}`;if(s===r||e.relatedTarget!==i)return;let o,a;if(t===0?(o=n,a=this._rowElements.pop(),this._rowContainer.removeChild(a)):(o=this._rowElements.shift(),a=n,this._rowContainer.removeChild(o)),o.removeEventListener("focus",this._topBoundaryFocusListener),a.removeEventListener("focus",this._bottomBoundaryFocusListener),t===0){let c=this._createAccessibilityTreeNode();this._rowElements.unshift(c),this._rowContainer.insertAdjacentElement("afterbegin",c)}else{let c=this._createAccessibilityTreeNode();this._rowElements.push(c),this._rowContainer.appendChild(c)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(t===0?-1:1),this._rowElements[t===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;let e=this._coreBrowserService.mainDocument.getSelection();if(!e)return;if(e.isCollapsed){this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection();return}if(!e.anchorNode||!e.focusNode){console.error("anchorNode and/or focusNode are null");return}let t={node:e.anchorNode,offset:e.anchorOffset},n={node:e.focusNode,offset:e.focusOffset};if((t.node.compareDocumentPosition(n.node)&Node.DOCUMENT_POSITION_PRECEDING||t.node===n.node&&t.offset>n.offset)&&([t,n]=[n,t]),t.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(t={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(t.node))return;let i=this._rowElements.slice(-1)[0];if(n.node.compareDocumentPosition(i)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(n={node:i,offset:i.textContent?.length??0}),!this._rowContainer.contains(n.node))return;let s=({node:a,offset:c})=>{let u=a instanceof Text?a.parentNode:a,h=parseInt(u?.getAttribute("aria-posinset"),10)-1;if(isNaN(h))return console.warn("row is invalid. Race condition?"),null;let f=this._rowColumns.get(u);if(!f)return console.warn("columns is null. Race condition?"),null;let m=c<f.length?f[c]:f.slice(-1)[0]+1;return m>=this._terminal.cols&&(++h,m=0),{row:h,column:m}},r=s(t),o=s(n);if(!(!r||!o)){if(r.row>o.row||r.row===o.row&&r.column>=o.column)throw new Error("invalid range");this._terminal.select(r.column,r.row,(o.row-r.row)*this._terminal.cols-r.column+o.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let t=this._rowContainer.children.length;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e]),this._alignRowWidth(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth(e){e.style.transform="";let t=e.getBoundingClientRect().width,n=this._rowColumns.get(e)?.slice(-1)?.[0];if(!n)return;let i=n*this._renderService.dimensions.css.cell.width;e.style.transform=`scaleX(${i/t})`}};Hv=dn([Re(1,L1),Re(2,Uo),Re(3,zo)],Hv);var vC=class extends ct{constructor(e,t,n,i,s){super(),this._element=e,this._mouseService=t,this._renderService=n,this._bufferService=i,this._linkProviderService=s,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new we),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new we),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(Zt(()=>{Yl(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(Ve(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(Ve(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(Ve(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(Ve(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove(e){this._lastMouseEvent=e;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!t)return;this._isMouseOut=!1;let n=e.composedPath();for(let i=0;i<n.length;i++){let s=n[i];if(s.classList.contains("xterm"))break;if(s.classList.contains("xterm-hover"))return}(!this._lastBufferCell||t.x!==this._lastBufferCell.x||t.y!==this._lastBufferCell.y)&&(this._handleHover(t),this._lastBufferCell=t)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized){this._clearCurrentLink(),this._askForLink(e,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,t){(!this._activeProviderReplies||!t)&&(this._activeProviderReplies?.forEach(i=>{i?.forEach(s=>{s.link.dispose&&s.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let n=!1;for(let[i,s]of this._linkProviderService.linkProviders.entries())t?this._activeProviderReplies?.get(i)&&(n=this._checkLinkProviderResult(i,e,n)):s.provideLinks(e.y,r=>{if(this._isMouseOut)return;let o=r?.map(a=>({link:a}));this._activeProviderReplies?.set(i,o),n=this._checkLinkProviderResult(i,e,n),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,t){let n=new Set;for(let i=0;i<t.size;i++){let s=t.get(i);if(s)for(let r=0;r<s.length;r++){let o=s[r],a=o.link.range.start.y<e?0:o.link.range.start.x,c=o.link.range.end.y>e?this._bufferService.cols:o.link.range.end.x;for(let u=a;u<=c;u++){if(n.has(u)){s.splice(r--,1);break}n.add(u)}}}}_checkLinkProviderResult(e,t,n){if(!this._activeProviderReplies)return n;let i=this._activeProviderReplies.get(e),s=!1;for(let r=0;r<e;r++)(!this._activeProviderReplies.has(r)||this._activeProviderReplies.get(r))&&(s=!0);if(!s&&i){let r=i.find(o=>this._linkAtPosition(o.link,t));r&&(n=!0,this._handleNewLink(r))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!n)for(let r=0;r<this._activeProviderReplies.size;r++){let o=this._activeProviderReplies.get(r)?.find(a=>this._linkAtPosition(a.link,t));if(o){n=!0,this._handleNewLink(o);break}}return n}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._currentLink)return;let t=this._positionFromMouseEvent(e,this._element,this._mouseService);t&&this._mouseDownLink&&s0e(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,t)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,t){!this._currentLink||!this._lastMouseEvent||(!e||!t||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=t)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,Yl(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink(e){if(!this._lastMouseEvent)return;let t=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);t&&this._linkAtPosition(e.link,t)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0?!0:e.link.decorations.underline,pointerCursor:e.link.decorations===void 0?!0:e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:n=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==n&&(this._currentLink.state.decorations.pointerCursor=n,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",n))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:n=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==n&&(this._currentLink.state.decorations.underline=n,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,n))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(n=>{if(!this._currentLink)return;let i=n.start===0?0:n.start+1+this._bufferService.buffer.ydisp,s=this._bufferService.buffer.ydisp+1+n.end;if(this._currentLink.link.range.start.y>=i&&this._currentLink.link.range.end.y<=s&&(this._clearCurrentLink(i,s),this._lastMouseEvent)){let r=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);r&&this._askForLink(r,!1)}})))}_linkHover(e,t,n){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),t.hover&&t.hover(n,t.text)}_fireUnderlineEvent(e,t){let n=e.range,i=this._bufferService.buffer.ydisp,s=this._createLinkUnderlineEvent(n.start.x-1,n.start.y-i-1,n.end.x,n.end.y-i-1,void 0);(t?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(s)}_linkLeave(e,t,n){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(t,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),t.leave&&t.leave(n,t.text)}_linkAtPosition(e,t){let n=e.range.start.y*this._bufferService.cols+e.range.start.x,i=e.range.end.y*this._bufferService.cols+e.range.end.x,s=t.y*this._bufferService.cols+t.x;return n<=s&&s<=i}_positionFromMouseEvent(e,t,n){let i=n.getCoords(e,t,this._bufferService.cols,this._bufferService.rows);if(i)return{x:i[0],y:i[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,t,n,i,s){return{x1:e,y1:t,x2:n,y2:i,cols:this._bufferService.cols,fg:s}}};vC=dn([Re(1,N1),Re(2,zo),Re(3,Ai),Re(4,C6)],vC);function s0e(e,t){return e.text===t.text&&e.range.start.x===t.range.start.x&&e.range.start.y===t.range.start.y&&e.range.end.x===t.range.end.x&&e.range.end.y===t.range.end.y}var r0e=class extends X_e{constructor(e={}){super(e),this._linkifier=this._register(new Uu),this.browser=q6,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new Uu),this._onCursorMove=this._register(new we),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new we),this.onKey=this._onKey.event,this._onRender=this._register(new we),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new we),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new we),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new we),this.onBell=this._onBell.event,this._onFocus=this._register(new we),this._onBlur=this._register(new we),this._onA11yCharEmitter=this._register(new we),this._onA11yTabEmitter=this._register(new we),this._onWillOpen=this._register(new we),this._setup(),this._decorationService=this._instantiationService.createInstance(e0e),this._instantiationService.setService(Yf,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(Kbe),this._instantiationService.setService(C6,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(Bw)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows(t=>this.refresh(t?.start??0,t?.end??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport(t=>this._reportWindowsOptions(t))),this._register(this._inputHandler.onColor(t=>this._handleColorEvent(t))),this._register(si.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(si.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(si.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(si.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize(t=>this._afterResize(t.cols,t.rows))),this._register(Zt(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(e){if(this._themeService)for(let t of e){let n,i="";switch(t.index){case 256:n="foreground",i="10";break;case 257:n="background",i="11";break;case 258:n="cursor",i="12";break;default:n="ansi",i="4;"+t.index}switch(t.type){case 0:let s=Yt.toColorRGB(n==="ansi"?this._themeService.colors.ansi[t.index]:this._themeService.colors[n]);this.coreService.triggerDataEvent(`${fe.ESC}]${i};${H_e(s)}${z6.ST}`);break;case 1:if(n==="ansi")this._themeService.modifyColors(r=>r.ansi[t.index]=Rn.toColor(...t.color));else{let r=n;this._themeService.modifyColors(o=>o[r]=Rn.toColor(...t.color))}break;case 2:this._themeService.restoreColor(t.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(Hv,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(fe.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(fe.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let e=this.buffer.ybase+this.buffer.y,t=this.buffer.lines.get(e);if(!t)return;let n=Math.min(this.buffer.x,this.cols-1),i=this._renderService.dimensions.css.cell.height,s=t.getWidth(n),r=this._renderService.dimensions.css.cell.width*s,o=this.buffer.y*this._renderService.dimensions.css.cell.height,a=n*this._renderService.dimensions.css.cell.width;this.textarea.style.left=a+"px",this.textarea.style.top=o+"px",this.textarea.style.width=r+"px",this.textarea.style.height=i+"px",this.textarea.style.lineHeight=i+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(Ve(this.element,"copy",t=>{this.hasSelection()&&cye(t,this._selectionService)}));let e=t=>uye(t,this.textarea,this.coreService,this.optionsService);this._register(Ve(this.textarea,"paste",e)),this._register(Ve(this.element,"paste",e)),H6?this._register(Ve(this.element,"mousedown",t=>{t.button===2&&n2(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(Ve(this.element,"contextmenu",t=>{n2(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),z1&&this._register(Ve(this.element,"auxclick",t=>{t.button===1&&m6(t,this.textarea,this.screenElement)}))}_bindKeys(){this._register(Ve(this.textarea,"keyup",e=>this._keyUp(e),!0)),this._register(Ve(this.textarea,"keydown",e=>this._keyDown(e),!0)),this._register(Ve(this.textarea,"keypress",e=>this._keyPress(e),!0)),this._register(Ve(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(Ve(this.textarea,"compositionupdate",e=>this._compositionHelper.compositionupdate(e))),this._register(Ve(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(Ve(this.textarea,"input",e=>this._inputEvent(e),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(e){if(!e)throw new Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=e.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);let t=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),t.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(Ve(this.screenElement,"mousemove",s=>this.updateCursorStyle(s))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),t.appendChild(this.screenElement);let n=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",Dw.get()),G6||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>n.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(Wbe,this.textarea,e.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(Uo,this._coreBrowserService),this._register(Ve(this.textarea,"focus",s=>this._handleTextAreaFocus(s))),this._register(Ve(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(rC,this._document,this._helperContainer),this._instantiationService.setService(My,this._charSizeService),this._themeService=this._instantiationService.createInstance(cC),this._instantiationService.setService(td,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(zv),this._instantiationService.setService(w6,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(aC,this.rows,this.screenElement)),this._instantiationService.setService(zo,this._renderService),this._register(this._renderService.onRenderedViewportChange(s=>this._onRender.fire(s))),this.onResize(s=>this._renderService.resize(s.cols,s.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(nC,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(oC),this._instantiationService.setService(N1,this._mouseService);let i=this._linkifier.value=this._register(this._instantiationService.createInstance(vC,this.screenElement));this.element.appendChild(t);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(eC,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines(s=>{super.scrollLines(s,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(lC,this.element,this.screenElement,i)),this._instantiationService.setService(yye,this._selectionService),this._register(this._selectionService.onRequestScrollLines(s=>this.scrollLines(s.amount,s.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw(s=>this._renderService.handleSelectionChanged(s.start,s.end,s.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection(s=>{this.textarea.value=s,this.textarea.focus(),this.textarea.select()})),this._register(si.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{this._selectionService.refresh(),this._viewport?.queueSync()})),this._register(this._instantiationService.createInstance(tC,this.screenElement)),this._register(Ve(this.element,"mousedown",s=>this._selectionService.handleMouseDown(s))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(Hv,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",s=>this._handleScreenReaderModeOptionChange(s))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(Uv,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",s=>{!this._overviewRulerRenderer&&s&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(Uv,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(sC,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let e=this,t=this.element;function n(r){let o=e._mouseService.getMouseReportCoords(r,e.screenElement);if(!o)return!1;let a,c;switch(r.overrideType||r.type){case"mousemove":c=32,r.buttons===void 0?(a=3,r.button!==void 0&&(a=r.button<3?r.button:3)):a=r.buttons&1?0:r.buttons&4?1:r.buttons&2?2:3;break;case"mouseup":c=0,a=r.button<3?r.button:3;break;case"mousedown":c=1,a=r.button<3?r.button:3;break;case"wheel":if(e._customWheelEventHandler&&e._customWheelEventHandler(r)===!1)return!1;let u=r.deltaY;if(u===0||e.coreMouseService.consumeWheelEvent(r,e._renderService?.dimensions?.device?.cell?.height,e._coreBrowserService?.dpr)===0)return!1;c=u<0?0:1,a=4;break;default:return!1}return c===void 0||a===void 0||a>4?!1:e.coreMouseService.triggerMouseEvent({col:o.col,row:o.row,x:o.x,y:o.y,button:a,action:c,ctrl:r.ctrlKey,alt:r.altKey,shift:r.shiftKey})}let i={mouseup:null,wheel:null,mousedrag:null,mousemove:null},s={mouseup:r=>(n(r),r.buttons||(this._document.removeEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.removeEventListener("mousemove",i.mousedrag)),this.cancel(r)),wheel:r=>(n(r),this.cancel(r,!0)),mousedrag:r=>{r.buttons&&n(r)},mousemove:r=>{r.buttons||n(r)}};this._register(this.coreMouseService.onProtocolChange(r=>{r?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(r)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),r&8?i.mousemove||(t.addEventListener("mousemove",s.mousemove),i.mousemove=s.mousemove):(t.removeEventListener("mousemove",i.mousemove),i.mousemove=null),r&16?i.wheel||(t.addEventListener("wheel",s.wheel,{passive:!1}),i.wheel=s.wheel):(t.removeEventListener("wheel",i.wheel),i.wheel=null),r&2?i.mouseup||(i.mouseup=s.mouseup):(this._document.removeEventListener("mouseup",i.mouseup),i.mouseup=null),r&4?i.mousedrag||(i.mousedrag=s.mousedrag):(this._document.removeEventListener("mousemove",i.mousedrag),i.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(Ve(t,"mousedown",r=>{if(r.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(r)))return n(r),i.mouseup&&this._document.addEventListener("mouseup",i.mouseup),i.mousedrag&&this._document.addEventListener("mousemove",i.mousedrag),this.cancel(r)})),this._register(Ve(t,"wheel",r=>{if(!i.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(r)===!1)return!1;if(!this.buffer.hasScrollback){if(r.deltaY===0)return!1;if(e.coreMouseService.consumeWheelEvent(r,e._renderService?.dimensions?.device?.cell?.height,e._coreBrowserService?.dpr)===0)return this.cancel(r,!0);let o=fe.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(r.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(o,!0),this.cancel(r,!0)}}},{passive:!1}))}refresh(e,t){this._renderService?.refreshRows(e,t)}updateCursorStyle(e){this._selectionService?.shouldColumnSelect(e)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,t){this._viewport?this._viewport.scrollLines(e):super.scrollLines(e,t),this.refresh(0,this.rows-1)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){e&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let t=e-this._bufferService.buffer.ydisp;t!==0&&this.scrollLines(t)}paste(e){p6(e,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}attachCustomWheelEventHandler(e){this._customWheelEventHandler=e}registerLinkProvider(e){return this._linkProviderService.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");let t=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),t}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select(e,t,n){this._selectionService.setSelection(e,t,n)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(e,t){this._selectionService?.selectLines(e,t)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;let t=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!t&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!t&&(e.key==="Dead"||e.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let n=J_e(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),n.type===3||n.type===2){let i=this.rows-1;return this.scrollLines(n.type===2?-i:i),this.cancel(e,!0)}if(n.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,e)||(n.cancel&&this.cancel(e,!0),!n.key)||e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&e.key.length===1&&e.key.charCodeAt(0)>=65&&e.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((n.key===fe.ETX||n.key===fe.CR)&&(this.textarea.value=""),this._onKey.fire({key:n.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(n.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey)return this.cancel(e,!0);this._keyDownHandled=!0}_isThirdLevelShift(e,t){let n=e.isMac&&!this.options.macOptionIsMeta&&t.altKey&&!t.ctrlKey&&!t.metaKey||e.isWindows&&t.altKey&&t.ctrlKey&&!t.metaKey||e.isWindows&&t.getModifierState("AltGraph");return t.type==="keypress"?n:n&&(!t.keyCode||t.keyCode>47)}_keyUp(e){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)&&(o0e(e)||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let t;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(e)===!1)return!1;if(this.cancel(e),e.charCode)t=e.charCode;else if(e.which===null||e.which===void 0)t=e.keyCode;else if(e.which!==0&&e.charCode!==0)t=e.which;else return!1;return!t||(e.altKey||e.ctrlKey||e.metaKey)&&!this._isThirdLevelShift(this.browser,e)?!1:(t=String.fromCharCode(t),this._onKey.fire({key:t,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(t,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent(e){if(e.data&&e.inputType==="insertText"&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let t=e.data;return this.coreService.triggerDataEvent(t,!0),this.cancel(e),!0}return!1}resize(e,t){if(e===this.cols&&t===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize(e,t)}_afterResize(e,t){this._charSizeService?.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(Tn));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;let e=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this._customKeyEventHandler=e,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(fe.ESC+"[I"):this.coreService.triggerDataEvent(fe.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case 0:let t=this._renderService.dimensions.css.canvas.width.toFixed(0),n=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${fe.ESC}[4;${n};${t}t`);break;case 1:let i=this._renderService.dimensions.css.cell.width.toFixed(0),s=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${fe.ESC}[6;${s};${i}t`);break}}cancel(e,t){if(!(!this.options.cancelEvents&&!t))return e.preventDefault(),e.stopPropagation(),!1}};function o0e(e){return e.keyCode===16||e.keyCode===17||e.keyCode===18}var a0e=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,t){let n={instance:t,dispose:t.dispose,isDisposed:!1};this._addons.push(n),t.dispose=()=>this._wrappedAddonDispose(n),t.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let t=-1;for(let n=0;n<this._addons.length;n++)if(this._addons[n]===e){t=n;break}if(t===-1)throw new Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(t,1)}},l0e=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,t){if(!(e<0||e>=this._line.length))return t?(this._line.loadCell(e,t),t):this._line.loadCell(e,new zs)}translateToString(e,t,n){return this._line.translateToString(e,t,n)}},G2=class{constructor(e,t){this._buffer=e,this.type=t}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){let t=this._buffer.lines.get(e);if(t)return new l0e(t)}getNullCell(){return new zs}},c0e=class extends ct{constructor(e){super(),this._core=e,this._onBufferChange=this._register(new we),this.onBufferChange=this._onBufferChange.event,this._normal=new G2(this._core.buffers.normal,"normal"),this._alternate=new G2(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},u0e=class{constructor(e){this._core=e}registerCsiHandler(e,t){return this._core.registerCsiHandler(e,n=>t(n.toArray()))}addCsiHandler(e,t){return this.registerCsiHandler(e,t)}registerDcsHandler(e,t){return this._core.registerDcsHandler(e,(n,i)=>t(n,i.toArray()))}addDcsHandler(e,t){return this.registerDcsHandler(e,t)}registerEscHandler(e,t){return this._core.registerEscHandler(e,t)}addEscHandler(e,t){return this.registerEscHandler(e,t)}registerOscHandler(e,t){return this._core.registerOscHandler(e,t)}addOscHandler(e,t){return this.registerOscHandler(e,t)}},d0e=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}},h0e=["cols","rows"],wr=0,f0e=class extends ct{constructor(e){super(),this._core=this._register(new r0e(e)),this._addonManager=this._register(new a0e),this._publicOptions={...this._core.options};let t=i=>this._core.options[i],n=(i,s)=>{this._checkReadonlyOptions(i),this._core.options[i]=s};for(let i in this._core.options){let s={get:t.bind(this,i),set:n.bind(this,i)};Object.defineProperty(this._publicOptions,i,s)}}_checkReadonlyOptions(e){if(h0e.includes(e))throw new Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new u0e(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new d0e(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new c0e(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let e=this._core.coreService.decPrivateModes,t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any";break}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,synchronizedOutputMode:e.synchronizedOutput,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(let t in e)this._publicOptions[t]=e[t]}blur(){this._core.blur()}focus(){this._core.focus()}input(e,t=!0){this._core.input(e,t)}resize(e,t){this._verifyIntegers(e,t),this._core.resize(e,t)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}attachCustomWheelEventHandler(e){this._core.attachCustomWheelEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.registerMarker(e)}registerDecoration(e){return this._checkProposedApi(),this._verifyPositiveIntegers(e.x??0,e.width??0,e.height??0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,t,n){this._verifyIntegers(e,t,n),this._core.select(e,t,n)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,t){this._verifyIntegers(e,t),this._core.selectLines(e,t)}dispose(){super.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,t){this._core.write(e,t)}writeln(e,t){this._core.write(e),this._core.write(`\r
`,t)}paste(e){this._core.paste(e)}refresh(e,t){this._verifyIntegers(e,t),this._core.refresh(e,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){this._addonManager.loadAddon(this,e)}static get strings(){return{get promptLabel(){return Dw.get()},set promptLabel(e){Dw.set(e)},get tooMuchOutput(){return Ow.get()},set tooMuchOutput(e){Ow.set(e)}}}_verifyIntegers(...e){for(wr of e)if(wr===1/0||isNaN(wr)||wr%1!==0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(wr of e)if(wr&&(wr===1/0||isNaN(wr)||wr%1!==0||wr<0))throw new Error("This API only accepts positive integers")}};var p0e=2,m0e=1,g0e=class{activate(e){this._terminal=e}dispose(){}fit(){let e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;let t=this._terminal._core;(this._terminal.rows!==e.rows||this._terminal.cols!==e.cols)&&(t._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let e=this._terminal._core._renderService.dimensions;if(e.css.cell.width===0||e.css.cell.height===0)return;let t=this._terminal.options.scrollback===0?0:this._terminal.options.overviewRuler?.width||14,n=window.getComputedStyle(this._terminal.element.parentElement),i=parseInt(n.getPropertyValue("height")),s=Math.max(0,parseInt(n.getPropertyValue("width"))),r=window.getComputedStyle(this._terminal.element),o={top:parseInt(r.getPropertyValue("padding-top")),bottom:parseInt(r.getPropertyValue("padding-bottom")),right:parseInt(r.getPropertyValue("padding-right")),left:parseInt(r.getPropertyValue("padding-left"))},a=o.top+o.bottom,c=o.right+o.left,u=i-a,h=s-c-t;return{cols:Math.max(p0e,Math.floor(h/e.css.cell.width)),rows:Math.max(m0e,Math.floor(u/e.css.cell.height))}}};var v0e=class{constructor(e,t,n,i={}){this._terminal=e,this._regex=t,this._handler=n,this._options=i}provideLinks(e,t){let n=b0e.computeLink(e,this._regex,this._terminal,this._handler);t(this._addCallbacks(n))}_addCallbacks(e){return e.map(t=>(t.leave=this._options.leave,t.hover=(n,i)=>{if(this._options.hover){let{range:s}=t;this._options.hover(n,i,s)}},t))}};function y0e(e){try{let t=new URL(e),n=t.password&&t.username?`${t.protocol}//${t.username}:${t.password}@${t.host}`:t.username?`${t.protocol}//${t.username}@${t.host}`:`${t.protocol}//${t.host}`;return e.toLocaleLowerCase().startsWith(n.toLocaleLowerCase())}catch{return!1}}var b0e=class Fg{static computeLink(t,n,i,s){let r=new RegExp(n.source,(n.flags||"")+"g"),[o,a]=Fg._getWindowedLineStrings(t-1,i),c=o.join(""),u,h=[];for(;u=r.exec(c);){let f=u[0];if(!y0e(f))continue;let[m,y]=Fg._mapStrIdx(i,a,0,u.index),[b,S]=Fg._mapStrIdx(i,m,y,f.length);if(m===-1||y===-1||b===-1||S===-1)continue;let _={start:{x:y+1,y:m+1},end:{x:S,y:b+1}};h.push({range:_,text:f,activate:s})}return h}static _getWindowedLineStrings(t,n){let i,s=t,r=t,o=0,a="",c=[];if(i=n.buffer.active.getLine(t)){let u=i.translateToString(!0);if(i.isWrapped&&u[0]!==" "){for(o=0;(i=n.buffer.active.getLine(--s))&&o<2048&&(a=i.translateToString(!0),o+=a.length,c.push(a),!(!i.isWrapped||a.indexOf(" ")!==-1)););c.reverse()}for(c.push(u),o=0;(i=n.buffer.active.getLine(++r))&&i.isWrapped&&o<2048&&(a=i.translateToString(!0),o+=a.length,c.push(a),a.indexOf(" ")===-1););}return[c,s]}static _mapStrIdx(t,n,i,s){let r=t.buffer.active,o=r.getNullCell(),a=i;for(;s;){let c=r.getLine(n);if(!c)return[-1,-1];for(let u=a;u<c.length;++u){c.getCell(u,o);let h=o.getChars();if(o.getWidth()&&(s-=h.length||1,u===c.length-1&&h==="")){let f=r.getLine(n+1);f&&f.isWrapped&&(f.getCell(0,o),o.getWidth()===2&&(s+=1))}if(s<0)return[n,u]}n++,a=0}return[n,a]}},_0e=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function S0e(e,t){let n=window.open();if(n){try{n.opener=null}catch{}n.location.href=t}else console.warn("Opening link blocked as opener could not be cleared")}var x0e=class{constructor(e=S0e,t={}){this._handler=e,this._options=t}activate(e){this._terminal=e;let t=this._options,n=t.urlRegex||_0e;this._linkProvider=this._terminal.registerLinkProvider(new v0e(this._terminal,n,this._handler,t))}dispose(){this._linkProvider?.dispose()}},tx={exports:{}},K2;function w0e(){return K2||(K2=1,(function(e,t){(function(n,i){e.exports=i()})(self,(()=>(()=>{var n={903:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.BaseRenderLayer=void 0;const u=c(274),h=c(627),f=c(237),m=c(860),y=c(374),b=c(296),S=c(345),_=c(859),w=c(399),M=c(855);class R extends _.Disposable{get canvas(){return this._canvas}get cacheCanvas(){return this._charAtlas?.pages[0].canvas}constructor(T,L,P,I,N,O,j,$,V,H){super(),this._terminal=T,this._container=L,this._alpha=N,this._themeService=O,this._bufferService=j,this._optionsService=$,this._decorationService=V,this._coreBrowserService=H,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._selectionModel=(0,b.createSelectionRenderModel)(),this._bitmapGenerator=[],this._charAtlasDisposable=this.register(new _.MutableDisposable),this._onAddTextureAtlasCanvas=this.register(new S.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._cellColorResolver=new u.CellColorResolver(this._terminal,this._optionsService,this._selectionModel,this._decorationService,this._coreBrowserService,this._themeService),this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${P}-layer`),this._canvas.style.zIndex=I.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._refreshCharAtlas(this._themeService.colors),this.register(this._themeService.onChangeColors((B=>{this._refreshCharAtlas(B),this.reset(),this.handleSelectionChanged(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}))),this.register((0,_.toDisposable)((()=>{this._canvas.remove()})))}_initCanvas(){this._ctx=(0,y.throwIfFalsy)(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(){}handleFocus(){}handleCursorMove(){}handleGridChanged(T,L){}handleSelectionChanged(T,L,P=!1){this._selectionModel.update(this._terminal._core,T,L,P)}_setTransparency(T){if(T===this._alpha)return;const L=this._canvas;this._alpha=T,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,L),this._refreshCharAtlas(this._themeService.colors),this.handleGridChanged(0,this._bufferService.rows-1)}_refreshCharAtlas(T){if(!(this._deviceCharWidth<=0&&this._deviceCharHeight<=0)){this._charAtlas=(0,h.acquireTextureAtlas)(this._terminal,this._optionsService.rawOptions,T,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr),this._charAtlasDisposable.value=(0,S.forwardEvent)(this._charAtlas.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),this._charAtlas.warmUp();for(let L=0;L<this._charAtlas.pages.length;L++)this._bitmapGenerator[L]=new E(this._charAtlas.pages[L].canvas)}}resize(T){this._deviceCellWidth=T.device.cell.width,this._deviceCellHeight=T.device.cell.height,this._deviceCharWidth=T.device.char.width,this._deviceCharHeight=T.device.char.height,this._deviceCharLeft=T.device.char.left,this._deviceCharTop=T.device.char.top,this._canvas.width=T.device.canvas.width,this._canvas.height=T.device.canvas.height,this._canvas.style.width=`${T.css.canvas.width}px`,this._canvas.style.height=`${T.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(this._themeService.colors)}clearTextureAtlas(){this._charAtlas?.clearTexture()}_fillCells(T,L,P,I){this._ctx.fillRect(T*this._deviceCellWidth,L*this._deviceCellHeight,P*this._deviceCellWidth,I*this._deviceCellHeight)}_fillMiddleLineAtCells(T,L,P=1){const I=Math.ceil(.5*this._deviceCellHeight);this._ctx.fillRect(T*this._deviceCellWidth,(L+1)*this._deviceCellHeight-I-this._coreBrowserService.dpr,P*this._deviceCellWidth,this._coreBrowserService.dpr)}_fillBottomLineAtCells(T,L,P=1,I=0){this._ctx.fillRect(T*this._deviceCellWidth,(L+1)*this._deviceCellHeight+I-this._coreBrowserService.dpr-1,P*this._deviceCellWidth,this._coreBrowserService.dpr)}_curlyUnderlineAtCell(T,L,P=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;const I=this._coreBrowserService.dpr;this._ctx.lineWidth=I;for(let N=0;N<P;N++){const O=(T+N)*this._deviceCellWidth,j=(T+N+.5)*this._deviceCellWidth,$=(T+N+1)*this._deviceCellWidth,V=(L+1)*this._deviceCellHeight-I-1,H=V-I,B=V+I;this._ctx.moveTo(O,V),this._ctx.bezierCurveTo(O,H,j,H,j,V),this._ctx.bezierCurveTo(j,B,$,B,$,V)}this._ctx.stroke(),this._ctx.restore()}_dottedUnderlineAtCell(T,L,P=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;const I=this._coreBrowserService.dpr;this._ctx.lineWidth=I,this._ctx.setLineDash([2*I,I]);const N=T*this._deviceCellWidth,O=(L+1)*this._deviceCellHeight-I-1;this._ctx.moveTo(N,O);for(let j=0;j<P;j++){const $=(T+P+j)*this._deviceCellWidth;this._ctx.lineTo($,O)}this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore()}_dashedUnderlineAtCell(T,L,P=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;const I=this._coreBrowserService.dpr;this._ctx.lineWidth=I,this._ctx.setLineDash([4*I,3*I]);const N=T*this._deviceCellWidth,O=(T+P)*this._deviceCellWidth,j=(L+1)*this._deviceCellHeight-I-1;this._ctx.moveTo(N,j),this._ctx.lineTo(O,j),this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore()}_fillLeftLineAtCell(T,L,P){this._ctx.fillRect(T*this._deviceCellWidth,L*this._deviceCellHeight,this._coreBrowserService.dpr*P,this._deviceCellHeight)}_strokeRectAtCell(T,L,P,I){const N=this._coreBrowserService.dpr;this._ctx.lineWidth=N,this._ctx.strokeRect(T*this._deviceCellWidth+N/2,L*this._deviceCellHeight+N/2,P*this._deviceCellWidth-N,I*this._deviceCellHeight-N)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(T,L,P,I){this._alpha?this._ctx.clearRect(T*this._deviceCellWidth,L*this._deviceCellHeight,P*this._deviceCellWidth,I*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(T*this._deviceCellWidth,L*this._deviceCellHeight,P*this._deviceCellWidth,I*this._deviceCellHeight))}_fillCharTrueColor(T,L,P){this._ctx.font=this._getFont(!1,!1),this._ctx.textBaseline=f.TEXT_BASELINE,this._clipRow(P);let I=!1;this._optionsService.rawOptions.customGlyphs!==!1&&(I=(0,m.tryDrawCustomChar)(this._ctx,T.getChars(),L*this._deviceCellWidth,P*this._deviceCellHeight,this._deviceCellWidth,this._deviceCellHeight,this._optionsService.rawOptions.fontSize,this._coreBrowserService.dpr)),I||this._ctx.fillText(T.getChars(),L*this._deviceCellWidth+this._deviceCharLeft,P*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_drawChars(T,L,P){const I=T.getChars(),N=T.getCode(),O=T.getWidth();if(this._cellColorResolver.resolve(T,L,this._bufferService.buffer.ydisp+P,this._deviceCellWidth),!this._charAtlas)return;let j;if(j=I&&I.length>1?this._charAtlas.getRasterizedGlyphCombinedChar(I,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,!0):this._charAtlas.getRasterizedGlyph(T.getCode()||M.WHITESPACE_CELL_CODE,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,!0),!j.size.x||!j.size.y)return;this._ctx.save(),this._clipRow(P),this._bitmapGenerator[j.texturePage]&&this._charAtlas.pages[j.texturePage].canvas!==this._bitmapGenerator[j.texturePage].canvas&&(this._bitmapGenerator[j.texturePage]?.bitmap?.close(),delete this._bitmapGenerator[j.texturePage]),this._charAtlas.pages[j.texturePage].version!==this._bitmapGenerator[j.texturePage]?.version&&(this._bitmapGenerator[j.texturePage]||(this._bitmapGenerator[j.texturePage]=new E(this._charAtlas.pages[j.texturePage].canvas)),this._bitmapGenerator[j.texturePage].refresh(),this._bitmapGenerator[j.texturePage].version=this._charAtlas.pages[j.texturePage].version);let $=j.size.x;this._optionsService.rawOptions.rescaleOverlappingGlyphs&&(0,y.allowRescaling)(N,O,j.size.x,this._deviceCellWidth)&&($=this._deviceCellWidth-1),this._ctx.drawImage(this._bitmapGenerator[j.texturePage]?.bitmap||this._charAtlas.pages[j.texturePage].canvas,j.texturePosition.x,j.texturePosition.y,j.size.x,j.size.y,L*this._deviceCellWidth+this._deviceCharLeft-j.offset.x,P*this._deviceCellHeight+this._deviceCharTop-j.offset.y,$,j.size.y),this._ctx.restore()}_clipRow(T){this._ctx.beginPath(),this._ctx.rect(0,T*this._deviceCellHeight,this._bufferService.cols*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(T,L){return`${L?"italic":""} ${T?this._optionsService.rawOptions.fontWeightBold:this._optionsService.rawOptions.fontWeight} ${this._optionsService.rawOptions.fontSize*this._coreBrowserService.dpr}px ${this._optionsService.rawOptions.fontFamily}`}}a.BaseRenderLayer=R;class E{get bitmap(){return this._bitmap}constructor(T){this.canvas=T,this._state=0,this._commitTimeout=void 0,this._bitmap=void 0,this.version=-1}refresh(){this._bitmap?.close(),this._bitmap=void 0,w.isSafari||(this._commitTimeout===void 0&&(this._commitTimeout=window.setTimeout((()=>this._generate()),100)),this._state===1&&(this._state=2))}_generate(){this._state===0&&(this._bitmap?.close(),this._bitmap=void 0,this._state=1,window.createImageBitmap(this.canvas).then((T=>{this._state===2?this.refresh():this._bitmap=T,this._state=0})),this._commitTimeout&&(this._commitTimeout=void 0))}}},949:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.CanvasRenderer=void 0;const u=c(627),h=c(56),f=c(374),m=c(345),y=c(859),b=c(873),S=c(43),_=c(630),w=c(744);class M extends y.Disposable{constructor(E,A,T,L,P,I,N,O,j,$,V){super(),this._terminal=E,this._screenElement=A,this._bufferService=L,this._charSizeService=P,this._optionsService=I,this._coreBrowserService=j,this._themeService=V,this._observerDisposable=this.register(new y.MutableDisposable),this._onRequestRedraw=this.register(new m.EventEmitter),this.onRequestRedraw=this._onRequestRedraw.event,this._onChangeTextureAtlas=this.register(new m.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new m.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event;const H=this._optionsService.rawOptions.allowTransparency;this._renderLayers=[new w.TextRenderLayer(this._terminal,this._screenElement,0,H,this._bufferService,this._optionsService,N,$,this._coreBrowserService,V),new _.SelectionRenderLayer(this._terminal,this._screenElement,1,this._bufferService,this._coreBrowserService,$,this._optionsService,V),new S.LinkRenderLayer(this._terminal,this._screenElement,2,T,this._bufferService,this._optionsService,$,this._coreBrowserService,V),new b.CursorRenderLayer(this._terminal,this._screenElement,3,this._onRequestRedraw,this._bufferService,this._optionsService,O,this._coreBrowserService,$,V)];for(const B of this._renderLayers)(0,m.forwardEvent)(B.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas);this.dimensions=(0,f.createRenderDimensions)(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._observerDisposable.value=(0,h.observeDevicePixelDimensions)(this._renderLayers[0].canvas,this._coreBrowserService.window,((B,W)=>this._setCanvasDevicePixelDimensions(B,W))),this.register(this._coreBrowserService.onWindowChange((B=>{this._observerDisposable.value=(0,h.observeDevicePixelDimensions)(this._renderLayers[0].canvas,B,((W,q)=>this._setCanvasDevicePixelDimensions(W,q)))}))),this.register((0,y.toDisposable)((()=>{for(const B of this._renderLayers)B.dispose();(0,u.removeTerminalFromCache)(this._terminal)})))}get textureAtlas(){return this._renderLayers[0].cacheCanvas}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._bufferService.cols,this._bufferService.rows))}handleResize(E,A){this._updateDimensions();for(const T of this._renderLayers)T.resize(this.dimensions);this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}handleCharSizeChanged(){this.handleResize(this._bufferService.cols,this._bufferService.rows)}handleBlur(){this._runOperation((E=>E.handleBlur()))}handleFocus(){this._runOperation((E=>E.handleFocus()))}handleSelectionChanged(E,A,T=!1){this._runOperation((L=>L.handleSelectionChanged(E,A,T))),this._themeService.colors.selectionForeground&&this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})}handleCursorMove(){this._runOperation((E=>E.handleCursorMove()))}clear(){this._runOperation((E=>E.reset()))}_runOperation(E){for(const A of this._renderLayers)E(A)}renderRows(E,A){for(const T of this._renderLayers)T.handleGridChanged(E,A)}clearTextureAtlas(){for(const E of this._renderLayers)E.clearTextureAtlas()}_updateDimensions(){if(!this._charSizeService.hasValidSize)return;const E=this._coreBrowserService.dpr;this.dimensions.device.char.width=Math.floor(this._charSizeService.width*E),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*E),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._bufferService.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._bufferService.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/E),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/E),this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows,this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols}_setCanvasDevicePixelDimensions(E,A){this.dimensions.device.canvas.height=A,this.dimensions.device.canvas.width=E;for(const T of this._renderLayers)T.resize(this.dimensions);this._requestRedrawViewport()}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})}}a.CanvasRenderer=M},873:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.CursorRenderLayer=void 0;const u=c(457),h=c(859),f=c(399),m=c(782),y=c(903);class b extends y.BaseRenderLayer{constructor(_,w,M,R,E,A,T,L,P,I){super(_,w,"cursor",M,!0,I,E,A,P,L),this._onRequestRedraw=R,this._coreService=T,this._cursorBlinkStateManager=this.register(new h.MutableDisposable),this._cell=new m.CellData,this._state={x:0,y:0,isFocused:!1,style:"",width:0},this._cursorRenderers={bar:this._renderBarCursor.bind(this),block:this._renderBlockCursor.bind(this),underline:this._renderUnderlineCursor.bind(this),outline:this._renderOutlineCursor.bind(this)},this.register(A.onOptionChange((()=>this._handleOptionsChanged()))),this._handleOptionsChanged()}resize(_){super.resize(_),this._state={x:0,y:0,isFocused:!1,style:"",width:0}}reset(){this._clearCursor(),this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._handleOptionsChanged()}handleBlur(){this._cursorBlinkStateManager.value?.pause(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}handleFocus(){this._cursorBlinkStateManager.value?.resume(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}_handleOptionsChanged(){this._optionsService.rawOptions.cursorBlink?this._cursorBlinkStateManager.value||(this._cursorBlinkStateManager.value=new u.CursorBlinkStateManager((()=>this._render(!0)),this._coreBrowserService)):this._cursorBlinkStateManager.clear(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}handleCursorMove(){this._cursorBlinkStateManager.value?.restartBlinkAnimation()}handleGridChanged(_,w){!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isPaused?this._render(!1):this._cursorBlinkStateManager.value.restartBlinkAnimation()}_render(_){if(!this._coreService.isCursorInitialized||this._coreService.isCursorHidden)return void this._clearCursor();const w=this._bufferService.buffer.ybase+this._bufferService.buffer.y,M=w-this._bufferService.buffer.ydisp;if(M<0||M>=this._bufferService.rows)return void this._clearCursor();const R=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1);if(this._bufferService.buffer.lines.get(w).loadCell(R,this._cell),this._cell.content!==void 0){if(!this._coreBrowserService.isFocused){this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css;const E=this._optionsService.rawOptions.cursorStyle,A=this._optionsService.rawOptions.cursorInactiveStyle;return A&&A!=="none"&&this._cursorRenderers[A](R,M,this._cell),this._ctx.restore(),this._state.x=R,this._state.y=M,this._state.isFocused=!1,this._state.style=E,void(this._state.width=this._cell.getWidth())}if(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible){if(this._state){if(this._state.x===R&&this._state.y===M&&this._state.isFocused===this._coreBrowserService.isFocused&&this._state.style===this._optionsService.rawOptions.cursorStyle&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[this._optionsService.rawOptions.cursorStyle||"block"](R,M,this._cell),this._ctx.restore(),this._state.x=R,this._state.y=M,this._state.isFocused=!1,this._state.style=this._optionsService.rawOptions.cursorStyle,this._state.width=this._cell.getWidth()}else this._clearCursor()}}_clearCursor(){this._state&&(f.isFirefox||this._coreBrowserService.dpr<1?this._clearAll():this._clearCells(this._state.x,this._state.y,this._state.width,1),this._state={x:0,y:0,isFocused:!1,style:"",width:0})}_renderBarCursor(_,w,M){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillLeftLineAtCell(_,w,this._optionsService.rawOptions.cursorWidth),this._ctx.restore()}_renderBlockCursor(_,w,M){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillCells(_,w,M.getWidth(),1),this._ctx.fillStyle=this._themeService.colors.cursorAccent.css,this._fillCharTrueColor(M,_,w),this._ctx.restore()}_renderUnderlineCursor(_,w,M){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillBottomLineAtCells(_,w),this._ctx.restore()}_renderOutlineCursor(_,w,M){this._ctx.save(),this._ctx.strokeStyle=this._themeService.colors.cursor.css,this._strokeRectAtCell(_,w,M.getWidth(),1),this._ctx.restore()}}a.CursorRenderLayer=b},574:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.GridCache=void 0,a.GridCache=class{constructor(){this.cache=[]}resize(c,u){for(let h=0;h<c;h++){this.cache.length<=h&&this.cache.push([]);for(let f=this.cache[h].length;f<u;f++)this.cache[h].push(void 0);this.cache[h].length=u}this.cache.length=c}clear(){for(let c=0;c<this.cache.length;c++)for(let u=0;u<this.cache[c].length;u++)this.cache[c][u]=void 0}}},43:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.LinkRenderLayer=void 0;const u=c(197),h=c(237),f=c(903);class m extends f.BaseRenderLayer{constructor(b,S,_,w,M,R,E,A,T){super(b,S,"link",_,!0,T,M,R,E,A),this.register(w.onShowLinkUnderline((L=>this._handleShowLinkUnderline(L)))),this.register(w.onHideLinkUnderline((L=>this._handleHideLinkUnderline(L))))}resize(b){super.resize(b),this._state=void 0}reset(){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);const b=this._state.y2-this._state.y1-1;b>0&&this._clearCells(0,this._state.y1+1,this._state.cols,b),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(b){if(b.fg===h.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._themeService.colors.background.css:b.fg&&(0,u.is256Color)(b.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[b.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,b.y1===b.y2)this._fillBottomLineAtCells(b.x1,b.y1,b.x2-b.x1);else{this._fillBottomLineAtCells(b.x1,b.y1,b.cols-b.x1);for(let S=b.y1+1;S<b.y2;S++)this._fillBottomLineAtCells(0,S,b.cols);this._fillBottomLineAtCells(0,b.y2,b.x2)}this._state=b}_handleHideLinkUnderline(b){this._clearCurrentLink()}}a.LinkRenderLayer=m},630:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.SelectionRenderLayer=void 0;const u=c(903);class h extends u.BaseRenderLayer{constructor(m,y,b,S,_,w,M,R){super(m,y,"selection",b,!0,R,S,M,w,_),this._clearState()}_clearState(){this._state={start:void 0,end:void 0,columnSelectMode:void 0,ydisp:void 0}}resize(m){super.resize(m),this._selectionModel.selectionStart&&this._selectionModel.selectionEnd&&(this._clearState(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode))}reset(){this._state.start&&this._state.end&&(this._clearState(),this._clearAll())}handleBlur(){this.reset(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}handleFocus(){this.reset(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}handleSelectionChanged(m,y,b){super.handleSelectionChanged(m,y,b),this._redrawSelection(m,y,b)}_redrawSelection(m,y,b){if(!this._didStateChange(m,y,b,this._bufferService.buffer.ydisp))return;if(this._clearAll(),!m||!y)return void this._clearState();const S=m[1]-this._bufferService.buffer.ydisp,_=y[1]-this._bufferService.buffer.ydisp,w=Math.max(S,0),M=Math.min(_,this._bufferService.rows-1);if(w>=this._bufferService.rows||M<0)this._state.ydisp=this._bufferService.buffer.ydisp;else{if(this._ctx.fillStyle=(this._coreBrowserService.isFocused?this._themeService.colors.selectionBackgroundTransparent:this._themeService.colors.selectionInactiveBackgroundTransparent).css,b){const R=m[0],E=y[0]-R,A=M-w+1;this._fillCells(R,w,E,A)}else{const R=S===w?m[0]:0,E=w===_?y[0]:this._bufferService.cols;this._fillCells(R,w,E-R,1);const A=Math.max(M-w-1,0);if(this._fillCells(0,w+1,this._bufferService.cols,A),w!==M){const T=_===M?y[0]:this._bufferService.cols;this._fillCells(0,M,T,1)}}this._state.start=[m[0],m[1]],this._state.end=[y[0],y[1]],this._state.columnSelectMode=b,this._state.ydisp=this._bufferService.buffer.ydisp}}_didStateChange(m,y,b,S){return!this._areCoordinatesEqual(m,this._state.start)||!this._areCoordinatesEqual(y,this._state.end)||b!==this._state.columnSelectMode||S!==this._state.ydisp}_areCoordinatesEqual(m,y){return!(!m||!y)&&m[0]===y[0]&&m[1]===y[1]}}a.SelectionRenderLayer=h},744:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.TextRenderLayer=void 0;const u=c(577),h=c(147),f=c(782),m=c(855),y=c(903),b=c(574);class S extends y.BaseRenderLayer{constructor(w,M,R,E,A,T,L,P,I,N){super(w,M,"text",R,E,N,A,T,P,I),this._characterJoinerService=L,this._characterWidth=0,this._characterFont="",this._characterOverlapCache={},this._workCell=new f.CellData,this._state=new b.GridCache,this.register(T.onSpecificOptionChange("allowTransparency",(O=>this._setTransparency(O))))}resize(w){super.resize(w);const M=this._getFont(!1,!1);this._characterWidth===w.device.char.width&&this._characterFont===M||(this._characterWidth=w.device.char.width,this._characterFont=M,this._characterOverlapCache={}),this._state.clear(),this._state.resize(this._bufferService.cols,this._bufferService.rows)}reset(){this._state.clear(),this._clearAll()}_forEachCell(w,M,R){for(let E=w;E<=M;E++){const A=E+this._bufferService.buffer.ydisp,T=this._bufferService.buffer.lines.get(A),L=this._characterJoinerService.getJoinedCharacters(A);for(let P=0;P<this._bufferService.cols;P++){T.loadCell(P,this._workCell);let I=this._workCell,N=!1,O=P;if(I.getWidth()!==0){if(L.length>0&&P===L[0][0]){N=!0;const j=L.shift();I=new u.JoinedCellData(this._workCell,T.translateToString(!0,j[0],j[1]),j[1]-j[0]),O=j[1]-1}!N&&this._isOverlapping(I)&&O<T.length-1&&T.getCodePoint(O+1)===m.NULL_CELL_CODE&&(I.content&=-12582913,I.content|=8388608),R(I,P,E),P=O}}}}_drawBackground(w,M){const R=this._ctx,E=this._bufferService.cols;let A=0,T=0,L=null;R.save(),this._forEachCell(w,M,((P,I,N)=>{let O=null;P.isInverse()?O=P.isFgDefault()?this._themeService.colors.foreground.css:P.isFgRGB()?`rgb(${h.AttributeData.toColorRGB(P.getFgColor()).join(",")})`:this._themeService.colors.ansi[P.getFgColor()].css:P.isBgRGB()?O=`rgb(${h.AttributeData.toColorRGB(P.getBgColor()).join(",")})`:P.isBgPalette()&&(O=this._themeService.colors.ansi[P.getBgColor()].css);let j=!1;this._decorationService.forEachDecorationAtCell(I,this._bufferService.buffer.ydisp+N,void 0,($=>{$.options.layer!=="top"&&j||($.backgroundColorRGB&&(O=$.backgroundColorRGB.css),j=$.options.layer==="top")})),L===null&&(A=I,T=N),N!==T?(R.fillStyle=L||"",this._fillCells(A,T,E-A,1),A=I,T=N):L!==O&&(R.fillStyle=L||"",this._fillCells(A,T,I-A,1),A=I,T=N),L=O})),L!==null&&(R.fillStyle=L,this._fillCells(A,T,E-A,1)),R.restore()}_drawForeground(w,M){this._forEachCell(w,M,((R,E,A)=>this._drawChars(R,E,A)))}handleGridChanged(w,M){this._state.cache.length!==0&&(this._charAtlas&&this._charAtlas.beginFrame(),this._clearCells(0,w,this._bufferService.cols,M-w+1),this._drawBackground(w,M),this._drawForeground(w,M))}_isOverlapping(w){if(w.getWidth()!==1||w.getCode()<256)return!1;const M=w.getChars();if(this._characterOverlapCache.hasOwnProperty(M))return this._characterOverlapCache[M];this._ctx.save(),this._ctx.font=this._characterFont;const R=Math.floor(this._ctx.measureText(M).width)>this._characterWidth;return this._ctx.restore(),this._characterOverlapCache[M]=R,R}}a.TextRenderLayer=S},274:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.CellColorResolver=void 0;const u=c(855),h=c(160),f=c(374);let m,y=0,b=0,S=!1,_=!1,w=!1,M=0;a.CellColorResolver=class{constructor(R,E,A,T,L,P){this._terminal=R,this._optionService=E,this._selectionRenderModel=A,this._decorationService=T,this._coreBrowserService=L,this._themeService=P,this.result={fg:0,bg:0,ext:0}}resolve(R,E,A,T){if(this.result.bg=R.bg,this.result.fg=R.fg,this.result.ext=268435456&R.bg?R.extended.ext:0,b=0,y=0,_=!1,S=!1,w=!1,m=this._themeService.colors,M=0,R.getCode()!==u.NULL_CELL_CODE&&R.extended.underlineStyle===4){const L=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));M=E*T%(2*Math.round(L))}if(this._decorationService.forEachDecorationAtCell(E,A,"bottom",(L=>{L.backgroundColorRGB&&(b=L.backgroundColorRGB.rgba>>8&16777215,_=!0),L.foregroundColorRGB&&(y=L.foregroundColorRGB.rgba>>8&16777215,S=!0)})),w=this._selectionRenderModel.isCellSelected(this._terminal,E,A),w){if(67108864&this.result.fg||(50331648&this.result.bg)!=0){if(67108864&this.result.fg)switch(50331648&this.result.fg){case 16777216:case 33554432:b=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:b=(16777215&this.result.fg)<<8|255;break;default:b=this._themeService.colors.foreground.rgba}else switch(50331648&this.result.bg){case 16777216:case 33554432:b=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:b=(16777215&this.result.bg)<<8|255}b=h.rgba.blend(b,4294967040&(this._coreBrowserService.isFocused?m.selectionBackgroundOpaque:m.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}else b=(this._coreBrowserService.isFocused?m.selectionBackgroundOpaque:m.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(_=!0,m.selectionForeground&&(y=m.selectionForeground.rgba>>8&16777215,S=!0),(0,f.treatGlyphAsBackgroundColor)(R.getCode())){if(67108864&this.result.fg&&(50331648&this.result.bg)==0)y=(this._coreBrowserService.isFocused?m.selectionBackgroundOpaque:m.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(67108864&this.result.fg)switch(50331648&this.result.bg){case 16777216:case 33554432:y=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:y=(16777215&this.result.bg)<<8|255}else switch(50331648&this.result.fg){case 16777216:case 33554432:y=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:y=(16777215&this.result.fg)<<8|255;break;default:y=this._themeService.colors.foreground.rgba}y=h.rgba.blend(y,4294967040&(this._coreBrowserService.isFocused?m.selectionBackgroundOpaque:m.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}S=!0}}this._decorationService.forEachDecorationAtCell(E,A,"top",(L=>{L.backgroundColorRGB&&(b=L.backgroundColorRGB.rgba>>8&16777215,_=!0),L.foregroundColorRGB&&(y=L.foregroundColorRGB.rgba>>8&16777215,S=!0)})),_&&(b=w?-16777216&R.bg&-134217729|b|50331648:-16777216&R.bg|b|50331648),S&&(y=-16777216&R.fg&-67108865|y|50331648),67108864&this.result.fg&&(_&&!S&&(y=(50331648&this.result.bg)==0?-134217728&this.result.fg|16777215&m.background.rgba>>8|50331648:-134217728&this.result.fg|67108863&this.result.bg,S=!0),!_&&S&&(b=(50331648&this.result.fg)==0?-67108864&this.result.bg|16777215&m.foreground.rgba>>8|50331648:-67108864&this.result.bg|67108863&this.result.fg,_=!0)),m=void 0,this.result.bg=_?b:this.result.bg,this.result.fg=S?y:this.result.fg,this.result.ext&=536870911,this.result.ext|=M<<29&3758096384}}},627:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.removeTerminalFromCache=a.acquireTextureAtlas=void 0;const u=c(509),h=c(197),f=[];a.acquireTextureAtlas=function(m,y,b,S,_,w,M,R){const E=(0,h.generateConfig)(S,_,w,M,y,b,R);for(let L=0;L<f.length;L++){const P=f[L],I=P.ownedBy.indexOf(m);if(I>=0){if((0,h.configEquals)(P.config,E))return P.atlas;P.ownedBy.length===1?(P.atlas.dispose(),f.splice(L,1)):P.ownedBy.splice(I,1);break}}for(let L=0;L<f.length;L++){const P=f[L];if((0,h.configEquals)(P.config,E))return P.ownedBy.push(m),P.atlas}const A=m._core,T={atlas:new u.TextureAtlas(document,E,A.unicodeService),config:E,ownedBy:[m]};return f.push(T),T.atlas},a.removeTerminalFromCache=function(m){for(let y=0;y<f.length;y++){const b=f[y].ownedBy.indexOf(m);if(b!==-1){f[y].ownedBy.length===1?(f[y].atlas.dispose(),f.splice(y,1)):f[y].ownedBy.splice(b,1);break}}}},197:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.is256Color=a.configEquals=a.generateConfig=void 0;const u=c(160);a.generateConfig=function(h,f,m,y,b,S,_){const w={foreground:S.foreground,background:S.background,cursor:u.NULL_COLOR,cursorAccent:u.NULL_COLOR,selectionForeground:u.NULL_COLOR,selectionBackgroundTransparent:u.NULL_COLOR,selectionBackgroundOpaque:u.NULL_COLOR,selectionInactiveBackgroundTransparent:u.NULL_COLOR,selectionInactiveBackgroundOpaque:u.NULL_COLOR,ansi:S.ansi.slice(),contrastCache:S.contrastCache,halfContrastCache:S.halfContrastCache};return{customGlyphs:b.customGlyphs,devicePixelRatio:_,letterSpacing:b.letterSpacing,lineHeight:b.lineHeight,deviceCellWidth:h,deviceCellHeight:f,deviceCharWidth:m,deviceCharHeight:y,fontFamily:b.fontFamily,fontSize:b.fontSize,fontWeight:b.fontWeight,fontWeightBold:b.fontWeightBold,allowTransparency:b.allowTransparency,drawBoldTextInBrightColors:b.drawBoldTextInBrightColors,minimumContrastRatio:b.minimumContrastRatio,colors:w}},a.configEquals=function(h,f){for(let m=0;m<h.colors.ansi.length;m++)if(h.colors.ansi[m].rgba!==f.colors.ansi[m].rgba)return!1;return h.devicePixelRatio===f.devicePixelRatio&&h.customGlyphs===f.customGlyphs&&h.lineHeight===f.lineHeight&&h.letterSpacing===f.letterSpacing&&h.fontFamily===f.fontFamily&&h.fontSize===f.fontSize&&h.fontWeight===f.fontWeight&&h.fontWeightBold===f.fontWeightBold&&h.allowTransparency===f.allowTransparency&&h.deviceCharWidth===f.deviceCharWidth&&h.deviceCharHeight===f.deviceCharHeight&&h.drawBoldTextInBrightColors===f.drawBoldTextInBrightColors&&h.minimumContrastRatio===f.minimumContrastRatio&&h.colors.foreground.rgba===f.colors.foreground.rgba&&h.colors.background.rgba===f.colors.background.rgba},a.is256Color=function(h){return(50331648&h)==16777216||(50331648&h)==33554432}},237:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.TEXT_BASELINE=a.DIM_OPACITY=a.INVERTED_DEFAULT_COLOR=void 0;const u=c(399);a.INVERTED_DEFAULT_COLOR=257,a.DIM_OPACITY=.5,a.TEXT_BASELINE=u.isFirefox||u.isLegacyEdge?"bottom":"ideographic"},457:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.CursorBlinkStateManager=void 0,a.CursorBlinkStateManager=class{constructor(c,u){this._renderCallback=c,this._coreBrowserService=u,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._renderCallback(),this._animationFrame=void 0}))))}_restartInterval(c=600){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout((()=>{if(this._animationTimeRestarted){const u=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,u>0)return void this._restartInterval(u)}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._renderCallback(),this._animationFrame=void 0})),this._blinkInterval=this._coreBrowserService.window.setInterval((()=>{if(this._animationTimeRestarted){const u=600-(Date.now()-this._animationTimeRestarted);return this._animationTimeRestarted=void 0,void this._restartInterval(u)}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._renderCallback(),this._animationFrame=void 0}))}),600)}),c)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}}},860:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.tryDrawCustomChar=a.powerlineDefinitions=a.boxDrawingDefinitions=a.blockElementDefinitions=void 0;const u=c(374);a.blockElementDefinitions={"":[{x:0,y:0,w:8,h:4}],"":[{x:0,y:7,w:8,h:1}],"":[{x:0,y:6,w:8,h:2}],"":[{x:0,y:5,w:8,h:3}],"":[{x:0,y:4,w:8,h:4}],"":[{x:0,y:3,w:8,h:5}],"":[{x:0,y:2,w:8,h:6}],"":[{x:0,y:1,w:8,h:7}],"":[{x:0,y:0,w:8,h:8}],"":[{x:0,y:0,w:7,h:8}],"":[{x:0,y:0,w:6,h:8}],"":[{x:0,y:0,w:5,h:8}],"":[{x:0,y:0,w:4,h:8}],"":[{x:0,y:0,w:3,h:8}],"":[{x:0,y:0,w:2,h:8}],"":[{x:0,y:0,w:1,h:8}],"":[{x:4,y:0,w:4,h:8}],"":[{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8}],"":[{x:0,y:4,w:4,h:4}],"":[{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"":[{x:4,y:0,w:4,h:4}],"":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:1,y:0,w:1,h:8}],"":[{x:2,y:0,w:1,h:8}],"":[{x:3,y:0,w:1,h:8}],"":[{x:4,y:0,w:1,h:8}],"":[{x:5,y:0,w:1,h:8}],"":[{x:6,y:0,w:1,h:8}],"":[{x:0,y:1,w:8,h:1}],"":[{x:0,y:2,w:8,h:1}],"":[{x:0,y:3,w:8,h:1}],"":[{x:0,y:4,w:8,h:1}],"":[{x:0,y:5,w:8,h:1}],"":[{x:0,y:6,w:8,h:1}],"":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:2}],"":[{x:0,y:0,w:8,h:3}],"":[{x:0,y:0,w:8,h:5}],"":[{x:0,y:0,w:8,h:6}],"":[{x:0,y:0,w:8,h:7}],"":[{x:6,y:0,w:2,h:8}],"":[{x:5,y:0,w:3,h:8}],"":[{x:3,y:0,w:5,h:8}],"":[{x:2,y:0,w:6,h:8}],"":[{x:1,y:0,w:7,h:8}],"":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};const h={"":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"":[[1,0],[0,0],[0,1],[0,0]],"":[[0,1],[1,1],[1,0],[1,1]]};a.boxDrawingDefinitions={"":{1:"M0,.5 L1,.5"},"":{3:"M0,.5 L1,.5"},"":{1:"M.5,0 L.5,1"},"":{3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5"},"":{3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M0,.5 L.5,.5 L.5,1"},"":{3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L1,.5"},"":{3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L0,.5"},"":{3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{1:"M.5,.5 L0,.5"},"":{3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0"},"":{3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5"},"":{3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1"},"":{3:"M.5,.5 L.5,1"},"":{1:(S,_)=>`M0,${.5-_} L1,${.5-_} M0,${.5+_} L1,${.5+_}`},"":{1:(S,_)=>`M${.5-S},0 L${.5-S},1 M${.5+S},0 L${.5+S},1`},"":{1:(S,_)=>`M.5,1 L.5,${.5-_} L1,${.5-_} M.5,${.5+_} L1,${.5+_}`},"":{1:(S,_)=>`M${.5-S},1 L${.5-S},.5 L1,.5 M${.5+S},.5 L${.5+S},1`},"":{1:(S,_)=>`M1,${.5-_} L${.5-S},${.5-_} L${.5-S},1 M1,${.5+_} L${.5+S},${.5+_} L${.5+S},1`},"":{1:(S,_)=>`M0,${.5-_} L.5,${.5-_} L.5,1 M0,${.5+_} L.5,${.5+_}`},"":{1:(S,_)=>`M${.5+S},1 L${.5+S},.5 L0,.5 M${.5-S},.5 L${.5-S},1`},"":{1:(S,_)=>`M0,${.5+_} L${.5-S},${.5+_} L${.5-S},1 M0,${.5-_} L${.5+S},${.5-_} L${.5+S},1`},"":{1:(S,_)=>`M.5,0 L.5,${.5+_} L1,${.5+_} M.5,${.5-_} L1,${.5-_}`},"":{1:(S,_)=>`M1,.5 L${.5-S},.5 L${.5-S},0 M${.5+S},.5 L${.5+S},0`},"":{1:(S,_)=>`M1,${.5-_} L${.5+S},${.5-_} L${.5+S},0 M1,${.5+_} L${.5-S},${.5+_} L${.5-S},0`},"":{1:(S,_)=>`M0,${.5+_} L.5,${.5+_} L.5,0 M0,${.5-_} L.5,${.5-_}`},"":{1:(S,_)=>`M0,.5 L${.5+S},.5 L${.5+S},0 M${.5-S},.5 L${.5-S},0`},"":{1:(S,_)=>`M0,${.5-_} L${.5-S},${.5-_} L${.5-S},0 M0,${.5+_} L${.5+S},${.5+_} L${.5+S},0`},"":{1:(S,_)=>`M.5,0 L.5,1 M.5,${.5-_} L1,${.5-_} M.5,${.5+_} L1,${.5+_}`},"":{1:(S,_)=>`M${.5-S},0 L${.5-S},1 M${.5+S},0 L${.5+S},1 M${.5+S},.5 L1,.5`},"":{1:(S,_)=>`M${.5-S},0 L${.5-S},1 M1,${.5+_} L${.5+S},${.5+_} L${.5+S},1 M1,${.5-_} L${.5+S},${.5-_} L${.5+S},0`},"":{1:(S,_)=>`M.5,0 L.5,1 M0,${.5-_} L.5,${.5-_} M0,${.5+_} L.5,${.5+_}`},"":{1:(S,_)=>`M0,.5 L${.5-S},.5 M${.5-S},0 L${.5-S},1 M${.5+S},0 L${.5+S},1`},"":{1:(S,_)=>`M${.5+S},0 L${.5+S},1 M0,${.5+_} L${.5-S},${.5+_} L${.5-S},1 M0,${.5-_} L${.5-S},${.5-_} L${.5-S},0`},"":{1:(S,_)=>`M0,${.5-_} L1,${.5-_} M0,${.5+_} L1,${.5+_} M.5,${.5+_} L.5,1`},"":{1:(S,_)=>`M0,.5 L1,.5 M${.5-S},.5 L${.5-S},1 M${.5+S},.5 L${.5+S},1`},"":{1:(S,_)=>`M0,${.5-_} L1,${.5-_} M0,${.5+_} L${.5-S},${.5+_} L${.5-S},1 M1,${.5+_} L${.5+S},${.5+_} L${.5+S},1`},"":{1:(S,_)=>`M.5,0 L.5,${.5-_} M0,${.5-_} L1,${.5-_} M0,${.5+_} L1,${.5+_}`},"":{1:(S,_)=>`M0,.5 L1,.5 M${.5-S},.5 L${.5-S},0 M${.5+S},.5 L${.5+S},0`},"":{1:(S,_)=>`M0,${.5+_} L1,${.5+_} M0,${.5-_} L${.5-S},${.5-_} L${.5-S},0 M1,${.5-_} L${.5+S},${.5-_} L${.5+S},0`},"":{1:(S,_)=>`M.5,0 L.5,1 M0,${.5-_} L1,${.5-_} M0,${.5+_} L1,${.5+_}`},"":{1:(S,_)=>`M0,.5 L1,.5 M${.5-S},0 L${.5-S},1 M${.5+S},0 L${.5+S},1`},"":{1:(S,_)=>`M0,${.5+_} L${.5-S},${.5+_} L${.5-S},1 M1,${.5+_} L${.5+S},${.5+_} L${.5+S},1 M0,${.5-_} L${.5-S},${.5-_} L${.5-S},0 M1,${.5-_} L${.5+S},${.5-_} L${.5+S},0`},"":{1:"M1,0 L0,1"},"":{1:"M0,0 L1,1"},"":{1:"M1,0 L0,1 M0,0 L1,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{1:(S,_)=>`M.5,1 L.5,${.5+_/.15*.5} C.5,${.5+_/.15*.5},.5,.5,1,.5`},"":{1:(S,_)=>`M.5,1 L.5,${.5+_/.15*.5} C.5,${.5+_/.15*.5},.5,.5,0,.5`},"":{1:(S,_)=>`M.5,0 L.5,${.5-_/.15*.5} C.5,${.5-_/.15*.5},.5,.5,0,.5`},"":{1:(S,_)=>`M.5,0 L.5,${.5-_/.15*.5} C.5,${.5-_/.15*.5},.5,.5,1,.5`}},a.powerlineDefinitions={"":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}},a.powerlineDefinitions[""]=a.powerlineDefinitions[""],a.powerlineDefinitions[""]=a.powerlineDefinitions[""],a.tryDrawCustomChar=function(S,_,w,M,R,E,A,T){const L=a.blockElementDefinitions[_];if(L)return(function(O,j,$,V,H,B){for(let W=0;W<j.length;W++){const q=j[W],ne=H/8,z=B/8;O.fillRect($+q.x*ne,V+q.y*z,q.w*ne,q.h*z)}})(S,L,w,M,R,E),!0;const P=h[_];if(P)return(function(O,j,$,V,H,B){let W=f.get(j);W||(W=new Map,f.set(j,W));const q=O.fillStyle;if(typeof q!="string")throw new Error(`Unexpected fillStyle type "${q}"`);let ne=W.get(q);if(!ne){const z=j[0].length,G=j.length,J=O.canvas.ownerDocument.createElement("canvas");J.width=z,J.height=G;const U=(0,u.throwIfFalsy)(J.getContext("2d")),re=new ImageData(z,G);let de,ce,ae,be;if(q.startsWith("#"))de=parseInt(q.slice(1,3),16),ce=parseInt(q.slice(3,5),16),ae=parseInt(q.slice(5,7),16),be=q.length>7&&parseInt(q.slice(7,9),16)||1;else{if(!q.startsWith("rgba"))throw new Error(`Unexpected fillStyle color format "${q}" when drawing pattern glyph`);[de,ce,ae,be]=q.substring(5,q.length-1).split(",").map((Ce=>parseFloat(Ce)))}for(let Ce=0;Ce<G;Ce++)for(let qe=0;qe<z;qe++)re.data[4*(Ce*z+qe)]=de,re.data[4*(Ce*z+qe)+1]=ce,re.data[4*(Ce*z+qe)+2]=ae,re.data[4*(Ce*z+qe)+3]=j[Ce][qe]*(255*be);U.putImageData(re,0,0),ne=(0,u.throwIfFalsy)(O.createPattern(J,null)),W.set(q,ne)}O.fillStyle=ne,O.fillRect($,V,H,B)})(S,P,w,M,R,E),!0;const I=a.boxDrawingDefinitions[_];if(I)return(function(O,j,$,V,H,B,W){O.strokeStyle=O.fillStyle;for(const[q,ne]of Object.entries(j)){let z;O.beginPath(),O.lineWidth=W*Number.parseInt(q),z=typeof ne=="function"?ne(.15,.15/B*H):ne;for(const G of z.split(" ")){const J=G[0],U=y[J];if(!U){console.error(`Could not find drawing instructions for "${J}"`);continue}const re=G.substring(1).split(",");re[0]&&re[1]&&U(O,b(re,H,B,$,V,!0,W))}O.stroke(),O.closePath()}})(S,I,w,M,R,E,T),!0;const N=a.powerlineDefinitions[_];return!!N&&((function(O,j,$,V,H,B,W,q){const ne=new Path2D;ne.rect($,V,H,B),O.clip(ne),O.beginPath();const z=W/12;O.lineWidth=q*z;for(const G of j.d.split(" ")){const J=G[0],U=y[J];if(!U){console.error(`Could not find drawing instructions for "${J}"`);continue}const re=G.substring(1).split(",");re[0]&&re[1]&&U(O,b(re,H,B,$,V,!1,q,(j.leftPadding??0)*(z/2),(j.rightPadding??0)*(z/2)))}j.type===1?(O.strokeStyle=O.fillStyle,O.stroke()):O.fill(),O.closePath()})(S,N,w,M,R,E,A,T),!0)};const f=new Map;function m(S,_,w=0){return Math.max(Math.min(S,_),w)}const y={C:(S,_)=>S.bezierCurveTo(_[0],_[1],_[2],_[3],_[4],_[5]),L:(S,_)=>S.lineTo(_[0],_[1]),M:(S,_)=>S.moveTo(_[0],_[1])};function b(S,_,w,M,R,E,A,T=0,L=0){const P=S.map((I=>parseFloat(I)||parseInt(I)));if(P.length<2)throw new Error("Too few arguments for instruction");for(let I=0;I<P.length;I+=2)P[I]*=_-T*A-L*A,E&&P[I]!==0&&(P[I]=m(Math.round(P[I]+.5)-.5,_,0)),P[I]+=M+T*A;for(let I=1;I<P.length;I+=2)P[I]*=w,E&&P[I]!==0&&(P[I]=m(Math.round(P[I]+.5)-.5,w,0)),P[I]+=R;return P}},56:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.observeDevicePixelDimensions=void 0;const u=c(859);a.observeDevicePixelDimensions=function(h,f,m){let y=new f.ResizeObserver((b=>{const S=b.find((M=>M.target===h));if(!S)return;if(!("devicePixelContentBoxSize"in S))return y?.disconnect(),void(y=void 0);const _=S.devicePixelContentBoxSize[0].inlineSize,w=S.devicePixelContentBoxSize[0].blockSize;_>0&&w>0&&m(_,w)}));try{y.observe(h,{box:["device-pixel-content-box"]})}catch{y.disconnect(),y=void 0}return(0,u.toDisposable)((()=>y?.disconnect()))}},374:(o,a)=>{function c(h){return 57508<=h&&h<=57558}function u(h){return h>=128512&&h<=128591||h>=127744&&h<=128511||h>=128640&&h<=128767||h>=9728&&h<=9983||h>=9984&&h<=10175||h>=65024&&h<=65039||h>=129280&&h<=129535||h>=127462&&h<=127487}Object.defineProperty(a,"__esModule",{value:!0}),a.computeNextVariantOffset=a.createRenderDimensions=a.treatGlyphAsBackgroundColor=a.allowRescaling=a.isEmoji=a.isRestrictedPowerlineGlyph=a.isPowerlineGlyph=a.throwIfFalsy=void 0,a.throwIfFalsy=function(h){if(!h)throw new Error("value must not be falsy");return h},a.isPowerlineGlyph=c,a.isRestrictedPowerlineGlyph=function(h){return 57520<=h&&h<=57527},a.isEmoji=u,a.allowRescaling=function(h,f,m,y){return f===1&&m>Math.ceil(1.5*y)&&h!==void 0&&h>255&&!u(h)&&!c(h)&&!(function(b){return 57344<=b&&b<=63743})(h)},a.treatGlyphAsBackgroundColor=function(h){return c(h)||(function(f){return 9472<=f&&f<=9631})(h)},a.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},a.computeNextVariantOffset=function(h,f,m=0){return(h-(2*Math.round(f)-m))%(2*Math.round(f))}},296:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createSelectionRenderModel=void 0;class c{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(h,f,m,y=!1){if(this.selectionStart=f,this.selectionEnd=m,!f||!m||f[0]===m[0]&&f[1]===m[1])return void this.clear();const b=h.buffers.active.ydisp,S=f[1]-b,_=m[1]-b,w=Math.max(S,0),M=Math.min(_,h.rows-1);w>=h.rows||M<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=y,this.viewportStartRow=S,this.viewportEndRow=_,this.viewportCappedStartRow=w,this.viewportCappedEndRow=M,this.startCol=f[0],this.endCol=m[0])}isCellSelected(h,f,m){return!!this.hasSelection&&(m-=h.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?f>=this.startCol&&m>=this.viewportCappedStartRow&&f<this.endCol&&m<=this.viewportCappedEndRow:f<this.startCol&&m>=this.viewportCappedStartRow&&f>=this.endCol&&m<=this.viewportCappedEndRow:m>this.viewportStartRow&&m<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&m===this.viewportStartRow&&f>=this.startCol&&f<this.endCol||this.viewportStartRow<this.viewportEndRow&&m===this.viewportEndRow&&f<this.endCol||this.viewportStartRow<this.viewportEndRow&&m===this.viewportStartRow&&f>=this.startCol)}}a.createSelectionRenderModel=function(){return new c}},509:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.TextureAtlas=void 0;const u=c(237),h=c(860),f=c(374),m=c(160),y=c(345),b=c(485),S=c(385),_=c(147),w=c(855),M={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}};let R;class E{get pages(){return this._pages}constructor(I,N,O){this._document=I,this._config=N,this._unicodeService=O,this._didWarmUp=!1,this._cacheMap=new b.FourKeyMap,this._cacheMapCombined=new b.FourKeyMap,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new _.AttributeData,this._textureSize=512,this._onAddTextureAtlasCanvas=new y.EventEmitter,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new y.EventEmitter,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=L(I,4*this._config.deviceCellWidth+4,this._config.deviceCellHeight+4),this._tmpCtx=(0,f.throwIfFalsy)(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}dispose(){for(const I of this.pages)I.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){const I=new S.IdleTaskQueue;for(let N=33;N<126;N++)I.enqueue((()=>{if(!this._cacheMap.get(N,w.DEFAULT_COLOR,w.DEFAULT_COLOR,w.DEFAULT_EXT)){const O=this._drawToCache(N,w.DEFAULT_COLOR,w.DEFAULT_COLOR,w.DEFAULT_EXT);this._cacheMap.set(N,w.DEFAULT_COLOR,w.DEFAULT_COLOR,w.DEFAULT_EXT,O)}}))}beginFrame(){return this._requestClearModel}clearTexture(){if(this._pages[0].currentRow.x!==0||this._pages[0].currentRow.y!==0){for(const I of this._pages)I.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(E.maxAtlasPages&&this._pages.length>=Math.max(4,E.maxAtlasPages)){const N=this._pages.filter((W=>2*W.canvas.width<=(E.maxTextureSize||4096))).sort(((W,q)=>q.canvas.width!==W.canvas.width?q.canvas.width-W.canvas.width:q.percentageUsed-W.percentageUsed));let O=-1,j=0;for(let W=0;W<N.length;W++)if(N[W].canvas.width!==j)O=W,j=N[W].canvas.width;else if(W-O==3)break;const $=N.slice(O,O+4),V=$.map((W=>W.glyphs[0].texturePage)).sort(((W,q)=>W>q?1:-1)),H=this.pages.length-$.length,B=this._mergePages($,H);B.version++;for(let W=V.length-1;W>=0;W--)this._deletePage(V[W]);this.pages.push(B),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(B.canvas)}const I=new A(this._document,this._textureSize);return this._pages.push(I),this._activePages.push(I),this._onAddTextureAtlasCanvas.fire(I.canvas),I}_mergePages(I,N){const O=2*I[0].canvas.width,j=new A(this._document,O,I);for(const[$,V]of I.entries()){const H=$*V.canvas.width%O,B=Math.floor($/2)*V.canvas.height;j.ctx.drawImage(V.canvas,H,B);for(const q of V.glyphs)q.texturePage=N,q.sizeClipSpace.x=q.size.x/O,q.sizeClipSpace.y=q.size.y/O,q.texturePosition.x+=H,q.texturePosition.y+=B,q.texturePositionClipSpace.x=q.texturePosition.x/O,q.texturePositionClipSpace.y=q.texturePosition.y/O;this._onRemoveTextureAtlasCanvas.fire(V.canvas);const W=this._activePages.indexOf(V);W!==-1&&this._activePages.splice(W,1)}return j}_deletePage(I){this._pages.splice(I,1);for(let N=I;N<this._pages.length;N++){const O=this._pages[N];for(const j of O.glyphs)j.texturePage--;O.version++}}getRasterizedGlyphCombinedChar(I,N,O,j,$){return this._getFromCacheMap(this._cacheMapCombined,I,N,O,j,$)}getRasterizedGlyph(I,N,O,j,$){return this._getFromCacheMap(this._cacheMap,I,N,O,j,$)}_getFromCacheMap(I,N,O,j,$,V=!1){return R=I.get(N,O,j,$),R||(R=this._drawToCache(N,O,j,$,V),I.set(N,O,j,$,R)),R}_getColorFromAnsiIndex(I){if(I>=this._config.colors.ansi.length)throw new Error("No color found for idx "+I);return this._config.colors.ansi[I]}_getBackgroundColor(I,N,O,j){if(this._config.allowTransparency)return m.NULL_COLOR;let $;switch(I){case 16777216:case 33554432:$=this._getColorFromAnsiIndex(N);break;case 50331648:const V=_.AttributeData.toColorRGB(N);$=m.channels.toColor(V[0],V[1],V[2]);break;default:$=O?m.color.opaque(this._config.colors.foreground):this._config.colors.background}return $}_getForegroundColor(I,N,O,j,$,V,H,B,W,q){const ne=this._getMinimumContrastColor(I,N,O,j,$,V,H,W,B,q);if(ne)return ne;let z;switch($){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&W&&V<8&&(V+=8),z=this._getColorFromAnsiIndex(V);break;case 50331648:const G=_.AttributeData.toColorRGB(V);z=m.channels.toColor(G[0],G[1],G[2]);break;default:z=H?this._config.colors.background:this._config.colors.foreground}return this._config.allowTransparency&&(z=m.color.opaque(z)),B&&(z=m.color.multiplyOpacity(z,u.DIM_OPACITY)),z}_resolveBackgroundRgba(I,N,O){switch(I){case 16777216:case 33554432:return this._getColorFromAnsiIndex(N).rgba;case 50331648:return N<<8;default:return O?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(I,N,O,j){switch(I){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&j&&N<8&&(N+=8),this._getColorFromAnsiIndex(N).rgba;case 50331648:return N<<8;default:return O?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(I,N,O,j,$,V,H,B,W,q){if(this._config.minimumContrastRatio===1||q)return;const ne=this._getContrastCache(W),z=ne.getColor(I,j);if(z!==void 0)return z||void 0;const G=this._resolveBackgroundRgba(N,O,H),J=this._resolveForegroundRgba($,V,H,B),U=m.rgba.ensureContrastRatio(G,J,this._config.minimumContrastRatio/(W?2:1));if(!U)return void ne.setColor(I,j,null);const re=m.channels.toColor(U>>24&255,U>>16&255,U>>8&255);return ne.setColor(I,j,re),re}_getContrastCache(I){return I?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(I,N,O,j,$=!1){const V=typeof I=="number"?String.fromCharCode(I):I,H=Math.min(this._config.deviceCellWidth*Math.max(V.length,2)+4,this._textureSize);this._tmpCanvas.width<H&&(this._tmpCanvas.width=H);const B=Math.min(this._config.deviceCellHeight+8,this._textureSize);if(this._tmpCanvas.height<B&&(this._tmpCanvas.height=B),this._tmpCtx.save(),this._workAttributeData.fg=O,this._workAttributeData.bg=N,this._workAttributeData.extended.ext=j,this._workAttributeData.isInvisible())return M;const W=!!this._workAttributeData.isBold(),q=!!this._workAttributeData.isInverse(),ne=!!this._workAttributeData.isDim(),z=!!this._workAttributeData.isItalic(),G=!!this._workAttributeData.isUnderline(),J=!!this._workAttributeData.isStrikethrough(),U=!!this._workAttributeData.isOverline();let re=this._workAttributeData.getFgColor(),de=this._workAttributeData.getFgColorMode(),ce=this._workAttributeData.getBgColor(),ae=this._workAttributeData.getBgColorMode();if(q){const ve=re;re=ce,ce=ve;const Me=de;de=ae,ae=Me}const be=this._getBackgroundColor(ae,ce,q,ne);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=be.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";const Ce=W?this._config.fontWeightBold:this._config.fontWeight,qe=z?"italic":"";this._tmpCtx.font=`${qe} ${Ce} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=u.TEXT_BASELINE;const dt=V.length===1&&(0,f.isPowerlineGlyph)(V.charCodeAt(0)),yt=V.length===1&&(0,f.isRestrictedPowerlineGlyph)(V.charCodeAt(0)),He=this._getForegroundColor(N,ae,ce,O,de,re,q,ne,W,(0,f.treatGlyphAsBackgroundColor)(V.charCodeAt(0)));this._tmpCtx.fillStyle=He.css;const We=yt?0:4;let Jn=!1;this._config.customGlyphs!==!1&&(Jn=(0,h.tryDrawCustomChar)(this._tmpCtx,V,We,We,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let Fn,li=!dt;if(Fn=typeof I=="number"?this._unicodeService.wcwidth(I):this._unicodeService.getStringCellWidth(I),G){this._tmpCtx.save();const ve=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),Me=ve%2==1?.5:0;if(this._tmpCtx.lineWidth=ve,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())li=!1,this._tmpCtx.strokeStyle=`rgb(${_.AttributeData.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{li=!1;let Ke=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&Ke<8&&(Ke+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(Ke).css}this._tmpCtx.beginPath();const At=We,se=Math.ceil(We+this._config.deviceCharHeight)-Me-($?2*ve:0),Se=se+ve,Oe=se+2*ve;let $e=this._workAttributeData.getUnderlineVariantOffset();for(let Ke=0;Ke<Fn;Ke++){this._tmpCtx.save();const it=At+Ke*this._config.deviceCellWidth,Nt=At+(Ke+1)*this._config.deviceCellWidth,hn=it+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(it,se),this._tmpCtx.lineTo(Nt,se),this._tmpCtx.moveTo(it,Oe),this._tmpCtx.lineTo(Nt,Oe);break;case 3:const Vt=ve<=1?Oe:Math.ceil(We+this._config.deviceCharHeight-ve/2)-Me,fn=ve<=1?se:Math.ceil(We+this._config.deviceCharHeight+ve/2)-Me,Tt=new Path2D;Tt.rect(it,se,this._config.deviceCellWidth,Oe-se),this._tmpCtx.clip(Tt),this._tmpCtx.moveTo(it-this._config.deviceCellWidth/2,Se),this._tmpCtx.bezierCurveTo(it-this._config.deviceCellWidth/2,fn,it,fn,it,Se),this._tmpCtx.bezierCurveTo(it,Vt,hn,Vt,hn,Se),this._tmpCtx.bezierCurveTo(hn,fn,Nt,fn,Nt,Se),this._tmpCtx.bezierCurveTo(Nt,Vt,Nt+this._config.deviceCellWidth/2,Vt,Nt+this._config.deviceCellWidth/2,Se);break;case 4:const yi=$e===0?0:$e>=ve?2*ve-$e:ve-$e;$e>=ve||yi===0?(this._tmpCtx.setLineDash([Math.round(ve),Math.round(ve)]),this._tmpCtx.moveTo(it+yi,se),this._tmpCtx.lineTo(Nt,se)):(this._tmpCtx.setLineDash([Math.round(ve),Math.round(ve)]),this._tmpCtx.moveTo(it,se),this._tmpCtx.lineTo(it+yi,se),this._tmpCtx.moveTo(it+yi+ve,se),this._tmpCtx.lineTo(Nt,se)),$e=(0,f.computeNextVariantOffset)(Nt-it,ve,$e);break;case 5:const bi=.6,ac=.3,$s=Nt-it,Gi=Math.floor(bi*$s),Ki=Math.floor(ac*$s),qs=$s-Gi-Ki;this._tmpCtx.setLineDash([Gi,Ki,qs]),this._tmpCtx.moveTo(it,se),this._tmpCtx.lineTo(Nt,se);break;default:this._tmpCtx.moveTo(it,se),this._tmpCtx.lineTo(Nt,se)}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!Jn&&this._config.fontSize>=12&&!this._config.allowTransparency&&V!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";const Ke=this._tmpCtx.measureText(V);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in Ke&&Ke.actualBoundingBoxDescent>0){this._tmpCtx.save();const it=new Path2D;it.rect(At,se-Math.ceil(ve/2),this._config.deviceCellWidth*Fn,Oe-se+Math.ceil(ve/2)),this._tmpCtx.clip(it),this._tmpCtx.lineWidth=3*this._config.devicePixelRatio,this._tmpCtx.strokeStyle=be.css,this._tmpCtx.strokeText(V,We,We+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(U){const ve=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),Me=ve%2==1?.5:0;this._tmpCtx.lineWidth=ve,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(We,We+Me),this._tmpCtx.lineTo(We+this._config.deviceCharWidth*Fn,We+Me),this._tmpCtx.stroke()}if(Jn||this._tmpCtx.fillText(V,We,We+this._config.deviceCharHeight),V==="_"&&!this._config.allowTransparency){let ve=T(this._tmpCtx.getImageData(We,We,this._config.deviceCellWidth,this._config.deviceCellHeight),be,He,li);if(ve)for(let Me=1;Me<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=be.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(V,We,We+this._config.deviceCharHeight-Me),ve=T(this._tmpCtx.getImageData(We,We,this._config.deviceCellWidth,this._config.deviceCellHeight),be,He,li),ve);Me++);}if(J){const ve=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),Me=this._tmpCtx.lineWidth%2==1?.5:0;this._tmpCtx.lineWidth=ve,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(We,We+Math.floor(this._config.deviceCharHeight/2)-Me),this._tmpCtx.lineTo(We+this._config.deviceCharWidth*Fn,We+Math.floor(this._config.deviceCharHeight/2)-Me),this._tmpCtx.stroke()}this._tmpCtx.restore();const Be=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height);let ot;if(ot=this._config.allowTransparency?(function(ve){for(let Me=0;Me<ve.data.length;Me+=4)if(ve.data[Me+3]>0)return!1;return!0})(Be):T(Be,be,He,li),ot)return M;const De=this._findGlyphBoundingBox(Be,this._workBoundingBox,H,yt,Jn,We);let Ge,Ze;for(;;){if(this._activePages.length===0){const ve=this._createNewPage();Ge=ve,Ze=ve.currentRow,Ze.height=De.size.y;break}Ge=this._activePages[this._activePages.length-1],Ze=Ge.currentRow;for(const ve of this._activePages)De.size.y<=ve.currentRow.height&&(Ge=ve,Ze=ve.currentRow);for(let ve=this._activePages.length-1;ve>=0;ve--)for(const Me of this._activePages[ve].fixedRows)Me.height<=Ze.height&&De.size.y<=Me.height&&(Ge=this._activePages[ve],Ze=Me);if(Ze.y+De.size.y>=Ge.canvas.height||Ze.height>De.size.y+2){let ve=!1;if(Ge.currentRow.y+Ge.currentRow.height+De.size.y>=Ge.canvas.height){let Me;for(const At of this._activePages)if(At.currentRow.y+At.currentRow.height+De.size.y<At.canvas.height){Me=At;break}if(Me)Ge=Me;else if(E.maxAtlasPages&&this._pages.length>=E.maxAtlasPages&&Ze.y+De.size.y<=Ge.canvas.height&&Ze.height>=De.size.y&&Ze.x+De.size.x<=Ge.canvas.width)ve=!0;else{const At=this._createNewPage();Ge=At,Ze=At.currentRow,Ze.height=De.size.y,ve=!0}}ve||(Ge.currentRow.height>0&&Ge.fixedRows.push(Ge.currentRow),Ze={x:0,y:Ge.currentRow.y+Ge.currentRow.height,height:De.size.y},Ge.fixedRows.push(Ze),Ge.currentRow={x:0,y:Ze.y+Ze.height,height:0})}if(Ze.x+De.size.x<=Ge.canvas.width)break;Ze===Ge.currentRow?(Ze.x=0,Ze.y+=Ze.height,Ze.height=0):Ge.fixedRows.splice(Ge.fixedRows.indexOf(Ze),1)}return De.texturePage=this._pages.indexOf(Ge),De.texturePosition.x=Ze.x,De.texturePosition.y=Ze.y,De.texturePositionClipSpace.x=Ze.x/Ge.canvas.width,De.texturePositionClipSpace.y=Ze.y/Ge.canvas.height,De.sizeClipSpace.x/=Ge.canvas.width,De.sizeClipSpace.y/=Ge.canvas.height,Ze.height=Math.max(Ze.height,De.size.y),Ze.x+=De.size.x,Ge.ctx.putImageData(Be,De.texturePosition.x-this._workBoundingBox.left,De.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,De.size.x,De.size.y),Ge.addGlyph(De),Ge.version++,De}_findGlyphBoundingBox(I,N,O,j,$,V){N.top=0;const H=j?this._config.deviceCellHeight:this._tmpCanvas.height,B=j?this._config.deviceCellWidth:O;let W=!1;for(let q=0;q<H;q++){for(let ne=0;ne<B;ne++){const z=q*this._tmpCanvas.width*4+4*ne+3;if(I.data[z]!==0){N.top=q,W=!0;break}}if(W)break}N.left=0,W=!1;for(let q=0;q<V+B;q++){for(let ne=0;ne<H;ne++){const z=ne*this._tmpCanvas.width*4+4*q+3;if(I.data[z]!==0){N.left=q,W=!0;break}}if(W)break}N.right=B,W=!1;for(let q=V+B-1;q>=V;q--){for(let ne=0;ne<H;ne++){const z=ne*this._tmpCanvas.width*4+4*q+3;if(I.data[z]!==0){N.right=q,W=!0;break}}if(W)break}N.bottom=H,W=!1;for(let q=H-1;q>=0;q--){for(let ne=0;ne<B;ne++){const z=q*this._tmpCanvas.width*4+4*ne+3;if(I.data[z]!==0){N.bottom=q,W=!0;break}}if(W)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:N.right-N.left+1,y:N.bottom-N.top+1},sizeClipSpace:{x:N.right-N.left+1,y:N.bottom-N.top+1},offset:{x:-N.left+V+(j||$?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-N.top+V+(j||$?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}}a.TextureAtlas=E;class A{get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(I){this._glyphs.push(I),this._usedPixels+=I.size.x*I.size.y}constructor(I,N,O){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],O)for(const j of O)this._glyphs.push(...j.glyphs),this._usedPixels+=j._usedPixels;this.canvas=L(I,N,N),this.ctx=(0,f.throwIfFalsy)(this.canvas.getContext("2d",{alpha:!0}))}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}}function T(P,I,N,O){const j=I.rgba>>>24,$=I.rgba>>>16&255,V=I.rgba>>>8&255,H=N.rgba>>>24,B=N.rgba>>>16&255,W=N.rgba>>>8&255,q=Math.floor((Math.abs(j-H)+Math.abs($-B)+Math.abs(V-W))/12);let ne=!0;for(let z=0;z<P.data.length;z+=4)P.data[z]===j&&P.data[z+1]===$&&P.data[z+2]===V||O&&Math.abs(P.data[z]-j)+Math.abs(P.data[z+1]-$)+Math.abs(P.data[z+2]-V)<q?P.data[z+3]=0:ne=!1;return ne}function L(P,I,N){const O=P.createElement("canvas");return O.width=I,O.height=N,O}},577:function(o,a,c){var u=this&&this.__decorate||function(w,M,R,E){var A,T=arguments.length,L=T<3?M:E===null?E=Object.getOwnPropertyDescriptor(M,R):E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(w,M,R,E);else for(var P=w.length-1;P>=0;P--)(A=w[P])&&(L=(T<3?A(L):T>3?A(M,R,L):A(M,R))||L);return T>3&&L&&Object.defineProperty(M,R,L),L},h=this&&this.__param||function(w,M){return function(R,E){M(R,E,w)}};Object.defineProperty(a,"__esModule",{value:!0}),a.CharacterJoinerService=a.JoinedCellData=void 0;const f=c(147),m=c(855),y=c(782),b=c(97);class S extends f.AttributeData{constructor(M,R,E){super(),this.content=0,this.combinedData="",this.fg=M.fg,this.bg=M.bg,this.combinedData=R,this._width=E}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(M){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}a.JoinedCellData=S;let _=a.CharacterJoinerService=class iU{constructor(M){this._bufferService=M,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new y.CellData}register(M){const R={id:this._nextCharacterJoinerId++,handler:M};return this._characterJoiners.push(R),R.id}deregister(M){for(let R=0;R<this._characterJoiners.length;R++)if(this._characterJoiners[R].id===M)return this._characterJoiners.splice(R,1),!0;return!1}getJoinedCharacters(M){if(this._characterJoiners.length===0)return[];const R=this._bufferService.buffer.lines.get(M);if(!R||R.length===0)return[];const E=[],A=R.translateToString(!0);let T=0,L=0,P=0,I=R.getFg(0),N=R.getBg(0);for(let O=0;O<R.getTrimmedLength();O++)if(R.loadCell(O,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==I||this._workCell.bg!==N){if(O-T>1){const j=this._getJoinedRanges(A,P,L,R,T);for(let $=0;$<j.length;$++)E.push(j[$])}T=O,P=L,I=this._workCell.fg,N=this._workCell.bg}L+=this._workCell.getChars().length||m.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-T>1){const O=this._getJoinedRanges(A,P,L,R,T);for(let j=0;j<O.length;j++)E.push(O[j])}return E}_getJoinedRanges(M,R,E,A,T){const L=M.substring(R,E);let P=[];try{P=this._characterJoiners[0].handler(L)}catch(I){console.error(I)}for(let I=1;I<this._characterJoiners.length;I++)try{const N=this._characterJoiners[I].handler(L);for(let O=0;O<N.length;O++)iU._mergeRanges(P,N[O])}catch(N){console.error(N)}return this._stringRangesToCellRanges(P,A,T),P}_stringRangesToCellRanges(M,R,E){let A=0,T=!1,L=0,P=M[A];if(P){for(let I=E;I<this._bufferService.cols;I++){const N=R.getWidth(I),O=R.getString(I).length||m.WHITESPACE_CELL_CHAR.length;if(N!==0){if(!T&&P[0]<=L&&(P[0]=I,T=!0),P[1]<=L){if(P[1]=I,P=M[++A],!P)break;P[0]<=L?(P[0]=I,T=!0):T=!1}L+=O}}P&&(P[1]=this._bufferService.cols)}}static _mergeRanges(M,R){let E=!1;for(let A=0;A<M.length;A++){const T=M[A];if(E){if(R[1]<=T[0])return M[A-1][1]=R[1],M;if(R[1]<=T[1])return M[A-1][1]=Math.max(R[1],T[1]),M.splice(A,1),M;M.splice(A,1),A--}else{if(R[1]<=T[0])return M.splice(A,0,R),M;if(R[1]<=T[1])return T[0]=Math.min(R[0],T[0]),M;R[0]<T[1]&&(T[0]=Math.min(R[0],T[0]),E=!0)}}return E?M[M.length-1][1]=R[1]:M.push(R),M}};a.CharacterJoinerService=_=u([h(0,b.IBufferService)],_)},160:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.contrastRatio=a.toPaddedHex=a.rgba=a.rgb=a.css=a.color=a.channels=a.NULL_COLOR=void 0;let c=0,u=0,h=0,f=0;var m,y,b,S,_;function w(R){const E=R.toString(16);return E.length<2?"0"+E:E}function M(R,E){return R<E?(E+.05)/(R+.05):(R+.05)/(E+.05)}a.NULL_COLOR={css:"#00000000",rgba:0},(function(R){R.toCss=function(E,A,T,L){return L!==void 0?`#${w(E)}${w(A)}${w(T)}${w(L)}`:`#${w(E)}${w(A)}${w(T)}`},R.toRgba=function(E,A,T,L=255){return(E<<24|A<<16|T<<8|L)>>>0},R.toColor=function(E,A,T,L){return{css:R.toCss(E,A,T,L),rgba:R.toRgba(E,A,T,L)}}})(m||(a.channels=m={})),(function(R){function E(A,T){return f=Math.round(255*T),[c,u,h]=_.toChannels(A.rgba),{css:m.toCss(c,u,h,f),rgba:m.toRgba(c,u,h,f)}}R.blend=function(A,T){if(f=(255&T.rgba)/255,f===1)return{css:T.css,rgba:T.rgba};const L=T.rgba>>24&255,P=T.rgba>>16&255,I=T.rgba>>8&255,N=A.rgba>>24&255,O=A.rgba>>16&255,j=A.rgba>>8&255;return c=N+Math.round((L-N)*f),u=O+Math.round((P-O)*f),h=j+Math.round((I-j)*f),{css:m.toCss(c,u,h),rgba:m.toRgba(c,u,h)}},R.isOpaque=function(A){return(255&A.rgba)==255},R.ensureContrastRatio=function(A,T,L){const P=_.ensureContrastRatio(A.rgba,T.rgba,L);if(P)return m.toColor(P>>24&255,P>>16&255,P>>8&255)},R.opaque=function(A){const T=(255|A.rgba)>>>0;return[c,u,h]=_.toChannels(T),{css:m.toCss(c,u,h),rgba:T}},R.opacity=E,R.multiplyOpacity=function(A,T){return f=255&A.rgba,E(A,f*T/255)},R.toColorRGB=function(A){return[A.rgba>>24&255,A.rgba>>16&255,A.rgba>>8&255]}})(y||(a.color=y={})),(function(R){let E,A;try{const T=document.createElement("canvas");T.width=1,T.height=1;const L=T.getContext("2d",{willReadFrequently:!0});L&&(E=L,E.globalCompositeOperation="copy",A=E.createLinearGradient(0,0,1,1))}catch{}R.toColor=function(T){if(T.match(/#[\da-f]{3,8}/i))switch(T.length){case 4:return c=parseInt(T.slice(1,2).repeat(2),16),u=parseInt(T.slice(2,3).repeat(2),16),h=parseInt(T.slice(3,4).repeat(2),16),m.toColor(c,u,h);case 5:return c=parseInt(T.slice(1,2).repeat(2),16),u=parseInt(T.slice(2,3).repeat(2),16),h=parseInt(T.slice(3,4).repeat(2),16),f=parseInt(T.slice(4,5).repeat(2),16),m.toColor(c,u,h,f);case 7:return{css:T,rgba:(parseInt(T.slice(1),16)<<8|255)>>>0};case 9:return{css:T,rgba:parseInt(T.slice(1),16)>>>0}}const L=T.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(L)return c=parseInt(L[1]),u=parseInt(L[2]),h=parseInt(L[3]),f=Math.round(255*(L[5]===void 0?1:parseFloat(L[5]))),m.toColor(c,u,h,f);if(!E||!A)throw new Error("css.toColor: Unsupported css format");if(E.fillStyle=A,E.fillStyle=T,typeof E.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(E.fillRect(0,0,1,1),[c,u,h,f]=E.getImageData(0,0,1,1).data,f!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:m.toRgba(c,u,h,f),css:T}}})(b||(a.css=b={})),(function(R){function E(A,T,L){const P=A/255,I=T/255,N=L/255;return .2126*(P<=.03928?P/12.92:Math.pow((P+.055)/1.055,2.4))+.7152*(I<=.03928?I/12.92:Math.pow((I+.055)/1.055,2.4))+.0722*(N<=.03928?N/12.92:Math.pow((N+.055)/1.055,2.4))}R.relativeLuminance=function(A){return E(A>>16&255,A>>8&255,255&A)},R.relativeLuminance2=E})(S||(a.rgb=S={})),(function(R){function E(T,L,P){const I=T>>24&255,N=T>>16&255,O=T>>8&255;let j=L>>24&255,$=L>>16&255,V=L>>8&255,H=M(S.relativeLuminance2(j,$,V),S.relativeLuminance2(I,N,O));for(;H<P&&(j>0||$>0||V>0);)j-=Math.max(0,Math.ceil(.1*j)),$-=Math.max(0,Math.ceil(.1*$)),V-=Math.max(0,Math.ceil(.1*V)),H=M(S.relativeLuminance2(j,$,V),S.relativeLuminance2(I,N,O));return(j<<24|$<<16|V<<8|255)>>>0}function A(T,L,P){const I=T>>24&255,N=T>>16&255,O=T>>8&255;let j=L>>24&255,$=L>>16&255,V=L>>8&255,H=M(S.relativeLuminance2(j,$,V),S.relativeLuminance2(I,N,O));for(;H<P&&(j<255||$<255||V<255);)j=Math.min(255,j+Math.ceil(.1*(255-j))),$=Math.min(255,$+Math.ceil(.1*(255-$))),V=Math.min(255,V+Math.ceil(.1*(255-V))),H=M(S.relativeLuminance2(j,$,V),S.relativeLuminance2(I,N,O));return(j<<24|$<<16|V<<8|255)>>>0}R.blend=function(T,L){if(f=(255&L)/255,f===1)return L;const P=L>>24&255,I=L>>16&255,N=L>>8&255,O=T>>24&255,j=T>>16&255,$=T>>8&255;return c=O+Math.round((P-O)*f),u=j+Math.round((I-j)*f),h=$+Math.round((N-$)*f),m.toRgba(c,u,h)},R.ensureContrastRatio=function(T,L,P){const I=S.relativeLuminance(T>>8),N=S.relativeLuminance(L>>8);if(M(I,N)<P){if(N<I){const $=E(T,L,P),V=M(I,S.relativeLuminance($>>8));if(V<P){const H=A(T,L,P);return V>M(I,S.relativeLuminance(H>>8))?$:H}return $}const O=A(T,L,P),j=M(I,S.relativeLuminance(O>>8));if(j<P){const $=E(T,L,P);return j>M(I,S.relativeLuminance($>>8))?O:$}return O}},R.reduceLuminance=E,R.increaseLuminance=A,R.toChannels=function(T){return[T>>24&255,T>>16&255,T>>8&255,255&T]}})(_||(a.rgba=_={})),a.toPaddedHex=w,a.contrastRatio=M},345:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.runAndSubscribe=a.forwardEvent=a.EventEmitter=void 0,a.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=c=>(this._listeners.push(c),{dispose:()=>{if(!this._disposed){for(let u=0;u<this._listeners.length;u++)if(this._listeners[u]===c)return void this._listeners.splice(u,1)}}})),this._event}fire(c,u){const h=[];for(let f=0;f<this._listeners.length;f++)h.push(this._listeners[f]);for(let f=0;f<h.length;f++)h[f].call(void 0,c,u)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},a.forwardEvent=function(c,u){return c((h=>u.fire(h)))},a.runAndSubscribe=function(c,u){return u(void 0),c((h=>u(h)))}},859:(o,a)=>{function c(u){for(const h of u)h.dispose();u.length=0}Object.defineProperty(a,"__esModule",{value:!0}),a.getDisposeArrayDisposable=a.disposeArray=a.toDisposable=a.MutableDisposable=a.Disposable=void 0,a.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const u of this._disposables)u.dispose();this._disposables.length=0}register(u){return this._disposables.push(u),u}unregister(u){const h=this._disposables.indexOf(u);h!==-1&&this._disposables.splice(h,1)}},a.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(u){this._isDisposed||u===this._value||(this._value?.dispose(),this._value=u)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,this._value?.dispose(),this._value=void 0}},a.toDisposable=function(u){return{dispose:u}},a.disposeArray=c,a.getDisposeArrayDisposable=function(u){return{dispose:()=>c(u)}}},485:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.FourKeyMap=a.TwoKeyMap=void 0;class c{constructor(){this._data={}}set(h,f,m){this._data[h]||(this._data[h]={}),this._data[h][f]=m}get(h,f){return this._data[h]?this._data[h][f]:void 0}clear(){this._data={}}}a.TwoKeyMap=c,a.FourKeyMap=class{constructor(){this._data=new c}set(u,h,f,m,y){this._data.get(u,h)||this._data.set(u,h,new c),this._data.get(u,h).set(f,m,y)}get(u,h,f,m){return this._data.get(u,h)?.get(f,m)}clear(){this._data.clear()}}},399:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.isChromeOS=a.isLinux=a.isWindows=a.isIphone=a.isIpad=a.isMac=a.getSafariVersion=a.isSafari=a.isLegacyEdge=a.isFirefox=a.isNode=void 0,a.isNode=typeof process<"u"&&"title"in process;const c=a.isNode?"node":navigator.userAgent,u=a.isNode?"node":navigator.platform;a.isFirefox=c.includes("Firefox"),a.isLegacyEdge=c.includes("Edge"),a.isSafari=/^((?!chrome|android).)*safari/i.test(c),a.getSafariVersion=function(){if(!a.isSafari)return 0;const h=c.match(/Version\/(\d+)/);return h===null||h.length<2?0:parseInt(h[1])},a.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(u),a.isIpad=u==="iPad",a.isIphone=u==="iPhone",a.isWindows=["Windows","Win16","Win32","WinCE"].includes(u),a.isLinux=u.indexOf("Linux")>=0,a.isChromeOS=/\bCrOS\b/.test(c)},385:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.DebouncedIdleTask=a.IdleTaskQueue=a.PriorityTaskQueue=void 0;const u=c(399);class h{constructor(){this._tasks=[],this._i=0}enqueue(y){this._tasks.push(y),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(y){this._idleCallback=void 0;let b=0,S=0,_=y.timeRemaining(),w=0;for(;this._i<this._tasks.length;){if(b=Date.now(),this._tasks[this._i]()||this._i++,b=Math.max(1,Date.now()-b),S=Math.max(b,S),w=y.timeRemaining(),1.5*S>w)return _-b<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(_-b))}ms`),void this._start();_=w}this.clear()}}class f extends h{_requestCallback(y){return setTimeout((()=>y(this._createDeadline(16))))}_cancelCallback(y){clearTimeout(y)}_createDeadline(y){const b=Date.now()+y;return{timeRemaining:()=>Math.max(0,b-Date.now())}}}a.PriorityTaskQueue=f,a.IdleTaskQueue=!u.isNode&&"requestIdleCallback"in window?class extends h{_requestCallback(m){return requestIdleCallback(m)}_cancelCallback(m){cancelIdleCallback(m)}}:f,a.DebouncedIdleTask=class{constructor(){this._queue=new a.IdleTaskQueue}set(m){this._queue.clear(),this._queue.enqueue(m)}flush(){this._queue.flush()}}},147:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.ExtendedAttrs=a.AttributeData=void 0;class c{constructor(){this.fg=0,this.bg=0,this.extended=new u}static toColorRGB(f){return[f>>>16&255,f>>>8&255,255&f]}static fromColorRGB(f){return(255&f[0])<<16|(255&f[1])<<8|255&f[2]}clone(){const f=new c;return f.fg=this.fg,f.bg=this.bg,f.extended=this.extended.clone(),f}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}a.AttributeData=c;class u{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(f){this._ext=f}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(f){this._ext&=-469762049,this._ext|=f<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(f){this._ext&=-67108864,this._ext|=67108863&f}get urlId(){return this._urlId}set urlId(f){this._urlId=f}get underlineVariantOffset(){const f=(3758096384&this._ext)>>29;return f<0?4294967288^f:f}set underlineVariantOffset(f){this._ext&=536870911,this._ext|=f<<29&3758096384}constructor(f=0,m=0){this._ext=0,this._urlId=0,this._ext=f,this._urlId=m}clone(){return new u(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}a.ExtendedAttrs=u},782:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.CellData=void 0;const u=c(133),h=c(855),f=c(147);class m extends f.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new f.ExtendedAttrs,this.combinedData=""}static fromCharData(b){const S=new m;return S.setFromCharData(b),S}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,u.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(b){this.fg=b[h.CHAR_DATA_ATTR_INDEX],this.bg=0;let S=!1;if(b[h.CHAR_DATA_CHAR_INDEX].length>2)S=!0;else if(b[h.CHAR_DATA_CHAR_INDEX].length===2){const _=b[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=_&&_<=56319){const w=b[h.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=w&&w<=57343?this.content=1024*(_-55296)+w-56320+65536|b[h.CHAR_DATA_WIDTH_INDEX]<<22:S=!0}else S=!0}else this.content=b[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|b[h.CHAR_DATA_WIDTH_INDEX]<<22;S&&(this.combinedData=b[h.CHAR_DATA_CHAR_INDEX],this.content=2097152|b[h.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}a.CellData=m},855:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.WHITESPACE_CELL_CODE=a.WHITESPACE_CELL_WIDTH=a.WHITESPACE_CELL_CHAR=a.NULL_CELL_CODE=a.NULL_CELL_WIDTH=a.NULL_CELL_CHAR=a.CHAR_DATA_CODE_INDEX=a.CHAR_DATA_WIDTH_INDEX=a.CHAR_DATA_CHAR_INDEX=a.CHAR_DATA_ATTR_INDEX=a.DEFAULT_EXT=a.DEFAULT_ATTR=a.DEFAULT_COLOR=void 0,a.DEFAULT_COLOR=0,a.DEFAULT_ATTR=256|a.DEFAULT_COLOR<<9,a.DEFAULT_EXT=0,a.CHAR_DATA_ATTR_INDEX=0,a.CHAR_DATA_CHAR_INDEX=1,a.CHAR_DATA_WIDTH_INDEX=2,a.CHAR_DATA_CODE_INDEX=3,a.NULL_CELL_CHAR="",a.NULL_CELL_WIDTH=1,a.NULL_CELL_CODE=0,a.WHITESPACE_CELL_CHAR=" ",a.WHITESPACE_CELL_WIDTH=1,a.WHITESPACE_CELL_CODE=32},133:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.Utf8ToUtf32=a.StringToUtf32=a.utf32ToString=a.stringFromCodePoint=void 0,a.stringFromCodePoint=function(c){return c>65535?(c-=65536,String.fromCharCode(55296+(c>>10))+String.fromCharCode(c%1024+56320)):String.fromCharCode(c)},a.utf32ToString=function(c,u=0,h=c.length){let f="";for(let m=u;m<h;++m){let y=c[m];y>65535?(y-=65536,f+=String.fromCharCode(55296+(y>>10))+String.fromCharCode(y%1024+56320)):f+=String.fromCharCode(y)}return f},a.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(c,u){const h=c.length;if(!h)return 0;let f=0,m=0;if(this._interim){const y=c.charCodeAt(m++);56320<=y&&y<=57343?u[f++]=1024*(this._interim-55296)+y-56320+65536:(u[f++]=this._interim,u[f++]=y),this._interim=0}for(let y=m;y<h;++y){const b=c.charCodeAt(y);if(55296<=b&&b<=56319){if(++y>=h)return this._interim=b,f;const S=c.charCodeAt(y);56320<=S&&S<=57343?u[f++]=1024*(b-55296)+S-56320+65536:(u[f++]=b,u[f++]=S)}else b!==65279&&(u[f++]=b)}return f}},a.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(c,u){const h=c.length;if(!h)return 0;let f,m,y,b,S=0,_=0,w=0;if(this.interim[0]){let E=!1,A=this.interim[0];A&=(224&A)==192?31:(240&A)==224?15:7;let T,L=0;for(;(T=63&this.interim[++L])&&L<4;)A<<=6,A|=T;const P=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,I=P-L;for(;w<I;){if(w>=h)return 0;if(T=c[w++],(192&T)!=128){w--,E=!0;break}this.interim[L++]=T,A<<=6,A|=63&T}E||(P===2?A<128?w--:u[S++]=A:P===3?A<2048||A>=55296&&A<=57343||A===65279||(u[S++]=A):A<65536||A>1114111||(u[S++]=A)),this.interim.fill(0)}const M=h-4;let R=w;for(;R<h;){for(;!(!(R<M)||128&(f=c[R])||128&(m=c[R+1])||128&(y=c[R+2])||128&(b=c[R+3]));)u[S++]=f,u[S++]=m,u[S++]=y,u[S++]=b,R+=4;if(f=c[R++],f<128)u[S++]=f;else if((224&f)==192){if(R>=h)return this.interim[0]=f,S;if(m=c[R++],(192&m)!=128){R--;continue}if(_=(31&f)<<6|63&m,_<128){R--;continue}u[S++]=_}else if((240&f)==224){if(R>=h)return this.interim[0]=f,S;if(m=c[R++],(192&m)!=128){R--;continue}if(R>=h)return this.interim[0]=f,this.interim[1]=m,S;if(y=c[R++],(192&y)!=128){R--;continue}if(_=(15&f)<<12|(63&m)<<6|63&y,_<2048||_>=55296&&_<=57343||_===65279)continue;u[S++]=_}else if((248&f)==240){if(R>=h)return this.interim[0]=f,S;if(m=c[R++],(192&m)!=128){R--;continue}if(R>=h)return this.interim[0]=f,this.interim[1]=m,S;if(y=c[R++],(192&y)!=128){R--;continue}if(R>=h)return this.interim[0]=f,this.interim[1]=m,this.interim[2]=y,S;if(b=c[R++],(192&b)!=128){R--;continue}if(_=(7&f)<<18|(63&m)<<12|(63&y)<<6|63&b,_<65536||_>1114111)continue;u[S++]=_}}return S}}},776:function(o,a,c){var u=this&&this.__decorate||function(_,w,M,R){var E,A=arguments.length,T=A<3?w:R===null?R=Object.getOwnPropertyDescriptor(w,M):R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(_,w,M,R);else for(var L=_.length-1;L>=0;L--)(E=_[L])&&(T=(A<3?E(T):A>3?E(w,M,T):E(w,M))||T);return A>3&&T&&Object.defineProperty(w,M,T),T},h=this&&this.__param||function(_,w){return function(M,R){w(M,R,_)}};Object.defineProperty(a,"__esModule",{value:!0}),a.traceCall=a.setTraceLogger=a.LogService=void 0;const f=c(859),m=c(97),y={trace:m.LogLevelEnum.TRACE,debug:m.LogLevelEnum.DEBUG,info:m.LogLevelEnum.INFO,warn:m.LogLevelEnum.WARN,error:m.LogLevelEnum.ERROR,off:m.LogLevelEnum.OFF};let b,S=a.LogService=class extends f.Disposable{get logLevel(){return this._logLevel}constructor(_){super(),this._optionsService=_,this._logLevel=m.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),b=this}_updateLogLevel(){this._logLevel=y[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(_){for(let w=0;w<_.length;w++)typeof _[w]=="function"&&(_[w]=_[w]())}_log(_,w,M){this._evalLazyOptionalParams(M),_.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+w,...M)}trace(_,...w){this._logLevel<=m.LogLevelEnum.TRACE&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,_,w)}debug(_,...w){this._logLevel<=m.LogLevelEnum.DEBUG&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,_,w)}info(_,...w){this._logLevel<=m.LogLevelEnum.INFO&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,_,w)}warn(_,...w){this._logLevel<=m.LogLevelEnum.WARN&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,_,w)}error(_,...w){this._logLevel<=m.LogLevelEnum.ERROR&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,_,w)}};a.LogService=S=u([h(0,m.IOptionsService)],S),a.setTraceLogger=function(_){b=_},a.traceCall=function(_,w,M){if(typeof M.value!="function")throw new Error("not supported");const R=M.value;M.value=function(...E){if(b.logLevel!==m.LogLevelEnum.TRACE)return R.apply(this,E);b.trace(`GlyphRenderer#${R.name}(${E.map((T=>JSON.stringify(T))).join(", ")})`);const A=R.apply(this,E);return b.trace(`GlyphRenderer#${R.name} return`,A),A}}},726:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.createDecorator=a.getServiceDependencies=a.serviceRegistry=void 0;const c="di$target",u="di$dependencies";a.serviceRegistry=new Map,a.getServiceDependencies=function(h){return h[u]||[]},a.createDecorator=function(h){if(a.serviceRegistry.has(h))return a.serviceRegistry.get(h);const f=function(m,y,b){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(S,_,w){_[c]===_?_[u].push({id:S,index:w}):(_[u]=[{id:S,index:w}],_[c]=_)})(f,m,b)};return f.toString=()=>h,a.serviceRegistry.set(h,f),f}},97:(o,a,c)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.IDecorationService=a.IUnicodeService=a.IOscLinkService=a.IOptionsService=a.ILogService=a.LogLevelEnum=a.IInstantiationService=a.ICharsetService=a.ICoreService=a.ICoreMouseService=a.IBufferService=void 0;const u=c(726);var h;a.IBufferService=(0,u.createDecorator)("BufferService"),a.ICoreMouseService=(0,u.createDecorator)("CoreMouseService"),a.ICoreService=(0,u.createDecorator)("CoreService"),a.ICharsetService=(0,u.createDecorator)("CharsetService"),a.IInstantiationService=(0,u.createDecorator)("InstantiationService"),(function(f){f[f.TRACE=0]="TRACE",f[f.DEBUG=1]="DEBUG",f[f.INFO=2]="INFO",f[f.WARN=3]="WARN",f[f.ERROR=4]="ERROR",f[f.OFF=5]="OFF"})(h||(a.LogLevelEnum=h={})),a.ILogService=(0,u.createDecorator)("LogService"),a.IOptionsService=(0,u.createDecorator)("OptionsService"),a.IOscLinkService=(0,u.createDecorator)("OscLinkService"),a.IUnicodeService=(0,u.createDecorator)("UnicodeService"),a.IDecorationService=(0,u.createDecorator)("DecorationService")}},i={};function s(o){var a=i[o];if(a!==void 0)return a.exports;var c=i[o]={exports:{}};return n[o].call(c.exports,c,c.exports,s),c.exports}var r={};return(()=>{var o=r;Object.defineProperty(o,"__esModule",{value:!0}),o.CanvasAddon=void 0;const a=s(345),c=s(859),u=s(776),h=s(949);class f extends c.Disposable{constructor(){super(...arguments),this._onChangeTextureAtlas=this.register(new a.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new a.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event}get textureAtlas(){return this._renderer?.textureAtlas}activate(y){const b=y._core;if(!y.element)return void this.register(b.onWillOpen((()=>this.activate(y))));this._terminal=y;const S=b.coreService,_=b.optionsService,w=b.screenElement,M=b.linkifier,R=b,E=R._bufferService,A=R._renderService,T=R._characterJoinerService,L=R._charSizeService,P=R._coreBrowserService,I=R._decorationService,N=R._logService,O=R._themeService;(0,u.setTraceLogger)(N),this._renderer=new h.CanvasRenderer(y,w,M,E,L,_,T,S,P,I,O),this.register((0,a.forwardEvent)(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this.register((0,a.forwardEvent)(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),A.setRenderer(this._renderer),A.handleResize(E.cols,E.rows),this.register((0,c.toDisposable)((()=>{A.setRenderer(this._terminal._core._createRenderer()),A.handleResize(y.cols,y.rows),this._renderer?.dispose(),this._renderer=void 0})))}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}}o.CanvasAddon=f})(),r})()))})(tx)),tx.exports}var C0e=w0e();const $1="MesloLGLDZ Nerd Font Mono",k0e=["https://cdn.jsdmirror.com/gh/mshaugh/nerdfont-webfonts@v3.3.0/build/fonts/MesloLGLDZNerdFontMono-Regular.woff2","https://cdn.jsdelivr.net/gh/mshaugh/nerdfont-webfonts@v3.3.0/build/fonts/MesloLGLDZNerdFontMono-Regular.woff2"],sU=["JetBrainsMono Nerd Font","JetBrainsMonoNerdFont","FiraCode Nerd Font","FiraCodeNerdFont","Hack Nerd Font","HackNerdFont","MapleMono NF","Maple Mono NF","Iosevka Nerd Font","IosevkaNerdFont","CaskaydiaCove Nerd Font","MesloLGS Nerd Font","SourceCodePro Nerd Font","UbuntuMono Nerd Font"],T0e=["ui-monospace","monospace"],E0e=['"SFMono-Regular"','"Menlo"','"Monaco"','"Consolas"','"Liberation Mono"','"Courier New"'];async function R0e(){let e=null;for(const t of k0e)try{const n=new FontFace($1,`url(${t}) format("woff2")`,{style:"normal",weight:"400",display:"swap"});await n.load(),document.fonts.add(n);return}catch(n){e=n,console.warn(`[TerminalFont] Failed to load from ${t}, trying next...`)}throw e??new Error("All CDN URLs failed")}class M0e{constructor(t){this.fontFamily=t}getFontFamily(){return this.fontFamily}}const A0e=sU.map(e=>`"${e}"`).join(", "),P0e=[A0e,`"${$1}"`,...E0e,...T0e],L0e=P0e.join(", "),N0e=new M0e(L0e);let tg=null;function I0e(e){if(typeof document>"u")return!1;const n=document.createElement("canvas").getContext("2d");if(!n)return!1;const i="mmmmmmmmmmlli";n.font='72px "__nonexistent_font_test__", monospace';const s=n.measureText(i).width;return n.font=`72px "${e}", monospace`,n.measureText(i).width!==s}function D0e(){return[$1,...sU].some(I0e)}function O0e(){return N0e}function j0e(){return tg||(D0e()?(console.log("[TerminalFont] Local Nerd Font detected; skip CDN load"),tg=Promise.resolve(!1)):tg=R0e().then(()=>(console.log("[TerminalFont] CDN font loaded"),!0)).catch(e=>(console.error("[TerminalFont] Failed to load CDN font:",e),!1))),tg}function B0e(){const e=getComputedStyle(document.documentElement),t=e.getPropertyValue("--app-bg").trim()||"#000000",n=e.getPropertyValue("--app-fg").trim()||"#ffffff",i=e.getPropertyValue("--app-subtle-bg").trim()||"rgba(255, 255, 255, 0.2)";return{background:t,foreground:n,selectionBackground:i}}function F0e(e){const t=k.useRef(null),n=k.useRef(e.onMount),i=k.useRef(e.onResize);return k.useEffect(()=>{n.current=e.onMount},[e.onMount]),k.useEffect(()=>{i.current=e.onResize},[e.onResize]),k.useEffect(()=>{const s=t.current;if(!s)return;const r=new AbortController,o=O0e(),{background:a,foreground:c,selectionBackground:u}=B0e(),h=new f0e({cursorBlink:!0,fontFamily:o.getFontFamily(),fontSize:13,theme:{background:a,foreground:c,cursor:c,selectionBackground:u},convertEol:!0,customGlyphs:!0}),f=new g0e,m=new x0e,y=new C0e.CanvasAddon;h.loadAddon(f),h.loadAddon(m),h.loadAddon(y),h.open(s);const b=new ResizeObserver(()=>{requestAnimationFrame(()=>{f.fit(),i.current?.(h.cols,h.rows)})});b.observe(s);const S=(_=!1)=>{if(r.signal.aborted)return;const w=o.getFontFamily();if(_&&h.options.fontFamily===w){h.options.fontFamily=`${w}, "__hapi_font_refresh__"`,requestAnimationFrame(()=>{r.signal.aborted||(h.options.fontFamily=w,h.rows>0&&h.refresh(0,h.rows-1),f.fit(),i.current?.(h.cols,h.rows))});return}h.options.fontFamily=w,h.rows>0&&h.refresh(0,h.rows-1),f.fit(),i.current?.(h.cols,h.rows)};return j0e().then(_=>{_&&S(!0)}),r.signal.addEventListener("abort",()=>{b.disconnect(),f.dispose(),m.dispose(),y.dispose(),h.dispose()}),requestAnimationFrame(()=>{f.fit(),i.current?.(h.cols,h.rows)}),n.current?.(h),()=>r.abort()},[]),g.jsx("div",{ref:t,className:`h-full w-full ${e.className??""}`})}function U0e(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:g.jsx("polyline",{points:"15 18 9 12 15 6"})})}function z0e(e){const t=e.status==="connected",n=e.status==="connecting",i=t?"Connected":n?"Connecting":"Offline",s=t?"bg-emerald-500":n?"bg-amber-400 animate-pulse":"bg-[var(--app-hint)]";return g.jsx("div",{className:"flex items-center","aria-label":i,title:i,role:"status",children:g.jsx("span",{className:`h-2.5 w-2.5 rounded-full ${s}`})})}function $0e(e,t){let n=e;if(t.alt&&(n=`\x1B${n}`),t.ctrl&&n.length===1){const i=n.toUpperCase().charCodeAt(0);i>=64&&i<=95&&(n=String.fromCharCode(i-64))}return n}function q0e(e,t){return e?t.ctrl||t.alt:!1}const H0e=[[{label:"Esc",sequence:"\x1B",description:"Escape"},{label:"/",sequence:"/",description:"Forward slash",popup:{label:"?",sequence:"?",description:"Question mark"}},{label:"-",sequence:"-",description:"Hyphen",popup:{label:"|",sequence:"|",description:"Pipe"}},{label:"Home",sequence:"\x1B[H",description:"Home"},{label:"",sequence:"\x1B[A",description:"Arrow up"},{label:"End",sequence:"\x1B[F",description:"End"},{label:"PgUp",sequence:"\x1B[5~",description:"Page up"}],[{label:"Tab",sequence:"	",description:"Tab"},{label:"Ctrl",description:"Control",modifier:"ctrl"},{label:"Alt",description:"Alternate",modifier:"alt"},{label:"",sequence:"\x1B[D",description:"Arrow left"},{label:"",sequence:"\x1B[B",description:"Arrow down"},{label:"",sequence:"\x1B[C",description:"Arrow right"},{label:"PgDn",sequence:"\x1B[6~",description:"Page down"}]];function V0e(e){const{input:t,disabled:n,isActive:i,onPress:s,onToggleModifier:r}=e,o=t.modifier,a=t.popup?.sequence,c=t.popup?.description,h=n||!!o||!!!a,f=k.useCallback(()=>{if(o){r(o);return}s(t.sequence??"")},[o,r,s,t.sequence]),m=k.useCallback(b=>{b.pointerType==="touch"&&b.preventDefault()},[]),y=K4({onLongPress:()=>{a&&!o&&s(a)},onClick:f,disabled:h});return g.jsx("button",{type:"button",...y,onPointerDown:m,disabled:n,"aria-pressed":o?i:void 0,className:`flex-1 border-l border-[var(--app-border)] px-2 py-1.5 text-xs font-medium text-[var(--app-fg)] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-button)] focus-visible:ring-inset disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:bg-transparent first:border-l-0 active:bg-[var(--app-subtle-bg)] sm:px-3 sm:text-sm ${i?"bg-[var(--app-link)] text-[var(--app-bg)]":"hover:bg-[var(--app-subtle-bg)]"}`,"aria-label":t.description,title:c?`${t.description} (long press: ${c})`:t.description,children:t.label})}function W0e(){const{t:e}=rt(),{sessionId:t}=$a({from:"/sessions/$sessionId/terminal"}),{api:n,token:i,baseUrl:s}=Vu(),r=Jl(),{session:o}=T1(n,t),a=k.useMemo(()=>typeof crypto?.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,[t]),c=k.useRef(null),u=k.useRef(null),h=k.useRef(!1),f=k.useRef(null),m=k.useRef({ctrl:!1,alt:!1}),[y,b]=k.useState(null),[S,_]=k.useState(!1),[w,M]=k.useState(!1),[R,E]=k.useState(!1),[A,T]=k.useState(""),{state:L,connect:P,write:I,resize:N,disconnect:O,onOutput:j,onExit:$}=sye({token:i,sessionId:t,terminalId:a,baseUrl:s});k.useEffect(()=>{j(ae=>{c.current?.write(ae)})},[j]),k.useEffect(()=>{$((ae,be)=>{b({code:ae,signal:be}),c.current?.write(`\r
[process exited${ae!==null?` with code ${ae}`:""}]`),h.current=!1})},[$]),k.useEffect(()=>{m.current={ctrl:S,alt:w}},[S,w]);const V=k.useCallback(()=>{_(!1),M(!1)},[]),H=k.useCallback((ae,be)=>{I($0e(ae,be)),q0e(ae,be)&&V()},[I,V]),B=k.useCallback(ae=>{c.current=ae,u.current?.dispose(),u.current=ae.onData(be=>{const Ce=m.current;H(be,Ce)})},[H]),W=k.useCallback((ae,be)=>{f.current={cols:ae,rows:be},o?.active&&(h.current?N(ae,be):(h.current=!0,P(ae,be)))},[o?.active,P,N]);k.useEffect(()=>{if(!o?.active||h.current)return;const ae=f.current;ae&&(h.current=!0,P(ae.cols,ae.rows))},[o?.active,P]),k.useEffect(()=>{h.current=!1,b(null),O()},[t,O]),k.useEffect(()=>()=>{u.current?.dispose(),h.current=!1,O()},[O]),k.useEffect(()=>{o?.active===!1&&(O(),h.current=!1)},[o?.active,O]),k.useEffect(()=>{if(L.status==="error"){h.current=!1;return}(L.status==="connecting"||L.status==="connected")&&b(null)},[L.status]);const q=!o?.active||L.status!=="connected",ne=k.useCallback(ae=>!ae||q?!1:(I(ae),V(),c.current?.focus(),!0),[q,I,V]),z=k.useCallback(async()=>{if(q)return;const ae=navigator.clipboard?.readText;if(ae)try{const be=await ae.call(navigator.clipboard);if(!be||ne(be))return}catch{}T(""),E(!0)},[q,ne]),G=k.useCallback(()=>{A.trim()&&ne(A)&&(E(!1),T(""))},[A,ne]),J=k.useCallback(ae=>{if(q)return;H(ae,{ctrl:S,alt:w}),c.current?.focus()},[q,S,w,H]),U=k.useCallback(ae=>{q||(ae==="ctrl"?(_(be=>!be),M(!1)):(M(be=>!be),_(!1)),c.current?.focus())},[q]);if(!o)return g.jsx("div",{className:"flex h-full items-center justify-center",children:g.jsx(mv,{label:"Loading session",className:"text-sm"})});const re=o.metadata?.path??t,de=L.status,ce=L.status==="error"?L.error:null;return g.jsxs("div",{className:"flex h-full flex-col",children:[g.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:g.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center gap-2 p-3 border-b border-[var(--app-border)]",children:[g.jsx("button",{type:"button",onClick:r,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:g.jsx(U0e,{})}),g.jsxs("div",{className:"min-w-0 flex-1",children:[g.jsx("div",{className:"truncate font-semibold",children:"Terminal"}),g.jsx("div",{className:"truncate text-xs text-[var(--app-hint)]",children:re})]}),g.jsx(z0e,{status:de})]})}),o.active?null:g.jsx("div",{className:"px-3 pt-3",children:g.jsx("div",{className:"mx-auto w-full max-w-content rounded-md bg-[var(--app-subtle-bg)] p-3 text-sm text-[var(--app-hint)]",children:"Session is inactive. Terminal is unavailable."})}),ce?g.jsx("div",{className:"mx-auto w-full max-w-content px-3 pt-3",children:g.jsx("div",{className:"rounded-md border border-[var(--app-badge-error-border)] bg-[var(--app-badge-error-bg)] p-3 text-xs text-[var(--app-badge-error-text)]",children:ce})}):null,y?g.jsx("div",{className:"mx-auto w-full max-w-content px-3 pt-3",children:g.jsxs("div",{className:"rounded-md border border-[var(--app-border)] bg-[var(--app-subtle-bg)] p-3 text-xs text-[var(--app-hint)]",children:["Terminal exited",y.code!==null?` with code ${y.code}`:"",y.signal?` (${y.signal})`:"","."]})}):null,g.jsx("div",{className:"flex-1 overflow-hidden bg-[var(--app-bg)]",children:g.jsx("div",{className:"mx-auto h-full w-full max-w-content p-3",children:g.jsx(F0e,{onMount:B,onResize:W,className:"h-full w-full"})})}),g.jsx("div",{className:"bg-[var(--app-bg)] border-t border-[var(--app-border)] pb-[env(safe-area-inset-bottom)]",children:g.jsx("div",{className:"mx-auto w-full max-w-content px-3",children:g.jsxs("div",{className:"flex flex-col gap-2 py-2",children:[g.jsx("button",{type:"button",onClick:()=>{z()},disabled:q,className:"w-full rounded-md border border-[var(--app-border)] bg-[var(--app-secondary-bg)] px-3 py-2 text-sm font-medium text-[var(--app-fg)] transition-colors hover:bg-[var(--app-subtle-bg)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--app-button)] disabled:cursor-not-allowed disabled:opacity-50",children:e("button.paste")}),H0e.map((ae,be)=>g.jsx("div",{className:"flex items-stretch overflow-hidden rounded-md bg-[var(--app-secondary-bg)]",children:ae.map(Ce=>{const qe=Ce.modifier,He=qe==="ctrl"&&S||qe==="alt"&&w;return g.jsx(V0e,{input:Ce,disabled:q,isActive:He,onPress:J,onToggleModifier:U},Ce.label)})},`terminal-quick-row-${be}`))]})})}),g.jsx(ec,{open:R,onOpenChange:ae=>{E(ae),ae||T("")},children:g.jsxs(Va,{className:"max-w-md",children:[g.jsxs(tc,{children:[g.jsx(Wa,{children:e("terminal.paste.fallbackTitle")}),g.jsx(Df,{children:e("terminal.paste.fallbackDescription")})]}),g.jsx("textarea",{value:A,onChange:ae=>T(ae.target.value),placeholder:e("terminal.paste.placeholder"),className:"mt-2 min-h-32 w-full resize-y rounded-md border border-[var(--app-border)] bg-[var(--app-bg)] p-2 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--app-link)]",autoCapitalize:"none",autoCorrect:"off"}),g.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[g.jsx(Xn,{type:"button",variant:"secondary",onClick:()=>{E(!1),T("")},children:e("button.cancel")}),g.jsx(Xn,{type:"button",onClick:G,disabled:!A.trim(),children:e("button.paste")})]})]})})]})}const Y2=[{value:"en",nativeLabel:"English"},{value:"zh-CN",nativeLabel:""}],X2=uK();function G0e(e){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:g.jsx("polyline",{points:"15 18 9 12 15 6"})})}function nx(e){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:g.jsx("polyline",{points:"20 6 9 17 4 12"})})}function ix(e){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:g.jsx("polyline",{points:"6 9 12 15 18 9"})})}function K0e(){const{t:e,locale:t,setLocale:n}=rt(),i=Jl(),[s,r]=k.useState(!1),[o,a]=k.useState(!1),[c,u]=k.useState(!1),h=k.useRef(null),f=k.useRef(null),m=k.useRef(null),{fontScale:y,setFontScale:b}=tH(),[S,_]=k.useState(()=>localStorage.getItem("hapi-voice-lang")),w=Yq(),M=Y2.find(P=>P.value===t),R=w.find(P=>P.value===y)?.label??"100%",E=X2.find(P=>P.code===S),A=P=>{n(P),r(!1)},T=P=>{b(P),a(!1)},L=P=>{_(P.code),P.code===null?localStorage.removeItem("hapi-voice-lang"):localStorage.setItem("hapi-voice-lang",P.code),u(!1)};return k.useEffect(()=>{if(!s&&!o&&!c)return;const P=I=>{s&&h.current&&!h.current.contains(I.target)&&r(!1),o&&f.current&&!f.current.contains(I.target)&&a(!1),c&&m.current&&!m.current.contains(I.target)&&u(!1)};return document.addEventListener("mousedown",P),()=>document.removeEventListener("mousedown",P)},[s,o,c]),k.useEffect(()=>{if(!s&&!o&&!c)return;const P=I=>{I.key==="Escape"&&(r(!1),a(!1),u(!1))};return document.addEventListener("keydown",P),()=>document.removeEventListener("keydown",P)},[s,o,c]),g.jsxs("div",{className:"flex h-full flex-col",children:[g.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:g.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center gap-2 p-3 border-b border-[var(--app-border)]",children:[g.jsx("button",{type:"button",onClick:i,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:g.jsx(G0e,{})}),g.jsx("div",{className:"flex-1 font-semibold",children:e("settings.title")})]})}),g.jsx("div",{className:"flex-1 overflow-y-auto",children:g.jsxs("div",{className:"mx-auto w-full max-w-content",children:[g.jsxs("div",{className:"border-b border-[var(--app-divider)]",children:[g.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-[var(--app-hint)] uppercase tracking-wide",children:e("settings.language.title")}),g.jsxs("div",{ref:h,className:"relative",children:[g.jsxs("button",{type:"button",onClick:()=>r(!s),className:"flex w-full items-center justify-between px-3 py-3 text-left transition-colors hover:bg-[var(--app-subtle-bg)]","aria-expanded":s,"aria-haspopup":"listbox",children:[g.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.language.label")}),g.jsxs("span",{className:"flex items-center gap-1 text-[var(--app-hint)]",children:[g.jsx("span",{children:M?.nativeLabel}),g.jsx(ix,{className:`transition-transform ${s?"rotate-180":""}`})]})]}),s&&g.jsx("div",{className:"absolute right-3 top-full mt-1 min-w-[160px] rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] shadow-lg overflow-hidden z-50",role:"listbox","aria-label":e("settings.language.title"),children:Y2.map(P=>{const I=t===P.value;return g.jsxs("button",{type:"button",role:"option","aria-selected":I,onClick:()=>A(P.value),className:`flex items-center justify-between w-full px-3 py-2 text-base text-left transition-colors ${I?"text-[var(--app-link)] bg-[var(--app-subtle-bg)]":"text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)]"}`,children:[g.jsx("span",{children:P.nativeLabel}),I&&g.jsx("span",{className:"ml-2 text-[var(--app-link)]",children:g.jsx(nx,{})})]},P.value)})})]})]}),g.jsxs("div",{className:"border-b border-[var(--app-divider)]",children:[g.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-[var(--app-hint)] uppercase tracking-wide",children:e("settings.display.title")}),g.jsxs("div",{ref:f,className:"relative",children:[g.jsxs("button",{type:"button",onClick:()=>a(!o),className:"flex w-full items-center justify-between px-3 py-3 text-left transition-colors hover:bg-[var(--app-subtle-bg)]","aria-expanded":o,"aria-haspopup":"listbox",children:[g.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.display.fontSize")}),g.jsxs("span",{className:"flex items-center gap-1 text-[var(--app-hint)]",children:[g.jsx("span",{children:R}),g.jsx(ix,{className:`transition-transform ${o?"rotate-180":""}`})]})]}),o&&g.jsx("div",{className:"absolute right-3 top-full mt-1 min-w-[140px] rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] shadow-lg overflow-hidden z-50",role:"listbox","aria-label":e("settings.display.fontSize"),children:w.map(P=>{const I=y===P.value;return g.jsxs("button",{type:"button",role:"option","aria-selected":I,onClick:()=>T(P.value),className:`flex items-center justify-between w-full px-3 py-2 text-base text-left transition-colors ${I?"text-[var(--app-link)] bg-[var(--app-subtle-bg)]":"text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)]"}`,children:[g.jsx("span",{children:P.label}),I&&g.jsx("span",{className:"ml-2 text-[var(--app-link)]",children:g.jsx(nx,{})})]},P.value)})})]})]}),g.jsxs("div",{className:"border-b border-[var(--app-divider)]",children:[g.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-[var(--app-hint)] uppercase tracking-wide",children:e("settings.voice.title")}),g.jsxs("div",{ref:m,className:"relative",children:[g.jsxs("button",{type:"button",onClick:()=>u(!c),className:"flex w-full items-center justify-between px-3 py-3 text-left transition-colors hover:bg-[var(--app-subtle-bg)]","aria-expanded":c,"aria-haspopup":"listbox",children:[g.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.voice.language")}),g.jsxs("span",{className:"flex items-center gap-1 text-[var(--app-hint)]",children:[g.jsx("span",{children:E?E.code===null?e("settings.voice.autoDetect"):KP(E):e("settings.voice.autoDetect")}),g.jsx(ix,{className:`transition-transform ${c?"rotate-180":""}`})]})]}),c&&g.jsx("div",{className:"absolute right-3 top-full mt-1 min-w-[200px] max-h-[300px] overflow-y-auto rounded-lg border border-[var(--app-border)] bg-[var(--app-bg)] shadow-lg z-50",role:"listbox","aria-label":e("settings.voice.title"),children:X2.map(P=>{const I=S===P.code,N=P.code===null?e("settings.voice.autoDetect"):KP(P);return g.jsxs("button",{type:"button",role:"option","aria-selected":I,onClick:()=>L(P),className:`flex items-center justify-between w-full px-3 py-2 text-base text-left transition-colors ${I?"text-[var(--app-link)] bg-[var(--app-subtle-bg)]":"text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)]"}`,children:[g.jsx("span",{children:N}),I&&g.jsx("span",{className:"ml-2 text-[var(--app-link)]",children:g.jsx(nx,{})})]},P.code??"auto")})})]})]}),g.jsxs("div",{className:"border-b border-[var(--app-divider)]",children:[g.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-[var(--app-hint)] uppercase tracking-wide",children:e("settings.about.title")}),g.jsxs("div",{className:"flex w-full items-center justify-between px-3 py-3",children:[g.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.about.website")}),g.jsx("a",{href:"https://hapi.run",target:"_blank",rel:"noopener noreferrer",className:"text-[var(--app-link)] hover:underline",children:"hapi.run"})]}),g.jsxs("div",{className:"flex w-full items-center justify-between px-3 py-3",children:[g.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.about.appVersion")}),g.jsx("span",{className:"text-[var(--app-hint)]",children:"0.15.3"})]}),g.jsxs("div",{className:"flex w-full items-center justify-between px-3 py-3",children:[g.jsx("span",{className:"text-[var(--app-fg)]",children:e("settings.about.protocolVersion")}),g.jsx("span",{className:"text-[var(--app-hint)]",children:kH})]})]})]})})]})}function Y0e(e){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:g.jsx("polyline",{points:"15 18 9 12 15 6"})})}function X0e(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[g.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),g.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}function Q0e(e){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:e.className,children:[g.jsx("circle",{cx:"12",cy:"12",r:"3"}),g.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"})]})}function J0e(){const{api:e}=Vu(),t=fr(),n=ef({select:b=>b.pathname}),i=MD(),{t:s}=rt(),{sessions:r,isLoading:o,error:a,refetch:c}=Y4(e),u=k.useCallback(()=>{c()},[c]),h=new Set(r.map(b=>b.metadata?.worktree?.basePath??b.metadata?.path??"Other")).size,f=i({to:"/sessions/$sessionId",fuzzy:!0}),m=f&&f.sessionId!=="new"?f.sessionId:null,y=n==="/sessions"||n==="/sessions/";return g.jsxs("div",{className:"flex h-full min-h-0",children:[g.jsxs("div",{className:`${y?"flex":"hidden lg:flex"} w-full lg:w-[420px] xl:w-[480px] shrink-0 flex-col bg-[var(--app-bg)] lg:border-r lg:border-[var(--app-divider)]`,children:[g.jsx("div",{className:"bg-[var(--app-bg)] pt-[env(safe-area-inset-top)]",children:g.jsxs("div",{className:"mx-auto w-full max-w-content flex items-center justify-between px-3 py-2",children:[g.jsx("div",{className:"text-xs text-[var(--app-hint)]",children:s("sessions.count",{n:r.length,m:h})}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx("button",{type:"button",onClick:()=>t({to:"/settings"}),className:"p-1.5 rounded-full text-[var(--app-hint)] hover:text-[var(--app-fg)] hover:bg-[var(--app-subtle-bg)] transition-colors",title:s("settings.title"),children:g.jsx(Q0e,{className:"h-5 w-5"})}),g.jsx("button",{type:"button",onClick:()=>t({to:"/sessions/new"}),className:"session-list-new-button p-1.5 rounded-full text-[var(--app-link)] transition-colors",title:s("sessions.new"),children:g.jsx(X0e,{className:"h-5 w-5"})})]})]})}),g.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto desktop-scrollbar-left",children:[a?g.jsx("div",{className:"mx-auto w-full max-w-content px-3 py-2",children:g.jsx("div",{className:"text-sm text-red-600",children:a})}):null,g.jsx(Vme,{sessions:r,selectedSessionId:m,onSelect:b=>t({to:"/sessions/$sessionId",params:{sessionId:b}}),onNewSession:()=>t({to:"/sessions/new"}),onRefresh:u,isLoading:o,renderHeader:!1,api:e})]})]}),g.jsx("div",{className:`${y?"hidden lg:flex":"flex"} min-w-0 flex-1 flex-col bg-[var(--app-bg)]`,children:g.jsx("div",{className:"flex-1 min-h-0",children:g.jsx(Yv,{})})})]})}function Z0e(){return null}function eSe(){const{api:e}=Vu(),{t}=rt(),n=Jl(),i=fr(),s=jo(),{addToast:r}=xk(),{sessionId:o}=$a({from:"/sessions/$sessionId"}),{session:a,refetch:c}=T1(e,o),{messages:u,warning:h,isLoading:f,isLoadingMore:m,hasMore:y,loadMore:b,refetch:S,pendingCount:_,messagesVersion:w,flushPending:M,setAtBottom:R}=fge(e,o),{sendMessage:E,retryMessage:A,isSending:T}=_ge(e,o,{resolveSessionId:async j=>{if(!e||!a||a.active)return j;try{return await e.resumeSession(j)}catch($){const V=$ instanceof Error?$.message:"Resume failed";throw r({title:"Resume failed",body:V,sessionId:j,url:""}),$}},onSessionResolved:j=>{(async()=>{if(e){a&&j!==a.id&&(VH(a.id,j),s.setQueryData(Xt.session(j),{session:{...a,id:j,active:!0}}));try{await Promise.all([s.prefetchQuery({queryKey:Xt.session(j),queryFn:()=>e.getSession(j)}),Nh(e,j)])}catch{}}i({to:"/sessions/$sessionId",params:{sessionId:j},replace:!0})})()},onBlocked:j=>{j==="no-api"&&r({title:t("send.blocked.title"),body:t("send.blocked.noConnection"),sessionId:o??"",url:""})}}),L=a?.metadata?.flavor??"claude",{getSuggestions:P}=gge(e,o,L),{getSuggestions:I}=yge(e,o),N=k.useCallback(async j=>j.startsWith("$")?await I(j):await P(j),[I,P]),O=k.useCallback(()=>{c(),S()},[S,c]);return a?g.jsx(Ime,{api:e,session:a,messages:u,messagesWarning:h,hasMoreMessages:y,isLoadingMessages:f,isLoadingMoreMessages:m,isSending:T,pendingCount:_,messagesVersion:w,onBack:n,onRefresh:O,onLoadMore:b,onSend:E,onFlushPending:M,onAtBottomChange:R,onRetryMessage:A,autocompleteSuggestions:N}):g.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:g.jsx(mv,{label:"Loading session",className:"text-sm"})})}function tSe(){const e=ef({select:s=>s.pathname}),{sessionId:t}=$a({from:"/sessions/$sessionId"}),n=`/sessions/${t}`;return e===n||e===`${n}/`?g.jsx(eSe,{}):g.jsx(Yv,{})}function nSe(){const{api:e}=Vu(),t=fr(),n=Jl(),i=jo(),{machines:s,isLoading:r,error:o}=pge(e,!0),a=k.useCallback(()=>{t({to:"/sessions"})},[t]),c=k.useCallback(u=>{i.invalidateQueries({queryKey:Xt.sessions}),t({to:"/sessions",replace:!0}),requestAnimationFrame(()=>{t({to:"/sessions/$sessionId",params:{sessionId:u}})})},[t,i]);return g.jsxs("div",{className:"flex-1 overflow-y-auto",children:[g.jsxs("div",{className:"flex items-center gap-2 border-b border-[var(--app-border)] bg-[var(--app-bg)] p-3 pt-[calc(0.75rem+env(safe-area-inset-top))]",children:[!Xv()&&g.jsx("button",{type:"button",onClick:n,className:"flex h-8 w-8 items-center justify-center rounded-full text-[var(--app-hint)] transition-colors hover:bg-[var(--app-secondary-bg)] hover:text-[var(--app-fg)]",children:g.jsx(Y0e,{})}),g.jsx("div",{className:"flex-1 font-semibold",children:"Create Session"})]}),o?g.jsx("div",{className:"p-3 text-sm text-red-600",children:o}):null,g.jsx(hge,{api:e,machines:s,isLoading:r,onCancel:a,onSuccess:c})]})}const Ly=Dq({component:yQ}),iSe=Wr({getParentRoute:()=>Ly,path:"/",component:()=>g.jsx(Cq,{to:"/sessions",replace:!0})}),Ny=Wr({getParentRoute:()=>Ly,path:"/sessions",component:J0e}),sSe=Wr({getParentRoute:()=>Ny,path:"/",component:Z0e}),Iy=Wr({getParentRoute:()=>Ny,path:"$sessionId",component:tSe}),rSe=Wr({getParentRoute:()=>Iy,path:"files",validateSearch:e=>{const t=typeof e.tab=="string"?e.tab:void 0,n=t==="directories"?"directories":t==="changes"?"changes":void 0;return n?{tab:n}:{}},component:eve}),oSe=Wr({getParentRoute:()=>Iy,path:"terminal",component:W0e}),aSe=Wr({getParentRoute:()=>Iy,path:"file",validateSearch:e=>{const t=typeof e.path=="string"?e.path:"",n=e.staged===!0||e.staged==="true"?!0:e.staged===!1||e.staged==="false"?!1:void 0,i=typeof e.tab=="string"?e.tab:void 0,s=i==="directories"?"directories":i==="changes"?"changes":void 0,r={path:t};return n!==void 0&&(r.staged=n),s!==void 0&&(r.tab=s),r},component:uve}),lSe=Wr({getParentRoute:()=>Ny,path:"new",component:nSe}),cSe=Wr({getParentRoute:()=>Ly,path:"/settings",component:K0e}),uSe=Ly.addChildren([iSe,Ny.addChildren([sSe,lSe,Iy.addChildren([oSe,rSe,aSe])]),cSe]);function dSe(e){return Hq({routeTree:uSe,history:e,scrollRestoration:!0})}function hSe(){const e=new URLSearchParams(window.location.search),t=e.get("startapp")||e.get("tgWebAppStartParam");return t||(Ir()?.initDataUnsafe?.start_param??null)}function fSe(){const e=hSe();return e?.startsWith("session_")?e.slice(8):null}function pSe(){const e=fSe();return e?`/sessions/${e}`:"/sessions"}async function mSe(){eH();const e=ky();if(e){const{reloaded:s}=await Vue({appVersion:"0.15.3"});if(s)return}const t=ND();if(t&&await nH(),!e){const s=Kq({onNeedRefresh(){confirm("New version available! Reload to update?")&&s(!0)},onOfflineReady(){console.log("App ready for offline use")},onRegistered(r){r&&setInterval(()=>{r.update()},36e5)},onRegisterError(r){console.error("SW registration error:",r)}})}const n=t?g$({initialEntries:[pSe()]}):void 0,i=dSe(n);T8.createRoot(document.getElementById("root")).render(g.jsx(pi.StrictMode,{children:g.jsx(h7,{children:g.jsxs(X8,{client:iH,children:[g.jsx(Gq,{router:i}),null]})})}))}mSe();export{HN as a,zne as b,Yk as c,Dde as d,She as e,Rhe as f,Pde as g,Lde as h,Ode as i,Ehe as j,Mhe as k,us as l,Pr as m,_n as n,TSe as o,rw as p,$3 as q,ide as r,dde as s,mde as t,$ne as u,Cre as v,bde as w};
