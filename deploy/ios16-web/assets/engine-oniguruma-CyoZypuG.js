class B extends Error{constructor(t){super(t),this.name="ShikiError"}}function W(){return 2147483648}function v(){return typeof performance<"u"?performance.now():Date.now()}const I=(r,t)=>r+(t-r%t)%t;async function x(r){let t,n;const e={};function l(f){n=f,e.HEAPU8=new Uint8Array(f),e.HEAPU32=new Uint32Array(f)}function h(f,c,S){e.HEAPU8.copyWithin(f,c,c+S)}function o(f){try{return t.grow(f-n.byteLength+65535>>>16),l(t.buffer),1}catch{}}function s(f){const c=e.HEAPU8.length;f=f>>>0;const S=W();if(f>S)return!1;for(let A=1;A<=4;A*=2){let p=c*(1+.2/A);p=Math.min(p,f+100663296);const _=Math.min(S,I(Math.max(f,p),65536));if(o(_))return!0}return!1}const i=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function a(f,c,S=1024){const A=c+S;let p=c;for(;f[p]&&!(p>=A);)++p;if(p-c>16&&f.buffer&&i)return i.decode(f.subarray(c,p));let _="";for(;c<p;){let m=f[c++];if(!(m&128)){_+=String.fromCharCode(m);continue}const b=f[c++]&63;if((m&224)===192){_+=String.fromCharCode((m&31)<<6|b);continue}const C=f[c++]&63;if((m&240)===224?m=(m&15)<<12|b<<6|C:m=(m&7)<<18|b<<12|C<<6|f[c++]&63,m<65536)_+=String.fromCharCode(m);else{const E=m-65536;_+=String.fromCharCode(55296|E>>10,56320|E&1023)}}return _}function w(f,c){return f?a(e.HEAPU8,f,c):""}const u={emscripten_get_now:v,emscripten_memcpy_big:h,emscripten_resize_heap:s,fd_write:()=>0};async function y(){const c=await r({env:u,wasi_snapshot_preview1:u});t=c.memory,l(t.buffer),Object.assign(e,c),e.UTF8ToString=w}return await y(),e}var D=Object.defineProperty,V=(r,t,n)=>t in r?D(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,d=(r,t,n)=>V(r,typeof t!="symbol"?t+"":t,n);let g=null;function N(r){throw new B(r.UTF8ToString(r.getLastOnigError()))}class P{constructor(t){d(this,"utf16Length"),d(this,"utf8Length"),d(this,"utf16Value"),d(this,"utf8Value"),d(this,"utf16OffsetToUtf8"),d(this,"utf8OffsetToUtf16");const n=t.length,e=P._utf8ByteLength(t),l=e!==n,h=l?new Uint32Array(n+1):null;l&&(h[n]=e);const o=l?new Uint32Array(e+1):null;l&&(o[e]=n);const s=new Uint8Array(e);let i=0;for(let a=0;a<n;a++){const w=t.charCodeAt(a);let u=w,y=!1;if(w>=55296&&w<=56319&&a+1<n){const f=t.charCodeAt(a+1);f>=56320&&f<=57343&&(u=(w-55296<<10)+65536|f-56320,y=!0)}l&&(h[a]=i,y&&(h[a+1]=i),u<=127?o[i+0]=a:u<=2047?(o[i+0]=a,o[i+1]=a):u<=65535?(o[i+0]=a,o[i+1]=a,o[i+2]=a):(o[i+0]=a,o[i+1]=a,o[i+2]=a,o[i+3]=a)),u<=127?s[i++]=u:u<=2047?(s[i++]=192|(u&1984)>>>6,s[i++]=128|(u&63)>>>0):u<=65535?(s[i++]=224|(u&61440)>>>12,s[i++]=128|(u&4032)>>>6,s[i++]=128|(u&63)>>>0):(s[i++]=240|(u&1835008)>>>18,s[i++]=128|(u&258048)>>>12,s[i++]=128|(u&4032)>>>6,s[i++]=128|(u&63)>>>0),y&&a++}this.utf16Length=n,this.utf8Length=e,this.utf16Value=t,this.utf8Value=s,this.utf16OffsetToUtf8=h,this.utf8OffsetToUtf16=o}static _utf8ByteLength(t){let n=0;for(let e=0,l=t.length;e<l;e++){const h=t.charCodeAt(e);let o=h,s=!1;if(h>=55296&&h<=56319&&e+1<l){const i=t.charCodeAt(e+1);i>=56320&&i<=57343&&(o=(h-55296<<10)+65536|i-56320,s=!0)}o<=127?n+=1:o<=2047?n+=2:o<=65535?n+=3:n+=4,s&&e++}return n}createString(t){const n=t.omalloc(this.utf8Length);return t.HEAPU8.set(this.utf8Value,n),n}}const T=class U{constructor(t){if(d(this,"id",++U.LAST_ID),d(this,"_onigBinding"),d(this,"content"),d(this,"utf16Length"),d(this,"utf8Length"),d(this,"utf16OffsetToUtf8"),d(this,"utf8OffsetToUtf16"),d(this,"ptr"),!g)throw new B("Must invoke loadWasm first.");this._onigBinding=g,this.content=t;const n=new P(t);this.utf16Length=n.utf16Length,this.utf8Length=n.utf8Length,this.utf16OffsetToUtf8=n.utf16OffsetToUtf8,this.utf8OffsetToUtf16=n.utf8OffsetToUtf16,this.utf8Length<1e4&&!U._sharedPtrInUse?(U._sharedPtr||(U._sharedPtr=g.omalloc(1e4)),U._sharedPtrInUse=!0,g.HEAPU8.set(n.utf8Value,U._sharedPtr),this.ptr=U._sharedPtr):this.ptr=n.createString(g)}convertUtf8OffsetToUtf16(t){return this.utf8OffsetToUtf16?t<0?0:t>this.utf8Length?this.utf16Length:this.utf8OffsetToUtf16[t]:t}convertUtf16OffsetToUtf8(t){return this.utf16OffsetToUtf8?t<0?0:t>this.utf16Length?this.utf8Length:this.utf16OffsetToUtf8[t]:t}dispose(){this.ptr===U._sharedPtr?U._sharedPtrInUse=!1:this._onigBinding.ofree(this.ptr)}};d(T,"LAST_ID",0);d(T,"_sharedPtr",0);d(T,"_sharedPtrInUse",!1);let M=T;class F{constructor(t){if(d(this,"_onigBinding"),d(this,"_ptr"),!g)throw new B("Must invoke loadWasm first.");const n=[],e=[];for(let s=0,i=t.length;s<i;s++){const a=new P(t[s]);n[s]=a.createString(g),e[s]=a.utf8Length}const l=g.omalloc(4*t.length);g.HEAPU32.set(n,l/4);const h=g.omalloc(4*t.length);g.HEAPU32.set(e,h/4);const o=g.createOnigScanner(l,h,t.length);for(let s=0,i=t.length;s<i;s++)g.ofree(n[s]);g.ofree(h),g.ofree(l),o===0&&N(g),this._onigBinding=g,this._ptr=o}dispose(){this._onigBinding.freeOnigScanner(this._ptr)}findNextMatchSync(t,n,e){let l=0;if(typeof e=="number"&&(l=e),typeof t=="string"){t=new M(t);const h=this._findNextMatchSync(t,n,!1,l);return t.dispose(),h}return this._findNextMatchSync(t,n,!1,l)}_findNextMatchSync(t,n,e,l){const h=this._onigBinding,o=h.findNextOnigScannerMatch(this._ptr,t.id,t.ptr,t.utf8Length,t.convertUtf16OffsetToUtf8(n),l);if(o===0)return null;const s=h.HEAPU32;let i=o/4;const a=s[i++],w=s[i++],u=[];for(let y=0;y<w;y++){const f=t.convertUtf8OffsetToUtf16(s[i++]),c=t.convertUtf8OffsetToUtf16(s[i++]);u[y]={start:f,end:c,length:c-f}}return{index:a,captureIndices:u}}}function R(r){return typeof r.instantiator=="function"}function k(r){return typeof r.default=="function"}function j(r){return typeof r.data<"u"}function z(r){return typeof Response<"u"&&r instanceof Response}function G(r){return typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||ArrayBuffer.isView(r))||typeof Buffer<"u"&&Buffer.isBuffer?.(r)||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer||typeof Uint32Array<"u"&&r instanceof Uint32Array}let L;function $(r){if(L)return L;async function t(){g=await x(async n=>{let e=r;return e=await e,typeof e=="function"&&(e=await e(n)),typeof e=="function"&&(e=await e(n)),R(e)?e=await e.instantiator(n):k(e)?e=await e.default(n):(j(e)&&(e=e.data),z(e)?typeof WebAssembly.instantiateStreaming=="function"?e=await J(e)(n):e=await K(e)(n):G(e)?e=await O(e)(n):e instanceof WebAssembly.Module?e=await O(e)(n):"default"in e&&e.default instanceof WebAssembly.Module&&(e=await O(e.default)(n))),"instance"in e&&(e=e.instance),"exports"in e&&(e=e.exports),e})}return L=t(),L}function O(r){return t=>WebAssembly.instantiate(r,t)}function J(r){return t=>WebAssembly.instantiateStreaming(r,t)}function K(r){return async t=>{const n=await r.arrayBuffer();return WebAssembly.instantiate(n,t)}}let H;function Q(r){H=r}function X(){return H}async function Y(r){return r&&await $(r),{createScanner(t){return new F(t.map(n=>typeof n=="string"?n:n.source))},createString(t){return new M(t)}}}export{Y as createOnigurumaEngine,X as getDefaultWasmLoader,$ as loadWasm,Q as setDefaultWasmLoader};
